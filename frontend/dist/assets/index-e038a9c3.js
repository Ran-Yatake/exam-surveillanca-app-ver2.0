var ms=Object.defineProperty;var gs=(et,$,_)=>$ in et?ms(et,$,{enumerable:!0,configurable:!0,writable:!0,value:_}):et[$]=_;var Pt=(et,$,_)=>(gs(et,typeof $!="symbol"?$+"":$,_),_);(function(){const $=document.createElement("link").relList;if($&&$.supports&&$.supports("modulepreload"))return;for(const nt of document.querySelectorAll('link[rel="modulepreload"]'))tt(nt);new MutationObserver(nt=>{for(const it of nt)if(it.type==="childList")for(const rt of it.addedNodes)rt.tagName==="LINK"&&rt.rel==="modulepreload"&&tt(rt)}).observe(document,{childList:!0,subtree:!0});function _(nt){const it={};return nt.integrity&&(it.integrity=nt.integrity),nt.referrerPolicy&&(it.referrerPolicy=nt.referrerPolicy),nt.crossOrigin==="use-credentials"?it.credentials="include":nt.crossOrigin==="anonymous"?it.credentials="omit":it.credentials="same-origin",it}function tt(nt){if(nt.ep)return;nt.ep=!0;const it=_(nt);fetch(nt.href,it)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{};function getDefaultExportFromCjs(et){return et&&et.__esModule&&Object.prototype.hasOwnProperty.call(et,"default")?et.default:et}function getAugmentedNamespace(et){if(et.__esModule)return et;var $=et.default;if(typeof $=="function"){var _=function tt(){return this instanceof tt?Reflect.construct($,arguments,this.constructor):$.apply(this,arguments)};_.prototype=$.prototype}else _={};return Object.defineProperty(_,"__esModule",{value:!0}),Object.keys(et).forEach(function(tt){var nt=Object.getOwnPropertyDescriptor(et,tt);Object.defineProperty(_,tt,nt.get?nt:{enumerable:!0,get:function(){return et[tt]}})}),_}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$2=Symbol.for("react.element"),n$2=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$2=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t$1=Symbol.for("react.provider"),u$1=Symbol.for("react.context"),v$2=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(et){return et===null||typeof et!="object"?null:(et=z$1&&et[z$1]||et["@@iterator"],typeof et=="function"?et:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(et,$,_){this.props=et,this.context=$,this.refs=D$1,this.updater=_||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(et,$){if(typeof et!="object"&&typeof et!="function"&&et!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,et,$,"setState")};E$1.prototype.forceUpdate=function(et){this.updater.enqueueForceUpdate(this,et,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(et,$,_){this.props=et,this.context=$,this.refs=D$1,this.updater=_||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(et,$,_){var tt,nt={},it=null,rt=null;if($!=null)for(tt in $.ref!==void 0&&(rt=$.ref),$.key!==void 0&&(it=""+$.key),$)J.call($,tt)&&!L$1.hasOwnProperty(tt)&&(nt[tt]=$[tt]);var ot=arguments.length-2;if(ot===1)nt.children=_;else if(1<ot){for(var lt=Array(ot),st=0;st<ot;st++)lt[st]=arguments[st+2];nt.children=lt}if(et&&et.defaultProps)for(tt in ot=et.defaultProps,ot)nt[tt]===void 0&&(nt[tt]=ot[tt]);return{$$typeof:l$2,type:et,key:it,ref:rt,props:nt,_owner:K$1.current}}function N$1(et,$){return{$$typeof:l$2,type:et.type,key:$,ref:et.ref,props:et.props,_owner:et._owner}}function O$1(et){return typeof et=="object"&&et!==null&&et.$$typeof===l$2}function escape$1(et){var $={"=":"=0",":":"=2"};return"$"+et.replace(/[=:]/g,function(_){return $[_]})}var P$1=/\/+/g;function Q$1(et,$){return typeof et=="object"&&et!==null&&et.key!=null?escape$1(""+et.key):$.toString(36)}function R$1(et,$,_,tt,nt){var it=typeof et;(it==="undefined"||it==="boolean")&&(et=null);var rt=!1;if(et===null)rt=!0;else switch(it){case"string":case"number":rt=!0;break;case"object":switch(et.$$typeof){case l$2:case n$2:rt=!0}}if(rt)return rt=et,nt=nt(rt),et=tt===""?"."+Q$1(rt,0):tt,I$1(nt)?(_="",et!=null&&(_=et.replace(P$1,"$&/")+"/"),R$1(nt,$,_,"",function(st){return st})):nt!=null&&(O$1(nt)&&(nt=N$1(nt,_+(!nt.key||rt&&rt.key===nt.key?"":(""+nt.key).replace(P$1,"$&/")+"/")+et)),$.push(nt)),1;if(rt=0,tt=tt===""?".":tt+":",I$1(et))for(var ot=0;ot<et.length;ot++){it=et[ot];var lt=tt+Q$1(it,ot);rt+=R$1(it,$,_,lt,nt)}else if(lt=A$1(et),typeof lt=="function")for(et=lt.call(et),ot=0;!(it=et.next()).done;)it=it.value,lt=tt+Q$1(it,ot++),rt+=R$1(it,$,_,lt,nt);else if(it==="object")throw $=String(et),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(et).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.");return rt}function S$1(et,$,_){if(et==null)return et;var tt=[],nt=0;return R$1(et,tt,"","",function(it){return $.call(_,it,nt++)}),tt}function T$1(et){if(et._status===-1){var $=et._result;$=$(),$.then(function(_){(et._status===0||et._status===-1)&&(et._status=1,et._result=_)},function(_){(et._status===0||et._status===-1)&&(et._status=2,et._result=_)}),et._status===-1&&(et._status=0,et._result=$)}if(et._status===1)return et._result.default;throw et._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$1(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$1,forEach:function(et,$,_){S$1(et,function(){$.apply(this,arguments)},_)},count:function(et){var $=0;return S$1(et,function(){$++}),$},toArray:function(et){return S$1(et,function($){return $})||[]},only:function(et){if(!O$1(et))throw Error("React.Children.only expected to receive a single React element child.");return et}};react_production_min.Component=E$1;react_production_min.Fragment=p$3;react_production_min.Profiler=r$1;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$2;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$1;react_production_min.cloneElement=function(et,$,_){if(et==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+et+".");var tt=C$1({},et.props),nt=et.key,it=et.ref,rt=et._owner;if($!=null){if($.ref!==void 0&&(it=$.ref,rt=K$1.current),$.key!==void 0&&(nt=""+$.key),et.type&&et.type.defaultProps)var ot=et.type.defaultProps;for(lt in $)J.call($,lt)&&!L$1.hasOwnProperty(lt)&&(tt[lt]=$[lt]===void 0&&ot!==void 0?ot[lt]:$[lt])}var lt=arguments.length-2;if(lt===1)tt.children=_;else if(1<lt){ot=Array(lt);for(var st=0;st<lt;st++)ot[st]=arguments[st+2];tt.children=ot}return{$$typeof:l$2,type:et.type,key:nt,ref:it,props:tt,_owner:rt}};react_production_min.createContext=function(et){return et={$$typeof:u$1,_currentValue:et,_currentValue2:et,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},et.Provider={$$typeof:t$1,_context:et},et.Consumer=et};react_production_min.createElement=M$1;react_production_min.createFactory=function(et){var $=M$1.bind(null,et);return $.type=et,$};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(et){return{$$typeof:v$2,render:et}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(et){return{$$typeof:y,_payload:{_status:-1,_result:et},_init:T$1}};react_production_min.memo=function(et,$){return{$$typeof:x,type:et,compare:$===void 0?null:$}};react_production_min.startTransition=function(et){var $=V$1.transition;V$1.transition={};try{et()}finally{V$1.transition=$}};react_production_min.unstable_act=X$1;react_production_min.useCallback=function(et,$){return U$1.current.useCallback(et,$)};react_production_min.useContext=function(et){return U$1.current.useContext(et)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(et){return U$1.current.useDeferredValue(et)};react_production_min.useEffect=function(et,$){return U$1.current.useEffect(et,$)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(et,$,_){return U$1.current.useImperativeHandle(et,$,_)};react_production_min.useInsertionEffect=function(et,$){return U$1.current.useInsertionEffect(et,$)};react_production_min.useLayoutEffect=function(et,$){return U$1.current.useLayoutEffect(et,$)};react_production_min.useMemo=function(et,$){return U$1.current.useMemo(et,$)};react_production_min.useReducer=function(et,$,_){return U$1.current.useReducer(et,$,_)};react_production_min.useRef=function(et){return U$1.current.useRef(et)};react_production_min.useState=function(et){return U$1.current.useState(et)};react_production_min.useSyncExternalStore=function(et,$,_){return U$1.current.useSyncExternalStore(et,$,_)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$1=reactExports,k$1=Symbol.for("react.element"),l$1=Symbol.for("react.fragment"),m$2=Object.prototype.hasOwnProperty,n$1=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q$1(et,$,_){var tt,nt={},it=null,rt=null;_!==void 0&&(it=""+_),$.key!==void 0&&(it=""+$.key),$.ref!==void 0&&(rt=$.ref);for(tt in $)m$2.call($,tt)&&!p$2.hasOwnProperty(tt)&&(nt[tt]=$[tt]);if(et&&et.defaultProps)for(tt in $=et.defaultProps,$)nt[tt]===void 0&&(nt[tt]=$[tt]);return{$$typeof:k$1,type:et,key:it,ref:rt,props:nt,_owner:n$1.current}}reactJsxRuntime_production_min.Fragment=l$1;reactJsxRuntime_production_min.jsx=q$1;reactJsxRuntime_production_min.jsxs=q$1;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(et){function $(Ut,Kt){var Gt=Ut.length;Ut.push(Kt);e:for(;0<Gt;){var Wt=Gt-1>>>1,Jt=Ut[Wt];if(0<nt(Jt,Kt))Ut[Wt]=Kt,Ut[Gt]=Jt,Gt=Wt;else break e}}function _(Ut){return Ut.length===0?null:Ut[0]}function tt(Ut){if(Ut.length===0)return null;var Kt=Ut[0],Gt=Ut.pop();if(Gt!==Kt){Ut[0]=Gt;e:for(var Wt=0,Jt=Ut.length,_n=Jt>>>1;Wt<_n;){var mn=2*(Wt+1)-1,hn=Ut[mn],gn=mn+1,yn=Ut[gn];if(0>nt(hn,Gt))gn<Jt&&0>nt(yn,hn)?(Ut[Wt]=yn,Ut[gn]=Gt,Wt=gn):(Ut[Wt]=hn,Ut[mn]=Gt,Wt=mn);else if(gn<Jt&&0>nt(yn,Gt))Ut[Wt]=yn,Ut[gn]=Gt,Wt=gn;else break e}}return Kt}function nt(Ut,Kt){var Gt=Ut.sortIndex-Kt.sortIndex;return Gt!==0?Gt:Ut.id-Kt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var it=performance;et.unstable_now=function(){return it.now()}}else{var rt=Date,ot=rt.now();et.unstable_now=function(){return rt.now()-ot}}var lt=[],st=[],at=1,ct=null,dt=3,ut=!1,ft=!1,pt=!1,St=typeof setTimeout=="function"?setTimeout:null,gt=typeof clearTimeout=="function"?clearTimeout:null,yt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function vt(Ut){for(var Kt=_(st);Kt!==null;){if(Kt.callback===null)tt(st);else if(Kt.startTime<=Ut)tt(st),Kt.sortIndex=Kt.expirationTime,$(lt,Kt);else break;Kt=_(st)}}function Ct(Ut){if(pt=!1,vt(Ut),!ft)if(_(lt)!==null)ft=!0,an(Et);else{var Kt=_(st);Kt!==null&&bn(Ct,Kt.startTime-Ut)}}function Et(Ut,Kt){ft=!1,pt&&(pt=!1,gt(At),At=-1),ut=!0;var Gt=dt;try{for(vt(Kt),ct=_(lt);ct!==null&&(!(ct.expirationTime>Kt)||Ut&&!Vt());){var Wt=ct.callback;if(typeof Wt=="function"){ct.callback=null,dt=ct.priorityLevel;var Jt=Wt(ct.expirationTime<=Kt);Kt=et.unstable_now(),typeof Jt=="function"?ct.callback=Jt:ct===_(lt)&&tt(lt),vt(Kt)}else tt(lt);ct=_(lt)}if(ct!==null)var _n=!0;else{var mn=_(st);mn!==null&&bn(Ct,mn.startTime-Kt),_n=!1}return _n}finally{ct=null,dt=Gt,ut=!1}}var Mt=!1,Rt=null,At=-1,Dt=5,It=-1;function Vt(){return!(et.unstable_now()-It<Dt)}function jt(){if(Rt!==null){var Ut=et.unstable_now();It=Ut;var Kt=!0;try{Kt=Rt(!0,Ut)}finally{Kt?qt():(Mt=!1,Rt=null)}}else Mt=!1}var qt;if(typeof yt=="function")qt=function(){yt(jt)};else if(typeof MessageChannel<"u"){var cn=new MessageChannel,dn=cn.port2;cn.port1.onmessage=jt,qt=function(){dn.postMessage(null)}}else qt=function(){St(jt,0)};function an(Ut){Rt=Ut,Mt||(Mt=!0,qt())}function bn(Ut,Kt){At=St(function(){Ut(et.unstable_now())},Kt)}et.unstable_IdlePriority=5,et.unstable_ImmediatePriority=1,et.unstable_LowPriority=4,et.unstable_NormalPriority=3,et.unstable_Profiling=null,et.unstable_UserBlockingPriority=2,et.unstable_cancelCallback=function(Ut){Ut.callback=null},et.unstable_continueExecution=function(){ft||ut||(ft=!0,an(Et))},et.unstable_forceFrameRate=function(Ut){0>Ut||125<Ut?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Dt=0<Ut?Math.floor(1e3/Ut):5},et.unstable_getCurrentPriorityLevel=function(){return dt},et.unstable_getFirstCallbackNode=function(){return _(lt)},et.unstable_next=function(Ut){switch(dt){case 1:case 2:case 3:var Kt=3;break;default:Kt=dt}var Gt=dt;dt=Kt;try{return Ut()}finally{dt=Gt}},et.unstable_pauseExecution=function(){},et.unstable_requestPaint=function(){},et.unstable_runWithPriority=function(Ut,Kt){switch(Ut){case 1:case 2:case 3:case 4:case 5:break;default:Ut=3}var Gt=dt;dt=Ut;try{return Kt()}finally{dt=Gt}},et.unstable_scheduleCallback=function(Ut,Kt,Gt){var Wt=et.unstable_now();switch(typeof Gt=="object"&&Gt!==null?(Gt=Gt.delay,Gt=typeof Gt=="number"&&0<Gt?Wt+Gt:Wt):Gt=Wt,Ut){case 1:var Jt=-1;break;case 2:Jt=250;break;case 5:Jt=1073741823;break;case 4:Jt=1e4;break;default:Jt=5e3}return Jt=Gt+Jt,Ut={id:at++,callback:Kt,priorityLevel:Ut,startTime:Gt,expirationTime:Jt,sortIndex:-1},Gt>Wt?(Ut.sortIndex=Gt,$(st,Ut),_(lt)===null&&Ut===_(st)&&(pt?(gt(At),At=-1):pt=!0,bn(Ct,Gt-Wt))):(Ut.sortIndex=Jt,$(lt,Ut),ft||ut||(ft=!0,an(Et))),Ut},et.unstable_shouldYield=Vt,et.unstable_wrapCallback=function(Ut){var Kt=dt;return function(){var Gt=dt;dt=Kt;try{return Ut.apply(this,arguments)}finally{dt=Gt}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1(et){for(var $="https://reactjs.org/docs/error-decoder.html?invariant="+et,_=1;_<arguments.length;_++)$+="&args[]="+encodeURIComponent(arguments[_]);return"Minified React error #"+et+"; visit "+$+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(et,$){ha(et,$),ha(et+"Capture",$)}function ha(et,$){for(ea[et]=$,et=0;et<$.length;et++)da.add($[et])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(et){return ja.call(ma,et)?!0:ja.call(la,et)?!1:ka.test(et)?ma[et]=!0:(la[et]=!0,!1)}function pa(et,$,_,tt){if(_!==null&&_.type===0)return!1;switch(typeof $){case"function":case"symbol":return!0;case"boolean":return tt?!1:_!==null?!_.acceptsBooleans:(et=et.toLowerCase().slice(0,5),et!=="data-"&&et!=="aria-");default:return!1}}function qa(et,$,_,tt){if($===null||typeof $>"u"||pa(et,$,_,tt))return!0;if(tt)return!1;if(_!==null)switch(_.type){case 3:return!$;case 4:return $===!1;case 5:return isNaN($);case 6:return isNaN($)||1>$}return!1}function v$1(et,$,_,tt,nt,it,rt){this.acceptsBooleans=$===2||$===3||$===4,this.attributeName=tt,this.attributeNamespace=nt,this.mustUseProperty=_,this.propertyName=et,this.type=$,this.sanitizeURL=it,this.removeEmptyString=rt}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(et){z[et]=new v$1(et,0,!1,et,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(et){var $=et[0];z[$]=new v$1($,1,!1,et[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(et){z[et]=new v$1(et,2,!1,et.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(et){z[et]=new v$1(et,2,!1,et,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(et){z[et]=new v$1(et,3,!1,et.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(et){z[et]=new v$1(et,3,!0,et,null,!1,!1)});["capture","download"].forEach(function(et){z[et]=new v$1(et,4,!1,et,null,!1,!1)});["cols","rows","size","span"].forEach(function(et){z[et]=new v$1(et,6,!1,et,null,!1,!1)});["rowSpan","start"].forEach(function(et){z[et]=new v$1(et,5,!1,et.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(et){return et[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(et){var $=et.replace(ra,sa);z[$]=new v$1($,1,!1,et,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(et){var $=et.replace(ra,sa);z[$]=new v$1($,1,!1,et,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(et){var $=et.replace(ra,sa);z[$]=new v$1($,1,!1,et,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(et){z[et]=new v$1(et,1,!1,et.toLowerCase(),null,!1,!1)});z.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(et){z[et]=new v$1(et,1,!1,et.toLowerCase(),null,!0,!0)});function ta(et,$,_,tt){var nt=z.hasOwnProperty($)?z[$]:null;(nt!==null?nt.type!==0:tt||!(2<$.length)||$[0]!=="o"&&$[0]!=="O"||$[1]!=="n"&&$[1]!=="N")&&(qa($,_,nt,tt)&&(_=null),tt||nt===null?oa($)&&(_===null?et.removeAttribute($):et.setAttribute($,""+_)):nt.mustUseProperty?et[nt.propertyName]=_===null?nt.type===3?!1:"":_:($=nt.attributeName,tt=nt.attributeNamespace,_===null?et.removeAttribute($):(nt=nt.type,_=nt===3||nt===4&&_===!0?"":""+_,tt?et.setAttributeNS(tt,$,_):et.setAttribute($,_))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(et){return et===null||typeof et!="object"?null:(et=Ja&&et[Ja]||et["@@iterator"],typeof et=="function"?et:null)}var A=Object.assign,La;function Ma(et){if(La===void 0)try{throw Error()}catch(_){var $=_.stack.trim().match(/\n( *(at )?)/);La=$&&$[1]||""}return`
`+La+et}var Na=!1;function Oa(et,$){if(!et||Na)return"";Na=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if($)if($=function(){throw Error()},Object.defineProperty($.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($,[])}catch(st){var tt=st}Reflect.construct(et,[],$)}else{try{$.call()}catch(st){tt=st}et.call($.prototype)}else{try{throw Error()}catch(st){tt=st}et()}}catch(st){if(st&&tt&&typeof st.stack=="string"){for(var nt=st.stack.split(`
`),it=tt.stack.split(`
`),rt=nt.length-1,ot=it.length-1;1<=rt&&0<=ot&&nt[rt]!==it[ot];)ot--;for(;1<=rt&&0<=ot;rt--,ot--)if(nt[rt]!==it[ot]){if(rt!==1||ot!==1)do if(rt--,ot--,0>ot||nt[rt]!==it[ot]){var lt=`
`+nt[rt].replace(" at new "," at ");return et.displayName&&lt.includes("<anonymous>")&&(lt=lt.replace("<anonymous>",et.displayName)),lt}while(1<=rt&&0<=ot);break}}}finally{Na=!1,Error.prepareStackTrace=_}return(et=et?et.displayName||et.name:"")?Ma(et):""}function Pa(et){switch(et.tag){case 5:return Ma(et.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return et=Oa(et.type,!1),et;case 11:return et=Oa(et.type.render,!1),et;case 1:return et=Oa(et.type,!0),et;default:return""}}function Qa(et){if(et==null)return null;if(typeof et=="function")return et.displayName||et.name||null;if(typeof et=="string")return et;switch(et){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof et=="object")switch(et.$$typeof){case Ca:return(et.displayName||"Context")+".Consumer";case Ba:return(et._context.displayName||"Context")+".Provider";case Da:var $=et.render;return et=et.displayName,et||(et=$.displayName||$.name||"",et=et!==""?"ForwardRef("+et+")":"ForwardRef"),et;case Ga:return $=et.displayName||null,$!==null?$:Qa(et.type)||"Memo";case Ha:$=et._payload,et=et._init;try{return Qa(et($))}catch{}}return null}function Ra(et){var $=et.type;switch(et.tag){case 24:return"Cache";case 9:return($.displayName||"Context")+".Consumer";case 10:return($._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return et=$.render,et=et.displayName||et.name||"",$.displayName||(et!==""?"ForwardRef("+et+")":"ForwardRef");case 7:return"Fragment";case 5:return $;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa($);case 8:return $===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof $=="function")return $.displayName||$.name||null;if(typeof $=="string")return $}return null}function Sa(et){switch(typeof et){case"boolean":case"number":case"string":case"undefined":return et;case"object":return et;default:return""}}function Ta(et){var $=et.type;return(et=et.nodeName)&&et.toLowerCase()==="input"&&($==="checkbox"||$==="radio")}function Ua(et){var $=Ta(et)?"checked":"value",_=Object.getOwnPropertyDescriptor(et.constructor.prototype,$),tt=""+et[$];if(!et.hasOwnProperty($)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var nt=_.get,it=_.set;return Object.defineProperty(et,$,{configurable:!0,get:function(){return nt.call(this)},set:function(rt){tt=""+rt,it.call(this,rt)}}),Object.defineProperty(et,$,{enumerable:_.enumerable}),{getValue:function(){return tt},setValue:function(rt){tt=""+rt},stopTracking:function(){et._valueTracker=null,delete et[$]}}}}function Va(et){et._valueTracker||(et._valueTracker=Ua(et))}function Wa(et){if(!et)return!1;var $=et._valueTracker;if(!$)return!0;var _=$.getValue(),tt="";return et&&(tt=Ta(et)?et.checked?"true":"false":et.value),et=tt,et!==_?($.setValue(et),!0):!1}function Xa(et){if(et=et||(typeof document<"u"?document:void 0),typeof et>"u")return null;try{return et.activeElement||et.body}catch{return et.body}}function Ya(et,$){var _=$.checked;return A({},$,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:_??et._wrapperState.initialChecked})}function Za(et,$){var _=$.defaultValue==null?"":$.defaultValue,tt=$.checked!=null?$.checked:$.defaultChecked;_=Sa($.value!=null?$.value:_),et._wrapperState={initialChecked:tt,initialValue:_,controlled:$.type==="checkbox"||$.type==="radio"?$.checked!=null:$.value!=null}}function ab(et,$){$=$.checked,$!=null&&ta(et,"checked",$,!1)}function bb(et,$){ab(et,$);var _=Sa($.value),tt=$.type;if(_!=null)tt==="number"?(_===0&&et.value===""||et.value!=_)&&(et.value=""+_):et.value!==""+_&&(et.value=""+_);else if(tt==="submit"||tt==="reset"){et.removeAttribute("value");return}$.hasOwnProperty("value")?cb(et,$.type,_):$.hasOwnProperty("defaultValue")&&cb(et,$.type,Sa($.defaultValue)),$.checked==null&&$.defaultChecked!=null&&(et.defaultChecked=!!$.defaultChecked)}function db(et,$,_){if($.hasOwnProperty("value")||$.hasOwnProperty("defaultValue")){var tt=$.type;if(!(tt!=="submit"&&tt!=="reset"||$.value!==void 0&&$.value!==null))return;$=""+et._wrapperState.initialValue,_||$===et.value||(et.value=$),et.defaultValue=$}_=et.name,_!==""&&(et.name=""),et.defaultChecked=!!et._wrapperState.initialChecked,_!==""&&(et.name=_)}function cb(et,$,_){($!=="number"||Xa(et.ownerDocument)!==et)&&(_==null?et.defaultValue=""+et._wrapperState.initialValue:et.defaultValue!==""+_&&(et.defaultValue=""+_))}var eb=Array.isArray;function fb(et,$,_,tt){if(et=et.options,$){$={};for(var nt=0;nt<_.length;nt++)$["$"+_[nt]]=!0;for(_=0;_<et.length;_++)nt=$.hasOwnProperty("$"+et[_].value),et[_].selected!==nt&&(et[_].selected=nt),nt&&tt&&(et[_].defaultSelected=!0)}else{for(_=""+Sa(_),$=null,nt=0;nt<et.length;nt++){if(et[nt].value===_){et[nt].selected=!0,tt&&(et[nt].defaultSelected=!0);return}$!==null||et[nt].disabled||($=et[nt])}$!==null&&($.selected=!0)}}function gb(et,$){if($.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A({},$,{value:void 0,defaultValue:void 0,children:""+et._wrapperState.initialValue})}function hb(et,$){var _=$.value;if(_==null){if(_=$.children,$=$.defaultValue,_!=null){if($!=null)throw Error(p$1(92));if(eb(_)){if(1<_.length)throw Error(p$1(93));_=_[0]}$=_}$==null&&($=""),_=$}et._wrapperState={initialValue:Sa(_)}}function ib(et,$){var _=Sa($.value),tt=Sa($.defaultValue);_!=null&&(_=""+_,_!==et.value&&(et.value=_),$.defaultValue==null&&et.defaultValue!==_&&(et.defaultValue=_)),tt!=null&&(et.defaultValue=""+tt)}function jb(et){var $=et.textContent;$===et._wrapperState.initialValue&&$!==""&&$!==null&&(et.value=$)}function kb(et){switch(et){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(et,$){return et==null||et==="http://www.w3.org/1999/xhtml"?kb($):et==="http://www.w3.org/2000/svg"&&$==="foreignObject"?"http://www.w3.org/1999/xhtml":et}var mb,nb=function(et){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function($,_,tt,nt){MSApp.execUnsafeLocalFunction(function(){return et($,_,tt,nt)})}:et}(function(et,$){if(et.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in et)et.innerHTML=$;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+$.valueOf().toString()+"</svg>",$=mb.firstChild;et.firstChild;)et.removeChild(et.firstChild);for(;$.firstChild;)et.appendChild($.firstChild)}});function ob(et,$){if($){var _=et.firstChild;if(_&&_===et.lastChild&&_.nodeType===3){_.nodeValue=$;return}}et.textContent=$}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(et){qb.forEach(function($){$=$+et.charAt(0).toUpperCase()+et.substring(1),pb[$]=pb[et]})});function rb(et,$,_){return $==null||typeof $=="boolean"||$===""?"":_||typeof $!="number"||$===0||pb.hasOwnProperty(et)&&pb[et]?(""+$).trim():$+"px"}function sb(et,$){et=et.style;for(var _ in $)if($.hasOwnProperty(_)){var tt=_.indexOf("--")===0,nt=rb(_,$[_],tt);_==="float"&&(_="cssFloat"),tt?et.setProperty(_,nt):et[_]=nt}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(et,$){if($){if(tb[et]&&($.children!=null||$.dangerouslySetInnerHTML!=null))throw Error(p$1(137,et));if($.dangerouslySetInnerHTML!=null){if($.children!=null)throw Error(p$1(60));if(typeof $.dangerouslySetInnerHTML!="object"||!("__html"in $.dangerouslySetInnerHTML))throw Error(p$1(61))}if($.style!=null&&typeof $.style!="object")throw Error(p$1(62))}}function vb(et,$){if(et.indexOf("-")===-1)return typeof $.is=="string";switch(et){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(et){return et=et.target||et.srcElement||window,et.correspondingUseElement&&(et=et.correspondingUseElement),et.nodeType===3?et.parentNode:et}var yb=null,zb=null,Ab=null;function Bb(et){if(et=Cb(et)){if(typeof yb!="function")throw Error(p$1(280));var $=et.stateNode;$&&($=Db($),yb(et.stateNode,et.type,$))}}function Eb(et){zb?Ab?Ab.push(et):Ab=[et]:zb=et}function Fb(){if(zb){var et=zb,$=Ab;if(Ab=zb=null,Bb(et),$)for(et=0;et<$.length;et++)Bb($[et])}}function Gb(et,$){return et($)}function Hb(){}var Ib=!1;function Jb(et,$,_){if(Ib)return et($,_);Ib=!0;try{return Gb(et,$,_)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(et,$){var _=et.stateNode;if(_===null)return null;var tt=Db(_);if(tt===null)return null;_=tt[$];e:switch($){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(tt=!tt.disabled)||(et=et.type,tt=!(et==="button"||et==="input"||et==="select"||et==="textarea")),et=!tt;break e;default:et=!1}if(et)return null;if(_&&typeof _!="function")throw Error(p$1(231,$,typeof _));return _}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(et,$,_,tt,nt,it,rt,ot,lt){var st=Array.prototype.slice.call(arguments,3);try{$.apply(_,st)}catch(at){this.onError(at)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(et){Ob=!0,Pb=et}};function Tb(et,$,_,tt,nt,it,rt,ot,lt){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(et,$,_,tt,nt,it,rt,ot,lt){if(Tb.apply(this,arguments),Ob){if(Ob){var st=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=st)}}function Vb(et){var $=et,_=et;if(et.alternate)for(;$.return;)$=$.return;else{et=$;do $=et,$.flags&4098&&(_=$.return),et=$.return;while(et)}return $.tag===3?_:null}function Wb(et){if(et.tag===13){var $=et.memoizedState;if($===null&&(et=et.alternate,et!==null&&($=et.memoizedState)),$!==null)return $.dehydrated}return null}function Xb(et){if(Vb(et)!==et)throw Error(p$1(188))}function Yb(et){var $=et.alternate;if(!$){if($=Vb(et),$===null)throw Error(p$1(188));return $!==et?null:et}for(var _=et,tt=$;;){var nt=_.return;if(nt===null)break;var it=nt.alternate;if(it===null){if(tt=nt.return,tt!==null){_=tt;continue}break}if(nt.child===it.child){for(it=nt.child;it;){if(it===_)return Xb(nt),et;if(it===tt)return Xb(nt),$;it=it.sibling}throw Error(p$1(188))}if(_.return!==tt.return)_=nt,tt=it;else{for(var rt=!1,ot=nt.child;ot;){if(ot===_){rt=!0,_=nt,tt=it;break}if(ot===tt){rt=!0,tt=nt,_=it;break}ot=ot.sibling}if(!rt){for(ot=it.child;ot;){if(ot===_){rt=!0,_=it,tt=nt;break}if(ot===tt){rt=!0,tt=it,_=nt;break}ot=ot.sibling}if(!rt)throw Error(p$1(189))}}if(_.alternate!==tt)throw Error(p$1(190))}if(_.tag!==3)throw Error(p$1(188));return _.stateNode.current===_?et:$}function Zb(et){return et=Yb(et),et!==null?$b(et):null}function $b(et){if(et.tag===5||et.tag===6)return et;for(et=et.child;et!==null;){var $=$b(et);if($!==null)return $;et=et.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(et){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,et,void 0,(et.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(et){return et>>>=0,et===0?32:31-(pc(et)/qc|0)|0}var rc=64,sc=4194304;function tc(et){switch(et&-et){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return et&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return et&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return et}}function uc(et,$){var _=et.pendingLanes;if(_===0)return 0;var tt=0,nt=et.suspendedLanes,it=et.pingedLanes,rt=_&268435455;if(rt!==0){var ot=rt&~nt;ot!==0?tt=tc(ot):(it&=rt,it!==0&&(tt=tc(it)))}else rt=_&~nt,rt!==0?tt=tc(rt):it!==0&&(tt=tc(it));if(tt===0)return 0;if($!==0&&$!==tt&&!($&nt)&&(nt=tt&-tt,it=$&-$,nt>=it||nt===16&&(it&4194240)!==0))return $;if(tt&4&&(tt|=_&16),$=et.entangledLanes,$!==0)for(et=et.entanglements,$&=tt;0<$;)_=31-oc($),nt=1<<_,tt|=et[_],$&=~nt;return tt}function vc(et,$){switch(et){case 1:case 2:case 4:return $+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return $+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(et,$){for(var _=et.suspendedLanes,tt=et.pingedLanes,nt=et.expirationTimes,it=et.pendingLanes;0<it;){var rt=31-oc(it),ot=1<<rt,lt=nt[rt];lt===-1?(!(ot&_)||ot&tt)&&(nt[rt]=vc(ot,$)):lt<=$&&(et.expiredLanes|=ot),it&=~ot}}function xc(et){return et=et.pendingLanes&-1073741825,et!==0?et:et&1073741824?1073741824:0}function yc(){var et=rc;return rc<<=1,!(rc&4194240)&&(rc=64),et}function zc(et){for(var $=[],_=0;31>_;_++)$.push(et);return $}function Ac(et,$,_){et.pendingLanes|=$,$!==536870912&&(et.suspendedLanes=0,et.pingedLanes=0),et=et.eventTimes,$=31-oc($),et[$]=_}function Bc(et,$){var _=et.pendingLanes&~$;et.pendingLanes=$,et.suspendedLanes=0,et.pingedLanes=0,et.expiredLanes&=$,et.mutableReadLanes&=$,et.entangledLanes&=$,$=et.entanglements;var tt=et.eventTimes;for(et=et.expirationTimes;0<_;){var nt=31-oc(_),it=1<<nt;$[nt]=0,tt[nt]=-1,et[nt]=-1,_&=~it}}function Cc(et,$){var _=et.entangledLanes|=$;for(et=et.entanglements;_;){var tt=31-oc(_),nt=1<<tt;nt&$|et[tt]&$&&(et[tt]|=$),_&=~nt}}var C=0;function Dc(et){return et&=-et,1<et?4<et?et&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(et,$){switch(et){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete($.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete($.pointerId)}}function Tc(et,$,_,tt,nt,it){return et===null||et.nativeEvent!==it?(et={blockedOn:$,domEventName:_,eventSystemFlags:tt,nativeEvent:it,targetContainers:[nt]},$!==null&&($=Cb($),$!==null&&Fc($)),et):(et.eventSystemFlags|=tt,$=et.targetContainers,nt!==null&&$.indexOf(nt)===-1&&$.push(nt),et)}function Uc(et,$,_,tt,nt){switch($){case"focusin":return Lc=Tc(Lc,et,$,_,tt,nt),!0;case"dragenter":return Mc=Tc(Mc,et,$,_,tt,nt),!0;case"mouseover":return Nc=Tc(Nc,et,$,_,tt,nt),!0;case"pointerover":var it=nt.pointerId;return Oc.set(it,Tc(Oc.get(it)||null,et,$,_,tt,nt)),!0;case"gotpointercapture":return it=nt.pointerId,Pc.set(it,Tc(Pc.get(it)||null,et,$,_,tt,nt)),!0}return!1}function Vc(et){var $=Wc(et.target);if($!==null){var _=Vb($);if(_!==null){if($=_.tag,$===13){if($=Wb(_),$!==null){et.blockedOn=$,Ic(et.priority,function(){Gc(_)});return}}else if($===3&&_.stateNode.current.memoizedState.isDehydrated){et.blockedOn=_.tag===3?_.stateNode.containerInfo:null;return}}}et.blockedOn=null}function Xc(et){if(et.blockedOn!==null)return!1;for(var $=et.targetContainers;0<$.length;){var _=Yc(et.domEventName,et.eventSystemFlags,$[0],et.nativeEvent);if(_===null){_=et.nativeEvent;var tt=new _.constructor(_.type,_);wb=tt,_.target.dispatchEvent(tt),wb=null}else return $=Cb(_),$!==null&&Fc($),et.blockedOn=_,!1;$.shift()}return!0}function Zc(et,$,_){Xc(et)&&_.delete($)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(et,$){et.blockedOn===$&&(et.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(et){function $(nt){return ad(nt,et)}if(0<Kc.length){ad(Kc[0],et);for(var _=1;_<Kc.length;_++){var tt=Kc[_];tt.blockedOn===et&&(tt.blockedOn=null)}}for(Lc!==null&&ad(Lc,et),Mc!==null&&ad(Mc,et),Nc!==null&&ad(Nc,et),Oc.forEach($),Pc.forEach($),_=0;_<Qc.length;_++)tt=Qc[_],tt.blockedOn===et&&(tt.blockedOn=null);for(;0<Qc.length&&(_=Qc[0],_.blockedOn===null);)Vc(_),_.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(et,$,_,tt){var nt=C,it=cd.transition;cd.transition=null;try{C=1,fd(et,$,_,tt)}finally{C=nt,cd.transition=it}}function gd(et,$,_,tt){var nt=C,it=cd.transition;cd.transition=null;try{C=4,fd(et,$,_,tt)}finally{C=nt,cd.transition=it}}function fd(et,$,_,tt){if(dd){var nt=Yc(et,$,_,tt);if(nt===null)hd(et,$,tt,id,_),Sc(et,tt);else if(Uc(nt,et,$,_,tt))tt.stopPropagation();else if(Sc(et,tt),$&4&&-1<Rc.indexOf(et)){for(;nt!==null;){var it=Cb(nt);if(it!==null&&Ec(it),it=Yc(et,$,_,tt),it===null&&hd(et,$,tt,id,_),it===nt)break;nt=it}nt!==null&&tt.stopPropagation()}else hd(et,$,tt,null,_)}}var id=null;function Yc(et,$,_,tt){if(id=null,et=xb(tt),et=Wc(et),et!==null)if($=Vb(et),$===null)et=null;else if(_=$.tag,_===13){if(et=Wb($),et!==null)return et;et=null}else if(_===3){if($.stateNode.current.memoizedState.isDehydrated)return $.tag===3?$.stateNode.containerInfo:null;et=null}else $!==et&&(et=null);return id=et,null}function jd(et){switch(et){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var et,$=ld,_=$.length,tt,nt="value"in kd?kd.value:kd.textContent,it=nt.length;for(et=0;et<_&&$[et]===nt[et];et++);var rt=_-et;for(tt=1;tt<=rt&&$[_-tt]===nt[it-tt];tt++);return md=nt.slice(et,1<tt?1-tt:void 0)}function od(et){var $=et.keyCode;return"charCode"in et?(et=et.charCode,et===0&&$===13&&(et=13)):et=$,et===10&&(et=13),32<=et||et===13?et:0}function pd(){return!0}function qd(){return!1}function rd(et){function $(_,tt,nt,it,rt){this._reactName=_,this._targetInst=nt,this.type=tt,this.nativeEvent=it,this.target=rt,this.currentTarget=null;for(var ot in et)et.hasOwnProperty(ot)&&(_=et[ot],this[ot]=_?_(it):it[ot]);return this.isDefaultPrevented=(it.defaultPrevented!=null?it.defaultPrevented:it.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A($.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _=this.nativeEvent;_&&(_.preventDefault?_.preventDefault():typeof _.returnValue!="unknown"&&(_.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var _=this.nativeEvent;_&&(_.stopPropagation?_.stopPropagation():typeof _.cancelBubble!="unknown"&&(_.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),$}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(et){return et.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(et){return et.relatedTarget===void 0?et.fromElement===et.srcElement?et.toElement:et.fromElement:et.relatedTarget},movementX:function(et){return"movementX"in et?et.movementX:(et!==yd&&(yd&&et.type==="mousemove"?(wd=et.screenX-yd.screenX,xd=et.screenY-yd.screenY):xd=wd=0,yd=et),wd)},movementY:function(et){return"movementY"in et?et.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(et){return"clipboardData"in et?et.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(et){var $=this.nativeEvent;return $.getModifierState?$.getModifierState(et):(et=Od[et])?!!$[et]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(et){if(et.key){var $=Md[et.key]||et.key;if($!=="Unidentified")return $}return et.type==="keypress"?(et=od(et),et===13?"Enter":String.fromCharCode(et)):et.type==="keydown"||et.type==="keyup"?Nd[et.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(et){return et.type==="keypress"?od(et):0},keyCode:function(et){return et.type==="keydown"||et.type==="keyup"?et.keyCode:0},which:function(et){return et.type==="keypress"?od(et):et.type==="keydown"||et.type==="keyup"?et.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(et){return"deltaX"in et?et.deltaX:"wheelDeltaX"in et?-et.wheelDeltaX:0},deltaY:function(et){return"deltaY"in et?et.deltaY:"wheelDeltaY"in et?-et.wheelDeltaY:"wheelDelta"in et?-et.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=String.fromCharCode(32),fe=!1;function ge(et,$){switch(et){case"keyup":return $d.indexOf($.keyCode)!==-1;case"keydown":return $.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(et){return et=et.detail,typeof et=="object"&&"data"in et?et.data:null}var ie=!1;function je(et,$){switch(et){case"compositionend":return he($);case"keypress":return $.which!==32?null:(fe=!0,ee);case"textInput":return et=$.data,et===ee&&fe?null:et;default:return null}}function ke(et,$){if(ie)return et==="compositionend"||!ae&&ge(et,$)?(et=nd(),md=ld=kd=null,ie=!1,et):null;switch(et){case"paste":return null;case"keypress":if(!($.ctrlKey||$.altKey||$.metaKey)||$.ctrlKey&&$.altKey){if($.char&&1<$.char.length)return $.char;if($.which)return String.fromCharCode($.which)}return null;case"compositionend":return de&&$.locale!=="ko"?null:$.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(et){var $=et&&et.nodeName&&et.nodeName.toLowerCase();return $==="input"?!!le[et.type]:$==="textarea"}function ne(et,$,_,tt){Eb(tt),$=oe($,"onChange"),0<$.length&&(_=new td("onChange","change",null,_,tt),et.push({event:_,listeners:$}))}var pe=null,qe=null;function re(et){se(et,0)}function te(et){var $=ue(et);if(Wa($))return et}function ve(et,$){if(et==="change")return $}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(et){if(et.propertyName==="value"&&te(qe)){var $=[];ne($,qe,et,xb(et)),Jb(re,$)}}function Ce(et,$,_){et==="focusin"?(Ae(),pe=$,qe=_,pe.attachEvent("onpropertychange",Be)):et==="focusout"&&Ae()}function De(et){if(et==="selectionchange"||et==="keyup"||et==="keydown")return te(qe)}function Ee(et,$){if(et==="click")return te($)}function Fe(et,$){if(et==="input"||et==="change")return te($)}function Ge(et,$){return et===$&&(et!==0||1/et===1/$)||et!==et&&$!==$}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(et,$){if(He(et,$))return!0;if(typeof et!="object"||et===null||typeof $!="object"||$===null)return!1;var _=Object.keys(et),tt=Object.keys($);if(_.length!==tt.length)return!1;for(tt=0;tt<_.length;tt++){var nt=_[tt];if(!ja.call($,nt)||!He(et[nt],$[nt]))return!1}return!0}function Je(et){for(;et&&et.firstChild;)et=et.firstChild;return et}function Ke(et,$){var _=Je(et);et=0;for(var tt;_;){if(_.nodeType===3){if(tt=et+_.textContent.length,et<=$&&tt>=$)return{node:_,offset:$-et};et=tt}e:{for(;_;){if(_.nextSibling){_=_.nextSibling;break e}_=_.parentNode}_=void 0}_=Je(_)}}function Le(et,$){return et&&$?et===$?!0:et&&et.nodeType===3?!1:$&&$.nodeType===3?Le(et,$.parentNode):"contains"in et?et.contains($):et.compareDocumentPosition?!!(et.compareDocumentPosition($)&16):!1:!1}function Me(){for(var et=window,$=Xa();$ instanceof et.HTMLIFrameElement;){try{var _=typeof $.contentWindow.location.href=="string"}catch{_=!1}if(_)et=$.contentWindow;else break;$=Xa(et.document)}return $}function Ne(et){var $=et&&et.nodeName&&et.nodeName.toLowerCase();return $&&($==="input"&&(et.type==="text"||et.type==="search"||et.type==="tel"||et.type==="url"||et.type==="password")||$==="textarea"||et.contentEditable==="true")}function Oe(et){var $=Me(),_=et.focusedElem,tt=et.selectionRange;if($!==_&&_&&_.ownerDocument&&Le(_.ownerDocument.documentElement,_)){if(tt!==null&&Ne(_)){if($=tt.start,et=tt.end,et===void 0&&(et=$),"selectionStart"in _)_.selectionStart=$,_.selectionEnd=Math.min(et,_.value.length);else if(et=($=_.ownerDocument||document)&&$.defaultView||window,et.getSelection){et=et.getSelection();var nt=_.textContent.length,it=Math.min(tt.start,nt);tt=tt.end===void 0?it:Math.min(tt.end,nt),!et.extend&&it>tt&&(nt=tt,tt=it,it=nt),nt=Ke(_,it);var rt=Ke(_,tt);nt&&rt&&(et.rangeCount!==1||et.anchorNode!==nt.node||et.anchorOffset!==nt.offset||et.focusNode!==rt.node||et.focusOffset!==rt.offset)&&($=$.createRange(),$.setStart(nt.node,nt.offset),et.removeAllRanges(),it>tt?(et.addRange($),et.extend(rt.node,rt.offset)):($.setEnd(rt.node,rt.offset),et.addRange($)))}}for($=[],et=_;et=et.parentNode;)et.nodeType===1&&$.push({element:et,left:et.scrollLeft,top:et.scrollTop});for(typeof _.focus=="function"&&_.focus(),_=0;_<$.length;_++)et=$[_],et.element.scrollLeft=et.left,et.element.scrollTop=et.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(et,$,_){var tt=_.window===_?_.document:_.nodeType===9?_:_.ownerDocument;Te||Qe==null||Qe!==Xa(tt)||(tt=Qe,"selectionStart"in tt&&Ne(tt)?tt={start:tt.selectionStart,end:tt.selectionEnd}:(tt=(tt.ownerDocument&&tt.ownerDocument.defaultView||window).getSelection(),tt={anchorNode:tt.anchorNode,anchorOffset:tt.anchorOffset,focusNode:tt.focusNode,focusOffset:tt.focusOffset}),Se&&Ie(Se,tt)||(Se=tt,tt=oe(Re,"onSelect"),0<tt.length&&($=new td("onSelect","select",null,$,_),et.push({event:$,listeners:tt}),$.target=Qe)))}function Ve(et,$){var _={};return _[et.toLowerCase()]=$.toLowerCase(),_["Webkit"+et]="webkit"+$,_["Moz"+et]="moz"+$,_}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(et){if(Xe[et])return Xe[et];if(!We[et])return et;var $=We[et],_;for(_ in $)if($.hasOwnProperty(_)&&_ in Ye)return Xe[et]=$[_];return et}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(et,$){df.set(et,$),fa($,[et])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(et,$,_){var tt=et.type||"unknown-event";et.currentTarget=_,Ub(tt,$,void 0,et),et.currentTarget=null}function se(et,$){$=($&4)!==0;for(var _=0;_<et.length;_++){var tt=et[_],nt=tt.event;tt=tt.listeners;e:{var it=void 0;if($)for(var rt=tt.length-1;0<=rt;rt--){var ot=tt[rt],lt=ot.instance,st=ot.currentTarget;if(ot=ot.listener,lt!==it&&nt.isPropagationStopped())break e;nf(nt,ot,st),it=lt}else for(rt=0;rt<tt.length;rt++){if(ot=tt[rt],lt=ot.instance,st=ot.currentTarget,ot=ot.listener,lt!==it&&nt.isPropagationStopped())break e;nf(nt,ot,st),it=lt}}}if(Qb)throw et=Rb,Qb=!1,Rb=null,et}function D(et,$){var _=$[of];_===void 0&&(_=$[of]=new Set);var tt=et+"__bubble";_.has(tt)||(pf($,et,2,!1),_.add(tt))}function qf(et,$,_){var tt=0;$&&(tt|=4),pf(_,et,tt,$)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(et){if(!et[rf]){et[rf]=!0,da.forEach(function(_){_!=="selectionchange"&&(mf.has(_)||qf(_,!1,et),qf(_,!0,et))});var $=et.nodeType===9?et:et.ownerDocument;$===null||$[rf]||($[rf]=!0,qf("selectionchange",!1,$))}}function pf(et,$,_,tt){switch(jd($)){case 1:var nt=ed;break;case 4:nt=gd;break;default:nt=fd}_=nt.bind(null,$,_,et),nt=void 0,!Lb||$!=="touchstart"&&$!=="touchmove"&&$!=="wheel"||(nt=!0),tt?nt!==void 0?et.addEventListener($,_,{capture:!0,passive:nt}):et.addEventListener($,_,!0):nt!==void 0?et.addEventListener($,_,{passive:nt}):et.addEventListener($,_,!1)}function hd(et,$,_,tt,nt){var it=tt;if(!($&1)&&!($&2)&&tt!==null)e:for(;;){if(tt===null)return;var rt=tt.tag;if(rt===3||rt===4){var ot=tt.stateNode.containerInfo;if(ot===nt||ot.nodeType===8&&ot.parentNode===nt)break;if(rt===4)for(rt=tt.return;rt!==null;){var lt=rt.tag;if((lt===3||lt===4)&&(lt=rt.stateNode.containerInfo,lt===nt||lt.nodeType===8&&lt.parentNode===nt))return;rt=rt.return}for(;ot!==null;){if(rt=Wc(ot),rt===null)return;if(lt=rt.tag,lt===5||lt===6){tt=it=rt;continue e}ot=ot.parentNode}}tt=tt.return}Jb(function(){var st=it,at=xb(_),ct=[];e:{var dt=df.get(et);if(dt!==void 0){var ut=td,ft=et;switch(et){case"keypress":if(od(_)===0)break e;case"keydown":case"keyup":ut=Rd;break;case"focusin":ft="focus",ut=Fd;break;case"focusout":ft="blur",ut=Fd;break;case"beforeblur":case"afterblur":ut=Fd;break;case"click":if(_.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ut=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ut=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ut=Vd;break;case $e:case af:case bf:ut=Hd;break;case cf:ut=Xd;break;case"scroll":ut=vd;break;case"wheel":ut=Zd;break;case"copy":case"cut":case"paste":ut=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ut=Td}var pt=($&4)!==0,St=!pt&&et==="scroll",gt=pt?dt!==null?dt+"Capture":null:dt;pt=[];for(var yt=st,vt;yt!==null;){vt=yt;var Ct=vt.stateNode;if(vt.tag===5&&Ct!==null&&(vt=Ct,gt!==null&&(Ct=Kb(yt,gt),Ct!=null&&pt.push(tf(yt,Ct,vt)))),St)break;yt=yt.return}0<pt.length&&(dt=new ut(dt,ft,null,_,at),ct.push({event:dt,listeners:pt}))}}if(!($&7)){e:{if(dt=et==="mouseover"||et==="pointerover",ut=et==="mouseout"||et==="pointerout",dt&&_!==wb&&(ft=_.relatedTarget||_.fromElement)&&(Wc(ft)||ft[uf]))break e;if((ut||dt)&&(dt=at.window===at?at:(dt=at.ownerDocument)?dt.defaultView||dt.parentWindow:window,ut?(ft=_.relatedTarget||_.toElement,ut=st,ft=ft?Wc(ft):null,ft!==null&&(St=Vb(ft),ft!==St||ft.tag!==5&&ft.tag!==6)&&(ft=null)):(ut=null,ft=st),ut!==ft)){if(pt=Bd,Ct="onMouseLeave",gt="onMouseEnter",yt="mouse",(et==="pointerout"||et==="pointerover")&&(pt=Td,Ct="onPointerLeave",gt="onPointerEnter",yt="pointer"),St=ut==null?dt:ue(ut),vt=ft==null?dt:ue(ft),dt=new pt(Ct,yt+"leave",ut,_,at),dt.target=St,dt.relatedTarget=vt,Ct=null,Wc(at)===st&&(pt=new pt(gt,yt+"enter",ft,_,at),pt.target=vt,pt.relatedTarget=St,Ct=pt),St=Ct,ut&&ft)t:{for(pt=ut,gt=ft,yt=0,vt=pt;vt;vt=vf(vt))yt++;for(vt=0,Ct=gt;Ct;Ct=vf(Ct))vt++;for(;0<yt-vt;)pt=vf(pt),yt--;for(;0<vt-yt;)gt=vf(gt),vt--;for(;yt--;){if(pt===gt||gt!==null&&pt===gt.alternate)break t;pt=vf(pt),gt=vf(gt)}pt=null}else pt=null;ut!==null&&wf(ct,dt,ut,pt,!1),ft!==null&&St!==null&&wf(ct,St,ft,pt,!0)}}e:{if(dt=st?ue(st):window,ut=dt.nodeName&&dt.nodeName.toLowerCase(),ut==="select"||ut==="input"&&dt.type==="file")var Et=ve;else if(me(dt))if(we)Et=Fe;else{Et=De;var Mt=Ce}else(ut=dt.nodeName)&&ut.toLowerCase()==="input"&&(dt.type==="checkbox"||dt.type==="radio")&&(Et=Ee);if(Et&&(Et=Et(et,st))){ne(ct,Et,_,at);break e}Mt&&Mt(et,dt,st),et==="focusout"&&(Mt=dt._wrapperState)&&Mt.controlled&&dt.type==="number"&&cb(dt,"number",dt.value)}switch(Mt=st?ue(st):window,et){case"focusin":(me(Mt)||Mt.contentEditable==="true")&&(Qe=Mt,Re=st,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(ct,_,at);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(ct,_,at)}var Rt;if(ae)e:{switch(et){case"compositionstart":var At="onCompositionStart";break e;case"compositionend":At="onCompositionEnd";break e;case"compositionupdate":At="onCompositionUpdate";break e}At=void 0}else ie?ge(et,_)&&(At="onCompositionEnd"):et==="keydown"&&_.keyCode===229&&(At="onCompositionStart");At&&(de&&_.locale!=="ko"&&(ie||At!=="onCompositionStart"?At==="onCompositionEnd"&&ie&&(Rt=nd()):(kd=at,ld="value"in kd?kd.value:kd.textContent,ie=!0)),Mt=oe(st,At),0<Mt.length&&(At=new Ld(At,et,null,_,at),ct.push({event:At,listeners:Mt}),Rt?At.data=Rt:(Rt=he(_),Rt!==null&&(At.data=Rt)))),(Rt=ce?je(et,_):ke(et,_))&&(st=oe(st,"onBeforeInput"),0<st.length&&(at=new Ld("onBeforeInput","beforeinput",null,_,at),ct.push({event:at,listeners:st}),at.data=Rt))}se(ct,$)})}function tf(et,$,_){return{instance:et,listener:$,currentTarget:_}}function oe(et,$){for(var _=$+"Capture",tt=[];et!==null;){var nt=et,it=nt.stateNode;nt.tag===5&&it!==null&&(nt=it,it=Kb(et,_),it!=null&&tt.unshift(tf(et,it,nt)),it=Kb(et,$),it!=null&&tt.push(tf(et,it,nt))),et=et.return}return tt}function vf(et){if(et===null)return null;do et=et.return;while(et&&et.tag!==5);return et||null}function wf(et,$,_,tt,nt){for(var it=$._reactName,rt=[];_!==null&&_!==tt;){var ot=_,lt=ot.alternate,st=ot.stateNode;if(lt!==null&&lt===tt)break;ot.tag===5&&st!==null&&(ot=st,nt?(lt=Kb(_,it),lt!=null&&rt.unshift(tf(_,lt,ot))):nt||(lt=Kb(_,it),lt!=null&&rt.push(tf(_,lt,ot)))),_=_.return}rt.length!==0&&et.push({event:$,listeners:rt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(et){return(typeof et=="string"?et:""+et).replace(xf,`
`).replace(yf,"")}function Af(et,$,_){if($=zf($),zf(et)!==$&&_)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef(et,$){return et==="textarea"||et==="noscript"||typeof $.children=="string"||typeof $.children=="number"||typeof $.dangerouslySetInnerHTML=="object"&&$.dangerouslySetInnerHTML!==null&&$.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(et){return Hf.resolve(null).then(et).catch(If)}:Ff;function If(et){setTimeout(function(){throw et})}function Kf(et,$){var _=$,tt=0;do{var nt=_.nextSibling;if(et.removeChild(_),nt&&nt.nodeType===8)if(_=nt.data,_==="/$"){if(tt===0){et.removeChild(nt),bd($);return}tt--}else _!=="$"&&_!=="$?"&&_!=="$!"||tt++;_=nt}while(_);bd($)}function Lf(et){for(;et!=null;et=et.nextSibling){var $=et.nodeType;if($===1||$===3)break;if($===8){if($=et.data,$==="$"||$==="$!"||$==="$?")break;if($==="/$")return null}}return et}function Mf(et){et=et.previousSibling;for(var $=0;et;){if(et.nodeType===8){var _=et.data;if(_==="$"||_==="$!"||_==="$?"){if($===0)return et;$--}else _==="/$"&&$++}et=et.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(et){var $=et[Of];if($)return $;for(var _=et.parentNode;_;){if($=_[uf]||_[Of]){if(_=$.alternate,$.child!==null||_!==null&&_.child!==null)for(et=Mf(et);et!==null;){if(_=et[Of])return _;et=Mf(et)}return $}et=_,_=et.parentNode}return null}function Cb(et){return et=et[Of]||et[uf],!et||et.tag!==5&&et.tag!==6&&et.tag!==13&&et.tag!==3?null:et}function ue(et){if(et.tag===5||et.tag===6)return et.stateNode;throw Error(p$1(33))}function Db(et){return et[Pf]||null}var Sf=[],Tf=-1;function Uf(et){return{current:et}}function E(et){0>Tf||(et.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(et,$){Tf++,Sf[Tf]=et.current,et.current=$}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(et,$){var _=et.type.contextTypes;if(!_)return Vf;var tt=et.stateNode;if(tt&&tt.__reactInternalMemoizedUnmaskedChildContext===$)return tt.__reactInternalMemoizedMaskedChildContext;var nt={},it;for(it in _)nt[it]=$[it];return tt&&(et=et.stateNode,et.__reactInternalMemoizedUnmaskedChildContext=$,et.__reactInternalMemoizedMaskedChildContext=nt),nt}function Zf(et){return et=et.childContextTypes,et!=null}function $f(){E(Wf),E(H)}function ag(et,$,_){if(H.current!==Vf)throw Error(p$1(168));G(H,$),G(Wf,_)}function bg(et,$,_){var tt=et.stateNode;if($=$.childContextTypes,typeof tt.getChildContext!="function")return _;tt=tt.getChildContext();for(var nt in tt)if(!(nt in $))throw Error(p$1(108,Ra(et)||"Unknown",nt));return A({},_,tt)}function cg(et){return et=(et=et.stateNode)&&et.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,et),G(Wf,Wf.current),!0}function dg(et,$,_){var tt=et.stateNode;if(!tt)throw Error(p$1(169));_?(et=bg(et,$,Xf),tt.__reactInternalMemoizedMergedChildContext=et,E(Wf),E(H),G(H,et)):E(Wf),G(Wf,_)}var eg=null,fg=!1,gg=!1;function hg(et){eg===null?eg=[et]:eg.push(et)}function ig(et){fg=!0,hg(et)}function jg(){if(!gg&&eg!==null){gg=!0;var et=0,$=C;try{var _=eg;for(C=1;et<_.length;et++){var tt=_[et];do tt=tt(!0);while(tt!==null)}eg=null,fg=!1}catch(nt){throw eg!==null&&(eg=eg.slice(et+1)),ac(fc,jg),nt}finally{C=$,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(et,$){kg[lg++]=ng,kg[lg++]=mg,mg=et,ng=$}function ug(et,$,_){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=et;var tt=rg;et=sg;var nt=32-oc(tt)-1;tt&=~(1<<nt),_+=1;var it=32-oc($)+nt;if(30<it){var rt=nt-nt%5;it=(tt&(1<<rt)-1).toString(32),tt>>=rt,nt-=rt,rg=1<<32-oc($)+nt|_<<nt|tt,sg=it+et}else rg=1<<it|_<<nt|tt,sg=et}function vg(et){et.return!==null&&(tg(et,1),ug(et,1,0))}function wg(et){for(;et===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;et===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(et,$){var _=Bg(5,null,null,0);_.elementType="DELETED",_.stateNode=$,_.return=et,$=et.deletions,$===null?(et.deletions=[_],et.flags|=16):$.push(_)}function Cg(et,$){switch(et.tag){case 5:var _=et.type;return $=$.nodeType!==1||_.toLowerCase()!==$.nodeName.toLowerCase()?null:$,$!==null?(et.stateNode=$,xg=et,yg=Lf($.firstChild),!0):!1;case 6:return $=et.pendingProps===""||$.nodeType!==3?null:$,$!==null?(et.stateNode=$,xg=et,yg=null,!0):!1;case 13:return $=$.nodeType!==8?null:$,$!==null?(_=qg!==null?{id:rg,overflow:sg}:null,et.memoizedState={dehydrated:$,treeContext:_,retryLane:1073741824},_=Bg(18,null,null,0),_.stateNode=$,_.return=et,et.child=_,xg=et,yg=null,!0):!1;default:return!1}}function Dg(et){return(et.mode&1)!==0&&(et.flags&128)===0}function Eg(et){if(I){var $=yg;if($){var _=$;if(!Cg(et,$)){if(Dg(et))throw Error(p$1(418));$=Lf(_.nextSibling);var tt=xg;$&&Cg(et,$)?Ag(tt,_):(et.flags=et.flags&-4097|2,I=!1,xg=et)}}else{if(Dg(et))throw Error(p$1(418));et.flags=et.flags&-4097|2,I=!1,xg=et}}}function Fg(et){for(et=et.return;et!==null&&et.tag!==5&&et.tag!==3&&et.tag!==13;)et=et.return;xg=et}function Gg(et){if(et!==xg)return!1;if(!I)return Fg(et),I=!0,!1;var $;if(($=et.tag!==3)&&!($=et.tag!==5)&&($=et.type,$=$!=="head"&&$!=="body"&&!Ef(et.type,et.memoizedProps)),$&&($=yg)){if(Dg(et))throw Hg(),Error(p$1(418));for(;$;)Ag(et,$),$=Lf($.nextSibling)}if(Fg(et),et.tag===13){if(et=et.memoizedState,et=et!==null?et.dehydrated:null,!et)throw Error(p$1(317));e:{for(et=et.nextSibling,$=0;et;){if(et.nodeType===8){var _=et.data;if(_==="/$"){if($===0){yg=Lf(et.nextSibling);break e}$--}else _!=="$"&&_!=="$!"&&_!=="$?"||$++}et=et.nextSibling}yg=null}}else yg=xg?Lf(et.stateNode.nextSibling):null;return!0}function Hg(){for(var et=yg;et;)et=Lf(et.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(et){zg===null?zg=[et]:zg.push(et)}var Kg=ua.ReactCurrentBatchConfig;function Lg(et,$,_){if(et=_.ref,et!==null&&typeof et!="function"&&typeof et!="object"){if(_._owner){if(_=_._owner,_){if(_.tag!==1)throw Error(p$1(309));var tt=_.stateNode}if(!tt)throw Error(p$1(147,et));var nt=tt,it=""+et;return $!==null&&$.ref!==null&&typeof $.ref=="function"&&$.ref._stringRef===it?$.ref:($=function(rt){var ot=nt.refs;rt===null?delete ot[it]:ot[it]=rt},$._stringRef=it,$)}if(typeof et!="string")throw Error(p$1(284));if(!_._owner)throw Error(p$1(290,et))}return et}function Mg(et,$){throw et=Object.prototype.toString.call($),Error(p$1(31,et==="[object Object]"?"object with keys {"+Object.keys($).join(", ")+"}":et))}function Ng(et){var $=et._init;return $(et._payload)}function Og(et){function $(gt,yt){if(et){var vt=gt.deletions;vt===null?(gt.deletions=[yt],gt.flags|=16):vt.push(yt)}}function _(gt,yt){if(!et)return null;for(;yt!==null;)$(gt,yt),yt=yt.sibling;return null}function tt(gt,yt){for(gt=new Map;yt!==null;)yt.key!==null?gt.set(yt.key,yt):gt.set(yt.index,yt),yt=yt.sibling;return gt}function nt(gt,yt){return gt=Pg(gt,yt),gt.index=0,gt.sibling=null,gt}function it(gt,yt,vt){return gt.index=vt,et?(vt=gt.alternate,vt!==null?(vt=vt.index,vt<yt?(gt.flags|=2,yt):vt):(gt.flags|=2,yt)):(gt.flags|=1048576,yt)}function rt(gt){return et&&gt.alternate===null&&(gt.flags|=2),gt}function ot(gt,yt,vt,Ct){return yt===null||yt.tag!==6?(yt=Qg(vt,gt.mode,Ct),yt.return=gt,yt):(yt=nt(yt,vt),yt.return=gt,yt)}function lt(gt,yt,vt,Ct){var Et=vt.type;return Et===ya?at(gt,yt,vt.props.children,Ct,vt.key):yt!==null&&(yt.elementType===Et||typeof Et=="object"&&Et!==null&&Et.$$typeof===Ha&&Ng(Et)===yt.type)?(Ct=nt(yt,vt.props),Ct.ref=Lg(gt,yt,vt),Ct.return=gt,Ct):(Ct=Rg(vt.type,vt.key,vt.props,null,gt.mode,Ct),Ct.ref=Lg(gt,yt,vt),Ct.return=gt,Ct)}function st(gt,yt,vt,Ct){return yt===null||yt.tag!==4||yt.stateNode.containerInfo!==vt.containerInfo||yt.stateNode.implementation!==vt.implementation?(yt=Sg(vt,gt.mode,Ct),yt.return=gt,yt):(yt=nt(yt,vt.children||[]),yt.return=gt,yt)}function at(gt,yt,vt,Ct,Et){return yt===null||yt.tag!==7?(yt=Tg(vt,gt.mode,Ct,Et),yt.return=gt,yt):(yt=nt(yt,vt),yt.return=gt,yt)}function ct(gt,yt,vt){if(typeof yt=="string"&&yt!==""||typeof yt=="number")return yt=Qg(""+yt,gt.mode,vt),yt.return=gt,yt;if(typeof yt=="object"&&yt!==null){switch(yt.$$typeof){case va:return vt=Rg(yt.type,yt.key,yt.props,null,gt.mode,vt),vt.ref=Lg(gt,null,yt),vt.return=gt,vt;case wa:return yt=Sg(yt,gt.mode,vt),yt.return=gt,yt;case Ha:var Ct=yt._init;return ct(gt,Ct(yt._payload),vt)}if(eb(yt)||Ka(yt))return yt=Tg(yt,gt.mode,vt,null),yt.return=gt,yt;Mg(gt,yt)}return null}function dt(gt,yt,vt,Ct){var Et=yt!==null?yt.key:null;if(typeof vt=="string"&&vt!==""||typeof vt=="number")return Et!==null?null:ot(gt,yt,""+vt,Ct);if(typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case va:return vt.key===Et?lt(gt,yt,vt,Ct):null;case wa:return vt.key===Et?st(gt,yt,vt,Ct):null;case Ha:return Et=vt._init,dt(gt,yt,Et(vt._payload),Ct)}if(eb(vt)||Ka(vt))return Et!==null?null:at(gt,yt,vt,Ct,null);Mg(gt,vt)}return null}function ut(gt,yt,vt,Ct,Et){if(typeof Ct=="string"&&Ct!==""||typeof Ct=="number")return gt=gt.get(vt)||null,ot(yt,gt,""+Ct,Et);if(typeof Ct=="object"&&Ct!==null){switch(Ct.$$typeof){case va:return gt=gt.get(Ct.key===null?vt:Ct.key)||null,lt(yt,gt,Ct,Et);case wa:return gt=gt.get(Ct.key===null?vt:Ct.key)||null,st(yt,gt,Ct,Et);case Ha:var Mt=Ct._init;return ut(gt,yt,vt,Mt(Ct._payload),Et)}if(eb(Ct)||Ka(Ct))return gt=gt.get(vt)||null,at(yt,gt,Ct,Et,null);Mg(yt,Ct)}return null}function ft(gt,yt,vt,Ct){for(var Et=null,Mt=null,Rt=yt,At=yt=0,Dt=null;Rt!==null&&At<vt.length;At++){Rt.index>At?(Dt=Rt,Rt=null):Dt=Rt.sibling;var It=dt(gt,Rt,vt[At],Ct);if(It===null){Rt===null&&(Rt=Dt);break}et&&Rt&&It.alternate===null&&$(gt,Rt),yt=it(It,yt,At),Mt===null?Et=It:Mt.sibling=It,Mt=It,Rt=Dt}if(At===vt.length)return _(gt,Rt),I&&tg(gt,At),Et;if(Rt===null){for(;At<vt.length;At++)Rt=ct(gt,vt[At],Ct),Rt!==null&&(yt=it(Rt,yt,At),Mt===null?Et=Rt:Mt.sibling=Rt,Mt=Rt);return I&&tg(gt,At),Et}for(Rt=tt(gt,Rt);At<vt.length;At++)Dt=ut(Rt,gt,At,vt[At],Ct),Dt!==null&&(et&&Dt.alternate!==null&&Rt.delete(Dt.key===null?At:Dt.key),yt=it(Dt,yt,At),Mt===null?Et=Dt:Mt.sibling=Dt,Mt=Dt);return et&&Rt.forEach(function(Vt){return $(gt,Vt)}),I&&tg(gt,At),Et}function pt(gt,yt,vt,Ct){var Et=Ka(vt);if(typeof Et!="function")throw Error(p$1(150));if(vt=Et.call(vt),vt==null)throw Error(p$1(151));for(var Mt=Et=null,Rt=yt,At=yt=0,Dt=null,It=vt.next();Rt!==null&&!It.done;At++,It=vt.next()){Rt.index>At?(Dt=Rt,Rt=null):Dt=Rt.sibling;var Vt=dt(gt,Rt,It.value,Ct);if(Vt===null){Rt===null&&(Rt=Dt);break}et&&Rt&&Vt.alternate===null&&$(gt,Rt),yt=it(Vt,yt,At),Mt===null?Et=Vt:Mt.sibling=Vt,Mt=Vt,Rt=Dt}if(It.done)return _(gt,Rt),I&&tg(gt,At),Et;if(Rt===null){for(;!It.done;At++,It=vt.next())It=ct(gt,It.value,Ct),It!==null&&(yt=it(It,yt,At),Mt===null?Et=It:Mt.sibling=It,Mt=It);return I&&tg(gt,At),Et}for(Rt=tt(gt,Rt);!It.done;At++,It=vt.next())It=ut(Rt,gt,At,It.value,Ct),It!==null&&(et&&It.alternate!==null&&Rt.delete(It.key===null?At:It.key),yt=it(It,yt,At),Mt===null?Et=It:Mt.sibling=It,Mt=It);return et&&Rt.forEach(function(jt){return $(gt,jt)}),I&&tg(gt,At),Et}function St(gt,yt,vt,Ct){if(typeof vt=="object"&&vt!==null&&vt.type===ya&&vt.key===null&&(vt=vt.props.children),typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case va:e:{for(var Et=vt.key,Mt=yt;Mt!==null;){if(Mt.key===Et){if(Et=vt.type,Et===ya){if(Mt.tag===7){_(gt,Mt.sibling),yt=nt(Mt,vt.props.children),yt.return=gt,gt=yt;break e}}else if(Mt.elementType===Et||typeof Et=="object"&&Et!==null&&Et.$$typeof===Ha&&Ng(Et)===Mt.type){_(gt,Mt.sibling),yt=nt(Mt,vt.props),yt.ref=Lg(gt,Mt,vt),yt.return=gt,gt=yt;break e}_(gt,Mt);break}else $(gt,Mt);Mt=Mt.sibling}vt.type===ya?(yt=Tg(vt.props.children,gt.mode,Ct,vt.key),yt.return=gt,gt=yt):(Ct=Rg(vt.type,vt.key,vt.props,null,gt.mode,Ct),Ct.ref=Lg(gt,yt,vt),Ct.return=gt,gt=Ct)}return rt(gt);case wa:e:{for(Mt=vt.key;yt!==null;){if(yt.key===Mt)if(yt.tag===4&&yt.stateNode.containerInfo===vt.containerInfo&&yt.stateNode.implementation===vt.implementation){_(gt,yt.sibling),yt=nt(yt,vt.children||[]),yt.return=gt,gt=yt;break e}else{_(gt,yt);break}else $(gt,yt);yt=yt.sibling}yt=Sg(vt,gt.mode,Ct),yt.return=gt,gt=yt}return rt(gt);case Ha:return Mt=vt._init,St(gt,yt,Mt(vt._payload),Ct)}if(eb(vt))return ft(gt,yt,vt,Ct);if(Ka(vt))return pt(gt,yt,vt,Ct);Mg(gt,vt)}return typeof vt=="string"&&vt!==""||typeof vt=="number"?(vt=""+vt,yt!==null&&yt.tag===6?(_(gt,yt.sibling),yt=nt(yt,vt),yt.return=gt,gt=yt):(_(gt,yt),yt=Qg(vt,gt.mode,Ct),yt.return=gt,gt=yt),rt(gt)):_(gt,yt)}return St}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(et){var $=Wg.current;E(Wg),et._currentValue=$}function bh(et,$,_){for(;et!==null;){var tt=et.alternate;if((et.childLanes&$)!==$?(et.childLanes|=$,tt!==null&&(tt.childLanes|=$)):tt!==null&&(tt.childLanes&$)!==$&&(tt.childLanes|=$),et===_)break;et=et.return}}function ch(et,$){Xg=et,Zg=Yg=null,et=et.dependencies,et!==null&&et.firstContext!==null&&(et.lanes&$&&(dh=!0),et.firstContext=null)}function eh(et){var $=et._currentValue;if(Zg!==et)if(et={context:et,memoizedValue:$,next:null},Yg===null){if(Xg===null)throw Error(p$1(308));Yg=et,Xg.dependencies={lanes:0,firstContext:et}}else Yg=Yg.next=et;return $}var fh=null;function gh(et){fh===null?fh=[et]:fh.push(et)}function hh(et,$,_,tt){var nt=$.interleaved;return nt===null?(_.next=_,gh($)):(_.next=nt.next,nt.next=_),$.interleaved=_,ih(et,tt)}function ih(et,$){et.lanes|=$;var _=et.alternate;for(_!==null&&(_.lanes|=$),_=et,et=et.return;et!==null;)et.childLanes|=$,_=et.alternate,_!==null&&(_.childLanes|=$),_=et,et=et.return;return _.tag===3?_.stateNode:null}var jh=!1;function kh(et){et.updateQueue={baseState:et.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(et,$){et=et.updateQueue,$.updateQueue===et&&($.updateQueue={baseState:et.baseState,firstBaseUpdate:et.firstBaseUpdate,lastBaseUpdate:et.lastBaseUpdate,shared:et.shared,effects:et.effects})}function mh(et,$){return{eventTime:et,lane:$,tag:0,payload:null,callback:null,next:null}}function nh(et,$,_){var tt=et.updateQueue;if(tt===null)return null;if(tt=tt.shared,K&2){var nt=tt.pending;return nt===null?$.next=$:($.next=nt.next,nt.next=$),tt.pending=$,ih(et,_)}return nt=tt.interleaved,nt===null?($.next=$,gh(tt)):($.next=nt.next,nt.next=$),tt.interleaved=$,ih(et,_)}function oh(et,$,_){if($=$.updateQueue,$!==null&&($=$.shared,(_&4194240)!==0)){var tt=$.lanes;tt&=et.pendingLanes,_|=tt,$.lanes=_,Cc(et,_)}}function ph(et,$){var _=et.updateQueue,tt=et.alternate;if(tt!==null&&(tt=tt.updateQueue,_===tt)){var nt=null,it=null;if(_=_.firstBaseUpdate,_!==null){do{var rt={eventTime:_.eventTime,lane:_.lane,tag:_.tag,payload:_.payload,callback:_.callback,next:null};it===null?nt=it=rt:it=it.next=rt,_=_.next}while(_!==null);it===null?nt=it=$:it=it.next=$}else nt=it=$;_={baseState:tt.baseState,firstBaseUpdate:nt,lastBaseUpdate:it,shared:tt.shared,effects:tt.effects},et.updateQueue=_;return}et=_.lastBaseUpdate,et===null?_.firstBaseUpdate=$:et.next=$,_.lastBaseUpdate=$}function qh(et,$,_,tt){var nt=et.updateQueue;jh=!1;var it=nt.firstBaseUpdate,rt=nt.lastBaseUpdate,ot=nt.shared.pending;if(ot!==null){nt.shared.pending=null;var lt=ot,st=lt.next;lt.next=null,rt===null?it=st:rt.next=st,rt=lt;var at=et.alternate;at!==null&&(at=at.updateQueue,ot=at.lastBaseUpdate,ot!==rt&&(ot===null?at.firstBaseUpdate=st:ot.next=st,at.lastBaseUpdate=lt))}if(it!==null){var ct=nt.baseState;rt=0,at=st=lt=null,ot=it;do{var dt=ot.lane,ut=ot.eventTime;if((tt&dt)===dt){at!==null&&(at=at.next={eventTime:ut,lane:0,tag:ot.tag,payload:ot.payload,callback:ot.callback,next:null});e:{var ft=et,pt=ot;switch(dt=$,ut=_,pt.tag){case 1:if(ft=pt.payload,typeof ft=="function"){ct=ft.call(ut,ct,dt);break e}ct=ft;break e;case 3:ft.flags=ft.flags&-65537|128;case 0:if(ft=pt.payload,dt=typeof ft=="function"?ft.call(ut,ct,dt):ft,dt==null)break e;ct=A({},ct,dt);break e;case 2:jh=!0}}ot.callback!==null&&ot.lane!==0&&(et.flags|=64,dt=nt.effects,dt===null?nt.effects=[ot]:dt.push(ot))}else ut={eventTime:ut,lane:dt,tag:ot.tag,payload:ot.payload,callback:ot.callback,next:null},at===null?(st=at=ut,lt=ct):at=at.next=ut,rt|=dt;if(ot=ot.next,ot===null){if(ot=nt.shared.pending,ot===null)break;dt=ot,ot=dt.next,dt.next=null,nt.lastBaseUpdate=dt,nt.shared.pending=null}}while(1);if(at===null&&(lt=ct),nt.baseState=lt,nt.firstBaseUpdate=st,nt.lastBaseUpdate=at,$=nt.shared.interleaved,$!==null){nt=$;do rt|=nt.lane,nt=nt.next;while(nt!==$)}else it===null&&(nt.shared.lanes=0);rh|=rt,et.lanes=rt,et.memoizedState=ct}}function sh(et,$,_){if(et=$.effects,$.effects=null,et!==null)for($=0;$<et.length;$++){var tt=et[$],nt=tt.callback;if(nt!==null){if(tt.callback=null,tt=_,typeof nt!="function")throw Error(p$1(191,nt));nt.call(tt)}}}var th={},uh=Uf(th),vh=Uf(th),wh=Uf(th);function xh(et){if(et===th)throw Error(p$1(174));return et}function yh(et,$){switch(G(wh,$),G(vh,et),G(uh,th),et=$.nodeType,et){case 9:case 11:$=($=$.documentElement)?$.namespaceURI:lb(null,"");break;default:et=et===8?$.parentNode:$,$=et.namespaceURI||null,et=et.tagName,$=lb($,et)}E(uh),G(uh,$)}function zh(){E(uh),E(vh),E(wh)}function Ah(et){xh(wh.current);var $=xh(uh.current),_=lb($,et.type);$!==_&&(G(vh,et),G(uh,_))}function Bh(et){vh.current===et&&(E(uh),E(vh))}var L=Uf(0);function Ch(et){for(var $=et;$!==null;){if($.tag===13){var _=$.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||_.data==="$?"||_.data==="$!"))return $}else if($.tag===19&&$.memoizedProps.revealOrder!==void 0){if($.flags&128)return $}else if($.child!==null){$.child.return=$,$=$.child;continue}if($===et)break;for(;$.sibling===null;){if($.return===null||$.return===et)return null;$=$.return}$.sibling.return=$.return,$=$.sibling}return null}var Dh=[];function Eh(){for(var et=0;et<Dh.length;et++)Dh[et]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p$1(321))}function Mh(et,$){if($===null)return!1;for(var _=0;_<$.length&&_<et.length;_++)if(!He(et[_],$[_]))return!1;return!0}function Nh(et,$,_,tt,nt,it){if(Hh=it,M=$,$.memoizedState=null,$.updateQueue=null,$.lanes=0,Fh.current=et===null||et.memoizedState===null?Oh:Ph,et=_(tt,nt),Jh){it=0;do{if(Jh=!1,Kh=0,25<=it)throw Error(p$1(301));it+=1,O=N=null,$.updateQueue=null,Fh.current=Qh,et=_(tt,nt)}while(Jh)}if(Fh.current=Rh,$=N!==null&&N.next!==null,Hh=0,O=N=M=null,Ih=!1,$)throw Error(p$1(300));return et}function Sh(){var et=Kh!==0;return Kh=0,et}function Th(){var et={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M.memoizedState=O=et:O=O.next=et,O}function Uh(){if(N===null){var et=M.alternate;et=et!==null?et.memoizedState:null}else et=N.next;var $=O===null?M.memoizedState:O.next;if($!==null)O=$,N=et;else{if(et===null)throw Error(p$1(310));N=et,et={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M.memoizedState=O=et:O=O.next=et}return O}function Vh(et,$){return typeof $=="function"?$(et):$}function Wh(et){var $=Uh(),_=$.queue;if(_===null)throw Error(p$1(311));_.lastRenderedReducer=et;var tt=N,nt=tt.baseQueue,it=_.pending;if(it!==null){if(nt!==null){var rt=nt.next;nt.next=it.next,it.next=rt}tt.baseQueue=nt=it,_.pending=null}if(nt!==null){it=nt.next,tt=tt.baseState;var ot=rt=null,lt=null,st=it;do{var at=st.lane;if((Hh&at)===at)lt!==null&&(lt=lt.next={lane:0,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null}),tt=st.hasEagerState?st.eagerState:et(tt,st.action);else{var ct={lane:at,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null};lt===null?(ot=lt=ct,rt=tt):lt=lt.next=ct,M.lanes|=at,rh|=at}st=st.next}while(st!==null&&st!==it);lt===null?rt=tt:lt.next=ot,He(tt,$.memoizedState)||(dh=!0),$.memoizedState=tt,$.baseState=rt,$.baseQueue=lt,_.lastRenderedState=tt}if(et=_.interleaved,et!==null){nt=et;do it=nt.lane,M.lanes|=it,rh|=it,nt=nt.next;while(nt!==et)}else nt===null&&(_.lanes=0);return[$.memoizedState,_.dispatch]}function Xh(et){var $=Uh(),_=$.queue;if(_===null)throw Error(p$1(311));_.lastRenderedReducer=et;var tt=_.dispatch,nt=_.pending,it=$.memoizedState;if(nt!==null){_.pending=null;var rt=nt=nt.next;do it=et(it,rt.action),rt=rt.next;while(rt!==nt);He(it,$.memoizedState)||(dh=!0),$.memoizedState=it,$.baseQueue===null&&($.baseState=it),_.lastRenderedState=it}return[it,tt]}function Yh(){}function Zh(et,$){var _=M,tt=Uh(),nt=$(),it=!He(tt.memoizedState,nt);if(it&&(tt.memoizedState=nt,dh=!0),tt=tt.queue,$h(ai.bind(null,_,tt,et),[et]),tt.getSnapshot!==$||it||O!==null&&O.memoizedState.tag&1){if(_.flags|=2048,bi(9,ci.bind(null,_,tt,nt,$),void 0,null),Q===null)throw Error(p$1(349));Hh&30||di(_,$,nt)}return nt}function di(et,$,_){et.flags|=16384,et={getSnapshot:$,value:_},$=M.updateQueue,$===null?($={lastEffect:null,stores:null},M.updateQueue=$,$.stores=[et]):(_=$.stores,_===null?$.stores=[et]:_.push(et))}function ci(et,$,_,tt){$.value=_,$.getSnapshot=tt,ei($)&&fi(et)}function ai(et,$,_){return _(function(){ei($)&&fi(et)})}function ei(et){var $=et.getSnapshot;et=et.value;try{var _=$();return!He(et,_)}catch{return!0}}function fi(et){var $=ih(et,1);$!==null&&gi($,et,1,-1)}function hi(et){var $=Th();return typeof et=="function"&&(et=et()),$.memoizedState=$.baseState=et,et={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:et},$.queue=et,et=et.dispatch=ii.bind(null,M,et),[$.memoizedState,et]}function bi(et,$,_,tt){return et={tag:et,create:$,destroy:_,deps:tt,next:null},$=M.updateQueue,$===null?($={lastEffect:null,stores:null},M.updateQueue=$,$.lastEffect=et.next=et):(_=$.lastEffect,_===null?$.lastEffect=et.next=et:(tt=_.next,_.next=et,et.next=tt,$.lastEffect=et)),et}function ji(){return Uh().memoizedState}function ki(et,$,_,tt){var nt=Th();M.flags|=et,nt.memoizedState=bi(1|$,_,void 0,tt===void 0?null:tt)}function li(et,$,_,tt){var nt=Uh();tt=tt===void 0?null:tt;var it=void 0;if(N!==null){var rt=N.memoizedState;if(it=rt.destroy,tt!==null&&Mh(tt,rt.deps)){nt.memoizedState=bi($,_,it,tt);return}}M.flags|=et,nt.memoizedState=bi(1|$,_,it,tt)}function mi(et,$){return ki(8390656,8,et,$)}function $h(et,$){return li(2048,8,et,$)}function ni(et,$){return li(4,2,et,$)}function oi(et,$){return li(4,4,et,$)}function pi(et,$){if(typeof $=="function")return et=et(),$(et),function(){$(null)};if($!=null)return et=et(),$.current=et,function(){$.current=null}}function qi(et,$,_){return _=_!=null?_.concat([et]):null,li(4,4,pi.bind(null,$,et),_)}function ri(){}function si(et,$){var _=Uh();$=$===void 0?null:$;var tt=_.memoizedState;return tt!==null&&$!==null&&Mh($,tt[1])?tt[0]:(_.memoizedState=[et,$],et)}function ti(et,$){var _=Uh();$=$===void 0?null:$;var tt=_.memoizedState;return tt!==null&&$!==null&&Mh($,tt[1])?tt[0]:(et=et(),_.memoizedState=[et,$],et)}function ui(et,$,_){return Hh&21?(He(_,$)||(_=yc(),M.lanes|=_,rh|=_,et.baseState=!0),$):(et.baseState&&(et.baseState=!1,dh=!0),et.memoizedState=_)}function vi(et,$){var _=C;C=_!==0&&4>_?_:4,et(!0);var tt=Gh.transition;Gh.transition={};try{et(!1),$()}finally{C=_,Gh.transition=tt}}function wi(){return Uh().memoizedState}function xi(et,$,_){var tt=yi(et);if(_={lane:tt,action:_,hasEagerState:!1,eagerState:null,next:null},zi(et))Ai($,_);else if(_=hh(et,$,_,tt),_!==null){var nt=R();gi(_,et,tt,nt),Bi(_,$,tt)}}function ii(et,$,_){var tt=yi(et),nt={lane:tt,action:_,hasEagerState:!1,eagerState:null,next:null};if(zi(et))Ai($,nt);else{var it=et.alternate;if(et.lanes===0&&(it===null||it.lanes===0)&&(it=$.lastRenderedReducer,it!==null))try{var rt=$.lastRenderedState,ot=it(rt,_);if(nt.hasEagerState=!0,nt.eagerState=ot,He(ot,rt)){var lt=$.interleaved;lt===null?(nt.next=nt,gh($)):(nt.next=lt.next,lt.next=nt),$.interleaved=nt;return}}catch{}finally{}_=hh(et,$,nt,tt),_!==null&&(nt=R(),gi(_,et,tt,nt),Bi(_,$,tt))}}function zi(et){var $=et.alternate;return et===M||$!==null&&$===M}function Ai(et,$){Jh=Ih=!0;var _=et.pending;_===null?$.next=$:($.next=_.next,_.next=$),et.pending=$}function Bi(et,$,_){if(_&4194240){var tt=$.lanes;tt&=et.pendingLanes,_|=tt,$.lanes=_,Cc(et,_)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(et,$){return Th().memoizedState=[et,$===void 0?null:$],et},useContext:eh,useEffect:mi,useImperativeHandle:function(et,$,_){return _=_!=null?_.concat([et]):null,ki(4194308,4,pi.bind(null,$,et),_)},useLayoutEffect:function(et,$){return ki(4194308,4,et,$)},useInsertionEffect:function(et,$){return ki(4,2,et,$)},useMemo:function(et,$){var _=Th();return $=$===void 0?null:$,et=et(),_.memoizedState=[et,$],et},useReducer:function(et,$,_){var tt=Th();return $=_!==void 0?_($):$,tt.memoizedState=tt.baseState=$,et={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:et,lastRenderedState:$},tt.queue=et,et=et.dispatch=xi.bind(null,M,et),[tt.memoizedState,et]},useRef:function(et){var $=Th();return et={current:et},$.memoizedState=et},useState:hi,useDebugValue:ri,useDeferredValue:function(et){return Th().memoizedState=et},useTransition:function(){var et=hi(!1),$=et[0];return et=vi.bind(null,et[1]),Th().memoizedState=et,[$,et]},useMutableSource:function(){},useSyncExternalStore:function(et,$,_){var tt=M,nt=Th();if(I){if(_===void 0)throw Error(p$1(407));_=_()}else{if(_=$(),Q===null)throw Error(p$1(349));Hh&30||di(tt,$,_)}nt.memoizedState=_;var it={value:_,getSnapshot:$};return nt.queue=it,mi(ai.bind(null,tt,it,et),[et]),tt.flags|=2048,bi(9,ci.bind(null,tt,it,_,$),void 0,null),_},useId:function(){var et=Th(),$=Q.identifierPrefix;if(I){var _=sg,tt=rg;_=(tt&~(1<<32-oc(tt)-1)).toString(32)+_,$=":"+$+"R"+_,_=Kh++,0<_&&($+="H"+_.toString(32)),$+=":"}else _=Lh++,$=":"+$+"r"+_.toString(32)+":";return et.memoizedState=$},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(et){var $=Uh();return ui($,N.memoizedState,et)},useTransition:function(){var et=Wh(Vh)[0],$=Uh().memoizedState;return[et,$]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(et){var $=Uh();return N===null?$.memoizedState=et:ui($,N.memoizedState,et)},useTransition:function(){var et=Xh(Vh)[0],$=Uh().memoizedState;return[et,$]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(et,$){if(et&&et.defaultProps){$=A({},$),et=et.defaultProps;for(var _ in et)$[_]===void 0&&($[_]=et[_]);return $}return $}function Di(et,$,_,tt){$=et.memoizedState,_=_(tt,$),_=_==null?$:A({},$,_),et.memoizedState=_,et.lanes===0&&(et.updateQueue.baseState=_)}var Ei={isMounted:function(et){return(et=et._reactInternals)?Vb(et)===et:!1},enqueueSetState:function(et,$,_){et=et._reactInternals;var tt=R(),nt=yi(et),it=mh(tt,nt);it.payload=$,_!=null&&(it.callback=_),$=nh(et,it,nt),$!==null&&(gi($,et,nt,tt),oh($,et,nt))},enqueueReplaceState:function(et,$,_){et=et._reactInternals;var tt=R(),nt=yi(et),it=mh(tt,nt);it.tag=1,it.payload=$,_!=null&&(it.callback=_),$=nh(et,it,nt),$!==null&&(gi($,et,nt,tt),oh($,et,nt))},enqueueForceUpdate:function(et,$){et=et._reactInternals;var _=R(),tt=yi(et),nt=mh(_,tt);nt.tag=2,$!=null&&(nt.callback=$),$=nh(et,nt,tt),$!==null&&(gi($,et,tt,_),oh($,et,tt))}};function Fi(et,$,_,tt,nt,it,rt){return et=et.stateNode,typeof et.shouldComponentUpdate=="function"?et.shouldComponentUpdate(tt,it,rt):$.prototype&&$.prototype.isPureReactComponent?!Ie(_,tt)||!Ie(nt,it):!0}function Gi(et,$,_){var tt=!1,nt=Vf,it=$.contextType;return typeof it=="object"&&it!==null?it=eh(it):(nt=Zf($)?Xf:H.current,tt=$.contextTypes,it=(tt=tt!=null)?Yf(et,nt):Vf),$=new $(_,it),et.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,$.updater=Ei,et.stateNode=$,$._reactInternals=et,tt&&(et=et.stateNode,et.__reactInternalMemoizedUnmaskedChildContext=nt,et.__reactInternalMemoizedMaskedChildContext=it),$}function Hi(et,$,_,tt){et=$.state,typeof $.componentWillReceiveProps=="function"&&$.componentWillReceiveProps(_,tt),typeof $.UNSAFE_componentWillReceiveProps=="function"&&$.UNSAFE_componentWillReceiveProps(_,tt),$.state!==et&&Ei.enqueueReplaceState($,$.state,null)}function Ii(et,$,_,tt){var nt=et.stateNode;nt.props=_,nt.state=et.memoizedState,nt.refs={},kh(et);var it=$.contextType;typeof it=="object"&&it!==null?nt.context=eh(it):(it=Zf($)?Xf:H.current,nt.context=Yf(et,it)),nt.state=et.memoizedState,it=$.getDerivedStateFromProps,typeof it=="function"&&(Di(et,$,it,_),nt.state=et.memoizedState),typeof $.getDerivedStateFromProps=="function"||typeof nt.getSnapshotBeforeUpdate=="function"||typeof nt.UNSAFE_componentWillMount!="function"&&typeof nt.componentWillMount!="function"||($=nt.state,typeof nt.componentWillMount=="function"&&nt.componentWillMount(),typeof nt.UNSAFE_componentWillMount=="function"&&nt.UNSAFE_componentWillMount(),$!==nt.state&&Ei.enqueueReplaceState(nt,nt.state,null),qh(et,_,nt,tt),nt.state=et.memoizedState),typeof nt.componentDidMount=="function"&&(et.flags|=4194308)}function Ji(et,$){try{var _="",tt=$;do _+=Pa(tt),tt=tt.return;while(tt);var nt=_}catch(it){nt=`
Error generating stack: `+it.message+`
`+it.stack}return{value:et,source:$,stack:nt,digest:null}}function Ki(et,$,_){return{value:et,source:null,stack:_??null,digest:$??null}}function Li(et,$){try{console.error($.value)}catch(_){setTimeout(function(){throw _})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(et,$,_){_=mh(-1,_),_.tag=3,_.payload={element:null};var tt=$.value;return _.callback=function(){Oi||(Oi=!0,Pi=tt),Li(et,$)},_}function Qi(et,$,_){_=mh(-1,_),_.tag=3;var tt=et.type.getDerivedStateFromError;if(typeof tt=="function"){var nt=$.value;_.payload=function(){return tt(nt)},_.callback=function(){Li(et,$)}}var it=et.stateNode;return it!==null&&typeof it.componentDidCatch=="function"&&(_.callback=function(){Li(et,$),typeof tt!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var rt=$.stack;this.componentDidCatch($.value,{componentStack:rt!==null?rt:""})}),_}function Si(et,$,_){var tt=et.pingCache;if(tt===null){tt=et.pingCache=new Mi;var nt=new Set;tt.set($,nt)}else nt=tt.get($),nt===void 0&&(nt=new Set,tt.set($,nt));nt.has(_)||(nt.add(_),et=Ti.bind(null,et,$,_),$.then(et,et))}function Ui(et){do{var $;if(($=et.tag===13)&&($=et.memoizedState,$=$!==null?$.dehydrated!==null:!0),$)return et;et=et.return}while(et!==null);return null}function Vi(et,$,_,tt,nt){return et.mode&1?(et.flags|=65536,et.lanes=nt,et):(et===$?et.flags|=65536:(et.flags|=128,_.flags|=131072,_.flags&=-52805,_.tag===1&&(_.alternate===null?_.tag=17:($=mh(-1,1),$.tag=2,nh(_,$,1))),_.lanes|=1),et)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(et,$,_,tt){$.child=et===null?Vg($,null,_,tt):Ug($,et.child,_,tt)}function Yi(et,$,_,tt,nt){_=_.render;var it=$.ref;return ch($,nt),tt=Nh(et,$,_,tt,it,nt),_=Sh(),et!==null&&!dh?($.updateQueue=et.updateQueue,$.flags&=-2053,et.lanes&=~nt,Zi(et,$,nt)):(I&&_&&vg($),$.flags|=1,Xi(et,$,tt,nt),$.child)}function $i(et,$,_,tt,nt){if(et===null){var it=_.type;return typeof it=="function"&&!aj(it)&&it.defaultProps===void 0&&_.compare===null&&_.defaultProps===void 0?($.tag=15,$.type=it,bj(et,$,it,tt,nt)):(et=Rg(_.type,null,tt,$,$.mode,nt),et.ref=$.ref,et.return=$,$.child=et)}if(it=et.child,!(et.lanes&nt)){var rt=it.memoizedProps;if(_=_.compare,_=_!==null?_:Ie,_(rt,tt)&&et.ref===$.ref)return Zi(et,$,nt)}return $.flags|=1,et=Pg(it,tt),et.ref=$.ref,et.return=$,$.child=et}function bj(et,$,_,tt,nt){if(et!==null){var it=et.memoizedProps;if(Ie(it,tt)&&et.ref===$.ref)if(dh=!1,$.pendingProps=tt=it,(et.lanes&nt)!==0)et.flags&131072&&(dh=!0);else return $.lanes=et.lanes,Zi(et,$,nt)}return cj(et,$,_,tt,nt)}function dj(et,$,_){var tt=$.pendingProps,nt=tt.children,it=et!==null?et.memoizedState:null;if(tt.mode==="hidden")if(!($.mode&1))$.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=_;else{if(!(_&1073741824))return et=it!==null?it.baseLanes|_:_,$.lanes=$.childLanes=1073741824,$.memoizedState={baseLanes:et,cachePool:null,transitions:null},$.updateQueue=null,G(ej,fj),fj|=et,null;$.memoizedState={baseLanes:0,cachePool:null,transitions:null},tt=it!==null?it.baseLanes:_,G(ej,fj),fj|=tt}else it!==null?(tt=it.baseLanes|_,$.memoizedState=null):tt=_,G(ej,fj),fj|=tt;return Xi(et,$,nt,_),$.child}function gj(et,$){var _=$.ref;(et===null&&_!==null||et!==null&&et.ref!==_)&&($.flags|=512,$.flags|=2097152)}function cj(et,$,_,tt,nt){var it=Zf(_)?Xf:H.current;return it=Yf($,it),ch($,nt),_=Nh(et,$,_,tt,it,nt),tt=Sh(),et!==null&&!dh?($.updateQueue=et.updateQueue,$.flags&=-2053,et.lanes&=~nt,Zi(et,$,nt)):(I&&tt&&vg($),$.flags|=1,Xi(et,$,_,nt),$.child)}function hj(et,$,_,tt,nt){if(Zf(_)){var it=!0;cg($)}else it=!1;if(ch($,nt),$.stateNode===null)ij(et,$),Gi($,_,tt),Ii($,_,tt,nt),tt=!0;else if(et===null){var rt=$.stateNode,ot=$.memoizedProps;rt.props=ot;var lt=rt.context,st=_.contextType;typeof st=="object"&&st!==null?st=eh(st):(st=Zf(_)?Xf:H.current,st=Yf($,st));var at=_.getDerivedStateFromProps,ct=typeof at=="function"||typeof rt.getSnapshotBeforeUpdate=="function";ct||typeof rt.UNSAFE_componentWillReceiveProps!="function"&&typeof rt.componentWillReceiveProps!="function"||(ot!==tt||lt!==st)&&Hi($,rt,tt,st),jh=!1;var dt=$.memoizedState;rt.state=dt,qh($,tt,rt,nt),lt=$.memoizedState,ot!==tt||dt!==lt||Wf.current||jh?(typeof at=="function"&&(Di($,_,at,tt),lt=$.memoizedState),(ot=jh||Fi($,_,ot,tt,dt,lt,st))?(ct||typeof rt.UNSAFE_componentWillMount!="function"&&typeof rt.componentWillMount!="function"||(typeof rt.componentWillMount=="function"&&rt.componentWillMount(),typeof rt.UNSAFE_componentWillMount=="function"&&rt.UNSAFE_componentWillMount()),typeof rt.componentDidMount=="function"&&($.flags|=4194308)):(typeof rt.componentDidMount=="function"&&($.flags|=4194308),$.memoizedProps=tt,$.memoizedState=lt),rt.props=tt,rt.state=lt,rt.context=st,tt=ot):(typeof rt.componentDidMount=="function"&&($.flags|=4194308),tt=!1)}else{rt=$.stateNode,lh(et,$),ot=$.memoizedProps,st=$.type===$.elementType?ot:Ci($.type,ot),rt.props=st,ct=$.pendingProps,dt=rt.context,lt=_.contextType,typeof lt=="object"&&lt!==null?lt=eh(lt):(lt=Zf(_)?Xf:H.current,lt=Yf($,lt));var ut=_.getDerivedStateFromProps;(at=typeof ut=="function"||typeof rt.getSnapshotBeforeUpdate=="function")||typeof rt.UNSAFE_componentWillReceiveProps!="function"&&typeof rt.componentWillReceiveProps!="function"||(ot!==ct||dt!==lt)&&Hi($,rt,tt,lt),jh=!1,dt=$.memoizedState,rt.state=dt,qh($,tt,rt,nt);var ft=$.memoizedState;ot!==ct||dt!==ft||Wf.current||jh?(typeof ut=="function"&&(Di($,_,ut,tt),ft=$.memoizedState),(st=jh||Fi($,_,st,tt,dt,ft,lt)||!1)?(at||typeof rt.UNSAFE_componentWillUpdate!="function"&&typeof rt.componentWillUpdate!="function"||(typeof rt.componentWillUpdate=="function"&&rt.componentWillUpdate(tt,ft,lt),typeof rt.UNSAFE_componentWillUpdate=="function"&&rt.UNSAFE_componentWillUpdate(tt,ft,lt)),typeof rt.componentDidUpdate=="function"&&($.flags|=4),typeof rt.getSnapshotBeforeUpdate=="function"&&($.flags|=1024)):(typeof rt.componentDidUpdate!="function"||ot===et.memoizedProps&&dt===et.memoizedState||($.flags|=4),typeof rt.getSnapshotBeforeUpdate!="function"||ot===et.memoizedProps&&dt===et.memoizedState||($.flags|=1024),$.memoizedProps=tt,$.memoizedState=ft),rt.props=tt,rt.state=ft,rt.context=lt,tt=st):(typeof rt.componentDidUpdate!="function"||ot===et.memoizedProps&&dt===et.memoizedState||($.flags|=4),typeof rt.getSnapshotBeforeUpdate!="function"||ot===et.memoizedProps&&dt===et.memoizedState||($.flags|=1024),tt=!1)}return jj(et,$,_,tt,it,nt)}function jj(et,$,_,tt,nt,it){gj(et,$);var rt=($.flags&128)!==0;if(!tt&&!rt)return nt&&dg($,_,!1),Zi(et,$,it);tt=$.stateNode,Wi.current=$;var ot=rt&&typeof _.getDerivedStateFromError!="function"?null:tt.render();return $.flags|=1,et!==null&&rt?($.child=Ug($,et.child,null,it),$.child=Ug($,null,ot,it)):Xi(et,$,ot,it),$.memoizedState=tt.state,nt&&dg($,_,!0),$.child}function kj(et){var $=et.stateNode;$.pendingContext?ag(et,$.pendingContext,$.pendingContext!==$.context):$.context&&ag(et,$.context,!1),yh(et,$.containerInfo)}function lj(et,$,_,tt,nt){return Ig(),Jg(nt),$.flags|=256,Xi(et,$,_,tt),$.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(et){return{baseLanes:et,cachePool:null,transitions:null}}function oj(et,$,_){var tt=$.pendingProps,nt=L.current,it=!1,rt=($.flags&128)!==0,ot;if((ot=rt)||(ot=et!==null&&et.memoizedState===null?!1:(nt&2)!==0),ot?(it=!0,$.flags&=-129):(et===null||et.memoizedState!==null)&&(nt|=1),G(L,nt&1),et===null)return Eg($),et=$.memoizedState,et!==null&&(et=et.dehydrated,et!==null)?($.mode&1?et.data==="$!"?$.lanes=8:$.lanes=1073741824:$.lanes=1,null):(rt=tt.children,et=tt.fallback,it?(tt=$.mode,it=$.child,rt={mode:"hidden",children:rt},!(tt&1)&&it!==null?(it.childLanes=0,it.pendingProps=rt):it=pj(rt,tt,0,null),et=Tg(et,tt,_,null),it.return=$,et.return=$,it.sibling=et,$.child=it,$.child.memoizedState=nj(_),$.memoizedState=mj,et):qj($,rt));if(nt=et.memoizedState,nt!==null&&(ot=nt.dehydrated,ot!==null))return rj(et,$,rt,tt,ot,nt,_);if(it){it=tt.fallback,rt=$.mode,nt=et.child,ot=nt.sibling;var lt={mode:"hidden",children:tt.children};return!(rt&1)&&$.child!==nt?(tt=$.child,tt.childLanes=0,tt.pendingProps=lt,$.deletions=null):(tt=Pg(nt,lt),tt.subtreeFlags=nt.subtreeFlags&14680064),ot!==null?it=Pg(ot,it):(it=Tg(it,rt,_,null),it.flags|=2),it.return=$,tt.return=$,tt.sibling=it,$.child=tt,tt=it,it=$.child,rt=et.child.memoizedState,rt=rt===null?nj(_):{baseLanes:rt.baseLanes|_,cachePool:null,transitions:rt.transitions},it.memoizedState=rt,it.childLanes=et.childLanes&~_,$.memoizedState=mj,tt}return it=et.child,et=it.sibling,tt=Pg(it,{mode:"visible",children:tt.children}),!($.mode&1)&&(tt.lanes=_),tt.return=$,tt.sibling=null,et!==null&&(_=$.deletions,_===null?($.deletions=[et],$.flags|=16):_.push(et)),$.child=tt,$.memoizedState=null,tt}function qj(et,$){return $=pj({mode:"visible",children:$},et.mode,0,null),$.return=et,et.child=$}function sj(et,$,_,tt){return tt!==null&&Jg(tt),Ug($,et.child,null,_),et=qj($,$.pendingProps.children),et.flags|=2,$.memoizedState=null,et}function rj(et,$,_,tt,nt,it,rt){if(_)return $.flags&256?($.flags&=-257,tt=Ki(Error(p$1(422))),sj(et,$,rt,tt)):$.memoizedState!==null?($.child=et.child,$.flags|=128,null):(it=tt.fallback,nt=$.mode,tt=pj({mode:"visible",children:tt.children},nt,0,null),it=Tg(it,nt,rt,null),it.flags|=2,tt.return=$,it.return=$,tt.sibling=it,$.child=tt,$.mode&1&&Ug($,et.child,null,rt),$.child.memoizedState=nj(rt),$.memoizedState=mj,it);if(!($.mode&1))return sj(et,$,rt,null);if(nt.data==="$!"){if(tt=nt.nextSibling&&nt.nextSibling.dataset,tt)var ot=tt.dgst;return tt=ot,it=Error(p$1(419)),tt=Ki(it,tt,void 0),sj(et,$,rt,tt)}if(ot=(rt&et.childLanes)!==0,dh||ot){if(tt=Q,tt!==null){switch(rt&-rt){case 4:nt=2;break;case 16:nt=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:nt=32;break;case 536870912:nt=268435456;break;default:nt=0}nt=nt&(tt.suspendedLanes|rt)?0:nt,nt!==0&&nt!==it.retryLane&&(it.retryLane=nt,ih(et,nt),gi(tt,et,nt,-1))}return tj(),tt=Ki(Error(p$1(421))),sj(et,$,rt,tt)}return nt.data==="$?"?($.flags|=128,$.child=et.child,$=uj.bind(null,et),nt._reactRetry=$,null):(et=it.treeContext,yg=Lf(nt.nextSibling),xg=$,I=!0,zg=null,et!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=et.id,sg=et.overflow,qg=$),$=qj($,tt.children),$.flags|=4096,$)}function vj(et,$,_){et.lanes|=$;var tt=et.alternate;tt!==null&&(tt.lanes|=$),bh(et.return,$,_)}function wj(et,$,_,tt,nt){var it=et.memoizedState;it===null?et.memoizedState={isBackwards:$,rendering:null,renderingStartTime:0,last:tt,tail:_,tailMode:nt}:(it.isBackwards=$,it.rendering=null,it.renderingStartTime=0,it.last=tt,it.tail=_,it.tailMode=nt)}function xj(et,$,_){var tt=$.pendingProps,nt=tt.revealOrder,it=tt.tail;if(Xi(et,$,tt.children,_),tt=L.current,tt&2)tt=tt&1|2,$.flags|=128;else{if(et!==null&&et.flags&128)e:for(et=$.child;et!==null;){if(et.tag===13)et.memoizedState!==null&&vj(et,_,$);else if(et.tag===19)vj(et,_,$);else if(et.child!==null){et.child.return=et,et=et.child;continue}if(et===$)break e;for(;et.sibling===null;){if(et.return===null||et.return===$)break e;et=et.return}et.sibling.return=et.return,et=et.sibling}tt&=1}if(G(L,tt),!($.mode&1))$.memoizedState=null;else switch(nt){case"forwards":for(_=$.child,nt=null;_!==null;)et=_.alternate,et!==null&&Ch(et)===null&&(nt=_),_=_.sibling;_=nt,_===null?(nt=$.child,$.child=null):(nt=_.sibling,_.sibling=null),wj($,!1,nt,_,it);break;case"backwards":for(_=null,nt=$.child,$.child=null;nt!==null;){if(et=nt.alternate,et!==null&&Ch(et)===null){$.child=nt;break}et=nt.sibling,nt.sibling=_,_=nt,nt=et}wj($,!0,_,null,it);break;case"together":wj($,!1,null,null,void 0);break;default:$.memoizedState=null}return $.child}function ij(et,$){!($.mode&1)&&et!==null&&(et.alternate=null,$.alternate=null,$.flags|=2)}function Zi(et,$,_){if(et!==null&&($.dependencies=et.dependencies),rh|=$.lanes,!(_&$.childLanes))return null;if(et!==null&&$.child!==et.child)throw Error(p$1(153));if($.child!==null){for(et=$.child,_=Pg(et,et.pendingProps),$.child=_,_.return=$;et.sibling!==null;)et=et.sibling,_=_.sibling=Pg(et,et.pendingProps),_.return=$;_.sibling=null}return $.child}function yj(et,$,_){switch($.tag){case 3:kj($),Ig();break;case 5:Ah($);break;case 1:Zf($.type)&&cg($);break;case 4:yh($,$.stateNode.containerInfo);break;case 10:var tt=$.type._context,nt=$.memoizedProps.value;G(Wg,tt._currentValue),tt._currentValue=nt;break;case 13:if(tt=$.memoizedState,tt!==null)return tt.dehydrated!==null?(G(L,L.current&1),$.flags|=128,null):_&$.child.childLanes?oj(et,$,_):(G(L,L.current&1),et=Zi(et,$,_),et!==null?et.sibling:null);G(L,L.current&1);break;case 19:if(tt=(_&$.childLanes)!==0,et.flags&128){if(tt)return xj(et,$,_);$.flags|=128}if(nt=$.memoizedState,nt!==null&&(nt.rendering=null,nt.tail=null,nt.lastEffect=null),G(L,L.current),tt)break;return null;case 22:case 23:return $.lanes=0,dj(et,$,_)}return Zi(et,$,_)}var zj,Aj,Bj,Cj;zj=function(et,$){for(var _=$.child;_!==null;){if(_.tag===5||_.tag===6)et.appendChild(_.stateNode);else if(_.tag!==4&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===$)break;for(;_.sibling===null;){if(_.return===null||_.return===$)return;_=_.return}_.sibling.return=_.return,_=_.sibling}};Aj=function(){};Bj=function(et,$,_,tt){var nt=et.memoizedProps;if(nt!==tt){et=$.stateNode,xh(uh.current);var it=null;switch(_){case"input":nt=Ya(et,nt),tt=Ya(et,tt),it=[];break;case"select":nt=A({},nt,{value:void 0}),tt=A({},tt,{value:void 0}),it=[];break;case"textarea":nt=gb(et,nt),tt=gb(et,tt),it=[];break;default:typeof nt.onClick!="function"&&typeof tt.onClick=="function"&&(et.onclick=Bf)}ub(_,tt);var rt;_=null;for(st in nt)if(!tt.hasOwnProperty(st)&&nt.hasOwnProperty(st)&&nt[st]!=null)if(st==="style"){var ot=nt[st];for(rt in ot)ot.hasOwnProperty(rt)&&(_||(_={}),_[rt]="")}else st!=="dangerouslySetInnerHTML"&&st!=="children"&&st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&st!=="autoFocus"&&(ea.hasOwnProperty(st)?it||(it=[]):(it=it||[]).push(st,null));for(st in tt){var lt=tt[st];if(ot=nt!=null?nt[st]:void 0,tt.hasOwnProperty(st)&&lt!==ot&&(lt!=null||ot!=null))if(st==="style")if(ot){for(rt in ot)!ot.hasOwnProperty(rt)||lt&&lt.hasOwnProperty(rt)||(_||(_={}),_[rt]="");for(rt in lt)lt.hasOwnProperty(rt)&&ot[rt]!==lt[rt]&&(_||(_={}),_[rt]=lt[rt])}else _||(it||(it=[]),it.push(st,_)),_=lt;else st==="dangerouslySetInnerHTML"?(lt=lt?lt.__html:void 0,ot=ot?ot.__html:void 0,lt!=null&&ot!==lt&&(it=it||[]).push(st,lt)):st==="children"?typeof lt!="string"&&typeof lt!="number"||(it=it||[]).push(st,""+lt):st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&(ea.hasOwnProperty(st)?(lt!=null&&st==="onScroll"&&D("scroll",et),it||ot===lt||(it=[])):(it=it||[]).push(st,lt))}_&&(it=it||[]).push("style",_);var st=it;($.updateQueue=st)&&($.flags|=4)}};Cj=function(et,$,_,tt){_!==tt&&($.flags|=4)};function Dj(et,$){if(!I)switch(et.tailMode){case"hidden":$=et.tail;for(var _=null;$!==null;)$.alternate!==null&&(_=$),$=$.sibling;_===null?et.tail=null:_.sibling=null;break;case"collapsed":_=et.tail;for(var tt=null;_!==null;)_.alternate!==null&&(tt=_),_=_.sibling;tt===null?$||et.tail===null?et.tail=null:et.tail.sibling=null:tt.sibling=null}}function S(et){var $=et.alternate!==null&&et.alternate.child===et.child,_=0,tt=0;if($)for(var nt=et.child;nt!==null;)_|=nt.lanes|nt.childLanes,tt|=nt.subtreeFlags&14680064,tt|=nt.flags&14680064,nt.return=et,nt=nt.sibling;else for(nt=et.child;nt!==null;)_|=nt.lanes|nt.childLanes,tt|=nt.subtreeFlags,tt|=nt.flags,nt.return=et,nt=nt.sibling;return et.subtreeFlags|=tt,et.childLanes=_,$}function Ej(et,$,_){var tt=$.pendingProps;switch(wg($),$.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S($),null;case 1:return Zf($.type)&&$f(),S($),null;case 3:return tt=$.stateNode,zh(),E(Wf),E(H),Eh(),tt.pendingContext&&(tt.context=tt.pendingContext,tt.pendingContext=null),(et===null||et.child===null)&&(Gg($)?$.flags|=4:et===null||et.memoizedState.isDehydrated&&!($.flags&256)||($.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(et,$),S($),null;case 5:Bh($);var nt=xh(wh.current);if(_=$.type,et!==null&&$.stateNode!=null)Bj(et,$,_,tt,nt),et.ref!==$.ref&&($.flags|=512,$.flags|=2097152);else{if(!tt){if($.stateNode===null)throw Error(p$1(166));return S($),null}if(et=xh(uh.current),Gg($)){tt=$.stateNode,_=$.type;var it=$.memoizedProps;switch(tt[Of]=$,tt[Pf]=it,et=($.mode&1)!==0,_){case"dialog":D("cancel",tt),D("close",tt);break;case"iframe":case"object":case"embed":D("load",tt);break;case"video":case"audio":for(nt=0;nt<lf.length;nt++)D(lf[nt],tt);break;case"source":D("error",tt);break;case"img":case"image":case"link":D("error",tt),D("load",tt);break;case"details":D("toggle",tt);break;case"input":Za(tt,it),D("invalid",tt);break;case"select":tt._wrapperState={wasMultiple:!!it.multiple},D("invalid",tt);break;case"textarea":hb(tt,it),D("invalid",tt)}ub(_,it),nt=null;for(var rt in it)if(it.hasOwnProperty(rt)){var ot=it[rt];rt==="children"?typeof ot=="string"?tt.textContent!==ot&&(it.suppressHydrationWarning!==!0&&Af(tt.textContent,ot,et),nt=["children",ot]):typeof ot=="number"&&tt.textContent!==""+ot&&(it.suppressHydrationWarning!==!0&&Af(tt.textContent,ot,et),nt=["children",""+ot]):ea.hasOwnProperty(rt)&&ot!=null&&rt==="onScroll"&&D("scroll",tt)}switch(_){case"input":Va(tt),db(tt,it,!0);break;case"textarea":Va(tt),jb(tt);break;case"select":case"option":break;default:typeof it.onClick=="function"&&(tt.onclick=Bf)}tt=nt,$.updateQueue=tt,tt!==null&&($.flags|=4)}else{rt=nt.nodeType===9?nt:nt.ownerDocument,et==="http://www.w3.org/1999/xhtml"&&(et=kb(_)),et==="http://www.w3.org/1999/xhtml"?_==="script"?(et=rt.createElement("div"),et.innerHTML="<script><\/script>",et=et.removeChild(et.firstChild)):typeof tt.is=="string"?et=rt.createElement(_,{is:tt.is}):(et=rt.createElement(_),_==="select"&&(rt=et,tt.multiple?rt.multiple=!0:tt.size&&(rt.size=tt.size))):et=rt.createElementNS(et,_),et[Of]=$,et[Pf]=tt,zj(et,$,!1,!1),$.stateNode=et;e:{switch(rt=vb(_,tt),_){case"dialog":D("cancel",et),D("close",et),nt=tt;break;case"iframe":case"object":case"embed":D("load",et),nt=tt;break;case"video":case"audio":for(nt=0;nt<lf.length;nt++)D(lf[nt],et);nt=tt;break;case"source":D("error",et),nt=tt;break;case"img":case"image":case"link":D("error",et),D("load",et),nt=tt;break;case"details":D("toggle",et),nt=tt;break;case"input":Za(et,tt),nt=Ya(et,tt),D("invalid",et);break;case"option":nt=tt;break;case"select":et._wrapperState={wasMultiple:!!tt.multiple},nt=A({},tt,{value:void 0}),D("invalid",et);break;case"textarea":hb(et,tt),nt=gb(et,tt),D("invalid",et);break;default:nt=tt}ub(_,nt),ot=nt;for(it in ot)if(ot.hasOwnProperty(it)){var lt=ot[it];it==="style"?sb(et,lt):it==="dangerouslySetInnerHTML"?(lt=lt?lt.__html:void 0,lt!=null&&nb(et,lt)):it==="children"?typeof lt=="string"?(_!=="textarea"||lt!=="")&&ob(et,lt):typeof lt=="number"&&ob(et,""+lt):it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&it!=="autoFocus"&&(ea.hasOwnProperty(it)?lt!=null&&it==="onScroll"&&D("scroll",et):lt!=null&&ta(et,it,lt,rt))}switch(_){case"input":Va(et),db(et,tt,!1);break;case"textarea":Va(et),jb(et);break;case"option":tt.value!=null&&et.setAttribute("value",""+Sa(tt.value));break;case"select":et.multiple=!!tt.multiple,it=tt.value,it!=null?fb(et,!!tt.multiple,it,!1):tt.defaultValue!=null&&fb(et,!!tt.multiple,tt.defaultValue,!0);break;default:typeof nt.onClick=="function"&&(et.onclick=Bf)}switch(_){case"button":case"input":case"select":case"textarea":tt=!!tt.autoFocus;break e;case"img":tt=!0;break e;default:tt=!1}}tt&&($.flags|=4)}$.ref!==null&&($.flags|=512,$.flags|=2097152)}return S($),null;case 6:if(et&&$.stateNode!=null)Cj(et,$,et.memoizedProps,tt);else{if(typeof tt!="string"&&$.stateNode===null)throw Error(p$1(166));if(_=xh(wh.current),xh(uh.current),Gg($)){if(tt=$.stateNode,_=$.memoizedProps,tt[Of]=$,(it=tt.nodeValue!==_)&&(et=xg,et!==null))switch(et.tag){case 3:Af(tt.nodeValue,_,(et.mode&1)!==0);break;case 5:et.memoizedProps.suppressHydrationWarning!==!0&&Af(tt.nodeValue,_,(et.mode&1)!==0)}it&&($.flags|=4)}else tt=(_.nodeType===9?_:_.ownerDocument).createTextNode(tt),tt[Of]=$,$.stateNode=tt}return S($),null;case 13:if(E(L),tt=$.memoizedState,et===null||et.memoizedState!==null&&et.memoizedState.dehydrated!==null){if(I&&yg!==null&&$.mode&1&&!($.flags&128))Hg(),Ig(),$.flags|=98560,it=!1;else if(it=Gg($),tt!==null&&tt.dehydrated!==null){if(et===null){if(!it)throw Error(p$1(318));if(it=$.memoizedState,it=it!==null?it.dehydrated:null,!it)throw Error(p$1(317));it[Of]=$}else Ig(),!($.flags&128)&&($.memoizedState=null),$.flags|=4;S($),it=!1}else zg!==null&&(Fj(zg),zg=null),it=!0;if(!it)return $.flags&65536?$:null}return $.flags&128?($.lanes=_,$):(tt=tt!==null,tt!==(et!==null&&et.memoizedState!==null)&&tt&&($.child.flags|=8192,$.mode&1&&(et===null||L.current&1?T===0&&(T=3):tj())),$.updateQueue!==null&&($.flags|=4),S($),null);case 4:return zh(),Aj(et,$),et===null&&sf($.stateNode.containerInfo),S($),null;case 10:return ah($.type._context),S($),null;case 17:return Zf($.type)&&$f(),S($),null;case 19:if(E(L),it=$.memoizedState,it===null)return S($),null;if(tt=($.flags&128)!==0,rt=it.rendering,rt===null)if(tt)Dj(it,!1);else{if(T!==0||et!==null&&et.flags&128)for(et=$.child;et!==null;){if(rt=Ch(et),rt!==null){for($.flags|=128,Dj(it,!1),tt=rt.updateQueue,tt!==null&&($.updateQueue=tt,$.flags|=4),$.subtreeFlags=0,tt=_,_=$.child;_!==null;)it=_,et=tt,it.flags&=14680066,rt=it.alternate,rt===null?(it.childLanes=0,it.lanes=et,it.child=null,it.subtreeFlags=0,it.memoizedProps=null,it.memoizedState=null,it.updateQueue=null,it.dependencies=null,it.stateNode=null):(it.childLanes=rt.childLanes,it.lanes=rt.lanes,it.child=rt.child,it.subtreeFlags=0,it.deletions=null,it.memoizedProps=rt.memoizedProps,it.memoizedState=rt.memoizedState,it.updateQueue=rt.updateQueue,it.type=rt.type,et=rt.dependencies,it.dependencies=et===null?null:{lanes:et.lanes,firstContext:et.firstContext}),_=_.sibling;return G(L,L.current&1|2),$.child}et=et.sibling}it.tail!==null&&B()>Gj&&($.flags|=128,tt=!0,Dj(it,!1),$.lanes=4194304)}else{if(!tt)if(et=Ch(rt),et!==null){if($.flags|=128,tt=!0,_=et.updateQueue,_!==null&&($.updateQueue=_,$.flags|=4),Dj(it,!0),it.tail===null&&it.tailMode==="hidden"&&!rt.alternate&&!I)return S($),null}else 2*B()-it.renderingStartTime>Gj&&_!==1073741824&&($.flags|=128,tt=!0,Dj(it,!1),$.lanes=4194304);it.isBackwards?(rt.sibling=$.child,$.child=rt):(_=it.last,_!==null?_.sibling=rt:$.child=rt,it.last=rt)}return it.tail!==null?($=it.tail,it.rendering=$,it.tail=$.sibling,it.renderingStartTime=B(),$.sibling=null,_=L.current,G(L,tt?_&1|2:_&1),$):(S($),null);case 22:case 23:return Hj(),tt=$.memoizedState!==null,et!==null&&et.memoizedState!==null!==tt&&($.flags|=8192),tt&&$.mode&1?fj&1073741824&&(S($),$.subtreeFlags&6&&($.flags|=8192)):S($),null;case 24:return null;case 25:return null}throw Error(p$1(156,$.tag))}function Ij(et,$){switch(wg($),$.tag){case 1:return Zf($.type)&&$f(),et=$.flags,et&65536?($.flags=et&-65537|128,$):null;case 3:return zh(),E(Wf),E(H),Eh(),et=$.flags,et&65536&&!(et&128)?($.flags=et&-65537|128,$):null;case 5:return Bh($),null;case 13:if(E(L),et=$.memoizedState,et!==null&&et.dehydrated!==null){if($.alternate===null)throw Error(p$1(340));Ig()}return et=$.flags,et&65536?($.flags=et&-65537|128,$):null;case 19:return E(L),null;case 4:return zh(),null;case 10:return ah($.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(et,$){var _=et.ref;if(_!==null)if(typeof _=="function")try{_(null)}catch(tt){W(et,$,tt)}else _.current=null}function Mj(et,$,_){try{_()}catch(tt){W(et,$,tt)}}var Nj=!1;function Oj(et,$){if(Cf=dd,et=Me(),Ne(et)){if("selectionStart"in et)var _={start:et.selectionStart,end:et.selectionEnd};else e:{_=(_=et.ownerDocument)&&_.defaultView||window;var tt=_.getSelection&&_.getSelection();if(tt&&tt.rangeCount!==0){_=tt.anchorNode;var nt=tt.anchorOffset,it=tt.focusNode;tt=tt.focusOffset;try{_.nodeType,it.nodeType}catch{_=null;break e}var rt=0,ot=-1,lt=-1,st=0,at=0,ct=et,dt=null;t:for(;;){for(var ut;ct!==_||nt!==0&&ct.nodeType!==3||(ot=rt+nt),ct!==it||tt!==0&&ct.nodeType!==3||(lt=rt+tt),ct.nodeType===3&&(rt+=ct.nodeValue.length),(ut=ct.firstChild)!==null;)dt=ct,ct=ut;for(;;){if(ct===et)break t;if(dt===_&&++st===nt&&(ot=rt),dt===it&&++at===tt&&(lt=rt),(ut=ct.nextSibling)!==null)break;ct=dt,dt=ct.parentNode}ct=ut}_=ot===-1||lt===-1?null:{start:ot,end:lt}}else _=null}_=_||{start:0,end:0}}else _=null;for(Df={focusedElem:et,selectionRange:_},dd=!1,V=$;V!==null;)if($=V,et=$.child,($.subtreeFlags&1028)!==0&&et!==null)et.return=$,V=et;else for(;V!==null;){$=V;try{var ft=$.alternate;if($.flags&1024)switch($.tag){case 0:case 11:case 15:break;case 1:if(ft!==null){var pt=ft.memoizedProps,St=ft.memoizedState,gt=$.stateNode,yt=gt.getSnapshotBeforeUpdate($.elementType===$.type?pt:Ci($.type,pt),St);gt.__reactInternalSnapshotBeforeUpdate=yt}break;case 3:var vt=$.stateNode.containerInfo;vt.nodeType===1?vt.textContent="":vt.nodeType===9&&vt.documentElement&&vt.removeChild(vt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(Ct){W($,$.return,Ct)}if(et=$.sibling,et!==null){et.return=$.return,V=et;break}V=$.return}return ft=Nj,Nj=!1,ft}function Pj(et,$,_){var tt=$.updateQueue;if(tt=tt!==null?tt.lastEffect:null,tt!==null){var nt=tt=tt.next;do{if((nt.tag&et)===et){var it=nt.destroy;nt.destroy=void 0,it!==void 0&&Mj($,_,it)}nt=nt.next}while(nt!==tt)}}function Qj(et,$){if($=$.updateQueue,$=$!==null?$.lastEffect:null,$!==null){var _=$=$.next;do{if((_.tag&et)===et){var tt=_.create;_.destroy=tt()}_=_.next}while(_!==$)}}function Rj(et){var $=et.ref;if($!==null){var _=et.stateNode;switch(et.tag){case 5:et=_;break;default:et=_}typeof $=="function"?$(et):$.current=et}}function Sj(et){var $=et.alternate;$!==null&&(et.alternate=null,Sj($)),et.child=null,et.deletions=null,et.sibling=null,et.tag===5&&($=et.stateNode,$!==null&&(delete $[Of],delete $[Pf],delete $[of],delete $[Qf],delete $[Rf])),et.stateNode=null,et.return=null,et.dependencies=null,et.memoizedProps=null,et.memoizedState=null,et.pendingProps=null,et.stateNode=null,et.updateQueue=null}function Tj(et){return et.tag===5||et.tag===3||et.tag===4}function Uj(et){e:for(;;){for(;et.sibling===null;){if(et.return===null||Tj(et.return))return null;et=et.return}for(et.sibling.return=et.return,et=et.sibling;et.tag!==5&&et.tag!==6&&et.tag!==18;){if(et.flags&2||et.child===null||et.tag===4)continue e;et.child.return=et,et=et.child}if(!(et.flags&2))return et.stateNode}}function Vj(et,$,_){var tt=et.tag;if(tt===5||tt===6)et=et.stateNode,$?_.nodeType===8?_.parentNode.insertBefore(et,$):_.insertBefore(et,$):(_.nodeType===8?($=_.parentNode,$.insertBefore(et,_)):($=_,$.appendChild(et)),_=_._reactRootContainer,_!=null||$.onclick!==null||($.onclick=Bf));else if(tt!==4&&(et=et.child,et!==null))for(Vj(et,$,_),et=et.sibling;et!==null;)Vj(et,$,_),et=et.sibling}function Wj(et,$,_){var tt=et.tag;if(tt===5||tt===6)et=et.stateNode,$?_.insertBefore(et,$):_.appendChild(et);else if(tt!==4&&(et=et.child,et!==null))for(Wj(et,$,_),et=et.sibling;et!==null;)Wj(et,$,_),et=et.sibling}var X=null,Xj=!1;function Yj(et,$,_){for(_=_.child;_!==null;)Zj(et,$,_),_=_.sibling}function Zj(et,$,_){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,_)}catch{}switch(_.tag){case 5:U||Lj(_,$);case 6:var tt=X,nt=Xj;X=null,Yj(et,$,_),X=tt,Xj=nt,X!==null&&(Xj?(et=X,_=_.stateNode,et.nodeType===8?et.parentNode.removeChild(_):et.removeChild(_)):X.removeChild(_.stateNode));break;case 18:X!==null&&(Xj?(et=X,_=_.stateNode,et.nodeType===8?Kf(et.parentNode,_):et.nodeType===1&&Kf(et,_),bd(et)):Kf(X,_.stateNode));break;case 4:tt=X,nt=Xj,X=_.stateNode.containerInfo,Xj=!0,Yj(et,$,_),X=tt,Xj=nt;break;case 0:case 11:case 14:case 15:if(!U&&(tt=_.updateQueue,tt!==null&&(tt=tt.lastEffect,tt!==null))){nt=tt=tt.next;do{var it=nt,rt=it.destroy;it=it.tag,rt!==void 0&&(it&2||it&4)&&Mj(_,$,rt),nt=nt.next}while(nt!==tt)}Yj(et,$,_);break;case 1:if(!U&&(Lj(_,$),tt=_.stateNode,typeof tt.componentWillUnmount=="function"))try{tt.props=_.memoizedProps,tt.state=_.memoizedState,tt.componentWillUnmount()}catch(ot){W(_,$,ot)}Yj(et,$,_);break;case 21:Yj(et,$,_);break;case 22:_.mode&1?(U=(tt=U)||_.memoizedState!==null,Yj(et,$,_),U=tt):Yj(et,$,_);break;default:Yj(et,$,_)}}function ak(et){var $=et.updateQueue;if($!==null){et.updateQueue=null;var _=et.stateNode;_===null&&(_=et.stateNode=new Kj),$.forEach(function(tt){var nt=bk.bind(null,et,tt);_.has(tt)||(_.add(tt),tt.then(nt,nt))})}}function ck(et,$){var _=$.deletions;if(_!==null)for(var tt=0;tt<_.length;tt++){var nt=_[tt];try{var it=et,rt=$,ot=rt;e:for(;ot!==null;){switch(ot.tag){case 5:X=ot.stateNode,Xj=!1;break e;case 3:X=ot.stateNode.containerInfo,Xj=!0;break e;case 4:X=ot.stateNode.containerInfo,Xj=!0;break e}ot=ot.return}if(X===null)throw Error(p$1(160));Zj(it,rt,nt),X=null,Xj=!1;var lt=nt.alternate;lt!==null&&(lt.return=null),nt.return=null}catch(st){W(nt,$,st)}}if($.subtreeFlags&12854)for($=$.child;$!==null;)dk($,et),$=$.sibling}function dk(et,$){var _=et.alternate,tt=et.flags;switch(et.tag){case 0:case 11:case 14:case 15:if(ck($,et),ek(et),tt&4){try{Pj(3,et,et.return),Qj(3,et)}catch(pt){W(et,et.return,pt)}try{Pj(5,et,et.return)}catch(pt){W(et,et.return,pt)}}break;case 1:ck($,et),ek(et),tt&512&&_!==null&&Lj(_,_.return);break;case 5:if(ck($,et),ek(et),tt&512&&_!==null&&Lj(_,_.return),et.flags&32){var nt=et.stateNode;try{ob(nt,"")}catch(pt){W(et,et.return,pt)}}if(tt&4&&(nt=et.stateNode,nt!=null)){var it=et.memoizedProps,rt=_!==null?_.memoizedProps:it,ot=et.type,lt=et.updateQueue;if(et.updateQueue=null,lt!==null)try{ot==="input"&&it.type==="radio"&&it.name!=null&&ab(nt,it),vb(ot,rt);var st=vb(ot,it);for(rt=0;rt<lt.length;rt+=2){var at=lt[rt],ct=lt[rt+1];at==="style"?sb(nt,ct):at==="dangerouslySetInnerHTML"?nb(nt,ct):at==="children"?ob(nt,ct):ta(nt,at,ct,st)}switch(ot){case"input":bb(nt,it);break;case"textarea":ib(nt,it);break;case"select":var dt=nt._wrapperState.wasMultiple;nt._wrapperState.wasMultiple=!!it.multiple;var ut=it.value;ut!=null?fb(nt,!!it.multiple,ut,!1):dt!==!!it.multiple&&(it.defaultValue!=null?fb(nt,!!it.multiple,it.defaultValue,!0):fb(nt,!!it.multiple,it.multiple?[]:"",!1))}nt[Pf]=it}catch(pt){W(et,et.return,pt)}}break;case 6:if(ck($,et),ek(et),tt&4){if(et.stateNode===null)throw Error(p$1(162));nt=et.stateNode,it=et.memoizedProps;try{nt.nodeValue=it}catch(pt){W(et,et.return,pt)}}break;case 3:if(ck($,et),ek(et),tt&4&&_!==null&&_.memoizedState.isDehydrated)try{bd($.containerInfo)}catch(pt){W(et,et.return,pt)}break;case 4:ck($,et),ek(et);break;case 13:ck($,et),ek(et),nt=et.child,nt.flags&8192&&(it=nt.memoizedState!==null,nt.stateNode.isHidden=it,!it||nt.alternate!==null&&nt.alternate.memoizedState!==null||(fk=B())),tt&4&&ak(et);break;case 22:if(at=_!==null&&_.memoizedState!==null,et.mode&1?(U=(st=U)||at,ck($,et),U=st):ck($,et),ek(et),tt&8192){if(st=et.memoizedState!==null,(et.stateNode.isHidden=st)&&!at&&et.mode&1)for(V=et,at=et.child;at!==null;){for(ct=V=at;V!==null;){switch(dt=V,ut=dt.child,dt.tag){case 0:case 11:case 14:case 15:Pj(4,dt,dt.return);break;case 1:Lj(dt,dt.return);var ft=dt.stateNode;if(typeof ft.componentWillUnmount=="function"){tt=dt,_=dt.return;try{$=tt,ft.props=$.memoizedProps,ft.state=$.memoizedState,ft.componentWillUnmount()}catch(pt){W(tt,_,pt)}}break;case 5:Lj(dt,dt.return);break;case 22:if(dt.memoizedState!==null){gk(ct);continue}}ut!==null?(ut.return=dt,V=ut):gk(ct)}at=at.sibling}e:for(at=null,ct=et;;){if(ct.tag===5){if(at===null){at=ct;try{nt=ct.stateNode,st?(it=nt.style,typeof it.setProperty=="function"?it.setProperty("display","none","important"):it.display="none"):(ot=ct.stateNode,lt=ct.memoizedProps.style,rt=lt!=null&&lt.hasOwnProperty("display")?lt.display:null,ot.style.display=rb("display",rt))}catch(pt){W(et,et.return,pt)}}}else if(ct.tag===6){if(at===null)try{ct.stateNode.nodeValue=st?"":ct.memoizedProps}catch(pt){W(et,et.return,pt)}}else if((ct.tag!==22&&ct.tag!==23||ct.memoizedState===null||ct===et)&&ct.child!==null){ct.child.return=ct,ct=ct.child;continue}if(ct===et)break e;for(;ct.sibling===null;){if(ct.return===null||ct.return===et)break e;at===ct&&(at=null),ct=ct.return}at===ct&&(at=null),ct.sibling.return=ct.return,ct=ct.sibling}}break;case 19:ck($,et),ek(et),tt&4&&ak(et);break;case 21:break;default:ck($,et),ek(et)}}function ek(et){var $=et.flags;if($&2){try{e:{for(var _=et.return;_!==null;){if(Tj(_)){var tt=_;break e}_=_.return}throw Error(p$1(160))}switch(tt.tag){case 5:var nt=tt.stateNode;tt.flags&32&&(ob(nt,""),tt.flags&=-33);var it=Uj(et);Wj(et,it,nt);break;case 3:case 4:var rt=tt.stateNode.containerInfo,ot=Uj(et);Vj(et,ot,rt);break;default:throw Error(p$1(161))}}catch(lt){W(et,et.return,lt)}et.flags&=-3}$&4096&&(et.flags&=-4097)}function hk(et,$,_){V=et,ik(et)}function ik(et,$,_){for(var tt=(et.mode&1)!==0;V!==null;){var nt=V,it=nt.child;if(nt.tag===22&&tt){var rt=nt.memoizedState!==null||Jj;if(!rt){var ot=nt.alternate,lt=ot!==null&&ot.memoizedState!==null||U;ot=Jj;var st=U;if(Jj=rt,(U=lt)&&!st)for(V=nt;V!==null;)rt=V,lt=rt.child,rt.tag===22&&rt.memoizedState!==null?jk(nt):lt!==null?(lt.return=rt,V=lt):jk(nt);for(;it!==null;)V=it,ik(it),it=it.sibling;V=nt,Jj=ot,U=st}kk(et)}else nt.subtreeFlags&8772&&it!==null?(it.return=nt,V=it):kk(et)}}function kk(et){for(;V!==null;){var $=V;if($.flags&8772){var _=$.alternate;try{if($.flags&8772)switch($.tag){case 0:case 11:case 15:U||Qj(5,$);break;case 1:var tt=$.stateNode;if($.flags&4&&!U)if(_===null)tt.componentDidMount();else{var nt=$.elementType===$.type?_.memoizedProps:Ci($.type,_.memoizedProps);tt.componentDidUpdate(nt,_.memoizedState,tt.__reactInternalSnapshotBeforeUpdate)}var it=$.updateQueue;it!==null&&sh($,it,tt);break;case 3:var rt=$.updateQueue;if(rt!==null){if(_=null,$.child!==null)switch($.child.tag){case 5:_=$.child.stateNode;break;case 1:_=$.child.stateNode}sh($,rt,_)}break;case 5:var ot=$.stateNode;if(_===null&&$.flags&4){_=ot;var lt=$.memoizedProps;switch($.type){case"button":case"input":case"select":case"textarea":lt.autoFocus&&_.focus();break;case"img":lt.src&&(_.src=lt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if($.memoizedState===null){var st=$.alternate;if(st!==null){var at=st.memoizedState;if(at!==null){var ct=at.dehydrated;ct!==null&&bd(ct)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U||$.flags&512&&Rj($)}catch(dt){W($,$.return,dt)}}if($===et){V=null;break}if(_=$.sibling,_!==null){_.return=$.return,V=_;break}V=$.return}}function gk(et){for(;V!==null;){var $=V;if($===et){V=null;break}var _=$.sibling;if(_!==null){_.return=$.return,V=_;break}V=$.return}}function jk(et){for(;V!==null;){var $=V;try{switch($.tag){case 0:case 11:case 15:var _=$.return;try{Qj(4,$)}catch(lt){W($,_,lt)}break;case 1:var tt=$.stateNode;if(typeof tt.componentDidMount=="function"){var nt=$.return;try{tt.componentDidMount()}catch(lt){W($,nt,lt)}}var it=$.return;try{Rj($)}catch(lt){W($,it,lt)}break;case 5:var rt=$.return;try{Rj($)}catch(lt){W($,rt,lt)}}}catch(lt){W($,$.return,lt)}if($===et){V=null;break}var ot=$.sibling;if(ot!==null){ot.return=$.return,V=ot;break}V=$.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(et){return et.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(et=C,et!==0||(et=window.event,et=et===void 0?16:jd(et.type)),et):1}function gi(et,$,_,tt){if(50<yk)throw yk=0,zk=null,Error(p$1(185));Ac(et,_,tt),(!(K&2)||et!==Q)&&(et===Q&&(!(K&2)&&(qk|=_),T===4&&Ck(et,Z)),Dk(et,tt),_===1&&K===0&&!($.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(et,$){var _=et.callbackNode;wc(et,$);var tt=uc(et,et===Q?Z:0);if(tt===0)_!==null&&bc(_),et.callbackNode=null,et.callbackPriority=0;else if($=tt&-tt,et.callbackPriority!==$){if(_!=null&&bc(_),$===1)et.tag===0?ig(Ek.bind(null,et)):hg(Ek.bind(null,et)),Jf(function(){!(K&6)&&jg()}),_=null;else{switch(Dc(tt)){case 1:_=fc;break;case 4:_=gc;break;case 16:_=hc;break;case 536870912:_=jc;break;default:_=hc}_=Fk(_,Gk.bind(null,et))}et.callbackPriority=$,et.callbackNode=_}}function Gk(et,$){if(Ak=-1,Bk=0,K&6)throw Error(p$1(327));var _=et.callbackNode;if(Hk()&&et.callbackNode!==_)return null;var tt=uc(et,et===Q?Z:0);if(tt===0)return null;if(tt&30||tt&et.expiredLanes||$)$=Ik(et,tt);else{$=tt;var nt=K;K|=2;var it=Jk();(Q!==et||Z!==$)&&(uk=null,Gj=B()+500,Kk(et,$));do try{Lk();break}catch(ot){Mk(et,ot)}while(1);$g(),mk.current=it,K=nt,Y!==null?$=0:(Q=null,Z=0,$=T)}if($!==0){if($===2&&(nt=xc(et),nt!==0&&(tt=nt,$=Nk(et,nt))),$===1)throw _=pk,Kk(et,0),Ck(et,tt),Dk(et,B()),_;if($===6)Ck(et,tt);else{if(nt=et.current.alternate,!(tt&30)&&!Ok(nt)&&($=Ik(et,tt),$===2&&(it=xc(et),it!==0&&(tt=it,$=Nk(et,it))),$===1))throw _=pk,Kk(et,0),Ck(et,tt),Dk(et,B()),_;switch(et.finishedWork=nt,et.finishedLanes=tt,$){case 0:case 1:throw Error(p$1(345));case 2:Pk(et,tk,uk);break;case 3:if(Ck(et,tt),(tt&130023424)===tt&&($=fk+500-B(),10<$)){if(uc(et,0)!==0)break;if(nt=et.suspendedLanes,(nt&tt)!==tt){R(),et.pingedLanes|=et.suspendedLanes&nt;break}et.timeoutHandle=Ff(Pk.bind(null,et,tk,uk),$);break}Pk(et,tk,uk);break;case 4:if(Ck(et,tt),(tt&4194240)===tt)break;for($=et.eventTimes,nt=-1;0<tt;){var rt=31-oc(tt);it=1<<rt,rt=$[rt],rt>nt&&(nt=rt),tt&=~it}if(tt=nt,tt=B()-tt,tt=(120>tt?120:480>tt?480:1080>tt?1080:1920>tt?1920:3e3>tt?3e3:4320>tt?4320:1960*lk(tt/1960))-tt,10<tt){et.timeoutHandle=Ff(Pk.bind(null,et,tk,uk),tt);break}Pk(et,tk,uk);break;case 5:Pk(et,tk,uk);break;default:throw Error(p$1(329))}}}return Dk(et,B()),et.callbackNode===_?Gk.bind(null,et):null}function Nk(et,$){var _=sk;return et.current.memoizedState.isDehydrated&&(Kk(et,$).flags|=256),et=Ik(et,$),et!==2&&($=tk,tk=_,$!==null&&Fj($)),et}function Fj(et){tk===null?tk=et:tk.push.apply(tk,et)}function Ok(et){for(var $=et;;){if($.flags&16384){var _=$.updateQueue;if(_!==null&&(_=_.stores,_!==null))for(var tt=0;tt<_.length;tt++){var nt=_[tt],it=nt.getSnapshot;nt=nt.value;try{if(!He(it(),nt))return!1}catch{return!1}}}if(_=$.child,$.subtreeFlags&16384&&_!==null)_.return=$,$=_;else{if($===et)break;for(;$.sibling===null;){if($.return===null||$.return===et)return!0;$=$.return}$.sibling.return=$.return,$=$.sibling}}return!0}function Ck(et,$){for($&=~rk,$&=~qk,et.suspendedLanes|=$,et.pingedLanes&=~$,et=et.expirationTimes;0<$;){var _=31-oc($),tt=1<<_;et[_]=-1,$&=~tt}}function Ek(et){if(K&6)throw Error(p$1(327));Hk();var $=uc(et,0);if(!($&1))return Dk(et,B()),null;var _=Ik(et,$);if(et.tag!==0&&_===2){var tt=xc(et);tt!==0&&($=tt,_=Nk(et,tt))}if(_===1)throw _=pk,Kk(et,0),Ck(et,$),Dk(et,B()),_;if(_===6)throw Error(p$1(345));return et.finishedWork=et.current.alternate,et.finishedLanes=$,Pk(et,tk,uk),Dk(et,B()),null}function Qk(et,$){var _=K;K|=1;try{return et($)}finally{K=_,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(et){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var $=K;K|=1;var _=ok.transition,tt=C;try{if(ok.transition=null,C=1,et)return et()}finally{C=tt,ok.transition=_,K=$,!(K&6)&&jg()}}function Hj(){fj=ej.current,E(ej)}function Kk(et,$){et.finishedWork=null,et.finishedLanes=0;var _=et.timeoutHandle;if(_!==-1&&(et.timeoutHandle=-1,Gf(_)),Y!==null)for(_=Y.return;_!==null;){var tt=_;switch(wg(tt),tt.tag){case 1:tt=tt.type.childContextTypes,tt!=null&&$f();break;case 3:zh(),E(Wf),E(H),Eh();break;case 5:Bh(tt);break;case 4:zh();break;case 13:E(L);break;case 19:E(L);break;case 10:ah(tt.type._context);break;case 22:case 23:Hj()}_=_.return}if(Q=et,Y=et=Pg(et.current,null),Z=fj=$,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for($=0;$<fh.length;$++)if(_=fh[$],tt=_.interleaved,tt!==null){_.interleaved=null;var nt=tt.next,it=_.pending;if(it!==null){var rt=it.next;it.next=nt,tt.next=rt}_.pending=tt}fh=null}return et}function Mk(et,$){do{var _=Y;try{if($g(),Fh.current=Rh,Ih){for(var tt=M.memoizedState;tt!==null;){var nt=tt.queue;nt!==null&&(nt.pending=null),tt=tt.next}Ih=!1}if(Hh=0,O=N=M=null,Jh=!1,Kh=0,nk.current=null,_===null||_.return===null){T=1,pk=$,Y=null;break}e:{var it=et,rt=_.return,ot=_,lt=$;if($=Z,ot.flags|=32768,lt!==null&&typeof lt=="object"&&typeof lt.then=="function"){var st=lt,at=ot,ct=at.tag;if(!(at.mode&1)&&(ct===0||ct===11||ct===15)){var dt=at.alternate;dt?(at.updateQueue=dt.updateQueue,at.memoizedState=dt.memoizedState,at.lanes=dt.lanes):(at.updateQueue=null,at.memoizedState=null)}var ut=Ui(rt);if(ut!==null){ut.flags&=-257,Vi(ut,rt,ot,it,$),ut.mode&1&&Si(it,st,$),$=ut,lt=st;var ft=$.updateQueue;if(ft===null){var pt=new Set;pt.add(lt),$.updateQueue=pt}else ft.add(lt);break e}else{if(!($&1)){Si(it,st,$),tj();break e}lt=Error(p$1(426))}}else if(I&&ot.mode&1){var St=Ui(rt);if(St!==null){!(St.flags&65536)&&(St.flags|=256),Vi(St,rt,ot,it,$),Jg(Ji(lt,ot));break e}}it=lt=Ji(lt,ot),T!==4&&(T=2),sk===null?sk=[it]:sk.push(it),it=rt;do{switch(it.tag){case 3:it.flags|=65536,$&=-$,it.lanes|=$;var gt=Ni(it,lt,$);ph(it,gt);break e;case 1:ot=lt;var yt=it.type,vt=it.stateNode;if(!(it.flags&128)&&(typeof yt.getDerivedStateFromError=="function"||vt!==null&&typeof vt.componentDidCatch=="function"&&(Ri===null||!Ri.has(vt)))){it.flags|=65536,$&=-$,it.lanes|=$;var Ct=Qi(it,ot,$);ph(it,Ct);break e}}it=it.return}while(it!==null)}Sk(_)}catch(Et){$=Et,Y===_&&_!==null&&(Y=_=_.return);continue}break}while(1)}function Jk(){var et=mk.current;return mk.current=Rh,et===null?Rh:et}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(et,$){var _=K;K|=2;var tt=Jk();(Q!==et||Z!==$)&&(uk=null,Kk(et,$));do try{Tk();break}catch(nt){Mk(et,nt)}while(1);if($g(),K=_,mk.current=tt,Y!==null)throw Error(p$1(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(et){var $=Vk(et.alternate,et,fj);et.memoizedProps=et.pendingProps,$===null?Sk(et):Y=$,nk.current=null}function Sk(et){var $=et;do{var _=$.alternate;if(et=$.return,$.flags&32768){if(_=Ij(_,$),_!==null){_.flags&=32767,Y=_;return}if(et!==null)et.flags|=32768,et.subtreeFlags=0,et.deletions=null;else{T=6,Y=null;return}}else if(_=Ej(_,$,fj),_!==null){Y=_;return}if($=$.sibling,$!==null){Y=$;return}Y=$=et}while($!==null);T===0&&(T=5)}function Pk(et,$,_){var tt=C,nt=ok.transition;try{ok.transition=null,C=1,Wk(et,$,_,tt)}finally{ok.transition=nt,C=tt}return null}function Wk(et,$,_,tt){do Hk();while(wk!==null);if(K&6)throw Error(p$1(327));_=et.finishedWork;var nt=et.finishedLanes;if(_===null)return null;if(et.finishedWork=null,et.finishedLanes=0,_===et.current)throw Error(p$1(177));et.callbackNode=null,et.callbackPriority=0;var it=_.lanes|_.childLanes;if(Bc(et,it),et===Q&&(Y=Q=null,Z=0),!(_.subtreeFlags&2064)&&!(_.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),it=(_.flags&15990)!==0,_.subtreeFlags&15990||it){it=ok.transition,ok.transition=null;var rt=C;C=1;var ot=K;K|=4,nk.current=null,Oj(et,_),dk(_,et),Oe(Df),dd=!!Cf,Df=Cf=null,et.current=_,hk(_),dc(),K=ot,C=rt,ok.transition=it}else et.current=_;if(vk&&(vk=!1,wk=et,xk=nt),it=et.pendingLanes,it===0&&(Ri=null),mc(_.stateNode),Dk(et,B()),$!==null)for(tt=et.onRecoverableError,_=0;_<$.length;_++)nt=$[_],tt(nt.value,{componentStack:nt.stack,digest:nt.digest});if(Oi)throw Oi=!1,et=Pi,Pi=null,et;return xk&1&&et.tag!==0&&Hk(),it=et.pendingLanes,it&1?et===zk?yk++:(yk=0,zk=et):yk=0,jg(),null}function Hk(){if(wk!==null){var et=Dc(xk),$=ok.transition,_=C;try{if(ok.transition=null,C=16>et?16:et,wk===null)var tt=!1;else{if(et=wk,wk=null,xk=0,K&6)throw Error(p$1(331));var nt=K;for(K|=4,V=et.current;V!==null;){var it=V,rt=it.child;if(V.flags&16){var ot=it.deletions;if(ot!==null){for(var lt=0;lt<ot.length;lt++){var st=ot[lt];for(V=st;V!==null;){var at=V;switch(at.tag){case 0:case 11:case 15:Pj(8,at,it)}var ct=at.child;if(ct!==null)ct.return=at,V=ct;else for(;V!==null;){at=V;var dt=at.sibling,ut=at.return;if(Sj(at),at===st){V=null;break}if(dt!==null){dt.return=ut,V=dt;break}V=ut}}}var ft=it.alternate;if(ft!==null){var pt=ft.child;if(pt!==null){ft.child=null;do{var St=pt.sibling;pt.sibling=null,pt=St}while(pt!==null)}}V=it}}if(it.subtreeFlags&2064&&rt!==null)rt.return=it,V=rt;else e:for(;V!==null;){if(it=V,it.flags&2048)switch(it.tag){case 0:case 11:case 15:Pj(9,it,it.return)}var gt=it.sibling;if(gt!==null){gt.return=it.return,V=gt;break e}V=it.return}}var yt=et.current;for(V=yt;V!==null;){rt=V;var vt=rt.child;if(rt.subtreeFlags&2064&&vt!==null)vt.return=rt,V=vt;else e:for(rt=yt;V!==null;){if(ot=V,ot.flags&2048)try{switch(ot.tag){case 0:case 11:case 15:Qj(9,ot)}}catch(Et){W(ot,ot.return,Et)}if(ot===rt){V=null;break e}var Ct=ot.sibling;if(Ct!==null){Ct.return=ot.return,V=Ct;break e}V=ot.return}}if(K=nt,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,et)}catch{}tt=!0}return tt}finally{C=_,ok.transition=$}}return!1}function Xk(et,$,_){$=Ji(_,$),$=Ni(et,$,1),et=nh(et,$,1),$=R(),et!==null&&(Ac(et,1,$),Dk(et,$))}function W(et,$,_){if(et.tag===3)Xk(et,et,_);else for(;$!==null;){if($.tag===3){Xk($,et,_);break}else if($.tag===1){var tt=$.stateNode;if(typeof $.type.getDerivedStateFromError=="function"||typeof tt.componentDidCatch=="function"&&(Ri===null||!Ri.has(tt))){et=Ji(_,et),et=Qi($,et,1),$=nh($,et,1),et=R(),$!==null&&(Ac($,1,et),Dk($,et));break}}$=$.return}}function Ti(et,$,_){var tt=et.pingCache;tt!==null&&tt.delete($),$=R(),et.pingedLanes|=et.suspendedLanes&_,Q===et&&(Z&_)===_&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(et,0):rk|=_),Dk(et,$)}function Yk(et,$){$===0&&(et.mode&1?($=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):$=1);var _=R();et=ih(et,$),et!==null&&(Ac(et,$,_),Dk(et,_))}function uj(et){var $=et.memoizedState,_=0;$!==null&&(_=$.retryLane),Yk(et,_)}function bk(et,$){var _=0;switch(et.tag){case 13:var tt=et.stateNode,nt=et.memoizedState;nt!==null&&(_=nt.retryLane);break;case 19:tt=et.stateNode;break;default:throw Error(p$1(314))}tt!==null&&tt.delete($),Yk(et,_)}var Vk;Vk=function(et,$,_){if(et!==null)if(et.memoizedProps!==$.pendingProps||Wf.current)dh=!0;else{if(!(et.lanes&_)&&!($.flags&128))return dh=!1,yj(et,$,_);dh=!!(et.flags&131072)}else dh=!1,I&&$.flags&1048576&&ug($,ng,$.index);switch($.lanes=0,$.tag){case 2:var tt=$.type;ij(et,$),et=$.pendingProps;var nt=Yf($,H.current);ch($,_),nt=Nh(null,$,tt,et,nt,_);var it=Sh();return $.flags|=1,typeof nt=="object"&&nt!==null&&typeof nt.render=="function"&&nt.$$typeof===void 0?($.tag=1,$.memoizedState=null,$.updateQueue=null,Zf(tt)?(it=!0,cg($)):it=!1,$.memoizedState=nt.state!==null&&nt.state!==void 0?nt.state:null,kh($),nt.updater=Ei,$.stateNode=nt,nt._reactInternals=$,Ii($,tt,et,_),$=jj(null,$,tt,!0,it,_)):($.tag=0,I&&it&&vg($),Xi(null,$,nt,_),$=$.child),$;case 16:tt=$.elementType;e:{switch(ij(et,$),et=$.pendingProps,nt=tt._init,tt=nt(tt._payload),$.type=tt,nt=$.tag=Zk(tt),et=Ci(tt,et),nt){case 0:$=cj(null,$,tt,et,_);break e;case 1:$=hj(null,$,tt,et,_);break e;case 11:$=Yi(null,$,tt,et,_);break e;case 14:$=$i(null,$,tt,Ci(tt.type,et),_);break e}throw Error(p$1(306,tt,""))}return $;case 0:return tt=$.type,nt=$.pendingProps,nt=$.elementType===tt?nt:Ci(tt,nt),cj(et,$,tt,nt,_);case 1:return tt=$.type,nt=$.pendingProps,nt=$.elementType===tt?nt:Ci(tt,nt),hj(et,$,tt,nt,_);case 3:e:{if(kj($),et===null)throw Error(p$1(387));tt=$.pendingProps,it=$.memoizedState,nt=it.element,lh(et,$),qh($,tt,null,_);var rt=$.memoizedState;if(tt=rt.element,it.isDehydrated)if(it={element:tt,isDehydrated:!1,cache:rt.cache,pendingSuspenseBoundaries:rt.pendingSuspenseBoundaries,transitions:rt.transitions},$.updateQueue.baseState=it,$.memoizedState=it,$.flags&256){nt=Ji(Error(p$1(423)),$),$=lj(et,$,tt,_,nt);break e}else if(tt!==nt){nt=Ji(Error(p$1(424)),$),$=lj(et,$,tt,_,nt);break e}else for(yg=Lf($.stateNode.containerInfo.firstChild),xg=$,I=!0,zg=null,_=Vg($,null,tt,_),$.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling;else{if(Ig(),tt===nt){$=Zi(et,$,_);break e}Xi(et,$,tt,_)}$=$.child}return $;case 5:return Ah($),et===null&&Eg($),tt=$.type,nt=$.pendingProps,it=et!==null?et.memoizedProps:null,rt=nt.children,Ef(tt,nt)?rt=null:it!==null&&Ef(tt,it)&&($.flags|=32),gj(et,$),Xi(et,$,rt,_),$.child;case 6:return et===null&&Eg($),null;case 13:return oj(et,$,_);case 4:return yh($,$.stateNode.containerInfo),tt=$.pendingProps,et===null?$.child=Ug($,null,tt,_):Xi(et,$,tt,_),$.child;case 11:return tt=$.type,nt=$.pendingProps,nt=$.elementType===tt?nt:Ci(tt,nt),Yi(et,$,tt,nt,_);case 7:return Xi(et,$,$.pendingProps,_),$.child;case 8:return Xi(et,$,$.pendingProps.children,_),$.child;case 12:return Xi(et,$,$.pendingProps.children,_),$.child;case 10:e:{if(tt=$.type._context,nt=$.pendingProps,it=$.memoizedProps,rt=nt.value,G(Wg,tt._currentValue),tt._currentValue=rt,it!==null)if(He(it.value,rt)){if(it.children===nt.children&&!Wf.current){$=Zi(et,$,_);break e}}else for(it=$.child,it!==null&&(it.return=$);it!==null;){var ot=it.dependencies;if(ot!==null){rt=it.child;for(var lt=ot.firstContext;lt!==null;){if(lt.context===tt){if(it.tag===1){lt=mh(-1,_&-_),lt.tag=2;var st=it.updateQueue;if(st!==null){st=st.shared;var at=st.pending;at===null?lt.next=lt:(lt.next=at.next,at.next=lt),st.pending=lt}}it.lanes|=_,lt=it.alternate,lt!==null&&(lt.lanes|=_),bh(it.return,_,$),ot.lanes|=_;break}lt=lt.next}}else if(it.tag===10)rt=it.type===$.type?null:it.child;else if(it.tag===18){if(rt=it.return,rt===null)throw Error(p$1(341));rt.lanes|=_,ot=rt.alternate,ot!==null&&(ot.lanes|=_),bh(rt,_,$),rt=it.sibling}else rt=it.child;if(rt!==null)rt.return=it;else for(rt=it;rt!==null;){if(rt===$){rt=null;break}if(it=rt.sibling,it!==null){it.return=rt.return,rt=it;break}rt=rt.return}it=rt}Xi(et,$,nt.children,_),$=$.child}return $;case 9:return nt=$.type,tt=$.pendingProps.children,ch($,_),nt=eh(nt),tt=tt(nt),$.flags|=1,Xi(et,$,tt,_),$.child;case 14:return tt=$.type,nt=Ci(tt,$.pendingProps),nt=Ci(tt.type,nt),$i(et,$,tt,nt,_);case 15:return bj(et,$,$.type,$.pendingProps,_);case 17:return tt=$.type,nt=$.pendingProps,nt=$.elementType===tt?nt:Ci(tt,nt),ij(et,$),$.tag=1,Zf(tt)?(et=!0,cg($)):et=!1,ch($,_),Gi($,tt,nt),Ii($,tt,nt,_),jj(null,$,tt,!0,et,_);case 19:return xj(et,$,_);case 22:return dj(et,$,_)}throw Error(p$1(156,$.tag))};function Fk(et,$){return ac(et,$)}function $k(et,$,_,tt){this.tag=et,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=$,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=tt,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(et,$,_,tt){return new $k(et,$,_,tt)}function aj(et){return et=et.prototype,!(!et||!et.isReactComponent)}function Zk(et){if(typeof et=="function")return aj(et)?1:0;if(et!=null){if(et=et.$$typeof,et===Da)return 11;if(et===Ga)return 14}return 2}function Pg(et,$){var _=et.alternate;return _===null?(_=Bg(et.tag,$,et.key,et.mode),_.elementType=et.elementType,_.type=et.type,_.stateNode=et.stateNode,_.alternate=et,et.alternate=_):(_.pendingProps=$,_.type=et.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=et.flags&14680064,_.childLanes=et.childLanes,_.lanes=et.lanes,_.child=et.child,_.memoizedProps=et.memoizedProps,_.memoizedState=et.memoizedState,_.updateQueue=et.updateQueue,$=et.dependencies,_.dependencies=$===null?null:{lanes:$.lanes,firstContext:$.firstContext},_.sibling=et.sibling,_.index=et.index,_.ref=et.ref,_}function Rg(et,$,_,tt,nt,it){var rt=2;if(tt=et,typeof et=="function")aj(et)&&(rt=1);else if(typeof et=="string")rt=5;else e:switch(et){case ya:return Tg(_.children,nt,it,$);case za:rt=8,nt|=8;break;case Aa:return et=Bg(12,_,$,nt|2),et.elementType=Aa,et.lanes=it,et;case Ea:return et=Bg(13,_,$,nt),et.elementType=Ea,et.lanes=it,et;case Fa:return et=Bg(19,_,$,nt),et.elementType=Fa,et.lanes=it,et;case Ia:return pj(_,nt,it,$);default:if(typeof et=="object"&&et!==null)switch(et.$$typeof){case Ba:rt=10;break e;case Ca:rt=9;break e;case Da:rt=11;break e;case Ga:rt=14;break e;case Ha:rt=16,tt=null;break e}throw Error(p$1(130,et==null?et:typeof et,""))}return $=Bg(rt,_,$,nt),$.elementType=et,$.type=tt,$.lanes=it,$}function Tg(et,$,_,tt){return et=Bg(7,et,tt,$),et.lanes=_,et}function pj(et,$,_,tt){return et=Bg(22,et,tt,$),et.elementType=Ia,et.lanes=_,et.stateNode={isHidden:!1},et}function Qg(et,$,_){return et=Bg(6,et,null,$),et.lanes=_,et}function Sg(et,$,_){return $=Bg(4,et.children!==null?et.children:[],et.key,$),$.lanes=_,$.stateNode={containerInfo:et.containerInfo,pendingChildren:null,implementation:et.implementation},$}function al(et,$,_,tt,nt){this.tag=$,this.containerInfo=et,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=tt,this.onRecoverableError=nt,this.mutableSourceEagerHydrationData=null}function bl(et,$,_,tt,nt,it,rt,ot,lt){return et=new al(et,$,_,ot,lt),$===1?($=1,it===!0&&($|=8)):$=0,it=Bg(3,null,null,$),et.current=it,it.stateNode=et,it.memoizedState={element:tt,isDehydrated:_,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(it),et}function cl(et,$,_){var tt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:tt==null?null:""+tt,children:et,containerInfo:$,implementation:_}}function dl(et){if(!et)return Vf;et=et._reactInternals;e:{if(Vb(et)!==et||et.tag!==1)throw Error(p$1(170));var $=et;do{switch($.tag){case 3:$=$.stateNode.context;break e;case 1:if(Zf($.type)){$=$.stateNode.__reactInternalMemoizedMergedChildContext;break e}}$=$.return}while($!==null);throw Error(p$1(171))}if(et.tag===1){var _=et.type;if(Zf(_))return bg(et,_,$)}return $}function el(et,$,_,tt,nt,it,rt,ot,lt){return et=bl(_,tt,!0,et,nt,it,rt,ot,lt),et.context=dl(null),_=et.current,tt=R(),nt=yi(_),it=mh(tt,nt),it.callback=$??null,nh(_,it,nt),et.current.lanes=nt,Ac(et,nt,tt),Dk(et,tt),et}function fl(et,$,_,tt){var nt=$.current,it=R(),rt=yi(nt);return _=dl(_),$.context===null?$.context=_:$.pendingContext=_,$=mh(it,rt),$.payload={element:et},tt=tt===void 0?null:tt,tt!==null&&($.callback=tt),et=nh(nt,$,rt),et!==null&&(gi(et,nt,rt,it),oh(et,nt,rt)),rt}function gl(et){if(et=et.current,!et.child)return null;switch(et.child.tag){case 5:return et.child.stateNode;default:return et.child.stateNode}}function hl(et,$){if(et=et.memoizedState,et!==null&&et.dehydrated!==null){var _=et.retryLane;et.retryLane=_!==0&&_<$?_:$}}function il(et,$){hl(et,$),(et=et.alternate)&&hl(et,$)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(et){console.error(et)};function ll(et){this._internalRoot=et}ml.prototype.render=ll.prototype.render=function(et){var $=this._internalRoot;if($===null)throw Error(p$1(409));fl(et,$,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var et=this._internalRoot;if(et!==null){this._internalRoot=null;var $=et.containerInfo;Rk(function(){fl(null,et,null,null)}),$[uf]=null}};function ml(et){this._internalRoot=et}ml.prototype.unstable_scheduleHydration=function(et){if(et){var $=Hc();et={blockedOn:null,target:et,priority:$};for(var _=0;_<Qc.length&&$!==0&&$<Qc[_].priority;_++);Qc.splice(_,0,et),_===0&&Vc(et)}};function nl(et){return!(!et||et.nodeType!==1&&et.nodeType!==9&&et.nodeType!==11)}function ol(et){return!(!et||et.nodeType!==1&&et.nodeType!==9&&et.nodeType!==11&&(et.nodeType!==8||et.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(et,$,_,tt,nt){if(nt){if(typeof tt=="function"){var it=tt;tt=function(){var st=gl(rt);it.call(st)}}var rt=el($,tt,et,0,null,!1,!1,"",pl);return et._reactRootContainer=rt,et[uf]=rt.current,sf(et.nodeType===8?et.parentNode:et),Rk(),rt}for(;nt=et.lastChild;)et.removeChild(nt);if(typeof tt=="function"){var ot=tt;tt=function(){var st=gl(lt);ot.call(st)}}var lt=bl(et,0,!1,null,null,!1,!1,"",pl);return et._reactRootContainer=lt,et[uf]=lt.current,sf(et.nodeType===8?et.parentNode:et),Rk(function(){fl($,lt,_,tt)}),lt}function rl(et,$,_,tt,nt){var it=_._reactRootContainer;if(it){var rt=it;if(typeof nt=="function"){var ot=nt;nt=function(){var lt=gl(rt);ot.call(lt)}}fl($,rt,et,nt)}else rt=ql(_,$,et,nt,tt);return gl(rt)}Ec=function(et){switch(et.tag){case 3:var $=et.stateNode;if($.current.memoizedState.isDehydrated){var _=tc($.pendingLanes);_!==0&&(Cc($,_|1),Dk($,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var tt=ih(et,1);if(tt!==null){var nt=R();gi(tt,et,1,nt)}}),il(et,1)}};Fc=function(et){if(et.tag===13){var $=ih(et,134217728);if($!==null){var _=R();gi($,et,134217728,_)}il(et,134217728)}};Gc=function(et){if(et.tag===13){var $=yi(et),_=ih(et,$);if(_!==null){var tt=R();gi(_,et,$,tt)}il(et,$)}};Hc=function(){return C};Ic=function(et,$){var _=C;try{return C=et,$()}finally{C=_}};yb=function(et,$,_){switch($){case"input":if(bb(et,_),$=_.name,_.type==="radio"&&$!=null){for(_=et;_.parentNode;)_=_.parentNode;for(_=_.querySelectorAll("input[name="+JSON.stringify(""+$)+'][type="radio"]'),$=0;$<_.length;$++){var tt=_[$];if(tt!==et&&tt.form===et.form){var nt=Db(tt);if(!nt)throw Error(p$1(90));Wa(tt),bb(tt,nt)}}}break;case"textarea":ib(et,_);break;case"select":$=_.value,$!=null&&fb(et,!!_.multiple,$,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(et){return et=Zb(et),et===null?null:et.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(et,$){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl($))throw Error(p$1(200));return cl(et,$,null,_)};reactDom_production_min.createRoot=function(et,$){if(!nl(et))throw Error(p$1(299));var _=!1,tt="",nt=kl;return $!=null&&($.unstable_strictMode===!0&&(_=!0),$.identifierPrefix!==void 0&&(tt=$.identifierPrefix),$.onRecoverableError!==void 0&&(nt=$.onRecoverableError)),$=bl(et,1,!1,null,null,_,!1,tt,nt),et[uf]=$.current,sf(et.nodeType===8?et.parentNode:et),new ll($)};reactDom_production_min.findDOMNode=function(et){if(et==null)return null;if(et.nodeType===1)return et;var $=et._reactInternals;if($===void 0)throw typeof et.render=="function"?Error(p$1(188)):(et=Object.keys(et).join(","),Error(p$1(268,et)));return et=Zb($),et=et===null?null:et.stateNode,et};reactDom_production_min.flushSync=function(et){return Rk(et)};reactDom_production_min.hydrate=function(et,$,_){if(!ol($))throw Error(p$1(200));return rl(null,et,$,!0,_)};reactDom_production_min.hydrateRoot=function(et,$,_){if(!nl(et))throw Error(p$1(405));var tt=_!=null&&_.hydratedSources||null,nt=!1,it="",rt=kl;if(_!=null&&(_.unstable_strictMode===!0&&(nt=!0),_.identifierPrefix!==void 0&&(it=_.identifierPrefix),_.onRecoverableError!==void 0&&(rt=_.onRecoverableError)),$=el($,null,et,1,_??null,nt,!1,it,rt),et[uf]=$.current,sf(et),tt)for(et=0;et<tt.length;et++)_=tt[et],nt=_._getVersion,nt=nt(_._source),$.mutableSourceEagerHydrationData==null?$.mutableSourceEagerHydrationData=[_,nt]:$.mutableSourceEagerHydrationData.push(_,nt);return new ml($)};reactDom_production_min.render=function(et,$,_){if(!ol($))throw Error(p$1(200));return rl(null,et,$,!1,_)};reactDom_production_min.unmountComponentAtNode=function(et){if(!ol(et))throw Error(p$1(40));return et._reactRootContainer?(Rk(function(){rl(null,null,et,!1,function(){et._reactRootContainer=null,et[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(et,$,_,tt){if(!ol(_))throw Error(p$1(200));if(et==null||et._reactInternals===void 0)throw Error(p$1(38));return rl(et,$,_,!1,tt)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(et){console.error(et)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m$1=reactDomExports;client.createRoot=m$1.createRoot,client.hydrateRoot=m$1.hydrateRoot;/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var AuthenticationDetails=function(){function et(_){var tt=_||{},nt=tt.ValidationData,it=tt.Username,rt=tt.Password,ot=tt.AuthParameters,lt=tt.ClientMetadata;this.validationData=nt||{},this.authParameters=ot||{},this.clientMetadata=lt||{},this.username=it,this.password=rt}var $=et.prototype;return $.getUsername=function(){return this.username},$.getPassword=function(){return this.password},$.getValidationData=function(){return this.validationData},$.getAuthParameters=function(){return this.authParameters},$.getClientMetadata=function(){return this.clientMetadata},et}(),buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i$1=0,len=code.length;i$1<len;++i$1)lookup[i$1]=code[i$1],revLookup[code.charCodeAt(i$1)]=i$1;revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(et){var $=et.length;if($%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var _=et.indexOf("=");_===-1&&(_=$);var tt=_===$?0:4-_%4;return[_,tt]}function byteLength(et){var $=getLens(et),_=$[0],tt=$[1];return(_+tt)*3/4-tt}function _byteLength(et,$,_){return($+_)*3/4-_}function toByteArray(et){var $,_=getLens(et),tt=_[0],nt=_[1],it=new Arr(_byteLength(et,tt,nt)),rt=0,ot=nt>0?tt-4:tt,lt;for(lt=0;lt<ot;lt+=4)$=revLookup[et.charCodeAt(lt)]<<18|revLookup[et.charCodeAt(lt+1)]<<12|revLookup[et.charCodeAt(lt+2)]<<6|revLookup[et.charCodeAt(lt+3)],it[rt++]=$>>16&255,it[rt++]=$>>8&255,it[rt++]=$&255;return nt===2&&($=revLookup[et.charCodeAt(lt)]<<2|revLookup[et.charCodeAt(lt+1)]>>4,it[rt++]=$&255),nt===1&&($=revLookup[et.charCodeAt(lt)]<<10|revLookup[et.charCodeAt(lt+1)]<<4|revLookup[et.charCodeAt(lt+2)]>>2,it[rt++]=$>>8&255,it[rt++]=$&255),it}function tripletToBase64(et){return lookup[et>>18&63]+lookup[et>>12&63]+lookup[et>>6&63]+lookup[et&63]}function encodeChunk(et,$,_){for(var tt,nt=[],it=$;it<_;it+=3)tt=(et[it]<<16&16711680)+(et[it+1]<<8&65280)+(et[it+2]&255),nt.push(tripletToBase64(tt));return nt.join("")}function fromByteArray(et){for(var $,_=et.length,tt=_%3,nt=[],it=16383,rt=0,ot=_-tt;rt<ot;rt+=it)nt.push(encodeChunk(et,rt,rt+it>ot?ot:rt+it));return tt===1?($=et[_-1],nt.push(lookup[$>>2]+lookup[$<<4&63]+"==")):tt===2&&($=(et[_-2]<<8)+et[_-1],nt.push(lookup[$>>10]+lookup[$>>4&63]+lookup[$<<2&63]+"=")),nt.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(et,$,_,tt,nt){var it,rt,ot=nt*8-tt-1,lt=(1<<ot)-1,st=lt>>1,at=-7,ct=_?nt-1:0,dt=_?-1:1,ut=et[$+ct];for(ct+=dt,it=ut&(1<<-at)-1,ut>>=-at,at+=ot;at>0;it=it*256+et[$+ct],ct+=dt,at-=8);for(rt=it&(1<<-at)-1,it>>=-at,at+=tt;at>0;rt=rt*256+et[$+ct],ct+=dt,at-=8);if(it===0)it=1-st;else{if(it===lt)return rt?NaN:(ut?-1:1)*(1/0);rt=rt+Math.pow(2,tt),it=it-st}return(ut?-1:1)*rt*Math.pow(2,it-tt)};ieee754.write=function(et,$,_,tt,nt,it){var rt,ot,lt,st=it*8-nt-1,at=(1<<st)-1,ct=at>>1,dt=nt===23?Math.pow(2,-24)-Math.pow(2,-77):0,ut=tt?0:it-1,ft=tt?1:-1,pt=$<0||$===0&&1/$<0?1:0;for($=Math.abs($),isNaN($)||$===1/0?(ot=isNaN($)?1:0,rt=at):(rt=Math.floor(Math.log($)/Math.LN2),$*(lt=Math.pow(2,-rt))<1&&(rt--,lt*=2),rt+ct>=1?$+=dt/lt:$+=dt*Math.pow(2,1-ct),$*lt>=2&&(rt++,lt/=2),rt+ct>=at?(ot=0,rt=at):rt+ct>=1?(ot=($*lt-1)*Math.pow(2,nt),rt=rt+ct):(ot=$*Math.pow(2,ct-1)*Math.pow(2,nt),rt=0));nt>=8;et[_+ut]=ot&255,ut+=ft,ot/=256,nt-=8);for(rt=rt<<nt|ot,st+=nt;st>0;et[_+ut]=rt&255,ut+=ft,rt/=256,st-=8);et[_+ut-ft]|=pt*128};var toString$2={}.toString,isarray=Array.isArray||function(et){return toString$2.call(et)=="[object Array]"};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */(function(et){var $=base64Js,_=ieee754,tt=isarray;et.Buffer=ot,et.SlowBuffer=gt,et.INSPECT_MAX_BYTES=50,ot.TYPED_ARRAY_SUPPORT=window.TYPED_ARRAY_SUPPORT!==void 0?window.TYPED_ARRAY_SUPPORT:nt(),et.kMaxLength=it();function nt(){try{var wt=new Uint8Array(1);return wt.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},wt.foo()===42&&typeof wt.subarray=="function"&&wt.subarray(1,1).byteLength===0}catch{return!1}}function it(){return ot.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function rt(wt,mt){if(it()<mt)throw new RangeError("Invalid typed array length");return ot.TYPED_ARRAY_SUPPORT?(wt=new Uint8Array(mt),wt.__proto__=ot.prototype):(wt===null&&(wt=new ot(mt)),wt.length=mt),wt}function ot(wt,mt,ht){if(!ot.TYPED_ARRAY_SUPPORT&&!(this instanceof ot))return new ot(wt,mt,ht);if(typeof wt=="number"){if(typeof mt=="string")throw new Error("If encoding is specified then the first argument must be a string");return ct(this,wt)}return lt(this,wt,mt,ht)}ot.poolSize=8192,ot._augment=function(wt){return wt.__proto__=ot.prototype,wt};function lt(wt,mt,ht,bt){if(typeof mt=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&mt instanceof ArrayBuffer?ft(wt,mt,ht,bt):typeof mt=="string"?dt(wt,mt,ht):pt(wt,mt)}ot.from=function(wt,mt,ht){return lt(null,wt,mt,ht)},ot.TYPED_ARRAY_SUPPORT&&(ot.prototype.__proto__=Uint8Array.prototype,ot.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&ot[Symbol.species]===ot&&Object.defineProperty(ot,Symbol.species,{value:null,configurable:!0}));function st(wt){if(typeof wt!="number")throw new TypeError('"size" argument must be a number');if(wt<0)throw new RangeError('"size" argument must not be negative')}function at(wt,mt,ht,bt){return st(mt),mt<=0?rt(wt,mt):ht!==void 0?typeof bt=="string"?rt(wt,mt).fill(ht,bt):rt(wt,mt).fill(ht):rt(wt,mt)}ot.alloc=function(wt,mt,ht){return at(null,wt,mt,ht)};function ct(wt,mt){if(st(mt),wt=rt(wt,mt<0?0:St(mt)|0),!ot.TYPED_ARRAY_SUPPORT)for(var ht=0;ht<mt;++ht)wt[ht]=0;return wt}ot.allocUnsafe=function(wt){return ct(null,wt)},ot.allocUnsafeSlow=function(wt){return ct(null,wt)};function dt(wt,mt,ht){if((typeof ht!="string"||ht==="")&&(ht="utf8"),!ot.isEncoding(ht))throw new TypeError('"encoding" must be a valid string encoding');var bt=yt(mt,ht)|0;wt=rt(wt,bt);var kt=wt.write(mt,ht);return kt!==bt&&(wt=wt.slice(0,kt)),wt}function ut(wt,mt){var ht=mt.length<0?0:St(mt.length)|0;wt=rt(wt,ht);for(var bt=0;bt<ht;bt+=1)wt[bt]=mt[bt]&255;return wt}function ft(wt,mt,ht,bt){if(mt.byteLength,ht<0||mt.byteLength<ht)throw new RangeError("'offset' is out of bounds");if(mt.byteLength<ht+(bt||0))throw new RangeError("'length' is out of bounds");return ht===void 0&&bt===void 0?mt=new Uint8Array(mt):bt===void 0?mt=new Uint8Array(mt,ht):mt=new Uint8Array(mt,ht,bt),ot.TYPED_ARRAY_SUPPORT?(wt=mt,wt.__proto__=ot.prototype):wt=ut(wt,mt),wt}function pt(wt,mt){if(ot.isBuffer(mt)){var ht=St(mt.length)|0;return wt=rt(wt,ht),wt.length===0||mt.copy(wt,0,0,ht),wt}if(mt){if(typeof ArrayBuffer<"u"&&mt.buffer instanceof ArrayBuffer||"length"in mt)return typeof mt.length!="number"||Fn(mt.length)?rt(wt,0):ut(wt,mt);if(mt.type==="Buffer"&&tt(mt.data))return ut(wt,mt.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function St(wt){if(wt>=it())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+it().toString(16)+" bytes");return wt|0}function gt(wt){return+wt!=wt&&(wt=0),ot.alloc(+wt)}ot.isBuffer=function(mt){return!!(mt!=null&&mt._isBuffer)},ot.compare=function(mt,ht){if(!ot.isBuffer(mt)||!ot.isBuffer(ht))throw new TypeError("Arguments must be Buffers");if(mt===ht)return 0;for(var bt=mt.length,kt=ht.length,Ot=0,Nt=Math.min(bt,kt);Ot<Nt;++Ot)if(mt[Ot]!==ht[Ot]){bt=mt[Ot],kt=ht[Ot];break}return bt<kt?-1:kt<bt?1:0},ot.isEncoding=function(mt){switch(String(mt).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},ot.concat=function(mt,ht){if(!tt(mt))throw new TypeError('"list" argument must be an Array of Buffers');if(mt.length===0)return ot.alloc(0);var bt;if(ht===void 0)for(ht=0,bt=0;bt<mt.length;++bt)ht+=mt[bt].length;var kt=ot.allocUnsafe(ht),Ot=0;for(bt=0;bt<mt.length;++bt){var Nt=mt[bt];if(!ot.isBuffer(Nt))throw new TypeError('"list" argument must be an Array of Buffers');Nt.copy(kt,Ot),Ot+=Nt.length}return kt};function yt(wt,mt){if(ot.isBuffer(wt))return wt.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(wt)||wt instanceof ArrayBuffer))return wt.byteLength;typeof wt!="string"&&(wt=""+wt);var ht=wt.length;if(ht===0)return 0;for(var bt=!1;;)switch(mt){case"ascii":case"latin1":case"binary":return ht;case"utf8":case"utf-8":case void 0:return Sn(wt).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ht*2;case"hex":return ht>>>1;case"base64":return In(wt).length;default:if(bt)return Sn(wt).length;mt=(""+mt).toLowerCase(),bt=!0}}ot.byteLength=yt;function vt(wt,mt,ht){var bt=!1;if((mt===void 0||mt<0)&&(mt=0),mt>this.length||((ht===void 0||ht>this.length)&&(ht=this.length),ht<=0)||(ht>>>=0,mt>>>=0,ht<=mt))return"";for(wt||(wt="utf8");;)switch(wt){case"hex":return Kt(this,mt,ht);case"utf8":case"utf-8":return cn(this,mt,ht);case"ascii":return bn(this,mt,ht);case"latin1":case"binary":return Ut(this,mt,ht);case"base64":return qt(this,mt,ht);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Gt(this,mt,ht);default:if(bt)throw new TypeError("Unknown encoding: "+wt);wt=(wt+"").toLowerCase(),bt=!0}}ot.prototype._isBuffer=!0;function Ct(wt,mt,ht){var bt=wt[mt];wt[mt]=wt[ht],wt[ht]=bt}ot.prototype.swap16=function(){var mt=this.length;if(mt%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var ht=0;ht<mt;ht+=2)Ct(this,ht,ht+1);return this},ot.prototype.swap32=function(){var mt=this.length;if(mt%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var ht=0;ht<mt;ht+=4)Ct(this,ht,ht+3),Ct(this,ht+1,ht+2);return this},ot.prototype.swap64=function(){var mt=this.length;if(mt%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var ht=0;ht<mt;ht+=8)Ct(this,ht,ht+7),Ct(this,ht+1,ht+6),Ct(this,ht+2,ht+5),Ct(this,ht+3,ht+4);return this},ot.prototype.toString=function(){var mt=this.length|0;return mt===0?"":arguments.length===0?cn(this,0,mt):vt.apply(this,arguments)},ot.prototype.equals=function(mt){if(!ot.isBuffer(mt))throw new TypeError("Argument must be a Buffer");return this===mt?!0:ot.compare(this,mt)===0},ot.prototype.inspect=function(){var mt="",ht=et.INSPECT_MAX_BYTES;return this.length>0&&(mt=this.toString("hex",0,ht).match(/.{2}/g).join(" "),this.length>ht&&(mt+=" ... ")),"<Buffer "+mt+">"},ot.prototype.compare=function(mt,ht,bt,kt,Ot){if(!ot.isBuffer(mt))throw new TypeError("Argument must be a Buffer");if(ht===void 0&&(ht=0),bt===void 0&&(bt=mt?mt.length:0),kt===void 0&&(kt=0),Ot===void 0&&(Ot=this.length),ht<0||bt>mt.length||kt<0||Ot>this.length)throw new RangeError("out of range index");if(kt>=Ot&&ht>=bt)return 0;if(kt>=Ot)return-1;if(ht>=bt)return 1;if(ht>>>=0,bt>>>=0,kt>>>=0,Ot>>>=0,this===mt)return 0;for(var Nt=Ot-kt,en=bt-ht,rn=Math.min(Nt,en),ln=this.slice(kt,Ot),Zt=mt.slice(ht,bt),on=0;on<rn;++on)if(ln[on]!==Zt[on]){Nt=ln[on],en=Zt[on];break}return Nt<en?-1:en<Nt?1:0};function Et(wt,mt,ht,bt,kt){if(wt.length===0)return-1;if(typeof ht=="string"?(bt=ht,ht=0):ht>2147483647?ht=2147483647:ht<-2147483648&&(ht=-2147483648),ht=+ht,isNaN(ht)&&(ht=kt?0:wt.length-1),ht<0&&(ht=wt.length+ht),ht>=wt.length){if(kt)return-1;ht=wt.length-1}else if(ht<0)if(kt)ht=0;else return-1;if(typeof mt=="string"&&(mt=ot.from(mt,bt)),ot.isBuffer(mt))return mt.length===0?-1:Mt(wt,mt,ht,bt,kt);if(typeof mt=="number")return mt=mt&255,ot.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?kt?Uint8Array.prototype.indexOf.call(wt,mt,ht):Uint8Array.prototype.lastIndexOf.call(wt,mt,ht):Mt(wt,[mt],ht,bt,kt);throw new TypeError("val must be string, number or Buffer")}function Mt(wt,mt,ht,bt,kt){var Ot=1,Nt=wt.length,en=mt.length;if(bt!==void 0&&(bt=String(bt).toLowerCase(),bt==="ucs2"||bt==="ucs-2"||bt==="utf16le"||bt==="utf-16le")){if(wt.length<2||mt.length<2)return-1;Ot=2,Nt/=2,en/=2,ht/=2}function rn(Yt,tn){return Ot===1?Yt[tn]:Yt.readUInt16BE(tn*Ot)}var ln;if(kt){var Zt=-1;for(ln=ht;ln<Nt;ln++)if(rn(wt,ln)===rn(mt,Zt===-1?0:ln-Zt)){if(Zt===-1&&(Zt=ln),ln-Zt+1===en)return Zt*Ot}else Zt!==-1&&(ln-=ln-Zt),Zt=-1}else for(ht+en>Nt&&(ht=Nt-en),ln=ht;ln>=0;ln--){for(var on=!0,kn=0;kn<en;kn++)if(rn(wt,ln+kn)!==rn(mt,kn)){on=!1;break}if(on)return ln}return-1}ot.prototype.includes=function(mt,ht,bt){return this.indexOf(mt,ht,bt)!==-1},ot.prototype.indexOf=function(mt,ht,bt){return Et(this,mt,ht,bt,!0)},ot.prototype.lastIndexOf=function(mt,ht,bt){return Et(this,mt,ht,bt,!1)};function Rt(wt,mt,ht,bt){ht=Number(ht)||0;var kt=wt.length-ht;bt?(bt=Number(bt),bt>kt&&(bt=kt)):bt=kt;var Ot=mt.length;if(Ot%2!==0)throw new TypeError("Invalid hex string");bt>Ot/2&&(bt=Ot/2);for(var Nt=0;Nt<bt;++Nt){var en=parseInt(mt.substr(Nt*2,2),16);if(isNaN(en))return Nt;wt[ht+Nt]=en}return Nt}function At(wt,mt,ht,bt){return Cn(Sn(mt,wt.length-ht),wt,ht,bt)}function Dt(wt,mt,ht,bt){return Cn(Dn(mt),wt,ht,bt)}function It(wt,mt,ht,bt){return Dt(wt,mt,ht,bt)}function Vt(wt,mt,ht,bt){return Cn(In(mt),wt,ht,bt)}function jt(wt,mt,ht,bt){return Cn(An(mt,wt.length-ht),wt,ht,bt)}ot.prototype.write=function(mt,ht,bt,kt){if(ht===void 0)kt="utf8",bt=this.length,ht=0;else if(bt===void 0&&typeof ht=="string")kt=ht,bt=this.length,ht=0;else if(isFinite(ht))ht=ht|0,isFinite(bt)?(bt=bt|0,kt===void 0&&(kt="utf8")):(kt=bt,bt=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var Ot=this.length-ht;if((bt===void 0||bt>Ot)&&(bt=Ot),mt.length>0&&(bt<0||ht<0)||ht>this.length)throw new RangeError("Attempt to write outside buffer bounds");kt||(kt="utf8");for(var Nt=!1;;)switch(kt){case"hex":return Rt(this,mt,ht,bt);case"utf8":case"utf-8":return At(this,mt,ht,bt);case"ascii":return Dt(this,mt,ht,bt);case"latin1":case"binary":return It(this,mt,ht,bt);case"base64":return Vt(this,mt,ht,bt);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return jt(this,mt,ht,bt);default:if(Nt)throw new TypeError("Unknown encoding: "+kt);kt=(""+kt).toLowerCase(),Nt=!0}},ot.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function qt(wt,mt,ht){return mt===0&&ht===wt.length?$.fromByteArray(wt):$.fromByteArray(wt.slice(mt,ht))}function cn(wt,mt,ht){ht=Math.min(wt.length,ht);for(var bt=[],kt=mt;kt<ht;){var Ot=wt[kt],Nt=null,en=Ot>239?4:Ot>223?3:Ot>191?2:1;if(kt+en<=ht){var rn,ln,Zt,on;switch(en){case 1:Ot<128&&(Nt=Ot);break;case 2:rn=wt[kt+1],(rn&192)===128&&(on=(Ot&31)<<6|rn&63,on>127&&(Nt=on));break;case 3:rn=wt[kt+1],ln=wt[kt+2],(rn&192)===128&&(ln&192)===128&&(on=(Ot&15)<<12|(rn&63)<<6|ln&63,on>2047&&(on<55296||on>57343)&&(Nt=on));break;case 4:rn=wt[kt+1],ln=wt[kt+2],Zt=wt[kt+3],(rn&192)===128&&(ln&192)===128&&(Zt&192)===128&&(on=(Ot&15)<<18|(rn&63)<<12|(ln&63)<<6|Zt&63,on>65535&&on<1114112&&(Nt=on))}}Nt===null?(Nt=65533,en=1):Nt>65535&&(Nt-=65536,bt.push(Nt>>>10&1023|55296),Nt=56320|Nt&1023),bt.push(Nt),kt+=en}return an(bt)}var dn=4096;function an(wt){var mt=wt.length;if(mt<=dn)return String.fromCharCode.apply(String,wt);for(var ht="",bt=0;bt<mt;)ht+=String.fromCharCode.apply(String,wt.slice(bt,bt+=dn));return ht}function bn(wt,mt,ht){var bt="";ht=Math.min(wt.length,ht);for(var kt=mt;kt<ht;++kt)bt+=String.fromCharCode(wt[kt]&127);return bt}function Ut(wt,mt,ht){var bt="";ht=Math.min(wt.length,ht);for(var kt=mt;kt<ht;++kt)bt+=String.fromCharCode(wt[kt]);return bt}function Kt(wt,mt,ht){var bt=wt.length;(!mt||mt<0)&&(mt=0),(!ht||ht<0||ht>bt)&&(ht=bt);for(var kt="",Ot=mt;Ot<ht;++Ot)kt+=Pn(wt[Ot]);return kt}function Gt(wt,mt,ht){for(var bt=wt.slice(mt,ht),kt="",Ot=0;Ot<bt.length;Ot+=2)kt+=String.fromCharCode(bt[Ot]+bt[Ot+1]*256);return kt}ot.prototype.slice=function(mt,ht){var bt=this.length;mt=~~mt,ht=ht===void 0?bt:~~ht,mt<0?(mt+=bt,mt<0&&(mt=0)):mt>bt&&(mt=bt),ht<0?(ht+=bt,ht<0&&(ht=0)):ht>bt&&(ht=bt),ht<mt&&(ht=mt);var kt;if(ot.TYPED_ARRAY_SUPPORT)kt=this.subarray(mt,ht),kt.__proto__=ot.prototype;else{var Ot=ht-mt;kt=new ot(Ot,void 0);for(var Nt=0;Nt<Ot;++Nt)kt[Nt]=this[Nt+mt]}return kt};function Wt(wt,mt,ht){if(wt%1!==0||wt<0)throw new RangeError("offset is not uint");if(wt+mt>ht)throw new RangeError("Trying to access beyond buffer length")}ot.prototype.readUIntLE=function(mt,ht,bt){mt=mt|0,ht=ht|0,bt||Wt(mt,ht,this.length);for(var kt=this[mt],Ot=1,Nt=0;++Nt<ht&&(Ot*=256);)kt+=this[mt+Nt]*Ot;return kt},ot.prototype.readUIntBE=function(mt,ht,bt){mt=mt|0,ht=ht|0,bt||Wt(mt,ht,this.length);for(var kt=this[mt+--ht],Ot=1;ht>0&&(Ot*=256);)kt+=this[mt+--ht]*Ot;return kt},ot.prototype.readUInt8=function(mt,ht){return ht||Wt(mt,1,this.length),this[mt]},ot.prototype.readUInt16LE=function(mt,ht){return ht||Wt(mt,2,this.length),this[mt]|this[mt+1]<<8},ot.prototype.readUInt16BE=function(mt,ht){return ht||Wt(mt,2,this.length),this[mt]<<8|this[mt+1]},ot.prototype.readUInt32LE=function(mt,ht){return ht||Wt(mt,4,this.length),(this[mt]|this[mt+1]<<8|this[mt+2]<<16)+this[mt+3]*16777216},ot.prototype.readUInt32BE=function(mt,ht){return ht||Wt(mt,4,this.length),this[mt]*16777216+(this[mt+1]<<16|this[mt+2]<<8|this[mt+3])},ot.prototype.readIntLE=function(mt,ht,bt){mt=mt|0,ht=ht|0,bt||Wt(mt,ht,this.length);for(var kt=this[mt],Ot=1,Nt=0;++Nt<ht&&(Ot*=256);)kt+=this[mt+Nt]*Ot;return Ot*=128,kt>=Ot&&(kt-=Math.pow(2,8*ht)),kt},ot.prototype.readIntBE=function(mt,ht,bt){mt=mt|0,ht=ht|0,bt||Wt(mt,ht,this.length);for(var kt=ht,Ot=1,Nt=this[mt+--kt];kt>0&&(Ot*=256);)Nt+=this[mt+--kt]*Ot;return Ot*=128,Nt>=Ot&&(Nt-=Math.pow(2,8*ht)),Nt},ot.prototype.readInt8=function(mt,ht){return ht||Wt(mt,1,this.length),this[mt]&128?(255-this[mt]+1)*-1:this[mt]},ot.prototype.readInt16LE=function(mt,ht){ht||Wt(mt,2,this.length);var bt=this[mt]|this[mt+1]<<8;return bt&32768?bt|4294901760:bt},ot.prototype.readInt16BE=function(mt,ht){ht||Wt(mt,2,this.length);var bt=this[mt+1]|this[mt]<<8;return bt&32768?bt|4294901760:bt},ot.prototype.readInt32LE=function(mt,ht){return ht||Wt(mt,4,this.length),this[mt]|this[mt+1]<<8|this[mt+2]<<16|this[mt+3]<<24},ot.prototype.readInt32BE=function(mt,ht){return ht||Wt(mt,4,this.length),this[mt]<<24|this[mt+1]<<16|this[mt+2]<<8|this[mt+3]},ot.prototype.readFloatLE=function(mt,ht){return ht||Wt(mt,4,this.length),_.read(this,mt,!0,23,4)},ot.prototype.readFloatBE=function(mt,ht){return ht||Wt(mt,4,this.length),_.read(this,mt,!1,23,4)},ot.prototype.readDoubleLE=function(mt,ht){return ht||Wt(mt,8,this.length),_.read(this,mt,!0,52,8)},ot.prototype.readDoubleBE=function(mt,ht){return ht||Wt(mt,8,this.length),_.read(this,mt,!1,52,8)};function Jt(wt,mt,ht,bt,kt,Ot){if(!ot.isBuffer(wt))throw new TypeError('"buffer" argument must be a Buffer instance');if(mt>kt||mt<Ot)throw new RangeError('"value" argument is out of bounds');if(ht+bt>wt.length)throw new RangeError("Index out of range")}ot.prototype.writeUIntLE=function(mt,ht,bt,kt){if(mt=+mt,ht=ht|0,bt=bt|0,!kt){var Ot=Math.pow(2,8*bt)-1;Jt(this,mt,ht,bt,Ot,0)}var Nt=1,en=0;for(this[ht]=mt&255;++en<bt&&(Nt*=256);)this[ht+en]=mt/Nt&255;return ht+bt},ot.prototype.writeUIntBE=function(mt,ht,bt,kt){if(mt=+mt,ht=ht|0,bt=bt|0,!kt){var Ot=Math.pow(2,8*bt)-1;Jt(this,mt,ht,bt,Ot,0)}var Nt=bt-1,en=1;for(this[ht+Nt]=mt&255;--Nt>=0&&(en*=256);)this[ht+Nt]=mt/en&255;return ht+bt},ot.prototype.writeUInt8=function(mt,ht,bt){return mt=+mt,ht=ht|0,bt||Jt(this,mt,ht,1,255,0),ot.TYPED_ARRAY_SUPPORT||(mt=Math.floor(mt)),this[ht]=mt&255,ht+1};function _n(wt,mt,ht,bt){mt<0&&(mt=65535+mt+1);for(var kt=0,Ot=Math.min(wt.length-ht,2);kt<Ot;++kt)wt[ht+kt]=(mt&255<<8*(bt?kt:1-kt))>>>(bt?kt:1-kt)*8}ot.prototype.writeUInt16LE=function(mt,ht,bt){return mt=+mt,ht=ht|0,bt||Jt(this,mt,ht,2,65535,0),ot.TYPED_ARRAY_SUPPORT?(this[ht]=mt&255,this[ht+1]=mt>>>8):_n(this,mt,ht,!0),ht+2},ot.prototype.writeUInt16BE=function(mt,ht,bt){return mt=+mt,ht=ht|0,bt||Jt(this,mt,ht,2,65535,0),ot.TYPED_ARRAY_SUPPORT?(this[ht]=mt>>>8,this[ht+1]=mt&255):_n(this,mt,ht,!1),ht+2};function mn(wt,mt,ht,bt){mt<0&&(mt=4294967295+mt+1);for(var kt=0,Ot=Math.min(wt.length-ht,4);kt<Ot;++kt)wt[ht+kt]=mt>>>(bt?kt:3-kt)*8&255}ot.prototype.writeUInt32LE=function(mt,ht,bt){return mt=+mt,ht=ht|0,bt||Jt(this,mt,ht,4,4294967295,0),ot.TYPED_ARRAY_SUPPORT?(this[ht+3]=mt>>>24,this[ht+2]=mt>>>16,this[ht+1]=mt>>>8,this[ht]=mt&255):mn(this,mt,ht,!0),ht+4},ot.prototype.writeUInt32BE=function(mt,ht,bt){return mt=+mt,ht=ht|0,bt||Jt(this,mt,ht,4,4294967295,0),ot.TYPED_ARRAY_SUPPORT?(this[ht]=mt>>>24,this[ht+1]=mt>>>16,this[ht+2]=mt>>>8,this[ht+3]=mt&255):mn(this,mt,ht,!1),ht+4},ot.prototype.writeIntLE=function(mt,ht,bt,kt){if(mt=+mt,ht=ht|0,!kt){var Ot=Math.pow(2,8*bt-1);Jt(this,mt,ht,bt,Ot-1,-Ot)}var Nt=0,en=1,rn=0;for(this[ht]=mt&255;++Nt<bt&&(en*=256);)mt<0&&rn===0&&this[ht+Nt-1]!==0&&(rn=1),this[ht+Nt]=(mt/en>>0)-rn&255;return ht+bt},ot.prototype.writeIntBE=function(mt,ht,bt,kt){if(mt=+mt,ht=ht|0,!kt){var Ot=Math.pow(2,8*bt-1);Jt(this,mt,ht,bt,Ot-1,-Ot)}var Nt=bt-1,en=1,rn=0;for(this[ht+Nt]=mt&255;--Nt>=0&&(en*=256);)mt<0&&rn===0&&this[ht+Nt+1]!==0&&(rn=1),this[ht+Nt]=(mt/en>>0)-rn&255;return ht+bt},ot.prototype.writeInt8=function(mt,ht,bt){return mt=+mt,ht=ht|0,bt||Jt(this,mt,ht,1,127,-128),ot.TYPED_ARRAY_SUPPORT||(mt=Math.floor(mt)),mt<0&&(mt=255+mt+1),this[ht]=mt&255,ht+1},ot.prototype.writeInt16LE=function(mt,ht,bt){return mt=+mt,ht=ht|0,bt||Jt(this,mt,ht,2,32767,-32768),ot.TYPED_ARRAY_SUPPORT?(this[ht]=mt&255,this[ht+1]=mt>>>8):_n(this,mt,ht,!0),ht+2},ot.prototype.writeInt16BE=function(mt,ht,bt){return mt=+mt,ht=ht|0,bt||Jt(this,mt,ht,2,32767,-32768),ot.TYPED_ARRAY_SUPPORT?(this[ht]=mt>>>8,this[ht+1]=mt&255):_n(this,mt,ht,!1),ht+2},ot.prototype.writeInt32LE=function(mt,ht,bt){return mt=+mt,ht=ht|0,bt||Jt(this,mt,ht,4,2147483647,-2147483648),ot.TYPED_ARRAY_SUPPORT?(this[ht]=mt&255,this[ht+1]=mt>>>8,this[ht+2]=mt>>>16,this[ht+3]=mt>>>24):mn(this,mt,ht,!0),ht+4},ot.prototype.writeInt32BE=function(mt,ht,bt){return mt=+mt,ht=ht|0,bt||Jt(this,mt,ht,4,2147483647,-2147483648),mt<0&&(mt=4294967295+mt+1),ot.TYPED_ARRAY_SUPPORT?(this[ht]=mt>>>24,this[ht+1]=mt>>>16,this[ht+2]=mt>>>8,this[ht+3]=mt&255):mn(this,mt,ht,!1),ht+4};function hn(wt,mt,ht,bt,kt,Ot){if(ht+bt>wt.length)throw new RangeError("Index out of range");if(ht<0)throw new RangeError("Index out of range")}function gn(wt,mt,ht,bt,kt){return kt||hn(wt,mt,ht,4),_.write(wt,mt,ht,bt,23,4),ht+4}ot.prototype.writeFloatLE=function(mt,ht,bt){return gn(this,mt,ht,!0,bt)},ot.prototype.writeFloatBE=function(mt,ht,bt){return gn(this,mt,ht,!1,bt)};function yn(wt,mt,ht,bt,kt){return kt||hn(wt,mt,ht,8),_.write(wt,mt,ht,bt,52,8),ht+8}ot.prototype.writeDoubleLE=function(mt,ht,bt){return yn(this,mt,ht,!0,bt)},ot.prototype.writeDoubleBE=function(mt,ht,bt){return yn(this,mt,ht,!1,bt)},ot.prototype.copy=function(mt,ht,bt,kt){if(bt||(bt=0),!kt&&kt!==0&&(kt=this.length),ht>=mt.length&&(ht=mt.length),ht||(ht=0),kt>0&&kt<bt&&(kt=bt),kt===bt||mt.length===0||this.length===0)return 0;if(ht<0)throw new RangeError("targetStart out of bounds");if(bt<0||bt>=this.length)throw new RangeError("sourceStart out of bounds");if(kt<0)throw new RangeError("sourceEnd out of bounds");kt>this.length&&(kt=this.length),mt.length-ht<kt-bt&&(kt=mt.length-ht+bt);var Ot=kt-bt,Nt;if(this===mt&&bt<ht&&ht<kt)for(Nt=Ot-1;Nt>=0;--Nt)mt[Nt+ht]=this[Nt+bt];else if(Ot<1e3||!ot.TYPED_ARRAY_SUPPORT)for(Nt=0;Nt<Ot;++Nt)mt[Nt+ht]=this[Nt+bt];else Uint8Array.prototype.set.call(mt,this.subarray(bt,bt+Ot),ht);return Ot},ot.prototype.fill=function(mt,ht,bt,kt){if(typeof mt=="string"){if(typeof ht=="string"?(kt=ht,ht=0,bt=this.length):typeof bt=="string"&&(kt=bt,bt=this.length),mt.length===1){var Ot=mt.charCodeAt(0);Ot<256&&(mt=Ot)}if(kt!==void 0&&typeof kt!="string")throw new TypeError("encoding must be a string");if(typeof kt=="string"&&!ot.isEncoding(kt))throw new TypeError("Unknown encoding: "+kt)}else typeof mt=="number"&&(mt=mt&255);if(ht<0||this.length<ht||this.length<bt)throw new RangeError("Out of range index");if(bt<=ht)return this;ht=ht>>>0,bt=bt===void 0?this.length:bt>>>0,mt||(mt=0);var Nt;if(typeof mt=="number")for(Nt=ht;Nt<bt;++Nt)this[Nt]=mt;else{var en=ot.isBuffer(mt)?mt:Sn(new ot(mt,kt).toString()),rn=en.length;for(Nt=0;Nt<bt-ht;++Nt)this[Nt+ht]=en[Nt%rn]}return this};var En=/[^+\/0-9A-Za-z-_]/g;function Mn(wt){if(wt=Rn(wt).replace(En,""),wt.length<2)return"";for(;wt.length%4!==0;)wt=wt+"=";return wt}function Rn(wt){return wt.trim?wt.trim():wt.replace(/^\s+|\s+$/g,"")}function Pn(wt){return wt<16?"0"+wt.toString(16):wt.toString(16)}function Sn(wt,mt){mt=mt||1/0;for(var ht,bt=wt.length,kt=null,Ot=[],Nt=0;Nt<bt;++Nt){if(ht=wt.charCodeAt(Nt),ht>55295&&ht<57344){if(!kt){if(ht>56319){(mt-=3)>-1&&Ot.push(239,191,189);continue}else if(Nt+1===bt){(mt-=3)>-1&&Ot.push(239,191,189);continue}kt=ht;continue}if(ht<56320){(mt-=3)>-1&&Ot.push(239,191,189),kt=ht;continue}ht=(kt-55296<<10|ht-56320)+65536}else kt&&(mt-=3)>-1&&Ot.push(239,191,189);if(kt=null,ht<128){if((mt-=1)<0)break;Ot.push(ht)}else if(ht<2048){if((mt-=2)<0)break;Ot.push(ht>>6|192,ht&63|128)}else if(ht<65536){if((mt-=3)<0)break;Ot.push(ht>>12|224,ht>>6&63|128,ht&63|128)}else if(ht<1114112){if((mt-=4)<0)break;Ot.push(ht>>18|240,ht>>12&63|128,ht>>6&63|128,ht&63|128)}else throw new Error("Invalid code point")}return Ot}function Dn(wt){for(var mt=[],ht=0;ht<wt.length;++ht)mt.push(wt.charCodeAt(ht)&255);return mt}function An(wt,mt){for(var ht,bt,kt,Ot=[],Nt=0;Nt<wt.length&&!((mt-=2)<0);++Nt)ht=wt.charCodeAt(Nt),bt=ht>>8,kt=ht%256,Ot.push(kt),Ot.push(bt);return Ot}function In(wt){return $.toByteArray(Mn(wt))}function Cn(wt,mt,ht,bt){for(var kt=0;kt<bt&&!(kt+ht>=mt.length||kt>=wt.length);++kt)mt[kt+ht]=wt[kt];return kt}function Fn(wt){return wt!==wt}})(buffer);var crypto$1;typeof window<"u"&&window.crypto&&(crypto$1=window.crypto);!crypto$1&&typeof window<"u"&&window.msCrypto&&(crypto$1=window.msCrypto);!crypto$1&&typeof window<"u"&&window.crypto&&(crypto$1=window.crypto);if(!crypto$1&&typeof require=="function")try{crypto$1=require("crypto")}catch{}function cryptoSecureRandomInt(){if(crypto$1){if(typeof crypto$1.getRandomValues=="function")try{return crypto$1.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof crypto$1.randomBytes=="function")try{return crypto$1.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")}function hexStringify(et){for(var $=et.words,_=et.sigBytes,tt=[],nt=0;nt<_;nt++){var it=$[nt>>>2]>>>24-nt%4*8&255;tt.push((it>>>4).toString(16)),tt.push((it&15).toString(16))}return tt.join("")}var WordArray=function(){function et(_,tt){_=this.words=_||[],tt!=null?this.sigBytes=tt:this.sigBytes=_.length*4}var $=et.prototype;return $.random=function(tt){for(var nt=[],it=0;it<tt;it+=4)nt.push(cryptoSecureRandomInt());return new et(nt,tt)},$.toString=function(){return hexStringify(this)},et}(),build$4={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics=function(et,$){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,tt){_.__proto__=tt}||function(_,tt){for(var nt in tt)tt.hasOwnProperty(nt)&&(_[nt]=tt[nt])},extendStatics(et,$)};function __extends(et,$){extendStatics(et,$);function _(){this.constructor=et}et.prototype=$===null?Object.create($):(_.prototype=$.prototype,new _)}var __assign=function(){return __assign=Object.assign||function($){for(var _,tt=1,nt=arguments.length;tt<nt;tt++){_=arguments[tt];for(var it in _)Object.prototype.hasOwnProperty.call(_,it)&&($[it]=_[it])}return $},__assign.apply(this,arguments)};function __rest$1(et,$){var _={};for(var tt in et)Object.prototype.hasOwnProperty.call(et,tt)&&$.indexOf(tt)<0&&(_[tt]=et[tt]);if(et!=null&&typeof Object.getOwnPropertySymbols=="function")for(var nt=0,tt=Object.getOwnPropertySymbols(et);nt<tt.length;nt++)$.indexOf(tt[nt])<0&&Object.prototype.propertyIsEnumerable.call(et,tt[nt])&&(_[tt[nt]]=et[tt[nt]]);return _}function __decorate(et,$,_,tt){var nt=arguments.length,it=nt<3?$:tt===null?tt=Object.getOwnPropertyDescriptor($,_):tt,rt;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")it=Reflect.decorate(et,$,_,tt);else for(var ot=et.length-1;ot>=0;ot--)(rt=et[ot])&&(it=(nt<3?rt(it):nt>3?rt($,_,it):rt($,_))||it);return nt>3&&it&&Object.defineProperty($,_,it),it}function __param(et,$){return function(_,tt){$(_,tt,et)}}function __metadata(et,$){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(et,$)}function __awaiter$16(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})}function __generator$1(et,$){var _={label:0,sent:function(){if(it[0]&1)throw it[1];return it[1]},trys:[],ops:[]},tt,nt,it,rt;return rt={next:ot(0),throw:ot(1),return:ot(2)},typeof Symbol=="function"&&(rt[Symbol.iterator]=function(){return this}),rt;function ot(st){return function(at){return lt([st,at])}}function lt(st){if(tt)throw new TypeError("Generator is already executing.");for(;_;)try{if(tt=1,nt&&(it=st[0]&2?nt.return:st[0]?nt.throw||((it=nt.return)&&it.call(nt),0):nt.next)&&!(it=it.call(nt,st[1])).done)return it;switch(nt=0,it&&(st=[st[0]&2,it.value]),st[0]){case 0:case 1:it=st;break;case 4:return _.label++,{value:st[1],done:!1};case 5:_.label++,nt=st[1],st=[0];continue;case 7:st=_.ops.pop(),_.trys.pop();continue;default:if(it=_.trys,!(it=it.length>0&&it[it.length-1])&&(st[0]===6||st[0]===2)){_=0;continue}if(st[0]===3&&(!it||st[1]>it[0]&&st[1]<it[3])){_.label=st[1];break}if(st[0]===6&&_.label<it[1]){_.label=it[1],it=st;break}if(it&&_.label<it[2]){_.label=it[2],_.ops.push(st);break}it[2]&&_.ops.pop(),_.trys.pop();continue}st=$.call(et,_)}catch(at){st=[6,at],nt=0}finally{tt=it=0}if(st[0]&5)throw st[1];return{value:st[0]?st[1]:void 0,done:!0}}}function __createBinding$2(et,$,_,tt){tt===void 0&&(tt=_),et[tt]=$[_]}function __exportStar(et,$){for(var _ in et)_!=="default"&&!$.hasOwnProperty(_)&&($[_]=et[_])}function __values(et){var $=typeof Symbol=="function"&&Symbol.iterator,_=$&&et[$],tt=0;if(_)return _.call(et);if(et&&typeof et.length=="number")return{next:function(){return et&&tt>=et.length&&(et=void 0),{value:et&&et[tt++],done:!et}}};throw new TypeError($?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(et,$){var _=typeof Symbol=="function"&&et[Symbol.iterator];if(!_)return et;var tt=_.call(et),nt,it=[],rt;try{for(;($===void 0||$-- >0)&&!(nt=tt.next()).done;)it.push(nt.value)}catch(ot){rt={error:ot}}finally{try{nt&&!nt.done&&(_=tt.return)&&_.call(tt)}finally{if(rt)throw rt.error}}return it}function __spread(){for(var et=[],$=0;$<arguments.length;$++)et=et.concat(__read(arguments[$]));return et}function __spreadArrays(){for(var et=0,$=0,_=arguments.length;$<_;$++)et+=arguments[$].length;for(var tt=Array(et),nt=0,$=0;$<_;$++)for(var it=arguments[$],rt=0,ot=it.length;rt<ot;rt++,nt++)tt[nt]=it[rt];return tt}function __await(et){return this instanceof __await?(this.v=et,this):new __await(et)}function __asyncGenerator(et,$,_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var tt=_.apply(et,$||[]),nt,it=[];return nt={},rt("next"),rt("throw"),rt("return"),nt[Symbol.asyncIterator]=function(){return this},nt;function rt(dt){tt[dt]&&(nt[dt]=function(ut){return new Promise(function(ft,pt){it.push([dt,ut,ft,pt])>1||ot(dt,ut)})})}function ot(dt,ut){try{lt(tt[dt](ut))}catch(ft){ct(it[0][3],ft)}}function lt(dt){dt.value instanceof __await?Promise.resolve(dt.value.v).then(st,at):ct(it[0][2],dt)}function st(dt){ot("next",dt)}function at(dt){ot("throw",dt)}function ct(dt,ut){dt(ut),it.shift(),it.length&&ot(it[0][0],it[0][1])}}function __asyncDelegator(et){var $,_;return $={},tt("next"),tt("throw",function(nt){throw nt}),tt("return"),$[Symbol.iterator]=function(){return this},$;function tt(nt,it){$[nt]=et[nt]?function(rt){return(_=!_)?{value:__await(et[nt](rt)),done:nt==="return"}:it?it(rt):rt}:it}}function __asyncValues(et){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var $=et[Symbol.asyncIterator],_;return $?$.call(et):(et=typeof __values=="function"?__values(et):et[Symbol.iterator](),_={},tt("next"),tt("throw"),tt("return"),_[Symbol.asyncIterator]=function(){return this},_);function tt(it){_[it]=et[it]&&function(rt){return new Promise(function(ot,lt){rt=et[it](rt),nt(ot,lt,rt.done,rt.value)})}}function nt(it,rt,ot,lt){Promise.resolve(lt).then(function(st){it({value:st,done:ot})},rt)}}function __makeTemplateObject(et,$){return Object.defineProperty?Object.defineProperty(et,"raw",{value:$}):et.raw=$,et}function __importStar$2(et){if(et&&et.__esModule)return et;var $={};if(et!=null)for(var _ in et)Object.hasOwnProperty.call(et,_)&&($[_]=et[_]);return $.default=et,$}function __importDefault$1O(et){return et&&et.__esModule?et:{default:et}}function __classPrivateFieldGet(et,$){if(!$.has(et))throw new TypeError("attempted to get private field on non-instance");return $.get(et)}function __classPrivateFieldSet(et,$,_){if(!$.has(et))throw new TypeError("attempted to set private field on non-instance");return $.set(et,_),_}const tslib_es6=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return __assign},__asyncDelegator,__asyncGenerator,__asyncValues,__await,__awaiter:__awaiter$16,__classPrivateFieldGet,__classPrivateFieldSet,__createBinding:__createBinding$2,__decorate,__exportStar,__extends,__generator:__generator$1,__importDefault:__importDefault$1O,__importStar:__importStar$2,__makeTemplateObject,__metadata,__param,__read,__rest:__rest$1,__spread,__spreadArrays,__values},Symbol.toStringTag,{value:"Module"})),require$$0$4=getAugmentedNamespace(tslib_es6);var jsSha256$1={},constants$3={};Object.defineProperty(constants$3,"__esModule",{value:!0});constants$3.MAX_HASHABLE_LENGTH=constants$3.INIT=constants$3.KEY=constants$3.DIGEST_LENGTH=constants$3.BLOCK_SIZE=void 0;constants$3.BLOCK_SIZE=64;constants$3.DIGEST_LENGTH=32;constants$3.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);constants$3.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];constants$3.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1;var RawSha256$3={};Object.defineProperty(RawSha256$3,"__esModule",{value:!0});RawSha256$3.RawSha256=void 0;var constants_1$1=constants$3,RawSha256$2=function(){function et(){this.state=Int32Array.from(constants_1$1.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return et.prototype.update=function($){if(this.finished)throw new Error("Attempted to update an already finished hash.");var _=0,tt=$.byteLength;if(this.bytesHashed+=tt,this.bytesHashed*8>constants_1$1.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;tt>0;)this.buffer[this.bufferLength++]=$[_++],tt--,this.bufferLength===constants_1$1.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},et.prototype.digest=function(){if(!this.finished){var $=this.bytesHashed*8,_=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),tt=this.bufferLength;if(_.setUint8(this.bufferLength++,128),tt%constants_1$1.BLOCK_SIZE>=constants_1$1.BLOCK_SIZE-8){for(var nt=this.bufferLength;nt<constants_1$1.BLOCK_SIZE;nt++)_.setUint8(nt,0);this.hashBuffer(),this.bufferLength=0}for(var nt=this.bufferLength;nt<constants_1$1.BLOCK_SIZE-8;nt++)_.setUint8(nt,0);_.setUint32(constants_1$1.BLOCK_SIZE-8,Math.floor($/4294967296),!0),_.setUint32(constants_1$1.BLOCK_SIZE-4,$),this.hashBuffer(),this.finished=!0}for(var it=new Uint8Array(constants_1$1.DIGEST_LENGTH),nt=0;nt<8;nt++)it[nt*4]=this.state[nt]>>>24&255,it[nt*4+1]=this.state[nt]>>>16&255,it[nt*4+2]=this.state[nt]>>>8&255,it[nt*4+3]=this.state[nt]>>>0&255;return it},et.prototype.hashBuffer=function(){for(var $=this,_=$.buffer,tt=$.state,nt=tt[0],it=tt[1],rt=tt[2],ot=tt[3],lt=tt[4],st=tt[5],at=tt[6],ct=tt[7],dt=0;dt<constants_1$1.BLOCK_SIZE;dt++){if(dt<16)this.temp[dt]=(_[dt*4]&255)<<24|(_[dt*4+1]&255)<<16|(_[dt*4+2]&255)<<8|_[dt*4+3]&255;else{var ut=this.temp[dt-2],ft=(ut>>>17|ut<<15)^(ut>>>19|ut<<13)^ut>>>10;ut=this.temp[dt-15];var pt=(ut>>>7|ut<<25)^(ut>>>18|ut<<14)^ut>>>3;this.temp[dt]=(ft+this.temp[dt-7]|0)+(pt+this.temp[dt-16]|0)}var St=(((lt>>>6|lt<<26)^(lt>>>11|lt<<21)^(lt>>>25|lt<<7))+(lt&st^~lt&at)|0)+(ct+(constants_1$1.KEY[dt]+this.temp[dt]|0)|0)|0,gt=((nt>>>2|nt<<30)^(nt>>>13|nt<<19)^(nt>>>22|nt<<10))+(nt&it^nt&rt^it&rt)|0;ct=at,at=st,st=lt,lt=ot+St|0,ot=rt,rt=it,it=nt,nt=St+gt|0}tt[0]+=nt,tt[1]+=it,tt[2]+=rt,tt[3]+=ot,tt[4]+=lt,tt[5]+=st,tt[6]+=at,tt[7]+=ct},et}();RawSha256$3.RawSha256=RawSha256$2;var build$3={},convertToBuffer$3={};const fromUtf8$6=et=>{const $=[];for(let _=0,tt=et.length;_<tt;_++){const nt=et.charCodeAt(_);if(nt<128)$.push(nt);else if(nt<2048)$.push(nt>>6|192,nt&63|128);else if(_+1<et.length&&(nt&64512)===55296&&(et.charCodeAt(_+1)&64512)===56320){const it=65536+((nt&1023)<<10)+(et.charCodeAt(++_)&1023);$.push(it>>18|240,it>>12&63|128,it>>6&63|128,it&63|128)}else $.push(nt>>12|224,nt>>6&63|128,nt&63|128)}return Uint8Array.from($)},toUtf8$3=et=>{let $="";for(let _=0,tt=et.length;_<tt;_++){const nt=et[_];if(nt<128)$+=String.fromCharCode(nt);else if(192<=nt&&nt<224){const it=et[++_];$+=String.fromCharCode((nt&31)<<6|it&63)}else if(240<=nt&&nt<365){const rt="%"+[nt,et[++_],et[++_],et[++_]].map(ot=>ot.toString(16)).join("%");$+=decodeURIComponent(rt)}else $+=String.fromCharCode((nt&15)<<12|(et[++_]&63)<<6|et[++_]&63)}return $};function fromUtf8$5(et){return new TextEncoder().encode(et)}function toUtf8$2(et){return new TextDecoder("utf-8").decode(et)}const fromUtf8$4=et=>typeof TextEncoder=="function"?fromUtf8$5(et):fromUtf8$6(et),toUtf8$1=et=>typeof TextDecoder=="function"?toUtf8$2(et):toUtf8$3(et),distEs$2=Object.freeze(Object.defineProperty({__proto__:null,fromUtf8:fromUtf8$4,toUtf8:toUtf8$1},Symbol.toStringTag,{value:"Module"})),require$$0$3=getAugmentedNamespace(distEs$2);Object.defineProperty(convertToBuffer$3,"__esModule",{value:!0});convertToBuffer$3.convertToBuffer=void 0;var util_utf8_browser_1=require$$0$3,fromUtf8$3=typeof Buffer<"u"&&Buffer.from?function(et){return Buffer.from(et,"utf8")}:util_utf8_browser_1.fromUtf8;function convertToBuffer$2(et){return et instanceof Uint8Array?et:typeof et=="string"?fromUtf8$3(et):ArrayBuffer.isView(et)?new Uint8Array(et.buffer,et.byteOffset,et.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(et)}convertToBuffer$3.convertToBuffer=convertToBuffer$2;var isEmptyData$3={};Object.defineProperty(isEmptyData$3,"__esModule",{value:!0});isEmptyData$3.isEmptyData=void 0;function isEmptyData$2(et){return typeof et=="string"?et.length===0:et.byteLength===0}isEmptyData$3.isEmptyData=isEmptyData$2;var numToUint8$2={};Object.defineProperty(numToUint8$2,"__esModule",{value:!0});numToUint8$2.numToUint8=void 0;function numToUint8$1(et){return new Uint8Array([(et&4278190080)>>24,(et&16711680)>>16,(et&65280)>>8,et&255])}numToUint8$2.numToUint8=numToUint8$1;var uint32ArrayFrom$2={};Object.defineProperty(uint32ArrayFrom$2,"__esModule",{value:!0});uint32ArrayFrom$2.uint32ArrayFrom=void 0;function uint32ArrayFrom$1(et){if(!Array.from){for(var $=new Uint32Array(et.length),_=0;_<et.length;)$[_]=et[_];return $}return Uint32Array.from(et)}uint32ArrayFrom$2.uint32ArrayFrom=uint32ArrayFrom$1;(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.uint32ArrayFrom=et.numToUint8=et.isEmptyData=et.convertToBuffer=void 0;var $=convertToBuffer$3;Object.defineProperty(et,"convertToBuffer",{enumerable:!0,get:function(){return $.convertToBuffer}});var _=isEmptyData$3;Object.defineProperty(et,"isEmptyData",{enumerable:!0,get:function(){return _.isEmptyData}});var tt=numToUint8$2;Object.defineProperty(et,"numToUint8",{enumerable:!0,get:function(){return tt.numToUint8}});var nt=uint32ArrayFrom$2;Object.defineProperty(et,"uint32ArrayFrom",{enumerable:!0,get:function(){return nt.uint32ArrayFrom}})})(build$3);Object.defineProperty(jsSha256$1,"__esModule",{value:!0});jsSha256$1.Sha256=void 0;var tslib_1=require$$0$4,constants_1=constants$3,RawSha256_1=RawSha256$3,util_1=build$3,Sha256$3=function(){function et($){if(this.hash=new RawSha256_1.RawSha256,$){this.outer=new RawSha256_1.RawSha256;var _=bufferFromSecret$1($),tt=new Uint8Array(constants_1.BLOCK_SIZE);tt.set(_);for(var nt=0;nt<constants_1.BLOCK_SIZE;nt++)_[nt]^=54,tt[nt]^=92;this.hash.update(_),this.outer.update(tt);for(var nt=0;nt<_.byteLength;nt++)_[nt]=0}}return et.prototype.update=function($){if(!((0,util_1.isEmptyData)($)||this.error))try{this.hash.update((0,util_1.convertToBuffer)($))}catch(_){this.error=_}},et.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},et.prototype.digest=function(){return(0,tslib_1.__awaiter)(this,void 0,void 0,function(){return(0,tslib_1.__generator)(this,function($){return[2,this.digestSync()]})})},et}();jsSha256$1.Sha256=Sha256$3;function bufferFromSecret$1(et){var $=(0,util_1.convertToBuffer)(et);if($.byteLength>constants_1.BLOCK_SIZE){var _=new RawSha256_1.RawSha256;_.update($),$=_.digest()}var tt=new Uint8Array(constants_1.BLOCK_SIZE);return tt.set($),tt}(function(et){Object.defineProperty(et,"__esModule",{value:!0});var $=require$$0$4;(0,$.__exportStar)(jsSha256$1,et)})(build$4);function BigInteger(et,$){et!=null&&this.fromString(et,$)}function nbi(){return new BigInteger(null)}var dbits,canary=0xdeadbeefcafe,j_lm=(canary&16777215)==15715070;function am1(et,$,_,tt,nt,it){for(;--it>=0;){var rt=$*this[et++]+_[tt]+nt;nt=Math.floor(rt/67108864),_[tt++]=rt&67108863}return nt}function am2(et,$,_,tt,nt,it){for(var rt=$&32767,ot=$>>15;--it>=0;){var lt=this[et]&32767,st=this[et++]>>15,at=ot*lt+st*rt;lt=rt*lt+((at&32767)<<15)+_[tt]+(nt&1073741823),nt=(lt>>>30)+(at>>>15)+ot*st+(nt>>>30),_[tt++]=lt&1073741823}return nt}function am3(et,$,_,tt,nt,it){for(var rt=$&16383,ot=$>>14;--it>=0;){var lt=this[et]&16383,st=this[et++]>>14,at=ot*lt+st*rt;lt=rt*lt+((at&16383)<<14)+_[tt]+nt,nt=(lt>>28)+(at>>14)+ot*st,_[tt++]=lt&268435455}return nt}var inBrowser=typeof navigator<"u";inBrowser&&j_lm&&navigator.appName=="Microsoft Internet Explorer"?(BigInteger.prototype.am=am2,dbits=30):inBrowser&&j_lm&&navigator.appName!="Netscape"?(BigInteger.prototype.am=am1,dbits=26):(BigInteger.prototype.am=am3,dbits=28);BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=(1<<dbits)-1;BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(et){return BI_RM.charAt(et)}function intAt(et,$){var _=BI_RC[et.charCodeAt($)];return _??-1}function bnpCopyTo(et){for(var $=this.t-1;$>=0;--$)et[$]=this[$];et.t=this.t,et.s=this.s}function bnpFromInt(et){this.t=1,this.s=et<0?-1:0,et>0?this[0]=et:et<-1?this[0]=et+this.DV:this.t=0}function nbv(et){var $=nbi();return $.fromInt(et),$}function bnpFromString(et,$){var _;if($==16)_=4;else if($==8)_=3;else if($==2)_=1;else if($==32)_=5;else if($==4)_=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");this.t=0,this.s=0;for(var tt=et.length,nt=!1,it=0;--tt>=0;){var rt=intAt(et,tt);if(rt<0){et.charAt(tt)=="-"&&(nt=!0);continue}nt=!1,it==0?this[this.t++]=rt:it+_>this.DB?(this[this.t-1]|=(rt&(1<<this.DB-it)-1)<<it,this[this.t++]=rt>>this.DB-it):this[this.t-1]|=rt<<it,it+=_,it>=this.DB&&(it-=this.DB)}this.clamp(),nt&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){for(var et=this.s&this.DM;this.t>0&&this[this.t-1]==et;)--this.t}function bnToString(et){if(this.s<0)return"-"+this.negate().toString(et);var $;if(et==16)$=4;else if(et==8)$=3;else if(et==2)$=1;else if(et==32)$=5;else if(et==4)$=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");var _=(1<<$)-1,tt,nt=!1,it="",rt=this.t,ot=this.DB-rt*this.DB%$;if(rt-- >0)for(ot<this.DB&&(tt=this[rt]>>ot)>0&&(nt=!0,it=int2char(tt));rt>=0;)ot<$?(tt=(this[rt]&(1<<ot)-1)<<$-ot,tt|=this[--rt]>>(ot+=this.DB-$)):(tt=this[rt]>>(ot-=$)&_,ot<=0&&(ot+=this.DB,--rt)),tt>0&&(nt=!0),nt&&(it+=int2char(tt));return nt?it:"0"}function bnNegate(){var et=nbi();return BigInteger.ZERO.subTo(this,et),et}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(et){var $=this.s-et.s;if($!=0)return $;var _=this.t;if($=_-et.t,$!=0)return this.s<0?-$:$;for(;--_>=0;)if(($=this[_]-et[_])!=0)return $;return 0}function nbits(et){var $=1,_;return(_=et>>>16)!=0&&(et=_,$+=16),(_=et>>8)!=0&&(et=_,$+=8),(_=et>>4)!=0&&(et=_,$+=4),(_=et>>2)!=0&&(et=_,$+=2),(_=et>>1)!=0&&(et=_,$+=1),$}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(et,$){var _;for(_=this.t-1;_>=0;--_)$[_+et]=this[_];for(_=et-1;_>=0;--_)$[_]=0;$.t=this.t+et,$.s=this.s}function bnpDRShiftTo(et,$){for(var _=et;_<this.t;++_)$[_-et]=this[_];$.t=Math.max(this.t-et,0),$.s=this.s}function bnpLShiftTo(et,$){var _=et%this.DB,tt=this.DB-_,nt=(1<<tt)-1,it=Math.floor(et/this.DB),rt=this.s<<_&this.DM,ot;for(ot=this.t-1;ot>=0;--ot)$[ot+it+1]=this[ot]>>tt|rt,rt=(this[ot]&nt)<<_;for(ot=it-1;ot>=0;--ot)$[ot]=0;$[it]=rt,$.t=this.t+it+1,$.s=this.s,$.clamp()}function bnpRShiftTo(et,$){$.s=this.s;var _=Math.floor(et/this.DB);if(_>=this.t){$.t=0;return}var tt=et%this.DB,nt=this.DB-tt,it=(1<<tt)-1;$[0]=this[_]>>tt;for(var rt=_+1;rt<this.t;++rt)$[rt-_-1]|=(this[rt]&it)<<nt,$[rt-_]=this[rt]>>tt;tt>0&&($[this.t-_-1]|=(this.s&it)<<nt),$.t=this.t-_,$.clamp()}function bnpSubTo(et,$){for(var _=0,tt=0,nt=Math.min(et.t,this.t);_<nt;)tt+=this[_]-et[_],$[_++]=tt&this.DM,tt>>=this.DB;if(et.t<this.t){for(tt-=et.s;_<this.t;)tt+=this[_],$[_++]=tt&this.DM,tt>>=this.DB;tt+=this.s}else{for(tt+=this.s;_<et.t;)tt-=et[_],$[_++]=tt&this.DM,tt>>=this.DB;tt-=et.s}$.s=tt<0?-1:0,tt<-1?$[_++]=this.DV+tt:tt>0&&($[_++]=tt),$.t=_,$.clamp()}function bnpMultiplyTo(et,$){var _=this.abs(),tt=et.abs(),nt=_.t;for($.t=nt+tt.t;--nt>=0;)$[nt]=0;for(nt=0;nt<tt.t;++nt)$[nt+_.t]=_.am(0,tt[nt],$,nt,0,_.t);$.s=0,$.clamp(),this.s!=et.s&&BigInteger.ZERO.subTo($,$)}function bnpSquareTo(et){for(var $=this.abs(),_=et.t=2*$.t;--_>=0;)et[_]=0;for(_=0;_<$.t-1;++_){var tt=$.am(_,$[_],et,2*_,0,1);(et[_+$.t]+=$.am(_+1,2*$[_],et,2*_+1,tt,$.t-_-1))>=$.DV&&(et[_+$.t]-=$.DV,et[_+$.t+1]=1)}et.t>0&&(et[et.t-1]+=$.am(_,$[_],et,2*_,0,1)),et.s=0,et.clamp()}function bnpDivRemTo(et,$,_){var tt=et.abs();if(!(tt.t<=0)){var nt=this.abs();if(nt.t<tt.t){$!=null&&$.fromInt(0),_!=null&&this.copyTo(_);return}_==null&&(_=nbi());var it=nbi(),rt=this.s,ot=et.s,lt=this.DB-nbits(tt[tt.t-1]);lt>0?(tt.lShiftTo(lt,it),nt.lShiftTo(lt,_)):(tt.copyTo(it),nt.copyTo(_));var st=it.t,at=it[st-1];if(at!=0){var ct=at*(1<<this.F1)+(st>1?it[st-2]>>this.F2:0),dt=this.FV/ct,ut=(1<<this.F1)/ct,ft=1<<this.F2,pt=_.t,St=pt-st,gt=$??nbi();for(it.dlShiftTo(St,gt),_.compareTo(gt)>=0&&(_[_.t++]=1,_.subTo(gt,_)),BigInteger.ONE.dlShiftTo(st,gt),gt.subTo(it,it);it.t<st;)it[it.t++]=0;for(;--St>=0;){var yt=_[--pt]==at?this.DM:Math.floor(_[pt]*dt+(_[pt-1]+ft)*ut);if((_[pt]+=it.am(0,yt,_,St,0,st))<yt)for(it.dlShiftTo(St,gt),_.subTo(gt,_);_[pt]<--yt;)_.subTo(gt,_)}$!=null&&(_.drShiftTo(st,$),rt!=ot&&BigInteger.ZERO.subTo($,$)),_.t=st,_.clamp(),lt>0&&_.rShiftTo(lt,_),rt<0&&BigInteger.ZERO.subTo(_,_)}}}function bnMod(et){var $=nbi();return this.abs().divRemTo(et,null,$),this.s<0&&$.compareTo(BigInteger.ZERO)>0&&et.subTo($,$),$}function bnpInvDigit(){if(this.t<1)return 0;var et=this[0];if(!(et&1))return 0;var $=et&3;return $=$*(2-(et&15)*$)&15,$=$*(2-(et&255)*$)&255,$=$*(2-((et&65535)*$&65535))&65535,$=$*(2-et*$%this.DV)%this.DV,$>0?this.DV-$:-$}function bnEquals(et){return this.compareTo(et)==0}function bnpAddTo(et,$){for(var _=0,tt=0,nt=Math.min(et.t,this.t);_<nt;)tt+=this[_]+et[_],$[_++]=tt&this.DM,tt>>=this.DB;if(et.t<this.t){for(tt+=et.s;_<this.t;)tt+=this[_],$[_++]=tt&this.DM,tt>>=this.DB;tt+=this.s}else{for(tt+=this.s;_<et.t;)tt+=et[_],$[_++]=tt&this.DM,tt>>=this.DB;tt+=et.s}$.s=tt<0?-1:0,tt>0?$[_++]=tt:tt<-1&&($[_++]=this.DV+tt),$.t=_,$.clamp()}function bnAdd(et){var $=nbi();return this.addTo(et,$),$}function bnSubtract(et){var $=nbi();return this.subTo(et,$),$}function bnMultiply(et){var $=nbi();return this.multiplyTo(et,$),$}function bnDivide(et){var $=nbi();return this.divRemTo(et,$,null),$}function Montgomery(et){this.m=et,this.mp=et.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<et.DB-15)-1,this.mt2=2*et.t}function montConvert(et){var $=nbi();return et.abs().dlShiftTo(this.m.t,$),$.divRemTo(this.m,null,$),et.s<0&&$.compareTo(BigInteger.ZERO)>0&&this.m.subTo($,$),$}function montRevert(et){var $=nbi();return et.copyTo($),this.reduce($),$}function montReduce(et){for(;et.t<=this.mt2;)et[et.t++]=0;for(var $=0;$<this.m.t;++$){var _=et[$]&32767,tt=_*this.mpl+((_*this.mph+(et[$]>>15)*this.mpl&this.um)<<15)&et.DM;for(_=$+this.m.t,et[_]+=this.m.am(0,tt,et,$,0,this.m.t);et[_]>=et.DV;)et[_]-=et.DV,et[++_]++}et.clamp(),et.drShiftTo(this.m.t,et),et.compareTo(this.m)>=0&&et.subTo(this.m,et)}function montSqrTo(et,$){et.squareTo($),this.reduce($)}function montMulTo(et,$,_){et.multiplyTo($,_),this.reduce(_)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnModPow(et,$,_){var tt=et.bitLength(),nt,it=nbv(1),rt=new Montgomery($);if(tt<=0)return it;tt<18?nt=1:tt<48?nt=3:tt<144?nt=4:tt<768?nt=5:nt=6;var ot=new Array,lt=3,st=nt-1,at=(1<<nt)-1;if(ot[1]=rt.convert(this),nt>1){var ct=nbi();for(rt.sqrTo(ot[1],ct);lt<=at;)ot[lt]=nbi(),rt.mulTo(ct,ot[lt-2],ot[lt]),lt+=2}var dt=et.t-1,ut,ft=!0,pt=nbi(),St;for(tt=nbits(et[dt])-1;dt>=0;){for(tt>=st?ut=et[dt]>>tt-st&at:(ut=(et[dt]&(1<<tt+1)-1)<<st-tt,dt>0&&(ut|=et[dt-1]>>this.DB+tt-st)),lt=nt;!(ut&1);)ut>>=1,--lt;if((tt-=lt)<0&&(tt+=this.DB,--dt),ft)ot[ut].copyTo(it),ft=!1;else{for(;lt>1;)rt.sqrTo(it,pt),rt.sqrTo(pt,it),lt-=2;lt>0?rt.sqrTo(it,pt):(St=it,it=pt,pt=St),rt.mulTo(pt,ot[ut],it)}for(;dt>=0&&!(et[dt]&1<<tt);)rt.sqrTo(it,pt),St=it,it=pt,pt=St,--tt<0&&(tt=this.DB-1,--dt)}var gt=rt.revert(it);return _(null,gt),gt}BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.addTo=bnpAddTo;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.equals=bnEquals;BigInteger.prototype.add=bnAdd;BigInteger.prototype.subtract=bnSubtract;BigInteger.prototype.multiply=bnMultiply;BigInteger.prototype.divide=bnDivide;BigInteger.prototype.modPow=bnModPow;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */function randomBytes(et){return buffer.Buffer.from(new WordArray().random(et).toString(),"hex")}var HEX_MSB_REGEX=/^[89a-f]/i,initN="FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",newPasswordRequiredChallengeUserAttributePrefix="userAttributes.",AuthenticationHelper=function(){function et(_){this.N=new BigInteger(initN,16),this.g=new BigInteger("2",16),this.k=new BigInteger(this.hexHash(""+this.padHex(this.N)+this.padHex(this.g)),16),this.smallAValue=this.generateRandomSmallA(),this.getLargeAValue(function(){}),this.infoBits=buffer.Buffer.from("Caldera Derived Key","utf8"),this.poolName=_}var $=et.prototype;return $.getSmallAValue=function(){return this.smallAValue},$.getLargeAValue=function(tt){var nt=this;this.largeAValue?tt(null,this.largeAValue):this.calculateA(this.smallAValue,function(it,rt){it&&tt(it,null),nt.largeAValue=rt,tt(null,nt.largeAValue)})},$.generateRandomSmallA=function(){var tt=randomBytes(128).toString("hex"),nt=new BigInteger(tt,16);return nt},$.generateRandomString=function(){return randomBytes(40).toString("base64")},$.getRandomPassword=function(){return this.randomPassword},$.getSaltDevices=function(){return this.SaltToHashDevices},$.getVerifierDevices=function(){return this.verifierDevices},$.generateHashDevice=function(tt,nt,it){var rt=this;this.randomPassword=this.generateRandomString();var ot=""+tt+nt+":"+this.randomPassword,lt=this.hash(ot),st=randomBytes(16).toString("hex");this.SaltToHashDevices=this.padHex(new BigInteger(st,16)),this.g.modPow(new BigInteger(this.hexHash(this.SaltToHashDevices+lt),16),this.N,function(at,ct){at&&it(at,null),rt.verifierDevices=rt.padHex(ct),it(null,null)})},$.calculateA=function(tt,nt){var it=this;this.g.modPow(tt,this.N,function(rt,ot){rt&&nt(rt,null),ot.mod(it.N).equals(BigInteger.ZERO)&&nt(new Error("Illegal paramater. A mod N cannot be 0."),null),nt(null,ot)})},$.calculateU=function(tt,nt){this.UHexHash=this.hexHash(this.padHex(tt)+this.padHex(nt));var it=new BigInteger(this.UHexHash,16);return it},$.hash=function(tt){var nt=new build$4.Sha256;nt.update(tt);var it=nt.digestSync(),rt=buffer.Buffer.from(it).toString("hex");return new Array(64-rt.length).join("0")+rt},$.hexHash=function(tt){return this.hash(buffer.Buffer.from(tt,"hex"))},$.computehkdf=function(tt,nt){var it=buffer.Buffer.concat([this.infoBits,buffer.Buffer.from(String.fromCharCode(1),"utf8")]),rt=new build$4.Sha256(nt);rt.update(tt);var ot=rt.digestSync(),lt=new build$4.Sha256(ot);lt.update(it);var st=lt.digestSync(),at=st,ct=at.slice(0,16);return ct},$.getPasswordAuthenticationKey=function(tt,nt,it,rt,ot){var lt=this;if(it.mod(this.N).equals(BigInteger.ZERO))throw new Error("B cannot be zero.");if(this.UValue=this.calculateU(this.largeAValue,it),this.UValue.equals(BigInteger.ZERO))throw new Error("U cannot be zero.");var st=""+this.poolName+tt+":"+nt,at=this.hash(st),ct=new BigInteger(this.hexHash(this.padHex(rt)+at),16);this.calculateS(ct,it,function(dt,ut){dt&&ot(dt,null);var ft=lt.computehkdf(buffer.Buffer.from(lt.padHex(ut),"hex"),buffer.Buffer.from(lt.padHex(lt.UValue),"hex"));ot(null,ft)})},$.calculateS=function(tt,nt,it){var rt=this;this.g.modPow(tt,this.N,function(ot,lt){ot&&it(ot,null);var st=nt.subtract(rt.k.multiply(lt));st.modPow(rt.smallAValue.add(rt.UValue.multiply(tt)),rt.N,function(at,ct){at&&it(at,null),it(null,ct.mod(rt.N))})})},$.getNewPasswordRequiredChallengeUserAttributePrefix=function(){return newPasswordRequiredChallengeUserAttributePrefix},$.padHex=function(tt){if(!(tt instanceof BigInteger))throw new Error("Not a BigInteger");var nt=tt.compareTo(BigInteger.ZERO)<0,it=tt.abs().toString(16);if(it=it.length%2!==0?"0"+it:it,it=HEX_MSB_REGEX.test(it)?"00"+it:it,nt){var rt=it.split("").map(function(lt){var st=~parseInt(lt,16)&15;return"0123456789ABCDEF".charAt(st)}).join(""),ot=new BigInteger(rt,16).add(BigInteger.ONE);it=ot.toString(16),it.toUpperCase().startsWith("FF8")&&(it=it.substring(2))}return it},et}();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var CognitoJwtToken=function(){function et(_){this.jwtToken=_||"",this.payload=this.decodePayload()}var $=et.prototype;return $.getJwtToken=function(){return this.jwtToken},$.getExpiration=function(){return this.payload.exp},$.getIssuedAt=function(){return this.payload.iat},$.decodePayload=function(){var tt=this.jwtToken.split(".")[1];try{return JSON.parse(buffer.Buffer.from(tt,"base64").toString("utf8"))}catch{return{}}},et}();function _inheritsLoose$2(et,$){et.prototype=Object.create($.prototype),et.prototype.constructor=et,_setPrototypeOf$2(et,$)}function _setPrototypeOf$2(et,$){return _setPrototypeOf$2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,tt){return _.__proto__=tt,_},_setPrototypeOf$2(et,$)}var CognitoAccessToken=function(et){function $(_){var tt=_===void 0?{}:_,nt=tt.AccessToken;return et.call(this,nt||"")||this}return _inheritsLoose$2($,et),$}(CognitoJwtToken);function _inheritsLoose$1(et,$){et.prototype=Object.create($.prototype),et.prototype.constructor=et,_setPrototypeOf$1(et,$)}function _setPrototypeOf$1(et,$){return _setPrototypeOf$1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,tt){return _.__proto__=tt,_},_setPrototypeOf$1(et,$)}var CognitoIdToken=function(et){function $(_){var tt=_===void 0?{}:_,nt=tt.IdToken;return et.call(this,nt||"")||this}return _inheritsLoose$1($,et),$}(CognitoJwtToken);/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var CognitoRefreshToken=function(){function et(_){var tt=_===void 0?{}:_,nt=tt.RefreshToken;this.token=nt||""}var $=et.prototype;return $.getToken=function(){return this.token},et}(),version$3="5.0.4";/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var BASE_USER_AGENT="aws-amplify/"+version$3,Platform={userAgent:BASE_USER_AGENT,isReactNative:typeof navigator<"u"&&navigator.product==="ReactNative"},getUserAgent=function(){return Platform.userAgent};/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var CognitoUserSession=function(){function et(_){var tt=_===void 0?{}:_,nt=tt.IdToken,it=tt.RefreshToken,rt=tt.AccessToken,ot=tt.ClockDrift;if(rt==null||nt==null)throw new Error("Id token and Access Token must be present.");this.idToken=nt,this.refreshToken=it,this.accessToken=rt,this.clockDrift=ot===void 0?this.calculateClockDrift():ot}var $=et.prototype;return $.getIdToken=function(){return this.idToken},$.getRefreshToken=function(){return this.refreshToken},$.getAccessToken=function(){return this.accessToken},$.getClockDrift=function(){return this.clockDrift},$.calculateClockDrift=function(){var tt=Math.floor(new Date/1e3),nt=Math.min(this.accessToken.getIssuedAt(),this.idToken.getIssuedAt());return tt-nt},$.isValid=function(){var tt=Math.floor(new Date/1e3),nt=tt-this.clockDrift;return nt<this.accessToken.getExpiration()&&nt<this.idToken.getExpiration()},et}();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],DateHelper=function(){function et(){}var $=et.prototype;return $.getNowString=function(){var tt=new Date,nt=weekNames[tt.getUTCDay()],it=monthNames[tt.getUTCMonth()],rt=tt.getUTCDate(),ot=tt.getUTCHours();ot<10&&(ot="0"+ot);var lt=tt.getUTCMinutes();lt<10&&(lt="0"+lt);var st=tt.getUTCSeconds();st<10&&(st="0"+st);var at=tt.getUTCFullYear(),ct=nt+" "+it+" "+rt+" "+ot+":"+lt+":"+st+" UTC "+at;return ct},et}();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var CognitoUserAttribute=function(){function et(_){var tt=_===void 0?{}:_,nt=tt.Name,it=tt.Value;this.Name=nt||"",this.Value=it||""}var $=et.prototype;return $.getValue=function(){return this.Value},$.setValue=function(tt){return this.Value=tt,this},$.getName=function(){return this.Name},$.setName=function(tt){return this.Name=tt,this},$.toString=function(){return JSON.stringify(this)},$.toJSON=function(){return{Name:this.Name,Value:this.Value}},et}();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var dataMemory={},MemoryStorage=function(){function et(){}return et.setItem=function(_,tt){return dataMemory[_]=tt,dataMemory[_]},et.getItem=function(_){return Object.prototype.hasOwnProperty.call(dataMemory,_)?dataMemory[_]:void 0},et.removeItem=function(_){return delete dataMemory[_]},et.clear=function(){return dataMemory={},dataMemory},et}(),StorageHelper=function(){function et(){try{this.storageWindow=window.localStorage,this.storageWindow.setItem("aws.cognito.test-ls",1),this.storageWindow.removeItem("aws.cognito.test-ls")}catch{this.storageWindow=MemoryStorage}}var $=et.prototype;return $.getStorage=function(){return this.storageWindow},et}();/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var isNavigatorAvailable=typeof navigator<"u",userAgent=isNavigatorAvailable?Platform.isReactNative?"react-native":navigator.userAgent:"nodejs",CognitoUser=function(){function et(_){if(_==null||_.Username==null||_.Pool==null)throw new Error("Username and Pool information are required.");this.username=_.Username||"",this.pool=_.Pool,this.Session=null,this.client=_.Pool.client,this.signInUserSession=null,this.authenticationFlowType="USER_SRP_AUTH",this.storage=_.Storage||new StorageHelper().getStorage(),this.keyPrefix="CognitoIdentityServiceProvider."+this.pool.getClientId(),this.userDataKey=this.keyPrefix+"."+this.username+".userData"}var $=et.prototype;return $.setSignInUserSession=function(tt){this.clearCachedUserData(),this.signInUserSession=tt,this.cacheTokens()},$.getSignInUserSession=function(){return this.signInUserSession},$.getUsername=function(){return this.username},$.getAuthenticationFlowType=function(){return this.authenticationFlowType},$.setAuthenticationFlowType=function(tt){this.authenticationFlowType=tt},$.initiateAuth=function(tt,nt){var it=this,rt=tt.getAuthParameters();rt.USERNAME=this.username;var ot=Object.keys(tt.getValidationData()).length!==0?tt.getValidationData():tt.getClientMetadata(),lt={AuthFlow:"CUSTOM_AUTH",ClientId:this.pool.getClientId(),AuthParameters:rt,ClientMetadata:ot};this.getUserContextData()&&(lt.UserContextData=this.getUserContextData()),this.client.request("InitiateAuth",lt,function(st,at){if(st)return nt.onFailure(st);var ct=at.ChallengeName,dt=at.ChallengeParameters;return ct==="CUSTOM_CHALLENGE"?(it.Session=at.Session,nt.customChallenge(dt)):(it.signInUserSession=it.getCognitoUserSession(at.AuthenticationResult),it.cacheTokens(),nt.onSuccess(it.signInUserSession))})},$.authenticateUser=function(tt,nt){return this.authenticationFlowType==="USER_PASSWORD_AUTH"?this.authenticateUserPlainUsernamePassword(tt,nt):this.authenticationFlowType==="USER_SRP_AUTH"||this.authenticationFlowType==="CUSTOM_AUTH"?this.authenticateUserDefaultAuth(tt,nt):nt.onFailure(new Error("Authentication flow type is invalid."))},$.authenticateUserDefaultAuth=function(tt,nt){var it=this,rt=new AuthenticationHelper(this.pool.getUserPoolName()),ot=new DateHelper,lt,st,at={};this.deviceKey!=null&&(at.DEVICE_KEY=this.deviceKey),at.USERNAME=this.username,rt.getLargeAValue(function(ct,dt){ct&&nt.onFailure(ct),at.SRP_A=dt.toString(16),it.authenticationFlowType==="CUSTOM_AUTH"&&(at.CHALLENGE_NAME="SRP_A");var ut=Object.keys(tt.getValidationData()).length!==0?tt.getValidationData():tt.getClientMetadata(),ft={AuthFlow:it.authenticationFlowType,ClientId:it.pool.getClientId(),AuthParameters:at,ClientMetadata:ut};it.getUserContextData(it.username)&&(ft.UserContextData=it.getUserContextData(it.username)),it.client.request("InitiateAuth",ft,function(pt,St){if(pt)return nt.onFailure(pt);var gt=St.ChallengeParameters;it.username=gt.USER_ID_FOR_SRP,it.userDataKey=it.keyPrefix+"."+it.username+".userData",lt=new BigInteger(gt.SRP_B,16),st=new BigInteger(gt.SALT,16),it.getCachedDeviceKeyAndPassword(),rt.getPasswordAuthenticationKey(it.username,tt.getPassword(),lt,st,function(yt,vt){yt&&nt.onFailure(yt);var Ct=ot.getNowString(),Et=buffer.Buffer.concat([buffer.Buffer.from(it.pool.getUserPoolName(),"utf8"),buffer.Buffer.from(it.username,"utf8"),buffer.Buffer.from(gt.SECRET_BLOCK,"base64"),buffer.Buffer.from(Ct,"utf8")]),Mt=new build$4.Sha256(vt);Mt.update(Et);var Rt=Mt.digestSync(),At=buffer.Buffer.from(Rt).toString("base64"),Dt={};Dt.USERNAME=it.username,Dt.PASSWORD_CLAIM_SECRET_BLOCK=gt.SECRET_BLOCK,Dt.TIMESTAMP=Ct,Dt.PASSWORD_CLAIM_SIGNATURE=At,it.deviceKey!=null&&(Dt.DEVICE_KEY=it.deviceKey);var It=function(qt,cn){return it.client.request("RespondToAuthChallenge",qt,function(dn,an){return dn&&dn.code==="ResourceNotFoundException"&&dn.message.toLowerCase().indexOf("device")!==-1?(Dt.DEVICE_KEY=null,it.deviceKey=null,it.randomPassword=null,it.deviceGroupKey=null,it.clearCachedDeviceKeyAndPassword(),It(qt,cn)):cn(dn,an)})},Vt={ChallengeName:"PASSWORD_VERIFIER",ClientId:it.pool.getClientId(),ChallengeResponses:Dt,Session:St.Session,ClientMetadata:ut};it.getUserContextData()&&(Vt.UserContextData=it.getUserContextData()),It(Vt,function(jt,qt){return jt?nt.onFailure(jt):it.authenticateUserInternal(qt,rt,nt)})})})})},$.authenticateUserPlainUsernamePassword=function(tt,nt){var it=this,rt={};if(rt.USERNAME=this.username,rt.PASSWORD=tt.getPassword(),!rt.PASSWORD){nt.onFailure(new Error("PASSWORD parameter is required"));return}var ot=new AuthenticationHelper(this.pool.getUserPoolName());this.getCachedDeviceKeyAndPassword(),this.deviceKey!=null&&(rt.DEVICE_KEY=this.deviceKey);var lt=Object.keys(tt.getValidationData()).length!==0?tt.getValidationData():tt.getClientMetadata(),st={AuthFlow:"USER_PASSWORD_AUTH",ClientId:this.pool.getClientId(),AuthParameters:rt,ClientMetadata:lt};this.getUserContextData(this.username)&&(st.UserContextData=this.getUserContextData(this.username)),this.client.request("InitiateAuth",st,function(at,ct){return at?nt.onFailure(at):it.authenticateUserInternal(ct,ot,nt)})},$.authenticateUserInternal=function(tt,nt,it){var rt=this,ot=tt.ChallengeName,lt=tt.ChallengeParameters;if(ot==="SMS_MFA")return this.Session=tt.Session,it.mfaRequired(ot,lt);if(ot==="SELECT_MFA_TYPE")return this.Session=tt.Session,it.selectMFAType(ot,lt);if(ot==="MFA_SETUP")return this.Session=tt.Session,it.mfaSetup(ot,lt);if(ot==="SOFTWARE_TOKEN_MFA")return this.Session=tt.Session,it.totpRequired(ot,lt);if(ot==="CUSTOM_CHALLENGE")return this.Session=tt.Session,it.customChallenge(lt);if(ot==="NEW_PASSWORD_REQUIRED"){this.Session=tt.Session;var st=null,at=null,ct=[],dt=nt.getNewPasswordRequiredChallengeUserAttributePrefix();if(lt&&(st=JSON.parse(tt.ChallengeParameters.userAttributes),at=JSON.parse(tt.ChallengeParameters.requiredAttributes)),at)for(var ut=0;ut<at.length;ut++)ct[ut]=at[ut].substr(dt.length);return it.newPasswordRequired(st,ct)}if(ot==="DEVICE_SRP_AUTH"){this.Session=tt.Session,this.getDeviceResponse(it);return}this.signInUserSession=this.getCognitoUserSession(tt.AuthenticationResult),this.challengeName=ot,this.cacheTokens();var ft=tt.AuthenticationResult.NewDeviceMetadata;if(ft==null)return it.onSuccess(this.signInUserSession);nt.generateHashDevice(tt.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,tt.AuthenticationResult.NewDeviceMetadata.DeviceKey,function(pt){if(pt)return it.onFailure(pt);var St={Salt:buffer.Buffer.from(nt.getSaltDevices(),"hex").toString("base64"),PasswordVerifier:buffer.Buffer.from(nt.getVerifierDevices(),"hex").toString("base64")};rt.verifierDevices=St.PasswordVerifier,rt.deviceGroupKey=ft.DeviceGroupKey,rt.randomPassword=nt.getRandomPassword(),rt.client.request("ConfirmDevice",{DeviceKey:ft.DeviceKey,AccessToken:rt.signInUserSession.getAccessToken().getJwtToken(),DeviceSecretVerifierConfig:St,DeviceName:userAgent},function(gt,yt){return gt?it.onFailure(gt):(rt.deviceKey=tt.AuthenticationResult.NewDeviceMetadata.DeviceKey,rt.cacheDeviceKeyAndPassword(),yt.UserConfirmationNecessary===!0?it.onSuccess(rt.signInUserSession,yt.UserConfirmationNecessary):it.onSuccess(rt.signInUserSession))})})},$.completeNewPasswordChallenge=function(tt,nt,it,rt){var ot=this;if(!tt)return it.onFailure(new Error("New password is required."));var lt=new AuthenticationHelper(this.pool.getUserPoolName()),st=lt.getNewPasswordRequiredChallengeUserAttributePrefix(),at={};nt&&Object.keys(nt).forEach(function(dt){at[st+dt]=nt[dt]}),at.NEW_PASSWORD=tt,at.USERNAME=this.username;var ct={ChallengeName:"NEW_PASSWORD_REQUIRED",ClientId:this.pool.getClientId(),ChallengeResponses:at,Session:this.Session,ClientMetadata:rt};this.getUserContextData()&&(ct.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",ct,function(dt,ut){return dt?it.onFailure(dt):ot.authenticateUserInternal(ut,lt,it)})},$.getDeviceResponse=function(tt,nt){var it=this,rt=new AuthenticationHelper(this.deviceGroupKey),ot=new DateHelper,lt={};lt.USERNAME=this.username,lt.DEVICE_KEY=this.deviceKey,rt.getLargeAValue(function(st,at){st&&tt.onFailure(st),lt.SRP_A=at.toString(16);var ct={ChallengeName:"DEVICE_SRP_AUTH",ClientId:it.pool.getClientId(),ChallengeResponses:lt,ClientMetadata:nt,Session:it.Session};it.getUserContextData()&&(ct.UserContextData=it.getUserContextData()),it.client.request("RespondToAuthChallenge",ct,function(dt,ut){if(dt)return tt.onFailure(dt);var ft=ut.ChallengeParameters,pt=new BigInteger(ft.SRP_B,16),St=new BigInteger(ft.SALT,16);rt.getPasswordAuthenticationKey(it.deviceKey,it.randomPassword,pt,St,function(gt,yt){if(gt)return tt.onFailure(gt);var vt=ot.getNowString(),Ct=buffer.Buffer.concat([buffer.Buffer.from(it.deviceGroupKey,"utf8"),buffer.Buffer.from(it.deviceKey,"utf8"),buffer.Buffer.from(ft.SECRET_BLOCK,"base64"),buffer.Buffer.from(vt,"utf8")]),Et=new build$4.Sha256(yt);Et.update(Ct);var Mt=Et.digestSync(),Rt=buffer.Buffer.from(Mt).toString("base64"),At={};At.USERNAME=it.username,At.PASSWORD_CLAIM_SECRET_BLOCK=ft.SECRET_BLOCK,At.TIMESTAMP=vt,At.PASSWORD_CLAIM_SIGNATURE=Rt,At.DEVICE_KEY=it.deviceKey;var Dt={ChallengeName:"DEVICE_PASSWORD_VERIFIER",ClientId:it.pool.getClientId(),ChallengeResponses:At,Session:ut.Session};it.getUserContextData()&&(Dt.UserContextData=it.getUserContextData()),it.client.request("RespondToAuthChallenge",Dt,function(It,Vt){return It?tt.onFailure(It):(it.signInUserSession=it.getCognitoUserSession(Vt.AuthenticationResult),it.cacheTokens(),tt.onSuccess(it.signInUserSession))})})})})},$.confirmRegistration=function(tt,nt,it,rt){var ot={ClientId:this.pool.getClientId(),ConfirmationCode:tt,Username:this.username,ForceAliasCreation:nt,ClientMetadata:rt};this.getUserContextData()&&(ot.UserContextData=this.getUserContextData()),this.client.request("ConfirmSignUp",ot,function(lt){return lt?it(lt,null):it(null,"SUCCESS")})},$.sendCustomChallengeAnswer=function(tt,nt,it){var rt=this,ot={};ot.USERNAME=this.username,ot.ANSWER=tt;var lt=new AuthenticationHelper(this.pool.getUserPoolName());this.getCachedDeviceKeyAndPassword(),this.deviceKey!=null&&(ot.DEVICE_KEY=this.deviceKey);var st={ChallengeName:"CUSTOM_CHALLENGE",ChallengeResponses:ot,ClientId:this.pool.getClientId(),Session:this.Session,ClientMetadata:it};this.getUserContextData()&&(st.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",st,function(at,ct){return at?nt.onFailure(at):rt.authenticateUserInternal(ct,lt,nt)})},$.sendMFACode=function(tt,nt,it,rt){var ot=this,lt={};lt.USERNAME=this.username,lt.SMS_MFA_CODE=tt;var st=it||"SMS_MFA";st==="SOFTWARE_TOKEN_MFA"&&(lt.SOFTWARE_TOKEN_MFA_CODE=tt),this.deviceKey!=null&&(lt.DEVICE_KEY=this.deviceKey);var at={ChallengeName:st,ChallengeResponses:lt,ClientId:this.pool.getClientId(),Session:this.Session,ClientMetadata:rt};this.getUserContextData()&&(at.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",at,function(ct,dt){if(ct)return nt.onFailure(ct);var ut=dt.ChallengeName;if(ut==="DEVICE_SRP_AUTH"){ot.getDeviceResponse(nt);return}if(ot.signInUserSession=ot.getCognitoUserSession(dt.AuthenticationResult),ot.cacheTokens(),dt.AuthenticationResult.NewDeviceMetadata==null)return nt.onSuccess(ot.signInUserSession);var ft=new AuthenticationHelper(ot.pool.getUserPoolName());ft.generateHashDevice(dt.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,dt.AuthenticationResult.NewDeviceMetadata.DeviceKey,function(pt){if(pt)return nt.onFailure(pt);var St={Salt:buffer.Buffer.from(ft.getSaltDevices(),"hex").toString("base64"),PasswordVerifier:buffer.Buffer.from(ft.getVerifierDevices(),"hex").toString("base64")};ot.verifierDevices=St.PasswordVerifier,ot.deviceGroupKey=dt.AuthenticationResult.NewDeviceMetadata.DeviceGroupKey,ot.randomPassword=ft.getRandomPassword(),ot.client.request("ConfirmDevice",{DeviceKey:dt.AuthenticationResult.NewDeviceMetadata.DeviceKey,AccessToken:ot.signInUserSession.getAccessToken().getJwtToken(),DeviceSecretVerifierConfig:St,DeviceName:userAgent},function(gt,yt){return gt?nt.onFailure(gt):(ot.deviceKey=dt.AuthenticationResult.NewDeviceMetadata.DeviceKey,ot.cacheDeviceKeyAndPassword(),yt.UserConfirmationNecessary===!0?nt.onSuccess(ot.signInUserSession,yt.UserConfirmationNecessary):nt.onSuccess(ot.signInUserSession))})})})},$.changePassword=function(tt,nt,it,rt){if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return it(new Error("User is not authenticated"),null);this.client.request("ChangePassword",{PreviousPassword:tt,ProposedPassword:nt,AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),ClientMetadata:rt},function(ot){return ot?it(ot,null):it(null,"SUCCESS")})},$.enableMFA=function(tt){if(this.signInUserSession==null||!this.signInUserSession.isValid())return tt(new Error("User is not authenticated"),null);var nt=[],it={DeliveryMedium:"SMS",AttributeName:"phone_number"};nt.push(it),this.client.request("SetUserSettings",{MFAOptions:nt,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(rt){return rt?tt(rt,null):tt(null,"SUCCESS")})},$.setUserMfaPreference=function(tt,nt,it){if(this.signInUserSession==null||!this.signInUserSession.isValid())return it(new Error("User is not authenticated"),null);this.client.request("SetUserMFAPreference",{SMSMfaSettings:tt,SoftwareTokenMfaSettings:nt,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(rt){return rt?it(rt,null):it(null,"SUCCESS")})},$.disableMFA=function(tt){if(this.signInUserSession==null||!this.signInUserSession.isValid())return tt(new Error("User is not authenticated"),null);var nt=[];this.client.request("SetUserSettings",{MFAOptions:nt,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(it){return it?tt(it,null):tt(null,"SUCCESS")})},$.deleteUser=function(tt,nt){var it=this;if(this.signInUserSession==null||!this.signInUserSession.isValid())return tt(new Error("User is not authenticated"),null);this.client.request("DeleteUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),ClientMetadata:nt},function(rt){return rt?tt(rt,null):(it.clearCachedUser(),tt(null,"SUCCESS"))})},$.updateAttributes=function(tt,nt,it){var rt=this;if(this.signInUserSession==null||!this.signInUserSession.isValid())return nt(new Error("User is not authenticated"),null);this.client.request("UpdateUserAttributes",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),UserAttributes:tt,ClientMetadata:it},function(ot,lt){return ot?nt(ot,null):rt.getUserData(function(){return nt(null,"SUCCESS",lt)},{bypassCache:!0})})},$.getUserAttributes=function(tt){if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return tt(new Error("User is not authenticated"),null);this.client.request("GetUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(nt,it){if(nt)return tt(nt,null);for(var rt=[],ot=0;ot<it.UserAttributes.length;ot++){var lt={Name:it.UserAttributes[ot].Name,Value:it.UserAttributes[ot].Value},st=new CognitoUserAttribute(lt);rt.push(st)}return tt(null,rt)})},$.getMFAOptions=function(tt){if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return tt(new Error("User is not authenticated"),null);this.client.request("GetUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(nt,it){return nt?tt(nt,null):tt(null,it.MFAOptions)})},$.createGetUserRequest=function(){return this.client.promisifyRequest("GetUser",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()})},$.refreshSessionIfPossible=function(tt){var nt=this;return tt===void 0&&(tt={}),new Promise(function(it){var rt=nt.signInUserSession.getRefreshToken();rt&&rt.getToken()?nt.refreshSession(rt,it,tt.clientMetadata):it()})},$.getUserData=function(tt,nt){var it=this;if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return this.clearCachedUserData(),tt(new Error("User is not authenticated"),null);var rt=this.getUserDataFromCache();if(!rt){this.fetchUserData().then(function(ot){tt(null,ot)}).catch(tt);return}if(this.isFetchUserDataAndTokenRequired(nt)){this.fetchUserData().then(function(ot){return it.refreshSessionIfPossible(nt).then(function(){return ot})}).then(function(ot){return tt(null,ot)}).catch(tt);return}try{tt(null,JSON.parse(rt));return}catch(ot){this.clearCachedUserData(),tt(ot,null);return}},$.getUserDataFromCache=function(){var tt=this.storage.getItem(this.userDataKey);return tt},$.isFetchUserDataAndTokenRequired=function(tt){var nt=tt||{},it=nt.bypassCache,rt=it===void 0?!1:it;return rt},$.fetchUserData=function(){var tt=this;return this.createGetUserRequest().then(function(nt){return tt.cacheUserData(nt),nt})},$.deleteAttributes=function(tt,nt){var it=this;if(!(this.signInUserSession!=null&&this.signInUserSession.isValid()))return nt(new Error("User is not authenticated"),null);this.client.request("DeleteUserAttributes",{UserAttributeNames:tt,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(rt){return rt?nt(rt,null):it.getUserData(function(){return nt(null,"SUCCESS")},{bypassCache:!0})})},$.resendConfirmationCode=function(tt,nt){var it={ClientId:this.pool.getClientId(),Username:this.username,ClientMetadata:nt};this.client.request("ResendConfirmationCode",it,function(rt,ot){return rt?tt(rt,null):tt(null,ot)})},$.getSession=function(tt,nt){if(nt===void 0&&(nt={}),this.username==null)return tt(new Error("Username is null. Cannot retrieve a new session"),null);if(this.signInUserSession!=null&&this.signInUserSession.isValid())return tt(null,this.signInUserSession);var it="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,rt=it+".idToken",ot=it+".accessToken",lt=it+".refreshToken",st=it+".clockDrift";if(this.storage.getItem(rt)){var at=new CognitoIdToken({IdToken:this.storage.getItem(rt)}),ct=new CognitoAccessToken({AccessToken:this.storage.getItem(ot)}),dt=new CognitoRefreshToken({RefreshToken:this.storage.getItem(lt)}),ut=parseInt(this.storage.getItem(st),0)||0,ft={IdToken:at,AccessToken:ct,RefreshToken:dt,ClockDrift:ut},pt=new CognitoUserSession(ft);if(pt.isValid())return this.signInUserSession=pt,tt(null,this.signInUserSession);if(!dt.getToken())return tt(new Error("Cannot retrieve a new session. Please authenticate."),null);this.refreshSession(dt,tt,nt.clientMetadata)}else tt(new Error("Local storage is missing an ID Token, Please authenticate"),null)},$.refreshSession=function(tt,nt,it){var rt=this,ot=this.pool.wrapRefreshSessionCallback?this.pool.wrapRefreshSessionCallback(nt):nt,lt={};lt.REFRESH_TOKEN=tt.getToken();var st="CognitoIdentityServiceProvider."+this.pool.getClientId(),at=st+".LastAuthUser";if(this.storage.getItem(at)){this.username=this.storage.getItem(at);var ct=st+"."+this.username+".deviceKey";this.deviceKey=this.storage.getItem(ct),lt.DEVICE_KEY=this.deviceKey}var dt={ClientId:this.pool.getClientId(),AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:lt,ClientMetadata:it};this.getUserContextData()&&(dt.UserContextData=this.getUserContextData()),this.client.requestWithRetry("InitiateAuth",dt,function(ut,ft){if(ut)return ut.code==="NotAuthorizedException"&&rt.clearCachedUser(),ot(ut,null);if(ft){var pt=ft.AuthenticationResult;return Object.prototype.hasOwnProperty.call(pt,"RefreshToken")||(pt.RefreshToken=tt.getToken()),rt.signInUserSession=rt.getCognitoUserSession(pt),rt.cacheTokens(),ot(null,rt.signInUserSession)}})},$.cacheTokens=function(){var tt="CognitoIdentityServiceProvider."+this.pool.getClientId(),nt=tt+"."+this.username+".idToken",it=tt+"."+this.username+".accessToken",rt=tt+"."+this.username+".refreshToken",ot=tt+"."+this.username+".clockDrift",lt=tt+".LastAuthUser";this.storage.setItem(nt,this.signInUserSession.getIdToken().getJwtToken()),this.storage.setItem(it,this.signInUserSession.getAccessToken().getJwtToken()),this.storage.setItem(rt,this.signInUserSession.getRefreshToken().getToken()),this.storage.setItem(ot,""+this.signInUserSession.getClockDrift()),this.storage.setItem(lt,this.username)},$.cacheUserData=function(tt){this.storage.setItem(this.userDataKey,JSON.stringify(tt))},$.clearCachedUserData=function(){this.storage.removeItem(this.userDataKey)},$.clearCachedUser=function(){this.clearCachedTokens(),this.clearCachedUserData()},$.cacheDeviceKeyAndPassword=function(){var tt="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,nt=tt+".deviceKey",it=tt+".randomPasswordKey",rt=tt+".deviceGroupKey";this.storage.setItem(nt,this.deviceKey),this.storage.setItem(it,this.randomPassword),this.storage.setItem(rt,this.deviceGroupKey)},$.getCachedDeviceKeyAndPassword=function(){var tt="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,nt=tt+".deviceKey",it=tt+".randomPasswordKey",rt=tt+".deviceGroupKey";this.storage.getItem(nt)&&(this.deviceKey=this.storage.getItem(nt),this.randomPassword=this.storage.getItem(it),this.deviceGroupKey=this.storage.getItem(rt))},$.clearCachedDeviceKeyAndPassword=function(){var tt="CognitoIdentityServiceProvider."+this.pool.getClientId()+"."+this.username,nt=tt+".deviceKey",it=tt+".randomPasswordKey",rt=tt+".deviceGroupKey";this.storage.removeItem(nt),this.storage.removeItem(it),this.storage.removeItem(rt)},$.clearCachedTokens=function(){var tt="CognitoIdentityServiceProvider."+this.pool.getClientId(),nt=tt+"."+this.username+".idToken",it=tt+"."+this.username+".accessToken",rt=tt+"."+this.username+".refreshToken",ot=tt+".LastAuthUser",lt=tt+"."+this.username+".clockDrift";this.storage.removeItem(nt),this.storage.removeItem(it),this.storage.removeItem(rt),this.storage.removeItem(ot),this.storage.removeItem(lt)},$.getCognitoUserSession=function(tt){var nt=new CognitoIdToken(tt),it=new CognitoAccessToken(tt),rt=new CognitoRefreshToken(tt),ot={IdToken:nt,AccessToken:it,RefreshToken:rt};return new CognitoUserSession(ot)},$.forgotPassword=function(tt,nt){var it={ClientId:this.pool.getClientId(),Username:this.username,ClientMetadata:nt};this.getUserContextData()&&(it.UserContextData=this.getUserContextData()),this.client.request("ForgotPassword",it,function(rt,ot){return rt?tt.onFailure(rt):typeof tt.inputVerificationCode=="function"?tt.inputVerificationCode(ot):tt.onSuccess(ot)})},$.confirmPassword=function(tt,nt,it,rt){var ot={ClientId:this.pool.getClientId(),Username:this.username,ConfirmationCode:tt,Password:nt,ClientMetadata:rt};this.getUserContextData()&&(ot.UserContextData=this.getUserContextData()),this.client.request("ConfirmForgotPassword",ot,function(lt){return lt?it.onFailure(lt):it.onSuccess("SUCCESS")})},$.getAttributeVerificationCode=function(tt,nt,it){if(this.signInUserSession==null||!this.signInUserSession.isValid())return nt.onFailure(new Error("User is not authenticated"));this.client.request("GetUserAttributeVerificationCode",{AttributeName:tt,AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),ClientMetadata:it},function(rt,ot){return rt?nt.onFailure(rt):typeof nt.inputVerificationCode=="function"?nt.inputVerificationCode(ot):nt.onSuccess("SUCCESS")})},$.verifyAttribute=function(tt,nt,it){if(this.signInUserSession==null||!this.signInUserSession.isValid())return it.onFailure(new Error("User is not authenticated"));this.client.request("VerifyUserAttribute",{AttributeName:tt,Code:nt,AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(rt){return rt?it.onFailure(rt):it.onSuccess("SUCCESS")})},$.getDevice=function(tt){if(this.signInUserSession==null||!this.signInUserSession.isValid())return tt.onFailure(new Error("User is not authenticated"));this.client.request("GetDevice",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey},function(nt,it){return nt?tt.onFailure(nt):tt.onSuccess(it)})},$.forgetSpecificDevice=function(tt,nt){if(this.signInUserSession==null||!this.signInUserSession.isValid())return nt.onFailure(new Error("User is not authenticated"));this.client.request("ForgetDevice",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:tt},function(it){return it?nt.onFailure(it):nt.onSuccess("SUCCESS")})},$.forgetDevice=function(tt){var nt=this;this.forgetSpecificDevice(this.deviceKey,{onFailure:tt.onFailure,onSuccess:function(rt){return nt.deviceKey=null,nt.deviceGroupKey=null,nt.randomPassword=null,nt.clearCachedDeviceKeyAndPassword(),tt.onSuccess(rt)}})},$.setDeviceStatusRemembered=function(tt){if(this.signInUserSession==null||!this.signInUserSession.isValid())return tt.onFailure(new Error("User is not authenticated"));this.client.request("UpdateDeviceStatus",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey,DeviceRememberedStatus:"remembered"},function(nt){return nt?tt.onFailure(nt):tt.onSuccess("SUCCESS")})},$.setDeviceStatusNotRemembered=function(tt){if(this.signInUserSession==null||!this.signInUserSession.isValid())return tt.onFailure(new Error("User is not authenticated"));this.client.request("UpdateDeviceStatus",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),DeviceKey:this.deviceKey,DeviceRememberedStatus:"not_remembered"},function(nt){return nt?tt.onFailure(nt):tt.onSuccess("SUCCESS")})},$.listDevices=function(tt,nt,it){if(this.signInUserSession==null||!this.signInUserSession.isValid())return it.onFailure(new Error("User is not authenticated"));var rt={AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),Limit:tt};nt&&(rt.PaginationToken=nt),this.client.request("ListDevices",rt,function(ot,lt){return ot?it.onFailure(ot):it.onSuccess(lt)})},$.globalSignOut=function(tt){var nt=this;if(this.signInUserSession==null||!this.signInUserSession.isValid())return tt.onFailure(new Error("User is not authenticated"));this.client.request("GlobalSignOut",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(it){return it?tt.onFailure(it):(nt.clearCachedUser(),tt.onSuccess("SUCCESS"))})},$.signOut=function(tt){var nt=this;if(!tt||typeof tt!="function"){this.cleanClientData();return}this.getSession(function(it,rt){if(it)return tt(it);nt.revokeTokens(function(ot){nt.cleanClientData(),tt(ot)})})},$.revokeTokens=function(tt){if(tt===void 0&&(tt=function(){}),typeof tt!="function")throw new Error("Invalid revokeTokenCallback. It should be a function.");if(!this.signInUserSession){var nt=new Error("User is not authenticated");return tt(nt)}if(!this.signInUserSession.getAccessToken()){var it=new Error("No Access token available");return tt(it)}var rt=this.signInUserSession.getRefreshToken().getToken(),ot=this.signInUserSession.getAccessToken();if(this.isSessionRevocable(ot)&&rt)return this.revokeToken({token:rt,callback:tt});tt()},$.isSessionRevocable=function(tt){if(tt&&typeof tt.decodePayload=="function")try{var nt=tt.decodePayload(),it=nt.origin_jti;return!!it}catch{}return!1},$.cleanClientData=function(){this.signInUserSession=null,this.clearCachedUser()},$.revokeToken=function(tt){var nt=tt.token,it=tt.callback;this.client.requestWithRetry("RevokeToken",{Token:nt,ClientId:this.pool.getClientId()},function(rt){if(rt)return it(rt);it()})},$.sendMFASelectionAnswer=function(tt,nt){var it=this,rt={};rt.USERNAME=this.username,rt.ANSWER=tt;var ot={ChallengeName:"SELECT_MFA_TYPE",ChallengeResponses:rt,ClientId:this.pool.getClientId(),Session:this.Session};this.getUserContextData()&&(ot.UserContextData=this.getUserContextData()),this.client.request("RespondToAuthChallenge",ot,function(lt,st){if(lt)return nt.onFailure(lt);if(it.Session=st.Session,tt==="SMS_MFA")return nt.mfaRequired(st.ChallengeName,st.ChallengeParameters);if(tt==="SOFTWARE_TOKEN_MFA")return nt.totpRequired(st.ChallengeName,st.ChallengeParameters)})},$.getUserContextData=function(){var tt=this.pool;return tt.getUserContextData(this.username)},$.associateSoftwareToken=function(tt){var nt=this;this.signInUserSession!=null&&this.signInUserSession.isValid()?this.client.request("AssociateSoftwareToken",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken()},function(it,rt){return it?tt.onFailure(it):tt.associateSecretCode(rt.SecretCode)}):this.client.request("AssociateSoftwareToken",{Session:this.Session},function(it,rt){return it?tt.onFailure(it):(nt.Session=rt.Session,tt.associateSecretCode(rt.SecretCode))})},$.verifySoftwareToken=function(tt,nt,it){var rt=this;this.signInUserSession!=null&&this.signInUserSession.isValid()?this.client.request("VerifySoftwareToken",{AccessToken:this.signInUserSession.getAccessToken().getJwtToken(),UserCode:tt,FriendlyDeviceName:nt},function(ot,lt){return ot?it.onFailure(ot):it.onSuccess(lt)}):this.client.request("VerifySoftwareToken",{Session:this.Session,UserCode:tt,FriendlyDeviceName:nt},function(ot,lt){if(ot)return it.onFailure(ot);rt.Session=lt.Session;var st={};st.USERNAME=rt.username;var at={ChallengeName:"MFA_SETUP",ClientId:rt.pool.getClientId(),ChallengeResponses:st,Session:rt.Session};rt.getUserContextData()&&(at.UserContextData=rt.getUserContextData()),rt.client.request("RespondToAuthChallenge",at,function(ct,dt){return ct?it.onFailure(ct):(rt.signInUserSession=rt.getCognitoUserSession(dt.AuthenticationResult),rt.cacheTokens(),it.onSuccess(rt.signInUserSession))})})},et}();function unfetch_module(et,$){return $=$||{},new Promise(function(_,tt){var nt=new XMLHttpRequest,it=[],rt=[],ot={},lt=function(){return{ok:(nt.status/100|0)==2,statusText:nt.statusText,status:nt.status,url:nt.responseURL,text:function(){return Promise.resolve(nt.responseText)},json:function(){return Promise.resolve(nt.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([nt.response]))},clone:lt,headers:{keys:function(){return it},entries:function(){return rt},get:function(at){return ot[at.toLowerCase()]},has:function(at){return at.toLowerCase()in ot}}}};for(var st in nt.open($.method||"get",et,!0),nt.onload=function(){nt.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(at,ct,dt){it.push(ct=ct.toLowerCase()),rt.push([ct,dt]),ot[ct]=ot[ct]?ot[ct]+","+dt:dt}),_(lt())},nt.onerror=tt,nt.withCredentials=$.credentials=="include",$.headers)nt.setRequestHeader(st,$.headers[st]);nt.send($.body||null)})}const unfetch_module$1=Object.freeze(Object.defineProperty({__proto__:null,default:unfetch_module},Symbol.toStringTag,{value:"Module"})),require$$0$2=getAugmentedNamespace(unfetch_module$1);self.fetch||(self.fetch=require$$0$2.default||require$$0$2);function UserAgent(){}UserAgent.prototype.userAgent=getUserAgent();var getAmplifyUserAgent=function($){var _=UserAgent.category?" "+UserAgent.category:"",tt=UserAgent.framework?" framework/"+UserAgent.framework:"",nt=""+UserAgent.prototype.userAgent+_+tt;return nt};function _inheritsLoose(et,$){et.prototype=Object.create($.prototype),et.prototype.constructor=et,_setPrototypeOf(et,$)}function _wrapNativeSuper(et){var $=typeof Map=="function"?new Map:void 0;return _wrapNativeSuper=function(tt){if(tt===null||!_isNativeFunction(tt))return tt;if(typeof tt!="function")throw new TypeError("Super expression must either be null or a function");if($!==void 0){if($.has(tt))return $.get(tt);$.set(tt,nt)}function nt(){return _construct(tt,arguments,_getPrototypeOf(this).constructor)}return nt.prototype=Object.create(tt.prototype,{constructor:{value:nt,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(nt,tt)},_wrapNativeSuper(et)}function _construct(et,$,_){if(_isNativeReflectConstruct())return Reflect.construct.apply(null,arguments);var tt=[null];tt.push.apply(tt,$);var nt=new(et.bind.apply(et,tt));return _&&_setPrototypeOf(nt,_.prototype),nt}function _isNativeReflectConstruct(){try{var et=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_isNativeReflectConstruct=function(){return!!et})()}function _isNativeFunction(et){try{return Function.toString.call(et).indexOf("[native code]")!==-1}catch{return typeof et=="function"}}function _setPrototypeOf(et,$){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,tt){return _.__proto__=tt,_},_setPrototypeOf(et,$)}function _getPrototypeOf(et){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function($){return $.__proto__||Object.getPrototypeOf($)},_getPrototypeOf(et)}var CognitoError=function(et){function $(_,tt,nt,it){var rt;return rt=et.call(this,_)||this,rt.code=tt,rt.name=nt,rt.statusCode=it,rt}return _inheritsLoose($,et),$}(_wrapNativeSuper(Error)),Client$1=function(){function et(_,tt,nt){this.endpoint=tt||"https://cognito-idp."+_+".amazonaws.com/";var it=nt||{},rt=it.credentials;this.fetchOptions=rt?{credentials:rt}:{}}var $=et.prototype;return $.promisifyRequest=function(tt,nt){var it=this;return new Promise(function(rt,ot){it.request(tt,nt,function(lt,st){lt?ot(new CognitoError(lt.message,lt.code,lt.name,lt.statusCode)):rt(st)})})},$.requestWithRetry=function(tt,nt,it){var rt=this,ot=5*1e3;jitteredExponentialRetry(function(lt){return new Promise(function(st,at){rt.request(tt,lt,function(ct,dt){ct?at(ct):st(dt)})})},[nt],ot).then(function(lt){return it(null,lt)}).catch(function(lt){return it(lt)})},$.request=function(tt,nt,it){var rt={"Content-Type":"application/x-amz-json-1.1","X-Amz-Target":"AWSCognitoIdentityProviderService."+tt,"X-Amz-User-Agent":getAmplifyUserAgent(),"Cache-Control":"no-store"},ot=Object.assign({},this.fetchOptions,{headers:rt,method:"POST",mode:"cors",body:JSON.stringify(nt)}),lt;fetch(this.endpoint,ot).then(function(st){return lt=st,st},function(st){throw st instanceof TypeError?new Error("Network error"):st}).then(function(st){return st.json().catch(function(){return{}})}).then(function(st){if(lt.ok)return it(null,st);var at=(st.__type||st.code).split("#").pop(),ct=new Error(st.message||st.Message||null);return ct.name=at,ct.code=at,it(ct)}).catch(function(st){if(lt&&lt.headers&&lt.headers.get("x-amzn-errortype"))try{var at=lt.headers.get("x-amzn-errortype").split(":")[0],ct=new Error(lt.status?lt.status.toString():null);return ct.code=at,ct.name=at,ct.statusCode=lt.status,it(ct)}catch{return it(st)}else st instanceof Error&&st.message==="Network error"&&(st.code="NetworkError");return it(st)})},et}(),logger$1={debug:function(){}},isNonRetryableError=function($){var _="nonRetryable";return $&&$[_]};function retry(et,$,_,tt){if(tt===void 0&&(tt=1),typeof et!="function")throw Error("functionToRetry must be a function");return logger$1.debug(et.name+" attempt #"+tt+" with args: "+JSON.stringify($)),et.apply(void 0,$).catch(function(nt){if(logger$1.debug("error on "+et.name,nt),isNonRetryableError(nt))throw logger$1.debug(et.name+" non retryable error",nt),nt;var it=_(tt,$,nt);if(logger$1.debug(et.name+" retrying in "+it+" ms"),it!==!1)return new Promise(function(rt){return setTimeout(rt,it)}).then(function(){return retry(et,$,_,tt+1)});throw nt})}function jitteredBackoff(et){var $=100,_=100;return function(tt){var nt=Math.pow(2,tt)*$+_*Math.random();return nt>et?!1:nt}}var MAX_DELAY_MS=5*60*1e3;function jitteredExponentialRetry(et,$,_){return _===void 0&&(_=MAX_DELAY_MS),retry(et,$,jitteredBackoff(_))}/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */var USER_POOL_ID_MAX_LENGTH=55,CognitoUserPool=function(){function et(_,tt){var nt=_||{},it=nt.UserPoolId,rt=nt.ClientId,ot=nt.endpoint,lt=nt.fetchOptions,st=nt.AdvancedSecurityDataCollectionFlag;if(!it||!rt)throw new Error("Both UserPoolId and ClientId are required.");if(it.length>USER_POOL_ID_MAX_LENGTH||!/^[\w-]+_[0-9a-zA-Z]+$/.test(it))throw new Error("Invalid UserPoolId format.");var at=it.split("_")[0];this.userPoolId=it,this.clientId=rt,this.client=new Client$1(at,ot,lt),this.advancedSecurityDataCollectionFlag=st!==!1,this.storage=_.Storage||new StorageHelper().getStorage(),tt&&(this.wrapRefreshSessionCallback=tt)}var $=et.prototype;return $.getUserPoolId=function(){return this.userPoolId},$.getUserPoolName=function(){return this.getUserPoolId().split("_")[1]},$.getClientId=function(){return this.clientId},$.signUp=function(tt,nt,it,rt,ot,lt){var st=this,at={ClientId:this.clientId,Username:tt,Password:nt,UserAttributes:it,ValidationData:rt,ClientMetadata:lt};this.getUserContextData(tt)&&(at.UserContextData=this.getUserContextData(tt)),this.client.request("SignUp",at,function(ct,dt){if(ct)return ot(ct,null);var ut={Username:tt,Pool:st,Storage:st.storage},ft={user:new CognitoUser(ut),userConfirmed:dt.UserConfirmed,userSub:dt.UserSub,codeDeliveryDetails:dt.CodeDeliveryDetails};return ot(null,ft)})},$.getCurrentUser=function(){var tt="CognitoIdentityServiceProvider."+this.clientId+".LastAuthUser",nt=this.storage.getItem(tt);if(nt){var it={Username:nt,Pool:this,Storage:this.storage};return new CognitoUser(it)}return null},$.getUserContextData=function(tt){if(!(typeof AmazonCognitoAdvancedSecurityData>"u")){var nt=AmazonCognitoAdvancedSecurityData;if(this.advancedSecurityDataCollectionFlag){var it=nt.getData(tt,this.userPoolId,this.clientId);if(it){var rt={EncodedData:it};return rt}}return{}}},et}(),js_cookie={exports:{}};/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */(function(et,$){(function(_){var tt;if(et.exports=_(),tt=!0,!tt){var nt=window.Cookies,it=window.Cookies=_();it.noConflict=function(){return window.Cookies=nt,it}}})(function(){function _(){for(var it=0,rt={};it<arguments.length;it++){var ot=arguments[it];for(var lt in ot)rt[lt]=ot[lt]}return rt}function tt(it){return it.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function nt(it){function rt(){}function ot(st,at,ct){if(!(typeof document>"u")){ct=_({path:"/"},rt.defaults,ct),typeof ct.expires=="number"&&(ct.expires=new Date(new Date*1+ct.expires*864e5)),ct.expires=ct.expires?ct.expires.toUTCString():"";try{var dt=JSON.stringify(at);/^[\{\[]/.test(dt)&&(at=dt)}catch{}at=it.write?it.write(at,st):encodeURIComponent(String(at)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),st=encodeURIComponent(String(st)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var ut="";for(var ft in ct)ct[ft]&&(ut+="; "+ft,ct[ft]!==!0&&(ut+="="+ct[ft].split(";")[0]));return document.cookie=st+"="+at+ut}}function lt(st,at){if(!(typeof document>"u")){for(var ct={},dt=document.cookie?document.cookie.split("; "):[],ut=0;ut<dt.length;ut++){var ft=dt[ut].split("="),pt=ft.slice(1).join("=");!at&&pt.charAt(0)==='"'&&(pt=pt.slice(1,-1));try{var St=tt(ft[0]);if(pt=(it.read||it)(pt,St)||tt(pt),at)try{pt=JSON.parse(pt)}catch{}if(ct[St]=pt,st===St)break}catch{}}return st?ct[st]:ct}}return rt.set=ot,rt.get=function(st){return lt(st,!1)},rt.getJSON=function(st){return lt(st,!0)},rt.remove=function(st,at){ot(st,"",_(at,{expires:-1}))},rt.defaults={},rt.withConverter=nt,rt}return nt(function(){})})})(js_cookie);const cognitoConfig={UserPoolId:"ap-northeast-1_l84naqCK5",ClientId:"46hqd1fijl67skrf32264mmoji"},userPool=new CognitoUserPool({UserPoolId:cognitoConfig.UserPoolId,ClientId:cognitoConfig.ClientId}),signIn=(et,$)=>new Promise((_,tt)=>{const nt=new AuthenticationDetails({Username:et,Password:$}),it=new CognitoUser({Username:et,Pool:userPool});it.authenticateUser(nt,{onSuccess:rt=>{const ot=rt.getIdToken().getJwtToken();_({type:"success",token:ot})},onFailure:rt=>{tt(rt)},newPasswordRequired:(rt,ot)=>{delete rt.email_verified,delete rt.phone_number_verified,delete rt.email,delete rt.phone_number,_({type:"new_password_required",user:it,userAttributes:rt})}})}),completeNewPassword=(et,$,_)=>new Promise((tt,nt)=>{et.completeNewPasswordChallenge($,_,{onSuccess:it=>{tt({type:"success",token:it.getIdToken().getJwtToken()})},onFailure:it=>{nt(it)}})}),signOut=()=>{const et=userPool.getCurrentUser();et&&et.signOut()},getCurrentUserSession=()=>new Promise((et,$)=>{const _=userPool.getCurrentUser();if(!_){$("No current user");return}_.getSession((tt,nt)=>{if(tt){$(tt);return}et(nt)})}),API_BASE="/api";let authToken=null;function setAuthToken(et){authToken=et||null}function clearAuthToken(){authToken=null}function buildAuthHeaders(){const et={};return authToken&&(et.Authorization=`Bearer ${authToken}`),et}async function parseErrorDetail(et){let $="";try{if((et.headers.get("content-type")||"").includes("application/json")){const tt=await et.json();$=tt!=null&&tt.detail?` - ${tt.detail}`:""}else{const tt=await et.text();$=tt?` - ${tt}`:""}}catch{}return $}async function callApi(et,$){const _={"Content-Type":"application/json",...buildAuthHeaders()};_.Authorization||console.warn(`[callApi] Warning: No authToken available for request to ${et}`);const tt=await fetch(`${API_BASE}${et}`,{method:"POST",headers:_,body:JSON.stringify($)});if(!tt.ok){const nt=await parseErrorDetail(tt);throw tt.status===401?new Error(`Unauthorized: Please sign in again.${nt}`):new Error(`API Error: ${tt.status}${nt}`)}return tt.json()}async function callApiGet(et){const $={...buildAuthHeaders()};$.Authorization||console.warn(`[callApiGet] Warning: No authToken available for request to ${et}`);const _=await fetch(`${API_BASE}${et}`,{method:"GET",headers:$});if(!_.ok){const tt=await parseErrorDetail(_);throw _.status===401?new Error(`Unauthorized: Please sign in again.${tt}`):new Error(`API Error: ${_.status}${tt}`)}return _.json()}async function callApiDelete(et){const $={...buildAuthHeaders()},_=await fetch(`${API_BASE}${et}`,{method:"DELETE",headers:$});if(!_.ok){const tt=await parseErrorDetail(_);throw _.status===401?new Error(`Unauthorized: Please sign in again.${tt}`):new Error(`API Error: ${_.status}${tt}`)}return _.json().catch(()=>({}))}async function fetchMe(){return callApiGet("/me")}async function createMeeting(et){return callApi("/meetings",{external_meeting_id:et})}async function createAttendee(et,$){return callApi(`/meetings/${et}/attendees`,{external_user_id:$})}async function createScheduledMeeting(et){return callApi("/scheduled-meetings",et)}async function listScheduledMeetings(){return callApiGet("/scheduled-meetings")}async function deleteScheduledMeeting(et){return callApiDelete(`/scheduled-meetings/${et}`)}async function getScheduledMeetingRecording(et){return callApiGet(`/scheduled-meetings/${et}/recording`)}async function startScheduledMeetingRecording(et){return callApi(`/scheduled-meetings/${et}/recording/start`,{})}async function stopScheduledMeetingRecording(et){return callApi(`/scheduled-meetings/${et}/recording/stop`,{})}async function fetchProfile(){return callApiGet("/profile")}async function upsertProfile(et){return callApi("/profile",et)}async function listUsers(){return callApiGet("/users")}async function inviteUser(et){return callApi("/users",et)}async function deleteUser(et){const $=encodeURIComponent(String(et||"").trim());return callApiDelete(`/users/${$}`)}function ProctorDashboardHome({onGoMeeting:et,onGoProfile:$,onGoUsers:_,selectedJoinCode:tt,onSelectJoinCode:nt}){const[it,rt]=reactExports.useState([]),[ot,lt]=reactExports.useState(!1),[st,at]=reactExports.useState(""),ct=async()=>{lt(!0),at("");try{const ut=await listScheduledMeetings();rt(Array.isArray(ut)?ut:[])}catch(ut){at((ut==null?void 0:ut.message)||"")}finally{lt(!1)}};reactExports.useEffect(()=>{ct()},[]);const dt=ut=>{if(!ut)return"";try{return new Date(ut).toLocaleString()}catch{return String(ut)}};return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:""}),jsxRuntimeExports.jsx("p",{className:"mt-1 text-sm text-slate-600",children:""}),jsxRuntimeExports.jsxs("div",{className:"mt-6 flex flex-wrap gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>et("schedule"),className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:""}),jsxRuntimeExports.jsx("button",{onClick:_,className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:""}),jsxRuntimeExports.jsx("button",{onClick:$,className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:""})]})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-semibold text-slate-800",children:""}),jsxRuntimeExports.jsx("button",{onClick:ct,disabled:ot,className:"ml-auto rounded-md border border-slate-300 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed",children:ot?"...":""})]}),st&&jsxRuntimeExports.jsx("p",{className:"mt-3 text-sm text-red-600",children:st}),it.length===0?jsxRuntimeExports.jsx("p",{className:"mt-3 text-sm text-slate-600",children:""}):jsxRuntimeExports.jsxs("div",{className:"mt-3 space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"hidden sm:grid sm:grid-cols-[minmax(0,1fr)_180px_200px_110px_1fr_96px] sm:items-center sm:gap-2 px-3 text-center text-xs font-semibold text-slate-600",children:[jsxRuntimeExports.jsx("div",{children:""}),jsxRuntimeExports.jsx("div",{children:""}),jsxRuntimeExports.jsx("div",{children:""}),jsxRuntimeExports.jsx("div",{children:""}),jsxRuntimeExports.jsx("div",{children:"ID"}),jsxRuntimeExports.jsx("div",{})]}),it.map(ut=>{const ft=ut.title||"",pt=ut.teacher_name||"",St=dt(ut.scheduled_start_at),gt=ut.status||"",yt=ut.join_code||"";return jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-lg border border-slate-200 bg-slate-50 p-3",children:[jsxRuntimeExports.jsxs("div",{className:"w-full sm:hidden",children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-semibold text-slate-900",children:ft}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:[": ",jsxRuntimeExports.jsx("span",{className:"text-slate-800",children:pt})]}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:[": ",jsxRuntimeExports.jsx("span",{className:"text-slate-800",children:St})]}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:[": ",jsxRuntimeExports.jsx("span",{className:"text-slate-800",children:gt})]}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:["ID: ",jsxRuntimeExports.jsx("span",{className:"text-slate-800",children:yt})]})]}),jsxRuntimeExports.jsxs("div",{className:"hidden w-full sm:grid sm:grid-cols-[minmax(0,1fr)_180px_200px_110px_1fr_96px] sm:items-center sm:gap-2 text-center",children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-900 truncate",children:ft}),jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-800 truncate",children:pt}),jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-800",children:St}),jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-800",children:gt}),jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-800",children:yt}),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-end",children:jsxRuntimeExports.jsx("button",{onClick:()=>{nt(String(ut.join_code||"")),et("meeting")},className:"rounded-md bg-indigo-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-indigo-500",children:""})})]}),jsxRuntimeExports.jsx("div",{className:"sm:hidden ml-auto flex items-center gap-2",children:jsxRuntimeExports.jsx("button",{onClick:()=>{nt(String(ut.join_code||"")),et("meeting")},className:"rounded-md bg-indigo-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-indigo-500",children:""})})]},ut.join_code)})]})]})]})}function ExamineeDashboardHome({onGoMeeting:et,onGoProfile:$}){return jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:""}),jsxRuntimeExports.jsx("p",{className:"mt-1 text-sm text-slate-600",children:""}),jsxRuntimeExports.jsxs("div",{className:"mt-6 flex flex-wrap gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:et,className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500",children:""}),jsxRuntimeExports.jsx("button",{onClick:$,className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:""})]})]})}function ProfileRegistrationPage({role:et,profile:$,onRegistered:_}){const[tt,nt]=reactExports.useState(($==null?void 0:$.display_name)||""),[it,rt]=reactExports.useState(($==null?void 0:$.class_name)||""),[ot,lt]=reactExports.useState(!1),[st,at]=reactExports.useState(""),[ct,dt]=reactExports.useState("");reactExports.useEffect(()=>{nt(($==null?void 0:$.display_name)||""),rt(($==null?void 0:$.class_name)||""),dt("")},[$==null?void 0:$.display_name,$==null?void 0:$.class_name]);const ut=async ft=>{ft.preventDefault(),at(""),dt("");const pt=String(tt||"").trim(),St=String(it||"").trim();if(!pt){at("");return}if(et==="examinee"&&!St){at("");return}try{lt(!0);const gt=await upsertProfile({display_name:pt,class_name:et==="examinee"?St:null});dt(""),_(gt)}catch(gt){at(gt.message||"")}finally{lt(!1)}};return jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:et==="proctor"?"":""}),jsxRuntimeExports.jsx("p",{className:"mt-1 text-sm text-slate-600",children:""}),jsxRuntimeExports.jsxs("form",{onSubmit:ut,className:"mt-6 space-y-4 max-w-xl",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-800",children:""}),jsxRuntimeExports.jsx("input",{value:tt,onChange:ft=>nt(ft.target.value),className:"mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),et==="examinee"&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-800",children:""}),jsxRuntimeExports.jsx("input",{value:it,onChange:ft=>rt(ft.target.value),className:"mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),st&&jsxRuntimeExports.jsx("p",{className:"text-sm text-red-400",children:st}),ct&&jsxRuntimeExports.jsx("p",{className:"text-sm text-emerald-400",children:ct}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:ot,className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:ot?"...":""})]})]})}function ProfileEditPage({role:et,onDone:$}){const[_,tt]=reactExports.useState(null),[nt,it]=reactExports.useState(!0),[rt,ot]=reactExports.useState("");return reactExports.useEffect(()=>{let lt=!1;return it(!0),ot(""),fetchProfile().then(st=>{lt||tt(st)}).catch(st=>{console.error(st),lt||ot(st.message||"")}).finally(()=>{lt||it(!1)}),()=>{lt=!0}},[et]),nt?jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:""}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-sm text-slate-600",children:"Loading..."})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:""}),rt&&jsxRuntimeExports.jsx("p",{className:"mt-2 text-sm text-red-400",children:rt})]}),jsxRuntimeExports.jsx(ProfileRegistrationPage,{role:et,profile:_,onRegistered:lt=>tt(lt)}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("button",{onClick:$,className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:""})})]})}function ProctorSchedulePage({selectedJoinCode:et,onSelectJoinCode:$,onGoMeeting:_,onDone:tt,currentUsername:nt}){const[it,rt]=reactExports.useState([]),[ot,lt]=reactExports.useState(null),[st,at]=reactExports.useState(""),[ct,dt]=reactExports.useState(""),[ut,ft]=reactExports.useState(!1),[pt,St]=reactExports.useState(""),[gt,yt]=reactExports.useState(!1),[vt,Ct]=reactExports.useState(!1),[Et,Mt]=reactExports.useState(""),Rt=It=>{if(!It)return"";try{return new Date(It).toLocaleString()}catch{return String(It)}},At=async()=>{yt(!0),Mt("");try{const It=await listScheduledMeetings();rt(Array.isArray(It)?It:[])}catch(It){Mt((It==null?void 0:It.message)||"")}finally{yt(!1)}};reactExports.useEffect(()=>{At()},[]),reactExports.useEffect(()=>{let It=!1;return fetchProfile().then(Vt=>{It||lt(Vt)}).catch(()=>{}),()=>{It=!0}},[]),reactExports.useEffect(()=>{if(ut)return;const It=String(nt||"").trim(),Vt=String((ot==null?void 0:ot.display_name)||"").trim();if(Vt){ct!==Vt&&dt(Vt);return}!ct&&It&&dt(It)},[nt,ot,ut,ct]);const Dt=async()=>{Ct(!0),Mt("");try{const It={title:String(st||"").trim()||null,teacher_name:String(ct||"").trim()||null,scheduled_start_at:pt?new Date(pt).toISOString():null},Vt=await createScheduledMeeting(It);Vt!=null&&Vt.join_code&&$(Vt.join_code),await At()}catch(It){Mt((It==null?void 0:It.message)||"")}finally{Ct(!1)}};return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:""}),jsxRuntimeExports.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:jsxRuntimeExports.jsx("button",{onClick:tt,className:"rounded-md border border-slate-300 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:" "})})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-semibold text-slate-800",children:""}),jsxRuntimeExports.jsxs("div",{className:"mt-3 flex flex-wrap items-end gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"w-full sm:w-auto sm:min-w-[240px]",children:[jsxRuntimeExports.jsx("label",{htmlFor:"schedule-title",className:"block text-xs font-medium text-slate-600",children:""}),jsxRuntimeExports.jsx("input",{id:"schedule-title",value:st,onChange:It=>at(It.target.value),className:"mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),jsxRuntimeExports.jsxs("div",{className:"w-full sm:w-auto sm:min-w-[240px]",children:[jsxRuntimeExports.jsx("label",{htmlFor:"schedule-teacher",className:"block text-xs font-medium text-slate-600",children:""}),jsxRuntimeExports.jsx("input",{id:"schedule-teacher",value:ct,onChange:It=>{ft(!0),dt(It.target.value)},className:"mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),jsxRuntimeExports.jsxs("div",{className:"w-full sm:w-auto",children:[jsxRuntimeExports.jsx("label",{htmlFor:"schedule-start-at",className:"block text-xs font-medium text-slate-600",children:""}),jsxRuntimeExports.jsx("input",{id:"schedule-start-at",type:"datetime-local",value:pt,onChange:It=>St(It.target.value),className:"mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),jsxRuntimeExports.jsx("button",{onClick:Dt,disabled:vt,className:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:vt?"...":""}),jsxRuntimeExports.jsx("button",{onClick:At,disabled:gt,className:"rounded-md border border-slate-300 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed",children:gt?"...":""})]}),Et&&jsxRuntimeExports.jsx("p",{className:"mt-3 text-sm text-red-600",children:Et}),it.length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-6",children:[jsxRuntimeExports.jsx("div",{className:"text-xs font-medium text-slate-600",children:""}),jsxRuntimeExports.jsxs("div",{className:"mt-2 space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"hidden sm:grid sm:grid-cols-[minmax(0,1fr)_180px_200px_110px_1fr_96px_96px] sm:items-center sm:gap-2 px-3 text-center text-xs font-semibold text-slate-600",children:[jsxRuntimeExports.jsx("div",{children:""}),jsxRuntimeExports.jsx("div",{children:""}),jsxRuntimeExports.jsx("div",{children:""}),jsxRuntimeExports.jsx("div",{children:""}),jsxRuntimeExports.jsx("div",{children:"ID"}),jsxRuntimeExports.jsx("div",{}),jsxRuntimeExports.jsx("div",{})]}),it.map(It=>{const Vt=It.title||"",jt=It.teacher_name||"",qt=Rt(It.scheduled_start_at),cn=It.status||"",dn=It.join_code||"";return jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-lg border border-slate-200 bg-slate-50 p-3",children:[jsxRuntimeExports.jsxs("div",{className:"w-full sm:hidden",children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-semibold text-slate-900",children:Vt}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:[": ",jsxRuntimeExports.jsx("span",{className:"text-slate-800",children:jt})]}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:[": ",jsxRuntimeExports.jsx("span",{className:"text-slate-800",children:qt})]}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:[": ",jsxRuntimeExports.jsx("span",{className:"text-slate-800",children:cn})]}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:["ID: ",jsxRuntimeExports.jsx("span",{className:"text-slate-800",children:dn})]})]}),jsxRuntimeExports.jsxs("div",{className:"hidden w-full sm:grid sm:grid-cols-[minmax(0,1fr)_180px_200px_110px_1fr_96px_96px] sm:items-center sm:gap-2 text-center",children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-900 truncate",children:Vt}),jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-800 truncate",children:jt}),jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-800",children:qt}),jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-800",children:cn}),jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-800",children:dn}),jsxRuntimeExports.jsx("div",{className:"flex justify-end translate-x-10",children:jsxRuntimeExports.jsx("button",{onClick:()=>{$(It.join_code),_()},className:"rounded-md bg-indigo-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-indigo-500",children:""})}),jsxRuntimeExports.jsx("div",{className:"flex justify-start translate-x-10",children:jsxRuntimeExports.jsx("button",{onClick:async()=>{try{if(!window.confirm(`
${It.join_code}`))return;await deleteScheduledMeeting(It.join_code),et===It.join_code&&$(""),await At()}catch(an){Mt((an==null?void 0:an.message)||"")}},className:"rounded-md border border-slate-300 px-3 py-1.5 text-xs font-semibold text-slate-900 hover:bg-slate-100",children:""})})]}),jsxRuntimeExports.jsxs("div",{className:"sm:hidden ml-auto flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{$(It.join_code),_()},className:"rounded-md bg-indigo-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-indigo-500",children:""}),jsxRuntimeExports.jsx("button",{onClick:async()=>{try{if(!window.confirm(`
${It.join_code}`))return;await deleteScheduledMeeting(It.join_code),et===It.join_code&&$(""),await At()}catch(an){Mt((an==null?void 0:an.message)||"")}},className:"rounded-md border border-slate-300 px-3 py-1.5 text-xs font-semibold text-slate-900 hover:bg-slate-100",children:""})]})]},It.join_code)})]})]})]})]})}function ProctorUsersPage({onDone:et}){const[$,_]=reactExports.useState([]),[tt,nt]=reactExports.useState(!1),[it,rt]=reactExports.useState(""),[ot,lt]=reactExports.useState(!1),[st,at]=reactExports.useState(""),[ct,dt]=reactExports.useState("examinee"),[ut,ft]=reactExports.useState(!1),[pt,St]=reactExports.useState(""),gt=async()=>{nt(!0),rt("");try{const Mt=await listUsers();_(Array.isArray(Mt)?Mt:[])}catch(Mt){rt((Mt==null?void 0:Mt.message)||"")}finally{nt(!1)}};reactExports.useEffect(()=>{gt()},[]);const yt=()=>{at(""),dt("examinee"),St(""),lt(!0)},vt=()=>{ut||(lt(!1),St(""))},Ct=async()=>{ft(!0),St("");try{const Mt=String(st||"").trim();if(!Mt){St("");return}await inviteUser({email:Mt,role:ct}),lt(!1),await gt()}catch(Mt){St((Mt==null?void 0:Mt.message)||"")}finally{ft(!1)}},Et=async Mt=>{const Rt=String(Mt||"").trim();if(!(!Rt||!window.confirm(`
${Rt}`))){rt("");try{await deleteUser(Rt),await gt()}catch(Dt){rt((Dt==null?void 0:Dt.message)||"")}}};return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:""}),jsxRuntimeExports.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:et,className:"rounded-md border border-slate-300 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:" "}),jsxRuntimeExports.jsx("button",{onClick:yt,className:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-500",children:""}),jsxRuntimeExports.jsx("button",{onClick:gt,disabled:tt,className:"ml-auto rounded-md border border-slate-300 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed",children:tt?"...":""})]}),it&&jsxRuntimeExports.jsx("p",{className:"mt-3 text-sm text-red-600",children:it}),$.length===0?jsxRuntimeExports.jsx("p",{className:"mt-4 text-sm text-slate-600",children:""}):jsxRuntimeExports.jsxs("div",{className:"mt-4",children:[jsxRuntimeExports.jsx("div",{className:"text-xs font-medium text-slate-600",children:""}),jsxRuntimeExports.jsxs("div",{className:"mt-2 space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"hidden sm:grid sm:grid-cols-[220px_220px_140px_1fr_96px] sm:items-center sm:gap-2 px-3 text-center text-xs font-semibold text-slate-600",children:[jsxRuntimeExports.jsx("div",{children:"ID"}),jsxRuntimeExports.jsx("div",{children:""}),jsxRuntimeExports.jsx("div",{children:""}),jsxRuntimeExports.jsx("div",{children:""}),jsxRuntimeExports.jsx("div",{})]}),$.map(Mt=>{const Rt=Mt.username||"",At=Mt.display_name||"",Dt=Mt.role||"",It=Mt.class_name||"";return jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-lg border border-slate-200 bg-slate-50 p-3",children:[jsxRuntimeExports.jsxs("div",{className:"w-full sm:hidden",children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-semibold text-slate-900",children:Rt}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:[": ",jsxRuntimeExports.jsx("span",{className:"text-slate-800",children:At})]}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:[": ",jsxRuntimeExports.jsx("span",{className:"text-slate-800",children:Dt})]}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-xs text-slate-600",children:[": ",jsxRuntimeExports.jsx("span",{className:"text-slate-800",children:It})]}),jsxRuntimeExports.jsx("div",{className:"mt-3 flex justify-end",children:jsxRuntimeExports.jsx("button",{onClick:()=>Et(Rt),className:"rounded-md border border-slate-300 px-3 py-1.5 text-xs font-semibold text-slate-900 hover:bg-slate-100",children:""})})]}),jsxRuntimeExports.jsxs("div",{className:"hidden w-full sm:grid sm:grid-cols-[220px_220px_140px_1fr_96px] sm:items-center sm:gap-2 text-center",children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-800 truncate",children:Rt}),jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-800 truncate",children:At}),jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-800",children:Dt}),jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-800 truncate",children:It}),jsxRuntimeExports.jsx("div",{className:"flex justify-end",children:jsxRuntimeExports.jsx("button",{onClick:()=>Et(Rt),className:"rounded-md border border-slate-300 px-3 py-1.5 text-xs font-semibold text-slate-900 hover:bg-slate-100",children:""})})]})]},Mt.id||Rt)})]})]})]}),ot&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 px-4",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-lg rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:""}),jsxRuntimeExports.jsx("p",{className:"mt-1 text-sm text-slate-600",children:""})]}),jsxRuntimeExports.jsx("button",{onClick:vt,className:"ml-auto rounded-md border border-slate-300 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100 disabled:opacity-50",disabled:ut,children:""})]}),jsxRuntimeExports.jsxs("div",{className:"mt-5 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-800",children:""}),jsxRuntimeExports.jsx("input",{value:st,onChange:Mt=>at(Mt.target.value),className:"mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"example@example.com"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-800",children:""}),jsxRuntimeExports.jsxs("select",{value:ct,onChange:Mt=>dt(Mt.target.value),className:"mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[jsxRuntimeExports.jsx("option",{value:"examinee",children:"examinee"}),jsxRuntimeExports.jsx("option",{value:"proctor",children:"proctor"})]})]}),pt&&jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:pt}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-end gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:vt,disabled:ut,className:"rounded-md border border-slate-300 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed",children:""}),jsxRuntimeExports.jsx("button",{onClick:Ct,disabled:ut,className:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:ut?"...":""})]})]})]})})]})}var build$2={},AllHighestVideoBandwidthPolicy$1={},DefaultVideoStreamIdSet$1={};Object.defineProperty(DefaultVideoStreamIdSet$1,"__esModule",{value:!0});class DefaultVideoStreamIdSet{constructor($){this.ids=new Set($)}add($){this.ids.add($)}array(){return Array.from(this.ids.values()).sort((_,tt)=>_-tt)}contain($){return this.ids.has($)}forEach($){this.ids.forEach($)}empty(){return this.ids.size===0}size(){return this.ids.size}equal($){if(!$)return this.ids.size===0;const _=this.array(),tt=$.array();if(_.length!==tt.length)return!1;for(let nt=0;nt<_.length;nt++)if(_[nt]!==tt[nt])return!1;return!0}clone(){return new DefaultVideoStreamIdSet(this.array())}remove($){this.ids.delete($)}toJSON(){return this.array()}truncate($){const _=this.array();return new DefaultVideoStreamIdSet(_.splice(0,$))}}DefaultVideoStreamIdSet$1.default=DefaultVideoStreamIdSet;var __importDefault$1N=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(AllHighestVideoBandwidthPolicy$1,"__esModule",{value:!0});const DefaultVideoStreamIdSet_1$3=__importDefault$1N(DefaultVideoStreamIdSet$1);class AllHighestVideoBandwidthPolicy{constructor($){this.selfAttendeeId=$,this.reset()}reset(){this.optimalReceiveSet=new DefaultVideoStreamIdSet_1$3.default,this.subscribedReceiveSet=new DefaultVideoStreamIdSet_1$3.default,this.videoSources=void 0}updateIndex($){this.videoIndex=$,this.optimalReceiveSet=this.calculateOptimalReceiveSet($)}updateMetrics($){}wantsResubscribe(){return!this.subscribedReceiveSet.equal(this.optimalReceiveSet)}chooseSubscriptions(){return this.subscribedReceiveSet=this.optimalReceiveSet.clone(),this.subscribedReceiveSet.clone()}chooseRemoteVideoSources($){this.videoSources=$,this.optimalReceiveSet=this.calculateOptimalReceiveSet(this.videoIndex).clone()}calculateOptimalReceiveSet($){const _=new DefaultVideoStreamIdSet_1$3.default;if(!this.videoIndex||this.videoIndex.allStreams().empty())return _;const tt=$.highestQualityStreamFromEachGroupExcludingSelf(this.selfAttendeeId),nt=this.videoSources?this.videoSources:this.videoIndex.allVideoSendingSourcesExcludingSelf(this.selfAttendeeId),it=this.videoIndex.remoteStreamDescriptions(),rt=new Map;for(const lt of it)tt.contain(lt.streamId)&&rt.set(lt.attendeeId,lt);let ot=0;for(const lt of nt){const st=lt.attendee.attendeeId;if(rt.has(st)){const at=rt.get(st);if(ot+at.maxBitrateKbps<=AllHighestVideoBandwidthPolicy.maxReceiveBitrateKbps)_.add(at.streamId),ot+=at.maxBitrateKbps;else{console.warn("total bitrate "+(ot+at.maxBitrateKbps)+" exceeds maximum limit (15000). Use chooseRemoteVideoSources to select a subset of participants to avoid this.");break}}}return _}}AllHighestVideoBandwidthPolicy$1.default=AllHighestVideoBandwidthPolicy;AllHighestVideoBandwidthPolicy.maxReceiveBitrateKbps=15e3;var ApplicationMetadata$1={};Object.defineProperty(ApplicationMetadata$1,"__esModule",{value:!0});class ApplicationMetadata{constructor($,_){this.appName=$,this.appVersion=_}static create($,_){const tt=/^[a-zA-Z0-9]+[a-zA-Z0-9_-]*[a-zA-Z0-9]+$/g;if(!$||$.length>32)throw new Error("appName should be a valid string and 1 to 32 characters in length");if(!tt.test($))throw new Error(`appName must satisfy ${tt} regular expression`);const nt=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/gm;if(!_||_.length>32)throw new Error("appVersion should be a valid string and 1 to 32 characters in length");if(!nt.test(_))throw new Error("appVersion must satisfy Semantic Versioning format");return new ApplicationMetadata($,_)}}ApplicationMetadata$1.default=ApplicationMetadata;var AsyncScheduler$1={},TimeoutScheduler$1={};Object.defineProperty(TimeoutScheduler$1,"__esModule",{value:!0});class TimeoutScheduler{constructor($){this.timeoutMs=$,this.timer=null}start($){this.stop(),this.timer=setTimeout(()=>{clearTimeout(this.timer),$()},this.timeoutMs)}stop(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}}TimeoutScheduler$1.default=TimeoutScheduler;var __importDefault$1M=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(AsyncScheduler$1,"__esModule",{value:!0});const TimeoutScheduler_1$3=__importDefault$1M(TimeoutScheduler$1);class AsyncScheduler extends TimeoutScheduler_1$3.default{constructor(){super(0)}static nextTick($){setTimeout($,0)}}AsyncScheduler$1.default=AsyncScheduler;var AttachMediaInputTask$1={},VideoLogEvent={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.VideoLogEvent=void 0;var $;(function(_){_[_.InputAttached=0]="InputAttached",_[_.SendingFailed=1]="SendingFailed",_[_.SendingSuccess=2]="SendingSuccess"})($=et.VideoLogEvent||(et.VideoLogEvent={})),et.default=$})(VideoLogEvent);var BaseTask$1={},OnceTask$1={},LogLevel={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.LogLevel=void 0;var $;(function(_){_[_.DEBUG=0]="DEBUG",_[_.INFO=1]="INFO",_[_.WARN=2]="WARN",_[_.ERROR=3]="ERROR",_[_.OFF=4]="OFF"})($=et.LogLevel||(et.LogLevel={})),et.default=$})(LogLevel);var __importDefault$1L=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(OnceTask$1,"__esModule",{value:!0});const LogLevel_1$8=__importDefault$1L(LogLevel),AsyncScheduler_1$8=__importDefault$1L(AsyncScheduler$1);class OnceTask{constructor($,_,tt){this.logger=$,this.task=_,this.dependencies=tt,this.canceled=!1}name(){return`${this.task.name()} (once)`}cancel(){if(!this.canceled){if(this.dependencies)for(const $ of this.dependencies)$.cancel();this.logger.info(`Canceling ${this.name()}`),AsyncScheduler_1$8.default.nextTick(()=>this.task.cancel()),this.canceled=!0,this.cancelPromise&&AsyncScheduler_1$8.default.nextTick(()=>this.cancelPromise(new Error(`canceling ${this.name()}`)))}}logDependencies(){if(this.logger.getLogLevel()>LogLevel_1$8.default.INFO||!this.dependencies)return;const $=this.dependencies.filter(_=>_).map(_=>_.name()).join(", ");this.logger.info(`${this.task.name()} waiting for dependencies: ${$}`)}run(){if(this.promise)return this.promise;const $=this.dependencies?Promise.all(this.dependencies.map(_=>_==null?void 0:_.run())):Promise.resolve();return this.logDependencies(),this.ongoing=$.then(()=>this.task.run()),this.promise=new Promise((_,tt)=>{this.cancelPromise=tt,this.ongoing.then(_).catch(tt)})}setParent($){this.task.setParent($)}}OnceTask$1.default=OnceTask;var TaskStatus$1={};Object.defineProperty(TaskStatus$1,"__esModule",{value:!0});var TaskStatus;(function(et){et.IDLE="IDLE",et.RUNNING="RUNNING",et.CANCELED="CANCELED",et.FINISHED="FINISHED"})(TaskStatus||(TaskStatus={}));TaskStatus$1.default=TaskStatus;var __awaiter$15=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1K=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(BaseTask$1,"__esModule",{value:!0});const OnceTask_1=__importDefault$1K(OnceTask$1),TaskStatus_1$1=__importDefault$1K(TaskStatus$1);class BaseTask{constructor($){this.logger=$,this.taskName="BaseTask",this.parentTask=null,this.status=TaskStatus_1$1.default.IDLE,this.run=this.baseRun.bind(this,this.run),this.cancel=this.baseCancel.bind(this,this.cancel)}once(...$){return new OnceTask_1.default(this.logger,this,$)}cancel(){}name(){return this.parentTask?`${this.parentTask.name()}/${this.taskName}`:this.taskName}setParent($){this.parentTask=$}getStatus(){return this.status}logAndThrow($){throw this.logger.info($),new Error($)}baseRun($){return __awaiter$15(this,void 0,void 0,function*(){try{const _=Date.now();switch(this.logger.info(`running task ${this.name()}`),this.status){case TaskStatus_1$1.default.RUNNING:this.logAndThrow(`${this.name()} is already running`);case TaskStatus_1$1.default.CANCELED:this.logAndThrow(`${this.name()} was canceled before running`);case TaskStatus_1$1.default.FINISHED:this.logAndThrow(`${this.name()} was already finished`)}this.status=TaskStatus_1$1.default.RUNNING,yield $.call(this),this.logger.info(`${this.name()} took ${Math.round(Date.now()-_)} ms`)}catch(_){throw _}finally{this.status!==TaskStatus_1$1.default.CANCELED&&(this.status=TaskStatus_1$1.default.FINISHED)}})}baseCancel($){if(this.status===TaskStatus_1$1.default.CANCELED||this.status===TaskStatus_1$1.default.FINISHED){this.logger.info(`Not canceling ${this.name()}: state is ${this.status}`);return}this.logger.info(`canceling task ${this.name()}`),this.status=TaskStatus_1$1.default.CANCELED,$.call(this)}}BaseTask$1.default=BaseTask;var __awaiter$14=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1J=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(AttachMediaInputTask$1,"__esModule",{value:!0});const VideoLogEvent_1$1=__importDefault$1J(VideoLogEvent),BaseTask_1$o=__importDefault$1J(BaseTask$1);class AttachMediaInputTask extends BaseTask_1$o.default{constructor($){super($.logger),this.context=$,this.taskName="AttachMediaInputTask"}run(){return __awaiter$14(this,void 0,void 0,function*(){const $=this.context.transceiverController;$.setPeer(this.context.peer),$.setupLocalTransceivers();const _=this.context.activeAudioInput;if(_){const nt=_.getAudioTracks();this.context.logger.info("attaching audio track to peer connection"),yield $.setAudioInput(nt.length?nt[0]:null)}else yield $.setAudioInput(null),this.context.logger.info("no audio track");this.setAudioCodecPreferences();const tt=this.context.activeVideoInput;if(tt){const nt=tt.getVideoTracks(),it=nt.length?nt[0]:null;if(this.context.logger.info("attaching video track to peer connection"),yield $.setVideoInput(it),this.context.enableSimulcast&&this.context.videoUplinkBandwidthPolicy){const rt=this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters();$.setEncodingParameters(rt)}it&&this.context.statsCollector.logVideoEvent(VideoLogEvent_1$1.default.InputAttached,this.context.videoDeviceInformation)}else yield $.setVideoInput(null),this.context.logger.info("no video track");this.context.videoSubscriptions=$.updateVideoTransceivers(this.context.videoStreamIndex,this.context.videosToReceive),this.context.videoStreamIndex.subscribeFrameSent()})}setAudioCodecPreferences(){const $=window.RTCRtpTransceiver&&"setCodecPreferences"in window.RTCRtpTransceiver.prototype,_=this.context.audioProfile.hasRedundancyEnabled();if(!$){this.context.logger.warn("Setting codec preferences not supported");return}const tt=this.context.transceiverController.localAudioTransceiver(),{codecs:nt}=RTCRtpSender.getCapabilities("audio");this.context.logger.debug(`Available audio codecs ${JSON.stringify(nt,null,4)}`);const it=nt.findIndex(rt=>rt.mimeType==="audio/red");if(!tt){this.context.logger.error("audio transceiver is null");return}if(it>=0){const rt=nt[it];nt.splice(it,1),_?(nt.unshift(rt),this.context.logger.info("audio/red set as preferred codec")):this.context.logger.info("audio/red removed from preferred codec"),tt.setCodecPreferences(nt);return}this.context.logger.info("audio/red codec not supported")}}AttachMediaInputTask$1.default=AttachMediaInputTask;var Attendee$1={};Object.defineProperty(Attendee$1,"__esModule",{value:!0});class Attendee{}Attendee$1.default=Attendee;var AudioLogEvent={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.AudioLogEvent=void 0;var $;(function(_){_[_.DeviceChanged=0]="DeviceChanged",_[_.MutedLocal=1]="MutedLocal",_[_.UnmutedLocal=2]="UnmutedLocal",_[_.Connected=3]="Connected",_[_.ConnectFailed=4]="ConnectFailed",_[_.RedmicStartLoss=5]="RedmicStartLoss",_[_.RedmicEndLoss=6]="RedmicEndLoss"})($=et.AudioLogEvent||(et.AudioLogEvent={})),et.default=$})(AudioLogEvent);var AudioProfile$1={},DefaultBrowserBehavior$1={},__spreadArray=globalThis&&globalThis.__spreadArray||function(et,$,_){if(_||arguments.length===2)for(var tt=0,nt=$.length,it;tt<nt;tt++)(it||!(tt in $))&&(it||(it=Array.prototype.slice.call($,0,tt)),it[tt]=$[tt]);return et.concat(it||Array.prototype.slice.call($))},BrowserInfo=function(){function et($,_,tt){this.name=$,this.version=_,this.os=tt,this.type="browser"}return et}(),NodeInfo=function(){function et($){this.version=$,this.type="node",this.name="node",this.os=process.platform}return et}(),SearchBotDeviceInfo=function(){function et($,_,tt,nt){this.name=$,this.version=_,this.os=tt,this.bot=nt,this.type="bot-device"}return et}(),BotInfo=function(){function et(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return et}(),ReactNativeInfo=function(){function et(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return et}(),SEARCHBOX_UA_REGEX=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",SEARCHBOX_UA_REGEX]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(et){return et?parseUserAgent(et):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ReactNativeInfo:typeof navigator<"u"?parseUserAgent(navigator.userAgent):getNodeVersion()}function matchUserAgent(et){return et!==""&&userAgentRules.reduce(function($,_){var tt=_[0],nt=_[1];if($)return $;var it=nt.exec(et);return!!it&&[tt,it]},!1)}function browserName(et){var $=matchUserAgent(et);return $?$[0]:null}function parseUserAgent(et){var $=matchUserAgent(et);if(!$)return null;var _=$[0],tt=$[1];if(_==="searchbot")return new BotInfo;var nt=tt[1]&&tt[1].split(".").join("_").split("_").slice(0,3);nt?nt.length<REQUIRED_VERSION_PARTS&&(nt=__spreadArray(__spreadArray([],nt,!0),createVersionParts(REQUIRED_VERSION_PARTS-nt.length),!0)):nt=[];var it=nt.join("."),rt=detectOS(et),ot=SEARCHBOT_OS_REGEX.exec(et);return ot&&ot[1]?new SearchBotDeviceInfo(_,it,rt,ot[1]):new BrowserInfo(_,it,rt)}function detectOS(et){for(var $=0,_=operatingSystemRules.length;$<_;$++){var tt=operatingSystemRules[$],nt=tt[0],it=tt[1],rt=it.exec(et);if(rt)return nt}return null}function getNodeVersion(){var et=typeof process<"u"&&process.version;return et?new NodeInfo(process.version.slice(1)):null}function createVersionParts(et){for(var $=[],_=0;_<et;_++)$.push("0");return $}const es=Object.freeze(Object.defineProperty({__proto__:null,BotInfo,BrowserInfo,NodeInfo,ReactNativeInfo,SearchBotDeviceInfo,browserName,detect,detectOS,getNodeVersion,parseUserAgent},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(es);var uaParser={exports:{}};(function(et,$){(function(_,tt){var nt="1.0.41",it="",rt="?",ot="function",lt="undefined",st="object",at="string",ct="major",dt="model",ut="name",ft="type",pt="vendor",St="version",gt="architecture",yt="console",vt="mobile",Ct="tablet",Et="smarttv",Mt="wearable",Rt="embedded",At=500,Dt="Amazon",It="Apple",Vt="ASUS",jt="BlackBerry",qt="Browser",cn="Chrome",dn="Edge",an="Firefox",bn="Google",Ut="Honor",Kt="Huawei",Gt="Lenovo",Wt="LG",Jt="Microsoft",_n="Motorola",mn="Nvidia",hn="OnePlus",gn="Opera",yn="OPPO",En="Samsung",Mn="Sharp",Rn="Sony",Pn="Xiaomi",Sn="Zebra",Dn="Facebook",An="Chromium OS",In="Mac OS",Cn=" Browser",Fn=function(Yt,tn){var Qt={};for(var $t in Yt)tn[$t]&&tn[$t].length%2===0?Qt[$t]=tn[$t].concat(Yt[$t]):Qt[$t]=Yt[$t];return Qt},wt=function(Yt){for(var tn={},Qt=0;Qt<Yt.length;Qt++)tn[Yt[Qt].toUpperCase()]=Yt[Qt];return tn},mt=function(Yt,tn){return typeof Yt===at?ht(tn).indexOf(ht(Yt))!==-1:!1},ht=function(Yt){return Yt.toLowerCase()},bt=function(Yt){return typeof Yt===at?Yt.replace(/[^\d\.]/g,it).split(".")[0]:tt},kt=function(Yt,tn){if(typeof Yt===at)return Yt=Yt.replace(/^\s\s*/,it),typeof tn===lt?Yt:Yt.substring(0,At)},Ot=function(Yt,tn){for(var Qt=0,$t,Bt,sn,Ft,Tt,xt;Qt<tn.length&&!Tt;){var Lt=tn[Qt],Xt=tn[Qt+1];for($t=Bt=0;$t<Lt.length&&!Tt&&Lt[$t];)if(Tt=Lt[$t++].exec(Yt),Tt)for(sn=0;sn<Xt.length;sn++)xt=Tt[++Bt],Ft=Xt[sn],typeof Ft===st&&Ft.length>0?Ft.length===2?typeof Ft[1]==ot?this[Ft[0]]=Ft[1].call(this,xt):this[Ft[0]]=Ft[1]:Ft.length===3?typeof Ft[1]===ot&&!(Ft[1].exec&&Ft[1].test)?this[Ft[0]]=xt?Ft[1].call(this,xt,Ft[2]):tt:this[Ft[0]]=xt?xt.replace(Ft[1],Ft[2]):tt:Ft.length===4&&(this[Ft[0]]=xt?Ft[3].call(this,xt.replace(Ft[1],Ft[2])):tt):this[Ft]=xt||tt;Qt+=2}},Nt=function(Yt,tn){for(var Qt in tn)if(typeof tn[Qt]===st&&tn[Qt].length>0){for(var $t=0;$t<tn[Qt].length;$t++)if(mt(tn[Qt][$t],Yt))return Qt===rt?tt:Qt}else if(mt(tn[Qt],Yt))return Qt===rt?tt:Qt;return tn.hasOwnProperty("*")?tn["*"]:Yt},en={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},rn={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},ln={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[St,[ut,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[St,[ut,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[ut,St],[/opios[\/ ]+([\w\.]+)/i],[St,[ut,gn+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[St,[ut,gn+" GX"]],[/\bopr\/([\w\.]+)/i],[St,[ut,gn]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[St,[ut,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[St,[ut,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[ut,St],[/quark(?:pc)?\/([-\w\.]+)/i],[St,[ut,"Quark"]],[/\bddg\/([\w\.]+)/i],[St,[ut,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[St,[ut,"UC"+qt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[St,[ut,"WeChat"]],[/konqueror\/([\w\.]+)/i],[St,[ut,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[St,[ut,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[St,[ut,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[St,[ut,"Smart Lenovo "+qt]],[/(avast|avg)\/([\w\.]+)/i],[[ut,/(.+)/,"$1 Secure "+qt],St],[/\bfocus\/([\w\.]+)/i],[St,[ut,an+" Focus"]],[/\bopt\/([\w\.]+)/i],[St,[ut,gn+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[St,[ut,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[St,[ut,"Dolphin"]],[/coast\/([\w\.]+)/i],[St,[ut,gn+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[St,[ut,"MIUI"+Cn]],[/fxios\/([\w\.-]+)/i],[St,[ut,an]],[/\bqihoobrowser\/?([\w\.]*)/i],[St,[ut,"360"]],[/\b(qq)\/([\w\.]+)/i],[[ut,/(.+)/,"$1Browser"],St],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[ut,/(.+)/,"$1"+Cn],St],[/samsungbrowser\/([\w\.]+)/i],[St,[ut,En+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[St,[ut,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[ut,"Sogou Mobile"],St],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[ut,St],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[ut],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[St,ut],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[ut,Dn],St],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[ut,St],[/\bgsa\/([\w\.]+) .*safari\//i],[St,[ut,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[St,[ut,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[St,[ut,cn+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[ut,cn+" WebView"],St],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[St,[ut,"Android "+qt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[ut,St],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[St,[ut,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[St,ut],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[ut,[St,Nt,en]],[/(webkit|khtml)\/([\w\.]+)/i],[ut,St],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[ut,"Netscape"],St],[/(wolvic|librewolf)\/([\w\.]+)/i],[ut,St],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[St,[ut,an+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[ut,[St,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[ut,[St,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[gt,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[gt,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[gt,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[gt,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[gt,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[gt,/ower/,it,ht]],[/ sun4\w[;\)]/i],[[gt,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[gt,ht]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[dt,[pt,En],[ft,Ct]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[dt,[pt,En],[ft,vt]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[dt,[pt,It],[ft,vt]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[dt,[pt,It],[ft,Ct]],[/(macintosh);/i],[dt,[pt,It]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[dt,[pt,Mn],[ft,vt]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[dt,[pt,Ut],[ft,Ct]],[/honor([-\w ]+)[;\)]/i],[dt,[pt,Ut],[ft,vt]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[dt,[pt,Kt],[ft,Ct]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[dt,[pt,Kt],[ft,vt]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[dt,/_/g," "],[pt,Pn],[ft,Ct]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[dt,/_/g," "],[pt,Pn],[ft,vt]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[dt,[pt,yn],[ft,vt]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[dt,[pt,Nt,{OnePlus:["304","403","203"],"*":yn}],[ft,Ct]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[dt,[pt,"Vivo"],[ft,vt]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[dt,[pt,"Realme"],[ft,vt]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[dt,[pt,_n],[ft,vt]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[dt,[pt,_n],[ft,Ct]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[dt,[pt,Wt],[ft,Ct]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[dt,[pt,Wt],[ft,vt]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[dt,[pt,Gt],[ft,Ct]],[/(nokia) (t[12][01])/i],[pt,dt,[ft,Ct]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[dt,/_/g," "],[ft,vt],[pt,"Nokia"]],[/(pixel (c|tablet))\b/i],[dt,[pt,bn],[ft,Ct]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[dt,[pt,bn],[ft,vt]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[dt,[pt,Rn],[ft,vt]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[dt,"Xperia Tablet"],[pt,Rn],[ft,Ct]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[dt,[pt,hn],[ft,vt]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[dt,[pt,Dt],[ft,Ct]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[dt,/(.+)/g,"Fire Phone $1"],[pt,Dt],[ft,vt]],[/(playbook);[-\w\),; ]+(rim)/i],[dt,pt,[ft,Ct]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[dt,[pt,jt],[ft,vt]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[dt,[pt,Vt],[ft,Ct]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[dt,[pt,Vt],[ft,vt]],[/(nexus 9)/i],[dt,[pt,"HTC"],[ft,Ct]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[pt,[dt,/_/g," "],[ft,vt]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[dt,[pt,"TCL"],[ft,Ct]],[/(itel) ((\w+))/i],[[pt,ht],dt,[ft,Nt,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[dt,[pt,"Acer"],[ft,Ct]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[dt,[pt,"Meizu"],[ft,vt]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[dt,[pt,"Ulefone"],[ft,vt]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[dt,[pt,"Energizer"],[ft,vt]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[dt,[pt,"Cat"],[ft,vt]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[dt,[pt,"Smartfren"],[ft,vt]],[/droid.+; (a(?:015|06[35]|142p?))/i],[dt,[pt,"Nothing"],[ft,vt]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[dt,[pt,"Archos"],[ft,Ct]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[dt,[pt,"Archos"],[ft,vt]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[pt,dt,[ft,Ct]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[pt,dt,[ft,vt]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[pt,dt,[ft,Ct]],[/(surface duo)/i],[dt,[pt,Jt],[ft,Ct]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[dt,[pt,"Fairphone"],[ft,vt]],[/(u304aa)/i],[dt,[pt,"AT&T"],[ft,vt]],[/\bsie-(\w*)/i],[dt,[pt,"Siemens"],[ft,vt]],[/\b(rct\w+) b/i],[dt,[pt,"RCA"],[ft,Ct]],[/\b(venue[\d ]{2,7}) b/i],[dt,[pt,"Dell"],[ft,Ct]],[/\b(q(?:mv|ta)\w+) b/i],[dt,[pt,"Verizon"],[ft,Ct]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[dt,[pt,"Barnes & Noble"],[ft,Ct]],[/\b(tm\d{3}\w+) b/i],[dt,[pt,"NuVision"],[ft,Ct]],[/\b(k88) b/i],[dt,[pt,"ZTE"],[ft,Ct]],[/\b(nx\d{3}j) b/i],[dt,[pt,"ZTE"],[ft,vt]],[/\b(gen\d{3}) b.+49h/i],[dt,[pt,"Swiss"],[ft,vt]],[/\b(zur\d{3}) b/i],[dt,[pt,"Swiss"],[ft,Ct]],[/\b((zeki)?tb.*\b) b/i],[dt,[pt,"Zeki"],[ft,Ct]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[pt,"Dragon Touch"],dt,[ft,Ct]],[/\b(ns-?\w{0,9}) b/i],[dt,[pt,"Insignia"],[ft,Ct]],[/\b((nxa|next)-?\w{0,9}) b/i],[dt,[pt,"NextBook"],[ft,Ct]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[pt,"Voice"],dt,[ft,vt]],[/\b(lvtel\-)?(v1[12]) b/i],[[pt,"LvTel"],dt,[ft,vt]],[/\b(ph-1) /i],[dt,[pt,"Essential"],[ft,vt]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[dt,[pt,"Envizen"],[ft,Ct]],[/\b(trio[-\w\. ]+) b/i],[dt,[pt,"MachSpeed"],[ft,Ct]],[/\btu_(1491) b/i],[dt,[pt,"Rotor"],[ft,Ct]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[dt,[pt,mn],[ft,Ct]],[/(sprint) (\w+)/i],[pt,dt,[ft,vt]],[/(kin\.[onetw]{3})/i],[[dt,/\./g," "],[pt,Jt],[ft,vt]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[dt,[pt,Sn],[ft,Ct]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[dt,[pt,Sn],[ft,vt]],[/smart-tv.+(samsung)/i],[pt,[ft,Et]],[/hbbtv.+maple;(\d+)/i],[[dt,/^/,"SmartTV"],[pt,En],[ft,Et]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[pt,Wt],[ft,Et]],[/(apple) ?tv/i],[pt,[dt,It+" TV"],[ft,Et]],[/crkey/i],[[dt,cn+"cast"],[pt,bn],[ft,Et]],[/droid.+aft(\w+)( bui|\))/i],[dt,[pt,Dt],[ft,Et]],[/(shield \w+ tv)/i],[dt,[pt,mn],[ft,Et]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[dt,[pt,Mn],[ft,Et]],[/(bravia[\w ]+)( bui|\))/i],[dt,[pt,Rn],[ft,Et]],[/(mi(tv|box)-?\w+) bui/i],[dt,[pt,Pn],[ft,Et]],[/Hbbtv.*(technisat) (.*);/i],[pt,dt,[ft,Et]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[pt,kt],[dt,kt],[ft,Et]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[dt,[ft,Et]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[ft,Et]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[pt,dt,[ft,yt]],[/droid.+; (shield)( bui|\))/i],[dt,[pt,mn],[ft,yt]],[/(playstation \w+)/i],[dt,[pt,Rn],[ft,yt]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[dt,[pt,Jt],[ft,yt]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[dt,[pt,En],[ft,Mt]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[pt,dt,[ft,Mt]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[dt,[pt,yn],[ft,Mt]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[dt,[pt,It],[ft,Mt]],[/(opwwe\d{3})/i],[dt,[pt,hn],[ft,Mt]],[/(moto 360)/i],[dt,[pt,_n],[ft,Mt]],[/(smartwatch 3)/i],[dt,[pt,Rn],[ft,Mt]],[/(g watch r)/i],[dt,[pt,Wt],[ft,Mt]],[/droid.+; (wt63?0{2,3})\)/i],[dt,[pt,Sn],[ft,Mt]],[/droid.+; (glass) \d/i],[dt,[pt,bn],[ft,Mt]],[/(pico) (4|neo3(?: link|pro)?)/i],[pt,dt,[ft,Mt]],[/; (quest( \d| pro)?)/i],[dt,[pt,Dn],[ft,Mt]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[pt,[ft,Rt]],[/(aeobc)\b/i],[dt,[pt,Dt],[ft,Rt]],[/(homepod).+mac os/i],[dt,[pt,It],[ft,Rt]],[/windows iot/i],[[ft,Rt]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[dt,[ft,vt]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[dt,[ft,Ct]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[ft,Ct]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[ft,vt]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[dt,[pt,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[St,[ut,dn+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[ut,St],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[St,[ut,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[ut,St],[/ladybird\//i],[[ut,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[St,ut]],os:[[/microsoft (windows) (vista|xp)/i],[ut,St],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[ut,[St,Nt,rn]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[St,Nt,rn],[ut,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[St,/_/g,"."],[ut,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[ut,In],[St,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[St,ut],[/(ubuntu) ([\w\.]+) like android/i],[[ut,/(.+)/,"$1 Touch"],St],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[ut,St],[/\(bb(10);/i],[St,[ut,jt]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[St,[ut,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[St,[ut,an+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[St,[ut,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[St,[ut,"watchOS"]],[/crkey\/([\d\.]+)/i],[St,[ut,cn+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[ut,An],St],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[ut,St],[/(sunos) ?([\w\.\d]*)/i],[[ut,"Solaris"],St],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[ut,St]]},Zt=function(Yt,tn){if(typeof Yt===st&&(tn=Yt,Yt=tt),!(this instanceof Zt))return new Zt(Yt,tn).getResult();var Qt=typeof _!==lt&&_.navigator?_.navigator:tt,$t=Yt||(Qt&&Qt.userAgent?Qt.userAgent:it),Bt=Qt&&Qt.userAgentData?Qt.userAgentData:tt,sn=tn?Fn(ln,tn):ln,Ft=Qt&&Qt.userAgent==$t;return this.getBrowser=function(){var Tt={};return Tt[ut]=tt,Tt[St]=tt,Ot.call(Tt,$t,sn.browser),Tt[ct]=bt(Tt[St]),Ft&&Qt&&Qt.brave&&typeof Qt.brave.isBrave==ot&&(Tt[ut]="Brave"),Tt},this.getCPU=function(){var Tt={};return Tt[gt]=tt,Ot.call(Tt,$t,sn.cpu),Tt},this.getDevice=function(){var Tt={};return Tt[pt]=tt,Tt[dt]=tt,Tt[ft]=tt,Ot.call(Tt,$t,sn.device),Ft&&!Tt[ft]&&Bt&&Bt.mobile&&(Tt[ft]=vt),Ft&&Tt[dt]=="Macintosh"&&Qt&&typeof Qt.standalone!==lt&&Qt.maxTouchPoints&&Qt.maxTouchPoints>2&&(Tt[dt]="iPad",Tt[ft]=Ct),Tt},this.getEngine=function(){var Tt={};return Tt[ut]=tt,Tt[St]=tt,Ot.call(Tt,$t,sn.engine),Tt},this.getOS=function(){var Tt={};return Tt[ut]=tt,Tt[St]=tt,Ot.call(Tt,$t,sn.os),Ft&&!Tt[ut]&&Bt&&Bt.platform&&Bt.platform!="Unknown"&&(Tt[ut]=Bt.platform.replace(/chrome os/i,An).replace(/macos/i,In)),Tt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return $t},this.setUA=function(Tt){return $t=typeof Tt===at&&Tt.length>At?kt(Tt,At):Tt,this},this.setUA($t),this};Zt.VERSION=nt,Zt.BROWSER=wt([ut,St,ct]),Zt.CPU=wt([gt]),Zt.DEVICE=wt([dt,pt,ft,yt,vt,Et,Ct,Mt,Rt]),Zt.ENGINE=Zt.OS=wt([ut,St]),et.exports&&($=et.exports=Zt),$.UAParser=Zt;var on=typeof _!==lt&&(_.jQuery||_.Zepto);if(on&&!on.ua){var kn=new Zt;on.ua=kn.getResult(),on.ua.get=function(){return kn.getUA()},on.ua.set=function(Yt){kn.setUA(Yt);var tn=kn.getResult();for(var Qt in tn)on.ua[Qt]=tn[Qt]}}})(typeof window=="object"?window:commonjsGlobal)})(uaParser,uaParser.exports);var uaParserExports=uaParser.exports,__awaiter$13=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(DefaultBrowserBehavior$1,"__esModule",{value:!0});const detect_browser_1=require$$0$1,ua_parser_js_1$2=uaParserExports;class DefaultBrowserBehavior{constructor(){this.FALLBACK_BROWSER={type:"browser",name:"unknown",version:"unknown",os:"unknown"},this.browser=detect_browser_1.detect()||this.FALLBACK_BROWSER,this.uaParserResult=navigator&&navigator.userAgent?new ua_parser_js_1$2.UAParser(navigator.userAgent).getResult():null,this.browserSupport={chrome:78,"edge-chromium":79,electron:7,firefox:75,ios:13,safari:13,opera:66,samsung:12,crios:86,fxios:23,"ios-webview":605,"chromium-webview":92},this.browserName={chrome:"Google Chrome","edge-chromium":"Microsoft Edge",electron:"Electron",firefox:"Mozilla Firefox",ios:"Safari iOS",safari:"Safari",opera:"Opera",samsung:"Samsung Internet",crios:"Chrome iOS",fxios:"Firefox iOS","ios-webview":"WKWebView iOS","chromium-webview":"Chrome WebView"},this.chromeLike=["chrome","edge-chromium","chromium-webview","opera","samsung"],this.webkitBrowsers=["crios","fxios","safari","ios","ios-webview","edge-ios"]}version(){return this.browser.version}majorVersion(){return this.version()!==null?parseInt(this.version().split(".")[0]):-1}osMajorVersion(){return parseInt(this.uaParserResult.os.version.split(".")[0])}engine(){return this.uaParserResult.engine.name}engineMajorVersion(){return parseInt(this.uaParserResult.engine.version.split(".")[0])}name(){return this.browser.name}hasChromiumWebRTC(){for(const $ of this.chromeLike)if($===this.browser.name)return!0;return!1}hasWebKitWebRTC(){for(const $ of this.webkitBrowsers)if($===this.browser.name)return!0;return!1}hasFirefoxWebRTC(){return this.isFirefox()}requiresPlaybackLatencyHintForAudioContext(){return navigator.userAgent.indexOf("Windows")!==-1}supportsCanvasCapturedStreamPlayback(){return!this.isIOSSafari()&&!this.isIOSChrome()&&!this.isIOSFirefox()&&!this.isIOSEdge()||this.isIOSSafari()&&this.majorVersion()>=DefaultBrowserBehavior.MIN_IOS_SUPPORT_CANVAS_STREAM_PLAYBACK||this.majorVersion()>=DefaultBrowserBehavior.MIN_IOS_NON_SAFARI_SUPPORT_CANVAS_STREAM_PLAYBACK}supportsBackgroundFilter(){return!(this.name()==="safari"&&this.majorVersion()===15||!this.supportsCanvasCapturedStreamPlayback())}supportsVideoLayersAllocationRtpHeaderExtension(){return this.hasChromiumWebRTC()}supportsDependencyDescriptorRtpHeaderExtension(){return this.hasChromiumWebRTC()}supportsScalableVideoCoding(){return this.hasChromiumWebRTC()&&this.engine()==="Blink"&&this.engineMajorVersion()>=111}supportsAudioRedundancy(){return this.hasChromiumWebRTC()?this.engineMajorVersion()>=107:!this.hasFirefoxWebRTC()}requiresResolutionAlignment($,_){return this.isAndroid()&&this.isPixel3()?[Math.ceil($/64)*64,Math.ceil(_/64)*64]:[$,_]}requiresCheckForSdpConnectionAttributes(){return!this.isIOSSafari()&&!this.isIOSChrome()&&!this.isIOSFirefox()}requiresIceCandidateGatheringTimeoutWorkaround(){return this.hasChromiumWebRTC()}requiresBundlePolicy(){return"max-bundle"}requiresNoExactMediaStreamConstraints(){return this.isSamsungInternet()}requiresGroupIdMediaStreamConstraints(){return this.isSamsungInternet()}getDisplayMediaAudioCaptureSupport(){return this.isChrome()||this.isEdge()}doesNotSupportMediaDeviceLabels(){return this.browser.name==="chromium-webview"}isSupported(){return!(!this.browserSupport[this.browser.name]||this.majorVersion()<this.browserSupport[this.browser.name]||this.browser.name==="firefox"&&this.isAndroid())}isSimulcastSupported(){return this.hasChromiumWebRTC()}supportDownlinkBandwidthEstimation(){return!this.isFirefox()}supportString(){if(this.isAndroid())return`${this.browserName.chrome} ${this.browserSupport.chrome}+, ${this.browserName.samsung} ${this.browserSupport.samsung}+`;const $=[];for(const _ in this.browserSupport)$.push(`${this.browserName[_]} ${this.browserSupport[_]}+`);return $.join(", ")}supportedVideoCodecs(){return __awaiter$13(this,void 0,void 0,function*(){const $=new RTCPeerConnection;return $.addTransceiver("video",{direction:"inactive",streams:[]}),(yield $.createOffer({offerToReceiveVideo:!0})).sdp.split(`\r
`).filter(_=>_.includes("a=rtpmap:")).map(_=>_.replace(/.* /,"").replace(/\/.*/,"")).filter((_,tt,nt)=>nt.indexOf(_)===tt).filter(_=>_!=="rtx"&&_!=="red"&&_!=="ulpfec")})}supportsSetSinkId(){return"setSinkId"in HTMLAudioElement.prototype}disableResolutionScaleDown(){return this.isAndroid()}disable480pResolutionScaleDown(){return/( Chrome\/98\.)/i.test(navigator.userAgent)&&this.browser.os.startsWith("Windows")}requiresDisablingH264Encoding(){return this.isIOS()&&(this.version()==="15.1.0"||/( OS 15_1)/i.test(navigator.userAgent))}requiresVideoPlayWorkaround(){return this.isSafari()}requiresAudioContextResetOnDeviceFailureForWebAudio(){return this.isIOS()}isVideoFxSupportedBrowser(){return this.supportsBackgroundFilter()}isIOSSafari(){return this.browser.name==="ios"||this.browser.name==="ios-webview"||this.browser.name==="safari"&&/( Mac )/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1}isSafari(){return this.browser.name==="safari"||this.isIOSSafari()}isFirefox(){return this.browser.name==="firefox"}isIOSFirefox(){return this.browser.name==="fxios"}isIOSChrome(){return this.browser.name==="crios"}isChrome(){return this.browser.name==="chrome"}isEdge(){return this.browser.name==="edge-chromium"}isIOSEdge(){return this.browser.name==="edge-ios"}isSamsungInternet(){return this.browser.name==="samsung"}isAndroid(){return/(android)/i.test(navigator.userAgent)}isPixel3(){return/( pixel 3)/i.test(navigator.userAgent)}isIOS(){return this.isIOSSafari()||this.isIOSChrome()||this.isIOSFirefox()}}DefaultBrowserBehavior$1.default=DefaultBrowserBehavior;DefaultBrowserBehavior.MIN_IOS_SUPPORT_CANVAS_STREAM_PLAYBACK=16;DefaultBrowserBehavior.MIN_IOS_NON_SAFARI_SUPPORT_CANVAS_STREAM_PLAYBACK=106;var __importDefault$1I=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(AudioProfile$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$c=__importDefault$1I(DefaultBrowserBehavior$1);class AudioProfile{constructor($=null,_=!0){this.audioBitrateBps=$,this.enableAudioRedundancy=new DefaultBrowserBehavior_1$c.default().supportsAudioRedundancy()&&_}static fullbandSpeechMono($=!0){return new AudioProfile(4e4,$)}static fullbandMusicMono($=!0){return new AudioProfile(64e3,$)}static fullbandMusicStereo($=!0){return new AudioProfile(128e3,$)}isStereo(){return this.audioBitrateBps===128e3}hasRedundancyEnabled(){return this.enableAudioRedundancy}}AudioProfile$1.default=AudioProfile;var AudioVideoControllerState={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT=void 0,et.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT=25;class ${constructor(){this.logger=null,this.browserBehavior=null,this.meetingSessionConfiguration=null,this.signalingClient=null,this.peer=null,this.previousSdpOffer=null,this.sdpOfferInit=null,this.audioVideoController=null,this.realtimeController=null,this.videoTileController=null,this.mediaStreamBroker=null,this.activeAudioInput=void 0,this.activeVideoInput=void 0,this.audioMixController=null,this.transceiverController=null,this.indexFrame=null,this.iceCandidates=[],this.iceCandidateHandler=null,this.iceGatheringStateEventHandler=null,this.sdpAnswer=null,this.turnCredentials=null,this.reconnectController=null,this.removableObservers=[],this.audioProfile=null,this.videoStreamIndex=null,this.videoDownlinkBandwidthPolicy=null,this.videoUplinkBandwidthPolicy=null,this.lastKnownVideoAvailability=null,this.videoCaptureAndEncodeParameter=null,this.videosToReceive=null,this.lastVideosToReceive=null,this.videoSubscriptions=null,this.lastVideoSubscriptionConfiguration=new Map,this.videoSubscriptionLimit=et.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT,this.previousSdpAnswerAsString="",this.serverSupportsCompression=!1,this.videoSendCodecPreferences=[],this.currentVideoSendCodec=void 0,this.meetingSupportedVideoSendCodecPreferences=void 0,this.prioritizedSendVideoCodecCapabilities=[],this.degradedVideoSendCodecs=[],this.videosPaused=null,this.videoDuplexMode=null,this.volumeIndicatorAdapter=null,this.statsCollector=null,this.connectionMonitor=null,this.videoInputAttachedTimestampMs=0,this.audioDeviceInformation={},this.videoDeviceInformation={},this.enableSimulcast=!1,this.enableSVC=!1,this.eventController=null,this.signalingOpenDurationMs=null,this.iceGatheringDurationMs=null,this.startAudioVideoTimestamp=null,this.attendeePresenceDurationMs=null,this.meetingStartDurationMs=null,this.poorConnectionCount=0,this.maxVideoTileCount=0,this.startTimeMs=null,this.isSessionConnected=!1}resetConnectionSpecificState(){this.peer&&this.peer.close(),this.peer=null,this.previousSdpOffer=null,this.sdpOfferInit=null,this.transceiverController!==void 0&&this.transceiverController.reset(),this.indexFrame=null,this.iceCandidates=[],this.iceCandidateHandler=null,this.sdpAnswer=null,this.turnCredentials=null,this.videoDownlinkBandwidthPolicy.reset(),this.videoUplinkBandwidthPolicy.reset&&this.videoUplinkBandwidthPolicy.reset(),this.lastVideosToReceive=null,this.lastVideoSubscriptionConfiguration=new Map,this.videoSubscriptions=null,this.videoSubscriptionLimit=et.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT,this.previousSdpAnswerAsString="",this.serverSupportsCompression=!1,this.currentVideoSendCodec=void 0,this.meetingSupportedVideoSendCodecPreferences=void 0,this.videoDuplexMode=null,this.isSessionConnected=!1}}et.default=$})(AudioVideoControllerState);var BackgroundBlurStrength={};Object.defineProperty(BackgroundBlurStrength,"__esModule",{value:!0});BackgroundBlurStrength.BlurStrengthMapper=void 0;const BlurStrength={LOW:7,MEDIUM:15,HIGH:30};class BlurStrengthMapper{static getBlurAmount($,_){if($<=0)throw new Error(`invalid value for blur strength: ${$}`);return Math.round($*_.height/this.BLUR_STRENGTH_DIVISOR)}}BackgroundBlurStrength.BlurStrengthMapper=BlurStrengthMapper;BlurStrengthMapper.BLUR_STRENGTH_DIVISOR=540;BackgroundBlurStrength.default=BlurStrength;var BackgroundBlurVideoFrameProcessor$1={},BackgroundFilterVideoFrameProcessor$1={},loader={},fetch$1={};Object.defineProperty(fetch$1,"__esModule",{value:!0});fetch$1.isValidRevisionID=fetch$1.isValidAssetGroup=fetch$1.resolveURL=fetch$1.addQueryParams=fetch$1.withQueryString=fetch$1.withRequestHeaders=fetch$1.fetchWithBehavior=void 0;function fetchWithBehavior(et,$,_){if(!_)return fetch(et,$);const tt=withQueryString(et,_),nt=withRequestHeaders($,_);return fetch(tt,nt)}fetch$1.fetchWithBehavior=fetchWithBehavior;function withRequestHeaders(et,$){return $!=null&&$.headers?et?Object.assign(Object.assign({},et),{headers:Object.assign(Object.assign({},et.headers||{}),$.headers)}):{headers:$.headers}:et}fetch$1.withRequestHeaders=withRequestHeaders;function withQueryString(et,$){if(!($!=null&&$.escapedQueryString))return et;const _=et.lastIndexOf("?")!==-1;return`${et}${_?"&":"?"}${$.escapedQueryString}`}fetch$1.withQueryString=withQueryString;function addQueryParams(et,$){const _=Object.keys($);if(!_.length)return et;const tt=new URLSearchParams(et==null?void 0:et.escapedQueryString);for(const nt of _)tt.append(nt,$[nt]);return Object.assign(Object.assign({},et),{escapedQueryString:tt.toString()})}fetch$1.addQueryParams=addQueryParams;const HEAD_OPTIONS={method:"HEAD",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"origin"};function resolveURL(et,$){return fetchWithBehavior(et,HEAD_OPTIONS,$).then(_=>_.redirected?_.url:et)}fetch$1.resolveURL=resolveURL;function isValidAssetGroup(et){return!!et&&/^[-.a-zA-Z0-9]+$/.test(et)}fetch$1.isValidAssetGroup=isValidAssetGroup;function isValidRevisionID(et){return!!et&&/^[123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ]{22}$/.test(et)}fetch$1.isValidRevisionID=isValidRevisionID;Object.defineProperty(loader,"__esModule",{value:!0});loader.loadWorker=void 0;const fetch_js_1$1=fetch$1,WORKER_FETCH_OPTIONS={method:"GET",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"no-referrer"},loadWorker=(et,$,_,tt)=>{tt==null||tt.debug(`Loading ${$} worker from ${et}.`);let nt=!1;try{nt=self.origin===new URL(et).origin}catch(it){tt==null||tt.error("Could not compare origins.",it)}if(nt){const it=(0,fetch_js_1$1.withQueryString)(et,_);return Promise.resolve(new Worker(it,{name:$}))}return(0,fetch_js_1$1.fetchWithBehavior)(et,WORKER_FETCH_OPTIONS,_).then(it=>{if(it.ok)return it.blob().then(rt=>new Worker(window.URL.createObjectURL(rt)));throw new Error("Fetch failed.")})};loader.loadWorker=loadWorker;var support={};(function(et){var $=commonjsGlobal&&commonjsGlobal.__awaiter||function(pt,St,gt,yt){function vt(Ct){return Ct instanceof gt?Ct:new gt(function(Et){Et(Ct)})}return new(gt||(gt=Promise))(function(Ct,Et){function Mt(Dt){try{At(yt.next(Dt))}catch(It){Et(It)}}function Rt(Dt){try{At(yt.throw(Dt))}catch(It){Et(It)}}function At(Dt){Dt.done?Ct(Dt.value):vt(Dt.value).then(Mt,Rt)}At((yt=yt.apply(pt,St||[])).next())})};Object.defineProperty(et,"__esModule",{value:!0}),et.isOldChrome=et.supportsWASMStreaming=et.supportsSharedArrayBuffer=et.supportsWASM=et.supportsAudioWorklet=et.supportsWorker=et.supportsVoiceFocusWorker=et.supportsWASMPostMessage=et.isSafari=void 0;const _=loader,tt=(pt=globalThis)=>!!window.navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)/),nt=(pt=globalThis)=>{const St=window.navigator.userAgent,gt=St.match(/Safari\//),yt=St.match(/Chrom(?:e|ium)\//);return!!(gt&&!yt)};et.isSafari=nt;const it=(pt=globalThis)=>(0,et.isSafari)(window)?!1:tt(window)?(ut(window)||0)<95:!0;et.supportsWASMPostMessage=it;const rt=(pt=globalThis,St,gt)=>$(void 0,void 0,void 0,function*(){if(!(0,et.supportsWorker)(pt,gt))return!1;const yt=`${St.paths.workers}worker-v1.js`;try{const vt=yield(0,_.loadWorker)(yt,"VoiceFocusTestWorker",St,gt);try{vt.terminate()}catch(Ct){gt==null||gt.debug("Failed to terminate worker.",Ct)}return!0}catch(vt){return gt==null||gt.info("Failed to fetch and instantiate test worker",vt),!1}});et.supportsVoiceFocusWorker=rt;const ot=(pt=globalThis,St)=>{try{return!!pt.Worker}catch(gt){return St==null||St.info("Does not support Worker",gt),!1}};et.supportsWorker=ot;const lt=(pt=globalThis,St)=>{try{return!!pt.AudioWorklet&&!!pt.AudioWorkletNode}catch(gt){return St==null||St.info("Does not support Audio Worklet",gt),!1}};et.supportsAudioWorklet=lt;const st=(pt=globalThis,St)=>{try{return!!pt.WebAssembly&&(!!pt.WebAssembly.compile||!!pt.WebAssembly.compileStreaming)}catch(gt){return St==null||St.info("Does not support WASM",gt),!1}};et.supportsWASM=st;const at=(pt=globalThis,St=globalThis,gt)=>{try{return!!pt.SharedArrayBuffer&&(!!St.chrome||!!pt.crossOriginIsolated)}catch{return gt==null||gt.info("Does not support SharedArrayBuffer."),!1}};et.supportsSharedArrayBuffer=at;const ct=(pt=globalThis,St)=>{var gt;try{return!!(!((gt=pt.WebAssembly)===null||gt===void 0)&&gt.compileStreaming)}catch(yt){return St==null||St.info("Does not support WASM streaming compilation",yt),!1}};et.supportsWASMStreaming=ct;const dt=90,ut=(pt=globalThis)=>{try{if(!window.chrome)return}catch{}const St=window.navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)/);if(St)return parseInt(St[1],10)},ft=(pt=globalThis,St)=>{const gt=ut(window);return gt&&gt<dt?(St==null||St.debug(`Chrome ${gt} has incomplete SIMD support.`),!0):!1};et.isOldChrome=ft})(support);var ModelSpecBuilder$1={};Object.defineProperty(ModelSpecBuilder$1,"__esModule",{value:!0});class ModelSpecBuilder{constructor(){this.path=null,this.input=null,this.output=null}static builder(){return new ModelSpecBuilder}withDefaultModel(){return this.withSelfieSegmentationDefaults()}withSelfieSegmentationDefaults(){const $={height:144,width:256,range:[0,1],channels:3},_={height:144,width:256,range:[0,1],channels:1},tt="https://static.sdkassets.chime.aws/bgblur/models/selfie_segmentation_landscape.tflite";return this.path=tt,this.input=$,this.output=_,this}withPath($){return this.path=$,this}withInput($){return this.input=$,this}withOutput($){return this.output=$,this}validate(){if(!this.path)throw new Error("model spec path is not set");if(!this.input)throw new Error("model spec input is not set");if(!this.output)throw new Error("model spec output is not set")}build(){return this.validate(),{path:this.path,input:this.input,output:this.output}}}ModelSpecBuilder$1.default=ModelSpecBuilder;var Versioning$1={},version$2={};Object.defineProperty(version$2,"__esModule",{value:!0});version$2.default={hash:"e209404",raw:"v3.29.0",semverString:"3.29.0"};var __importDefault$1H=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(Versioning$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$b=__importDefault$1H(DefaultBrowserBehavior$1),version_1=__importDefault$1H(version$2);class Versioning{static get sdkName(){return"amazon-chime-sdk-js"}static get sdkVersion(){return version_1.default.semverString}static get sdkVersionSemVer(){var $,_,tt,nt;const it=version_1.default.semverString.match(/^(?<major>[0-9]+)\.(?<minor>[0-9]+)((?:\.(?<patch>[0-9]+))(?:-(?<preRelease>[a-zA-Z]+(\.[0-9])*))?)?/);return{major:($=it==null?void 0:it.groups)===null||$===void 0?void 0:$.major,minor:(_=it==null?void 0:it.groups)===null||_===void 0?void 0:_.minor,patch:(tt=it==null?void 0:it.groups)===null||tt===void 0?void 0:tt.patch,preRelease:(nt=it==null?void 0:it.groups)===null||nt===void 0?void 0:nt.preRelease}}static get buildSHA(){return version_1.default.hash.substring(1)}static get sdkUserAgentLowResolution(){const $=new DefaultBrowserBehavior_1$b.default;return`${$.name()}-${$.majorVersion()}`}static urlWithVersion($){const _=new URL($);return _.searchParams.append(Versioning.X_AMZN_VERSION,Versioning.sdkVersion),_.searchParams.append(Versioning.X_AMZN_USER_AGENT,Versioning.sdkUserAgentLowResolution),_.toString()}}Versioning$1.default=Versioning;Versioning.X_AMZN_VERSION="X-Amzn-Version";Versioning.X_AMZN_USER_AGENT="X-Amzn-User-Agent";var __awaiter$12=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1G=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(BackgroundFilterVideoFrameProcessor$1,"__esModule",{value:!0});const loader_1$2=loader,support_1$1=support,ModelSpecBuilder_1=__importDefault$1G(ModelSpecBuilder$1),DefaultBrowserBehavior_1$a=__importDefault$1G(DefaultBrowserBehavior$1),Versioning_1$8=__importDefault$1G(Versioning$1),CREATE_DEFAULT_MODEL_SPEC=()=>ModelSpecBuilder_1.default.builder().withSelfieSegmentationDefaults().build(),DEFAULT_CDN$1="https://static.sdkassets.chime.aws",DEFAULT_PATHS$1={worker:`${DEFAULT_CDN$1}/bgblur/workers/worker.js`,wasm:`${DEFAULT_CDN$1}/bgblur/wasm/_cwt-wasm.wasm`,simd:`${DEFAULT_CDN$1}/bgblur/wasm/_cwt-wasm-simd.wasm`};class BackgroundFilterVideoFrameProcessor{static defaultAssetSpec(){const $=Versioning_1$8.default.sdkVersionSemVer;return{assetGroup:`sdk-${$.major}.${$.minor}`}}static createUrlWithParams($,_){const tt=new URL($),nt=Object.keys(_);for(const it of nt)_[it]!==void 0&&tt.searchParams.set(it,_[it]);return tt.toString()}static resolveSpec($){const{paths:_=DEFAULT_PATHS$1,model:tt=CREATE_DEFAULT_MODEL_SPEC(),assetGroup:nt=this.defaultAssetSpec().assetGroup,revisionID:it=this.defaultAssetSpec().revisionID}=$||{},rt={assetGroup:nt,revisionID:it,sdk:encodeURIComponent(Versioning_1$8.default.sdkVersion),ua:encodeURIComponent(Versioning_1$8.default.sdkUserAgentLowResolution)};return _.worker=this.createUrlWithParams(_.worker,rt),_.wasm=this.createUrlWithParams(_.wasm,rt),_.simd=this.createUrlWithParams(_.simd,rt),tt.path=this.createUrlWithParams(tt.path,rt),{paths:_,model:tt,assetGroup:nt,revisionID:it}}static resolveOptions($){$.reportingPeriodMillis||($.reportingPeriodMillis=1e3);const _=30;return $.filterCPUUtilization?($.filterCPUUtilization<0||$.filterCPUUtilization>100)&&($.logger.warn(`filterCPUUtilization must be set to a range between 0 and 100 percent. Falling back to default of ${_} percent`),$.filterCPUUtilization=_):$.filterCPUUtilization=_,$}static isSupported($,_){const{logger:tt}=_;return typeof globalThis>"u"?(tt.info("Browser does not have globalThis."),Promise.resolve(!1)):new DefaultBrowserBehavior_1$a.default().supportsBackgroundFilter()?support_1$1.supportsWASM(globalThis,tt)?this.supportsBackgroundFilter(globalThis,$,tt):(tt.info("Browser does not support WASM."),Promise.resolve(!1)):(tt.info("Browser is not supported."),Promise.resolve(!1))}static supportsBackgroundFilter($=globalThis,_,tt){return __awaiter$12(this,void 0,void 0,function*(){if(!support_1$1.supportsWorker($,tt))return tt.info("Browser does not support web workers."),!1;const nt=_.paths.worker;try{const it=yield loader_1$2.loadWorker(nt,"BackgroundFilterWorker",{},null);try{it.terminate()}catch(rt){tt.info(`Failed to terminate worker. ${rt.message}`)}return!0}catch(it){return tt.info(`Failed to fetch and instantiate test worker ${it.message}`),!1}})}}BackgroundFilterVideoFrameProcessor$1.default=BackgroundFilterVideoFrameProcessor;var ConsoleLogger$1={},__importDefault$1F=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(ConsoleLogger$1,"__esModule",{value:!0});const LogLevel_1$7=__importDefault$1F(LogLevel);class ConsoleLogger{constructor($,_=LogLevel_1$7.default.WARN){this.name=$,this.level=_}info($){this.log(LogLevel_1$7.default.INFO,$)}warn($){this.log(LogLevel_1$7.default.WARN,$)}error($){this.log(LogLevel_1$7.default.ERROR,$)}debug($){LogLevel_1$7.default.DEBUG<this.level||(typeof $=="string"?this.log(LogLevel_1$7.default.DEBUG,$):$?this.log(LogLevel_1$7.default.DEBUG,$()):this.log(LogLevel_1$7.default.DEBUG,""+$))}setLogLevel($){this.level=$}getLogLevel(){return this.level}log($,_){if($<this.level)return;const nt=`${new Date().toISOString()} [${LogLevel_1$7.default[$]}] ${this.name} - ${_}`;switch($){case LogLevel_1$7.default.ERROR:console.error(nt);break;case LogLevel_1$7.default.WARN:console.warn(nt);break;case LogLevel_1$7.default.DEBUG:console.debug(nt.replace(/\\r\\n/g,`
`));break;case LogLevel_1$7.default.INFO:console.info(nt);break}}}ConsoleLogger$1.default=ConsoleLogger;var NoOpVideoFrameProcessor$1={},__awaiter$11=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(NoOpVideoFrameProcessor$1,"__esModule",{value:!0});class NoOpVideoFrameProcessor{process($){return __awaiter$11(this,void 0,void 0,function*(){return $})}destroy(){return __awaiter$11(this,void 0,void 0,function*(){})}}NoOpVideoFrameProcessor$1.default=NoOpVideoFrameProcessor;var BackgroundBlurProcessorBuiltIn$1={},BackgroundBlurProcessorProvided$1={},BackgroundFilterProcessor$1={},CanvasVideoFrameBuffer$1={},__awaiter$10=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(CanvasVideoFrameBuffer$1,"__esModule",{value:!0});class CanvasVideoFrameBuffer{constructor($){this.canvas=$,this.destroyed=!1}destroy(){this.canvas=null,this.destroyed=!0}asCanvasImageSource(){return __awaiter$10(this,void 0,void 0,function*(){return this.destroyed?Promise.reject("canvas buffer is destroyed"):Promise.resolve(this.canvas)})}asCanvasElement(){return this.canvas}}CanvasVideoFrameBuffer$1.default=CanvasVideoFrameBuffer;var BackgroundFilterFrameCounter$1={};Object.defineProperty(BackgroundFilterFrameCounter$1,"__esModule",{value:!0});const FILTER_DURATION_FACTOR=.8;class BackgroundFilterFrameCounter{constructor($,_,tt,nt){this.delegate=$,this.reportingPeriodMillis=_,this.filterCPUUtilization=tt,this.logger=nt,this._processingFilter=!0,this.lastReportedEventTimestamp=0,this.lastFilterCompleteTimestamp=0,this.filterTotalMillis=0,this.filterCount=0,this.framerate=0,this.filterDurationNotifyMillis=0,this.setSegmentationDuration()}reportEvent($){const _=$-this.lastReportedEventTimestamp;if(_>=this.reportingPeriodMillis){const tt=this.filterCount,nt=this.filterTotalMillis;if(this.filterCount=0,this.filterTotalMillis=0,this.lastReportedEventTimestamp=$,this.framerate===0||tt===0)return;const it=Math.round(nt/tt),rt=Math.round(this.framerate*(_/1e3))-tt,ot=Math.round(100*nt/_);it>=this.filterDurationNotifyMillis&&this.delegate.filterFrameDurationHigh({framesDropped:rt,avgFilterDurationMillis:it,framerate:this.framerate,periodMillis:_}),ot>=this.filterCPUUtilization&&this.delegate.filterCPUUtilizationHigh({cpuUtilization:ot,filterMillis:nt,periodMillis:_})}}setSegmentationDuration(){this.filterDurationNotifyMillis=Math.round(1e3/this.framerate*FILTER_DURATION_FACTOR)}frameReceived($){$!==this.framerate&&(this.framerate=$,this.logger.info(`frame counter setting frame rate to ${this.framerate}`),this.setSegmentationDuration());const _=Date.now();this.reportEvent(_)}filterSubmitted(){this._processingFilter=!0,this.lastFilterCompleteTimestamp=Date.now()}filterComplete(){this.filterTotalMillis+=Date.now()-this.lastFilterCompleteTimestamp,this._processingFilter=!1,this.filterCount++}get processingSegment(){return this._processingFilter}}BackgroundFilterFrameCounter$1.default=BackgroundFilterFrameCounter;var __awaiter$$=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1E=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(BackgroundFilterProcessor$1,"__esModule",{value:!0});BackgroundFilterProcessor$1.BackgroundFilterMonitor=void 0;const loader_1$1=loader,CanvasVideoFrameBuffer_1$2=__importDefault$1E(CanvasVideoFrameBuffer$1),BackgroundFilterFrameCounter_1=__importDefault$1E(BackgroundFilterFrameCounter$1);class DeferredObservable{constructor(){this.value=void 0,this.resolve=null}whenNext(){return this.promise||(this.promise=new Promise($=>this.resolve=$)),this.promise}next($){this.value=$,this.resolve($),delete this.promise}}class BackgroundFilterProcessor{constructor($,_,tt,nt,it){this.targetCanvas=document.createElement("canvas"),this.canvasCtx=this.targetCanvas.getContext("2d"),this.canvasVideoFrameBuffer=new CanvasVideoFrameBuffer_1$2.default(this.targetCanvas),this.mask$=new DeferredObservable,this.sourceWidth=0,this.sourceHeight=0,this.frameNumber=0,this.videoFramesPerFilterUpdate=1,this.initWorkerPromise=BackgroundFilterProcessor.createWorkerPromise(),this.loadModelPromise=BackgroundFilterProcessor.createWorkerPromise(),this.modelInitialized=!1,this.destroyed=!1,this.filterType=$,this.validateSpec(_),this.validateOptions(tt),this.spec=_,this.logger=tt.logger,this.delegate=nt,this.initCPUMonitor(tt),this.eventController=it}static createWorkerPromise(){const $={resolve:null,reject:null,promise:null};return $.promise=new Promise((_,tt)=>{$.resolve=_,$.reject=tt}),$}validateSpec($){if(!$)throw new Error("processor has null spec");if(!$.model)throw new Error("processor spec has null model");if(!$.paths)throw new Error("processor spec has null paths")}validateOptions($){if(!$)throw new Error("processor has null options");if(!$.logger)throw new Error("processor has null options - logger");if(!$.reportingPeriodMillis)throw new Error("processor has null options - reportingPeriodMillis");if(!$.filterCPUUtilization)throw new Error("processor has null options - filterCPUUtilization")}initCPUMonitor($){this.videoFramesPerFilterUpdate=1,this.frameCounter=new BackgroundFilterFrameCounter_1.default(this.delegate,$.reportingPeriodMillis,$.filterCPUUtilization,this.logger),this.cpuMonitor=new BackgroundFilterMonitor(5e3,{reduceCPUUtilization:()=>{this.updateVideoFramesPerFilterUpdate(Math.min(this.videoFramesPerFilterUpdate+1,10))},increaseCPUUtilization:()=>{this.updateVideoFramesPerFilterUpdate(Math.max(this.videoFramesPerFilterUpdate-1,1))}}),this.delegate.addObserver(this.cpuMonitor)}stringify($){return JSON.stringify($,null,2)}handleInitialize($){if(this.logger.info(`received initialize message: ${this.stringify($)}`),!$.payload){this.logger.error("failed to initialize module"),this.initWorkerPromise.reject(new Error("failed to initialize the module"));return}const _=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:_.path,inputHeight:_.input.height,inputWidth:_.input.width,inputChannels:4,modelRangeMin:_.input.range[0],modelRangeMax:_.input.range[1],blurPixels:0}}),this.initWorkerPromise.resolve({})}handleLoadModel($){if(this.logger.info(`received load model message: ${this.stringify($)}`),$.payload!==2){this.logger.error("failed to load model! status: "+$.payload),this.loadModelPromise.reject(new Error("failed to load model! status: "+$.payload));return}this.modelInitialized=!0,this.loadModelPromise.resolve({})}handlePredict($){this.mask$.next($.payload.output)}handleWorkerEvent($){const _=$.data;switch(_.msg){case"initialize":this.handleInitialize(_);break;case"loadModel":this.handleLoadModel(_);break;case"predict":this.handlePredict(_);break;default:this.logger.info(`unexpected event msg: ${this.stringify(_)}`);break}}loadAssets(){return __awaiter$$(this,void 0,void 0,function*(){this.logger.info("start initializing the processor");try{this.worker=yield loader_1$1.loadWorker(this.spec.paths.worker,"BackgroundFilterWorker",{},null),this.worker.addEventListener("message",$=>this.handleWorkerEvent($)),this.worker.postMessage({msg:"initialize",payload:{wasmPath:this.spec.paths.wasm,simdPath:this.spec.paths.simd}}),yield this.initWorkerPromise.promise,this.logger.info(`successfully initialized the ${this.filterType} worker`),yield this.loadModelPromise.promise,this.logger.info(`successfully loaded ${this.filterType} worker segmentation model`)}catch($){throw new Error(`could not initialize the ${this.filterType} video frame processor due to '${$.message}'`)}this.logger.info(`successfully initialized the ${this.filterType} processor`)})}process($){return __awaiter$$(this,void 0,void 0,function*(){if(this.destroyed)return $;this.frameCounter.frameReceived($[0].framerate),this.cpuMonitor.frameReceived();const _=$[0].asCanvasElement();if(!_)return $;if(!this.modelInitialized)return $[0]=this.canvasVideoFrameBuffer,$;const tt=_.width,nt=_.height;if(tt===0||nt===0)return $;this.sourceWidth===0&&(this.sourceWidth=tt,this.sourceHeight=nt,this.targetCanvas.width=this.sourceWidth,this.targetCanvas.height=this.sourceHeight,this.logger.info(`${this.filterType} source width: ${this.sourceWidth}`),this.logger.info(`${this.filterType} source height: ${this.sourceHeight}`),this.initOnFirstExecution()),(this.sourceWidth!==tt||this.sourceHeight!==nt)&&(this.sourceWidth=tt,this.sourceHeight=nt,this.targetCanvas.width=this.sourceWidth,this.targetCanvas.height=this.sourceHeight);try{this.frameCounter.filterSubmitted();let it=this.mask$.value;const rt=this.spec.model.input.width/_.width,ot=this.spec.model.input.height/_.height;this.scaledCanvas===void 0&&(this.scaledCanvas=document.createElement("canvas"),this.scaledCanvas.width=this.spec.model.input.width,this.scaledCanvas.height=this.spec.model.input.height);const lt=this.scaledCanvas.getContext("2d");lt.save(),lt.scale(rt,ot),lt.drawImage(_,0,0),lt.restore();const st=lt.getImageData(0,0,this.scaledCanvas.width,this.scaledCanvas.height);if(this.frameNumber%this.videoFramesPerFilterUpdate===0){const at=this.mask$.whenNext();this.worker.postMessage({msg:"predict",payload:st},[st.data.buffer]),it=yield at}this.destroyed||this.drawImageWithMask(_,it)}catch(it){return this.logger.error(`could not process ${this.filterType} frame buffer due to ${it}`),$}finally{this.frameCounter.filterComplete(),this.frameNumber++}return $[0]=this.canvasVideoFrameBuffer,$})}updateVideoFramesPerFilterUpdate($){$!==this.videoFramesPerFilterUpdate&&(this.videoFramesPerFilterUpdate=$,this.logger.info(`Adjusting filter rate to compensate for CPU utilization. Filter rate is ${this.videoFramesPerFilterUpdate} video frames per filter.`))}destroy(){var $,_,tt,nt;return __awaiter$$(this,void 0,void 0,function*(){this.destroyed=!0,this.delegate.removeObserver(this.cpuMonitor),this.canvasVideoFrameBuffer.destroy(),($=this.worker)===null||$===void 0||$.postMessage({msg:"destroy"}),(_=this.worker)===null||_===void 0||_.postMessage({msg:"stop"}),(tt=this.targetCanvas)===null||tt===void 0||tt.remove(),this.targetCanvas=void 0,(nt=this.scaledCanvas)===null||nt===void 0||nt.remove(),this.scaledCanvas=void 0,this.logger.info(`${this.filterType} frame process destroyed`)})}}BackgroundFilterProcessor$1.default=BackgroundFilterProcessor;class BackgroundFilterMonitor{constructor($,_){this.monitoringPeriodMillis=$,this.observer=_,this.lastCPUChangeTimestamp=0}filterCPUUtilizationHigh(){const $=Date.now();$-this.lastCPUChangeTimestamp>=this.monitoringPeriodMillis&&(this.lastCPUChangeTimestamp=$,this.observer.reduceCPUUtilization())}frameReceived(){const $=Date.now();$-this.lastCPUChangeTimestamp>=this.monitoringPeriodMillis*2&&(this.lastCPUChangeTimestamp=$,this.observer.increaseCPUUtilization())}}BackgroundFilterProcessor$1.BackgroundFilterMonitor=BackgroundFilterMonitor;var BackgroundBlurVideoFrameProcessorDelegate$1={},BackgroundFilterVideoFrameProcessorDelegate$1={};Object.defineProperty(BackgroundFilterVideoFrameProcessorDelegate$1,"__esModule",{value:!0});class BackgroundFilterVideoFrameProcessorDelegate{constructor(){this.observers=new Set}addObserver($){this.observers.add($)}removeObserver($){this.observers.delete($)}filterFrameDurationHigh($){var _;for(const tt of this.observers)(_=tt.filterFrameDurationHigh)===null||_===void 0||_.call(tt,$)}filterCPUUtilizationHigh($){var _;for(const tt of this.observers)(_=tt.filterCPUUtilizationHigh)===null||_===void 0||_.call(tt,$)}}BackgroundFilterVideoFrameProcessorDelegate$1.default=BackgroundFilterVideoFrameProcessorDelegate;var __importDefault$1D=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(BackgroundBlurVideoFrameProcessorDelegate$1,"__esModule",{value:!0});const BackgroundFilterVideoFrameProcessorDelegate_1$1=__importDefault$1D(BackgroundFilterVideoFrameProcessorDelegate$1);class BackgroundBlurVideoFrameProcessorDelegate extends BackgroundFilterVideoFrameProcessorDelegate_1$1.default{}BackgroundBlurVideoFrameProcessorDelegate$1.default=BackgroundBlurVideoFrameProcessorDelegate;var __awaiter$_=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1C=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(BackgroundBlurProcessorProvided$1,"__esModule",{value:!0});const BackgroundFilterProcessor_1$1=__importDefault$1C(BackgroundFilterProcessor$1),BackgroundBlurStrength_1$2=BackgroundBlurStrength,BackgroundBlurVideoFrameProcessorDelegate_1=__importDefault$1C(BackgroundBlurVideoFrameProcessorDelegate$1);class BackgroundBlurProcessorProvided extends BackgroundFilterProcessor_1$1.default{constructor($,_){super("background blur",$,_,new BackgroundBlurVideoFrameProcessorDelegate_1.default),this.blurAmount=0,this.setBlurStrength(_.blurStrength),this.logger.info("BackgroundBlur processor successfully created"),this.logger.info(`BackgroundBlur spec: ${this.stringify(this.spec)}`),this.logger.info(`BackgroundBlur options: { blurStrength: ${_.blurStrength}, filterCPUUtilization: ${_.filterCPUUtilization}, reportingPeriodMillis: ${_.reportingPeriodMillis}}`)}validateOptions($){if(super.validateOptions($),!$.blurStrength)throw new Error("processor has null options - blurStrength")}initOnFirstExecution(){this.setBlurPixels()}drawImageWithMask($,_){_||(_=new ImageData(this.spec.model.input.width,this.spec.model.input.height)),this.scaledCanvas.getContext("2d").putImageData(_,0,0);const{canvasCtx:nt,targetCanvas:it}=this,{width:rt,height:ot}=it;nt.save(),nt.clearRect(0,0,rt,ot),nt.drawImage(this.scaledCanvas,0,0,rt,ot),nt.globalCompositeOperation="source-in",nt.drawImage($,0,0,rt,ot),nt.globalCompositeOperation="destination-over",nt.filter=`blur(${this.blurAmount}px)`,nt.drawImage($,0,0,it.width,it.height),nt.restore()}setBlurStrength($){this._blurStrength=$,this.logger.info(`blur strength set to ${this._blurStrength}`),this.setBlurPixels()}setBlurPixels(){this.blurAmount=BackgroundBlurStrength_1$2.BlurStrengthMapper.getBlurAmount(this._blurStrength,{height:this.sourceHeight}),this.logger.info(`background blur amount set to ${this.blurAmount}`)}addObserver($){this.delegate.addObserver($)}removeObserver($){this.delegate.removeObserver($)}static isSupported(){return __awaiter$_(this,void 0,void 0,function*(){const $=document.createElement("canvas"),_=$.getContext("2d").filter!==void 0;return $.remove(),_})}setEventController($){this.eventController?this.eventController=$:(this.eventController=$,this.publishBackgroundFilterEvent())}publishBackgroundFilterEvent(){const $={backgroundBlurEnabled:"true",backgroundBlurStrength:this._blurStrength,backgroundReplacementEnabled:"false",backgroundFilterVersion:1};this.eventController.publishEvent("backgroundFilterConfigSelected",$)}}BackgroundBlurProcessorProvided$1.default=BackgroundBlurProcessorProvided;var __awaiter$Z=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1B=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(BackgroundBlurProcessorBuiltIn$1,"__esModule",{value:!0});const BackgroundBlurProcessorProvided_1$1=__importDefault$1B(BackgroundBlurProcessorProvided$1),BackgroundBlurStrength_1$1=BackgroundBlurStrength;class BackgroundBlurProcessorBuiltIn extends BackgroundBlurProcessorProvided_1$1.default{constructor($,_){super($,_),this.blurCanvas=document.createElement("canvas"),this.blurCanvasCtx=this.blurCanvas.getContext("2d"),this.blurCanvas.width=this.spec.model.input.width,this.blurCanvas.height=this.spec.model.input.height,this.logger.info("BackgroundBlur processor using builtin blur")}drawImageWithMask($,_){const tt=this.blurredImage,{canvasCtx:nt,targetCanvas:it}=this,{width:rt,height:ot}=it;if(!_||!tt){nt.clearRect(0,0,rt,ot);return}this.scaledCanvas.getContext("2d").putImageData(_,0,0),this.blurCanvasCtx.putImageData(this.blurredImage,0,0),nt.save(),nt.clearRect(0,0,rt,ot),nt.drawImage(this.scaledCanvas,0,0,rt,ot),nt.globalCompositeOperation="source-in",nt.drawImage($,0,0,rt,ot),nt.globalCompositeOperation="destination-over",nt.drawImage(this.blurCanvas,0,0,rt,ot),nt.restore()}setBlurStrength($){if(super.setBlurStrength($),this.worker){this.modelInitialized=!1,this.worker.postMessage({msg:"destroy"});const _=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:_.path,inputHeight:_.input.height,inputWidth:_.input.width,inputChannels:4,modelRangeMin:_.input.range[0],modelRangeMax:_.input.range[1],blurPixels:this.blurAmount}})}}setBlurPixels(){this.blurAmount=BackgroundBlurStrength_1$1.BlurStrengthMapper.getBlurAmount(this._blurStrength,{height:540}),this.logger.info(`background blur amount set to ${this.blurAmount}`)}handleInitialize($){if(this.logger.info(`received initialize message: ${this.stringify($)}`),!$.payload){this.logger.error("failed to initialize module"),this.initWorkerPromise.reject(new Error("failed to initialize the module"));return}const _=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:_.path,inputHeight:_.input.height,inputWidth:_.input.width,inputChannels:4,modelRangeMin:_.input.range[0],modelRangeMax:_.input.range[1],blurPixels:this.blurAmount}}),this.initWorkerPromise.resolve({})}handlePredict($){this.blurredImage=$.payload.blurOutput,super.handlePredict($)}destroy(){const $=Object.create(null,{destroy:{get:()=>super.destroy}});var _;return __awaiter$Z(this,void 0,void 0,function*(){$.destroy.call(this),(_=this.blurCanvas)===null||_===void 0||_.remove(),this.blurCanvas=void 0})}}BackgroundBlurProcessorBuiltIn$1.default=BackgroundBlurProcessorBuiltIn;var __awaiter$Y=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1A=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(BackgroundBlurVideoFrameProcessor$1,"__esModule",{value:!0});const BackgroundFilterVideoFrameProcessor_1$1=__importDefault$1A(BackgroundFilterVideoFrameProcessor$1),ConsoleLogger_1$1=__importDefault$1A(ConsoleLogger$1),LogLevel_1$6=__importDefault$1A(LogLevel),NoOpVideoFrameProcessor_1$1=__importDefault$1A(NoOpVideoFrameProcessor$1),BackgroundBlurProcessorBuiltIn_1=__importDefault$1A(BackgroundBlurProcessorBuiltIn$1),BackgroundBlurProcessorProvided_1=__importDefault$1A(BackgroundBlurProcessorProvided$1),BackgroundBlurStrength_1=__importDefault$1A(BackgroundBlurStrength);class NoOpBackgroundBlurProcessor extends NoOpVideoFrameProcessor_1$1.default{setBlurStrength(){}loadAssets(){return __awaiter$Y(this,void 0,void 0,function*(){})}addObserver(){}removeObserver(){}}class BackgroundBlurVideoFrameProcessor extends BackgroundFilterVideoFrameProcessor_1$1.default{static create($,_){return __awaiter$Y(this,void 0,void 0,function*(){$=BackgroundBlurVideoFrameProcessor.resolveSpec($),_=BackgroundBlurVideoFrameProcessor.resolveOptions(_);const{logger:tt}=_,nt=yield BackgroundBlurVideoFrameProcessor.isSupported($,_);if(tt.info(`processor is ${nt?"":"not"} supported`),!nt)return tt.warn("Using no-op processor because background blur is not supported"),new NoOpBackgroundBlurProcessor;let it;return(yield BackgroundBlurProcessorProvided_1.default.isSupported())?(tt.info("Using browser-provided background blur"),it=new BackgroundBlurProcessorProvided_1.default($,_)):(tt.info("Using built-in background blur"),it=new BackgroundBlurProcessorBuiltIn_1.default($,_)),yield it.loadAssets(),it})}static resolveOptions($={}){let _=Object.assign({},$);return _.blurStrength||(_.blurStrength=BackgroundBlurStrength_1.default.MEDIUM),_.logger||(_.logger=new ConsoleLogger_1$1.default("BackgroundBlurProcessor",LogLevel_1$6.default.INFO)),_=super.resolveOptions(_),_}static isSupported($,_){return $=BackgroundBlurVideoFrameProcessor.resolveSpec($),_=BackgroundBlurVideoFrameProcessor.resolveOptions(_),super.isSupported($,_)}}BackgroundBlurVideoFrameProcessor$1.default=BackgroundBlurVideoFrameProcessor;var BackgroundReplacementVideoFrameProcessor$1={},BackgroundReplacementFilter$1={},BackgroundReplacementVideoFrameProcessorDelegate$1={},__importDefault$1z=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(BackgroundReplacementVideoFrameProcessorDelegate$1,"__esModule",{value:!0});const BackgroundFilterVideoFrameProcessorDelegate_1=__importDefault$1z(BackgroundFilterVideoFrameProcessorDelegate$1);class BackgroundReplacementVideoFrameProcessorDelegate extends BackgroundFilterVideoFrameProcessorDelegate_1.default{}BackgroundReplacementVideoFrameProcessorDelegate$1.default=BackgroundReplacementVideoFrameProcessorDelegate;var __awaiter$X=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1y=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(BackgroundReplacementFilter$1,"__esModule",{value:!0});const BackgroundFilterProcessor_1=__importDefault$1y(BackgroundFilterProcessor$1),BackgroundReplacementVideoFrameProcessorDelegate_1=__importDefault$1y(BackgroundReplacementVideoFrameProcessorDelegate$1);class BackgroundReplacementFilter extends BackgroundFilterProcessor_1.default{constructor($,_){super("background replacement",$,_,new BackgroundReplacementVideoFrameProcessorDelegate_1.default),this.replacementBlob=_.imageBlob,this.logger.info("BackgroundReplacement processor successfully created"),this.logger.info(`BackgroundReplacement spec: ${this.stringify(this.spec)}`),this.logger.info(`BackgroundReplacement options: { filterCPUUtilization: ${_.filterCPUUtilization}, reportingPeriodMillis: ${_.reportingPeriodMillis}}`)}setImageBlob($){return __awaiter$X(this,void 0,void 0,function*(){this.replacementBlob=$,this.replacementImage=yield BackgroundReplacementFilter.loadImage(this.createReplacementObjectUrl())})}initOnFirstExecution(){}drawImageWithMask($,_){_||(_=new ImageData(this.spec.model.input.width,this.spec.model.input.height)),this.scaledCanvas.getContext("2d").putImageData(_,0,0);const{canvasCtx:nt,targetCanvas:it}=this,{width:rt,height:ot}=it;nt.save(),nt.clearRect(0,0,rt,ot),nt.drawImage(this.scaledCanvas,0,0,rt,ot),nt.globalCompositeOperation="source-in",nt.drawImage($,0,0,rt,ot),nt.globalCompositeOperation="destination-over",nt.drawImage(this.replacementImage,0,0,it.width,it.height),nt.restore()}static loadImageExecutor($,_,tt){const nt=new Image;nt.crossOrigin="Anonymous",nt.addEventListener("load",()=>{$(nt)},!1),nt.addEventListener("error",it=>{_(new Error(`Could not load replacement image ${nt.src}: ${it.message}`))},!1),nt.src=tt}static loadImage($){return __awaiter$X(this,void 0,void 0,function*(){return new Promise((_,tt)=>this.loadImageExecutor(_,tt,$))})}revokeReplacementObjectUrl(){this.replacementObjectUrl&&URL.revokeObjectURL(this.replacementObjectUrl)}createReplacementObjectUrl(){return this.revokeReplacementObjectUrl(),this.replacementObjectUrl=URL.createObjectURL(this.replacementBlob),this.replacementObjectUrl}loadAssets(){const $=Object.create(null,{loadAssets:{get:()=>super.loadAssets}});return __awaiter$X(this,void 0,void 0,function*(){this.replacementImage=yield BackgroundReplacementFilter.loadImage(this.createReplacementObjectUrl()),$.loadAssets.call(this)})}addObserver($){this.delegate.addObserver($)}removeObserver($){this.delegate.removeObserver($)}destroy(){const $=Object.create(null,{destroy:{get:()=>super.destroy}});return __awaiter$X(this,void 0,void 0,function*(){$.destroy.call(this),this.revokeReplacementObjectUrl()})}setEventController($){this.eventController?this.eventController=$:(this.eventController=$,this.publishBackgroundFilterEvent())}publishBackgroundFilterEvent(){const $={backgroundBlurEnabled:"false",backgroundBlurStrength:"low",backgroundReplacementEnabled:"true",backgroundFilterVersion:1};this.eventController.publishEvent("backgroundFilterConfigSelected",$)}}BackgroundReplacementFilter$1.default=BackgroundReplacementFilter;var __awaiter$W=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1x=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(BackgroundReplacementVideoFrameProcessor$1,"__esModule",{value:!0});const BackgroundFilterVideoFrameProcessor_1=__importDefault$1x(BackgroundFilterVideoFrameProcessor$1),ConsoleLogger_1=__importDefault$1x(ConsoleLogger$1),LogLevel_1$5=__importDefault$1x(LogLevel),NoOpVideoFrameProcessor_1=__importDefault$1x(NoOpVideoFrameProcessor$1),BackgroundReplacementFilter_1=__importDefault$1x(BackgroundReplacementFilter$1);class NoOpBackgroundReplacementProcessor extends NoOpVideoFrameProcessor_1.default{loadAssets(){return __awaiter$W(this,void 0,void 0,function*(){})}addObserver(){}removeObserver(){}setImageBlob(){return __awaiter$W(this,void 0,void 0,function*(){})}}class BackgroundReplacementVideoFrameProcessor extends BackgroundFilterVideoFrameProcessor_1.default{static create($,_){return __awaiter$W(this,void 0,void 0,function*(){$=this.resolveSpec($),_=this.resolveOptions(_),yield this.resolveOptionsAsync(_);const{logger:tt}=_;if(!(yield BackgroundReplacementVideoFrameProcessor.isSupported($,_)))return tt.warn("Using no-op processor because background replacement is not supported"),new NoOpBackgroundReplacementProcessor;tt.info("Using background replacement filter");const it=new BackgroundReplacementFilter_1.default($,_);return yield it.loadAssets(),it})}static resolveOptions($={}){const _=Object.assign({},$);return _.logger||(_.logger=new ConsoleLogger_1.default("BackgroundReplacementProcessor",LogLevel_1$5.default.INFO)),super.resolveOptions(_)}static resolveOptionsAsync($){return __awaiter$W(this,void 0,void 0,function*(){if(!$.imageBlob){const _=document.createElement("canvas");_.width=100,_.height=100;const tt=_.getContext("2d");tt.fillStyle="blue",tt.fillRect(0,0,100,100);const nt=yield new Promise(it=>{_.toBlob(it)});$.imageBlob=nt}})}static isSupported($,_){const tt=Object.create(null,{isSupported:{get:()=>super.isSupported}});return __awaiter$W(this,void 0,void 0,function*(){$=this.resolveSpec($),_=this.resolveOptions(_),yield this.resolveOptionsAsync(_);const nt=_.imageBlob,it=URL.createObjectURL(nt);try{yield BackgroundReplacementFilter_1.default.loadImage(it)}catch(rt){return _.logger.info(`Failed to fetch load replacement image ${rt.message}`),!1}finally{URL.revokeObjectURL(it)}return tt.isSupported.call(this,$,_)})}}BackgroundReplacementVideoFrameProcessor$1.default=BackgroundReplacementVideoFrameProcessor;var BaseConnectionHealthPolicy$1={};Object.defineProperty(BaseConnectionHealthPolicy$1,"__esModule",{value:!0});class BaseConnectionHealthPolicy{constructor($,_,tt){this.minHealth=$.minHealth,this.maxHealth=$.maxHealth,this.currentHealth=$.initialHealth,this.currentData=_.clone(),this.name=tt}minimumHealth(){return this.minHealth}maximumHealth(){return this.maxHealth}health(){return this.maximumHealth()}update($){this.currentData=$}getConnectionHealthData(){return this.currentData.clone()}healthy(){return this.health()>this.minimumHealth()}healthIfChanged(){const $=this.health();return $!==this.currentHealth?(this.currentHealth=$,$):null}}BaseConnectionHealthPolicy$1.default=BaseConnectionHealthPolicy;var BitrateParameters$1={};Object.defineProperty(BitrateParameters$1,"__esModule",{value:!0});class BitrateParameters{}BitrateParameters$1.default=BitrateParameters;var CSPMonitor$1={};Object.defineProperty(CSPMonitor$1,"__esModule",{value:!0});class CSPMonitor{static register(){!("document"in window)||!document.addEventListener||CSPMonitor.shouldRegisterCSPMonitor&&(CSPMonitor.added||(document.addEventListener("securitypolicyviolation",CSPMonitor.listener),CSPMonitor.added=!0))}static unregister(){!("document"in window)||!document.removeEventListener||(document.removeEventListener("securitypolicyviolation",CSPMonitor.listener),CSPMonitor.loggers=new Set,CSPMonitor.added=!1)}static disable(){CSPMonitor.shouldRegisterCSPMonitor=!1,CSPMonitor.unregister()}static addLogger($){$&&CSPMonitor.loggers.add($)}static removeLogger($){$&&CSPMonitor.loggers.delete($)}}CSPMonitor$1.default=CSPMonitor;CSPMonitor.loggers=new Set;CSPMonitor.shouldRegisterCSPMonitor=!0;CSPMonitor.added=!1;CSPMonitor.listener=et=>{const $=`Security Policy Violation
Blocked URI: ${et.blockedURI}
Violated Directive: ${et.violatedDirective}
Original Policy: ${et.originalPolicy}
Document URI: ${et.documentURI}
Source File: ${et.sourceFile}
Line No.: ${et.lineNumber}
`;for(const _ of CSPMonitor.loggers)_.error($);CSPMonitor.loggers.size===0&&console.error($)};var CheckAudioConnectivityFeedback={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.CheckAudioConnectivityFeedback=void 0;var $;(function(_){_[_.Succeeded=0]="Succeeded",_[_.AudioInputRequestFailed=1]="AudioInputRequestFailed",_[_.AudioInputPermissionDenied=2]="AudioInputPermissionDenied",_[_.ConnectionFailed=3]="ConnectionFailed",_[_.AudioNotReceived=4]="AudioNotReceived"})($=et.CheckAudioConnectivityFeedback||(et.CheckAudioConnectivityFeedback={})),et.default=$})(CheckAudioConnectivityFeedback);var CheckAudioInputFeedback={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.CheckAudioInputFeedback=void 0;var $;(function(_){_[_.Succeeded=0]="Succeeded",_[_.Failed=1]="Failed",_[_.PermissionDenied=2]="PermissionDenied"})($=et.CheckAudioInputFeedback||(et.CheckAudioInputFeedback={})),et.default=$})(CheckAudioInputFeedback);var CheckAudioOutputFeedback={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.CheckAudioOutputFeedback=void 0;var $;(function(_){_[_.Succeeded=0]="Succeeded",_[_.Failed=1]="Failed"})($=et.CheckAudioOutputFeedback||(et.CheckAudioOutputFeedback={})),et.default=$})(CheckAudioOutputFeedback);var CheckCameraResolutionFeedback={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.CheckCameraResolutionFeedback=void 0;var $;(function(_){_[_.Succeeded=0]="Succeeded",_[_.Failed=1]="Failed",_[_.ResolutionNotSupported=2]="ResolutionNotSupported",_[_.PermissionDenied=3]="PermissionDenied"})($=et.CheckCameraResolutionFeedback||(et.CheckCameraResolutionFeedback={})),et.default=$})(CheckCameraResolutionFeedback);var CheckContentShareConnectivityFeedback={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.CheckContentShareConnectivityFeedback=void 0;var $;(function(_){_[_.Succeeded=0]="Succeeded",_[_.Failed=1]="Failed",_[_.PermissionDenied=2]="PermissionDenied",_[_.TimedOut=3]="TimedOut",_[_.ConnectionFailed=4]="ConnectionFailed"})($=et.CheckContentShareConnectivityFeedback||(et.CheckContentShareConnectivityFeedback={})),et.default=$})(CheckContentShareConnectivityFeedback);var CheckNetworkTCPConnectivityFeedback={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.CheckNetworkTCPConnectivityFeedback=void 0;var $;(function(_){_[_.Succeeded=0]="Succeeded",_[_.MeetingSessionURLsNotInitialized=1]="MeetingSessionURLsNotInitialized",_[_.ConnectionFailed=2]="ConnectionFailed",_[_.ICENegotiationFailed=3]="ICENegotiationFailed"})($=et.CheckNetworkTCPConnectivityFeedback||(et.CheckNetworkTCPConnectivityFeedback={})),et.default=$})(CheckNetworkTCPConnectivityFeedback);var CheckNetworkUDPConnectivityFeedback={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.CheckNetworkUDPConnectivityFeedback=void 0;var $;(function(_){_[_.Succeeded=0]="Succeeded",_[_.MeetingSessionURLsNotInitialized=1]="MeetingSessionURLsNotInitialized",_[_.ConnectionFailed=2]="ConnectionFailed",_[_.ICENegotiationFailed=3]="ICENegotiationFailed"})($=et.CheckNetworkUDPConnectivityFeedback||(et.CheckNetworkUDPConnectivityFeedback={})),et.default=$})(CheckNetworkUDPConnectivityFeedback);var CheckVideoConnectivityFeedback={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.CheckVideoConnectivityFeedback=void 0;var $;(function(_){_[_.Succeeded=0]="Succeeded",_[_.VideoInputRequestFailed=1]="VideoInputRequestFailed",_[_.VideoInputPermissionDenied=2]="VideoInputPermissionDenied",_[_.ConnectionFailed=3]="ConnectionFailed",_[_.VideoNotSent=4]="VideoNotSent"})($=et.CheckVideoConnectivityFeedback||(et.CheckVideoConnectivityFeedback={})),et.default=$})(CheckVideoConnectivityFeedback);var CheckVideoInputFeedback={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.CheckVideoInputFeedback=void 0;var $;(function(_){_[_.Succeeded=0]="Succeeded",_[_.Failed=1]="Failed",_[_.PermissionDenied=2]="PermissionDenied"})($=et.CheckVideoInputFeedback||(et.CheckVideoInputFeedback={})),et.default=$})(CheckVideoInputFeedback);var CleanRestartedSessionTask$1={},__awaiter$V=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1w=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(CleanRestartedSessionTask$1,"__esModule",{value:!0});const BaseTask_1$n=__importDefault$1w(BaseTask$1);class CleanRestartedSessionTask extends BaseTask_1$n.default{constructor($){super($.logger),this.context=$,this.taskName="CleanRestartedSessionTask"}run(){return __awaiter$V(this,void 0,void 0,function*(){this.context.resetConnectionSpecificState()})}}CleanRestartedSessionTask$1.default=CleanRestartedSessionTask;var CleanStoppedSessionTask$1={},SignalingClientEventType={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.SignalingClientEventType=void 0;var $;(function(_){_[_.WebSocketConnecting=0]="WebSocketConnecting",_[_.WebSocketOpen=1]="WebSocketOpen",_[_.WebSocketError=2]="WebSocketError",_[_.WebSocketClosing=3]="WebSocketClosing",_[_.WebSocketClosed=4]="WebSocketClosed",_[_.WebSocketFailed=5]="WebSocketFailed",_[_.WebSocketMessage=6]="WebSocketMessage",_[_.WebSocketSendMessageFailure=7]="WebSocketSendMessageFailure",_[_.WebSocketSentMessage=8]="WebSocketSentMessage",_[_.ProtocolDecodeFailure=9]="ProtocolDecodeFailure",_[_.ReceivedSignalFrame=10]="ReceivedSignalFrame",_[_.WebSocketSkippedMessage=11]="WebSocketSkippedMessage"})($=et.SignalingClientEventType||(et.SignalingClientEventType={})),et.default=$})(SignalingClientEventType);var __awaiter$U=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1v=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(CleanStoppedSessionTask$1,"__esModule",{value:!0});const SignalingClientEventType_1$c=__importDefault$1v(SignalingClientEventType),BaseTask_1$m=__importDefault$1v(BaseTask$1);class CleanStoppedSessionTask extends BaseTask_1$m.default{constructor($){super($.logger),this.context=$,this.taskName="CleanStoppedSessionTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$U(this,void 0,void 0,function*(){try{this.context.signalingClient.ready()&&(this.context.signalingClient.closeConnection(),yield this.receiveWebSocketClosedEvent())}catch($){throw $}finally{for(const _ of this.context.removableObservers)_.removeObserver();this.context.resetConnectionSpecificState(),this.context.statsCollector.stop(),this.context.statsCollector=null,this.context.connectionMonitor.stop(),this.context.connectionMonitor=null,this.context.videoUplinkBandwidthPolicy.setTransceiverController&&this.context.videoUplinkBandwidthPolicy.setTransceiverController(void 0),this.context.videoDownlinkBandwidthPolicy.bindToTileController&&this.context.videoDownlinkBandwidthPolicy.bindToTileController(void 0);const $=this.context.videoTileController.getLocalVideoTile();$&&$.bindVideoStream("",!0,null,null,null,null),this.context.videoTileController.removeAllVideoTiles()}})}receiveWebSocketClosedEvent(){return new Promise(($,_)=>{class tt{constructor(rt){this.signalingClient=rt}cancel(){this.signalingClient.removeObserver(this),_(new Error("CleanStoppedSessionTask got canceled while waiting for the WebSocket closed event"))}handleSignalingClientEvent(rt){rt.type===SignalingClientEventType_1$c.default.WebSocketClosed&&(this.signalingClient.removeObserver(this),$())}}const nt=new tt(this.context.signalingClient);this.taskCanceler=nt,this.context.signalingClient.registerObserver(nt)})}}CleanStoppedSessionTask$1.default=CleanStoppedSessionTask;var ClientMetricReport$1={},indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(et,$){for(var _=new Array(arguments.length-1),tt=0,nt=2,it=!0;nt<arguments.length;)_[tt++]=arguments[nt++];return new Promise(function(ot,lt){_[tt]=function(at){if(it)if(it=!1,at)lt(at);else{for(var ct=new Array(arguments.length-1),dt=0;dt<ct.length;)ct[dt++]=arguments[dt];ot.apply(null,ct)}};try{et.apply($||null,_)}catch(st){it&&(it=!1,lt(st))}})}var base64$1={};(function(et){var $=et;$.length=function(ot){var lt=ot.length;if(!lt)return 0;for(var st=0;--lt%4>1&&ot.charAt(lt)==="=";)++st;return Math.ceil(ot.length*3)/4-st};for(var _=new Array(64),tt=new Array(123),nt=0;nt<64;)tt[_[nt]=nt<26?nt+65:nt<52?nt+71:nt<62?nt-4:nt-59|43]=nt++;$.encode=function(ot,lt,st){for(var at=null,ct=[],dt=0,ut=0,ft;lt<st;){var pt=ot[lt++];switch(ut){case 0:ct[dt++]=_[pt>>2],ft=(pt&3)<<4,ut=1;break;case 1:ct[dt++]=_[ft|pt>>4],ft=(pt&15)<<2,ut=2;break;case 2:ct[dt++]=_[ft|pt>>6],ct[dt++]=_[pt&63],ut=0;break}dt>8191&&((at||(at=[])).push(String.fromCharCode.apply(String,ct)),dt=0)}return ut&&(ct[dt++]=_[ft],ct[dt++]=61,ut===1&&(ct[dt++]=61)),at?(dt&&at.push(String.fromCharCode.apply(String,ct.slice(0,dt))),at.join("")):String.fromCharCode.apply(String,ct.slice(0,dt))};var it="invalid encoding";$.decode=function(ot,lt,st){for(var at=st,ct=0,dt,ut=0;ut<ot.length;){var ft=ot.charCodeAt(ut++);if(ft===61&&ct>1)break;if((ft=tt[ft])===void 0)throw Error(it);switch(ct){case 0:dt=ft,ct=1;break;case 1:lt[st++]=dt<<2|(ft&48)>>4,dt=ft,ct=2;break;case 2:lt[st++]=(dt&15)<<4|(ft&60)>>2,dt=ft,ct=3;break;case 3:lt[st++]=(dt&3)<<6|ft,ct=0;break}}if(ct===1)throw Error(it);return st-at},$.test=function(ot){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(ot)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function($,_,tt){return(this._listeners[$]||(this._listeners[$]=[])).push({fn:_,ctx:tt||this}),this};EventEmitter.prototype.off=function($,_){if($===void 0)this._listeners={};else if(_===void 0)this._listeners[$]=[];else for(var tt=this._listeners[$],nt=0;nt<tt.length;)tt[nt].fn===_?tt.splice(nt,1):++nt;return this};EventEmitter.prototype.emit=function($){var _=this._listeners[$];if(_){for(var tt=[],nt=1;nt<arguments.length;)tt.push(arguments[nt++]);for(nt=0;nt<_.length;)_[nt].fn.apply(_[nt++].ctx,tt)}return this};var float=factory(factory);function factory(et){return typeof Float32Array<"u"?function(){var $=new Float32Array([-0]),_=new Uint8Array($.buffer),tt=_[3]===128;function nt(lt,st,at){$[0]=lt,st[at]=_[0],st[at+1]=_[1],st[at+2]=_[2],st[at+3]=_[3]}function it(lt,st,at){$[0]=lt,st[at]=_[3],st[at+1]=_[2],st[at+2]=_[1],st[at+3]=_[0]}et.writeFloatLE=tt?nt:it,et.writeFloatBE=tt?it:nt;function rt(lt,st){return _[0]=lt[st],_[1]=lt[st+1],_[2]=lt[st+2],_[3]=lt[st+3],$[0]}function ot(lt,st){return _[3]=lt[st],_[2]=lt[st+1],_[1]=lt[st+2],_[0]=lt[st+3],$[0]}et.readFloatLE=tt?rt:ot,et.readFloatBE=tt?ot:rt}():function(){function $(tt,nt,it,rt){var ot=nt<0?1:0;if(ot&&(nt=-nt),nt===0)tt(1/nt>0?0:2147483648,it,rt);else if(isNaN(nt))tt(2143289344,it,rt);else if(nt>34028234663852886e22)tt((ot<<31|2139095040)>>>0,it,rt);else if(nt<11754943508222875e-54)tt((ot<<31|Math.round(nt/1401298464324817e-60))>>>0,it,rt);else{var lt=Math.floor(Math.log(nt)/Math.LN2),st=Math.round(nt*Math.pow(2,-lt)*8388608)&8388607;tt((ot<<31|lt+127<<23|st)>>>0,it,rt)}}et.writeFloatLE=$.bind(null,writeUintLE),et.writeFloatBE=$.bind(null,writeUintBE);function _(tt,nt,it){var rt=tt(nt,it),ot=(rt>>31)*2+1,lt=rt>>>23&255,st=rt&8388607;return lt===255?st?NaN:ot*(1/0):lt===0?ot*1401298464324817e-60*st:ot*Math.pow(2,lt-150)*(st+8388608)}et.readFloatLE=_.bind(null,readUintLE),et.readFloatBE=_.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var $=new Float64Array([-0]),_=new Uint8Array($.buffer),tt=_[7]===128;function nt(lt,st,at){$[0]=lt,st[at]=_[0],st[at+1]=_[1],st[at+2]=_[2],st[at+3]=_[3],st[at+4]=_[4],st[at+5]=_[5],st[at+6]=_[6],st[at+7]=_[7]}function it(lt,st,at){$[0]=lt,st[at]=_[7],st[at+1]=_[6],st[at+2]=_[5],st[at+3]=_[4],st[at+4]=_[3],st[at+5]=_[2],st[at+6]=_[1],st[at+7]=_[0]}et.writeDoubleLE=tt?nt:it,et.writeDoubleBE=tt?it:nt;function rt(lt,st){return _[0]=lt[st],_[1]=lt[st+1],_[2]=lt[st+2],_[3]=lt[st+3],_[4]=lt[st+4],_[5]=lt[st+5],_[6]=lt[st+6],_[7]=lt[st+7],$[0]}function ot(lt,st){return _[7]=lt[st],_[6]=lt[st+1],_[5]=lt[st+2],_[4]=lt[st+3],_[3]=lt[st+4],_[2]=lt[st+5],_[1]=lt[st+6],_[0]=lt[st+7],$[0]}et.readDoubleLE=tt?rt:ot,et.readDoubleBE=tt?ot:rt}():function(){function $(tt,nt,it,rt,ot,lt){var st=rt<0?1:0;if(st&&(rt=-rt),rt===0)tt(0,ot,lt+nt),tt(1/rt>0?0:2147483648,ot,lt+it);else if(isNaN(rt))tt(0,ot,lt+nt),tt(2146959360,ot,lt+it);else if(rt>17976931348623157e292)tt(0,ot,lt+nt),tt((st<<31|2146435072)>>>0,ot,lt+it);else{var at;if(rt<22250738585072014e-324)at=rt/5e-324,tt(at>>>0,ot,lt+nt),tt((st<<31|at/4294967296)>>>0,ot,lt+it);else{var ct=Math.floor(Math.log(rt)/Math.LN2);ct===1024&&(ct=1023),at=rt*Math.pow(2,-ct),tt(at*4503599627370496>>>0,ot,lt+nt),tt((st<<31|ct+1023<<20|at*1048576&1048575)>>>0,ot,lt+it)}}}et.writeDoubleLE=$.bind(null,writeUintLE,0,4),et.writeDoubleBE=$.bind(null,writeUintBE,4,0);function _(tt,nt,it,rt,ot){var lt=tt(rt,ot+nt),st=tt(rt,ot+it),at=(st>>31)*2+1,ct=st>>>20&2047,dt=4294967296*(st&1048575)+lt;return ct===2047?dt?NaN:at*(1/0):ct===0?at*5e-324*dt:at*Math.pow(2,ct-1075)*(dt+4503599627370496)}et.readDoubleLE=_.bind(null,readUintLE,0,4),et.readDoubleBE=_.bind(null,readUintBE,4,0)}(),et}function writeUintLE(et,$,_){$[_]=et&255,$[_+1]=et>>>8&255,$[_+2]=et>>>16&255,$[_+3]=et>>>24}function writeUintBE(et,$,_){$[_]=et>>>24,$[_+1]=et>>>16&255,$[_+2]=et>>>8&255,$[_+3]=et&255}function readUintLE(et,$){return(et[$]|et[$+1]<<8|et[$+2]<<16|et[$+3]<<24)>>>0}function readUintBE(et,$){return(et[$]<<24|et[$+1]<<16|et[$+2]<<8|et[$+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(et){}return null}var utf8$2={};(function(et){var $=et;$.length=function(tt){for(var nt=0,it=0,rt=0;rt<tt.length;++rt)it=tt.charCodeAt(rt),it<128?nt+=1:it<2048?nt+=2:(it&64512)===55296&&(tt.charCodeAt(rt+1)&64512)===56320?(++rt,nt+=4):nt+=3;return nt},$.read=function(tt,nt,it){var rt=it-nt;if(rt<1)return"";for(var ot=null,lt=[],st=0,at;nt<it;)at=tt[nt++],at<128?lt[st++]=at:at>191&&at<224?lt[st++]=(at&31)<<6|tt[nt++]&63:at>239&&at<365?(at=((at&7)<<18|(tt[nt++]&63)<<12|(tt[nt++]&63)<<6|tt[nt++]&63)-65536,lt[st++]=55296+(at>>10),lt[st++]=56320+(at&1023)):lt[st++]=(at&15)<<12|(tt[nt++]&63)<<6|tt[nt++]&63,st>8191&&((ot||(ot=[])).push(String.fromCharCode.apply(String,lt)),st=0);return ot?(st&&ot.push(String.fromCharCode.apply(String,lt.slice(0,st))),ot.join("")):String.fromCharCode.apply(String,lt.slice(0,st))},$.write=function(tt,nt,it){for(var rt=it,ot,lt,st=0;st<tt.length;++st)ot=tt.charCodeAt(st),ot<128?nt[it++]=ot:ot<2048?(nt[it++]=ot>>6|192,nt[it++]=ot&63|128):(ot&64512)===55296&&((lt=tt.charCodeAt(st+1))&64512)===56320?(ot=65536+((ot&1023)<<10)+(lt&1023),++st,nt[it++]=ot>>18|240,nt[it++]=ot>>12&63|128,nt[it++]=ot>>6&63|128,nt[it++]=ot&63|128):(nt[it++]=ot>>12|224,nt[it++]=ot>>6&63|128,nt[it++]=ot&63|128);return it-rt}})(utf8$2);var pool_1=pool;function pool(et,$,_){var tt=_||8192,nt=tt>>>1,it=null,rt=tt;return function(lt){if(lt<1||lt>nt)return et(lt);rt+lt>tt&&(it=et(tt),rt=0);var st=$.call(it,rt,rt+=lt);return rt&7&&(rt=(rt|7)+1),st}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=$;var et=requireMinimal();function $(it,rt){this.lo=it>>>0,this.hi=rt>>>0}var _=$.zero=new $(0,0);_.toNumber=function(){return 0},_.zzEncode=_.zzDecode=function(){return this},_.length=function(){return 1};var tt=$.zeroHash="\0\0\0\0\0\0\0\0";$.fromNumber=function(rt){if(rt===0)return _;var ot=rt<0;ot&&(rt=-rt);var lt=rt>>>0,st=(rt-lt)/4294967296>>>0;return ot&&(st=~st>>>0,lt=~lt>>>0,++lt>4294967295&&(lt=0,++st>4294967295&&(st=0))),new $(lt,st)},$.from=function(rt){if(typeof rt=="number")return $.fromNumber(rt);if(et.isString(rt))if(et.Long)rt=et.Long.fromString(rt);else return $.fromNumber(parseInt(rt,10));return rt.low||rt.high?new $(rt.low>>>0,rt.high>>>0):_},$.prototype.toNumber=function(rt){if(!rt&&this.hi>>>31){var ot=~this.lo+1>>>0,lt=~this.hi>>>0;return ot||(lt=lt+1>>>0),-(ot+lt*4294967296)}return this.lo+this.hi*4294967296},$.prototype.toLong=function(rt){return et.Long?new et.Long(this.lo|0,this.hi|0,!!rt):{low:this.lo|0,high:this.hi|0,unsigned:!!rt}};var nt=String.prototype.charCodeAt;return $.fromHash=function(rt){return rt===tt?_:new $((nt.call(rt,0)|nt.call(rt,1)<<8|nt.call(rt,2)<<16|nt.call(rt,3)<<24)>>>0,(nt.call(rt,4)|nt.call(rt,5)<<8|nt.call(rt,6)<<16|nt.call(rt,7)<<24)>>>0)},$.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},$.prototype.zzEncode=function(){var rt=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^rt)>>>0,this.lo=(this.lo<<1^rt)>>>0,this},$.prototype.zzDecode=function(){var rt=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^rt)>>>0,this.hi=(this.hi>>>1^rt)>>>0,this},$.prototype.length=function(){var rt=this.lo,ot=(this.lo>>>28|this.hi<<4)>>>0,lt=this.hi>>>24;return lt===0?ot===0?rt<16384?rt<128?1:2:rt<2097152?3:4:ot<16384?ot<128?5:6:ot<2097152?7:8:lt<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(et){var $=et;$.asPromise=aspromise,$.base64=base64$1,$.EventEmitter=eventemitter,$.float=float,$.inquire=inquire_1,$.utf8=utf8$2,$.pool=pool_1,$.LongBits=requireLongbits(),$.isNode=!!(typeof window<"u"&&window&&window.process&&window.process.versions&&window.process.versions.node),$.global=$.isNode&&window||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,$.emptyArray=Object.freeze?Object.freeze([]):[],$.emptyObject=Object.freeze?Object.freeze({}):{},$.isInteger=Number.isInteger||function(it){return typeof it=="number"&&isFinite(it)&&Math.floor(it)===it},$.isString=function(it){return typeof it=="string"||it instanceof String},$.isObject=function(it){return it&&typeof it=="object"},$.isset=$.isSet=function(it,rt){var ot=it[rt];return ot!=null&&it.hasOwnProperty(rt)?typeof ot!="object"||(Array.isArray(ot)?ot.length:Object.keys(ot).length)>0:!1},$.Buffer=function(){try{var nt=$.inquire("buffer").Buffer;return nt.prototype.utf8Write?nt:null}catch{return null}}(),$._Buffer_from=null,$._Buffer_allocUnsafe=null,$.newBuffer=function(it){return typeof it=="number"?$.Buffer?$._Buffer_allocUnsafe(it):new $.Array(it):$.Buffer?$._Buffer_from(it):typeof Uint8Array>"u"?it:new Uint8Array(it)},$.Array=typeof Uint8Array<"u"?Uint8Array:Array,$.Long=$.global.dcodeIO&&$.global.dcodeIO.Long||$.global.Long||$.inquire("long"),$.key2Re=/^true|false|0|1$/,$.key32Re=/^-?(?:0|[1-9][0-9]*)$/,$.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,$.longToHash=function(it){return it?$.LongBits.from(it).toHash():$.LongBits.zeroHash},$.longFromHash=function(it,rt){var ot=$.LongBits.fromHash(it);return $.Long?$.Long.fromBits(ot.lo,ot.hi,rt):ot.toNumber(!!rt)};function _(nt,it,rt){for(var ot=Object.keys(it),lt=0;lt<ot.length;++lt)(nt[ot[lt]]===void 0||!rt)&&(nt[ot[lt]]=it[ot[lt]]);return nt}$.merge=_,$.lcFirst=function(it){return it.charAt(0).toLowerCase()+it.substring(1)};function tt(nt){function it(rt,ot){if(!(this instanceof it))return new it(rt,ot);Object.defineProperty(this,"message",{get:function(){return rt}}),Error.captureStackTrace?Error.captureStackTrace(this,it):Object.defineProperty(this,"stack",{value:new Error().stack||""}),ot&&_(this,ot)}return it.prototype=Object.create(Error.prototype,{constructor:{value:it,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return nt},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),it}$.newError=tt,$.ProtocolError=tt("ProtocolError"),$.oneOfGetter=function(it){for(var rt={},ot=0;ot<it.length;++ot)rt[it[ot]]=1;return function(){for(var lt=Object.keys(this),st=lt.length-1;st>-1;--st)if(rt[lt[st]]===1&&this[lt[st]]!==void 0&&this[lt[st]]!==null)return lt[st]}},$.oneOfSetter=function(it){return function(rt){for(var ot=0;ot<it.length;++ot)it[ot]!==rt&&delete this[it[ot]]}},$.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},$._configure=function(){var nt=$.Buffer;if(!nt){$._Buffer_from=$._Buffer_allocUnsafe=null;return}$._Buffer_from=nt.from!==Uint8Array.from&&nt.from||function(rt,ot){return new nt(rt,ot)},$._Buffer_allocUnsafe=nt.allocUnsafe||function(rt){return new nt(rt)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(et,$,_){this.fn=et,this.len=$,this.next=void 0,this.val=_}function noop(){}function State(et){this.head=et.head,this.tail=et.tail,this.len=et.len,this.next=et.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function et(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function et($){return new util$4.Array($)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function et($,_,tt){return this.tail=this.tail.next=new Op($,_,tt),this.len+=_,this};function writeByte(et,$,_){$[_]=et&255}function writeVarint32(et,$,_){for(;et>127;)$[_++]=et&127|128,et>>>=7;$[_]=et}function VarintOp(et,$){this.len=et,this.next=void 0,this.val=$}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function et($){return this.len+=(this.tail=this.tail.next=new VarintOp(($=$>>>0)<128?1:$<16384?2:$<2097152?3:$<268435456?4:5,$)).len,this};Writer$1.prototype.int32=function et($){return $<0?this._push(writeVarint64,10,LongBits$1.fromNumber($)):this.uint32($)};Writer$1.prototype.sint32=function et($){return this.uint32(($<<1^$>>31)>>>0)};function writeVarint64(et,$,_){for(;et.hi;)$[_++]=et.lo&127|128,et.lo=(et.lo>>>7|et.hi<<25)>>>0,et.hi>>>=7;for(;et.lo>127;)$[_++]=et.lo&127|128,et.lo=et.lo>>>7;$[_++]=et.lo}Writer$1.prototype.uint64=function et($){var _=LongBits$1.from($);return this._push(writeVarint64,_.length(),_)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function et($){var _=LongBits$1.from($).zzEncode();return this._push(writeVarint64,_.length(),_)};Writer$1.prototype.bool=function et($){return this._push(writeByte,1,$?1:0)};function writeFixed32(et,$,_){$[_]=et&255,$[_+1]=et>>>8&255,$[_+2]=et>>>16&255,$[_+3]=et>>>24}Writer$1.prototype.fixed32=function et($){return this._push(writeFixed32,4,$>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function et($){var _=LongBits$1.from($);return this._push(writeFixed32,4,_.lo)._push(writeFixed32,4,_.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function et($){return this._push(util$4.float.writeFloatLE,4,$)};Writer$1.prototype.double=function et($){return this._push(util$4.float.writeDoubleLE,8,$)};var writeBytes=util$4.Array.prototype.set?function et($,_,tt){_.set($,tt)}:function et($,_,tt){for(var nt=0;nt<$.length;++nt)_[tt+nt]=$[nt]};Writer$1.prototype.bytes=function et($){var _=$.length>>>0;if(!_)return this._push(writeByte,1,0);if(util$4.isString($)){var tt=Writer$1.alloc(_=base64.length($));base64.decode($,tt,0),$=tt}return this.uint32(_)._push(writeBytes,_,$)};Writer$1.prototype.string=function et($){var _=utf8$1.length($);return _?this.uint32(_)._push(utf8$1.write,_,$):this._push(writeByte,1,0)};Writer$1.prototype.fork=function et(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function et(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function et(){var $=this.head,_=this.tail,tt=this.len;return this.reset().uint32(tt),tt&&(this.tail.next=$.next,this.tail=_,this.len+=tt),this};Writer$1.prototype.finish=function et(){for(var $=this.head.next,_=this.constructor.alloc(this.len),tt=0;$;)$.fn($.val,_,tt),tt+=$.len,$=$.next;return _};Writer$1._configure=function(et){BufferWriter$1=et,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function($,_,tt){_.set($,tt)}:function($,_,tt){if($.copy)$.copy(_,tt,0,$.length);else for(var nt=0;nt<$.length;)_[tt++]=$[nt++]}};BufferWriter.prototype.bytes=function et($){util$3.isString($)&&($=util$3._Buffer_from($,"base64"));var _=$.length>>>0;return this.uint32(_),_&&this._push(BufferWriter.writeBytesBuffer,_,$),this};function writeStringBuffer(et,$,_){et.length<40?util$3.utf8.write(et,$,_):$.utf8Write?$.utf8Write(et,_):$.write(et,_)}BufferWriter.prototype.string=function et($){var _=util$3.Buffer.byteLength($);return this.uint32(_),_&&this._push(writeStringBuffer,_,$),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(et,$){return RangeError("index out of range: "+et.pos+" + "+($||1)+" > "+et.len)}function Reader$1(et){this.buf=et,this.pos=0,this.len=et.length}var create_array=typeof Uint8Array<"u"?function et($){if($ instanceof Uint8Array||Array.isArray($))return new Reader$1($);throw Error("illegal buffer")}:function et($){if(Array.isArray($))return new Reader$1($);throw Error("illegal buffer")},create=function et(){return util$2.Buffer?function(_){return(Reader$1.create=function(nt){return util$2.Buffer.isBuffer(nt)?new BufferReader$1(nt):create_array(nt)})(_)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function et(){var $=4294967295;return function(){if($=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||($=($|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||($=($|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||($=($|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||($=($|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return $;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return $}}();Reader$1.prototype.int32=function et(){return this.uint32()|0};Reader$1.prototype.sint32=function et(){var $=this.uint32();return $>>>1^-($&1)|0};function readLongVarint(){var et=new LongBits(0,0),$=0;if(this.len-this.pos>4){for(;$<4;++$)if(et.lo=(et.lo|(this.buf[this.pos]&127)<<$*7)>>>0,this.buf[this.pos++]<128)return et;if(et.lo=(et.lo|(this.buf[this.pos]&127)<<28)>>>0,et.hi=(et.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return et;$=0}else{for(;$<3;++$){if(this.pos>=this.len)throw indexOutOfRange(this);if(et.lo=(et.lo|(this.buf[this.pos]&127)<<$*7)>>>0,this.buf[this.pos++]<128)return et}return et.lo=(et.lo|(this.buf[this.pos++]&127)<<$*7)>>>0,et}if(this.len-this.pos>4){for(;$<5;++$)if(et.hi=(et.hi|(this.buf[this.pos]&127)<<$*7+3)>>>0,this.buf[this.pos++]<128)return et}else for(;$<5;++$){if(this.pos>=this.len)throw indexOutOfRange(this);if(et.hi=(et.hi|(this.buf[this.pos]&127)<<$*7+3)>>>0,this.buf[this.pos++]<128)return et}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function et(){return this.uint32()!==0};function readFixed32_end(et,$){return(et[$-4]|et[$-3]<<8|et[$-2]<<16|et[$-1]<<24)>>>0}Reader$1.prototype.fixed32=function et(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function et(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function et(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var $=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,$};Reader$1.prototype.double=function et(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var $=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,$};Reader$1.prototype.bytes=function et(){var $=this.uint32(),_=this.pos,tt=this.pos+$;if(tt>this.len)throw indexOutOfRange(this,$);if(this.pos+=$,Array.isArray(this.buf))return this.buf.slice(_,tt);if(_===tt){var nt=util$2.Buffer;return nt?nt.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,_,tt)};Reader$1.prototype.string=function et(){var $=this.bytes();return utf8.read($,0,$.length)};Reader$1.prototype.skip=function et($){if(typeof $=="number"){if(this.pos+$>this.len)throw indexOutOfRange(this,$);this.pos+=$}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(et){switch(et){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(et=this.uint32()&7)!==4;)this.skipType(et);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+et+" at offset "+this.pos)}return this};Reader$1._configure=function(et){BufferReader$1=et,Reader$1.create=create(),BufferReader$1._configure();var $=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[$](!1)},uint64:function(){return readLongVarint.call(this)[$](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[$](!1)},fixed64:function(){return readFixed64.call(this)[$](!0)},sfixed64:function(){return readFixed64.call(this)[$](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(et){Reader.call(this,et)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function et(){var $=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+$,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+$,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(et,$,_){if(typeof et!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=et,this.requestDelimited=!!$,this.responseDelimited=!!_}Service.prototype.rpcCall=function et($,_,tt,nt,it){if(!nt)throw TypeError("request must be specified");var rt=this;if(!it)return util.asPromise(et,rt,$,_,tt,nt);if(!rt.rpcImpl){setTimeout(function(){it(Error("already ended"))},0);return}try{return rt.rpcImpl($,_[rt.requestDelimited?"encodeDelimited":"encode"](nt).finish(),function(lt,st){if(lt)return rt.emit("error",lt,$),it(lt);if(st===null){rt.end(!0);return}if(!(st instanceof tt))try{st=tt[rt.responseDelimited?"decodeDelimited":"decode"](st)}catch(at){return rt.emit("error",at,$),it(at)}return rt.emit("data",st,$),it(null,st)})}catch(ot){rt.emit("error",ot,$),setTimeout(function(){it(ot)},0);return}};Service.prototype.end=function et($){return this.rpcImpl&&($||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(et){var $=et;$.Service=service})(rpc);var roots={};(function(et){var $=et;$.build="minimal",$.Writer=writer,$.BufferWriter=writer_buffer,$.Reader=reader,$.BufferReader=reader_buffer,$.util=requireMinimal(),$.rpc=rpc,$.roots=roots,$.configure=_;function _(){$.util._configure(),$.Writer._configure($.BufferWriter),$.Reader._configure($.BufferReader)}_()})(indexMinimal);var minimal=indexMinimal,$protobuf=minimal,$Reader=$protobuf.Reader,$Writer=$protobuf.Writer,$util=$protobuf.util,$root=$protobuf.roots.default||($protobuf.roots.default={});$root.SdkSignalFrame=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.timestampMs=$util.Long?$util.Long.fromBits(0,0,!0):0,et.prototype.type=1,et.prototype.error=null,et.prototype.join=null,et.prototype.joinack=null,et.prototype.sub=null,et.prototype.suback=null,et.prototype.index=null,et.prototype.pause=null,et.prototype.leave=null,et.prototype.leaveAck=null,et.prototype.bitrates=null,et.prototype.audioControl=null,et.prototype.audioMetadata=null,et.prototype.audioStreamIdInfo=null,et.prototype.pingPong=null,et.prototype.audioStatus=null,et.prototype.clientMetric=null,et.prototype.dataMessage=null,et.prototype.remoteVideoUpdate=null,et.prototype.primaryMeetingJoin=null,et.prototype.primaryMeetingJoinAck=null,et.prototype.primaryMeetingLeave=null,et.prototype.notification=null,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),tt.uint32(8).uint64(_.timestampMs),tt.uint32(16).int32(_.type),_.error!=null&&Object.hasOwnProperty.call(_,"error")&&$root.SdkErrorFrame.encode(_.error,tt.uint32(26).fork()).ldelim(),_.join!=null&&Object.hasOwnProperty.call(_,"join")&&$root.SdkJoinFrame.encode(_.join,tt.uint32(34).fork()).ldelim(),_.joinack!=null&&Object.hasOwnProperty.call(_,"joinack")&&$root.SdkJoinAckFrame.encode(_.joinack,tt.uint32(42).fork()).ldelim(),_.sub!=null&&Object.hasOwnProperty.call(_,"sub")&&$root.SdkSubscribeFrame.encode(_.sub,tt.uint32(50).fork()).ldelim(),_.suback!=null&&Object.hasOwnProperty.call(_,"suback")&&$root.SdkSubscribeAckFrame.encode(_.suback,tt.uint32(58).fork()).ldelim(),_.index!=null&&Object.hasOwnProperty.call(_,"index")&&$root.SdkIndexFrame.encode(_.index,tt.uint32(66).fork()).ldelim(),_.pause!=null&&Object.hasOwnProperty.call(_,"pause")&&$root.SdkPauseResumeFrame.encode(_.pause,tt.uint32(82).fork()).ldelim(),_.leave!=null&&Object.hasOwnProperty.call(_,"leave")&&$root.SdkLeaveFrame.encode(_.leave,tt.uint32(90).fork()).ldelim(),_.leaveAck!=null&&Object.hasOwnProperty.call(_,"leaveAck")&&$root.SdkLeaveAckFrame.encode(_.leaveAck,tt.uint32(98).fork()).ldelim(),_.bitrates!=null&&Object.hasOwnProperty.call(_,"bitrates")&&$root.SdkBitrateFrame.encode(_.bitrates,tt.uint32(114).fork()).ldelim(),_.audioControl!=null&&Object.hasOwnProperty.call(_,"audioControl")&&$root.SdkAudioControlFrame.encode(_.audioControl,tt.uint32(138).fork()).ldelim(),_.audioMetadata!=null&&Object.hasOwnProperty.call(_,"audioMetadata")&&$root.SdkAudioMetadataFrame.encode(_.audioMetadata,tt.uint32(146).fork()).ldelim(),_.audioStreamIdInfo!=null&&Object.hasOwnProperty.call(_,"audioStreamIdInfo")&&$root.SdkAudioStreamIdInfoFrame.encode(_.audioStreamIdInfo,tt.uint32(154).fork()).ldelim(),_.pingPong!=null&&Object.hasOwnProperty.call(_,"pingPong")&&$root.SdkPingPongFrame.encode(_.pingPong,tt.uint32(162).fork()).ldelim(),_.audioStatus!=null&&Object.hasOwnProperty.call(_,"audioStatus")&&$root.SdkAudioStatusFrame.encode(_.audioStatus,tt.uint32(170).fork()).ldelim(),_.clientMetric!=null&&Object.hasOwnProperty.call(_,"clientMetric")&&$root.SdkClientMetricFrame.encode(_.clientMetric,tt.uint32(178).fork()).ldelim(),_.dataMessage!=null&&Object.hasOwnProperty.call(_,"dataMessage")&&$root.SdkDataMessageFrame.encode(_.dataMessage,tt.uint32(186).fork()).ldelim(),_.remoteVideoUpdate!=null&&Object.hasOwnProperty.call(_,"remoteVideoUpdate")&&$root.SdkRemoteVideoUpdateFrame.encode(_.remoteVideoUpdate,tt.uint32(202).fork()).ldelim(),_.primaryMeetingJoin!=null&&Object.hasOwnProperty.call(_,"primaryMeetingJoin")&&$root.SdkPrimaryMeetingJoinFrame.encode(_.primaryMeetingJoin,tt.uint32(210).fork()).ldelim(),_.primaryMeetingJoinAck!=null&&Object.hasOwnProperty.call(_,"primaryMeetingJoinAck")&&$root.SdkPrimaryMeetingJoinAckFrame.encode(_.primaryMeetingJoinAck,tt.uint32(218).fork()).ldelim(),_.primaryMeetingLeave!=null&&Object.hasOwnProperty.call(_,"primaryMeetingLeave")&&$root.SdkPrimaryMeetingLeaveFrame.encode(_.primaryMeetingLeave,tt.uint32(226).fork()).ldelim(),_.notification!=null&&Object.hasOwnProperty.call(_,"notification")&&$root.SdkNotificationFrame.encode(_.notification,tt.uint32(282).fork()).ldelim(),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkSignalFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.timestampMs=_.uint64();break}case 2:{it.type=_.int32();break}case 3:{it.error=$root.SdkErrorFrame.decode(_,_.uint32());break}case 4:{it.join=$root.SdkJoinFrame.decode(_,_.uint32());break}case 5:{it.joinack=$root.SdkJoinAckFrame.decode(_,_.uint32());break}case 6:{it.sub=$root.SdkSubscribeFrame.decode(_,_.uint32());break}case 7:{it.suback=$root.SdkSubscribeAckFrame.decode(_,_.uint32());break}case 8:{it.index=$root.SdkIndexFrame.decode(_,_.uint32());break}case 10:{it.pause=$root.SdkPauseResumeFrame.decode(_,_.uint32());break}case 11:{it.leave=$root.SdkLeaveFrame.decode(_,_.uint32());break}case 12:{it.leaveAck=$root.SdkLeaveAckFrame.decode(_,_.uint32());break}case 14:{it.bitrates=$root.SdkBitrateFrame.decode(_,_.uint32());break}case 17:{it.audioControl=$root.SdkAudioControlFrame.decode(_,_.uint32());break}case 18:{it.audioMetadata=$root.SdkAudioMetadataFrame.decode(_,_.uint32());break}case 19:{it.audioStreamIdInfo=$root.SdkAudioStreamIdInfoFrame.decode(_,_.uint32());break}case 20:{it.pingPong=$root.SdkPingPongFrame.decode(_,_.uint32());break}case 21:{it.audioStatus=$root.SdkAudioStatusFrame.decode(_,_.uint32());break}case 22:{it.clientMetric=$root.SdkClientMetricFrame.decode(_,_.uint32());break}case 23:{it.dataMessage=$root.SdkDataMessageFrame.decode(_,_.uint32());break}case 25:{it.remoteVideoUpdate=$root.SdkRemoteVideoUpdateFrame.decode(_,_.uint32());break}case 26:{it.primaryMeetingJoin=$root.SdkPrimaryMeetingJoinFrame.decode(_,_.uint32());break}case 27:{it.primaryMeetingJoinAck=$root.SdkPrimaryMeetingJoinAckFrame.decode(_,_.uint32());break}case 28:{it.primaryMeetingLeave=$root.SdkPrimaryMeetingLeaveFrame.decode(_,_.uint32());break}case 35:{it.notification=$root.SdkNotificationFrame.decode(_,_.uint32());break}default:_.skipType(rt&7);break}}if(!it.hasOwnProperty("timestampMs"))throw $util.ProtocolError("missing required 'timestampMs'",{instance:it});if(!it.hasOwnProperty("type"))throw $util.ProtocolError("missing required 'type'",{instance:it});return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(!$util.isInteger(_.timestampMs)&&!(_.timestampMs&&$util.isInteger(_.timestampMs.low)&&$util.isInteger(_.timestampMs.high)))return"timestampMs: integer|Long expected";switch(_.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:case 7:case 8:case 9:case 10:case 13:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 24:case 25:case 26:case 27:case 34:break}if(_.error!=null&&_.hasOwnProperty("error")){var tt=$root.SdkErrorFrame.verify(_.error);if(tt)return"error."+tt}if(_.join!=null&&_.hasOwnProperty("join")){var tt=$root.SdkJoinFrame.verify(_.join);if(tt)return"join."+tt}if(_.joinack!=null&&_.hasOwnProperty("joinack")){var tt=$root.SdkJoinAckFrame.verify(_.joinack);if(tt)return"joinack."+tt}if(_.sub!=null&&_.hasOwnProperty("sub")){var tt=$root.SdkSubscribeFrame.verify(_.sub);if(tt)return"sub."+tt}if(_.suback!=null&&_.hasOwnProperty("suback")){var tt=$root.SdkSubscribeAckFrame.verify(_.suback);if(tt)return"suback."+tt}if(_.index!=null&&_.hasOwnProperty("index")){var tt=$root.SdkIndexFrame.verify(_.index);if(tt)return"index."+tt}if(_.pause!=null&&_.hasOwnProperty("pause")){var tt=$root.SdkPauseResumeFrame.verify(_.pause);if(tt)return"pause."+tt}if(_.leave!=null&&_.hasOwnProperty("leave")){var tt=$root.SdkLeaveFrame.verify(_.leave);if(tt)return"leave."+tt}if(_.leaveAck!=null&&_.hasOwnProperty("leaveAck")){var tt=$root.SdkLeaveAckFrame.verify(_.leaveAck);if(tt)return"leaveAck."+tt}if(_.bitrates!=null&&_.hasOwnProperty("bitrates")){var tt=$root.SdkBitrateFrame.verify(_.bitrates);if(tt)return"bitrates."+tt}if(_.audioControl!=null&&_.hasOwnProperty("audioControl")){var tt=$root.SdkAudioControlFrame.verify(_.audioControl);if(tt)return"audioControl."+tt}if(_.audioMetadata!=null&&_.hasOwnProperty("audioMetadata")){var tt=$root.SdkAudioMetadataFrame.verify(_.audioMetadata);if(tt)return"audioMetadata."+tt}if(_.audioStreamIdInfo!=null&&_.hasOwnProperty("audioStreamIdInfo")){var tt=$root.SdkAudioStreamIdInfoFrame.verify(_.audioStreamIdInfo);if(tt)return"audioStreamIdInfo."+tt}if(_.pingPong!=null&&_.hasOwnProperty("pingPong")){var tt=$root.SdkPingPongFrame.verify(_.pingPong);if(tt)return"pingPong."+tt}if(_.audioStatus!=null&&_.hasOwnProperty("audioStatus")){var tt=$root.SdkAudioStatusFrame.verify(_.audioStatus);if(tt)return"audioStatus."+tt}if(_.clientMetric!=null&&_.hasOwnProperty("clientMetric")){var tt=$root.SdkClientMetricFrame.verify(_.clientMetric);if(tt)return"clientMetric."+tt}if(_.dataMessage!=null&&_.hasOwnProperty("dataMessage")){var tt=$root.SdkDataMessageFrame.verify(_.dataMessage);if(tt)return"dataMessage."+tt}if(_.remoteVideoUpdate!=null&&_.hasOwnProperty("remoteVideoUpdate")){var tt=$root.SdkRemoteVideoUpdateFrame.verify(_.remoteVideoUpdate);if(tt)return"remoteVideoUpdate."+tt}if(_.primaryMeetingJoin!=null&&_.hasOwnProperty("primaryMeetingJoin")){var tt=$root.SdkPrimaryMeetingJoinFrame.verify(_.primaryMeetingJoin);if(tt)return"primaryMeetingJoin."+tt}if(_.primaryMeetingJoinAck!=null&&_.hasOwnProperty("primaryMeetingJoinAck")){var tt=$root.SdkPrimaryMeetingJoinAckFrame.verify(_.primaryMeetingJoinAck);if(tt)return"primaryMeetingJoinAck."+tt}if(_.primaryMeetingLeave!=null&&_.hasOwnProperty("primaryMeetingLeave")){var tt=$root.SdkPrimaryMeetingLeaveFrame.verify(_.primaryMeetingLeave);if(tt)return"primaryMeetingLeave."+tt}if(_.notification!=null&&_.hasOwnProperty("notification")){var tt=$root.SdkNotificationFrame.verify(_.notification);if(tt)return"notification."+tt}return null},et.fromObject=function(_){if(_ instanceof $root.SdkSignalFrame)return _;var tt=new $root.SdkSignalFrame;switch(_.timestampMs!=null&&($util.Long?(tt.timestampMs=$util.Long.fromValue(_.timestampMs)).unsigned=!0:typeof _.timestampMs=="string"?tt.timestampMs=parseInt(_.timestampMs,10):typeof _.timestampMs=="number"?tt.timestampMs=_.timestampMs:typeof _.timestampMs=="object"&&(tt.timestampMs=new $util.LongBits(_.timestampMs.low>>>0,_.timestampMs.high>>>0).toNumber(!0))),_.type){default:if(typeof _.type=="number"){tt.type=_.type;break}break;case"JOIN":case 1:tt.type=1;break;case"JOIN_ACK":case 2:tt.type=2;break;case"SUBSCRIBE":case 3:tt.type=3;break;case"SUBSCRIBE_ACK":case 4:tt.type=4;break;case"INDEX":case 5:tt.type=5;break;case"PAUSE":case 7:tt.type=7;break;case"RESUME":case 8:tt.type=8;break;case"LEAVE":case 9:tt.type=9;break;case"LEAVE_ACK":case 10:tt.type=10;break;case"BITRATES":case 13:tt.type=13;break;case"AUDIO_CONTROL":case 16:tt.type=16;break;case"AUDIO_METADATA":case 17:tt.type=17;break;case"AUDIO_STREAM_ID_INFO":case 18:tt.type=18;break;case"PING_PONG":case 19:tt.type=19;break;case"AUDIO_STATUS":case 20:tt.type=20;break;case"CLIENT_METRIC":case 21:tt.type=21;break;case"DATA_MESSAGE":case 22:tt.type=22;break;case"REMOTE_VIDEO_UPDATE":case 24:tt.type=24;break;case"PRIMARY_MEETING_JOIN":case 25:tt.type=25;break;case"PRIMARY_MEETING_JOIN_ACK":case 26:tt.type=26;break;case"PRIMARY_MEETING_LEAVE":case 27:tt.type=27;break;case"NOTIFICATION":case 34:tt.type=34;break}if(_.error!=null){if(typeof _.error!="object")throw TypeError(".SdkSignalFrame.error: object expected");tt.error=$root.SdkErrorFrame.fromObject(_.error)}if(_.join!=null){if(typeof _.join!="object")throw TypeError(".SdkSignalFrame.join: object expected");tt.join=$root.SdkJoinFrame.fromObject(_.join)}if(_.joinack!=null){if(typeof _.joinack!="object")throw TypeError(".SdkSignalFrame.joinack: object expected");tt.joinack=$root.SdkJoinAckFrame.fromObject(_.joinack)}if(_.sub!=null){if(typeof _.sub!="object")throw TypeError(".SdkSignalFrame.sub: object expected");tt.sub=$root.SdkSubscribeFrame.fromObject(_.sub)}if(_.suback!=null){if(typeof _.suback!="object")throw TypeError(".SdkSignalFrame.suback: object expected");tt.suback=$root.SdkSubscribeAckFrame.fromObject(_.suback)}if(_.index!=null){if(typeof _.index!="object")throw TypeError(".SdkSignalFrame.index: object expected");tt.index=$root.SdkIndexFrame.fromObject(_.index)}if(_.pause!=null){if(typeof _.pause!="object")throw TypeError(".SdkSignalFrame.pause: object expected");tt.pause=$root.SdkPauseResumeFrame.fromObject(_.pause)}if(_.leave!=null){if(typeof _.leave!="object")throw TypeError(".SdkSignalFrame.leave: object expected");tt.leave=$root.SdkLeaveFrame.fromObject(_.leave)}if(_.leaveAck!=null){if(typeof _.leaveAck!="object")throw TypeError(".SdkSignalFrame.leaveAck: object expected");tt.leaveAck=$root.SdkLeaveAckFrame.fromObject(_.leaveAck)}if(_.bitrates!=null){if(typeof _.bitrates!="object")throw TypeError(".SdkSignalFrame.bitrates: object expected");tt.bitrates=$root.SdkBitrateFrame.fromObject(_.bitrates)}if(_.audioControl!=null){if(typeof _.audioControl!="object")throw TypeError(".SdkSignalFrame.audioControl: object expected");tt.audioControl=$root.SdkAudioControlFrame.fromObject(_.audioControl)}if(_.audioMetadata!=null){if(typeof _.audioMetadata!="object")throw TypeError(".SdkSignalFrame.audioMetadata: object expected");tt.audioMetadata=$root.SdkAudioMetadataFrame.fromObject(_.audioMetadata)}if(_.audioStreamIdInfo!=null){if(typeof _.audioStreamIdInfo!="object")throw TypeError(".SdkSignalFrame.audioStreamIdInfo: object expected");tt.audioStreamIdInfo=$root.SdkAudioStreamIdInfoFrame.fromObject(_.audioStreamIdInfo)}if(_.pingPong!=null){if(typeof _.pingPong!="object")throw TypeError(".SdkSignalFrame.pingPong: object expected");tt.pingPong=$root.SdkPingPongFrame.fromObject(_.pingPong)}if(_.audioStatus!=null){if(typeof _.audioStatus!="object")throw TypeError(".SdkSignalFrame.audioStatus: object expected");tt.audioStatus=$root.SdkAudioStatusFrame.fromObject(_.audioStatus)}if(_.clientMetric!=null){if(typeof _.clientMetric!="object")throw TypeError(".SdkSignalFrame.clientMetric: object expected");tt.clientMetric=$root.SdkClientMetricFrame.fromObject(_.clientMetric)}if(_.dataMessage!=null){if(typeof _.dataMessage!="object")throw TypeError(".SdkSignalFrame.dataMessage: object expected");tt.dataMessage=$root.SdkDataMessageFrame.fromObject(_.dataMessage)}if(_.remoteVideoUpdate!=null){if(typeof _.remoteVideoUpdate!="object")throw TypeError(".SdkSignalFrame.remoteVideoUpdate: object expected");tt.remoteVideoUpdate=$root.SdkRemoteVideoUpdateFrame.fromObject(_.remoteVideoUpdate)}if(_.primaryMeetingJoin!=null){if(typeof _.primaryMeetingJoin!="object")throw TypeError(".SdkSignalFrame.primaryMeetingJoin: object expected");tt.primaryMeetingJoin=$root.SdkPrimaryMeetingJoinFrame.fromObject(_.primaryMeetingJoin)}if(_.primaryMeetingJoinAck!=null){if(typeof _.primaryMeetingJoinAck!="object")throw TypeError(".SdkSignalFrame.primaryMeetingJoinAck: object expected");tt.primaryMeetingJoinAck=$root.SdkPrimaryMeetingJoinAckFrame.fromObject(_.primaryMeetingJoinAck)}if(_.primaryMeetingLeave!=null){if(typeof _.primaryMeetingLeave!="object")throw TypeError(".SdkSignalFrame.primaryMeetingLeave: object expected");tt.primaryMeetingLeave=$root.SdkPrimaryMeetingLeaveFrame.fromObject(_.primaryMeetingLeave)}if(_.notification!=null){if(typeof _.notification!="object")throw TypeError(".SdkSignalFrame.notification: object expected");tt.notification=$root.SdkNotificationFrame.fromObject(_.notification)}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if(tt.defaults){if($util.Long){var it=new $util.Long(0,0,!0);nt.timestampMs=tt.longs===String?it.toString():tt.longs===Number?it.toNumber():it}else nt.timestampMs=tt.longs===String?"0":0;nt.type=tt.enums===String?"JOIN":1,nt.error=null,nt.join=null,nt.joinack=null,nt.sub=null,nt.suback=null,nt.index=null,nt.pause=null,nt.leave=null,nt.leaveAck=null,nt.bitrates=null,nt.audioControl=null,nt.audioMetadata=null,nt.audioStreamIdInfo=null,nt.pingPong=null,nt.audioStatus=null,nt.clientMetric=null,nt.dataMessage=null,nt.remoteVideoUpdate=null,nt.primaryMeetingJoin=null,nt.primaryMeetingJoinAck=null,nt.primaryMeetingLeave=null,nt.notification=null}return _.timestampMs!=null&&_.hasOwnProperty("timestampMs")&&(typeof _.timestampMs=="number"?nt.timestampMs=tt.longs===String?String(_.timestampMs):_.timestampMs:nt.timestampMs=tt.longs===String?$util.Long.prototype.toString.call(_.timestampMs):tt.longs===Number?new $util.LongBits(_.timestampMs.low>>>0,_.timestampMs.high>>>0).toNumber(!0):_.timestampMs),_.type!=null&&_.hasOwnProperty("type")&&(nt.type=tt.enums===String?$root.SdkSignalFrame.Type[_.type]===void 0?_.type:$root.SdkSignalFrame.Type[_.type]:_.type),_.error!=null&&_.hasOwnProperty("error")&&(nt.error=$root.SdkErrorFrame.toObject(_.error,tt)),_.join!=null&&_.hasOwnProperty("join")&&(nt.join=$root.SdkJoinFrame.toObject(_.join,tt)),_.joinack!=null&&_.hasOwnProperty("joinack")&&(nt.joinack=$root.SdkJoinAckFrame.toObject(_.joinack,tt)),_.sub!=null&&_.hasOwnProperty("sub")&&(nt.sub=$root.SdkSubscribeFrame.toObject(_.sub,tt)),_.suback!=null&&_.hasOwnProperty("suback")&&(nt.suback=$root.SdkSubscribeAckFrame.toObject(_.suback,tt)),_.index!=null&&_.hasOwnProperty("index")&&(nt.index=$root.SdkIndexFrame.toObject(_.index,tt)),_.pause!=null&&_.hasOwnProperty("pause")&&(nt.pause=$root.SdkPauseResumeFrame.toObject(_.pause,tt)),_.leave!=null&&_.hasOwnProperty("leave")&&(nt.leave=$root.SdkLeaveFrame.toObject(_.leave,tt)),_.leaveAck!=null&&_.hasOwnProperty("leaveAck")&&(nt.leaveAck=$root.SdkLeaveAckFrame.toObject(_.leaveAck,tt)),_.bitrates!=null&&_.hasOwnProperty("bitrates")&&(nt.bitrates=$root.SdkBitrateFrame.toObject(_.bitrates,tt)),_.audioControl!=null&&_.hasOwnProperty("audioControl")&&(nt.audioControl=$root.SdkAudioControlFrame.toObject(_.audioControl,tt)),_.audioMetadata!=null&&_.hasOwnProperty("audioMetadata")&&(nt.audioMetadata=$root.SdkAudioMetadataFrame.toObject(_.audioMetadata,tt)),_.audioStreamIdInfo!=null&&_.hasOwnProperty("audioStreamIdInfo")&&(nt.audioStreamIdInfo=$root.SdkAudioStreamIdInfoFrame.toObject(_.audioStreamIdInfo,tt)),_.pingPong!=null&&_.hasOwnProperty("pingPong")&&(nt.pingPong=$root.SdkPingPongFrame.toObject(_.pingPong,tt)),_.audioStatus!=null&&_.hasOwnProperty("audioStatus")&&(nt.audioStatus=$root.SdkAudioStatusFrame.toObject(_.audioStatus,tt)),_.clientMetric!=null&&_.hasOwnProperty("clientMetric")&&(nt.clientMetric=$root.SdkClientMetricFrame.toObject(_.clientMetric,tt)),_.dataMessage!=null&&_.hasOwnProperty("dataMessage")&&(nt.dataMessage=$root.SdkDataMessageFrame.toObject(_.dataMessage,tt)),_.remoteVideoUpdate!=null&&_.hasOwnProperty("remoteVideoUpdate")&&(nt.remoteVideoUpdate=$root.SdkRemoteVideoUpdateFrame.toObject(_.remoteVideoUpdate,tt)),_.primaryMeetingJoin!=null&&_.hasOwnProperty("primaryMeetingJoin")&&(nt.primaryMeetingJoin=$root.SdkPrimaryMeetingJoinFrame.toObject(_.primaryMeetingJoin,tt)),_.primaryMeetingJoinAck!=null&&_.hasOwnProperty("primaryMeetingJoinAck")&&(nt.primaryMeetingJoinAck=$root.SdkPrimaryMeetingJoinAckFrame.toObject(_.primaryMeetingJoinAck,tt)),_.primaryMeetingLeave!=null&&_.hasOwnProperty("primaryMeetingLeave")&&(nt.primaryMeetingLeave=$root.SdkPrimaryMeetingLeaveFrame.toObject(_.primaryMeetingLeave,tt)),_.notification!=null&&_.hasOwnProperty("notification")&&(nt.notification=$root.SdkNotificationFrame.toObject(_.notification,tt)),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkSignalFrame"},et.Type=function(){var $={},_=Object.create($);return _[$[1]="JOIN"]=1,_[$[2]="JOIN_ACK"]=2,_[$[3]="SUBSCRIBE"]=3,_[$[4]="SUBSCRIBE_ACK"]=4,_[$[5]="INDEX"]=5,_[$[7]="PAUSE"]=7,_[$[8]="RESUME"]=8,_[$[9]="LEAVE"]=9,_[$[10]="LEAVE_ACK"]=10,_[$[13]="BITRATES"]=13,_[$[16]="AUDIO_CONTROL"]=16,_[$[17]="AUDIO_METADATA"]=17,_[$[18]="AUDIO_STREAM_ID_INFO"]=18,_[$[19]="PING_PONG"]=19,_[$[20]="AUDIO_STATUS"]=20,_[$[21]="CLIENT_METRIC"]=21,_[$[22]="DATA_MESSAGE"]=22,_[$[24]="REMOTE_VIDEO_UPDATE"]=24,_[$[25]="PRIMARY_MEETING_JOIN"]=25,_[$[26]="PRIMARY_MEETING_JOIN_ACK"]=26,_[$[27]="PRIMARY_MEETING_LEAVE"]=27,_[$[34]="NOTIFICATION"]=34,_}(),et}();$root.SdkErrorFrame=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.status=0,et.prototype.description="",et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.status!=null&&Object.hasOwnProperty.call(_,"status")&&tt.uint32(8).uint32(_.status),_.description!=null&&Object.hasOwnProperty.call(_,"description")&&tt.uint32(18).string(_.description),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkErrorFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.status=_.uint32();break}case 2:{it.description=_.string();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.status!=null&&_.hasOwnProperty("status")&&!$util.isInteger(_.status)?"status: integer expected":_.description!=null&&_.hasOwnProperty("description")&&!$util.isString(_.description)?"description: string expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkErrorFrame)return _;var tt=new $root.SdkErrorFrame;return _.status!=null&&(tt.status=_.status>>>0),_.description!=null&&(tt.description=String(_.description)),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.status=0,nt.description=""),_.status!=null&&_.hasOwnProperty("status")&&(nt.status=_.status),_.description!=null&&_.hasOwnProperty("description")&&(nt.description=_.description),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkErrorFrame"},et}();$root.SdkJoinFlags=function(){var et={},$=Object.create(et);return $[et[2]="HAS_STREAM_UPDATE"]=2,$[et[16]="COMPLETE_VIDEO_SOURCES_LIST"]=16,$[et[32]="EXCLUDE_SELF_CONTENT_IN_INDEX"]=32,$}();$root.SdkClientDetails=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.appName="",et.prototype.appVersion="",et.prototype.deviceModel="",et.prototype.deviceMake="",et.prototype.platformName="",et.prototype.platformVersion="",et.prototype.clientSource="",et.prototype.chimeSdkVersion="",et.prototype.clientUtcOffset="",et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.appName!=null&&Object.hasOwnProperty.call(_,"appName")&&tt.uint32(10).string(_.appName),_.appVersion!=null&&Object.hasOwnProperty.call(_,"appVersion")&&tt.uint32(18).string(_.appVersion),_.deviceModel!=null&&Object.hasOwnProperty.call(_,"deviceModel")&&tt.uint32(26).string(_.deviceModel),_.deviceMake!=null&&Object.hasOwnProperty.call(_,"deviceMake")&&tt.uint32(34).string(_.deviceMake),_.platformName!=null&&Object.hasOwnProperty.call(_,"platformName")&&tt.uint32(42).string(_.platformName),_.platformVersion!=null&&Object.hasOwnProperty.call(_,"platformVersion")&&tt.uint32(50).string(_.platformVersion),_.clientSource!=null&&Object.hasOwnProperty.call(_,"clientSource")&&tt.uint32(58).string(_.clientSource),_.chimeSdkVersion!=null&&Object.hasOwnProperty.call(_,"chimeSdkVersion")&&tt.uint32(66).string(_.chimeSdkVersion),_.clientUtcOffset!=null&&Object.hasOwnProperty.call(_,"clientUtcOffset")&&tt.uint32(74).string(_.clientUtcOffset),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkClientDetails;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.appName=_.string();break}case 2:{it.appVersion=_.string();break}case 3:{it.deviceModel=_.string();break}case 4:{it.deviceMake=_.string();break}case 5:{it.platformName=_.string();break}case 6:{it.platformVersion=_.string();break}case 7:{it.clientSource=_.string();break}case 8:{it.chimeSdkVersion=_.string();break}case 9:{it.clientUtcOffset=_.string();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.appName!=null&&_.hasOwnProperty("appName")&&!$util.isString(_.appName)?"appName: string expected":_.appVersion!=null&&_.hasOwnProperty("appVersion")&&!$util.isString(_.appVersion)?"appVersion: string expected":_.deviceModel!=null&&_.hasOwnProperty("deviceModel")&&!$util.isString(_.deviceModel)?"deviceModel: string expected":_.deviceMake!=null&&_.hasOwnProperty("deviceMake")&&!$util.isString(_.deviceMake)?"deviceMake: string expected":_.platformName!=null&&_.hasOwnProperty("platformName")&&!$util.isString(_.platformName)?"platformName: string expected":_.platformVersion!=null&&_.hasOwnProperty("platformVersion")&&!$util.isString(_.platformVersion)?"platformVersion: string expected":_.clientSource!=null&&_.hasOwnProperty("clientSource")&&!$util.isString(_.clientSource)?"clientSource: string expected":_.chimeSdkVersion!=null&&_.hasOwnProperty("chimeSdkVersion")&&!$util.isString(_.chimeSdkVersion)?"chimeSdkVersion: string expected":_.clientUtcOffset!=null&&_.hasOwnProperty("clientUtcOffset")&&!$util.isString(_.clientUtcOffset)?"clientUtcOffset: string expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkClientDetails)return _;var tt=new $root.SdkClientDetails;return _.appName!=null&&(tt.appName=String(_.appName)),_.appVersion!=null&&(tt.appVersion=String(_.appVersion)),_.deviceModel!=null&&(tt.deviceModel=String(_.deviceModel)),_.deviceMake!=null&&(tt.deviceMake=String(_.deviceMake)),_.platformName!=null&&(tt.platformName=String(_.platformName)),_.platformVersion!=null&&(tt.platformVersion=String(_.platformVersion)),_.clientSource!=null&&(tt.clientSource=String(_.clientSource)),_.chimeSdkVersion!=null&&(tt.chimeSdkVersion=String(_.chimeSdkVersion)),_.clientUtcOffset!=null&&(tt.clientUtcOffset=String(_.clientUtcOffset)),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.appName="",nt.appVersion="",nt.deviceModel="",nt.deviceMake="",nt.platformName="",nt.platformVersion="",nt.clientSource="",nt.chimeSdkVersion="",nt.clientUtcOffset=""),_.appName!=null&&_.hasOwnProperty("appName")&&(nt.appName=_.appName),_.appVersion!=null&&_.hasOwnProperty("appVersion")&&(nt.appVersion=_.appVersion),_.deviceModel!=null&&_.hasOwnProperty("deviceModel")&&(nt.deviceModel=_.deviceModel),_.deviceMake!=null&&_.hasOwnProperty("deviceMake")&&(nt.deviceMake=_.deviceMake),_.platformName!=null&&_.hasOwnProperty("platformName")&&(nt.platformName=_.platformName),_.platformVersion!=null&&_.hasOwnProperty("platformVersion")&&(nt.platformVersion=_.platformVersion),_.clientSource!=null&&_.hasOwnProperty("clientSource")&&(nt.clientSource=_.clientSource),_.chimeSdkVersion!=null&&_.hasOwnProperty("chimeSdkVersion")&&(nt.chimeSdkVersion=_.chimeSdkVersion),_.clientUtcOffset!=null&&_.hasOwnProperty("clientUtcOffset")&&(nt.clientUtcOffset=_.clientUtcOffset),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkClientDetails"},et}();$root.SdkServerSideNetworkAdaption=function(){var et={},$=Object.create(et);return $[et[1]="DEFAULT"]=1,$[et[2]="NONE"]=2,$[et[3]="BANDWIDTH_PROBING"]=3,$[et[4]="BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION"]=4,$}();$root.SdkJoinFrame=function(){function et($){if(this.supportedServerSideNetworkAdaptions=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.protocolVersion=2,et.prototype.maxNumOfVideos=0,et.prototype.flags=0,et.prototype.clientDetails=null,et.prototype.audioSessionId=$util.Long?$util.Long.fromBits(0,0,!0):0,et.prototype.wantsCompressedSdp=!1,et.prototype.serverSideNetworkAdaption=1,et.prototype.supportedServerSideNetworkAdaptions=$util.emptyArray,et.prototype.wantsAllTemporalLayersInIndex=!1,et.prototype.disablePeriodicKeyframeRequestOnContentSender=!1,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.protocolVersion!=null&&Object.hasOwnProperty.call(_,"protocolVersion")&&tt.uint32(8).uint32(_.protocolVersion),_.maxNumOfVideos!=null&&Object.hasOwnProperty.call(_,"maxNumOfVideos")&&tt.uint32(16).uint32(_.maxNumOfVideos),_.flags!=null&&Object.hasOwnProperty.call(_,"flags")&&tt.uint32(24).uint32(_.flags),_.clientDetails!=null&&Object.hasOwnProperty.call(_,"clientDetails")&&$root.SdkClientDetails.encode(_.clientDetails,tt.uint32(34).fork()).ldelim(),_.audioSessionId!=null&&Object.hasOwnProperty.call(_,"audioSessionId")&&tt.uint32(48).uint64(_.audioSessionId),_.wantsCompressedSdp!=null&&Object.hasOwnProperty.call(_,"wantsCompressedSdp")&&tt.uint32(56).bool(_.wantsCompressedSdp),_.serverSideNetworkAdaption!=null&&Object.hasOwnProperty.call(_,"serverSideNetworkAdaption")&&tt.uint32(80).int32(_.serverSideNetworkAdaption),_.supportedServerSideNetworkAdaptions!=null&&_.supportedServerSideNetworkAdaptions.length)for(var nt=0;nt<_.supportedServerSideNetworkAdaptions.length;++nt)tt.uint32(88).int32(_.supportedServerSideNetworkAdaptions[nt]);return _.wantsAllTemporalLayersInIndex!=null&&Object.hasOwnProperty.call(_,"wantsAllTemporalLayersInIndex")&&tt.uint32(96).bool(_.wantsAllTemporalLayersInIndex),_.disablePeriodicKeyframeRequestOnContentSender!=null&&Object.hasOwnProperty.call(_,"disablePeriodicKeyframeRequestOnContentSender")&&tt.uint32(104).bool(_.disablePeriodicKeyframeRequestOnContentSender),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkJoinFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.protocolVersion=_.uint32();break}case 2:{it.maxNumOfVideos=_.uint32();break}case 3:{it.flags=_.uint32();break}case 4:{it.clientDetails=$root.SdkClientDetails.decode(_,_.uint32());break}case 6:{it.audioSessionId=_.uint64();break}case 7:{it.wantsCompressedSdp=_.bool();break}case 10:{it.serverSideNetworkAdaption=_.int32();break}case 11:{if(it.supportedServerSideNetworkAdaptions&&it.supportedServerSideNetworkAdaptions.length||(it.supportedServerSideNetworkAdaptions=[]),(rt&7)===2)for(var ot=_.uint32()+_.pos;_.pos<ot;)it.supportedServerSideNetworkAdaptions.push(_.int32());else it.supportedServerSideNetworkAdaptions.push(_.int32());break}case 12:{it.wantsAllTemporalLayersInIndex=_.bool();break}case 13:{it.disablePeriodicKeyframeRequestOnContentSender=_.bool();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.protocolVersion!=null&&_.hasOwnProperty("protocolVersion")&&!$util.isInteger(_.protocolVersion))return"protocolVersion: integer expected";if(_.maxNumOfVideos!=null&&_.hasOwnProperty("maxNumOfVideos")&&!$util.isInteger(_.maxNumOfVideos))return"maxNumOfVideos: integer expected";if(_.flags!=null&&_.hasOwnProperty("flags")&&!$util.isInteger(_.flags))return"flags: integer expected";if(_.clientDetails!=null&&_.hasOwnProperty("clientDetails")){var tt=$root.SdkClientDetails.verify(_.clientDetails);if(tt)return"clientDetails."+tt}if(_.audioSessionId!=null&&_.hasOwnProperty("audioSessionId")&&!$util.isInteger(_.audioSessionId)&&!(_.audioSessionId&&$util.isInteger(_.audioSessionId.low)&&$util.isInteger(_.audioSessionId.high)))return"audioSessionId: integer|Long expected";if(_.wantsCompressedSdp!=null&&_.hasOwnProperty("wantsCompressedSdp")&&typeof _.wantsCompressedSdp!="boolean")return"wantsCompressedSdp: boolean expected";if(_.serverSideNetworkAdaption!=null&&_.hasOwnProperty("serverSideNetworkAdaption"))switch(_.serverSideNetworkAdaption){default:return"serverSideNetworkAdaption: enum value expected";case 1:case 2:case 3:case 4:break}if(_.supportedServerSideNetworkAdaptions!=null&&_.hasOwnProperty("supportedServerSideNetworkAdaptions")){if(!Array.isArray(_.supportedServerSideNetworkAdaptions))return"supportedServerSideNetworkAdaptions: array expected";for(var nt=0;nt<_.supportedServerSideNetworkAdaptions.length;++nt)switch(_.supportedServerSideNetworkAdaptions[nt]){default:return"supportedServerSideNetworkAdaptions: enum value[] expected";case 1:case 2:case 3:case 4:break}}return _.wantsAllTemporalLayersInIndex!=null&&_.hasOwnProperty("wantsAllTemporalLayersInIndex")&&typeof _.wantsAllTemporalLayersInIndex!="boolean"?"wantsAllTemporalLayersInIndex: boolean expected":_.disablePeriodicKeyframeRequestOnContentSender!=null&&_.hasOwnProperty("disablePeriodicKeyframeRequestOnContentSender")&&typeof _.disablePeriodicKeyframeRequestOnContentSender!="boolean"?"disablePeriodicKeyframeRequestOnContentSender: boolean expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkJoinFrame)return _;var tt=new $root.SdkJoinFrame;if(_.protocolVersion!=null&&(tt.protocolVersion=_.protocolVersion>>>0),_.maxNumOfVideos!=null&&(tt.maxNumOfVideos=_.maxNumOfVideos>>>0),_.flags!=null&&(tt.flags=_.flags>>>0),_.clientDetails!=null){if(typeof _.clientDetails!="object")throw TypeError(".SdkJoinFrame.clientDetails: object expected");tt.clientDetails=$root.SdkClientDetails.fromObject(_.clientDetails)}switch(_.audioSessionId!=null&&($util.Long?(tt.audioSessionId=$util.Long.fromValue(_.audioSessionId)).unsigned=!0:typeof _.audioSessionId=="string"?tt.audioSessionId=parseInt(_.audioSessionId,10):typeof _.audioSessionId=="number"?tt.audioSessionId=_.audioSessionId:typeof _.audioSessionId=="object"&&(tt.audioSessionId=new $util.LongBits(_.audioSessionId.low>>>0,_.audioSessionId.high>>>0).toNumber(!0))),_.wantsCompressedSdp!=null&&(tt.wantsCompressedSdp=!!_.wantsCompressedSdp),_.serverSideNetworkAdaption){default:if(typeof _.serverSideNetworkAdaption=="number"){tt.serverSideNetworkAdaption=_.serverSideNetworkAdaption;break}break;case"DEFAULT":case 1:tt.serverSideNetworkAdaption=1;break;case"NONE":case 2:tt.serverSideNetworkAdaption=2;break;case"BANDWIDTH_PROBING":case 3:tt.serverSideNetworkAdaption=3;break;case"BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION":case 4:tt.serverSideNetworkAdaption=4;break}if(_.supportedServerSideNetworkAdaptions){if(!Array.isArray(_.supportedServerSideNetworkAdaptions))throw TypeError(".SdkJoinFrame.supportedServerSideNetworkAdaptions: array expected");tt.supportedServerSideNetworkAdaptions=[];for(var nt=0;nt<_.supportedServerSideNetworkAdaptions.length;++nt)switch(_.supportedServerSideNetworkAdaptions[nt]){default:if(typeof _.supportedServerSideNetworkAdaptions[nt]=="number"){tt.supportedServerSideNetworkAdaptions[nt]=_.supportedServerSideNetworkAdaptions[nt];break}case"DEFAULT":case 1:tt.supportedServerSideNetworkAdaptions[nt]=1;break;case"NONE":case 2:tt.supportedServerSideNetworkAdaptions[nt]=2;break;case"BANDWIDTH_PROBING":case 3:tt.supportedServerSideNetworkAdaptions[nt]=3;break;case"BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION":case 4:tt.supportedServerSideNetworkAdaptions[nt]=4;break}}return _.wantsAllTemporalLayersInIndex!=null&&(tt.wantsAllTemporalLayersInIndex=!!_.wantsAllTemporalLayersInIndex),_.disablePeriodicKeyframeRequestOnContentSender!=null&&(tt.disablePeriodicKeyframeRequestOnContentSender=!!_.disablePeriodicKeyframeRequestOnContentSender),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.supportedServerSideNetworkAdaptions=[]),tt.defaults){if(nt.protocolVersion=2,nt.maxNumOfVideos=0,nt.flags=0,nt.clientDetails=null,$util.Long){var it=new $util.Long(0,0,!0);nt.audioSessionId=tt.longs===String?it.toString():tt.longs===Number?it.toNumber():it}else nt.audioSessionId=tt.longs===String?"0":0;nt.wantsCompressedSdp=!1,nt.serverSideNetworkAdaption=tt.enums===String?"DEFAULT":1,nt.wantsAllTemporalLayersInIndex=!1,nt.disablePeriodicKeyframeRequestOnContentSender=!1}if(_.protocolVersion!=null&&_.hasOwnProperty("protocolVersion")&&(nt.protocolVersion=_.protocolVersion),_.maxNumOfVideos!=null&&_.hasOwnProperty("maxNumOfVideos")&&(nt.maxNumOfVideos=_.maxNumOfVideos),_.flags!=null&&_.hasOwnProperty("flags")&&(nt.flags=_.flags),_.clientDetails!=null&&_.hasOwnProperty("clientDetails")&&(nt.clientDetails=$root.SdkClientDetails.toObject(_.clientDetails,tt)),_.audioSessionId!=null&&_.hasOwnProperty("audioSessionId")&&(typeof _.audioSessionId=="number"?nt.audioSessionId=tt.longs===String?String(_.audioSessionId):_.audioSessionId:nt.audioSessionId=tt.longs===String?$util.Long.prototype.toString.call(_.audioSessionId):tt.longs===Number?new $util.LongBits(_.audioSessionId.low>>>0,_.audioSessionId.high>>>0).toNumber(!0):_.audioSessionId),_.wantsCompressedSdp!=null&&_.hasOwnProperty("wantsCompressedSdp")&&(nt.wantsCompressedSdp=_.wantsCompressedSdp),_.serverSideNetworkAdaption!=null&&_.hasOwnProperty("serverSideNetworkAdaption")&&(nt.serverSideNetworkAdaption=tt.enums===String?$root.SdkServerSideNetworkAdaption[_.serverSideNetworkAdaption]===void 0?_.serverSideNetworkAdaption:$root.SdkServerSideNetworkAdaption[_.serverSideNetworkAdaption]:_.serverSideNetworkAdaption),_.supportedServerSideNetworkAdaptions&&_.supportedServerSideNetworkAdaptions.length){nt.supportedServerSideNetworkAdaptions=[];for(var rt=0;rt<_.supportedServerSideNetworkAdaptions.length;++rt)nt.supportedServerSideNetworkAdaptions[rt]=tt.enums===String?$root.SdkServerSideNetworkAdaption[_.supportedServerSideNetworkAdaptions[rt]]===void 0?_.supportedServerSideNetworkAdaptions[rt]:$root.SdkServerSideNetworkAdaption[_.supportedServerSideNetworkAdaptions[rt]]:_.supportedServerSideNetworkAdaptions[rt]}return _.wantsAllTemporalLayersInIndex!=null&&_.hasOwnProperty("wantsAllTemporalLayersInIndex")&&(nt.wantsAllTemporalLayersInIndex=_.wantsAllTemporalLayersInIndex),_.disablePeriodicKeyframeRequestOnContentSender!=null&&_.hasOwnProperty("disablePeriodicKeyframeRequestOnContentSender")&&(nt.disablePeriodicKeyframeRequestOnContentSender=_.disablePeriodicKeyframeRequestOnContentSender),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkJoinFrame"},et}();$root.SdkJoinAckFrame=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.turnCredentials=null,et.prototype.videoSubscriptionLimit=0,et.prototype.wantsCompressedSdp=!1,et.prototype.defaultServerSideNetworkAdaption=1,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.turnCredentials!=null&&Object.hasOwnProperty.call(_,"turnCredentials")&&$root.SdkTurnCredentials.encode(_.turnCredentials,tt.uint32(10).fork()).ldelim(),_.videoSubscriptionLimit!=null&&Object.hasOwnProperty.call(_,"videoSubscriptionLimit")&&tt.uint32(16).uint32(_.videoSubscriptionLimit),_.wantsCompressedSdp!=null&&Object.hasOwnProperty.call(_,"wantsCompressedSdp")&&tt.uint32(24).bool(_.wantsCompressedSdp),_.defaultServerSideNetworkAdaption!=null&&Object.hasOwnProperty.call(_,"defaultServerSideNetworkAdaption")&&tt.uint32(32).int32(_.defaultServerSideNetworkAdaption),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkJoinAckFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.turnCredentials=$root.SdkTurnCredentials.decode(_,_.uint32());break}case 2:{it.videoSubscriptionLimit=_.uint32();break}case 3:{it.wantsCompressedSdp=_.bool();break}case 4:{it.defaultServerSideNetworkAdaption=_.int32();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.turnCredentials!=null&&_.hasOwnProperty("turnCredentials")){var tt=$root.SdkTurnCredentials.verify(_.turnCredentials);if(tt)return"turnCredentials."+tt}if(_.videoSubscriptionLimit!=null&&_.hasOwnProperty("videoSubscriptionLimit")&&!$util.isInteger(_.videoSubscriptionLimit))return"videoSubscriptionLimit: integer expected";if(_.wantsCompressedSdp!=null&&_.hasOwnProperty("wantsCompressedSdp")&&typeof _.wantsCompressedSdp!="boolean")return"wantsCompressedSdp: boolean expected";if(_.defaultServerSideNetworkAdaption!=null&&_.hasOwnProperty("defaultServerSideNetworkAdaption"))switch(_.defaultServerSideNetworkAdaption){default:return"defaultServerSideNetworkAdaption: enum value expected";case 1:case 2:case 3:case 4:break}return null},et.fromObject=function(_){if(_ instanceof $root.SdkJoinAckFrame)return _;var tt=new $root.SdkJoinAckFrame;if(_.turnCredentials!=null){if(typeof _.turnCredentials!="object")throw TypeError(".SdkJoinAckFrame.turnCredentials: object expected");tt.turnCredentials=$root.SdkTurnCredentials.fromObject(_.turnCredentials)}switch(_.videoSubscriptionLimit!=null&&(tt.videoSubscriptionLimit=_.videoSubscriptionLimit>>>0),_.wantsCompressedSdp!=null&&(tt.wantsCompressedSdp=!!_.wantsCompressedSdp),_.defaultServerSideNetworkAdaption){default:if(typeof _.defaultServerSideNetworkAdaption=="number"){tt.defaultServerSideNetworkAdaption=_.defaultServerSideNetworkAdaption;break}break;case"DEFAULT":case 1:tt.defaultServerSideNetworkAdaption=1;break;case"NONE":case 2:tt.defaultServerSideNetworkAdaption=2;break;case"BANDWIDTH_PROBING":case 3:tt.defaultServerSideNetworkAdaption=3;break;case"BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION":case 4:tt.defaultServerSideNetworkAdaption=4;break}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.turnCredentials=null,nt.videoSubscriptionLimit=0,nt.wantsCompressedSdp=!1,nt.defaultServerSideNetworkAdaption=tt.enums===String?"DEFAULT":1),_.turnCredentials!=null&&_.hasOwnProperty("turnCredentials")&&(nt.turnCredentials=$root.SdkTurnCredentials.toObject(_.turnCredentials,tt)),_.videoSubscriptionLimit!=null&&_.hasOwnProperty("videoSubscriptionLimit")&&(nt.videoSubscriptionLimit=_.videoSubscriptionLimit),_.wantsCompressedSdp!=null&&_.hasOwnProperty("wantsCompressedSdp")&&(nt.wantsCompressedSdp=_.wantsCompressedSdp),_.defaultServerSideNetworkAdaption!=null&&_.hasOwnProperty("defaultServerSideNetworkAdaption")&&(nt.defaultServerSideNetworkAdaption=tt.enums===String?$root.SdkServerSideNetworkAdaption[_.defaultServerSideNetworkAdaption]===void 0?_.defaultServerSideNetworkAdaption:$root.SdkServerSideNetworkAdaption[_.defaultServerSideNetworkAdaption]:_.defaultServerSideNetworkAdaption),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkJoinAckFrame"},et}();$root.SdkLeaveFrame=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkLeaveFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":null},et.fromObject=function(_){return _ instanceof $root.SdkLeaveFrame?_:new $root.SdkLeaveFrame},et.toObject=function(){return{}},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkLeaveFrame"},et}();$root.SdkLeaveAckFrame=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkLeaveAckFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":null},et.fromObject=function(_){return _ instanceof $root.SdkLeaveAckFrame?_:new $root.SdkLeaveAckFrame},et.toObject=function(){return{}},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkLeaveAckFrame"},et}();$root.SdkStreamServiceType=function(){var et={},$=Object.create(et);return $[et[1]="RX"]=1,$[et[2]="TX"]=2,$[et[3]="DUPLEX"]=3,$}();$root.SdkStreamMediaType=function(){var et={},$=Object.create(et);return $[et[1]="AUDIO"]=1,$[et[2]="VIDEO"]=2,$}();$root.SdkSubscribeFrame=function(){function et($){if(this.sendStreams=[],this.receiveStreamIds=[],this.videoSubscriptionConfiguration=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.duplex=1,et.prototype.sendStreams=$util.emptyArray,et.prototype.receiveStreamIds=$util.emptyArray,et.prototype.sdpOffer="",et.prototype.audioHost="",et.prototype.audioCheckin=!1,et.prototype.audioMuted=!1,et.prototype.compressedSdpOffer=$util.newBuffer([]),et.prototype.videoSubscriptionConfiguration=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.duplex!=null&&Object.hasOwnProperty.call(_,"duplex")&&tt.uint32(8).int32(_.duplex),_.sendStreams!=null&&_.sendStreams.length)for(var nt=0;nt<_.sendStreams.length;++nt)$root.SdkStreamDescriptor.encode(_.sendStreams[nt],tt.uint32(18).fork()).ldelim();if(_.receiveStreamIds!=null&&_.receiveStreamIds.length)for(var nt=0;nt<_.receiveStreamIds.length;++nt)tt.uint32(24).uint32(_.receiveStreamIds[nt]);if(_.sdpOffer!=null&&Object.hasOwnProperty.call(_,"sdpOffer")&&tt.uint32(34).string(_.sdpOffer),_.audioHost!=null&&Object.hasOwnProperty.call(_,"audioHost")&&tt.uint32(42).string(_.audioHost),_.audioCheckin!=null&&Object.hasOwnProperty.call(_,"audioCheckin")&&tt.uint32(48).bool(_.audioCheckin),_.audioMuted!=null&&Object.hasOwnProperty.call(_,"audioMuted")&&tt.uint32(56).bool(_.audioMuted),_.compressedSdpOffer!=null&&Object.hasOwnProperty.call(_,"compressedSdpOffer")&&tt.uint32(66).bytes(_.compressedSdpOffer),_.videoSubscriptionConfiguration!=null&&_.videoSubscriptionConfiguration.length)for(var nt=0;nt<_.videoSubscriptionConfiguration.length;++nt)$root.SdkVideoSubscriptionConfiguration.encode(_.videoSubscriptionConfiguration[nt],tt.uint32(74).fork()).ldelim();return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkSubscribeFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.duplex=_.int32();break}case 2:{it.sendStreams&&it.sendStreams.length||(it.sendStreams=[]),it.sendStreams.push($root.SdkStreamDescriptor.decode(_,_.uint32()));break}case 3:{if(it.receiveStreamIds&&it.receiveStreamIds.length||(it.receiveStreamIds=[]),(rt&7)===2)for(var ot=_.uint32()+_.pos;_.pos<ot;)it.receiveStreamIds.push(_.uint32());else it.receiveStreamIds.push(_.uint32());break}case 4:{it.sdpOffer=_.string();break}case 5:{it.audioHost=_.string();break}case 6:{it.audioCheckin=_.bool();break}case 7:{it.audioMuted=_.bool();break}case 8:{it.compressedSdpOffer=_.bytes();break}case 9:{it.videoSubscriptionConfiguration&&it.videoSubscriptionConfiguration.length||(it.videoSubscriptionConfiguration=[]),it.videoSubscriptionConfiguration.push($root.SdkVideoSubscriptionConfiguration.decode(_,_.uint32()));break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.duplex!=null&&_.hasOwnProperty("duplex"))switch(_.duplex){default:return"duplex: enum value expected";case 1:case 2:case 3:break}if(_.sendStreams!=null&&_.hasOwnProperty("sendStreams")){if(!Array.isArray(_.sendStreams))return"sendStreams: array expected";for(var tt=0;tt<_.sendStreams.length;++tt){var nt=$root.SdkStreamDescriptor.verify(_.sendStreams[tt]);if(nt)return"sendStreams."+nt}}if(_.receiveStreamIds!=null&&_.hasOwnProperty("receiveStreamIds")){if(!Array.isArray(_.receiveStreamIds))return"receiveStreamIds: array expected";for(var tt=0;tt<_.receiveStreamIds.length;++tt)if(!$util.isInteger(_.receiveStreamIds[tt]))return"receiveStreamIds: integer[] expected"}if(_.sdpOffer!=null&&_.hasOwnProperty("sdpOffer")&&!$util.isString(_.sdpOffer))return"sdpOffer: string expected";if(_.audioHost!=null&&_.hasOwnProperty("audioHost")&&!$util.isString(_.audioHost))return"audioHost: string expected";if(_.audioCheckin!=null&&_.hasOwnProperty("audioCheckin")&&typeof _.audioCheckin!="boolean")return"audioCheckin: boolean expected";if(_.audioMuted!=null&&_.hasOwnProperty("audioMuted")&&typeof _.audioMuted!="boolean")return"audioMuted: boolean expected";if(_.compressedSdpOffer!=null&&_.hasOwnProperty("compressedSdpOffer")&&!(_.compressedSdpOffer&&typeof _.compressedSdpOffer.length=="number"||$util.isString(_.compressedSdpOffer)))return"compressedSdpOffer: buffer expected";if(_.videoSubscriptionConfiguration!=null&&_.hasOwnProperty("videoSubscriptionConfiguration")){if(!Array.isArray(_.videoSubscriptionConfiguration))return"videoSubscriptionConfiguration: array expected";for(var tt=0;tt<_.videoSubscriptionConfiguration.length;++tt){var nt=$root.SdkVideoSubscriptionConfiguration.verify(_.videoSubscriptionConfiguration[tt]);if(nt)return"videoSubscriptionConfiguration."+nt}}return null},et.fromObject=function(_){if(_ instanceof $root.SdkSubscribeFrame)return _;var tt=new $root.SdkSubscribeFrame;switch(_.duplex){default:if(typeof _.duplex=="number"){tt.duplex=_.duplex;break}break;case"RX":case 1:tt.duplex=1;break;case"TX":case 2:tt.duplex=2;break;case"DUPLEX":case 3:tt.duplex=3;break}if(_.sendStreams){if(!Array.isArray(_.sendStreams))throw TypeError(".SdkSubscribeFrame.sendStreams: array expected");tt.sendStreams=[];for(var nt=0;nt<_.sendStreams.length;++nt){if(typeof _.sendStreams[nt]!="object")throw TypeError(".SdkSubscribeFrame.sendStreams: object expected");tt.sendStreams[nt]=$root.SdkStreamDescriptor.fromObject(_.sendStreams[nt])}}if(_.receiveStreamIds){if(!Array.isArray(_.receiveStreamIds))throw TypeError(".SdkSubscribeFrame.receiveStreamIds: array expected");tt.receiveStreamIds=[];for(var nt=0;nt<_.receiveStreamIds.length;++nt)tt.receiveStreamIds[nt]=_.receiveStreamIds[nt]>>>0}if(_.sdpOffer!=null&&(tt.sdpOffer=String(_.sdpOffer)),_.audioHost!=null&&(tt.audioHost=String(_.audioHost)),_.audioCheckin!=null&&(tt.audioCheckin=!!_.audioCheckin),_.audioMuted!=null&&(tt.audioMuted=!!_.audioMuted),_.compressedSdpOffer!=null&&(typeof _.compressedSdpOffer=="string"?$util.base64.decode(_.compressedSdpOffer,tt.compressedSdpOffer=$util.newBuffer($util.base64.length(_.compressedSdpOffer)),0):_.compressedSdpOffer.length>=0&&(tt.compressedSdpOffer=_.compressedSdpOffer)),_.videoSubscriptionConfiguration){if(!Array.isArray(_.videoSubscriptionConfiguration))throw TypeError(".SdkSubscribeFrame.videoSubscriptionConfiguration: array expected");tt.videoSubscriptionConfiguration=[];for(var nt=0;nt<_.videoSubscriptionConfiguration.length;++nt){if(typeof _.videoSubscriptionConfiguration[nt]!="object")throw TypeError(".SdkSubscribeFrame.videoSubscriptionConfiguration: object expected");tt.videoSubscriptionConfiguration[nt]=$root.SdkVideoSubscriptionConfiguration.fromObject(_.videoSubscriptionConfiguration[nt])}}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.sendStreams=[],nt.receiveStreamIds=[],nt.videoSubscriptionConfiguration=[]),tt.defaults&&(nt.duplex=tt.enums===String?"RX":1,nt.sdpOffer="",nt.audioHost="",nt.audioCheckin=!1,nt.audioMuted=!1,tt.bytes===String?nt.compressedSdpOffer="":(nt.compressedSdpOffer=[],tt.bytes!==Array&&(nt.compressedSdpOffer=$util.newBuffer(nt.compressedSdpOffer)))),_.duplex!=null&&_.hasOwnProperty("duplex")&&(nt.duplex=tt.enums===String?$root.SdkStreamServiceType[_.duplex]===void 0?_.duplex:$root.SdkStreamServiceType[_.duplex]:_.duplex),_.sendStreams&&_.sendStreams.length){nt.sendStreams=[];for(var it=0;it<_.sendStreams.length;++it)nt.sendStreams[it]=$root.SdkStreamDescriptor.toObject(_.sendStreams[it],tt)}if(_.receiveStreamIds&&_.receiveStreamIds.length){nt.receiveStreamIds=[];for(var it=0;it<_.receiveStreamIds.length;++it)nt.receiveStreamIds[it]=_.receiveStreamIds[it]}if(_.sdpOffer!=null&&_.hasOwnProperty("sdpOffer")&&(nt.sdpOffer=_.sdpOffer),_.audioHost!=null&&_.hasOwnProperty("audioHost")&&(nt.audioHost=_.audioHost),_.audioCheckin!=null&&_.hasOwnProperty("audioCheckin")&&(nt.audioCheckin=_.audioCheckin),_.audioMuted!=null&&_.hasOwnProperty("audioMuted")&&(nt.audioMuted=_.audioMuted),_.compressedSdpOffer!=null&&_.hasOwnProperty("compressedSdpOffer")&&(nt.compressedSdpOffer=tt.bytes===String?$util.base64.encode(_.compressedSdpOffer,0,_.compressedSdpOffer.length):tt.bytes===Array?Array.prototype.slice.call(_.compressedSdpOffer):_.compressedSdpOffer),_.videoSubscriptionConfiguration&&_.videoSubscriptionConfiguration.length){nt.videoSubscriptionConfiguration=[];for(var it=0;it<_.videoSubscriptionConfiguration.length;++it)nt.videoSubscriptionConfiguration[it]=$root.SdkVideoSubscriptionConfiguration.toObject(_.videoSubscriptionConfiguration[it],tt)}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkSubscribeFrame"},et}();$root.SdkSubscribeAckFrame=function(){function et($){if(this.allocations=[],this.tracks=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.duplex=1,et.prototype.allocations=$util.emptyArray,et.prototype.sdpAnswer="",et.prototype.tracks=$util.emptyArray,et.prototype.compressedSdpAnswer=$util.newBuffer([]),et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.duplex!=null&&Object.hasOwnProperty.call(_,"duplex")&&tt.uint32(8).int32(_.duplex),_.allocations!=null&&_.allocations.length)for(var nt=0;nt<_.allocations.length;++nt)$root.SdkStreamAllocation.encode(_.allocations[nt],tt.uint32(18).fork()).ldelim();if(_.sdpAnswer!=null&&Object.hasOwnProperty.call(_,"sdpAnswer")&&tt.uint32(26).string(_.sdpAnswer),_.tracks!=null&&_.tracks.length)for(var nt=0;nt<_.tracks.length;++nt)$root.SdkTrackMapping.encode(_.tracks[nt],tt.uint32(34).fork()).ldelim();return _.compressedSdpAnswer!=null&&Object.hasOwnProperty.call(_,"compressedSdpAnswer")&&tt.uint32(42).bytes(_.compressedSdpAnswer),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkSubscribeAckFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.duplex=_.int32();break}case 2:{it.allocations&&it.allocations.length||(it.allocations=[]),it.allocations.push($root.SdkStreamAllocation.decode(_,_.uint32()));break}case 3:{it.sdpAnswer=_.string();break}case 4:{it.tracks&&it.tracks.length||(it.tracks=[]),it.tracks.push($root.SdkTrackMapping.decode(_,_.uint32()));break}case 5:{it.compressedSdpAnswer=_.bytes();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.duplex!=null&&_.hasOwnProperty("duplex"))switch(_.duplex){default:return"duplex: enum value expected";case 1:case 2:case 3:break}if(_.allocations!=null&&_.hasOwnProperty("allocations")){if(!Array.isArray(_.allocations))return"allocations: array expected";for(var tt=0;tt<_.allocations.length;++tt){var nt=$root.SdkStreamAllocation.verify(_.allocations[tt]);if(nt)return"allocations."+nt}}if(_.sdpAnswer!=null&&_.hasOwnProperty("sdpAnswer")&&!$util.isString(_.sdpAnswer))return"sdpAnswer: string expected";if(_.tracks!=null&&_.hasOwnProperty("tracks")){if(!Array.isArray(_.tracks))return"tracks: array expected";for(var tt=0;tt<_.tracks.length;++tt){var nt=$root.SdkTrackMapping.verify(_.tracks[tt]);if(nt)return"tracks."+nt}}return _.compressedSdpAnswer!=null&&_.hasOwnProperty("compressedSdpAnswer")&&!(_.compressedSdpAnswer&&typeof _.compressedSdpAnswer.length=="number"||$util.isString(_.compressedSdpAnswer))?"compressedSdpAnswer: buffer expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkSubscribeAckFrame)return _;var tt=new $root.SdkSubscribeAckFrame;switch(_.duplex){default:if(typeof _.duplex=="number"){tt.duplex=_.duplex;break}break;case"RX":case 1:tt.duplex=1;break;case"TX":case 2:tt.duplex=2;break;case"DUPLEX":case 3:tt.duplex=3;break}if(_.allocations){if(!Array.isArray(_.allocations))throw TypeError(".SdkSubscribeAckFrame.allocations: array expected");tt.allocations=[];for(var nt=0;nt<_.allocations.length;++nt){if(typeof _.allocations[nt]!="object")throw TypeError(".SdkSubscribeAckFrame.allocations: object expected");tt.allocations[nt]=$root.SdkStreamAllocation.fromObject(_.allocations[nt])}}if(_.sdpAnswer!=null&&(tt.sdpAnswer=String(_.sdpAnswer)),_.tracks){if(!Array.isArray(_.tracks))throw TypeError(".SdkSubscribeAckFrame.tracks: array expected");tt.tracks=[];for(var nt=0;nt<_.tracks.length;++nt){if(typeof _.tracks[nt]!="object")throw TypeError(".SdkSubscribeAckFrame.tracks: object expected");tt.tracks[nt]=$root.SdkTrackMapping.fromObject(_.tracks[nt])}}return _.compressedSdpAnswer!=null&&(typeof _.compressedSdpAnswer=="string"?$util.base64.decode(_.compressedSdpAnswer,tt.compressedSdpAnswer=$util.newBuffer($util.base64.length(_.compressedSdpAnswer)),0):_.compressedSdpAnswer.length>=0&&(tt.compressedSdpAnswer=_.compressedSdpAnswer)),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.allocations=[],nt.tracks=[]),tt.defaults&&(nt.duplex=tt.enums===String?"RX":1,nt.sdpAnswer="",tt.bytes===String?nt.compressedSdpAnswer="":(nt.compressedSdpAnswer=[],tt.bytes!==Array&&(nt.compressedSdpAnswer=$util.newBuffer(nt.compressedSdpAnswer)))),_.duplex!=null&&_.hasOwnProperty("duplex")&&(nt.duplex=tt.enums===String?$root.SdkStreamServiceType[_.duplex]===void 0?_.duplex:$root.SdkStreamServiceType[_.duplex]:_.duplex),_.allocations&&_.allocations.length){nt.allocations=[];for(var it=0;it<_.allocations.length;++it)nt.allocations[it]=$root.SdkStreamAllocation.toObject(_.allocations[it],tt)}if(_.sdpAnswer!=null&&_.hasOwnProperty("sdpAnswer")&&(nt.sdpAnswer=_.sdpAnswer),_.tracks&&_.tracks.length){nt.tracks=[];for(var it=0;it<_.tracks.length;++it)nt.tracks[it]=$root.SdkTrackMapping.toObject(_.tracks[it],tt)}return _.compressedSdpAnswer!=null&&_.hasOwnProperty("compressedSdpAnswer")&&(nt.compressedSdpAnswer=tt.bytes===String?$util.base64.encode(_.compressedSdpAnswer,0,_.compressedSdpAnswer.length):tt.bytes===Array?Array.prototype.slice.call(_.compressedSdpAnswer):_.compressedSdpAnswer),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkSubscribeAckFrame"},et}();$root.SdkIndexFrame=function(){function et($){if(this.sources=[],this.pausedAtSourceIds=[],this.supportedReceiveCodecIntersection=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.atCapacity=!1,et.prototype.sources=$util.emptyArray,et.prototype.pausedAtSourceIds=$util.emptyArray,et.prototype.numParticipants=0,et.prototype.supportedReceiveCodecIntersection=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.atCapacity!=null&&Object.hasOwnProperty.call(_,"atCapacity")&&tt.uint32(8).bool(_.atCapacity),_.sources!=null&&_.sources.length)for(var nt=0;nt<_.sources.length;++nt)$root.SdkStreamDescriptor.encode(_.sources[nt],tt.uint32(18).fork()).ldelim();if(_.pausedAtSourceIds!=null&&_.pausedAtSourceIds.length)for(var nt=0;nt<_.pausedAtSourceIds.length;++nt)tt.uint32(24).uint32(_.pausedAtSourceIds[nt]);if(_.numParticipants!=null&&Object.hasOwnProperty.call(_,"numParticipants")&&tt.uint32(32).uint32(_.numParticipants),_.supportedReceiveCodecIntersection!=null&&_.supportedReceiveCodecIntersection.length)for(var nt=0;nt<_.supportedReceiveCodecIntersection.length;++nt)tt.uint32(40).int32(_.supportedReceiveCodecIntersection[nt]);return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkIndexFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.atCapacity=_.bool();break}case 2:{it.sources&&it.sources.length||(it.sources=[]),it.sources.push($root.SdkStreamDescriptor.decode(_,_.uint32()));break}case 3:{if(it.pausedAtSourceIds&&it.pausedAtSourceIds.length||(it.pausedAtSourceIds=[]),(rt&7)===2)for(var ot=_.uint32()+_.pos;_.pos<ot;)it.pausedAtSourceIds.push(_.uint32());else it.pausedAtSourceIds.push(_.uint32());break}case 4:{it.numParticipants=_.uint32();break}case 5:{if(it.supportedReceiveCodecIntersection&&it.supportedReceiveCodecIntersection.length||(it.supportedReceiveCodecIntersection=[]),(rt&7)===2)for(var ot=_.uint32()+_.pos;_.pos<ot;)it.supportedReceiveCodecIntersection.push(_.int32());else it.supportedReceiveCodecIntersection.push(_.int32());break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.atCapacity!=null&&_.hasOwnProperty("atCapacity")&&typeof _.atCapacity!="boolean")return"atCapacity: boolean expected";if(_.sources!=null&&_.hasOwnProperty("sources")){if(!Array.isArray(_.sources))return"sources: array expected";for(var tt=0;tt<_.sources.length;++tt){var nt=$root.SdkStreamDescriptor.verify(_.sources[tt]);if(nt)return"sources."+nt}}if(_.pausedAtSourceIds!=null&&_.hasOwnProperty("pausedAtSourceIds")){if(!Array.isArray(_.pausedAtSourceIds))return"pausedAtSourceIds: array expected";for(var tt=0;tt<_.pausedAtSourceIds.length;++tt)if(!$util.isInteger(_.pausedAtSourceIds[tt]))return"pausedAtSourceIds: integer[] expected"}if(_.numParticipants!=null&&_.hasOwnProperty("numParticipants")&&!$util.isInteger(_.numParticipants))return"numParticipants: integer expected";if(_.supportedReceiveCodecIntersection!=null&&_.hasOwnProperty("supportedReceiveCodecIntersection")){if(!Array.isArray(_.supportedReceiveCodecIntersection))return"supportedReceiveCodecIntersection: array expected";for(var tt=0;tt<_.supportedReceiveCodecIntersection.length;++tt)switch(_.supportedReceiveCodecIntersection[tt]){default:return"supportedReceiveCodecIntersection: enum value[] expected";case 1:case 2:case 3:case 4:case 5:case 6:case 8:case 11:break}}return null},et.fromObject=function(_){if(_ instanceof $root.SdkIndexFrame)return _;var tt=new $root.SdkIndexFrame;if(_.atCapacity!=null&&(tt.atCapacity=!!_.atCapacity),_.sources){if(!Array.isArray(_.sources))throw TypeError(".SdkIndexFrame.sources: array expected");tt.sources=[];for(var nt=0;nt<_.sources.length;++nt){if(typeof _.sources[nt]!="object")throw TypeError(".SdkIndexFrame.sources: object expected");tt.sources[nt]=$root.SdkStreamDescriptor.fromObject(_.sources[nt])}}if(_.pausedAtSourceIds){if(!Array.isArray(_.pausedAtSourceIds))throw TypeError(".SdkIndexFrame.pausedAtSourceIds: array expected");tt.pausedAtSourceIds=[];for(var nt=0;nt<_.pausedAtSourceIds.length;++nt)tt.pausedAtSourceIds[nt]=_.pausedAtSourceIds[nt]>>>0}if(_.numParticipants!=null&&(tt.numParticipants=_.numParticipants>>>0),_.supportedReceiveCodecIntersection){if(!Array.isArray(_.supportedReceiveCodecIntersection))throw TypeError(".SdkIndexFrame.supportedReceiveCodecIntersection: array expected");tt.supportedReceiveCodecIntersection=[];for(var nt=0;nt<_.supportedReceiveCodecIntersection.length;++nt)switch(_.supportedReceiveCodecIntersection[nt]){default:if(typeof _.supportedReceiveCodecIntersection[nt]=="number"){tt.supportedReceiveCodecIntersection[nt]=_.supportedReceiveCodecIntersection[nt];break}case"VP8":case 1:tt.supportedReceiveCodecIntersection[nt]=1;break;case"H264_BASELINE_PROFILE":case 2:tt.supportedReceiveCodecIntersection[nt]=2;break;case"H264_CONSTRAINED_BASELINE_PROFILE":case 3:tt.supportedReceiveCodecIntersection[nt]=3;break;case"H264_MAIN_PROFILE":case 4:tt.supportedReceiveCodecIntersection[nt]=4;break;case"H264_HIGH_PROFILE":case 5:tt.supportedReceiveCodecIntersection[nt]=5;break;case"H264_CONSTRAINED_HIGH_PROFILE":case 6:tt.supportedReceiveCodecIntersection[nt]=6;break;case"VP9_PROFILE_0":case 8:tt.supportedReceiveCodecIntersection[nt]=8;break;case"AV1_MAIN_PROFILE":case 11:tt.supportedReceiveCodecIntersection[nt]=11;break}}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.sources=[],nt.pausedAtSourceIds=[],nt.supportedReceiveCodecIntersection=[]),tt.defaults&&(nt.atCapacity=!1,nt.numParticipants=0),_.atCapacity!=null&&_.hasOwnProperty("atCapacity")&&(nt.atCapacity=_.atCapacity),_.sources&&_.sources.length){nt.sources=[];for(var it=0;it<_.sources.length;++it)nt.sources[it]=$root.SdkStreamDescriptor.toObject(_.sources[it],tt)}if(_.pausedAtSourceIds&&_.pausedAtSourceIds.length){nt.pausedAtSourceIds=[];for(var it=0;it<_.pausedAtSourceIds.length;++it)nt.pausedAtSourceIds[it]=_.pausedAtSourceIds[it]}if(_.numParticipants!=null&&_.hasOwnProperty("numParticipants")&&(nt.numParticipants=_.numParticipants),_.supportedReceiveCodecIntersection&&_.supportedReceiveCodecIntersection.length){nt.supportedReceiveCodecIntersection=[];for(var it=0;it<_.supportedReceiveCodecIntersection.length;++it)nt.supportedReceiveCodecIntersection[it]=tt.enums===String?$root.SdkVideoCodecCapability[_.supportedReceiveCodecIntersection[it]]===void 0?_.supportedReceiveCodecIntersection[it]:$root.SdkVideoCodecCapability[_.supportedReceiveCodecIntersection[it]]:_.supportedReceiveCodecIntersection[it]}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkIndexFrame"},et}();$root.SdkPauseResumeFrame=function(){function et($){if(this.streamIds=[],this.groupIds=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.streamIds=$util.emptyArray,et.prototype.groupIds=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.streamIds!=null&&_.streamIds.length)for(var nt=0;nt<_.streamIds.length;++nt)tt.uint32(8).uint32(_.streamIds[nt]);if(_.groupIds!=null&&_.groupIds.length)for(var nt=0;nt<_.groupIds.length;++nt)tt.uint32(16).uint32(_.groupIds[nt]);return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkPauseResumeFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{if(it.streamIds&&it.streamIds.length||(it.streamIds=[]),(rt&7)===2)for(var ot=_.uint32()+_.pos;_.pos<ot;)it.streamIds.push(_.uint32());else it.streamIds.push(_.uint32());break}case 2:{if(it.groupIds&&it.groupIds.length||(it.groupIds=[]),(rt&7)===2)for(var ot=_.uint32()+_.pos;_.pos<ot;)it.groupIds.push(_.uint32());else it.groupIds.push(_.uint32());break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.streamIds!=null&&_.hasOwnProperty("streamIds")){if(!Array.isArray(_.streamIds))return"streamIds: array expected";for(var tt=0;tt<_.streamIds.length;++tt)if(!$util.isInteger(_.streamIds[tt]))return"streamIds: integer[] expected"}if(_.groupIds!=null&&_.hasOwnProperty("groupIds")){if(!Array.isArray(_.groupIds))return"groupIds: array expected";for(var tt=0;tt<_.groupIds.length;++tt)if(!$util.isInteger(_.groupIds[tt]))return"groupIds: integer[] expected"}return null},et.fromObject=function(_){if(_ instanceof $root.SdkPauseResumeFrame)return _;var tt=new $root.SdkPauseResumeFrame;if(_.streamIds){if(!Array.isArray(_.streamIds))throw TypeError(".SdkPauseResumeFrame.streamIds: array expected");tt.streamIds=[];for(var nt=0;nt<_.streamIds.length;++nt)tt.streamIds[nt]=_.streamIds[nt]>>>0}if(_.groupIds){if(!Array.isArray(_.groupIds))throw TypeError(".SdkPauseResumeFrame.groupIds: array expected");tt.groupIds=[];for(var nt=0;nt<_.groupIds.length;++nt)tt.groupIds[nt]=_.groupIds[nt]>>>0}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.streamIds=[],nt.groupIds=[]),_.streamIds&&_.streamIds.length){nt.streamIds=[];for(var it=0;it<_.streamIds.length;++it)nt.streamIds[it]=_.streamIds[it]}if(_.groupIds&&_.groupIds.length){nt.groupIds=[];for(var it=0;it<_.groupIds.length;++it)nt.groupIds[it]=_.groupIds[it]}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkPauseResumeFrame"},et}();$root.SdkBitrateFrame=function(){function et($){if(this.bitrates=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.bitrates=$util.emptyArray,et.prototype.serverAvailableOutgoingBitrate=0,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.bitrates!=null&&_.bitrates.length)for(var nt=0;nt<_.bitrates.length;++nt)$root.SdkBitrate.encode(_.bitrates[nt],tt.uint32(10).fork()).ldelim();return _.serverAvailableOutgoingBitrate!=null&&Object.hasOwnProperty.call(_,"serverAvailableOutgoingBitrate")&&tt.uint32(16).uint32(_.serverAvailableOutgoingBitrate),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkBitrateFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.bitrates&&it.bitrates.length||(it.bitrates=[]),it.bitrates.push($root.SdkBitrate.decode(_,_.uint32()));break}case 2:{it.serverAvailableOutgoingBitrate=_.uint32();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.bitrates!=null&&_.hasOwnProperty("bitrates")){if(!Array.isArray(_.bitrates))return"bitrates: array expected";for(var tt=0;tt<_.bitrates.length;++tt){var nt=$root.SdkBitrate.verify(_.bitrates[tt]);if(nt)return"bitrates."+nt}}return _.serverAvailableOutgoingBitrate!=null&&_.hasOwnProperty("serverAvailableOutgoingBitrate")&&!$util.isInteger(_.serverAvailableOutgoingBitrate)?"serverAvailableOutgoingBitrate: integer expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkBitrateFrame)return _;var tt=new $root.SdkBitrateFrame;if(_.bitrates){if(!Array.isArray(_.bitrates))throw TypeError(".SdkBitrateFrame.bitrates: array expected");tt.bitrates=[];for(var nt=0;nt<_.bitrates.length;++nt){if(typeof _.bitrates[nt]!="object")throw TypeError(".SdkBitrateFrame.bitrates: object expected");tt.bitrates[nt]=$root.SdkBitrate.fromObject(_.bitrates[nt])}}return _.serverAvailableOutgoingBitrate!=null&&(tt.serverAvailableOutgoingBitrate=_.serverAvailableOutgoingBitrate>>>0),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.bitrates=[]),tt.defaults&&(nt.serverAvailableOutgoingBitrate=0),_.bitrates&&_.bitrates.length){nt.bitrates=[];for(var it=0;it<_.bitrates.length;++it)nt.bitrates[it]=$root.SdkBitrate.toObject(_.bitrates[it],tt)}return _.serverAvailableOutgoingBitrate!=null&&_.hasOwnProperty("serverAvailableOutgoingBitrate")&&(nt.serverAvailableOutgoingBitrate=_.serverAvailableOutgoingBitrate),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkBitrateFrame"},et}();$root.SdkStreamDescriptor=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.streamId=0,et.prototype.framerate=0,et.prototype.maxBitrateKbps=0,et.prototype.trackLabel="",et.prototype.groupId=0,et.prototype.avgBitrateBps=0,et.prototype.attendeeId="",et.prototype.mediaType=1,et.prototype.externalUserId="",et.prototype.width=0,et.prototype.height=0,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.streamId!=null&&Object.hasOwnProperty.call(_,"streamId")&&tt.uint32(8).uint32(_.streamId),_.framerate!=null&&Object.hasOwnProperty.call(_,"framerate")&&tt.uint32(16).uint32(_.framerate),_.maxBitrateKbps!=null&&Object.hasOwnProperty.call(_,"maxBitrateKbps")&&tt.uint32(24).uint32(_.maxBitrateKbps),_.trackLabel!=null&&Object.hasOwnProperty.call(_,"trackLabel")&&tt.uint32(34).string(_.trackLabel),_.groupId!=null&&Object.hasOwnProperty.call(_,"groupId")&&tt.uint32(48).uint32(_.groupId),_.avgBitrateBps!=null&&Object.hasOwnProperty.call(_,"avgBitrateBps")&&tt.uint32(56).uint32(_.avgBitrateBps),_.attendeeId!=null&&Object.hasOwnProperty.call(_,"attendeeId")&&tt.uint32(66).string(_.attendeeId),_.mediaType!=null&&Object.hasOwnProperty.call(_,"mediaType")&&tt.uint32(72).int32(_.mediaType),_.externalUserId!=null&&Object.hasOwnProperty.call(_,"externalUserId")&&tt.uint32(82).string(_.externalUserId),_.width!=null&&Object.hasOwnProperty.call(_,"width")&&tt.uint32(88).uint32(_.width),_.height!=null&&Object.hasOwnProperty.call(_,"height")&&tt.uint32(96).uint32(_.height),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkStreamDescriptor;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.streamId=_.uint32();break}case 2:{it.framerate=_.uint32();break}case 3:{it.maxBitrateKbps=_.uint32();break}case 4:{it.trackLabel=_.string();break}case 6:{it.groupId=_.uint32();break}case 7:{it.avgBitrateBps=_.uint32();break}case 8:{it.attendeeId=_.string();break}case 9:{it.mediaType=_.int32();break}case 10:{it.externalUserId=_.string();break}case 11:{it.width=_.uint32();break}case 12:{it.height=_.uint32();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.streamId!=null&&_.hasOwnProperty("streamId")&&!$util.isInteger(_.streamId))return"streamId: integer expected";if(_.framerate!=null&&_.hasOwnProperty("framerate")&&!$util.isInteger(_.framerate))return"framerate: integer expected";if(_.maxBitrateKbps!=null&&_.hasOwnProperty("maxBitrateKbps")&&!$util.isInteger(_.maxBitrateKbps))return"maxBitrateKbps: integer expected";if(_.trackLabel!=null&&_.hasOwnProperty("trackLabel")&&!$util.isString(_.trackLabel))return"trackLabel: string expected";if(_.groupId!=null&&_.hasOwnProperty("groupId")&&!$util.isInteger(_.groupId))return"groupId: integer expected";if(_.avgBitrateBps!=null&&_.hasOwnProperty("avgBitrateBps")&&!$util.isInteger(_.avgBitrateBps))return"avgBitrateBps: integer expected";if(_.attendeeId!=null&&_.hasOwnProperty("attendeeId")&&!$util.isString(_.attendeeId))return"attendeeId: string expected";if(_.mediaType!=null&&_.hasOwnProperty("mediaType"))switch(_.mediaType){default:return"mediaType: enum value expected";case 1:case 2:break}return _.externalUserId!=null&&_.hasOwnProperty("externalUserId")&&!$util.isString(_.externalUserId)?"externalUserId: string expected":_.width!=null&&_.hasOwnProperty("width")&&!$util.isInteger(_.width)?"width: integer expected":_.height!=null&&_.hasOwnProperty("height")&&!$util.isInteger(_.height)?"height: integer expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkStreamDescriptor)return _;var tt=new $root.SdkStreamDescriptor;switch(_.streamId!=null&&(tt.streamId=_.streamId>>>0),_.framerate!=null&&(tt.framerate=_.framerate>>>0),_.maxBitrateKbps!=null&&(tt.maxBitrateKbps=_.maxBitrateKbps>>>0),_.trackLabel!=null&&(tt.trackLabel=String(_.trackLabel)),_.groupId!=null&&(tt.groupId=_.groupId>>>0),_.avgBitrateBps!=null&&(tt.avgBitrateBps=_.avgBitrateBps>>>0),_.attendeeId!=null&&(tt.attendeeId=String(_.attendeeId)),_.mediaType){default:if(typeof _.mediaType=="number"){tt.mediaType=_.mediaType;break}break;case"AUDIO":case 1:tt.mediaType=1;break;case"VIDEO":case 2:tt.mediaType=2;break}return _.externalUserId!=null&&(tt.externalUserId=String(_.externalUserId)),_.width!=null&&(tt.width=_.width>>>0),_.height!=null&&(tt.height=_.height>>>0),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.streamId=0,nt.framerate=0,nt.maxBitrateKbps=0,nt.trackLabel="",nt.groupId=0,nt.avgBitrateBps=0,nt.attendeeId="",nt.mediaType=tt.enums===String?"AUDIO":1,nt.externalUserId="",nt.width=0,nt.height=0),_.streamId!=null&&_.hasOwnProperty("streamId")&&(nt.streamId=_.streamId),_.framerate!=null&&_.hasOwnProperty("framerate")&&(nt.framerate=_.framerate),_.maxBitrateKbps!=null&&_.hasOwnProperty("maxBitrateKbps")&&(nt.maxBitrateKbps=_.maxBitrateKbps),_.trackLabel!=null&&_.hasOwnProperty("trackLabel")&&(nt.trackLabel=_.trackLabel),_.groupId!=null&&_.hasOwnProperty("groupId")&&(nt.groupId=_.groupId),_.avgBitrateBps!=null&&_.hasOwnProperty("avgBitrateBps")&&(nt.avgBitrateBps=_.avgBitrateBps),_.attendeeId!=null&&_.hasOwnProperty("attendeeId")&&(nt.attendeeId=_.attendeeId),_.mediaType!=null&&_.hasOwnProperty("mediaType")&&(nt.mediaType=tt.enums===String?$root.SdkStreamMediaType[_.mediaType]===void 0?_.mediaType:$root.SdkStreamMediaType[_.mediaType]:_.mediaType),_.externalUserId!=null&&_.hasOwnProperty("externalUserId")&&(nt.externalUserId=_.externalUserId),_.width!=null&&_.hasOwnProperty("width")&&(nt.width=_.width),_.height!=null&&_.hasOwnProperty("height")&&(nt.height=_.height),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkStreamDescriptor"},et}();$root.SdkStreamAllocation=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.trackLabel="",et.prototype.streamId=0,et.prototype.groupId=0,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.trackLabel!=null&&Object.hasOwnProperty.call(_,"trackLabel")&&tt.uint32(10).string(_.trackLabel),_.streamId!=null&&Object.hasOwnProperty.call(_,"streamId")&&tt.uint32(16).uint32(_.streamId),_.groupId!=null&&Object.hasOwnProperty.call(_,"groupId")&&tt.uint32(24).uint32(_.groupId),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkStreamAllocation;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.trackLabel=_.string();break}case 2:{it.streamId=_.uint32();break}case 3:{it.groupId=_.uint32();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.trackLabel!=null&&_.hasOwnProperty("trackLabel")&&!$util.isString(_.trackLabel)?"trackLabel: string expected":_.streamId!=null&&_.hasOwnProperty("streamId")&&!$util.isInteger(_.streamId)?"streamId: integer expected":_.groupId!=null&&_.hasOwnProperty("groupId")&&!$util.isInteger(_.groupId)?"groupId: integer expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkStreamAllocation)return _;var tt=new $root.SdkStreamAllocation;return _.trackLabel!=null&&(tt.trackLabel=String(_.trackLabel)),_.streamId!=null&&(tt.streamId=_.streamId>>>0),_.groupId!=null&&(tt.groupId=_.groupId>>>0),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.trackLabel="",nt.streamId=0,nt.groupId=0),_.trackLabel!=null&&_.hasOwnProperty("trackLabel")&&(nt.trackLabel=_.trackLabel),_.streamId!=null&&_.hasOwnProperty("streamId")&&(nt.streamId=_.streamId),_.groupId!=null&&_.hasOwnProperty("groupId")&&(nt.groupId=_.groupId),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkStreamAllocation"},et}();$root.SdkTrackMapping=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.streamId=0,et.prototype.ssrc=0,et.prototype.trackLabel="",et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.streamId!=null&&Object.hasOwnProperty.call(_,"streamId")&&tt.uint32(8).uint32(_.streamId),_.ssrc!=null&&Object.hasOwnProperty.call(_,"ssrc")&&tt.uint32(16).uint32(_.ssrc),_.trackLabel!=null&&Object.hasOwnProperty.call(_,"trackLabel")&&tt.uint32(26).string(_.trackLabel),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkTrackMapping;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.streamId=_.uint32();break}case 2:{it.ssrc=_.uint32();break}case 3:{it.trackLabel=_.string();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.streamId!=null&&_.hasOwnProperty("streamId")&&!$util.isInteger(_.streamId)?"streamId: integer expected":_.ssrc!=null&&_.hasOwnProperty("ssrc")&&!$util.isInteger(_.ssrc)?"ssrc: integer expected":_.trackLabel!=null&&_.hasOwnProperty("trackLabel")&&!$util.isString(_.trackLabel)?"trackLabel: string expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkTrackMapping)return _;var tt=new $root.SdkTrackMapping;return _.streamId!=null&&(tt.streamId=_.streamId>>>0),_.ssrc!=null&&(tt.ssrc=_.ssrc>>>0),_.trackLabel!=null&&(tt.trackLabel=String(_.trackLabel)),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.streamId=0,nt.ssrc=0,nt.trackLabel=""),_.streamId!=null&&_.hasOwnProperty("streamId")&&(nt.streamId=_.streamId),_.ssrc!=null&&_.hasOwnProperty("ssrc")&&(nt.ssrc=_.ssrc),_.trackLabel!=null&&_.hasOwnProperty("trackLabel")&&(nt.trackLabel=_.trackLabel),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkTrackMapping"},et}();$root.SdkBitrate=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.sourceStreamId=0,et.prototype.avgBitrateBps=0,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.sourceStreamId!=null&&Object.hasOwnProperty.call(_,"sourceStreamId")&&tt.uint32(8).uint32(_.sourceStreamId),_.avgBitrateBps!=null&&Object.hasOwnProperty.call(_,"avgBitrateBps")&&tt.uint32(16).uint32(_.avgBitrateBps),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkBitrate;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.sourceStreamId=_.uint32();break}case 2:{it.avgBitrateBps=_.uint32();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.sourceStreamId!=null&&_.hasOwnProperty("sourceStreamId")&&!$util.isInteger(_.sourceStreamId)?"sourceStreamId: integer expected":_.avgBitrateBps!=null&&_.hasOwnProperty("avgBitrateBps")&&!$util.isInteger(_.avgBitrateBps)?"avgBitrateBps: integer expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkBitrate)return _;var tt=new $root.SdkBitrate;return _.sourceStreamId!=null&&(tt.sourceStreamId=_.sourceStreamId>>>0),_.avgBitrateBps!=null&&(tt.avgBitrateBps=_.avgBitrateBps>>>0),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.sourceStreamId=0,nt.avgBitrateBps=0),_.sourceStreamId!=null&&_.hasOwnProperty("sourceStreamId")&&(nt.sourceStreamId=_.sourceStreamId),_.avgBitrateBps!=null&&_.hasOwnProperty("avgBitrateBps")&&(nt.avgBitrateBps=_.avgBitrateBps),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkBitrate"},et}();$root.SdkAudioControlFrame=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.muted=!1,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.muted!=null&&Object.hasOwnProperty.call(_,"muted")&&tt.uint32(8).bool(_.muted),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkAudioControlFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.muted=_.bool();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.muted!=null&&_.hasOwnProperty("muted")&&typeof _.muted!="boolean"?"muted: boolean expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkAudioControlFrame)return _;var tt=new $root.SdkAudioControlFrame;return _.muted!=null&&(tt.muted=!!_.muted),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.muted=!1),_.muted!=null&&_.hasOwnProperty("muted")&&(nt.muted=_.muted),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkAudioControlFrame"},et}();$root.SdkAudioMetadataFrame=function(){function et($){if(this.attendeeStates=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.attendeeStates=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.attendeeStates!=null&&_.attendeeStates.length)for(var nt=0;nt<_.attendeeStates.length;++nt)$root.SdkAudioAttendeeState.encode(_.attendeeStates[nt],tt.uint32(10).fork()).ldelim();return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkAudioMetadataFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.attendeeStates&&it.attendeeStates.length||(it.attendeeStates=[]),it.attendeeStates.push($root.SdkAudioAttendeeState.decode(_,_.uint32()));break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.attendeeStates!=null&&_.hasOwnProperty("attendeeStates")){if(!Array.isArray(_.attendeeStates))return"attendeeStates: array expected";for(var tt=0;tt<_.attendeeStates.length;++tt){var nt=$root.SdkAudioAttendeeState.verify(_.attendeeStates[tt]);if(nt)return"attendeeStates."+nt}}return null},et.fromObject=function(_){if(_ instanceof $root.SdkAudioMetadataFrame)return _;var tt=new $root.SdkAudioMetadataFrame;if(_.attendeeStates){if(!Array.isArray(_.attendeeStates))throw TypeError(".SdkAudioMetadataFrame.attendeeStates: array expected");tt.attendeeStates=[];for(var nt=0;nt<_.attendeeStates.length;++nt){if(typeof _.attendeeStates[nt]!="object")throw TypeError(".SdkAudioMetadataFrame.attendeeStates: object expected");tt.attendeeStates[nt]=$root.SdkAudioAttendeeState.fromObject(_.attendeeStates[nt])}}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.attendeeStates=[]),_.attendeeStates&&_.attendeeStates.length){nt.attendeeStates=[];for(var it=0;it<_.attendeeStates.length;++it)nt.attendeeStates[it]=$root.SdkAudioAttendeeState.toObject(_.attendeeStates[it],tt)}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkAudioMetadataFrame"},et}();$root.SdkAudioAttendeeState=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.audioStreamId=0,et.prototype.volume=0,et.prototype.muted=!1,et.prototype.signalStrength=0,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.audioStreamId!=null&&Object.hasOwnProperty.call(_,"audioStreamId")&&tt.uint32(8).uint32(_.audioStreamId),_.volume!=null&&Object.hasOwnProperty.call(_,"volume")&&tt.uint32(16).uint32(_.volume),_.muted!=null&&Object.hasOwnProperty.call(_,"muted")&&tt.uint32(24).bool(_.muted),_.signalStrength!=null&&Object.hasOwnProperty.call(_,"signalStrength")&&tt.uint32(32).uint32(_.signalStrength),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkAudioAttendeeState;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.audioStreamId=_.uint32();break}case 2:{it.volume=_.uint32();break}case 3:{it.muted=_.bool();break}case 4:{it.signalStrength=_.uint32();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.audioStreamId!=null&&_.hasOwnProperty("audioStreamId")&&!$util.isInteger(_.audioStreamId)?"audioStreamId: integer expected":_.volume!=null&&_.hasOwnProperty("volume")&&!$util.isInteger(_.volume)?"volume: integer expected":_.muted!=null&&_.hasOwnProperty("muted")&&typeof _.muted!="boolean"?"muted: boolean expected":_.signalStrength!=null&&_.hasOwnProperty("signalStrength")&&!$util.isInteger(_.signalStrength)?"signalStrength: integer expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkAudioAttendeeState)return _;var tt=new $root.SdkAudioAttendeeState;return _.audioStreamId!=null&&(tt.audioStreamId=_.audioStreamId>>>0),_.volume!=null&&(tt.volume=_.volume>>>0),_.muted!=null&&(tt.muted=!!_.muted),_.signalStrength!=null&&(tt.signalStrength=_.signalStrength>>>0),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.audioStreamId=0,nt.volume=0,nt.muted=!1,nt.signalStrength=0),_.audioStreamId!=null&&_.hasOwnProperty("audioStreamId")&&(nt.audioStreamId=_.audioStreamId),_.volume!=null&&_.hasOwnProperty("volume")&&(nt.volume=_.volume),_.muted!=null&&_.hasOwnProperty("muted")&&(nt.muted=_.muted),_.signalStrength!=null&&_.hasOwnProperty("signalStrength")&&(nt.signalStrength=_.signalStrength),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkAudioAttendeeState"},et}();$root.SdkAudioStreamIdInfoFrame=function(){function et($){if(this.streams=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.streams=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.streams!=null&&_.streams.length)for(var nt=0;nt<_.streams.length;++nt)$root.SdkAudioStreamIdInfo.encode(_.streams[nt],tt.uint32(10).fork()).ldelim();return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkAudioStreamIdInfoFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.streams&&it.streams.length||(it.streams=[]),it.streams.push($root.SdkAudioStreamIdInfo.decode(_,_.uint32()));break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.streams!=null&&_.hasOwnProperty("streams")){if(!Array.isArray(_.streams))return"streams: array expected";for(var tt=0;tt<_.streams.length;++tt){var nt=$root.SdkAudioStreamIdInfo.verify(_.streams[tt]);if(nt)return"streams."+nt}}return null},et.fromObject=function(_){if(_ instanceof $root.SdkAudioStreamIdInfoFrame)return _;var tt=new $root.SdkAudioStreamIdInfoFrame;if(_.streams){if(!Array.isArray(_.streams))throw TypeError(".SdkAudioStreamIdInfoFrame.streams: array expected");tt.streams=[];for(var nt=0;nt<_.streams.length;++nt){if(typeof _.streams[nt]!="object")throw TypeError(".SdkAudioStreamIdInfoFrame.streams: object expected");tt.streams[nt]=$root.SdkAudioStreamIdInfo.fromObject(_.streams[nt])}}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.streams=[]),_.streams&&_.streams.length){nt.streams=[];for(var it=0;it<_.streams.length;++it)nt.streams[it]=$root.SdkAudioStreamIdInfo.toObject(_.streams[it],tt)}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkAudioStreamIdInfoFrame"},et}();$root.SdkAudioStreamIdInfo=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.audioStreamId=0,et.prototype.attendeeId="",et.prototype.muted=!1,et.prototype.externalUserId="",et.prototype.dropped=!1,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.audioStreamId!=null&&Object.hasOwnProperty.call(_,"audioStreamId")&&tt.uint32(8).uint32(_.audioStreamId),_.attendeeId!=null&&Object.hasOwnProperty.call(_,"attendeeId")&&tt.uint32(18).string(_.attendeeId),_.muted!=null&&Object.hasOwnProperty.call(_,"muted")&&tt.uint32(24).bool(_.muted),_.externalUserId!=null&&Object.hasOwnProperty.call(_,"externalUserId")&&tt.uint32(34).string(_.externalUserId),_.dropped!=null&&Object.hasOwnProperty.call(_,"dropped")&&tt.uint32(40).bool(_.dropped),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkAudioStreamIdInfo;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.audioStreamId=_.uint32();break}case 2:{it.attendeeId=_.string();break}case 3:{it.muted=_.bool();break}case 4:{it.externalUserId=_.string();break}case 5:{it.dropped=_.bool();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.audioStreamId!=null&&_.hasOwnProperty("audioStreamId")&&!$util.isInteger(_.audioStreamId)?"audioStreamId: integer expected":_.attendeeId!=null&&_.hasOwnProperty("attendeeId")&&!$util.isString(_.attendeeId)?"attendeeId: string expected":_.muted!=null&&_.hasOwnProperty("muted")&&typeof _.muted!="boolean"?"muted: boolean expected":_.externalUserId!=null&&_.hasOwnProperty("externalUserId")&&!$util.isString(_.externalUserId)?"externalUserId: string expected":_.dropped!=null&&_.hasOwnProperty("dropped")&&typeof _.dropped!="boolean"?"dropped: boolean expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkAudioStreamIdInfo)return _;var tt=new $root.SdkAudioStreamIdInfo;return _.audioStreamId!=null&&(tt.audioStreamId=_.audioStreamId>>>0),_.attendeeId!=null&&(tt.attendeeId=String(_.attendeeId)),_.muted!=null&&(tt.muted=!!_.muted),_.externalUserId!=null&&(tt.externalUserId=String(_.externalUserId)),_.dropped!=null&&(tt.dropped=!!_.dropped),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.audioStreamId=0,nt.attendeeId="",nt.muted=!1,nt.externalUserId="",nt.dropped=!1),_.audioStreamId!=null&&_.hasOwnProperty("audioStreamId")&&(nt.audioStreamId=_.audioStreamId),_.attendeeId!=null&&_.hasOwnProperty("attendeeId")&&(nt.attendeeId=_.attendeeId),_.muted!=null&&_.hasOwnProperty("muted")&&(nt.muted=_.muted),_.externalUserId!=null&&_.hasOwnProperty("externalUserId")&&(nt.externalUserId=_.externalUserId),_.dropped!=null&&_.hasOwnProperty("dropped")&&(nt.dropped=_.dropped),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkAudioStreamIdInfo"},et}();$root.SdkPingPongType=function(){var et={},$=Object.create(et);return $[et[1]="PING"]=1,$[et[2]="PONG"]=2,$}();$root.SdkPingPongFrame=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.type=1,et.prototype.pingId=0,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),tt.uint32(8).int32(_.type),tt.uint32(16).uint32(_.pingId),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkPingPongFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.type=_.int32();break}case 2:{it.pingId=_.uint32();break}default:_.skipType(rt&7);break}}if(!it.hasOwnProperty("type"))throw $util.ProtocolError("missing required 'type'",{instance:it});if(!it.hasOwnProperty("pingId"))throw $util.ProtocolError("missing required 'pingId'",{instance:it});return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";switch(_.type){default:return"type: enum value expected";case 1:case 2:break}return $util.isInteger(_.pingId)?null:"pingId: integer expected"},et.fromObject=function(_){if(_ instanceof $root.SdkPingPongFrame)return _;var tt=new $root.SdkPingPongFrame;switch(_.type){default:if(typeof _.type=="number"){tt.type=_.type;break}break;case"PING":case 1:tt.type=1;break;case"PONG":case 2:tt.type=2;break}return _.pingId!=null&&(tt.pingId=_.pingId>>>0),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.type=tt.enums===String?"PING":1,nt.pingId=0),_.type!=null&&_.hasOwnProperty("type")&&(nt.type=tt.enums===String?$root.SdkPingPongType[_.type]===void 0?_.type:$root.SdkPingPongType[_.type]:_.type),_.pingId!=null&&_.hasOwnProperty("pingId")&&(nt.pingId=_.pingId),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkPingPongFrame"},et}();$root.SdkAudioStatusFrame=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.audioStatus=0,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.audioStatus!=null&&Object.hasOwnProperty.call(_,"audioStatus")&&tt.uint32(8).uint32(_.audioStatus),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkAudioStatusFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.audioStatus=_.uint32();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.audioStatus!=null&&_.hasOwnProperty("audioStatus")&&!$util.isInteger(_.audioStatus)?"audioStatus: integer expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkAudioStatusFrame)return _;var tt=new $root.SdkAudioStatusFrame;return _.audioStatus!=null&&(tt.audioStatus=_.audioStatus>>>0),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.audioStatus=0),_.audioStatus!=null&&_.hasOwnProperty("audioStatus")&&(nt.audioStatus=_.audioStatus),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkAudioStatusFrame"},et}();$root.SdkMetric=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.type=1,et.prototype.value=0,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.type!=null&&Object.hasOwnProperty.call(_,"type")&&tt.uint32(8).int32(_.type),_.value!=null&&Object.hasOwnProperty.call(_,"value")&&tt.uint32(17).double(_.value),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkMetric;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.type=_.int32();break}case 2:{it.value=_.double();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.type!=null&&_.hasOwnProperty("type"))switch(_.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 60:case 64:case 66:case 69:case 72:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:break}return _.value!=null&&_.hasOwnProperty("value")&&typeof _.value!="number"?"value: number expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkMetric)return _;var tt=new $root.SdkMetric;switch(_.type){default:if(typeof _.type=="number"){tt.type=_.type;break}break;case"VIDEO_ACTUAL_ENCODER_BITRATE":case 1:tt.type=1;break;case"VIDEO_AVAILABLE_SEND_BANDWIDTH":case 2:tt.type=2;break;case"VIDEO_RETRANSMIT_BITRATE":case 3:tt.type=3;break;case"VIDEO_AVAILABLE_RECEIVE_BANDWIDTH":case 4:tt.type=4;break;case"VIDEO_TARGET_ENCODER_BITRATE":case 5:tt.type=5;break;case"VIDEO_BUCKET_DELAY_MS":case 6:tt.type=6;break;case"STUN_RTT_MS":case 7:tt.type=7;break;case"SOCKET_DISCARDED_PPS":case 8:tt.type=8;break;case"RTC_MIC_JITTER_MS":case 9:tt.type=9;break;case"RTC_MIC_PPS":case 10:tt.type=10;break;case"RTC_MIC_FRACTION_PACKET_LOST_PERCENT":case 11:tt.type=11;break;case"RTC_MIC_BITRATE":case 12:tt.type=12;break;case"RTC_MIC_RTT_MS":case 13:tt.type=13;break;case"RTC_SPK_PPS":case 14:tt.type=14;break;case"RTC_SPK_FRACTION_PACKET_LOST_PERCENT":case 15:tt.type=15;break;case"RTC_SPK_JITTER_MS":case 16:tt.type=16;break;case"RTC_SPK_FRACTION_DECODER_LOSS_PERCENT":case 17:tt.type=17;break;case"RTC_SPK_BITRATE":case 18:tt.type=18;break;case"RTC_SPK_CURRENT_DELAY_MS":case 19:tt.type=19;break;case"RTC_SPK_JITTER_BUFFER_MS":case 20:tt.type=20;break;case"VIDEO_SENT_RTT_MS":case 21:tt.type=21;break;case"VIDEO_ENCODE_USAGE_PERCENT":case 22:tt.type=22;break;case"VIDEO_NACKS_RECEIVED":case 23:tt.type=23;break;case"VIDEO_PLIS_RECEIVED":case 24:tt.type=24;break;case"VIDEO_ENCODE_MS":case 25:tt.type=25;break;case"VIDEO_INPUT_FPS":case 26:tt.type=26;break;case"VIDEO_ENCODE_FPS":case 27:tt.type=27;break;case"VIDEO_SENT_FPS":case 28:tt.type=28;break;case"VIDEO_FIRS_RECEIVED":case 29:tt.type=29;break;case"VIDEO_SENT_PPS":case 30:tt.type=30;break;case"VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT":case 31:tt.type=31;break;case"VIDEO_SENT_BITRATE":case 32:tt.type=32;break;case"VIDEO_DROPPED_FPS":case 33:tt.type=33;break;case"VIDEO_TARGET_DELAY_MS":case 34:tt.type=34;break;case"VIDEO_DECODE_MS":case 35:tt.type=35;break;case"VIDEO_OUTPUT_FPS":case 36:tt.type=36;break;case"VIDEO_RECEIVED_PPS":case 37:tt.type=37;break;case"VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT":case 38:tt.type=38;break;case"VIDEO_RENDER_DELAY_MS":case 39:tt.type=39;break;case"VIDEO_RECEIVED_FPS":case 40:tt.type=40;break;case"VIDEO_DECODE_FPS":case 41:tt.type=41;break;case"VIDEO_NACKS_SENT":case 42:tt.type=42;break;case"VIDEO_FIRS_SENT":case 43:tt.type=43;break;case"VIDEO_RECEIVED_BITRATE":case 44:tt.type=44;break;case"VIDEO_CURRENT_DELAY_MS":case 45:tt.type=45;break;case"VIDEO_JITTER_BUFFER_MS":case 46:tt.type=46;break;case"VIDEO_DISCARDED_PPS":case 47:tt.type=47;break;case"VIDEO_PLIS_SENT":case 48:tt.type=48;break;case"VIDEO_RECEIVED_JITTER_MS":case 49:tt.type=49;break;case"VIDEO_INPUT_HEIGHT":case 60:tt.type=60;break;case"VIDEO_ENCODE_HEIGHT":case 64:tt.type=64;break;case"VIDEO_SENT_QP_SUM":case 66:tt.type=66;break;case"VIDEO_DECODE_HEIGHT":case 69:tt.type=69;break;case"VIDEO_RECEIVED_QP_SUM":case 72:tt.type=72;break;case"VIDEO_ENCODE_WIDTH":case 86:tt.type=86;break;case"VIDEO_DECODE_WIDTH":case 87:tt.type=87;break;case"VIDEO_ENCODER_IS_HARDWARE":case 88:tt.type=88;break;case"VIDEO_DECODER_IS_HARDWARE":case 89:tt.type=89;break;case"VIDEO_FREEZE_COUNT":case 90:tt.type=90;break;case"VIDEO_FREEZE_DURATION":case 91:tt.type=91;break;case"VIDEO_PAUSE_COUNT":case 92:tt.type=92;break;case"VIDEO_PAUSE_DURATION":case 93:tt.type=93;break;case"VIDEO_QUALITY_REASON":case 94:tt.type=94;break;case"VIDEO_PROCESSING_TIME":case 95:tt.type=95;break;case"RTC_SPK_AUDIO_LEVEL":case 96:tt.type=96;break;case"RTC_MIC_AUDIO_LEVEL":case 97:tt.type=97;break;case"RTC_SPK_TOTAL_LOST":case 98:tt.type=98;break;case"RTC_SPK_TOTAL_EXPECTED":case 99:tt.type=99;break;case"RTC_SPK_TOTAL_RECOVERED_RED":case 100:tt.type=100;break;case"RTC_SPK_TOTAL_RECOVERED_FEC":case 101:tt.type=101;break;case"VIDEO_QUALITY_LIMITATION_DURATION_CPU":case 102:tt.type=102;break;case"VIDEO_CODEC_DEGRADATION_HIGH_ENCODE_CPU":case 103:tt.type=103;break;case"VIDEO_CODEC_DEGRADATION_ENCODE_FAILURE":case 104:tt.type=104;break;case"VIDEO_RENDER_HEIGHT":case 105:tt.type=105;break;case"VIDEO_RENDER_WIDTH":case 106:tt.type=106;break;case"VIDEO_INPUT_WIDTH":case 107:tt.type=107;break;case"VIDEO_SENT_JITTER_MS":case 108:tt.type=108;break}return _.value!=null&&(tt.value=Number(_.value)),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.type=tt.enums===String?"VIDEO_ACTUAL_ENCODER_BITRATE":1,nt.value=0),_.type!=null&&_.hasOwnProperty("type")&&(nt.type=tt.enums===String?$root.SdkMetric.Type[_.type]===void 0?_.type:$root.SdkMetric.Type[_.type]:_.type),_.value!=null&&_.hasOwnProperty("value")&&(nt.value=tt.json&&!isFinite(_.value)?String(_.value):_.value),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkMetric"},et.Type=function(){var $={},_=Object.create($);return _[$[1]="VIDEO_ACTUAL_ENCODER_BITRATE"]=1,_[$[2]="VIDEO_AVAILABLE_SEND_BANDWIDTH"]=2,_[$[3]="VIDEO_RETRANSMIT_BITRATE"]=3,_[$[4]="VIDEO_AVAILABLE_RECEIVE_BANDWIDTH"]=4,_[$[5]="VIDEO_TARGET_ENCODER_BITRATE"]=5,_[$[6]="VIDEO_BUCKET_DELAY_MS"]=6,_[$[7]="STUN_RTT_MS"]=7,_[$[8]="SOCKET_DISCARDED_PPS"]=8,_[$[9]="RTC_MIC_JITTER_MS"]=9,_[$[10]="RTC_MIC_PPS"]=10,_[$[11]="RTC_MIC_FRACTION_PACKET_LOST_PERCENT"]=11,_[$[12]="RTC_MIC_BITRATE"]=12,_[$[13]="RTC_MIC_RTT_MS"]=13,_[$[14]="RTC_SPK_PPS"]=14,_[$[15]="RTC_SPK_FRACTION_PACKET_LOST_PERCENT"]=15,_[$[16]="RTC_SPK_JITTER_MS"]=16,_[$[17]="RTC_SPK_FRACTION_DECODER_LOSS_PERCENT"]=17,_[$[18]="RTC_SPK_BITRATE"]=18,_[$[19]="RTC_SPK_CURRENT_DELAY_MS"]=19,_[$[20]="RTC_SPK_JITTER_BUFFER_MS"]=20,_[$[21]="VIDEO_SENT_RTT_MS"]=21,_[$[22]="VIDEO_ENCODE_USAGE_PERCENT"]=22,_[$[23]="VIDEO_NACKS_RECEIVED"]=23,_[$[24]="VIDEO_PLIS_RECEIVED"]=24,_[$[25]="VIDEO_ENCODE_MS"]=25,_[$[26]="VIDEO_INPUT_FPS"]=26,_[$[27]="VIDEO_ENCODE_FPS"]=27,_[$[28]="VIDEO_SENT_FPS"]=28,_[$[29]="VIDEO_FIRS_RECEIVED"]=29,_[$[30]="VIDEO_SENT_PPS"]=30,_[$[31]="VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT"]=31,_[$[32]="VIDEO_SENT_BITRATE"]=32,_[$[33]="VIDEO_DROPPED_FPS"]=33,_[$[34]="VIDEO_TARGET_DELAY_MS"]=34,_[$[35]="VIDEO_DECODE_MS"]=35,_[$[36]="VIDEO_OUTPUT_FPS"]=36,_[$[37]="VIDEO_RECEIVED_PPS"]=37,_[$[38]="VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT"]=38,_[$[39]="VIDEO_RENDER_DELAY_MS"]=39,_[$[40]="VIDEO_RECEIVED_FPS"]=40,_[$[41]="VIDEO_DECODE_FPS"]=41,_[$[42]="VIDEO_NACKS_SENT"]=42,_[$[43]="VIDEO_FIRS_SENT"]=43,_[$[44]="VIDEO_RECEIVED_BITRATE"]=44,_[$[45]="VIDEO_CURRENT_DELAY_MS"]=45,_[$[46]="VIDEO_JITTER_BUFFER_MS"]=46,_[$[47]="VIDEO_DISCARDED_PPS"]=47,_[$[48]="VIDEO_PLIS_SENT"]=48,_[$[49]="VIDEO_RECEIVED_JITTER_MS"]=49,_[$[60]="VIDEO_INPUT_HEIGHT"]=60,_[$[64]="VIDEO_ENCODE_HEIGHT"]=64,_[$[66]="VIDEO_SENT_QP_SUM"]=66,_[$[69]="VIDEO_DECODE_HEIGHT"]=69,_[$[72]="VIDEO_RECEIVED_QP_SUM"]=72,_[$[86]="VIDEO_ENCODE_WIDTH"]=86,_[$[87]="VIDEO_DECODE_WIDTH"]=87,_[$[88]="VIDEO_ENCODER_IS_HARDWARE"]=88,_[$[89]="VIDEO_DECODER_IS_HARDWARE"]=89,_[$[90]="VIDEO_FREEZE_COUNT"]=90,_[$[91]="VIDEO_FREEZE_DURATION"]=91,_[$[92]="VIDEO_PAUSE_COUNT"]=92,_[$[93]="VIDEO_PAUSE_DURATION"]=93,_[$[94]="VIDEO_QUALITY_REASON"]=94,_[$[95]="VIDEO_PROCESSING_TIME"]=95,_[$[96]="RTC_SPK_AUDIO_LEVEL"]=96,_[$[97]="RTC_MIC_AUDIO_LEVEL"]=97,_[$[98]="RTC_SPK_TOTAL_LOST"]=98,_[$[99]="RTC_SPK_TOTAL_EXPECTED"]=99,_[$[100]="RTC_SPK_TOTAL_RECOVERED_RED"]=100,_[$[101]="RTC_SPK_TOTAL_RECOVERED_FEC"]=101,_[$[102]="VIDEO_QUALITY_LIMITATION_DURATION_CPU"]=102,_[$[103]="VIDEO_CODEC_DEGRADATION_HIGH_ENCODE_CPU"]=103,_[$[104]="VIDEO_CODEC_DEGRADATION_ENCODE_FAILURE"]=104,_[$[105]="VIDEO_RENDER_HEIGHT"]=105,_[$[106]="VIDEO_RENDER_WIDTH"]=106,_[$[107]="VIDEO_INPUT_WIDTH"]=107,_[$[108]="VIDEO_SENT_JITTER_MS"]=108,_}(),et}();$root.SdkStreamMetricFrame=function(){function et($){if(this.metrics=[],this.dimensions=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.streamId=0,et.prototype.groupId=0,et.prototype.metrics=$util.emptyArray,et.prototype.dimensions=$util.emptyArray,et.prototype.mediaType=1,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.streamId!=null&&Object.hasOwnProperty.call(_,"streamId")&&tt.uint32(24).uint32(_.streamId),_.groupId!=null&&Object.hasOwnProperty.call(_,"groupId")&&tt.uint32(32).uint32(_.groupId),_.metrics!=null&&_.metrics.length)for(var nt=0;nt<_.metrics.length;++nt)$root.SdkMetric.encode(_.metrics[nt],tt.uint32(42).fork()).ldelim();if(_.dimensions!=null&&_.dimensions.length)for(var nt=0;nt<_.dimensions.length;++nt)$root.SdkStreamDimension.encode(_.dimensions[nt],tt.uint32(50).fork()).ldelim();return _.mediaType!=null&&Object.hasOwnProperty.call(_,"mediaType")&&tt.uint32(56).int32(_.mediaType),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkStreamMetricFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 3:{it.streamId=_.uint32();break}case 4:{it.groupId=_.uint32();break}case 5:{it.metrics&&it.metrics.length||(it.metrics=[]),it.metrics.push($root.SdkMetric.decode(_,_.uint32()));break}case 6:{it.dimensions&&it.dimensions.length||(it.dimensions=[]),it.dimensions.push($root.SdkStreamDimension.decode(_,_.uint32()));break}case 7:{it.mediaType=_.int32();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.streamId!=null&&_.hasOwnProperty("streamId")&&!$util.isInteger(_.streamId))return"streamId: integer expected";if(_.groupId!=null&&_.hasOwnProperty("groupId")&&!$util.isInteger(_.groupId))return"groupId: integer expected";if(_.metrics!=null&&_.hasOwnProperty("metrics")){if(!Array.isArray(_.metrics))return"metrics: array expected";for(var tt=0;tt<_.metrics.length;++tt){var nt=$root.SdkMetric.verify(_.metrics[tt]);if(nt)return"metrics."+nt}}if(_.dimensions!=null&&_.hasOwnProperty("dimensions")){if(!Array.isArray(_.dimensions))return"dimensions: array expected";for(var tt=0;tt<_.dimensions.length;++tt){var nt=$root.SdkStreamDimension.verify(_.dimensions[tt]);if(nt)return"dimensions."+nt}}if(_.mediaType!=null&&_.hasOwnProperty("mediaType"))switch(_.mediaType){default:return"mediaType: enum value expected";case 1:case 2:break}return null},et.fromObject=function(_){if(_ instanceof $root.SdkStreamMetricFrame)return _;var tt=new $root.SdkStreamMetricFrame;if(_.streamId!=null&&(tt.streamId=_.streamId>>>0),_.groupId!=null&&(tt.groupId=_.groupId>>>0),_.metrics){if(!Array.isArray(_.metrics))throw TypeError(".SdkStreamMetricFrame.metrics: array expected");tt.metrics=[];for(var nt=0;nt<_.metrics.length;++nt){if(typeof _.metrics[nt]!="object")throw TypeError(".SdkStreamMetricFrame.metrics: object expected");tt.metrics[nt]=$root.SdkMetric.fromObject(_.metrics[nt])}}if(_.dimensions){if(!Array.isArray(_.dimensions))throw TypeError(".SdkStreamMetricFrame.dimensions: array expected");tt.dimensions=[];for(var nt=0;nt<_.dimensions.length;++nt){if(typeof _.dimensions[nt]!="object")throw TypeError(".SdkStreamMetricFrame.dimensions: object expected");tt.dimensions[nt]=$root.SdkStreamDimension.fromObject(_.dimensions[nt])}}switch(_.mediaType){default:if(typeof _.mediaType=="number"){tt.mediaType=_.mediaType;break}break;case"AUDIO":case 1:tt.mediaType=1;break;case"VIDEO":case 2:tt.mediaType=2;break}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.metrics=[],nt.dimensions=[]),tt.defaults&&(nt.streamId=0,nt.groupId=0,nt.mediaType=tt.enums===String?"AUDIO":1),_.streamId!=null&&_.hasOwnProperty("streamId")&&(nt.streamId=_.streamId),_.groupId!=null&&_.hasOwnProperty("groupId")&&(nt.groupId=_.groupId),_.metrics&&_.metrics.length){nt.metrics=[];for(var it=0;it<_.metrics.length;++it)nt.metrics[it]=$root.SdkMetric.toObject(_.metrics[it],tt)}if(_.dimensions&&_.dimensions.length){nt.dimensions=[];for(var it=0;it<_.dimensions.length;++it)nt.dimensions[it]=$root.SdkStreamDimension.toObject(_.dimensions[it],tt)}return _.mediaType!=null&&_.hasOwnProperty("mediaType")&&(nt.mediaType=tt.enums===String?$root.SdkStreamMediaType[_.mediaType]===void 0?_.mediaType:$root.SdkStreamMediaType[_.mediaType]:_.mediaType),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkStreamMetricFrame"},et}();$root.SdkClientMetricFrame=function(){function et($){if(this.globalMetrics=[],this.streamMetricFrames=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.globalMetrics=$util.emptyArray,et.prototype.streamMetricFrames=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.globalMetrics!=null&&_.globalMetrics.length)for(var nt=0;nt<_.globalMetrics.length;++nt)$root.SdkMetric.encode(_.globalMetrics[nt],tt.uint32(10).fork()).ldelim();if(_.streamMetricFrames!=null&&_.streamMetricFrames.length)for(var nt=0;nt<_.streamMetricFrames.length;++nt)$root.SdkStreamMetricFrame.encode(_.streamMetricFrames[nt],tt.uint32(18).fork()).ldelim();return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkClientMetricFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.globalMetrics&&it.globalMetrics.length||(it.globalMetrics=[]),it.globalMetrics.push($root.SdkMetric.decode(_,_.uint32()));break}case 2:{it.streamMetricFrames&&it.streamMetricFrames.length||(it.streamMetricFrames=[]),it.streamMetricFrames.push($root.SdkStreamMetricFrame.decode(_,_.uint32()));break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.globalMetrics!=null&&_.hasOwnProperty("globalMetrics")){if(!Array.isArray(_.globalMetrics))return"globalMetrics: array expected";for(var tt=0;tt<_.globalMetrics.length;++tt){var nt=$root.SdkMetric.verify(_.globalMetrics[tt]);if(nt)return"globalMetrics."+nt}}if(_.streamMetricFrames!=null&&_.hasOwnProperty("streamMetricFrames")){if(!Array.isArray(_.streamMetricFrames))return"streamMetricFrames: array expected";for(var tt=0;tt<_.streamMetricFrames.length;++tt){var nt=$root.SdkStreamMetricFrame.verify(_.streamMetricFrames[tt]);if(nt)return"streamMetricFrames."+nt}}return null},et.fromObject=function(_){if(_ instanceof $root.SdkClientMetricFrame)return _;var tt=new $root.SdkClientMetricFrame;if(_.globalMetrics){if(!Array.isArray(_.globalMetrics))throw TypeError(".SdkClientMetricFrame.globalMetrics: array expected");tt.globalMetrics=[];for(var nt=0;nt<_.globalMetrics.length;++nt){if(typeof _.globalMetrics[nt]!="object")throw TypeError(".SdkClientMetricFrame.globalMetrics: object expected");tt.globalMetrics[nt]=$root.SdkMetric.fromObject(_.globalMetrics[nt])}}if(_.streamMetricFrames){if(!Array.isArray(_.streamMetricFrames))throw TypeError(".SdkClientMetricFrame.streamMetricFrames: array expected");tt.streamMetricFrames=[];for(var nt=0;nt<_.streamMetricFrames.length;++nt){if(typeof _.streamMetricFrames[nt]!="object")throw TypeError(".SdkClientMetricFrame.streamMetricFrames: object expected");tt.streamMetricFrames[nt]=$root.SdkStreamMetricFrame.fromObject(_.streamMetricFrames[nt])}}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.globalMetrics=[],nt.streamMetricFrames=[]),_.globalMetrics&&_.globalMetrics.length){nt.globalMetrics=[];for(var it=0;it<_.globalMetrics.length;++it)nt.globalMetrics[it]=$root.SdkMetric.toObject(_.globalMetrics[it],tt)}if(_.streamMetricFrames&&_.streamMetricFrames.length){nt.streamMetricFrames=[];for(var it=0;it<_.streamMetricFrames.length;++it)nt.streamMetricFrames[it]=$root.SdkStreamMetricFrame.toObject(_.streamMetricFrames[it],tt)}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkClientMetricFrame"},et}();$root.SdkStreamDimension=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.type=1,et.prototype.value=null,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.type!=null&&Object.hasOwnProperty.call(_,"type")&&tt.uint32(8).int32(_.type),_.value!=null&&Object.hasOwnProperty.call(_,"value")&&$root.SdkDimensionValue.encode(_.value,tt.uint32(18).fork()).ldelim(),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkStreamDimension;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.type=_.int32();break}case 2:{it.value=$root.SdkDimensionValue.decode(_,_.uint32());break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.type!=null&&_.hasOwnProperty("type"))switch(_.type){default:return"type: enum value expected";case 1:case 2:break}if(_.value!=null&&_.hasOwnProperty("value")){var tt=$root.SdkDimensionValue.verify(_.value);if(tt)return"value."+tt}return null},et.fromObject=function(_){if(_ instanceof $root.SdkStreamDimension)return _;var tt=new $root.SdkStreamDimension;switch(_.type){default:if(typeof _.type=="number"){tt.type=_.type;break}break;case"VIDEO_ENCODER_NAME":case 1:tt.type=1;break;case"VIDEO_DECODER_NAME":case 2:tt.type=2;break}if(_.value!=null){if(typeof _.value!="object")throw TypeError(".SdkStreamDimension.value: object expected");tt.value=$root.SdkDimensionValue.fromObject(_.value)}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.type=tt.enums===String?"VIDEO_ENCODER_NAME":1,nt.value=null),_.type!=null&&_.hasOwnProperty("type")&&(nt.type=tt.enums===String?$root.SdkStreamDimension.Type[_.type]===void 0?_.type:$root.SdkStreamDimension.Type[_.type]:_.type),_.value!=null&&_.hasOwnProperty("value")&&(nt.value=$root.SdkDimensionValue.toObject(_.value,tt)),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkStreamDimension"},et.Type=function(){var $={},_=Object.create($);return _[$[1]="VIDEO_ENCODER_NAME"]=1,_[$[2]="VIDEO_DECODER_NAME"]=2,_}(),et}();$root.SdkDimensionValue=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.stringValue="",et.prototype.boolValue=!1,et.prototype.uintValue=$util.Long?$util.Long.fromBits(0,0,!0):0,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.stringValue!=null&&Object.hasOwnProperty.call(_,"stringValue")&&tt.uint32(10).string(_.stringValue),_.boolValue!=null&&Object.hasOwnProperty.call(_,"boolValue")&&tt.uint32(16).bool(_.boolValue),_.uintValue!=null&&Object.hasOwnProperty.call(_,"uintValue")&&tt.uint32(24).uint64(_.uintValue),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkDimensionValue;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.stringValue=_.string();break}case 2:{it.boolValue=_.bool();break}case 3:{it.uintValue=_.uint64();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.stringValue!=null&&_.hasOwnProperty("stringValue")&&!$util.isString(_.stringValue)?"stringValue: string expected":_.boolValue!=null&&_.hasOwnProperty("boolValue")&&typeof _.boolValue!="boolean"?"boolValue: boolean expected":_.uintValue!=null&&_.hasOwnProperty("uintValue")&&!$util.isInteger(_.uintValue)&&!(_.uintValue&&$util.isInteger(_.uintValue.low)&&$util.isInteger(_.uintValue.high))?"uintValue: integer|Long expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkDimensionValue)return _;var tt=new $root.SdkDimensionValue;return _.stringValue!=null&&(tt.stringValue=String(_.stringValue)),_.boolValue!=null&&(tt.boolValue=!!_.boolValue),_.uintValue!=null&&($util.Long?(tt.uintValue=$util.Long.fromValue(_.uintValue)).unsigned=!0:typeof _.uintValue=="string"?tt.uintValue=parseInt(_.uintValue,10):typeof _.uintValue=="number"?tt.uintValue=_.uintValue:typeof _.uintValue=="object"&&(tt.uintValue=new $util.LongBits(_.uintValue.low>>>0,_.uintValue.high>>>0).toNumber(!0))),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if(tt.defaults)if(nt.stringValue="",nt.boolValue=!1,$util.Long){var it=new $util.Long(0,0,!0);nt.uintValue=tt.longs===String?it.toString():tt.longs===Number?it.toNumber():it}else nt.uintValue=tt.longs===String?"0":0;return _.stringValue!=null&&_.hasOwnProperty("stringValue")&&(nt.stringValue=_.stringValue),_.boolValue!=null&&_.hasOwnProperty("boolValue")&&(nt.boolValue=_.boolValue),_.uintValue!=null&&_.hasOwnProperty("uintValue")&&(typeof _.uintValue=="number"?nt.uintValue=tt.longs===String?String(_.uintValue):_.uintValue:nt.uintValue=tt.longs===String?$util.Long.prototype.toString.call(_.uintValue):tt.longs===Number?new $util.LongBits(_.uintValue.low>>>0,_.uintValue.high>>>0).toNumber(!0):_.uintValue),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkDimensionValue"},et}();$root.SdkDataMessageFrame=function(){function et($){if(this.messages=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.messages=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.messages!=null&&_.messages.length)for(var nt=0;nt<_.messages.length;++nt)$root.SdkDataMessagePayload.encode(_.messages[nt],tt.uint32(10).fork()).ldelim();return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkDataMessageFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.messages&&it.messages.length||(it.messages=[]),it.messages.push($root.SdkDataMessagePayload.decode(_,_.uint32()));break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.messages!=null&&_.hasOwnProperty("messages")){if(!Array.isArray(_.messages))return"messages: array expected";for(var tt=0;tt<_.messages.length;++tt){var nt=$root.SdkDataMessagePayload.verify(_.messages[tt]);if(nt)return"messages."+nt}}return null},et.fromObject=function(_){if(_ instanceof $root.SdkDataMessageFrame)return _;var tt=new $root.SdkDataMessageFrame;if(_.messages){if(!Array.isArray(_.messages))throw TypeError(".SdkDataMessageFrame.messages: array expected");tt.messages=[];for(var nt=0;nt<_.messages.length;++nt){if(typeof _.messages[nt]!="object")throw TypeError(".SdkDataMessageFrame.messages: object expected");tt.messages[nt]=$root.SdkDataMessagePayload.fromObject(_.messages[nt])}}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.messages=[]),_.messages&&_.messages.length){nt.messages=[];for(var it=0;it<_.messages.length;++it)nt.messages[it]=$root.SdkDataMessagePayload.toObject(_.messages[it],tt)}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkDataMessageFrame"},et}();$root.SdkDataMessagePayload=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.topic="",et.prototype.data=$util.newBuffer([]),et.prototype.lifetimeMs=0,et.prototype.senderAttendeeId="",et.prototype.ingestTimeNs=$util.Long?$util.Long.fromBits(0,0,!1):0,et.prototype.senderExternalUserId="",et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.topic!=null&&Object.hasOwnProperty.call(_,"topic")&&tt.uint32(10).string(_.topic),_.data!=null&&Object.hasOwnProperty.call(_,"data")&&tt.uint32(18).bytes(_.data),_.lifetimeMs!=null&&Object.hasOwnProperty.call(_,"lifetimeMs")&&tt.uint32(24).uint32(_.lifetimeMs),_.senderAttendeeId!=null&&Object.hasOwnProperty.call(_,"senderAttendeeId")&&tt.uint32(34).string(_.senderAttendeeId),_.ingestTimeNs!=null&&Object.hasOwnProperty.call(_,"ingestTimeNs")&&tt.uint32(40).int64(_.ingestTimeNs),_.senderExternalUserId!=null&&Object.hasOwnProperty.call(_,"senderExternalUserId")&&tt.uint32(50).string(_.senderExternalUserId),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkDataMessagePayload;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.topic=_.string();break}case 2:{it.data=_.bytes();break}case 3:{it.lifetimeMs=_.uint32();break}case 4:{it.senderAttendeeId=_.string();break}case 5:{it.ingestTimeNs=_.int64();break}case 6:{it.senderExternalUserId=_.string();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.topic!=null&&_.hasOwnProperty("topic")&&!$util.isString(_.topic)?"topic: string expected":_.data!=null&&_.hasOwnProperty("data")&&!(_.data&&typeof _.data.length=="number"||$util.isString(_.data))?"data: buffer expected":_.lifetimeMs!=null&&_.hasOwnProperty("lifetimeMs")&&!$util.isInteger(_.lifetimeMs)?"lifetimeMs: integer expected":_.senderAttendeeId!=null&&_.hasOwnProperty("senderAttendeeId")&&!$util.isString(_.senderAttendeeId)?"senderAttendeeId: string expected":_.ingestTimeNs!=null&&_.hasOwnProperty("ingestTimeNs")&&!$util.isInteger(_.ingestTimeNs)&&!(_.ingestTimeNs&&$util.isInteger(_.ingestTimeNs.low)&&$util.isInteger(_.ingestTimeNs.high))?"ingestTimeNs: integer|Long expected":_.senderExternalUserId!=null&&_.hasOwnProperty("senderExternalUserId")&&!$util.isString(_.senderExternalUserId)?"senderExternalUserId: string expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkDataMessagePayload)return _;var tt=new $root.SdkDataMessagePayload;return _.topic!=null&&(tt.topic=String(_.topic)),_.data!=null&&(typeof _.data=="string"?$util.base64.decode(_.data,tt.data=$util.newBuffer($util.base64.length(_.data)),0):_.data.length>=0&&(tt.data=_.data)),_.lifetimeMs!=null&&(tt.lifetimeMs=_.lifetimeMs>>>0),_.senderAttendeeId!=null&&(tt.senderAttendeeId=String(_.senderAttendeeId)),_.ingestTimeNs!=null&&($util.Long?(tt.ingestTimeNs=$util.Long.fromValue(_.ingestTimeNs)).unsigned=!1:typeof _.ingestTimeNs=="string"?tt.ingestTimeNs=parseInt(_.ingestTimeNs,10):typeof _.ingestTimeNs=="number"?tt.ingestTimeNs=_.ingestTimeNs:typeof _.ingestTimeNs=="object"&&(tt.ingestTimeNs=new $util.LongBits(_.ingestTimeNs.low>>>0,_.ingestTimeNs.high>>>0).toNumber())),_.senderExternalUserId!=null&&(tt.senderExternalUserId=String(_.senderExternalUserId)),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if(tt.defaults){if(nt.topic="",tt.bytes===String?nt.data="":(nt.data=[],tt.bytes!==Array&&(nt.data=$util.newBuffer(nt.data))),nt.lifetimeMs=0,nt.senderAttendeeId="",$util.Long){var it=new $util.Long(0,0,!1);nt.ingestTimeNs=tt.longs===String?it.toString():tt.longs===Number?it.toNumber():it}else nt.ingestTimeNs=tt.longs===String?"0":0;nt.senderExternalUserId=""}return _.topic!=null&&_.hasOwnProperty("topic")&&(nt.topic=_.topic),_.data!=null&&_.hasOwnProperty("data")&&(nt.data=tt.bytes===String?$util.base64.encode(_.data,0,_.data.length):tt.bytes===Array?Array.prototype.slice.call(_.data):_.data),_.lifetimeMs!=null&&_.hasOwnProperty("lifetimeMs")&&(nt.lifetimeMs=_.lifetimeMs),_.senderAttendeeId!=null&&_.hasOwnProperty("senderAttendeeId")&&(nt.senderAttendeeId=_.senderAttendeeId),_.ingestTimeNs!=null&&_.hasOwnProperty("ingestTimeNs")&&(typeof _.ingestTimeNs=="number"?nt.ingestTimeNs=tt.longs===String?String(_.ingestTimeNs):_.ingestTimeNs:nt.ingestTimeNs=tt.longs===String?$util.Long.prototype.toString.call(_.ingestTimeNs):tt.longs===Number?new $util.LongBits(_.ingestTimeNs.low>>>0,_.ingestTimeNs.high>>>0).toNumber():_.ingestTimeNs),_.senderExternalUserId!=null&&_.hasOwnProperty("senderExternalUserId")&&(nt.senderExternalUserId=_.senderExternalUserId),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkDataMessagePayload"},et}();$root.SdkTurnCredentials=function(){function et($){if(this.uris=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.username="",et.prototype.password="",et.prototype.ttl=0,et.prototype.uris=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.username!=null&&Object.hasOwnProperty.call(_,"username")&&tt.uint32(10).string(_.username),_.password!=null&&Object.hasOwnProperty.call(_,"password")&&tt.uint32(18).string(_.password),_.ttl!=null&&Object.hasOwnProperty.call(_,"ttl")&&tt.uint32(24).uint32(_.ttl),_.uris!=null&&_.uris.length)for(var nt=0;nt<_.uris.length;++nt)tt.uint32(34).string(_.uris[nt]);return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkTurnCredentials;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.username=_.string();break}case 2:{it.password=_.string();break}case 3:{it.ttl=_.uint32();break}case 4:{it.uris&&it.uris.length||(it.uris=[]),it.uris.push(_.string());break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.username!=null&&_.hasOwnProperty("username")&&!$util.isString(_.username))return"username: string expected";if(_.password!=null&&_.hasOwnProperty("password")&&!$util.isString(_.password))return"password: string expected";if(_.ttl!=null&&_.hasOwnProperty("ttl")&&!$util.isInteger(_.ttl))return"ttl: integer expected";if(_.uris!=null&&_.hasOwnProperty("uris")){if(!Array.isArray(_.uris))return"uris: array expected";for(var tt=0;tt<_.uris.length;++tt)if(!$util.isString(_.uris[tt]))return"uris: string[] expected"}return null},et.fromObject=function(_){if(_ instanceof $root.SdkTurnCredentials)return _;var tt=new $root.SdkTurnCredentials;if(_.username!=null&&(tt.username=String(_.username)),_.password!=null&&(tt.password=String(_.password)),_.ttl!=null&&(tt.ttl=_.ttl>>>0),_.uris){if(!Array.isArray(_.uris))throw TypeError(".SdkTurnCredentials.uris: array expected");tt.uris=[];for(var nt=0;nt<_.uris.length;++nt)tt.uris[nt]=String(_.uris[nt])}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.uris=[]),tt.defaults&&(nt.username="",nt.password="",nt.ttl=0),_.username!=null&&_.hasOwnProperty("username")&&(nt.username=_.username),_.password!=null&&_.hasOwnProperty("password")&&(nt.password=_.password),_.ttl!=null&&_.hasOwnProperty("ttl")&&(nt.ttl=_.ttl),_.uris&&_.uris.length){nt.uris=[];for(var it=0;it<_.uris.length;++it)nt.uris[it]=_.uris[it]}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkTurnCredentials"},et}();$root.SdkTranscriptItem=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.content="",et.prototype.endTime=$util.Long?$util.Long.fromBits(0,0,!1):0,et.prototype.speakerAttendeeId="",et.prototype.speakerExternalUserId="",et.prototype.startTime=$util.Long?$util.Long.fromBits(0,0,!1):0,et.prototype.type=1,et.prototype.vocabularyFilterMatch=!1,et.prototype.confidence=0,et.prototype.stable=!1,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.content!=null&&Object.hasOwnProperty.call(_,"content")&&tt.uint32(10).string(_.content),_.endTime!=null&&Object.hasOwnProperty.call(_,"endTime")&&tt.uint32(16).int64(_.endTime),_.speakerAttendeeId!=null&&Object.hasOwnProperty.call(_,"speakerAttendeeId")&&tt.uint32(26).string(_.speakerAttendeeId),_.speakerExternalUserId!=null&&Object.hasOwnProperty.call(_,"speakerExternalUserId")&&tt.uint32(34).string(_.speakerExternalUserId),_.startTime!=null&&Object.hasOwnProperty.call(_,"startTime")&&tt.uint32(40).int64(_.startTime),_.type!=null&&Object.hasOwnProperty.call(_,"type")&&tt.uint32(48).int32(_.type),_.vocabularyFilterMatch!=null&&Object.hasOwnProperty.call(_,"vocabularyFilterMatch")&&tt.uint32(56).bool(_.vocabularyFilterMatch),_.confidence!=null&&Object.hasOwnProperty.call(_,"confidence")&&tt.uint32(65).double(_.confidence),_.stable!=null&&Object.hasOwnProperty.call(_,"stable")&&tt.uint32(72).bool(_.stable),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkTranscriptItem;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.content=_.string();break}case 2:{it.endTime=_.int64();break}case 3:{it.speakerAttendeeId=_.string();break}case 4:{it.speakerExternalUserId=_.string();break}case 5:{it.startTime=_.int64();break}case 6:{it.type=_.int32();break}case 7:{it.vocabularyFilterMatch=_.bool();break}case 8:{it.confidence=_.double();break}case 9:{it.stable=_.bool();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.content!=null&&_.hasOwnProperty("content")&&!$util.isString(_.content))return"content: string expected";if(_.endTime!=null&&_.hasOwnProperty("endTime")&&!$util.isInteger(_.endTime)&&!(_.endTime&&$util.isInteger(_.endTime.low)&&$util.isInteger(_.endTime.high)))return"endTime: integer|Long expected";if(_.speakerAttendeeId!=null&&_.hasOwnProperty("speakerAttendeeId")&&!$util.isString(_.speakerAttendeeId))return"speakerAttendeeId: string expected";if(_.speakerExternalUserId!=null&&_.hasOwnProperty("speakerExternalUserId")&&!$util.isString(_.speakerExternalUserId))return"speakerExternalUserId: string expected";if(_.startTime!=null&&_.hasOwnProperty("startTime")&&!$util.isInteger(_.startTime)&&!(_.startTime&&$util.isInteger(_.startTime.low)&&$util.isInteger(_.startTime.high)))return"startTime: integer|Long expected";if(_.type!=null&&_.hasOwnProperty("type"))switch(_.type){default:return"type: enum value expected";case 1:case 2:break}return _.vocabularyFilterMatch!=null&&_.hasOwnProperty("vocabularyFilterMatch")&&typeof _.vocabularyFilterMatch!="boolean"?"vocabularyFilterMatch: boolean expected":_.confidence!=null&&_.hasOwnProperty("confidence")&&typeof _.confidence!="number"?"confidence: number expected":_.stable!=null&&_.hasOwnProperty("stable")&&typeof _.stable!="boolean"?"stable: boolean expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkTranscriptItem)return _;var tt=new $root.SdkTranscriptItem;switch(_.content!=null&&(tt.content=String(_.content)),_.endTime!=null&&($util.Long?(tt.endTime=$util.Long.fromValue(_.endTime)).unsigned=!1:typeof _.endTime=="string"?tt.endTime=parseInt(_.endTime,10):typeof _.endTime=="number"?tt.endTime=_.endTime:typeof _.endTime=="object"&&(tt.endTime=new $util.LongBits(_.endTime.low>>>0,_.endTime.high>>>0).toNumber())),_.speakerAttendeeId!=null&&(tt.speakerAttendeeId=String(_.speakerAttendeeId)),_.speakerExternalUserId!=null&&(tt.speakerExternalUserId=String(_.speakerExternalUserId)),_.startTime!=null&&($util.Long?(tt.startTime=$util.Long.fromValue(_.startTime)).unsigned=!1:typeof _.startTime=="string"?tt.startTime=parseInt(_.startTime,10):typeof _.startTime=="number"?tt.startTime=_.startTime:typeof _.startTime=="object"&&(tt.startTime=new $util.LongBits(_.startTime.low>>>0,_.startTime.high>>>0).toNumber())),_.type){default:if(typeof _.type=="number"){tt.type=_.type;break}break;case"PRONUNCIATION":case 1:tt.type=1;break;case"PUNCTUATION":case 2:tt.type=2;break}return _.vocabularyFilterMatch!=null&&(tt.vocabularyFilterMatch=!!_.vocabularyFilterMatch),_.confidence!=null&&(tt.confidence=Number(_.confidence)),_.stable!=null&&(tt.stable=!!_.stable),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if(tt.defaults){if(nt.content="",$util.Long){var it=new $util.Long(0,0,!1);nt.endTime=tt.longs===String?it.toString():tt.longs===Number?it.toNumber():it}else nt.endTime=tt.longs===String?"0":0;if(nt.speakerAttendeeId="",nt.speakerExternalUserId="",$util.Long){var it=new $util.Long(0,0,!1);nt.startTime=tt.longs===String?it.toString():tt.longs===Number?it.toNumber():it}else nt.startTime=tt.longs===String?"0":0;nt.type=tt.enums===String?"PRONUNCIATION":1,nt.vocabularyFilterMatch=!1,nt.confidence=0,nt.stable=!1}return _.content!=null&&_.hasOwnProperty("content")&&(nt.content=_.content),_.endTime!=null&&_.hasOwnProperty("endTime")&&(typeof _.endTime=="number"?nt.endTime=tt.longs===String?String(_.endTime):_.endTime:nt.endTime=tt.longs===String?$util.Long.prototype.toString.call(_.endTime):tt.longs===Number?new $util.LongBits(_.endTime.low>>>0,_.endTime.high>>>0).toNumber():_.endTime),_.speakerAttendeeId!=null&&_.hasOwnProperty("speakerAttendeeId")&&(nt.speakerAttendeeId=_.speakerAttendeeId),_.speakerExternalUserId!=null&&_.hasOwnProperty("speakerExternalUserId")&&(nt.speakerExternalUserId=_.speakerExternalUserId),_.startTime!=null&&_.hasOwnProperty("startTime")&&(typeof _.startTime=="number"?nt.startTime=tt.longs===String?String(_.startTime):_.startTime:nt.startTime=tt.longs===String?$util.Long.prototype.toString.call(_.startTime):tt.longs===Number?new $util.LongBits(_.startTime.low>>>0,_.startTime.high>>>0).toNumber():_.startTime),_.type!=null&&_.hasOwnProperty("type")&&(nt.type=tt.enums===String?$root.SdkTranscriptItem.Type[_.type]===void 0?_.type:$root.SdkTranscriptItem.Type[_.type]:_.type),_.vocabularyFilterMatch!=null&&_.hasOwnProperty("vocabularyFilterMatch")&&(nt.vocabularyFilterMatch=_.vocabularyFilterMatch),_.confidence!=null&&_.hasOwnProperty("confidence")&&(nt.confidence=tt.json&&!isFinite(_.confidence)?String(_.confidence):_.confidence),_.stable!=null&&_.hasOwnProperty("stable")&&(nt.stable=_.stable),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkTranscriptItem"},et.Type=function(){var $={},_=Object.create($);return _[$[1]="PRONUNCIATION"]=1,_[$[2]="PUNCTUATION"]=2,_}(),et}();$root.SdkTranscriptEntity=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.category="",et.prototype.confidence=0,et.prototype.content="",et.prototype.endTime=$util.Long?$util.Long.fromBits(0,0,!1):0,et.prototype.startTime=$util.Long?$util.Long.fromBits(0,0,!1):0,et.prototype.type="",et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.category!=null&&Object.hasOwnProperty.call(_,"category")&&tt.uint32(10).string(_.category),_.confidence!=null&&Object.hasOwnProperty.call(_,"confidence")&&tt.uint32(17).double(_.confidence),_.content!=null&&Object.hasOwnProperty.call(_,"content")&&tt.uint32(26).string(_.content),_.endTime!=null&&Object.hasOwnProperty.call(_,"endTime")&&tt.uint32(32).int64(_.endTime),_.startTime!=null&&Object.hasOwnProperty.call(_,"startTime")&&tt.uint32(40).int64(_.startTime),_.type!=null&&Object.hasOwnProperty.call(_,"type")&&tt.uint32(50).string(_.type),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkTranscriptEntity;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.category=_.string();break}case 2:{it.confidence=_.double();break}case 3:{it.content=_.string();break}case 4:{it.endTime=_.int64();break}case 5:{it.startTime=_.int64();break}case 6:{it.type=_.string();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.category!=null&&_.hasOwnProperty("category")&&!$util.isString(_.category)?"category: string expected":_.confidence!=null&&_.hasOwnProperty("confidence")&&typeof _.confidence!="number"?"confidence: number expected":_.content!=null&&_.hasOwnProperty("content")&&!$util.isString(_.content)?"content: string expected":_.endTime!=null&&_.hasOwnProperty("endTime")&&!$util.isInteger(_.endTime)&&!(_.endTime&&$util.isInteger(_.endTime.low)&&$util.isInteger(_.endTime.high))?"endTime: integer|Long expected":_.startTime!=null&&_.hasOwnProperty("startTime")&&!$util.isInteger(_.startTime)&&!(_.startTime&&$util.isInteger(_.startTime.low)&&$util.isInteger(_.startTime.high))?"startTime: integer|Long expected":_.type!=null&&_.hasOwnProperty("type")&&!$util.isString(_.type)?"type: string expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkTranscriptEntity)return _;var tt=new $root.SdkTranscriptEntity;return _.category!=null&&(tt.category=String(_.category)),_.confidence!=null&&(tt.confidence=Number(_.confidence)),_.content!=null&&(tt.content=String(_.content)),_.endTime!=null&&($util.Long?(tt.endTime=$util.Long.fromValue(_.endTime)).unsigned=!1:typeof _.endTime=="string"?tt.endTime=parseInt(_.endTime,10):typeof _.endTime=="number"?tt.endTime=_.endTime:typeof _.endTime=="object"&&(tt.endTime=new $util.LongBits(_.endTime.low>>>0,_.endTime.high>>>0).toNumber())),_.startTime!=null&&($util.Long?(tt.startTime=$util.Long.fromValue(_.startTime)).unsigned=!1:typeof _.startTime=="string"?tt.startTime=parseInt(_.startTime,10):typeof _.startTime=="number"?tt.startTime=_.startTime:typeof _.startTime=="object"&&(tt.startTime=new $util.LongBits(_.startTime.low>>>0,_.startTime.high>>>0).toNumber())),_.type!=null&&(tt.type=String(_.type)),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if(tt.defaults){if(nt.category="",nt.confidence=0,nt.content="",$util.Long){var it=new $util.Long(0,0,!1);nt.endTime=tt.longs===String?it.toString():tt.longs===Number?it.toNumber():it}else nt.endTime=tt.longs===String?"0":0;if($util.Long){var it=new $util.Long(0,0,!1);nt.startTime=tt.longs===String?it.toString():tt.longs===Number?it.toNumber():it}else nt.startTime=tt.longs===String?"0":0;nt.type=""}return _.category!=null&&_.hasOwnProperty("category")&&(nt.category=_.category),_.confidence!=null&&_.hasOwnProperty("confidence")&&(nt.confidence=tt.json&&!isFinite(_.confidence)?String(_.confidence):_.confidence),_.content!=null&&_.hasOwnProperty("content")&&(nt.content=_.content),_.endTime!=null&&_.hasOwnProperty("endTime")&&(typeof _.endTime=="number"?nt.endTime=tt.longs===String?String(_.endTime):_.endTime:nt.endTime=tt.longs===String?$util.Long.prototype.toString.call(_.endTime):tt.longs===Number?new $util.LongBits(_.endTime.low>>>0,_.endTime.high>>>0).toNumber():_.endTime),_.startTime!=null&&_.hasOwnProperty("startTime")&&(typeof _.startTime=="number"?nt.startTime=tt.longs===String?String(_.startTime):_.startTime:nt.startTime=tt.longs===String?$util.Long.prototype.toString.call(_.startTime):tt.longs===Number?new $util.LongBits(_.startTime.low>>>0,_.startTime.high>>>0).toNumber():_.startTime),_.type!=null&&_.hasOwnProperty("type")&&(nt.type=_.type),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkTranscriptEntity"},et}();$root.SdkTranscriptAlternative=function(){function et($){if(this.items=[],this.entities=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.items=$util.emptyArray,et.prototype.transcript="",et.prototype.entities=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.items!=null&&_.items.length)for(var nt=0;nt<_.items.length;++nt)$root.SdkTranscriptItem.encode(_.items[nt],tt.uint32(10).fork()).ldelim();if(_.transcript!=null&&Object.hasOwnProperty.call(_,"transcript")&&tt.uint32(18).string(_.transcript),_.entities!=null&&_.entities.length)for(var nt=0;nt<_.entities.length;++nt)$root.SdkTranscriptEntity.encode(_.entities[nt],tt.uint32(26).fork()).ldelim();return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkTranscriptAlternative;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.items&&it.items.length||(it.items=[]),it.items.push($root.SdkTranscriptItem.decode(_,_.uint32()));break}case 2:{it.transcript=_.string();break}case 3:{it.entities&&it.entities.length||(it.entities=[]),it.entities.push($root.SdkTranscriptEntity.decode(_,_.uint32()));break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.items!=null&&_.hasOwnProperty("items")){if(!Array.isArray(_.items))return"items: array expected";for(var tt=0;tt<_.items.length;++tt){var nt=$root.SdkTranscriptItem.verify(_.items[tt]);if(nt)return"items."+nt}}if(_.transcript!=null&&_.hasOwnProperty("transcript")&&!$util.isString(_.transcript))return"transcript: string expected";if(_.entities!=null&&_.hasOwnProperty("entities")){if(!Array.isArray(_.entities))return"entities: array expected";for(var tt=0;tt<_.entities.length;++tt){var nt=$root.SdkTranscriptEntity.verify(_.entities[tt]);if(nt)return"entities."+nt}}return null},et.fromObject=function(_){if(_ instanceof $root.SdkTranscriptAlternative)return _;var tt=new $root.SdkTranscriptAlternative;if(_.items){if(!Array.isArray(_.items))throw TypeError(".SdkTranscriptAlternative.items: array expected");tt.items=[];for(var nt=0;nt<_.items.length;++nt){if(typeof _.items[nt]!="object")throw TypeError(".SdkTranscriptAlternative.items: object expected");tt.items[nt]=$root.SdkTranscriptItem.fromObject(_.items[nt])}}if(_.transcript!=null&&(tt.transcript=String(_.transcript)),_.entities){if(!Array.isArray(_.entities))throw TypeError(".SdkTranscriptAlternative.entities: array expected");tt.entities=[];for(var nt=0;nt<_.entities.length;++nt){if(typeof _.entities[nt]!="object")throw TypeError(".SdkTranscriptAlternative.entities: object expected");tt.entities[nt]=$root.SdkTranscriptEntity.fromObject(_.entities[nt])}}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.items=[],nt.entities=[]),tt.defaults&&(nt.transcript=""),_.items&&_.items.length){nt.items=[];for(var it=0;it<_.items.length;++it)nt.items[it]=$root.SdkTranscriptItem.toObject(_.items[it],tt)}if(_.transcript!=null&&_.hasOwnProperty("transcript")&&(nt.transcript=_.transcript),_.entities&&_.entities.length){nt.entities=[];for(var it=0;it<_.entities.length;++it)nt.entities[it]=$root.SdkTranscriptEntity.toObject(_.entities[it],tt)}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkTranscriptAlternative"},et}();$root.SdkTranscriptLanguageWithScore=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.languageCode="",et.prototype.score=0,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.languageCode!=null&&Object.hasOwnProperty.call(_,"languageCode")&&tt.uint32(10).string(_.languageCode),_.score!=null&&Object.hasOwnProperty.call(_,"score")&&tt.uint32(17).double(_.score),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkTranscriptLanguageWithScore;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.languageCode=_.string();break}case 2:{it.score=_.double();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.languageCode!=null&&_.hasOwnProperty("languageCode")&&!$util.isString(_.languageCode)?"languageCode: string expected":_.score!=null&&_.hasOwnProperty("score")&&typeof _.score!="number"?"score: number expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkTranscriptLanguageWithScore)return _;var tt=new $root.SdkTranscriptLanguageWithScore;return _.languageCode!=null&&(tt.languageCode=String(_.languageCode)),_.score!=null&&(tt.score=Number(_.score)),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.languageCode="",nt.score=0),_.languageCode!=null&&_.hasOwnProperty("languageCode")&&(nt.languageCode=_.languageCode),_.score!=null&&_.hasOwnProperty("score")&&(nt.score=tt.json&&!isFinite(_.score)?String(_.score):_.score),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkTranscriptLanguageWithScore"},et}();$root.SdkTranscriptResult=function(){function et($){if(this.alternatives=[],this.languageIdentification=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.alternatives=$util.emptyArray,et.prototype.channelId="",et.prototype.endTime=$util.Long?$util.Long.fromBits(0,0,!1):0,et.prototype.isPartial=!1,et.prototype.resultId="",et.prototype.startTime=$util.Long?$util.Long.fromBits(0,0,!1):0,et.prototype.languageCode="",et.prototype.languageIdentification=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.alternatives!=null&&_.alternatives.length)for(var nt=0;nt<_.alternatives.length;++nt)$root.SdkTranscriptAlternative.encode(_.alternatives[nt],tt.uint32(10).fork()).ldelim();if(_.channelId!=null&&Object.hasOwnProperty.call(_,"channelId")&&tt.uint32(18).string(_.channelId),_.endTime!=null&&Object.hasOwnProperty.call(_,"endTime")&&tt.uint32(24).int64(_.endTime),_.isPartial!=null&&Object.hasOwnProperty.call(_,"isPartial")&&tt.uint32(32).bool(_.isPartial),_.resultId!=null&&Object.hasOwnProperty.call(_,"resultId")&&tt.uint32(42).string(_.resultId),_.startTime!=null&&Object.hasOwnProperty.call(_,"startTime")&&tt.uint32(48).int64(_.startTime),_.languageCode!=null&&Object.hasOwnProperty.call(_,"languageCode")&&tt.uint32(58).string(_.languageCode),_.languageIdentification!=null&&_.languageIdentification.length)for(var nt=0;nt<_.languageIdentification.length;++nt)$root.SdkTranscriptLanguageWithScore.encode(_.languageIdentification[nt],tt.uint32(66).fork()).ldelim();return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkTranscriptResult;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.alternatives&&it.alternatives.length||(it.alternatives=[]),it.alternatives.push($root.SdkTranscriptAlternative.decode(_,_.uint32()));break}case 2:{it.channelId=_.string();break}case 3:{it.endTime=_.int64();break}case 4:{it.isPartial=_.bool();break}case 5:{it.resultId=_.string();break}case 6:{it.startTime=_.int64();break}case 7:{it.languageCode=_.string();break}case 8:{it.languageIdentification&&it.languageIdentification.length||(it.languageIdentification=[]),it.languageIdentification.push($root.SdkTranscriptLanguageWithScore.decode(_,_.uint32()));break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.alternatives!=null&&_.hasOwnProperty("alternatives")){if(!Array.isArray(_.alternatives))return"alternatives: array expected";for(var tt=0;tt<_.alternatives.length;++tt){var nt=$root.SdkTranscriptAlternative.verify(_.alternatives[tt]);if(nt)return"alternatives."+nt}}if(_.channelId!=null&&_.hasOwnProperty("channelId")&&!$util.isString(_.channelId))return"channelId: string expected";if(_.endTime!=null&&_.hasOwnProperty("endTime")&&!$util.isInteger(_.endTime)&&!(_.endTime&&$util.isInteger(_.endTime.low)&&$util.isInteger(_.endTime.high)))return"endTime: integer|Long expected";if(_.isPartial!=null&&_.hasOwnProperty("isPartial")&&typeof _.isPartial!="boolean")return"isPartial: boolean expected";if(_.resultId!=null&&_.hasOwnProperty("resultId")&&!$util.isString(_.resultId))return"resultId: string expected";if(_.startTime!=null&&_.hasOwnProperty("startTime")&&!$util.isInteger(_.startTime)&&!(_.startTime&&$util.isInteger(_.startTime.low)&&$util.isInteger(_.startTime.high)))return"startTime: integer|Long expected";if(_.languageCode!=null&&_.hasOwnProperty("languageCode")&&!$util.isString(_.languageCode))return"languageCode: string expected";if(_.languageIdentification!=null&&_.hasOwnProperty("languageIdentification")){if(!Array.isArray(_.languageIdentification))return"languageIdentification: array expected";for(var tt=0;tt<_.languageIdentification.length;++tt){var nt=$root.SdkTranscriptLanguageWithScore.verify(_.languageIdentification[tt]);if(nt)return"languageIdentification."+nt}}return null},et.fromObject=function(_){if(_ instanceof $root.SdkTranscriptResult)return _;var tt=new $root.SdkTranscriptResult;if(_.alternatives){if(!Array.isArray(_.alternatives))throw TypeError(".SdkTranscriptResult.alternatives: array expected");tt.alternatives=[];for(var nt=0;nt<_.alternatives.length;++nt){if(typeof _.alternatives[nt]!="object")throw TypeError(".SdkTranscriptResult.alternatives: object expected");tt.alternatives[nt]=$root.SdkTranscriptAlternative.fromObject(_.alternatives[nt])}}if(_.channelId!=null&&(tt.channelId=String(_.channelId)),_.endTime!=null&&($util.Long?(tt.endTime=$util.Long.fromValue(_.endTime)).unsigned=!1:typeof _.endTime=="string"?tt.endTime=parseInt(_.endTime,10):typeof _.endTime=="number"?tt.endTime=_.endTime:typeof _.endTime=="object"&&(tt.endTime=new $util.LongBits(_.endTime.low>>>0,_.endTime.high>>>0).toNumber())),_.isPartial!=null&&(tt.isPartial=!!_.isPartial),_.resultId!=null&&(tt.resultId=String(_.resultId)),_.startTime!=null&&($util.Long?(tt.startTime=$util.Long.fromValue(_.startTime)).unsigned=!1:typeof _.startTime=="string"?tt.startTime=parseInt(_.startTime,10):typeof _.startTime=="number"?tt.startTime=_.startTime:typeof _.startTime=="object"&&(tt.startTime=new $util.LongBits(_.startTime.low>>>0,_.startTime.high>>>0).toNumber())),_.languageCode!=null&&(tt.languageCode=String(_.languageCode)),_.languageIdentification){if(!Array.isArray(_.languageIdentification))throw TypeError(".SdkTranscriptResult.languageIdentification: array expected");tt.languageIdentification=[];for(var nt=0;nt<_.languageIdentification.length;++nt){if(typeof _.languageIdentification[nt]!="object")throw TypeError(".SdkTranscriptResult.languageIdentification: object expected");tt.languageIdentification[nt]=$root.SdkTranscriptLanguageWithScore.fromObject(_.languageIdentification[nt])}}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.alternatives=[],nt.languageIdentification=[]),tt.defaults){if(nt.channelId="",$util.Long){var it=new $util.Long(0,0,!1);nt.endTime=tt.longs===String?it.toString():tt.longs===Number?it.toNumber():it}else nt.endTime=tt.longs===String?"0":0;if(nt.isPartial=!1,nt.resultId="",$util.Long){var it=new $util.Long(0,0,!1);nt.startTime=tt.longs===String?it.toString():tt.longs===Number?it.toNumber():it}else nt.startTime=tt.longs===String?"0":0;nt.languageCode=""}if(_.alternatives&&_.alternatives.length){nt.alternatives=[];for(var rt=0;rt<_.alternatives.length;++rt)nt.alternatives[rt]=$root.SdkTranscriptAlternative.toObject(_.alternatives[rt],tt)}if(_.channelId!=null&&_.hasOwnProperty("channelId")&&(nt.channelId=_.channelId),_.endTime!=null&&_.hasOwnProperty("endTime")&&(typeof _.endTime=="number"?nt.endTime=tt.longs===String?String(_.endTime):_.endTime:nt.endTime=tt.longs===String?$util.Long.prototype.toString.call(_.endTime):tt.longs===Number?new $util.LongBits(_.endTime.low>>>0,_.endTime.high>>>0).toNumber():_.endTime),_.isPartial!=null&&_.hasOwnProperty("isPartial")&&(nt.isPartial=_.isPartial),_.resultId!=null&&_.hasOwnProperty("resultId")&&(nt.resultId=_.resultId),_.startTime!=null&&_.hasOwnProperty("startTime")&&(typeof _.startTime=="number"?nt.startTime=tt.longs===String?String(_.startTime):_.startTime:nt.startTime=tt.longs===String?$util.Long.prototype.toString.call(_.startTime):tt.longs===Number?new $util.LongBits(_.startTime.low>>>0,_.startTime.high>>>0).toNumber():_.startTime),_.languageCode!=null&&_.hasOwnProperty("languageCode")&&(nt.languageCode=_.languageCode),_.languageIdentification&&_.languageIdentification.length){nt.languageIdentification=[];for(var rt=0;rt<_.languageIdentification.length;++rt)nt.languageIdentification[rt]=$root.SdkTranscriptLanguageWithScore.toObject(_.languageIdentification[rt],tt)}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkTranscriptResult"},et}();$root.SdkTranscript=function(){function et($){if(this.results=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.results=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.results!=null&&_.results.length)for(var nt=0;nt<_.results.length;++nt)$root.SdkTranscriptResult.encode(_.results[nt],tt.uint32(10).fork()).ldelim();return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkTranscript;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.results&&it.results.length||(it.results=[]),it.results.push($root.SdkTranscriptResult.decode(_,_.uint32()));break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.results!=null&&_.hasOwnProperty("results")){if(!Array.isArray(_.results))return"results: array expected";for(var tt=0;tt<_.results.length;++tt){var nt=$root.SdkTranscriptResult.verify(_.results[tt]);if(nt)return"results."+nt}}return null},et.fromObject=function(_){if(_ instanceof $root.SdkTranscript)return _;var tt=new $root.SdkTranscript;if(_.results){if(!Array.isArray(_.results))throw TypeError(".SdkTranscript.results: array expected");tt.results=[];for(var nt=0;nt<_.results.length;++nt){if(typeof _.results[nt]!="object")throw TypeError(".SdkTranscript.results: object expected");tt.results[nt]=$root.SdkTranscriptResult.fromObject(_.results[nt])}}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.results=[]),_.results&&_.results.length){nt.results=[];for(var it=0;it<_.results.length;++it)nt.results[it]=$root.SdkTranscriptResult.toObject(_.results[it],tt)}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkTranscript"},et}();$root.SdkTranscriptionStatus=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.type=1,et.prototype.eventTime=$util.Long?$util.Long.fromBits(0,0,!1):0,et.prototype.transcriptionRegion="",et.prototype.transcriptionConfiguration="",et.prototype.message="",et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.type!=null&&Object.hasOwnProperty.call(_,"type")&&tt.uint32(8).int32(_.type),_.eventTime!=null&&Object.hasOwnProperty.call(_,"eventTime")&&tt.uint32(16).int64(_.eventTime),_.transcriptionRegion!=null&&Object.hasOwnProperty.call(_,"transcriptionRegion")&&tt.uint32(26).string(_.transcriptionRegion),_.transcriptionConfiguration!=null&&Object.hasOwnProperty.call(_,"transcriptionConfiguration")&&tt.uint32(34).string(_.transcriptionConfiguration),_.message!=null&&Object.hasOwnProperty.call(_,"message")&&tt.uint32(42).string(_.message),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkTranscriptionStatus;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.type=_.int32();break}case 2:{it.eventTime=_.int64();break}case 3:{it.transcriptionRegion=_.string();break}case 4:{it.transcriptionConfiguration=_.string();break}case 5:{it.message=_.string();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.type!=null&&_.hasOwnProperty("type"))switch(_.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:break}return _.eventTime!=null&&_.hasOwnProperty("eventTime")&&!$util.isInteger(_.eventTime)&&!(_.eventTime&&$util.isInteger(_.eventTime.low)&&$util.isInteger(_.eventTime.high))?"eventTime: integer|Long expected":_.transcriptionRegion!=null&&_.hasOwnProperty("transcriptionRegion")&&!$util.isString(_.transcriptionRegion)?"transcriptionRegion: string expected":_.transcriptionConfiguration!=null&&_.hasOwnProperty("transcriptionConfiguration")&&!$util.isString(_.transcriptionConfiguration)?"transcriptionConfiguration: string expected":_.message!=null&&_.hasOwnProperty("message")&&!$util.isString(_.message)?"message: string expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkTranscriptionStatus)return _;var tt=new $root.SdkTranscriptionStatus;switch(_.type){default:if(typeof _.type=="number"){tt.type=_.type;break}break;case"STARTED":case 1:tt.type=1;break;case"INTERRUPTED":case 2:tt.type=2;break;case"RESUMED":case 3:tt.type=3;break;case"STOPPED":case 4:tt.type=4;break;case"FAILED":case 5:tt.type=5;break}return _.eventTime!=null&&($util.Long?(tt.eventTime=$util.Long.fromValue(_.eventTime)).unsigned=!1:typeof _.eventTime=="string"?tt.eventTime=parseInt(_.eventTime,10):typeof _.eventTime=="number"?tt.eventTime=_.eventTime:typeof _.eventTime=="object"&&(tt.eventTime=new $util.LongBits(_.eventTime.low>>>0,_.eventTime.high>>>0).toNumber())),_.transcriptionRegion!=null&&(tt.transcriptionRegion=String(_.transcriptionRegion)),_.transcriptionConfiguration!=null&&(tt.transcriptionConfiguration=String(_.transcriptionConfiguration)),_.message!=null&&(tt.message=String(_.message)),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if(tt.defaults){if(nt.type=tt.enums===String?"STARTED":1,$util.Long){var it=new $util.Long(0,0,!1);nt.eventTime=tt.longs===String?it.toString():tt.longs===Number?it.toNumber():it}else nt.eventTime=tt.longs===String?"0":0;nt.transcriptionRegion="",nt.transcriptionConfiguration="",nt.message=""}return _.type!=null&&_.hasOwnProperty("type")&&(nt.type=tt.enums===String?$root.SdkTranscriptionStatus.Type[_.type]===void 0?_.type:$root.SdkTranscriptionStatus.Type[_.type]:_.type),_.eventTime!=null&&_.hasOwnProperty("eventTime")&&(typeof _.eventTime=="number"?nt.eventTime=tt.longs===String?String(_.eventTime):_.eventTime:nt.eventTime=tt.longs===String?$util.Long.prototype.toString.call(_.eventTime):tt.longs===Number?new $util.LongBits(_.eventTime.low>>>0,_.eventTime.high>>>0).toNumber():_.eventTime),_.transcriptionRegion!=null&&_.hasOwnProperty("transcriptionRegion")&&(nt.transcriptionRegion=_.transcriptionRegion),_.transcriptionConfiguration!=null&&_.hasOwnProperty("transcriptionConfiguration")&&(nt.transcriptionConfiguration=_.transcriptionConfiguration),_.message!=null&&_.hasOwnProperty("message")&&(nt.message=_.message),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkTranscriptionStatus"},et.Type=function(){var $={},_=Object.create($);return _[$[1]="STARTED"]=1,_[$[2]="INTERRUPTED"]=2,_[$[3]="RESUMED"]=3,_[$[4]="STOPPED"]=4,_[$[5]="FAILED"]=5,_}(),et}();$root.SdkTranscriptEvent=function(){function et(_){if(_)for(var tt=Object.keys(_),nt=0;nt<tt.length;++nt)_[tt[nt]]!=null&&(this[tt[nt]]=_[tt[nt]])}et.prototype.status=null,et.prototype.transcript=null;var $;return Object.defineProperty(et.prototype,"Event",{get:$util.oneOfGetter($=["status","transcript"]),set:$util.oneOfSetter($)}),et.create=function(tt){return new et(tt)},et.encode=function(tt,nt){return nt||(nt=$Writer.create()),tt.status!=null&&Object.hasOwnProperty.call(tt,"status")&&$root.SdkTranscriptionStatus.encode(tt.status,nt.uint32(10).fork()).ldelim(),tt.transcript!=null&&Object.hasOwnProperty.call(tt,"transcript")&&$root.SdkTranscript.encode(tt.transcript,nt.uint32(18).fork()).ldelim(),nt},et.encodeDelimited=function(tt,nt){return this.encode(tt,nt).ldelim()},et.decode=function(tt,nt){tt instanceof $Reader||(tt=$Reader.create(tt));for(var it=nt===void 0?tt.len:tt.pos+nt,rt=new $root.SdkTranscriptEvent;tt.pos<it;){var ot=tt.uint32();switch(ot>>>3){case 1:{rt.status=$root.SdkTranscriptionStatus.decode(tt,tt.uint32());break}case 2:{rt.transcript=$root.SdkTranscript.decode(tt,tt.uint32());break}default:tt.skipType(ot&7);break}}return rt},et.decodeDelimited=function(tt){return tt instanceof $Reader||(tt=new $Reader(tt)),this.decode(tt,tt.uint32())},et.verify=function(tt){if(typeof tt!="object"||tt===null)return"object expected";var nt={};if(tt.status!=null&&tt.hasOwnProperty("status")){nt.Event=1;{var it=$root.SdkTranscriptionStatus.verify(tt.status);if(it)return"status."+it}}if(tt.transcript!=null&&tt.hasOwnProperty("transcript")){if(nt.Event===1)return"Event: multiple values";nt.Event=1;{var it=$root.SdkTranscript.verify(tt.transcript);if(it)return"transcript."+it}}return null},et.fromObject=function(tt){if(tt instanceof $root.SdkTranscriptEvent)return tt;var nt=new $root.SdkTranscriptEvent;if(tt.status!=null){if(typeof tt.status!="object")throw TypeError(".SdkTranscriptEvent.status: object expected");nt.status=$root.SdkTranscriptionStatus.fromObject(tt.status)}if(tt.transcript!=null){if(typeof tt.transcript!="object")throw TypeError(".SdkTranscriptEvent.transcript: object expected");nt.transcript=$root.SdkTranscript.fromObject(tt.transcript)}return nt},et.toObject=function(tt,nt){nt||(nt={});var it={};return tt.status!=null&&tt.hasOwnProperty("status")&&(it.status=$root.SdkTranscriptionStatus.toObject(tt.status,nt),nt.oneofs&&(it.Event="status")),tt.transcript!=null&&tt.hasOwnProperty("transcript")&&(it.transcript=$root.SdkTranscript.toObject(tt.transcript,nt),nt.oneofs&&(it.Event="transcript")),it},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(tt){return tt===void 0&&(tt="type.googleapis.com"),tt+"/SdkTranscriptEvent"},et}();$root.SdkTranscriptFrame=function(){function et($){if(this.events=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.events=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.events!=null&&_.events.length)for(var nt=0;nt<_.events.length;++nt)$root.SdkTranscriptEvent.encode(_.events[nt],tt.uint32(10).fork()).ldelim();return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkTranscriptFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.events&&it.events.length||(it.events=[]),it.events.push($root.SdkTranscriptEvent.decode(_,_.uint32()));break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.events!=null&&_.hasOwnProperty("events")){if(!Array.isArray(_.events))return"events: array expected";for(var tt=0;tt<_.events.length;++tt){var nt=$root.SdkTranscriptEvent.verify(_.events[tt]);if(nt)return"events."+nt}}return null},et.fromObject=function(_){if(_ instanceof $root.SdkTranscriptFrame)return _;var tt=new $root.SdkTranscriptFrame;if(_.events){if(!Array.isArray(_.events))throw TypeError(".SdkTranscriptFrame.events: array expected");tt.events=[];for(var nt=0;nt<_.events.length;++nt){if(typeof _.events[nt]!="object")throw TypeError(".SdkTranscriptFrame.events: object expected");tt.events[nt]=$root.SdkTranscriptEvent.fromObject(_.events[nt])}}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.events=[]),_.events&&_.events.length){nt.events=[];for(var it=0;it<_.events.length;++it)nt.events[it]=$root.SdkTranscriptEvent.toObject(_.events[it],tt)}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkTranscriptFrame"},et}();$root.SdkRemoteVideoUpdateFrame=function(){function et($){if(this.addedOrUpdatedVideoSubscriptions=[],this.removedVideoSubscriptionMids=[],$)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.addedOrUpdatedVideoSubscriptions=$util.emptyArray,et.prototype.removedVideoSubscriptionMids=$util.emptyArray,et.create=function(_){return new et(_)},et.encode=function(_,tt){if(tt||(tt=$Writer.create()),_.addedOrUpdatedVideoSubscriptions!=null&&_.addedOrUpdatedVideoSubscriptions.length)for(var nt=0;nt<_.addedOrUpdatedVideoSubscriptions.length;++nt)$root.SdkVideoSubscriptionConfiguration.encode(_.addedOrUpdatedVideoSubscriptions[nt],tt.uint32(10).fork()).ldelim();if(_.removedVideoSubscriptionMids!=null&&_.removedVideoSubscriptionMids.length)for(var nt=0;nt<_.removedVideoSubscriptionMids.length;++nt)tt.uint32(18).string(_.removedVideoSubscriptionMids[nt]);return tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkRemoteVideoUpdateFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.addedOrUpdatedVideoSubscriptions&&it.addedOrUpdatedVideoSubscriptions.length||(it.addedOrUpdatedVideoSubscriptions=[]),it.addedOrUpdatedVideoSubscriptions.push($root.SdkVideoSubscriptionConfiguration.decode(_,_.uint32()));break}case 2:{it.removedVideoSubscriptionMids&&it.removedVideoSubscriptionMids.length||(it.removedVideoSubscriptionMids=[]),it.removedVideoSubscriptionMids.push(_.string());break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.addedOrUpdatedVideoSubscriptions!=null&&_.hasOwnProperty("addedOrUpdatedVideoSubscriptions")){if(!Array.isArray(_.addedOrUpdatedVideoSubscriptions))return"addedOrUpdatedVideoSubscriptions: array expected";for(var tt=0;tt<_.addedOrUpdatedVideoSubscriptions.length;++tt){var nt=$root.SdkVideoSubscriptionConfiguration.verify(_.addedOrUpdatedVideoSubscriptions[tt]);if(nt)return"addedOrUpdatedVideoSubscriptions."+nt}}if(_.removedVideoSubscriptionMids!=null&&_.hasOwnProperty("removedVideoSubscriptionMids")){if(!Array.isArray(_.removedVideoSubscriptionMids))return"removedVideoSubscriptionMids: array expected";for(var tt=0;tt<_.removedVideoSubscriptionMids.length;++tt)if(!$util.isString(_.removedVideoSubscriptionMids[tt]))return"removedVideoSubscriptionMids: string[] expected"}return null},et.fromObject=function(_){if(_ instanceof $root.SdkRemoteVideoUpdateFrame)return _;var tt=new $root.SdkRemoteVideoUpdateFrame;if(_.addedOrUpdatedVideoSubscriptions){if(!Array.isArray(_.addedOrUpdatedVideoSubscriptions))throw TypeError(".SdkRemoteVideoUpdateFrame.addedOrUpdatedVideoSubscriptions: array expected");tt.addedOrUpdatedVideoSubscriptions=[];for(var nt=0;nt<_.addedOrUpdatedVideoSubscriptions.length;++nt){if(typeof _.addedOrUpdatedVideoSubscriptions[nt]!="object")throw TypeError(".SdkRemoteVideoUpdateFrame.addedOrUpdatedVideoSubscriptions: object expected");tt.addedOrUpdatedVideoSubscriptions[nt]=$root.SdkVideoSubscriptionConfiguration.fromObject(_.addedOrUpdatedVideoSubscriptions[nt])}}if(_.removedVideoSubscriptionMids){if(!Array.isArray(_.removedVideoSubscriptionMids))throw TypeError(".SdkRemoteVideoUpdateFrame.removedVideoSubscriptionMids: array expected");tt.removedVideoSubscriptionMids=[];for(var nt=0;nt<_.removedVideoSubscriptionMids.length;++nt)tt.removedVideoSubscriptionMids[nt]=String(_.removedVideoSubscriptionMids[nt])}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};if((tt.arrays||tt.defaults)&&(nt.addedOrUpdatedVideoSubscriptions=[],nt.removedVideoSubscriptionMids=[]),_.addedOrUpdatedVideoSubscriptions&&_.addedOrUpdatedVideoSubscriptions.length){nt.addedOrUpdatedVideoSubscriptions=[];for(var it=0;it<_.addedOrUpdatedVideoSubscriptions.length;++it)nt.addedOrUpdatedVideoSubscriptions[it]=$root.SdkVideoSubscriptionConfiguration.toObject(_.addedOrUpdatedVideoSubscriptions[it],tt)}if(_.removedVideoSubscriptionMids&&_.removedVideoSubscriptionMids.length){nt.removedVideoSubscriptionMids=[];for(var it=0;it<_.removedVideoSubscriptionMids.length;++it)nt.removedVideoSubscriptionMids[it]=_.removedVideoSubscriptionMids[it]}return nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkRemoteVideoUpdateFrame"},et}();$root.SdkVideoQualityAdaptationPreference=function(){var et={},$=Object.create(et);return $[et[1]="BALANCED"]=1,$[et[2]="MAINTAIN_FRAMERATE"]=2,$[et[3]="MAINTAIN_RESOLUTION"]=3,$}();$root.SdkVideoSubscriptionConfiguration=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.mid="",et.prototype.attendeeId="",et.prototype.streamId=0,et.prototype.priority=0,et.prototype.targetBitrateKbps=0,et.prototype.groupId=0,et.prototype.qualityAdaptationPreference=1,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),tt.uint32(10).string(_.mid),_.attendeeId!=null&&Object.hasOwnProperty.call(_,"attendeeId")&&tt.uint32(18).string(_.attendeeId),_.streamId!=null&&Object.hasOwnProperty.call(_,"streamId")&&tt.uint32(24).uint32(_.streamId),_.priority!=null&&Object.hasOwnProperty.call(_,"priority")&&tt.uint32(32).uint32(_.priority),_.targetBitrateKbps!=null&&Object.hasOwnProperty.call(_,"targetBitrateKbps")&&tt.uint32(40).uint32(_.targetBitrateKbps),_.groupId!=null&&Object.hasOwnProperty.call(_,"groupId")&&tt.uint32(48).uint32(_.groupId),_.qualityAdaptationPreference!=null&&Object.hasOwnProperty.call(_,"qualityAdaptationPreference")&&tt.uint32(56).int32(_.qualityAdaptationPreference),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkVideoSubscriptionConfiguration;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.mid=_.string();break}case 2:{it.attendeeId=_.string();break}case 3:{it.streamId=_.uint32();break}case 4:{it.priority=_.uint32();break}case 5:{it.targetBitrateKbps=_.uint32();break}case 6:{it.groupId=_.uint32();break}case 7:{it.qualityAdaptationPreference=_.int32();break}default:_.skipType(rt&7);break}}if(!it.hasOwnProperty("mid"))throw $util.ProtocolError("missing required 'mid'",{instance:it});return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(!$util.isString(_.mid))return"mid: string expected";if(_.attendeeId!=null&&_.hasOwnProperty("attendeeId")&&!$util.isString(_.attendeeId))return"attendeeId: string expected";if(_.streamId!=null&&_.hasOwnProperty("streamId")&&!$util.isInteger(_.streamId))return"streamId: integer expected";if(_.priority!=null&&_.hasOwnProperty("priority")&&!$util.isInteger(_.priority))return"priority: integer expected";if(_.targetBitrateKbps!=null&&_.hasOwnProperty("targetBitrateKbps")&&!$util.isInteger(_.targetBitrateKbps))return"targetBitrateKbps: integer expected";if(_.groupId!=null&&_.hasOwnProperty("groupId")&&!$util.isInteger(_.groupId))return"groupId: integer expected";if(_.qualityAdaptationPreference!=null&&_.hasOwnProperty("qualityAdaptationPreference"))switch(_.qualityAdaptationPreference){default:return"qualityAdaptationPreference: enum value expected";case 1:case 2:case 3:break}return null},et.fromObject=function(_){if(_ instanceof $root.SdkVideoSubscriptionConfiguration)return _;var tt=new $root.SdkVideoSubscriptionConfiguration;switch(_.mid!=null&&(tt.mid=String(_.mid)),_.attendeeId!=null&&(tt.attendeeId=String(_.attendeeId)),_.streamId!=null&&(tt.streamId=_.streamId>>>0),_.priority!=null&&(tt.priority=_.priority>>>0),_.targetBitrateKbps!=null&&(tt.targetBitrateKbps=_.targetBitrateKbps>>>0),_.groupId!=null&&(tt.groupId=_.groupId>>>0),_.qualityAdaptationPreference){default:if(typeof _.qualityAdaptationPreference=="number"){tt.qualityAdaptationPreference=_.qualityAdaptationPreference;break}break;case"BALANCED":case 1:tt.qualityAdaptationPreference=1;break;case"MAINTAIN_FRAMERATE":case 2:tt.qualityAdaptationPreference=2;break;case"MAINTAIN_RESOLUTION":case 3:tt.qualityAdaptationPreference=3;break}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.mid="",nt.attendeeId="",nt.streamId=0,nt.priority=0,nt.targetBitrateKbps=0,nt.groupId=0,nt.qualityAdaptationPreference=tt.enums===String?"BALANCED":1),_.mid!=null&&_.hasOwnProperty("mid")&&(nt.mid=_.mid),_.attendeeId!=null&&_.hasOwnProperty("attendeeId")&&(nt.attendeeId=_.attendeeId),_.streamId!=null&&_.hasOwnProperty("streamId")&&(nt.streamId=_.streamId),_.priority!=null&&_.hasOwnProperty("priority")&&(nt.priority=_.priority),_.targetBitrateKbps!=null&&_.hasOwnProperty("targetBitrateKbps")&&(nt.targetBitrateKbps=_.targetBitrateKbps),_.groupId!=null&&_.hasOwnProperty("groupId")&&(nt.groupId=_.groupId),_.qualityAdaptationPreference!=null&&_.hasOwnProperty("qualityAdaptationPreference")&&(nt.qualityAdaptationPreference=tt.enums===String?$root.SdkVideoQualityAdaptationPreference[_.qualityAdaptationPreference]===void 0?_.qualityAdaptationPreference:$root.SdkVideoQualityAdaptationPreference[_.qualityAdaptationPreference]:_.qualityAdaptationPreference),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkVideoSubscriptionConfiguration"},et}();$root.SdkNotificationFrame=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.level=3,et.prototype.message="",et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.level!=null&&Object.hasOwnProperty.call(_,"level")&&tt.uint32(8).int32(_.level),_.message!=null&&Object.hasOwnProperty.call(_,"message")&&tt.uint32(18).string(_.message),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkNotificationFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.level=_.int32();break}case 2:{it.message=_.string();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.level!=null&&_.hasOwnProperty("level"))switch(_.level){default:return"level: enum value expected";case 1:case 2:case 3:break}return _.message!=null&&_.hasOwnProperty("message")&&!$util.isString(_.message)?"message: string expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkNotificationFrame)return _;var tt=new $root.SdkNotificationFrame;switch(_.level){case"INFO":case 1:tt.level=1;break;case"WARNING":case 2:tt.level=2;break;default:if(typeof _.level=="number"){tt.level=_.level;break}break;case"ERROR":case 3:tt.level=3;break}return _.message!=null&&(tt.message=String(_.message)),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.level=tt.enums===String?"ERROR":3,nt.message=""),_.level!=null&&_.hasOwnProperty("level")&&(nt.level=tt.enums===String?$root.SdkNotificationFrame.NotificationLevel[_.level]===void 0?_.level:$root.SdkNotificationFrame.NotificationLevel[_.level]:_.level),_.message!=null&&_.hasOwnProperty("message")&&(nt.message=_.message),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkNotificationFrame"},et.NotificationLevel=function(){var $={},_=Object.create($);return _[$[1]="INFO"]=1,_[$[2]="WARNING"]=2,_[$[3]="ERROR"]=3,_}(),et}();$root.SdkPrimaryMeetingJoinFrame=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.credentials=null,et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.credentials!=null&&Object.hasOwnProperty.call(_,"credentials")&&$root.SdkMeetingSessionCredentials.encode(_.credentials,tt.uint32(10).fork()).ldelim(),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkPrimaryMeetingJoinFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.credentials=$root.SdkMeetingSessionCredentials.decode(_,_.uint32());break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){if(typeof _!="object"||_===null)return"object expected";if(_.credentials!=null&&_.hasOwnProperty("credentials")){var tt=$root.SdkMeetingSessionCredentials.verify(_.credentials);if(tt)return"credentials."+tt}return null},et.fromObject=function(_){if(_ instanceof $root.SdkPrimaryMeetingJoinFrame)return _;var tt=new $root.SdkPrimaryMeetingJoinFrame;if(_.credentials!=null){if(typeof _.credentials!="object")throw TypeError(".SdkPrimaryMeetingJoinFrame.credentials: object expected");tt.credentials=$root.SdkMeetingSessionCredentials.fromObject(_.credentials)}return tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.credentials=null),_.credentials!=null&&_.hasOwnProperty("credentials")&&(nt.credentials=$root.SdkMeetingSessionCredentials.toObject(_.credentials,tt)),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkPrimaryMeetingJoinFrame"},et}();$root.SdkPrimaryMeetingJoinAckFrame=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkPrimaryMeetingJoinAckFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":null},et.fromObject=function(_){return _ instanceof $root.SdkPrimaryMeetingJoinAckFrame?_:new $root.SdkPrimaryMeetingJoinAckFrame},et.toObject=function(){return{}},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkPrimaryMeetingJoinAckFrame"},et}();$root.SdkPrimaryMeetingLeaveFrame=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkPrimaryMeetingLeaveFrame;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":null},et.fromObject=function(_){return _ instanceof $root.SdkPrimaryMeetingLeaveFrame?_:new $root.SdkPrimaryMeetingLeaveFrame},et.toObject=function(){return{}},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkPrimaryMeetingLeaveFrame"},et}();$root.SdkMeetingSessionCredentials=function(){function et($){if($)for(var _=Object.keys($),tt=0;tt<_.length;++tt)$[_[tt]]!=null&&(this[_[tt]]=$[_[tt]])}return et.prototype.attendeeId="",et.prototype.externalUserId="",et.prototype.joinToken="",et.create=function(_){return new et(_)},et.encode=function(_,tt){return tt||(tt=$Writer.create()),_.attendeeId!=null&&Object.hasOwnProperty.call(_,"attendeeId")&&tt.uint32(10).string(_.attendeeId),_.externalUserId!=null&&Object.hasOwnProperty.call(_,"externalUserId")&&tt.uint32(18).string(_.externalUserId),_.joinToken!=null&&Object.hasOwnProperty.call(_,"joinToken")&&tt.uint32(26).string(_.joinToken),tt},et.encodeDelimited=function(_,tt){return this.encode(_,tt).ldelim()},et.decode=function(_,tt){_ instanceof $Reader||(_=$Reader.create(_));for(var nt=tt===void 0?_.len:_.pos+tt,it=new $root.SdkMeetingSessionCredentials;_.pos<nt;){var rt=_.uint32();switch(rt>>>3){case 1:{it.attendeeId=_.string();break}case 2:{it.externalUserId=_.string();break}case 3:{it.joinToken=_.string();break}default:_.skipType(rt&7);break}}return it},et.decodeDelimited=function(_){return _ instanceof $Reader||(_=new $Reader(_)),this.decode(_,_.uint32())},et.verify=function(_){return typeof _!="object"||_===null?"object expected":_.attendeeId!=null&&_.hasOwnProperty("attendeeId")&&!$util.isString(_.attendeeId)?"attendeeId: string expected":_.externalUserId!=null&&_.hasOwnProperty("externalUserId")&&!$util.isString(_.externalUserId)?"externalUserId: string expected":_.joinToken!=null&&_.hasOwnProperty("joinToken")&&!$util.isString(_.joinToken)?"joinToken: string expected":null},et.fromObject=function(_){if(_ instanceof $root.SdkMeetingSessionCredentials)return _;var tt=new $root.SdkMeetingSessionCredentials;return _.attendeeId!=null&&(tt.attendeeId=String(_.attendeeId)),_.externalUserId!=null&&(tt.externalUserId=String(_.externalUserId)),_.joinToken!=null&&(tt.joinToken=String(_.joinToken)),tt},et.toObject=function(_,tt){tt||(tt={});var nt={};return tt.defaults&&(nt.attendeeId="",nt.externalUserId="",nt.joinToken=""),_.attendeeId!=null&&_.hasOwnProperty("attendeeId")&&(nt.attendeeId=_.attendeeId),_.externalUserId!=null&&_.hasOwnProperty("externalUserId")&&(nt.externalUserId=_.externalUserId),_.joinToken!=null&&_.hasOwnProperty("joinToken")&&(nt.joinToken=_.joinToken),nt},et.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},et.getTypeUrl=function(_){return _===void 0&&(_="type.googleapis.com"),_+"/SdkMeetingSessionCredentials"},et}();$root.SdkVideoCodecCapability=function(){var et={},$=Object.create(et);return $[et[1]="VP8"]=1,$[et[2]="H264_BASELINE_PROFILE"]=2,$[et[3]="H264_CONSTRAINED_BASELINE_PROFILE"]=3,$[et[4]="H264_MAIN_PROFILE"]=4,$[et[5]="H264_HIGH_PROFILE"]=5,$[et[6]="H264_CONSTRAINED_HIGH_PROFILE"]=6,$[et[8]="VP9_PROFILE_0"]=8,$[et[11]="AV1_MAIN_PROFILE"]=11,$}();var SignalingProtocol=$root;$util.Long=void 0;$protobuf.configure();var ClientMetricReportDirection={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.ClientMetricReportDirection=void 0;var $;(function(_){_[_.UPSTREAM=0]="UPSTREAM",_[_.DOWNSTREAM=1]="DOWNSTREAM"})($=et.ClientMetricReportDirection||(et.ClientMetricReportDirection={})),et.default=$})(ClientMetricReportDirection);var ClientMetricReportMediaType={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.ClientMetricReportMediaType=void 0;var $;(function(_){_[_.AUDIO=0]="AUDIO",_[_.VIDEO=1]="VIDEO"})($=et.ClientMetricReportMediaType||(et.ClientMetricReportMediaType={})),et.default=$})(ClientMetricReportMediaType);var GlobalMetricReport$1={};Object.defineProperty(GlobalMetricReport$1,"__esModule",{value:!0});class GlobalMetricReport{constructor(){this.previousMetrics={},this.currentMetrics={},this.currentStringMetrics={},this.previousObjectMetrics={},this.currentObjectMetrics={}}}GlobalMetricReport$1.default=GlobalMetricReport;var __importDefault$1u=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(ClientMetricReport$1,"__esModule",{value:!0});const SignalingProtocol_js_1$f=SignalingProtocol,ClientMetricReportDirection_1$3=__importDefault$1u(ClientMetricReportDirection),ClientMetricReportMediaType_1$3=__importDefault$1u(ClientMetricReportMediaType),GlobalMetricReport_1=__importDefault$1u(GlobalMetricReport$1);class ClientMetricReport{constructor($,_,tt){this.logger=$,this.videoStreamIndex=_,this.selfAttendeeId=tt,this.globalMetricReport=new GlobalMetricReport_1.default,this.streamMetricReports={},this.rtcStatsReport={},this.customStatsReports=[],this.currentTimestampMs=0,this.previousTimestampMs=0,this.currentSsrcs={},this.overriddenObservableMetrics=new Map,this.identityValue=(nt,it)=>{const rt=it?this.streamMetricReports[it]:this.globalMetricReport;return Number(rt.currentMetrics[nt])},this.decoderLossPercent=(nt,it)=>{const rt=this.streamMetricReports[it],ot=rt.currentMetrics.concealedSamples-(rt.previousMetrics.concealedSamples||0),lt=rt.currentMetrics.totalSamplesReceived-(rt.previousMetrics.totalSamplesReceived||0);return lt<=0||lt-ot<=0?0:ot/lt*100},this.packetLossPercent=(nt,it)=>{const rt=this.streamMetricReports[it],ot=rt.currentMetrics[nt]-(rt.previousMetrics[nt]||0),lt=rt.currentMetrics.packetsLost-(rt.previousMetrics.packetsLost||0),st=ot+lt;return st<=0||lt<=0?0:lt*100/st},this.jitterBufferMs=(nt,it)=>{const rt=this.streamMetricReports[it],ot=rt.currentMetrics.jitterBufferDelay-(rt.previousMetrics.jitterBufferDelay||0),lt=rt.currentMetrics.jitterBufferEmittedCount-(rt.previousMetrics.jitterBufferEmittedCount||0);return ot<=0||lt<=0?0:ot/lt*1e3},this.countPerSecond=(nt,it)=>{const rt=it?this.streamMetricReports[it]:this.globalMetricReport;let ot=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(ot<=0)return 0;this.previousTimestampMs<=0&&(ot=1);const lt=rt.currentMetrics[nt]-(rt.previousMetrics[nt]||0);return lt<=0?0:Math.trunc(lt/ot)},this.bitsPerSecond=(nt,it)=>{const rt=it?this.streamMetricReports[it]:this.globalMetricReport;let ot=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(ot<=0)return 0;this.previousTimestampMs<=0&&(ot=1);const lt=(rt.currentMetrics[nt]-(rt.previousMetrics[nt]||0))*8;return lt<=0?0:Math.trunc(lt/ot)},this.secondsToMilliseconds=(nt,it)=>{const rt=it?this.streamMetricReports[it]:this.globalMetricReport;return Number(rt.currentMetrics[nt]*1e3)},this.averageTimeSpentPerSecondInMilliseconds=(nt,it)=>{const rt=it?this.streamMetricReports[it]:this.globalMetricReport;let ot=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(ot<=0)return 0;this.previousTimestampMs<=0&&(ot=1);const lt=rt.currentMetrics[nt]-(rt.previousMetrics[nt]||0);return lt<=0?0:lt*1e3/ot},this.averageCpuQualityLimitationDurationPerSecondInMilliseconds=(nt,it)=>{const rt=this.streamMetricReports[it];if(rt.previousObjectMetrics[nt]===void 0||rt.currentObjectMetrics[nt]===void 0)return NaN;let ot=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(ot<=0)return 0;this.previousTimestampMs<=0&&(ot=1);let lt=0,st=0;for(const[ct,dt]of Object.entries(rt.previousObjectMetrics[nt]))ct==="cpu"&&(lt=dt);for(const[ct,dt]of Object.entries(rt.currentObjectMetrics[nt]))ct==="cpu"&&(st=dt);const at=st-lt;return at<=0?0:at*1e3/ot},this.isHardwareImplementation=(nt,it)=>{const rt=this.streamMetricReports[it];if(rt.currentStringMetrics[nt]===void 0)return NaN;const ot=String(rt.currentStringMetrics[nt]),lt=ot.includes("ExternalDecoder")||ot.includes("ExternalEncoder")||ot.includes("EncodeAccelerator")||ot.includes("DecodeAccelerator"),st=ot.includes("fallback from");return lt&&!st?1:0},this.globalMetricMap={retransmittedBytesSent:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RETRANSMIT_BITRATE},totalEncodedBytesTarget:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_TARGET_ENCODER_BITRATE},totalPacketSendDelay:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_BUCKET_DELAY_MS},packetsDiscardedOnSend:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.SOCKET_DISCARDED_PPS},availableIncomingBitrate:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_AVAILABLE_RECEIVE_BANDWIDTH},availableOutgoingBitrate:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_AVAILABLE_SEND_BANDWIDTH},currentRoundTripTime:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.STUN_RTT_MS},audioLevel:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_MIC_AUDIO_LEVEL,source:"audioLevel"}},this.audioUpstreamMetricMap={jitter:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_MIC_JITTER_MS},packetsSent:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_MIC_PPS},bytesSent:{transform:this.bitsPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_MIC_BITRATE},roundTripTime:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_MIC_RTT_MS},packetsLost:{transform:this.packetLossPercent,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_MIC_FRACTION_PACKET_LOST_PERCENT,source:"packetsSent"}},this.audioDownstreamMetricMap={concealedSamples:{transform:this.countPerSecond},totalSamplesReceived:{transform:this.countPerSecond},decoderLoss:{transform:this.decoderLossPercent,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_FRACTION_DECODER_LOSS_PERCENT},packetsReceived:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_PPS},packetsLost:{transform:this.packetLossPercent,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_FRACTION_PACKET_LOST_PERCENT,source:"packetsReceived"},jitter:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_JITTER_MS},jitterBufferDelay:{transform:this.countPerSecond},jitterBufferEmittedCount:{transform:this.countPerSecond},jitterBufferMs:{transform:this.jitterBufferMs,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_JITTER_BUFFER_MS},bytesReceived:{transform:this.bitsPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_BITRATE},audioLevel:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_AUDIO_LEVEL},totalAudioPacketsLost:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_TOTAL_LOST},totalAudioPacketsExpected:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_TOTAL_EXPECTED},totalAudioPacketsRecoveredRed:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_TOTAL_RECOVERED_RED},totalAudioPacketsRecoveredFec:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.RTC_SPK_TOTAL_RECOVERED_FEC}},this.videoUpstreamMetricMap={roundTripTime:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_SENT_RTT_MS},nackCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_NACKS_RECEIVED},pliCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_PLIS_RECEIVED},firCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_FIRS_RECEIVED},framesPerSecond:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_INPUT_FPS},framesEncoded:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_ENCODE_FPS},packetsSent:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_SENT_PPS},packetsLost:{transform:this.packetLossPercent,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT,source:"packetsSent"},bytesSent:{transform:this.bitsPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_SENT_BITRATE},qpSum:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_SENT_QP_SUM},frameHeight:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_ENCODE_HEIGHT},frameWidth:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_ENCODE_WIDTH},jitter:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_SENT_JITTER_MS},totalEncodeTime:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_ENCODE_MS},encoderImplementation:{transform:this.isHardwareImplementation,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_ENCODER_IS_HARDWARE},qualityLimitationDurations:{transform:this.averageCpuQualityLimitationDurationPerSecondInMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_QUALITY_LIMITATION_DURATION_CPU},videoCodecDegradationHighEncodeCpu:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_CODEC_DEGRADATION_HIGH_ENCODE_CPU},videoCodecDegradationEncodeFailure:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_CODEC_DEGRADATION_ENCODE_FAILURE},videoInputWidth:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_INPUT_WIDTH},videoInputHeight:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_INPUT_HEIGHT}},this.videoDownstreamMetricMap={packetsReceived:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RECEIVED_PPS},packetsLost:{transform:this.packetLossPercent,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT,source:"packetsReceived"},framesReceived:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RECEIVED_FPS},framesDecoded:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_DECODE_FPS},nackCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_NACKS_SENT},firCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_FIRS_SENT},pliCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_PLIS_SENT},bytesReceived:{transform:this.bitsPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RECEIVED_BITRATE},jitter:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RECEIVED_JITTER_MS},jitterBufferDelay:{transform:this.countPerSecond},jitterBufferEmittedCount:{transform:this.countPerSecond},jitterBufferMs:{transform:this.jitterBufferMs,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_JITTER_BUFFER_MS},qpSum:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RECEIVED_QP_SUM},frameHeight:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_DECODE_HEIGHT},frameWidth:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_DECODE_WIDTH},totalDecodeTime:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_DECODE_MS},decoderImplementation:{transform:this.isHardwareImplementation,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_DECODER_IS_HARDWARE},totalFreezesDuration:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_FREEZE_DURATION},freezeCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_FREEZE_COUNT},totalPausesDuration:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_PAUSE_DURATION},pauseCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_PAUSE_COUNT},framesDropped:{transform:this.countPerSecond,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_DROPPED_FPS},videoRenderWidth:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RENDER_WIDTH},videoRenderHeight:{transform:this.identityValue,type:SignalingProtocol_js_1$f.SdkMetric.Type.VIDEO_RENDER_HEIGHT}},this.streamDimensionMap={encoderImplementation:SignalingProtocol_js_1$f.SdkStreamDimension.Type.VIDEO_ENCODER_NAME,decoderImplementation:SignalingProtocol_js_1$f.SdkStreamDimension.Type.VIDEO_DECODER_NAME},this.observableVideoMetricSpec={videoUpstreamBitrate:{source:"bytesSent",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamPacketsSent:{source:"packetsSent",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamPacketLossPercent:{source:"packetsLost",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamFramesEncodedPerSecond:{source:"framesEncoded",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamFramesInputPerSecond:{source:"framesPerSecond",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamFrameHeight:{source:"frameHeight",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamFrameWidth:{source:"frameWidth",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamJitterMs:{source:"jitter",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamRoundTripTimeMs:{source:"roundTripTime",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamEncoderImplementation:{source:"encoderImplementation",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamTotalEncodeTimePerSecond:{source:"totalEncodeTime",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamCpuQualityLimitationDurationPerSecond:{source:"qualityLimitationDurations",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoDownstreamBitrate:{source:"bytesReceived",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamPacketLossPercent:{source:"packetsLost",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamPacketsReceived:{source:"packetsReceived",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamFramesDecodedPerSecond:{source:"framesDecoded",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamFrameHeight:{source:"frameHeight",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamFrameWidth:{source:"frameWidth",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamJitterMs:{source:"jitter",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamDelayMs:{source:"jitterBufferMs",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM}},this.observableMetricSpec={audioPacketsReceived:{source:"packetsReceived",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioPacketsReceivedFractionLoss:{source:"packetsLost",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioDecoderLoss:{source:"decoderLoss",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioPacketsSent:{source:"packetsSent",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},audioPacketLossPercent:{source:"packetsLost",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},audioUpstreamRoundTripTimeMs:{source:"roundTripTime",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamBitrate:{source:"bytesSent",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoPacketSentPerSecond:{source:"packetsSent",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},audioSpeakerDelayMs:{source:"jitterBufferMs",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioUpstreamJitterMs:{source:"jitter",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},audioDownstreamJitterMs:{source:"jitter",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},nackCountReceivedPerSecond:{source:"nackCount",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},availableOutgoingBitrate:{source:"availableOutgoingBitrate"},availableIncomingBitrate:{source:"availableIncomingBitrate"},currentRoundTripTimeMs:{source:"currentRoundTripTime"},audioDownstreamLevel:{source:"audioLevel",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioUpstreamLevel:{source:"audioLevel"}}}getMetricMap($,_){switch($){case ClientMetricReportMediaType_1$3.default.AUDIO:switch(_){case ClientMetricReportDirection_1$3.default.UPSTREAM:return this.audioUpstreamMetricMap;case ClientMetricReportDirection_1$3.default.DOWNSTREAM:return this.audioDownstreamMetricMap}case ClientMetricReportMediaType_1$3.default.VIDEO:switch(_){case ClientMetricReportDirection_1$3.default.UPSTREAM:return this.videoUpstreamMetricMap;case ClientMetricReportDirection_1$3.default.DOWNSTREAM:return this.videoDownstreamMetricMap}default:return this.globalMetricMap}}getStreamDimensionMap(){return this.streamDimensionMap}getObservableMetricValue($){if(this.overriddenObservableMetrics.has($))return this.overriddenObservableMetrics.get($);const _=this.observableMetricSpec[$],nt=this.getMetricMap(_.media,_.dir)[_.source],{transform:it,source:rt}=nt;if(_.hasOwnProperty("media"))for(const ot in this.streamMetricReports){const lt=this.streamMetricReports[ot];if(lt.direction===_.dir&&lt.mediaType===_.media)return it(rt||_.source,Number(ot))}else return it(rt||_.source);return 0}getObservableVideoMetricValue($,_){const tt=this.observableVideoMetricSpec[$],it=this.getMetricMap(tt.media,tt.dir)[tt.source],{transform:rt,source:ot}=it;return rt(ot||tt.source,_)}getVideoUpstreamSsrcs(){const $=[];for(const _ in this.streamMetricReports)this.streamMetricReports[_].mediaType===ClientMetricReportMediaType_1$3.default.VIDEO&&this.streamMetricReports[_].direction===ClientMetricReportDirection_1$3.default.UPSTREAM&&$.push(Number(_));return $}getObservableMetrics(){const $={};for(const _ in this.observableMetricSpec)$[_]=this.getObservableMetricValue(_);return $}getObservableVideoMetrics(){const $={};if(!this.videoStreamIndex||!this.selfAttendeeId)return this.logger.error("Need to define VideoStreamIndex and selfAttendeeId if using getObservableVideoMetrics API"),$;for(const _ in this.streamMetricReports)if(this.streamMetricReports[_].mediaType===ClientMetricReportMediaType_1$3.default.VIDEO){const tt={};for(const ot in this.observableVideoMetricSpec)if(this.observableVideoMetricSpec[ot].dir===this.streamMetricReports[_].direction){const lt=this.getObservableVideoMetricValue(ot,Number(_));isNaN(lt)||(tt[ot]=lt)}const nt=this.streamMetricReports[_].groupId,it=this.streamMetricReports[_].streamId;let rt="";this.videoStreamIndex.attendeeIdForGroupId!==void 0?rt=nt?this.videoStreamIndex.attendeeIdForGroupId(nt):this.selfAttendeeId:rt=it?this.videoStreamIndex.attendeeIdForStreamId(it):this.selfAttendeeId,$[rt]=$[rt]?$[rt]:{},$[rt][_]=tt}return $}getRTCStatsReport(){return this.rtcStatsReport}clone(){const $=new ClientMetricReport(this.logger,this.videoStreamIndex,this.selfAttendeeId);return $.globalMetricReport=this.globalMetricReport,$.streamMetricReports=this.streamMetricReports,$.rtcStatsReport=this.rtcStatsReport,$.customStatsReports=this.customStatsReports,$.currentTimestampMs=this.currentTimestampMs,$.previousTimestampMs=this.previousTimestampMs,$.overriddenObservableMetrics=this.overriddenObservableMetrics,$}print(){const $={globalMetricReport:this.globalMetricReport,streamMetricReports:this.streamMetricReports,currentTimestampMs:this.currentTimestampMs,previousTimestampMs:this.previousTimestampMs};this.logger.debug(()=>`Client Metric Report: ${JSON.stringify($)}`)}removeDestroyedSsrcs(){for(const $ in this.streamMetricReports)this.currentSsrcs[$]||delete this.streamMetricReports[$]}overrideObservableMetric($,_){this.overriddenObservableMetrics.set($,_)}}ClientMetricReport$1.default=ClientMetricReport;var ClientVideoStreamReceivingReport$1={};Object.defineProperty(ClientVideoStreamReceivingReport$1,"__esModule",{value:!0});class ClientVideoStreamReceivingReport{}ClientVideoStreamReceivingReport$1.default=ClientVideoStreamReceivingReport;var ConnectionHealthData$1={};Object.defineProperty(ConnectionHealthData$1,"__esModule",{value:!0});class ConnectionHealthData{constructor(){this.connectionStartTimestampMs=0,this.consecutiveStatsWithNoPackets=0,this.consecutiveStatsWithNoAudioPacketsSent=0,this.lastPacketLossInboundTimestampMs=0,this.lastGoodSignalTimestampMs=0,this.lastWeakSignalTimestampMs=0,this.lastNoSignalTimestampMs=0,this.consecutiveMissedPongs=0,this.packetsReceivedInLastMinute=[],this.fractionPacketsLostInboundInLastMinute=[],this.audioSpeakerDelayMs=0,this.isVideoEncoderHardware=!1,this.videoEncodingTimeInMs=0,this.videoEncodingTimePerFrameInMs=0,this.cpuLimitationDuration=0,this.videoInputFps=0,this.videoEncodeFps=0,this.isContentShare=!1,this.numberOfPublishedVideoSources=0,this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}static isTimestampRecent($,_){return Date.now()<$+_}setConnectionStartTime(){this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}reset(){this.connectionStartTimestampMs=0,this.consecutiveStatsWithNoPackets=0,this.consecutiveStatsWithNoAudioPacketsSent=0,this.lastPacketLossInboundTimestampMs=0,this.lastGoodSignalTimestampMs=0,this.lastWeakSignalTimestampMs=0,this.lastNoSignalTimestampMs=0,this.consecutiveMissedPongs=0,this.packetsReceivedInLastMinute=[],this.fractionPacketsLostInboundInLastMinute=[],this.audioSpeakerDelayMs=0,this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now(),this.isVideoEncoderHardware=!1,this.videoEncodingTimeInMs=0,this.videoEncodingTimePerFrameInMs=0,this.cpuLimitationDuration=0,this.videoInputFps=0,this.videoEncodeFps=0,this.isContentShare=!1,this.numberOfPublishedVideoSources=0}isConnectionStartRecent($){return ConnectionHealthData.isTimestampRecent(this.connectionStartTimestampMs,$)}isLastPacketLossRecent($){return ConnectionHealthData.isTimestampRecent(this.lastPacketLossInboundTimestampMs,$)}isGoodSignalRecent($){return ConnectionHealthData.isTimestampRecent(this.lastGoodSignalTimestampMs,$)}isWeakSignalRecent($){return ConnectionHealthData.isTimestampRecent(this.lastWeakSignalTimestampMs,$)}isNoSignalRecent($){return ConnectionHealthData.isTimestampRecent(this.lastNoSignalTimestampMs,$)}clone(){const $=new ConnectionHealthData;return $.connectionStartTimestampMs=this.connectionStartTimestampMs,$.consecutiveStatsWithNoPackets=this.consecutiveStatsWithNoPackets,$.consecutiveStatsWithNoAudioPacketsSent=this.consecutiveStatsWithNoAudioPacketsSent,$.lastPacketLossInboundTimestampMs=this.lastPacketLossInboundTimestampMs,$.lastGoodSignalTimestampMs=this.lastGoodSignalTimestampMs,$.lastWeakSignalTimestampMs=this.lastWeakSignalTimestampMs,$.lastNoSignalTimestampMs=this.lastNoSignalTimestampMs,$.consecutiveMissedPongs=this.consecutiveMissedPongs,$.packetsReceivedInLastMinute=this.packetsReceivedInLastMinute.slice(0),$.fractionPacketsLostInboundInLastMinute=this.fractionPacketsLostInboundInLastMinute.slice(0),$.audioSpeakerDelayMs=this.audioSpeakerDelayMs,$.isVideoEncoderHardware=this.isVideoEncoderHardware,$.videoEncodingTimeInMs=this.videoEncodingTimeInMs,$.videoEncodingTimePerFrameInMs=this.videoEncodingTimePerFrameInMs,$.cpuLimitationDuration=this.cpuLimitationDuration,$.videoInputFps=this.videoInputFps,$.videoEncodeFps=this.videoEncodeFps,$.isContentShare=this.isContentShare,$.numberOfPublishedVideoSources=this.numberOfPublishedVideoSources,$}setConsecutiveMissedPongs($){this.consecutiveMissedPongs=$}setConsecutiveStatsWithNoPackets($){this.consecutiveStatsWithNoPackets=$}setConsecutiveStatsWithNoAudioPacketsSent($){this.consecutiveStatsWithNoAudioPacketsSent=$}setLastPacketLossInboundTimestampMs($){this.lastPacketLossInboundTimestampMs=$}setLastNoSignalTimestampMs($){this.lastNoSignalTimestampMs=$}setLastWeakSignalTimestampMs($){this.lastWeakSignalTimestampMs=$}setLastGoodSignalTimestampMs($){this.lastGoodSignalTimestampMs=$}setAudioSpeakerDelayMs($){this.audioSpeakerDelayMs=$}setIsVideoEncoderHardware($){this.isVideoEncoderHardware=$}setVideoEncodingTimeInMs($){this.videoEncodingTimeInMs=$}setVideoEncodingTimePerFrameInMs($){this.videoEncodingTimePerFrameInMs=$}setCpuLimitationDuration($){this.cpuLimitationDuration=$}setVideoInputFps($){this.videoInputFps=$}setVideoEncodeFps($){this.videoEncodeFps=$}setIsContentShare($){this.isContentShare=$}setNumberOfPublishedVideoSources($){this.numberOfPublishedVideoSources=$}}ConnectionHealthData$1.default=ConnectionHealthData;var ConnectionHealthPolicyConfiguration$1={},VideoEncodingConcurrentSendersHealthPolicy$1={},VideoEncodingConnectionHealthPolicyName={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.VideoEncodingConnectionHealthPolicyName=void 0;var $;(function(_){_.VideoEncodingCpuHealth="Video Encoding CPU Health",_.VideoEncodingFramerateHealth="Video Encoding framerate Health",_.VideoConcurrentSendersHealth="Video Concurrent Senders Health"})($=et.VideoEncodingConnectionHealthPolicyName||(et.VideoEncodingConnectionHealthPolicyName={})),et.default=$})(VideoEncodingConnectionHealthPolicyName);var __importDefault$1t=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(VideoEncodingConcurrentSendersHealthPolicy$1,"__esModule",{value:!0});const BaseConnectionHealthPolicy_1$5=__importDefault$1t(BaseConnectionHealthPolicy$1),VideoEncodingConnectionHealthPolicyName_1$3=__importDefault$1t(VideoEncodingConnectionHealthPolicyName);class VideoEncodingConcurrentSendersHealthPolicy extends BaseConnectionHealthPolicy_1$5.default{constructor($,_){super($,_,VideoEncodingConnectionHealthPolicyName_1$3.default.VideoConcurrentSendersHealth),this.concurrentVideoSendersThreshold=$.concurrentVideoSendersThreshold}health(){return this.currentData.isContentShare?this.maximumHealth():this.currentData.numberOfPublishedVideoSources>this.concurrentVideoSendersThreshold?this.minimumHealth():this.maximumHealth()}}VideoEncodingConcurrentSendersHealthPolicy$1.default=VideoEncodingConcurrentSendersHealthPolicy;var VideoEncodingCpuConnectionHealthPolicy$1={},__importDefault$1s=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(VideoEncodingCpuConnectionHealthPolicy$1,"__esModule",{value:!0});const BaseConnectionHealthPolicy_1$4=__importDefault$1s(BaseConnectionHealthPolicy$1),VideoEncodingConnectionHealthPolicyName_1$2=__importDefault$1s(VideoEncodingConnectionHealthPolicyName);class VideoEncodingCpuConnectionHealthPolicy extends BaseConnectionHealthPolicy_1$4.default{constructor($,_){super($,_,VideoEncodingConnectionHealthPolicyName_1$2.default.VideoEncodingCpuHealth),this.consecutiveHighEncodeCpuCnt=0,this.consecutiveHighEncodeCpuThreshold=$.consecutiveHighEncodeCpuThreshold,this.highEncodeCpuMsThreshold=$.highEncodeCpuMsThreshold,this.highEncodeCpuMsPerFrameThreshold=$.highEncodeCpuMsPerFrameThreshold}health(){const $=this.currentData.videoEncodingTimeInMs>=this.highEncodeCpuMsThreshold&&this.currentData.videoEncodingTimePerFrameInMs>=this.highEncodeCpuMsPerFrameThreshold;if(!this.currentData.isVideoEncoderHardware&&($||this.currentData.cpuLimitationDuration>0)){if(this.consecutiveHighEncodeCpuCnt++,this.consecutiveHighEncodeCpuCnt>this.consecutiveHighEncodeCpuThreshold)return this.consecutiveHighEncodeCpuCnt=0,this.minimumHealth()}else this.consecutiveHighEncodeCpuCnt=0;return this.maximumHealth()}}VideoEncodingCpuConnectionHealthPolicy$1.default=VideoEncodingCpuConnectionHealthPolicy;var VideoEncodingFramerateConnectionHealthPolicy$1={},__importDefault$1r=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(VideoEncodingFramerateConnectionHealthPolicy$1,"__esModule",{value:!0});const BaseConnectionHealthPolicy_1$3=__importDefault$1r(BaseConnectionHealthPolicy$1),VideoEncodingConnectionHealthPolicyName_1$1=__importDefault$1r(VideoEncodingConnectionHealthPolicyName);class VideoEncodingFramerateConnectionHealthPolicy extends BaseConnectionHealthPolicy_1$3.default{constructor($,_){super($,_,VideoEncodingConnectionHealthPolicyName_1$1.default.VideoEncodingFramerateHealth),this.consecutiveEncodeFailureCnt=0,this.consecutiveVideoEncodingFailureThreshold=$.consecutiveVideoEncodingFailureThreshold}health(){if(this.currentData.videoEncodeFps===0&&this.currentData.videoInputFps>0){if(this.consecutiveEncodeFailureCnt++,this.consecutiveEncodeFailureCnt>this.consecutiveVideoEncodingFailureThreshold)return this.consecutiveEncodeFailureCnt=0,this.minimumHealth()}else this.consecutiveEncodeFailureCnt=0;return this.maximumHealth()}}VideoEncodingFramerateConnectionHealthPolicy$1.default=VideoEncodingFramerateConnectionHealthPolicy;var __importDefault$1q=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(ConnectionHealthPolicyConfiguration$1,"__esModule",{value:!0});const VideoEncodingConcurrentSendersHealthPolicy_1=__importDefault$1q(VideoEncodingConcurrentSendersHealthPolicy$1),VideoEncodingCpuConnectionHealthPolicy_1=__importDefault$1q(VideoEncodingCpuConnectionHealthPolicy$1),VideoEncodingFramerateConnectionHealthPolicy_1=__importDefault$1q(VideoEncodingFramerateConnectionHealthPolicy$1);class ConnectionHealthPolicyConfiguration{constructor(){this.minHealth=0,this.maxHealth=1,this.initialHealth=1,this.connectionUnhealthyThreshold=25,this.noSignalThresholdTimeMs=1e4,this.connectionWaitTimeMs=1e4,this.zeroBarsNoSignalTimeMs=5e3,this.oneBarWeakSignalTimeMs=5e3,this.twoBarsTimeMs=5e3,this.threeBarsTimeMs=1e4,this.fourBarsTimeMs=2e4,this.fiveBarsTimeMs=6e4,this.cooldownTimeMs=6e4,this.pastSamplesToConsider=15,this.goodSignalTimeMs=15e3,this.fractionalLoss=.5,this.packetsExpected=50,this.maximumTimesToWarn=2,this.missedPongsLowerThreshold=1,this.missedPongsUpperThreshold=4,this.maximumAudioDelayMs=6e4,this.maximumAudioDelayDataPoints=10,this.sendingAudioFailureSamplesToConsider=2,this.sendingAudioFailureInitialWaitTimeMs=3e3,this.videoEncodingHealthPolicies=[VideoEncodingConcurrentSendersHealthPolicy_1.default,VideoEncodingCpuConnectionHealthPolicy_1.default,VideoEncodingFramerateConnectionHealthPolicy_1.default],this.consecutiveHighEncodeCpuThreshold=10,this.highEncodeCpuMsThreshold=500,this.highEncodeCpuMsPerFrameThreshold=15,this.consecutiveVideoEncodingFailureThreshold=5,this.concurrentVideoSendersThreshold=15}}ConnectionHealthPolicyConfiguration$1.default=ConnectionHealthPolicyConfiguration;var ContentShareConstants$1={};Object.defineProperty(ContentShareConstants$1,"__esModule",{value:!0});var ContentShareConstants;(function(et){et.Modality="#content"})(ContentShareConstants||(ContentShareConstants={}));ContentShareConstants$1.default=ContentShareConstants;var ContentShareMediaStreamBroker$1={},DefaultDeviceController$1={},DefaultMediaDeviceFactory$1={},MediaDeviceProxyHandler$1={},IntervalScheduler$1={};Object.defineProperty(IntervalScheduler$1,"__esModule",{value:!0});class IntervalScheduler{constructor($){this.intervalMs=$}start($){this.stop(),this.timer=setInterval($,this.intervalMs)}stop(){this.timer!==void 0&&(clearInterval(this.timer),this.timer=void 0)}running(){return this.timer!==void 0}}IntervalScheduler$1.default=IntervalScheduler;var __awaiter$T=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1p=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(MediaDeviceProxyHandler$1,"__esModule",{value:!0});const AsyncScheduler_1$7=__importDefault$1p(AsyncScheduler$1),IntervalScheduler_1$5=__importDefault$1p(IntervalScheduler$1);class MediaDeviceProxyHandler{constructor(){this.scheduler=null,this.devices=null,this.deviceChangeListeners=new Set,this.get=($,_,tt)=>{if(!Reflect.has($,_))return;if(!("ondevicechange"in navigator.mediaDevices)){if(_==="addEventListener")return this.patchAddEventListener($,_,tt);if(_==="removeEventListener")return this.patchRemoveEventListener($,_,tt)}const nt=Reflect.get($,_,tt);return typeof nt=="function"?nt.bind($):nt},this.patchAddEventListener=($,_,tt)=>{const nt=Reflect.get($,_,tt);return(it,rt,ot)=>{if(it==="devicechange")this.deviceChangeListeners.add(rt),this.scheduler||(this.scheduler=new IntervalScheduler_1$5.default(MediaDeviceProxyHandler.INTERVAL_MS),this.scheduler.start(this.pollDeviceLists));else return Reflect.apply(nt,$,[it,rt,ot])}},this.patchRemoveEventListener=($,_,tt)=>{const nt=Reflect.get($,_,tt);return(it,rt,ot)=>{if(it==="devicechange")this.deviceChangeListeners.delete(rt),this.deviceChangeListeners.size===0&&this.scheduler&&(this.scheduler.stop(),this.scheduler=null);else return Reflect.apply(nt,$,[it,rt,ot])}},this.pollDeviceLists=()=>__awaiter$T(this,void 0,void 0,function*(){const $=yield this.sortedDeviceList();this.devices&&($.length!==this.devices.length||$.some((tt,nt)=>tt.deviceId!==this.devices[nt].deviceId))&&this.handleDeviceChangeEvent(),this.devices=$})}sortedDeviceList(){return __awaiter$T(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).sort((_,tt)=>_.deviceId<tt.deviceId?1:_.deviceId>tt.deviceId?-1:0)})}handleDeviceChangeEvent(){for(const $ of this.deviceChangeListeners)AsyncScheduler_1$7.default.nextTick(()=>{if(this.deviceChangeListeners.has($)){const _=new Event("devicechange");typeof $=="function"?$(_):$.handleEvent(_)}})}}MediaDeviceProxyHandler$1.default=MediaDeviceProxyHandler;MediaDeviceProxyHandler.INTERVAL_MS=1e3;var __importDefault$1o=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultMediaDeviceFactory$1,"__esModule",{value:!0});const MediaDeviceProxyHandler_1=__importDefault$1o(MediaDeviceProxyHandler$1);class DefaultMediaDeviceFactory{constructor(){this.isMediaDevicesSupported=typeof navigator<"u"&&!!navigator.mediaDevices}create(){if(this.isMediaDevicesSupported)return new Proxy(navigator.mediaDevices,new MediaDeviceProxyHandler_1.default);throw new Error("navigator.mediaDevices is not supported")}}DefaultMediaDeviceFactory$1.default=DefaultMediaDeviceFactory;var PromiseQueue$1={};Object.defineProperty(PromiseQueue$1,"__esModule",{value:!0});class PromiseQueue{constructor(){this.queue=Promise.resolve()}add($){return new Promise((_,tt)=>{this.queue=this.queue.then($).then(_).catch(tt)})}}PromiseQueue$1.default=PromiseQueue;var Types={};Object.defineProperty(Types,"__esModule",{value:!0});Types.None=Types.Some=Types.Maybe=void 0;class Maybe{static of($){return $==null?None.of():Some.of($)}}Types.Maybe=Maybe;class Some{constructor($){this.value=$,this.isSome=!0,this.isNone=!1}map($){return Maybe.of($(this.value))}flatMap($){return $(this.value)}get(){return this.value}getOrElse($){return this.value}defaulting($){return Maybe.of(this.getOrElse($))}static of($){if($==null)throw new Error("value is ${value}");return new Some($)}}Types.Some=Some;class None{constructor(){this.isSome=!1,this.isNone=!0}get(){throw new Error("value is null")}getOrElse($){return $}map($){return new None}flatMap($){return new None}defaulting($){return Maybe.of(this.getOrElse($))}static of(){return new None}}Types.None=None;var DefaultVideoTransformDevice$1={},DefaultVideoFrameProcessorPipeline$1={},DefaultVideoFrameProcessorTimer$1={},__awaiter$S=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(DefaultVideoFrameProcessorTimer$1,"__esModule",{value:!0});class DefaultVideoFrameProcessorTimer{constructor(){this.workerTimer=void 0,this.callback=void 0,this.workerTimer=this.createWorkerTimer()}createWorkerTimer(){try{const $=new Blob([`self.onmessage = async function(e){ 
            var timerID = null;
            const awaitTimeout = delay => new Promise( resolve => {
              timerID = setTimeout(resolve, delay);
            })
            await awaitTimeout(e.data);
            postMessage(timerID);
          }`],{type:"application/javascript"});return new Worker(window.URL.createObjectURL($))}catch{}}start($,_){return __awaiter$S(this,void 0,void 0,function*(){this.callback=_,this.workerTimer?(this.workerTimer.onmessage=tt=>{this.lastTimeout=tt.data,this.callback()},this.workerTimer.postMessage($)):this.lastTimeout=setTimeout(()=>{this.callback()},$)})}destroy(){return __awaiter$S(this,void 0,void 0,function*(){this.callback=void 0,this.lastTimeout&&(clearTimeout(this.lastTimeout),this.lastTimeout=void 0),this.workerTimer&&(this.workerTimer.terminate(),this.workerTimer=void 0)})}}DefaultVideoFrameProcessorTimer$1.default=DefaultVideoFrameProcessorTimer;var __awaiter$R=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1n=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultVideoFrameProcessorPipeline$1,"__esModule",{value:!0});const CanvasVideoFrameBuffer_1$1=__importDefault$1n(CanvasVideoFrameBuffer$1),DefaultVideoFrameProcessorTimer_1=__importDefault$1n(DefaultVideoFrameProcessorTimer$1),DEFAULT_FRAMERATE=15;class DefaultVideoFrameProcessorPipeline{constructor($,_,tt=new DefaultVideoFrameProcessorTimer_1.default){this.logger=$,this.stages=_,this.fr=DEFAULT_FRAMERATE,this.outputMediaStream=new MediaStream,this.videoInput=document.createElement("video"),this.canvasOutput=document.createElement("canvas"),this.outputCtx=this.canvasOutput.getContext("2d"),this.canvasInput=document.createElement("canvas"),this.inputCtx=this.canvasInput.getContext("2d"),this.inputVideoStream=null,this.sourceBuffers=[],this.destBuffers=[],this.observers=new Set,this.hasStarted=!1,this.process=nt=>__awaiter$R(this,void 0,void 0,function*(){if(!this.inputVideoStream)return;const it=performance.now();this.videoInput.videoWidth&&(this.canvasInput.width!==this.videoInput.videoWidth&&(this.canvasInput.width=this.videoInput.videoWidth,this.canvasInput.height=this.videoInput.videoHeight,this.sourceBuffers[0].height=this.canvasInput.height,this.sourceBuffers[0].width=this.canvasInput.width,this.sourceBuffers[0].framerate=this.framerate),this.inputCtx.drawImage(this.videoInput,0,0));let rt=[];rt.push(this.sourceBuffers[0]);try{for(const ut of this.processors)rt=yield ut.process(rt)}catch{this.forEachObserver(ft=>{ft.processingDidFailToStart&&ft.processingDidFailToStart()});return}this.destBuffers=rt;let ot;try{ot=yield this.destBuffers[0].asCanvasImageSource()}catch{this.inputVideoStream&&(this.logger.info("buffers are destroyed and pipeline could not start"),this.forEachObserver(ft=>{ft.processingDidFailToStart&&ft.processingDidFailToStart()}));return}const lt=ot.width,st=ot.height;lt!==0&&st!==0&&(this.canvasOutput.width!==lt&&this.canvasOutput.height!==st&&(this.canvasOutput.width=lt,this.canvasOutput.height=st),this.outputCtx.drawImage(ot,0,0,lt,st,0,0,lt,st),this.hasStarted||(this.hasStarted=!0,this.forEachObserver(ut=>{ut.processingDidStart&&ut.processingDidStart()})));const at=performance.now()-it,ct=1e3*2/this.framerate-at,dt=Math.max(0,1e3/this.framerate-at);ct<=0&&this.forEachObserver(ut=>{ut.processingLatencyTooHigh&&ut.processingLatencyTooHigh(at)}),yield this.timer.start(dt,this.process.bind(this))}),this.timer=tt}destroy(){if(this.stop(),this.stages)for(const $ of this.stages)$.destroy();this.timer.destroy()}get framerate(){return this.fr}set framerate($){this.fr=$<0||$===void 0?DEFAULT_FRAMERATE:$}stop(){if(this.videoInput.removeEventListener("loadedmetadata",this.process),this.videoInput.srcObject=null,this.destroyInputMediaStreamAndBuffers(),this.outputMediaStream)for(const $ of this.outputMediaStream.getVideoTracks())$.stop();this.hasStarted&&(this.hasStarted=!1,this.forEachObserver($=>{$.processingDidStop&&$.processingDidStop()}))}addObserver($){this.observers.add($)}removeObserver($){this.observers.delete($)}getInputMediaStream(){return __awaiter$R(this,void 0,void 0,function*(){return this.inputVideoStream})}getActiveOutputMediaStream(){return this.isOutputMediaStreamActive()?this.outputMediaStream:(this.outputMediaStream=this.canvasOutput.captureStream(this.framerate),this.cloneInputAudioTracksToOutput(),this.outputMediaStream)}setInputMediaStream($){return __awaiter$R(this,void 0,void 0,function*(){if(!$){this.stop();return}if($.getVideoTracks().length===0){this.logger.error("No video tracks in input media stream, ignoring");return}this.inputVideoStream=$;const _=this.inputVideoStream.getVideoTracks()[0].getSettings();this.logger.info(`processing pipeline input stream settings ${JSON.stringify(_)}`),this.framerate=_.frameRate,this.canvasOutput.width=_.width,this.canvasOutput.height=_.height,this.videoInput.addEventListener("loadedmetadata",this.process),this.videoInput.srcObject=this.inputVideoStream,this.videoInput.setAttribute("playsinline","true");const tt=new CanvasVideoFrameBuffer_1$1.default(this.canvasInput);this.sourceBuffers.push(tt),this.videoInput.load();try{yield this.videoInput.play()}catch{this.logger.warn("Video element play() overrided by another load().")}this.cloneInputAudioTracksToOutput()})}cloneInputAudioTracksToOutput(){if(!this.isOutputMediaStreamActive()||this.inputVideoStream===null){this.logger.info("Not cloning input audio tracks to output, do not have media streams ready");return}for(const $ of this.outputMediaStream.getAudioTracks())this.logger.info(`Removing audio track ${$.id} from output stream`),this.outputMediaStream.removeTrack($);for(const $ of this.inputVideoStream.getAudioTracks())this.logger.info(`Adding audio track ${$.id} to output stream`),this.outputMediaStream.addTrack($)}isOutputMediaStreamActive(){return this.outputMediaStream&&this.outputMediaStream.active}set processors($){this.stages=$}get processors(){return this.stages}forEachObserver($){for(const _ of this.observers)setTimeout(()=>{$(_)},0)}destroyInputMediaStreamAndBuffers(){if(this.inputVideoStream)for(const $ of this.inputVideoStream.getTracks())$.stop();this.inputVideoStream=null;for(const $ of this.sourceBuffers)$.destroy();this.sourceBuffers=[]}}DefaultVideoFrameProcessorPipeline$1.default=DefaultVideoFrameProcessorPipeline;var __awaiter$Q=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1m=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultVideoTransformDevice$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$9=__importDefault$1m(DefaultBrowserBehavior$1),DefaultVideoFrameProcessorPipeline_1=__importDefault$1m(DefaultVideoFrameProcessorPipeline$1);class DefaultVideoTransformDevice{constructor($,_,tt,nt=new DefaultBrowserBehavior_1$9.default){this.logger=$,this.device=_,this.processors=tt,this.browserBehavior=nt,this.observers=new Set,this.pipe=new DefaultVideoFrameProcessorPipeline_1.default(this.logger,this.processors),this.pipe.addObserver(this)}get outputMediaStream(){return this.pipe.outputMediaStream}passEventControllerToProcessors($){if(this.pipe.processors)for(const _ of this.pipe.processors)typeof _.setEventController=="function"&&_.setEventController($)}chooseNewInnerDevice($){const _=new DefaultVideoTransformDevice(this.logger,$,this.processors,this.browserBehavior);return _.pipe=this.pipe,_}getInnerDevice(){return this.device}intrinsicDevice(){return __awaiter$Q(this,void 0,void 0,function*(){return this.device})}transformStream($){return __awaiter$Q(this,void 0,void 0,function*(){return yield this.pipe.setInputMediaStream($),this.inputMediaStream=$,this.pipe.getActiveOutputMediaStream()})}onOutputStreamDisconnect(){this.logger.info("DefaultVideoTransformDevice: detach stopping input media stream");const $=this.device&&this.device.id;if(this.pipe.stop(),!$&&this.inputMediaStream)for(const _ of this.inputMediaStream.getVideoTracks())_.stop()}stop(){return __awaiter$Q(this,void 0,void 0,function*(){if(this.inputMediaStream)for(const $ of this.inputMediaStream.getVideoTracks())$.stop();this.pipe.destroy(),this.inputMediaStream=null})}addObserver($){this.observers.add($)}removeObserver($){this.observers.delete($)}processingDidStart(){this.logger.info("video transform device processing started"),this.forEachObserver($=>{$.processingDidStart&&$.processingDidStart()})}processingLatencyTooHigh($){this.forEachObserver(_=>{_.processingLatencyTooHigh&&_.processingLatencyTooHigh($)})}processingDidFailToStart(){this.logger.info("video transform device processing failed to start"),this.forEachObserver($=>{$.processingDidFailToStart&&$.processingDidFailToStart()})}processingDidStop(){this.logger.info("video transform device processing stopped"),this.forEachObserver($=>{$.processingDidStop&&$.processingDidStop()})}forEachObserver($){for(const _ of this.observers)setTimeout(()=>{$(_)},0)}get framerate(){return this.pipe.framerate}set framerate($){this.pipe.framerate=$}}DefaultVideoTransformDevice$1.default=DefaultVideoTransformDevice;var DefaultVideoTile$1={},DefaultModality$1={},__importDefault$1l=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultModality$1,"__esModule",{value:!0});const ContentShareConstants_1$3=__importDefault$1l(ContentShareConstants$1);class DefaultModality{constructor($){this._id=$}id(){return this._id}base(){return this._id?this._id.split(DefaultModality.MODALITY_SEPARATOR)[0]:""}modality(){if(!this._id)return"";const $=this._id.split(DefaultModality.MODALITY_SEPARATOR);return $.length===2?$[1]:""}hasModality($){return $!==""&&this.modality()===$}withModality($){const _=new DefaultModality(this.base()+DefaultModality.MODALITY_SEPARATOR+$);return $===""||this.base()===""||new DefaultModality(_._id).modality()!==$?new DefaultModality(this.base()):_}}DefaultModality$1.default=DefaultModality;DefaultModality.MODALITY_SEPARATOR=ContentShareConstants_1$3.default.Modality[0];DefaultModality.MODALITY_CONTENT=ContentShareConstants_1$3.default.Modality.substring(1);var VideoTileState$1={};Object.defineProperty(VideoTileState$1,"__esModule",{value:!0});class VideoTileState{constructor(){this.tileId=null,this.localTile=!1,this.localTileStarted=!1,this.isContent=!1,this.active=!1,this.paused=!1,this.poorConnection=!1,this.boundAttendeeId=null,this.boundExternalUserId=null,this.boundVideoStream=null,this.boundVideoElement=null,this.nameplate=null,this.videoStreamContentWidth=null,this.videoStreamContentHeight=null,this.videoElementCSSWidthPixels=null,this.videoElementCSSHeightPixels=null,this.devicePixelRatio=0,this.videoElementPhysicalWidthPixels=null,this.videoElementPhysicalHeightPixels=null,this.streamId=null,this.groupId=null}clone(){const $=new VideoTileState;return $.tileId=this.tileId,$.localTile=this.localTile,$.isContent=this.isContent,$.active=this.active,$.paused=this.paused,$.poorConnection=this.poorConnection,$.boundAttendeeId=this.boundAttendeeId,$.boundExternalUserId=this.boundExternalUserId,$.boundVideoStream=this.boundVideoStream,$.boundVideoElement=this.boundVideoElement,$.nameplate=this.nameplate,$.videoStreamContentWidth=this.videoStreamContentWidth,$.videoStreamContentHeight=this.videoStreamContentHeight,$.videoElementCSSWidthPixels=this.videoElementCSSWidthPixels,$.videoElementCSSHeightPixels=this.videoElementCSSHeightPixels,$.devicePixelRatio=this.devicePixelRatio,$.videoElementPhysicalWidthPixels=this.videoElementPhysicalWidthPixels,$.videoElementPhysicalHeightPixels=this.videoElementPhysicalHeightPixels,$.streamId=this.streamId,$.groupId=this.groupId,$}}VideoTileState$1.default=VideoTileState;var __importDefault$1k=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultVideoTile$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$8=__importDefault$1k(DefaultBrowserBehavior$1),DefaultModality_1$4=__importDefault$1k(DefaultModality$1),VideoTileState_1=__importDefault$1k(VideoTileState$1);class DefaultVideoTile{constructor($,_,tt,nt,it=void 0){this.tileController=tt,this.devicePixelRatioMonitor=nt,this.resolutionMonitor=it,this.tileState=new VideoTileState_1.default,this.tileState.tileId=$,this.tileState.localTile=_,this.devicePixelRatioMonitor.registerObserver(this)}static connectVideoStreamToVideoElement($,_,tt){const nt=tt&&$.getVideoTracks()[0].getSettings().facingMode!=="environment"?"rotateY(180deg)":"";if(DefaultVideoTile.setVideoElementFlag(_,"disablePictureInPicture",tt),DefaultVideoTile.setVideoElementFlag(_,"disableRemotePlayback",tt),_.style.transform!==nt&&(_.style.transform=nt),_.hasAttribute("controls")&&_.removeAttribute("controls"),_.hasAttribute("autoplay")||_.setAttribute("autoplay","true"),_.hasAttribute("playsinline")||_.setAttribute("playsinline","true"),_.hasAttribute("muted")||(_.setAttribute("muted","true"),_.muted=!0),_.srcObject!==$&&(_.srcObject=$,new DefaultBrowserBehavior_1$8.default().requiresVideoPlayWorkaround()&&_.paused)){const it=_.play();it!==void 0&&it.catch(rt=>{console.warn("Error playing video in Safari",rt)}).then(()=>{console.debug("Video played successfully in Safari")})}}static disconnectVideoStreamFromVideoElement($,_,tt=!1){if($)if(_)tt||($.srcObject=null,$.style.transform="");else{if(!$.srcObject)return;$.pause(),$.style.transform="",DefaultVideoTile.setVideoElementFlag($,"disablePictureInPicture",!1),DefaultVideoTile.setVideoElementFlag($,"disableRemotePlayback",!1),$.srcObject=null}}destroy(){this.devicePixelRatioMonitor.removeObserver(this),this.tileState.boundVideoElement&&this.tileState.boundVideoElement.srcObject===this.tileState.boundVideoStream&&DefaultVideoTile.disconnectVideoStreamFromVideoElement(this.tileState.boundVideoElement,!1),this.tileState=new VideoTileState_1.default}devicePixelRatioChanged($){this.tileState.devicePixelRatio=$,this.sendTileStateUpdate()}id(){return this.tileState.tileId}state(){return this.tileState.clone()}stateRef(){return this.tileState}bindVideoStream($,_,tt,nt,it,rt,ot,lt){let st=!1;this.tileState.boundAttendeeId!==$&&(this.tileState.boundAttendeeId=$,new DefaultModality_1$4.default($).hasModality(DefaultModality_1$4.default.MODALITY_CONTENT)&&(this.tileState.isContent=!0),st=!0),this.tileState.boundExternalUserId!==ot&&(this.tileState.boundExternalUserId=ot,st=!0),this.tileState.localTile!==_&&(this.tileState.localTile=_,st=!0),this.tileState.boundVideoStream!==tt&&(this.tileState.boundVideoStream=tt,st=!0),this.tileState.videoStreamContentWidth!==nt&&(this.tileState.videoStreamContentWidth=nt,st=!0),this.tileState.videoStreamContentHeight!==it&&(this.tileState.videoStreamContentHeight=it,st=!0),this.tileState.streamId!==rt&&(this.tileState.streamId=rt,st=!0),this.tileState.groupId!==lt&&(this.tileState.groupId=lt,st=!0),st&&this.sendTileStateUpdate()}bindVideoElement($){var _;let tt=!1;this.tileState.boundVideoElement!==$&&(this.tileState.boundVideoElement=$,(_=this.resolutionMonitor)===null||_===void 0||_.bindVideoElement(this.tileState.boundVideoElement),tt=!0),this.tileState.boundVideoElement!==null?(this.tileState.videoElementCSSWidthPixels!==$.clientWidth&&(this.tileState.videoElementCSSWidthPixels=$.clientWidth,tt=!0),this.tileState.videoElementCSSHeightPixels!==$.clientHeight&&(this.tileState.videoElementCSSHeightPixels=$.clientHeight,tt=!0)):(this.tileState.videoElementCSSWidthPixels=null,this.tileState.videoElementCSSHeightPixels=null),tt&&this.sendTileStateUpdate()}pause(){this.tileState.paused||(this.tileState.paused=!0,this.sendTileStateUpdate())}unpause(){this.tileState.paused&&(this.tileState.paused=!1,this.sendTileStateUpdate())}markPoorConnection(){return this.tileState.poorConnection?!1:(this.tileState.poorConnection=!0,this.sendTileStateUpdate(),!0)}unmarkPoorConnection(){return this.tileState.poorConnection?(this.tileState.poorConnection=!1,this.sendTileStateUpdate(),!0):!1}capture(){if(!this.tileState.active)return null;const $=document.createElement("canvas"),_=this.tileState.boundVideoElement;$.width=_.videoWidth||_.width,$.height=_.videoHeight||_.height;const tt=$.getContext("2d");return tt.drawImage(_,0,0,$.width,$.height),tt.getImageData(0,0,$.width,$.height)}setStreamId($){this.tileState.streamId=$,this.tileController.sendTileStateUpdate(this.state())}sendTileStateUpdate(){this.updateActiveState(),this.updateVideoStreamOnVideoElement(),this.updateVideoElementPhysicalPixels(),this.tileController.sendTileStateUpdate(this.state())}updateActiveState(){this.tileState.active=!!(!this.tileState.paused&&!this.tileState.poorConnection&&this.tileState.boundAttendeeId&&this.tileState.boundVideoElement&&this.tileState.boundVideoStream)}updateVideoElementPhysicalPixels(){typeof this.tileState.videoElementCSSWidthPixels=="number"&&typeof this.tileState.videoElementCSSHeightPixels=="number"?(this.tileState.videoElementPhysicalWidthPixels=this.tileState.devicePixelRatio*this.tileState.videoElementCSSWidthPixels,this.tileState.videoElementPhysicalHeightPixels=this.tileState.devicePixelRatio*this.tileState.videoElementCSSHeightPixels):(this.tileState.videoElementPhysicalWidthPixels=null,this.tileState.videoElementPhysicalHeightPixels=null)}updateVideoStreamOnVideoElement(){this.tileState.active?DefaultVideoTile.connectVideoStreamToVideoElement(this.tileState.boundVideoStream,this.tileState.boundVideoElement,this.tileState.localTile):DefaultVideoTile.disconnectVideoStreamFromVideoElement(this.tileState.boundVideoElement,this.tileState.paused,this.tileController.keepLastFrameWhenPaused)}static setVideoElementFlag($,_,tt){_ in $&&($[_]=tt)}}DefaultVideoTile$1.default=DefaultVideoTile;var AudioTransformDevice={};Object.defineProperty(AudioTransformDevice,"__esModule",{value:!0});AudioTransformDevice.isAudioTransformDevice=void 0;function isAudioTransformDevice(et){return!!et&&typeof et=="object"&&"mute"in et&&"stop"in et&&"intrinsicDevice"in et}AudioTransformDevice.isAudioTransformDevice=isAudioTransformDevice;var DeviceSelection$1={};Object.defineProperty(DeviceSelection$1,"__esModule",{value:!0});class DeviceSelection{constructor(){this.groupId=""}matchesConstraints($){return JSON.stringify(this.constraints)===JSON.stringify($)}}DeviceSelection$1.default=DeviceSelection;var GetUserMediaError$1={};Object.defineProperty(GetUserMediaError$1,"__esModule",{value:!0});class GetUserMediaError extends Error{constructor($,_){super(_||"Error fetching device."),this.cause=$,this.name="GetUserMediaError"}}GetUserMediaError$1.default=GetUserMediaError;var NotFoundError$1={},__importDefault$1j=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(NotFoundError$1,"__esModule",{value:!0});const GetUserMediaError_1$5=__importDefault$1j(GetUserMediaError$1);class NotFoundError extends GetUserMediaError_1$5.default{constructor($){super($),this.name="NotFoundError"}}NotFoundError$1.default=NotFoundError;var NotReadableError$1={},__importDefault$1i=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(NotReadableError$1,"__esModule",{value:!0});const GetUserMediaError_1$4=__importDefault$1i(GetUserMediaError$1);class NotReadableError extends GetUserMediaError_1$4.default{constructor($){super($),this.name="NotReadableError"}}NotReadableError$1.default=NotReadableError;var OverconstrainedError$1={},__importDefault$1h=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(OverconstrainedError$1,"__esModule",{value:!0});const GetUserMediaError_1$3=__importDefault$1h(GetUserMediaError$1);class OverconstrainedError extends GetUserMediaError_1$3.default{constructor($,_){super($),this.constraint=_,this.name="OverconstrainedError"}}OverconstrainedError$1.default=OverconstrainedError;var PermissionDeniedError$1={},__importDefault$1g=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(PermissionDeniedError$1,"__esModule",{value:!0});const GetUserMediaError_1$2=__importDefault$1g(GetUserMediaError$1);class PermissionDeniedError extends GetUserMediaError_1$2.default{constructor($,_){super($,_),this.name="PermissionDeniedError"}}PermissionDeniedError$1.default=PermissionDeniedError;var _TypeError={},__importDefault$1f=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(_TypeError,"__esModule",{value:!0});const GetUserMediaError_1$1=__importDefault$1f(GetUserMediaError$1);let TypeError$1=class extends GetUserMediaError_1$1.default{constructor($){super($),this.name="TypeError"}};_TypeError.default=TypeError$1;var VideoQualitySettings$1={};Object.defineProperty(VideoQualitySettings$1,"__esModule",{value:!0});class VideoQualitySettings{constructor($,_,tt){this.videoWidth=$,this.videoHeight=_,this.videoFrameRate=tt}equals($){return this.videoWidth===$.videoWidth&&this.videoHeight===$.videoHeight&&this.videoFrameRate===$.videoFrameRate}}VideoQualitySettings$1.default=VideoQualitySettings;VideoQualitySettings.VideoDisabled=new VideoQualitySettings(0,0,0);VideoQualitySettings.VideoResolutionHD=new VideoQualitySettings(1280,720,30);VideoQualitySettings.VideoResolutionFHD=new VideoQualitySettings(1920,1080,30);VideoQualitySettings.VideoResolutionUHD=new VideoQualitySettings(3840,2160,30);var VideoTransformDevice={};Object.defineProperty(VideoTransformDevice,"__esModule",{value:!0});VideoTransformDevice.isVideoTransformDevice=void 0;function isVideoTransformDevice(et){return!!et&&typeof et=="object"&&"transformStream"in et&&"stop"in et&&"intrinsicDevice"in et}VideoTransformDevice.isVideoTransformDevice=isVideoTransformDevice;var __awaiter$P=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1e=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultDeviceController$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$7=__importDefault$1e(DefaultBrowserBehavior$1),DefaultMediaDeviceFactory_1=__importDefault$1e(DefaultMediaDeviceFactory$1),AsyncScheduler_1$6=__importDefault$1e(AsyncScheduler$1),PromiseQueue_1=__importDefault$1e(PromiseQueue$1),Types_1$8=Types,DefaultVideoTransformDevice_1=__importDefault$1e(DefaultVideoTransformDevice$1),DefaultVideoTile_1$2=__importDefault$1e(DefaultVideoTile$1),AudioTransformDevice_1=AudioTransformDevice,DeviceSelection_1=__importDefault$1e(DeviceSelection$1),GetUserMediaError_1=__importDefault$1e(GetUserMediaError$1),NotFoundError_1=__importDefault$1e(NotFoundError$1),NotReadableError_1=__importDefault$1e(NotReadableError$1),OverconstrainedError_1=__importDefault$1e(OverconstrainedError$1),PermissionDeniedError_1$1=__importDefault$1e(PermissionDeniedError$1),TypeError_1=__importDefault$1e(_TypeError),VideoQualitySettings_1$5=__importDefault$1e(VideoQualitySettings$1),VideoTransformDevice_1$1=VideoTransformDevice;class DefaultDeviceController{constructor($,_,tt=new DefaultBrowserBehavior_1$7.default,nt){this.logger=$,this.browserBehavior=tt,this.eventController=nt,this.deviceInfoCache=null,this.activeDevices={audio:null,video:null},this.chosenVideoTransformDevice=null,this.audioOutputDeviceId=void 0,this.deviceChangeObservers=new Set,this.mediaStreamBrokerObservers=new Set,this.deviceLabelTrigger=()=>navigator.mediaDevices.getUserMedia({audio:!0,video:!0}),this.audioInputDestinationNode=null,this.audioInputSourceNode=null,this.videoInputQualitySettings=null,this.useWebAudio=!1,this.useMediaConstraintsFallback=!0,this.audioInputTaskQueue=new PromiseQueue_1.default,this.videoInputTaskQueue=new PromiseQueue_1.default,this.muted=!1,this.mediaStreamMuteObserver=(lt,st)=>{for(const at of this.deviceChangeObservers)AsyncScheduler_1$6.default.nextTick(()=>{this.deviceChangeObservers.has(at)&&at.audioInputMuteStateChanged&&at.audioInputMuteStateChanged(lt,st)})},this.alreadyHandlingDeviceChange=!1;const{enableWebAudio:it=!1,useMediaConstraintsFallback:rt=!0}=_||{};this.useWebAudio=it,this.useMediaConstraintsFallback=rt,this.videoInputQualitySettings=new VideoQualitySettings_1$5.default(DefaultDeviceController.defaultVideoWidth,DefaultDeviceController.defaultVideoHeight,DefaultDeviceController.defaultVideoFrameRate);const ot=this.browserBehavior.requiresResolutionAlignment(this.videoInputQualitySettings.videoWidth,this.videoInputQualitySettings.videoHeight);this.videoInputQualitySettings.videoWidth=ot[0],this.videoInputQualitySettings.videoHeight=ot[1],this.logger.info(`DefaultDeviceController video dimension ${this.videoInputQualitySettings.videoWidth} x ${this.videoInputQualitySettings.videoHeight}`);try{this.mediaDeviceWrapper=new DefaultMediaDeviceFactory_1.default().create();const lt=navigator.mediaDevices.getSupportedConstraints();this.logger.info(`Supported Constraints in this browser ${JSON.stringify(lt)}`)}catch(lt){$.error(lt.message)}}isWatchingForDeviceChanges(){return!!this.onDeviceChangeCallback}ensureWatchingDeviceChanges(){var $;this.isWatchingForDeviceChanges()||(this.logger.info("Starting devicechange listener."),this.onDeviceChangeCallback=()=>{this.logger.info("Device change event callback is triggered"),this.handleDeviceChange()},($=this.mediaDeviceWrapper)===null||$===void 0||$.addEventListener("devicechange",this.onDeviceChangeCallback))}stopWatchingDeviceChanges(){var $;this.isWatchingForDeviceChanges()&&(this.logger.info("Stopping devicechange listener."),($=this.mediaDeviceWrapper)===null||$===void 0||$.removeEventListener("devicechange",this.onDeviceChangeCallback),this.onDeviceChangeCallback=void 0)}shouldObserveDeviceChanges(){return this.deviceChangeObservers.size?!0:this.activeDevices.audio&&this.activeDevices.audio.constraints!==null||this.activeDevices.video&&this.activeDevices.video.constraints!==null||!!this.audioOutputDeviceId}watchForDeviceChangesIfNecessary(){this.shouldObserveDeviceChanges()?this.ensureWatchingDeviceChanges():this.stopWatchingDeviceChanges()}destroy(){return __awaiter$P(this,void 0,void 0,function*(){this.stopWatchingDeviceChanges(),yield this.stopAudioInput(),yield this.stopVideoInput()})}listAudioInputDevices($=!1){return __awaiter$P(this,void 0,void 0,function*(){const _=yield this.listDevicesOfKind("audioinput",$);return this.trace("listAudioInputDevices",$,_),_})}listVideoInputDevices($=!1){return __awaiter$P(this,void 0,void 0,function*(){const _=yield this.listDevicesOfKind("videoinput",$);return this.trace("listVideoInputDevices",$,_),_})}listAudioOutputDevices($=!1){return __awaiter$P(this,void 0,void 0,function*(){const _=yield this.listDevicesOfKind("audiooutput",$);return this.trace("listAudioOutputDevices",$,_),_})}pushAudioMeetingStateForPermissions($){var _;(_=this.eventController)===null||_===void 0||_.publishEvent($===void 0?"audioInputUnselected":"audioInputSelected")}pushVideoMeetingStateForPermissions($){var _;(_=this.eventController)===null||_===void 0||_.publishEvent($===void 0?"videoInputUnselected":"videoInputSelected")}startAudioInput($){return __awaiter$P(this,void 0,void 0,function*(){return yield this.audioInputTaskQueue.add(()=>this.startAudioInputTask($))})}startAudioInputTask($){var _;return __awaiter$P(this,void 0,void 0,function*(){if($===void 0){this.logger.error("Audio input device cannot be undefined");return}try{return AudioTransformDevice_1.isAudioTransformDevice($)?(this.logger.info(`Choosing transform input device ${$}`),yield this.chooseAudioTransformInputDevice($)):(this.logger.info(`Choosing intrinsic audio input device ${$}`),this.removeTransform(),yield this.chooseInputIntrinsicDevice("audio",$)),this.trace("startAudioInputDevice",$,"success"),this.useWebAudio?(this.attachAudioInputStreamToAudioContext(this.activeDevices.audio.stream),this.pushAudioMeetingStateForPermissions(this.getMediaStreamDestinationNode().stream),yield(_=this.transform)===null||_===void 0?void 0:_.device.mute(this.muted),this.getMediaStreamDestinationNode().stream):(this.publishAudioInputDidChangeEvent(this.activeDevices.audio.stream),this.activeDevices.audio.stream)}catch(tt){throw tt}})}stopAudioInput(){return __awaiter$P(this,void 0,void 0,function*(){return this.audioInputTaskQueue.add(()=>this.stopAudioInputTask())})}stopAudioInputTask(){return __awaiter$P(this,void 0,void 0,function*(){try{if(this.useWebAudio){this.releaseAudioTransformStream();return}this.stopTracksAndRemoveCallbacks("audio")}finally{this.watchForDeviceChangesIfNecessary(),this.publishAudioInputDidChangeEvent(void 0)}})}chooseAudioTransformInputDevice($){var _;return __awaiter$P(this,void 0,void 0,function*(){if(((_=this.transform)===null||_===void 0?void 0:_.device)===$)return;if(!this.useWebAudio)throw new Error("Cannot apply transform device without enabling Web Audio.");const tt=DefaultDeviceController.getAudioContext();if(!(tt instanceof OfflineAudioContext))switch(tt.state){case"running":break;case"closed":throw new Error("Cannot choose a transform device with a closed audio context.");case"suspended":yield tt.resume()}let nt;try{nt=yield $.createAudioNode(tt)}catch(rt){throw this.logger.error(`Unable to create transform device node: ${rt}.`),rt}const it=yield $.intrinsicDevice();yield this.chooseInputIntrinsicDevice("audio",it),this.logger.debug(`Got inner stream: ${it}.`),this.setTransform($,nt)})}chooseVideoTransformInputDevice($){var _;return __awaiter$P(this,void 0,void 0,function*(){if(this.eventController&&$ instanceof DefaultVideoTransformDevice_1.default&&$.passEventControllerToProcessors(this.eventController),$===this.chosenVideoTransformDevice){this.logger.info("Reselecting same VideoTransformDevice");return}const tt=this.chosenVideoTransformDevice;tt&&this.logger.info("Switched from previous VideoTransformDevice");const nt=!!tt,it=yield $.intrinsicDevice();if(!this.isMediaStreamReusableByDeviceId((_=this.activeDevices.video)===null||_===void 0?void 0:_.stream,it)){this.logger.info("video transform device needs new intrinsic device"),nt&&tt.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=$,this.activeDevices.video=null,yield this.chooseInputIntrinsicDevice("video",it),this.logger.info("apply processors to transform"),yield this.chosenVideoTransformDevice.transformStream(this.activeDevices.video.stream);return}this.chosenVideoTransformDevice=$,this.logger.info("video transform device uses previous stream"),this.logger.info("apply processors to transform"),yield $.transformStream(this.activeDevices.video.stream)})}startVideoInput($){return __awaiter$P(this,void 0,void 0,function*(){return yield this.videoInputTaskQueue.add(()=>this.startVideoInputTask($))})}startVideoInputTask($){return __awaiter$P(this,void 0,void 0,function*(){if(!$){this.logger.error("Invalid video input device");return}try{return VideoTransformDevice_1$1.isVideoTransformDevice($)?(this.logger.info(`Choosing video transform device ${$}`),yield this.chooseVideoTransformInputDevice($),this.publishVideoInputDidChangeEvent(this.chosenVideoTransformDevice.outputMediaStream),this.chosenVideoTransformDevice.outputMediaStream):(this.chosenVideoInputIsTransformDevice()&&(this.chosenVideoTransformDevice.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=null),yield this.chooseInputIntrinsicDevice("video",$),this.trace("startVideoInputDevice",$),this.publishVideoInputDidChangeEvent(this.activeDevices.video.stream),this.activeDevices.video.stream)}catch(_){throw _}})}stopVideoInput(){return __awaiter$P(this,void 0,void 0,function*(){return this.videoInputTaskQueue.add(()=>this.stopVideoInputTask())})}stopVideoInputTask(){return __awaiter$P(this,void 0,void 0,function*(){try{if(this.chosenVideoInputIsTransformDevice()){this.releaseVideoTransformStream();return}this.stopTracksAndRemoveCallbacks("video")}finally{this.watchForDeviceChangesIfNecessary(),this.publishVideoInputDidChangeEvent(void 0)}})}chooseAudioOutput($){return __awaiter$P(this,void 0,void 0,function*(){this.audioOutputDeviceId=$,this.watchForDeviceChangesIfNecessary();const _=this.deviceInfoFromDeviceId("audiooutput",this.audioOutputDeviceId);this.publishAudioOutputDidChangeEvent(_),this.trace("chooseAudioOutput",$,null)})}addDeviceChangeObserver($){this.logger.info("adding device change observer"),this.deviceChangeObservers.add($),this.watchForDeviceChangesIfNecessary(),this.trace("addDeviceChangeObserver")}removeDeviceChangeObserver($){this.logger.info("removing device change observer"),this.deviceChangeObservers.delete($),this.watchForDeviceChangesIfNecessary(),this.trace("removeDeviceChangeObserver")}createAnalyserNodeForAudioInput(){var $,_;if(!this.activeDevices.audio)return null;const tt=(_=($=this.transform)===null||$===void 0?void 0:$.nodes)===null||_===void 0?void 0:_.end;if(tt){const nt=tt.context.createAnalyser();return nt.removeOriginalInputs=()=>{try{tt.disconnect(nt)}catch{}},tt.connect(nt),nt}return this.createAnalyserNodeForRawAudioInput()}createAnalyserNodeForRawAudioInput(){return this.activeDevices.audio?this.createAnalyserNodeForStream(this.activeDevices.audio.stream):null}createAnalyserNodeForStream($){const _=DefaultDeviceController.getAudioContext(),tt=_.createAnalyser(),nt=_.createMediaStreamSource($);return nt.connect(tt),this.trace("createAnalyserNodeForAudioInput"),tt.removeOriginalInputs=()=>{try{nt.disconnect(tt)}catch{}},tt}startVideoPreviewForVideoInput($){if(!this.activeDevices.video){this.logger.warn("cannot bind video preview since video input device has not been chosen"),this.trace("startVideoPreviewForVideoInput",$.id);return}DefaultVideoTile_1$2.default.connectVideoStreamToVideoElement(this.chosenVideoTransformDevice?this.chosenVideoTransformDevice.outputMediaStream:this.activeDevices.video.stream,$,!0),this.trace("startVideoPreviewForVideoInput",$.id)}stopVideoPreviewForVideoInput($){DefaultVideoTile_1$2.default.disconnectVideoStreamFromVideoElement($,!1),this.trace("stopVideoPreviewForVideoInput",$.id)}setDeviceLabelTrigger($){if(this.deviceInfoCache){for(const _ of this.deviceInfoCache)if(!_.label){this.deviceInfoCache=null;break}}this.deviceLabelTrigger=$,this.trace("setDeviceLabelTrigger")}mixIntoAudioInput($){let _=null;return this.useWebAudio?(_=DefaultDeviceController.getAudioContext().createMediaStreamSource($),_.connect(this.getMediaStreamOutputNode())):this.logger.warn("WebAudio is not enabled, mixIntoAudioInput will not work"),this.trace("mixIntoAudioInput",$.id),_}chooseVideoInputQuality($,_,tt){const nt=this.browserBehavior.requiresResolutionAlignment($,_);this.videoInputQualitySettings=new VideoQualitySettings_1$5.default(nt[0],nt[1],tt)}getVideoInputQualitySettings(){return this.videoInputQualitySettings}acquireAudioInputStream(){return __awaiter$P(this,void 0,void 0,function*(){return this.activeDevices.audio||(this.logger.info("No audio device chosen, creating empty audio device"),yield this.startAudioInput(null)),this.useWebAudio?this.getMediaStreamDestinationNode().stream:this.activeDevices.audio.stream})}acquireVideoInputStream(){return __awaiter$P(this,void 0,void 0,function*(){if(!this.activeDevices.video)throw new Error("No video device chosen");return this.chosenVideoInputIsTransformDevice()?this.chosenVideoTransformDevice.outputMediaStream:this.activeDevices.video.stream})}acquireDisplayInputStream($){return __awaiter$P(this,void 0,void 0,function*(){throw new Error("unsupported")})}releaseAudioTransformStream(){this.logger.info("Stopping audio track for Web Audio graph"),this.stopTracksAndRemoveCallbacks("audio"),this.logger.info("Removing audio transform, if there is one."),this.removeTransform(),this.audioInputSourceNode&&(this.audioInputSourceNode.disconnect(),this.audioInputSourceNode=void 0),this.audioInputDestinationNode&&(this.audioInputDestinationNode.disconnect(),this.audioInputDestinationNode=void 0)}releaseVideoTransformStream(){this.logger.info("Stopping video track for transform"),this.stopTracksAndRemoveCallbacks("video"),this.logger.info("Disconnecting video transform"),this.chosenVideoTransformDevice.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=null}stopTracksAndRemoveCallbacks($){const _=this.activeDevices[$];if(!_)return;const tt=_.endedCallback,nt=_.trackMuteCallback,it=_.trackUnmuteCallback;for(const rt of _.stream.getTracks())rt.stop(),tt&&rt.removeEventListener("ended",tt),nt&&rt.removeEventListener("mute",nt),it&&rt.removeEventListener("unmute",it),delete _.endedCallback,delete _.trackMuteCallback,delete _.trackUnmuteCallback,delete this.activeDevices[$]}chosenVideoInputIsTransformDevice(){return!!this.chosenVideoTransformDevice}muteLocalAudioInputStream(){this.toggleLocalAudioInputStream(!1)}unmuteLocalAudioInputStream(){this.toggleLocalAudioInputStream(!0)}toggleLocalAudioInputStream($){var _;let tt=this.activeDevices.audio;if(this.useWebAudio&&(tt=this.getMediaStreamDestinationNode()),!!tt){for(const nt of tt.stream.getTracks())nt.enabled!==$&&(nt.enabled=$);this.muted!==!$&&(this.muted=!$,(_=this.transform)===null||_===void 0||_.device.mute(this.muted))}}static getIntrinsicDeviceId($){if(!$)return;if(typeof $=="string")return $;if($.id)return $.id;const tt=$.deviceId;if(!tt)return;if(typeof tt=="string"||Array.isArray(tt))return tt;const nt=tt;if(typeof nt.exact=="string"||Array.isArray(nt.exact))return nt.exact}static createEmptyAudioDevice(){return DefaultDeviceController.synthesizeAudioDevice(0)}static synthesizeAudioDevice($){const _=DefaultDeviceController.getAudioContext(),tt=_.createMediaStreamDestination();if($){const nt=_.createGain();nt.gain.value=.1,nt.connect(tt);const it=_.createOscillator();it.frequency.value=$,it.connect(nt),it.start()}else{const nt=_.createBufferSource();try{nt.buffer=_.createBuffer(1,_.sampleRate*5,_.sampleRate)}catch(it){if(it&&it.name==="NotSupportedError")nt.buffer=_.createBuffer(1,DefaultDeviceController.defaultSampleRate*5,DefaultDeviceController.defaultSampleRate);else throw it}nt.buffer.getChannelData(0)[0]=3e-4,nt.loop=!0,nt.connect(tt),nt.start()}return tt.stream}listDevicesOfKind($,_){return __awaiter$P(this,void 0,void 0,function*(){return(_||this.deviceInfoCache===null||!this.isWatchingForDeviceChanges())&&(yield this.updateDeviceInfoCacheFromBrowser()),this.listCachedDevicesOfKind($)})}updateDeviceInfoCacheFromBrowser(){var $;return __awaiter$P(this,void 0,void 0,function*(){if(typeof MediaDeviceInfo>"u"){this.deviceInfoCache=[];return}let tt=yield navigator.mediaDevices.enumerateDevices(),nt=!0;for(const it of tt)if(!it.label){nt=!1;break}if(!nt)try{this.logger.info("attempting to trigger media device labels since they are hidden");const it=yield this.deviceLabelTrigger();tt=yield navigator.mediaDevices.enumerateDevices();for(const rt of it.getTracks())rt.stop()}catch(it){this.logger.info("unable to get media device labels"),($=this.eventController)===null||$===void 0||$.publishEvent("deviceLabelTriggerFailed",{deviceLabelTriggerErrorMessage:this.getErrorMessage(it)})}this.logger.debug(`Update device info cache with devices: ${JSON.stringify(tt)}`),this.deviceInfoCache=tt})}listCachedDevicesOfKind($){const _=[];if(this.deviceInfoCache)for(const tt of this.deviceInfoCache)tt.kind===$&&_.push(tt);return _}handleDeviceChange(){return __awaiter$P(this,void 0,void 0,function*(){if(this.deviceInfoCache===null)return;if(this.alreadyHandlingDeviceChange){AsyncScheduler_1$6.default.nextTick(()=>{this.handleDeviceChange()});return}this.alreadyHandlingDeviceChange=!0;const $=this.listCachedDevicesOfKind("audioinput"),_=this.listCachedDevicesOfKind("videoinput"),tt=this.listCachedDevicesOfKind("audiooutput");yield this.updateDeviceInfoCacheFromBrowser();const nt=this.listCachedDevicesOfKind("audioinput"),it=this.listCachedDevicesOfKind("videoinput"),rt=this.listCachedDevicesOfKind("audiooutput");this.forEachObserver(ot=>{this.areDeviceListsEqual($,nt)||Types_1$8.Maybe.of(ot.audioInputsChanged).map(lt=>lt.bind(ot)(nt)),this.areDeviceListsEqual(_,it)||Types_1$8.Maybe.of(ot.videoInputsChanged).map(lt=>lt.bind(ot)(it)),this.areDeviceListsEqual(tt,rt)||Types_1$8.Maybe.of(ot.audioOutputsChanged).map(lt=>lt.bind(ot)(rt))}),this.alreadyHandlingDeviceChange=!1})}handleDeviceStreamEnded($,_){return __awaiter$P(this,void 0,void 0,function*(){try{$==="audio"?(this.useWebAudio&&this.browserBehavior.requiresAudioContextResetOnDeviceFailureForWebAudio()?(this.logger.warn("Audio input device which was active is no longer available, suspending and resuming audio context before resetting to empty device to ensure packets are sent"),yield this.stopAudioInput(),DefaultDeviceController.suspendAudioContext(),DefaultDeviceController.resumeAudioContext()):this.logger.warn("Audio input device which was active is no longer available, resetting to empty device to ensure packets are sent"),yield this.startAudioInput(null)):(this.logger.warn("Video input device which was active is no longer available, stopping video"),yield this.stopVideoInput())}catch{this.logger.error("Failed to choose null device after stream ended.")}$==="audio"?this.forEachObserver(tt=>{Types_1$8.Maybe.of(tt.audioInputStreamEnded).map(nt=>nt.bind(tt)(_))}):this.forEachObserver(tt=>{Types_1$8.Maybe.of(tt.videoInputStreamEnded).map(nt=>nt.bind(tt)(_))})})}forEachObserver($){for(const _ of this.deviceChangeObservers)AsyncScheduler_1$6.default.nextTick(()=>{this.deviceChangeObservers.has(_)&&$(_)})}forEachMediaStreamBrokerObserver($){for(const _ of this.mediaStreamBrokerObservers)AsyncScheduler_1$6.default.nextTick(()=>{this.mediaStreamBrokerObservers.has(_)&&$(_)})}areDeviceListsEqual($,_){return JSON.stringify($.map(tt=>JSON.stringify(tt)).sort())===JSON.stringify(_.map(tt=>JSON.stringify(tt)).sort())}intrinsicDeviceAsMediaStream($){return $&&$.id?$:null}hasSameMediaStreamId($,_,tt){var nt,it,rt,ot;let lt;return $==="audio"?(lt=tt==null?void 0:tt.audio.streamId,!!lt&&lt===((it=(nt=_.constraints)===null||nt===void 0?void 0:nt.audio)===null||it===void 0?void 0:it.streamId)):(lt=tt==null?void 0:tt.video.streamId,!!lt&&lt===((ot=(rt=_==null?void 0:_.constraints)===null||rt===void 0?void 0:rt.video)===null||ot===void 0?void 0:ot.streamId))}hasSameGroupId($,_,tt){if($==="")return!0;const nt=DefaultDeviceController.getIntrinsicDeviceId(tt);return this.logger.debug(`Checking deviceIds ${nt} of type ${typeof nt} with groupId ${$}`),typeof nt=="string"&&$===this.getGroupIdFromDeviceId(_,nt)}getGroupIdFromDeviceId($,_){if(this.deviceInfoCache!==null){const tt=this.listCachedDevicesOfKind(`${$}input`).find(nt=>nt.deviceId===_);if(tt&&tt.groupId)return this.logger.debug(`GroupId of deviceId ${_} found in cache is ${tt.groupId}`),tt.groupId}return this.logger.debug(`GroupId of deviceId ${_} found in cache is empty`),""}handleGetUserMediaError($,_){if(!$)throw new GetUserMediaError_1.default($);switch($.name){case"NotReadableError":case"TrackStartError":throw new NotReadableError_1.default($);case"NotFoundError":case"DevicesNotFoundError":throw new NotFoundError_1.default($);case"NotAllowedError":case"PermissionDeniedError":case"SecurityError":throw _&&_<DefaultDeviceController.permissionDeniedOriginDetectionThresholdMs?new PermissionDeniedError_1$1.default($,"Permission denied by browser"):new PermissionDeniedError_1$1.default($,"Permission denied by user");case"OverconstrainedError":case"ConstraintNotSatisfiedError":throw new OverconstrainedError_1.default($);case"TypeError":throw new TypeError_1.default($);case"AbortError":default:throw new GetUserMediaError_1.default($)}}matchesDeviceSelection($,_,tt,nt){return tt&&tt.stream.active&&(this.hasSameMediaStreamId($,tt,nt)||tt.groupId!==null&&this.hasSameGroupId(tt.groupId,$,_))?(this.logger.debug(`Compare current device constraint ${JSON.stringify(tt.constraints)} to proposed constraints ${JSON.stringify(nt)}`),tt.matchesConstraints(nt)):!1}chooseInputIntrinsicDevice($,_){var tt,nt;return __awaiter$P(this,void 0,void 0,function*(){const it=this.getMediaStreamConstraints($,_);if(this.matchesDeviceSelection($,_,this.activeDevices[$],it)){this.logger.info(`reusing existing ${$} input device`);return}this.activeDevices[$]&&this.activeDevices[$].stream&&this.stopTracksAndRemoveCallbacks($);const rt=Date.now(),ot=new DeviceSelection_1.default;try{this.logger.info(`requesting new ${$} device with constraint ${JSON.stringify(it)}`);const lt=this.intrinsicDeviceAsMediaStream(_);$==="audio"&&_===null?(ot.stream=DefaultDeviceController.createEmptyAudioDevice(),ot.constraints=null):lt?(this.logger.info(`using media stream ${lt.id} for ${$} device`),ot.stream=lt,ot.constraints=it):(ot.stream=yield navigator.mediaDevices.getUserMedia(it),ot.constraints=it),yield this.handleNewInputDevice($,ot)}catch(lt){const st=this.getErrorMessage(lt);$==="audio"?(tt=this.eventController)===null||tt===void 0||tt.publishEvent("audioInputFailed",{audioInputErrorMessage:st}):(nt=this.eventController)===null||nt===void 0||nt.publishEvent("videoInputFailed",{videoInputErrorMessage:st}),this.logger.error(`failed to get ${$} device for constraints ${JSON.stringify(it)}: ${st}`);let at=!0;if(lt&&"constraint"in lt&&(this.logger.error(`Over-constrained by constraint: ${lt.constraint}`),this.useMediaConstraintsFallback)){const ct=this.getMediaStreamConstraints($,_,!0),dt=JSON.stringify(ct);if(dt!==JSON.stringify(it)){this.logger.info(`retry requesting new ${$} device with minimal constraint ${dt}`);try{ot.stream=yield navigator.mediaDevices.getUserMedia(ct),ot.constraints=ct,yield this.handleNewInputDevice($,ot),at=!1}catch(ut){this.logger.error(`failed to get ${$} device for constraints ${dt}: ${this.getErrorMessage(ut)}`)}}}if(at){if($==="audio"){this.logger.info(`choosing null ${$} device instead`);try{ot.stream=DefaultDeviceController.createEmptyAudioDevice(),ot.constraints=null,yield this.handleNewInputDevice($,ot)}catch(ct){this.logger.error(`failed to choose null ${$} device. ${ct.name}: ${ct.message}`)}}this.handleGetUserMediaError(lt,Date.now()-rt)}}finally{this.watchForDeviceChangesIfNecessary()}})}getErrorMessage($){return $?$.name&&$.message?`${$.name}: ${$.message}`:$.name?$.name:$.message?$.message:"UnknownError":"UnknownError"}handleNewInputDevice($,_){var tt;return __awaiter$P(this,void 0,void 0,function*(){this.logger.info(`got ${$} device for constraints ${JSON.stringify(_.constraints)}`);const nt=(tt=this.getMediaTrackSettings(_.stream))===null||tt===void 0?void 0:tt.deviceId;_.groupId=nt?this.getGroupIdFromDeviceId($,nt):"",this.activeDevices[$]=_,this.logger.debug(`Set activeDevice to ${JSON.stringify(_)}`),this.watchForDeviceChangesIfNecessary();const it=_.stream.getTracks()[0];if(it&&(_.endedCallback=()=>{this.activeDevices[$]&&this.activeDevices[$].stream===_.stream&&(this.handleDeviceStreamEnded($,nt),delete _.endedCallback)},it.addEventListener("ended",_.endedCallback,{once:!0})),$==="audio"){const rt=_.stream.getAudioTracks()[0];if(rt){const ot=rt.getSettings().deviceId||_.stream;_.trackMuteCallback=()=>{this.mediaStreamMuteObserver(ot,!0)},_.trackUnmuteCallback=()=>{this.mediaStreamMuteObserver(ot,!1)},rt.addEventListener("mute",_.trackMuteCallback,{once:!1}),rt.addEventListener("unmute",_.trackUnmuteCallback,{once:!1}),this.logger.debug("Notifying mute state after selection"),rt.muted?_.trackMuteCallback():_.trackUnmuteCallback()}}})}calculateMediaStreamConstraints($,_,tt,nt){if(nt&&this.listCachedDevicesOfKind(`${$}input`).length===1)return!0;const it={};return this.browserBehavior.requiresNoExactMediaStreamConstraints()?it.deviceId=_:it.deviceId={exact:_},tt&&(it.groupId=tt),nt?it:$==="video"?(it.width={ideal:this.videoInputQualitySettings.videoWidth},it.height={ideal:this.videoInputQualitySettings.videoHeight},it.frameRate={ideal:this.videoInputQualitySettings.videoFrameRate},it):(this.supportSampleRateConstraint()&&(it.sampleRate={ideal:DefaultDeviceController.defaultSampleRate}),this.supportSampleSizeConstraint()&&(it.sampleSize={ideal:DefaultDeviceController.defaultSampleSize}),this.supportChannelCountConstraint()&&(it.channelCount={ideal:DefaultDeviceController.defaultChannelCount}),Object.assign({echoCancellation:!0,googEchoCancellation:!0,googEchoCancellation2:!0,googAutoGainControl:!0,googAutoGainControl2:!0,googNoiseSuppression:!0,googNoiseSuppression2:!0,googHighpassFilter:!0},it))}getMediaStreamConstraintsFromTrackConstraints($,_){return $==="audio"?{audio:_}:{video:_}}getMediaStreamConstraints($,_,tt=!1){let nt={};if(!_)return null;const it=this.intrinsicDeviceAsMediaStream(_);if(it)return nt.streamId=it.id,this.getMediaStreamConstraintsFromTrackConstraints($,nt);if(typeof _=="string"){let rt="";return this.browserBehavior.requiresGroupIdMediaStreamConstraints()&&(this.deviceInfoCache!==null?rt=this.getGroupIdFromDeviceId($,_):this.logger.error("Device cache is not populated. Please make sure to call list devices first")),nt=this.calculateMediaStreamConstraints($,_,rt,tt),this.getMediaStreamConstraintsFromTrackConstraints($,nt)}return isMediaDeviceInfo(_)?(nt=this.calculateMediaStreamConstraints($,_.deviceId,_.groupId,tt),this.getMediaStreamConstraintsFromTrackConstraints($,nt)):(nt=_,this.getMediaStreamConstraintsFromTrackConstraints($,nt))}deviceInfoFromDeviceId($,_){if(this.deviceInfoCache===null)return null;for(const tt of this.deviceInfoCache)if(tt.kind===$&&tt.deviceId===_)return tt;return null}hasAppliedTransform(){return!!this.transform}isMediaStreamReusableByDeviceId($,_){if(!$||!$.active||!_)return!1;if(_.id)return $.id===_.id;const tt=this.getMediaTrackSettings($);if(!tt.deviceId)return!1;const nt=DefaultDeviceController.getIntrinsicDeviceId(_);return typeof nt=="string"?tt.deviceId===nt:!1}getMediaTrackSettings($){var _;return(_=$.getTracks()[0])===null||_===void 0?void 0:_.getSettings()}reconnectAudioInputs(){if(!this.audioInputSourceNode)return;this.audioInputSourceNode.disconnect();const $=this.getMediaStreamOutputNode();this.audioInputSourceNode.connect($)}setTransform($,_){var tt,nt;(nt=(tt=this.transform)===null||tt===void 0?void 0:tt.nodes)===null||nt===void 0||nt.end.disconnect(),this.transform={nodes:_,device:$};const it=_==null?void 0:_.end,rt=this.getMediaStreamDestinationNode();this.logger.debug(`Connecting transform node ${it} to destination ${rt}.`),it==null||it.connect(rt),this.reconnectAudioInputs()}removeTransform(){var $;const _=this.transform;if(_)return($=this.transform.nodes)===null||$===void 0||$.end.disconnect(),this.transform=void 0,this.reconnectAudioInputs(),_}attachAudioInputStreamToAudioContext($){var _;(_=this.audioInputSourceNode)===null||_===void 0||_.disconnect(),this.audioInputSourceNode=DefaultDeviceController.getAudioContext().createMediaStreamSource($);const tt=this.getMediaStreamOutputNode();this.audioInputSourceNode.connect(tt)}getMediaStreamDestinationNode(){return this.audioInputDestinationNode||(this.audioInputDestinationNode=DefaultDeviceController.getAudioContext().createMediaStreamDestination()),this.audioInputDestinationNode}getMediaStreamOutputNode(){var $,_;return((_=($=this.transform)===null||$===void 0?void 0:$.nodes)===null||_===void 0?void 0:_.start)||this.getMediaStreamDestinationNode()}static setDefaultLatencyHint($){DefaultDeviceController.defaultLatencyHint=$}static getAudioContext(){if(!DefaultDeviceController.audioContext){const $={};navigator.mediaDevices.getSupportedConstraints().sampleRate&&($.sampleRate=DefaultDeviceController.defaultSampleRate),new DefaultBrowserBehavior_1$7.default().requiresPlaybackLatencyHintForAudioContext()&&($.latencyHint="playback"),DefaultDeviceController.defaultLatencyHint&&($.latencyHint=DefaultDeviceController.defaultLatencyHint),DefaultDeviceController.audioContext=new(window.AudioContext||window.webkitAudioContext)($)}return DefaultDeviceController.audioContext}static suspendAudioContext(){return __awaiter$P(this,void 0,void 0,function*(){return DefaultDeviceController.audioContext?DefaultDeviceController.audioContext.suspend():Promise.resolve()})}static resumeAudioContext(){return __awaiter$P(this,void 0,void 0,function*(){return DefaultDeviceController.audioContext?DefaultDeviceController.audioContext.resume():Promise.resolve()})}static closeAudioContext(){if(DefaultDeviceController.audioContext)try{DefaultDeviceController.audioContext.close()}catch{}DefaultDeviceController.audioContext=null}addMediaStreamBrokerObserver($){this.mediaStreamBrokerObservers.add($)}removeMediaStreamBrokerObserver($){this.mediaStreamBrokerObservers.delete($)}publishVideoInputDidChangeEvent($){this.forEachMediaStreamBrokerObserver(_=>{_.videoInputDidChange&&_.videoInputDidChange($)}),this.pushVideoMeetingStateForPermissions($)}publishAudioInputDidChangeEvent($){this.forEachMediaStreamBrokerObserver(_=>{_.audioInputDidChange&&_.audioInputDidChange($)}),this.pushAudioMeetingStateForPermissions($)}publishAudioOutputDidChangeEvent($){this.forEachMediaStreamBrokerObserver(_=>{_.audioOutputDidChange&&_.audioOutputDidChange($)})}supportSampleRateConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().sampleRate}supportSampleSizeConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().sampleSize}supportChannelCountConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().channelCount}trace($,_,tt){let nt=`API/DefaultDeviceController/${$}`;typeof _<"u"&&(nt+=` ${JSON.stringify(_)}`),typeof tt<"u"&&(nt+=` -> ${JSON.stringify(tt)}`),this.logger.info(nt)}}DefaultDeviceController$1.default=DefaultDeviceController;DefaultDeviceController.permissionDeniedOriginDetectionThresholdMs=500;DefaultDeviceController.defaultVideoWidth=960;DefaultDeviceController.defaultVideoHeight=540;DefaultDeviceController.defaultVideoFrameRate=15;DefaultDeviceController.defaultSampleRate=48e3;DefaultDeviceController.defaultSampleSize=16;DefaultDeviceController.defaultChannelCount=1;DefaultDeviceController.audioContext=null;function isMediaDeviceInfo(et){return typeof et=="object"&&"deviceId"in et&&"groupId"in et&&"kind"in et&&"label"in et}var __awaiter$O=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1d=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(ContentShareMediaStreamBroker$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$6=__importDefault$1d(DefaultBrowserBehavior$1),DefaultDeviceController_1$1=__importDefault$1d(DefaultDeviceController$1);class ContentShareMediaStreamBroker{constructor($){this.logger=$}get mediaStream(){return this._mediaStream}set mediaStream($){this._mediaStream=$}acquireAudioInputStream(){return __awaiter$O(this,void 0,void 0,function*(){return this._mediaStream.getAudioTracks().length===0?(this.logger.info("No audio stream available. Synthesizing an audio stream."),DefaultDeviceController_1$1.default.synthesizeAudioDevice(0)):this._mediaStream})}acquireVideoInputStream(){return __awaiter$O(this,void 0,void 0,function*(){return this._mediaStream})}acquireDisplayInputStream($){return __awaiter$O(this,void 0,void 0,function*(){return $&&$.video&&$.video.mandatory&&$.video.mandatory.chromeMediaSource&&$.video.mandatory.chromeMediaSourceId?navigator.mediaDevices.getUserMedia($):navigator.mediaDevices.getDisplayMedia($)})}acquireScreenCaptureDisplayInputStream($,_){return __awaiter$O(this,void 0,void 0,function*(){return this.acquireDisplayInputStream(this.screenCaptureDisplayMediaConstraints($,_))})}screenCaptureDisplayMediaConstraints($,_){return{audio:!!(!$&&new DefaultBrowserBehavior_1$6.default().getDisplayMediaAudioCaptureSupport()),video:Object.assign(Object.assign({},!$&&{frameRate:{max:_||ContentShareMediaStreamBroker.defaultFrameRate}}),$&&{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:$,maxFrameRate:_||ContentShareMediaStreamBroker.defaultFrameRate}})}}toggleMediaStream($){let _=!1;if(this.mediaStream)for(let tt=0;tt<this.mediaStream.getTracks().length;tt++)this.mediaStream.getTracks()[tt].enabled!==$&&(this.mediaStream.getTracks()[tt].enabled=$,_=!0);return _}cleanup(){if(this.mediaStream)for(let $=0;$<this.mediaStream.getTracks().length;$++)this.mediaStream.getTracks()[$].stop();this.mediaStream=null}muteLocalAudioInputStream(){throw new Error("unsupported")}unmuteLocalAudioInputStream(){throw new Error("unsupported")}addMediaStreamBrokerObserver($){}removeMediaStreamBrokerObserver($){}}ContentShareMediaStreamBroker$1.default=ContentShareMediaStreamBroker;ContentShareMediaStreamBroker.defaultFrameRate=15;var CreatePeerConnectionTask$1={},__awaiter$N=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1c=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(CreatePeerConnectionTask$1,"__esModule",{value:!0});const BaseTask_1$l=__importDefault$1c(BaseTask$1);class CreatePeerConnectionTask extends BaseTask_1$l.default{constructor($){super($.logger),this.context=$,this.taskName="CreatePeerConnectionTask",this.removeTrackAddedEventListener=null,this.removeTrackRemovedEventListeners={},this.trackEvents=["ended","mute","unmute","isolationchange","overconstrained"],this.removeVideoTrackEventListeners={},this.trackAddedHandler=_=>{const tt=_.track;if(this.context.logger.info(`received track event: kind=${tt.kind} id=${tt.id} label=${tt.label}`),_.transceiver&&_.transceiver.currentDirection==="inactive")return;if(_.streams.length===0){this.context.logger.warn("Track event but no stream");return}const nt=_.streams[0];tt.kind==="audio"?this.context.audioMixController.bindAudioStream(nt):tt.kind==="video"&&!this.trackIsVideoInput(tt)&&this.addRemoteVideoTrack(tt,nt)}}removeObserver(){this.removeTrackAddedEventListener&&this.removeTrackAddedEventListener();for(const $ in this.removeTrackRemovedEventListeners)this.removeTrackRemovedEventListeners[$]()}addPeerConnectionEventLogger(){const $=this.context.peer;$.addEventListener("connectionstatechange",()=>{this.context.logger.info(`peer connection state changed: ${$.connectionState}`)}),$.addEventListener("negotiationneeded",()=>{this.context.logger.info("peer connection negotiation is needed")}),$.addEventListener("icegatheringstatechange",()=>{this.context.logger.info(`peer connection ice gathering state changed: ${$.iceGatheringState}`)}),$.addEventListener("icecandidate",_=>{this.context.logger.info(`peer connection ice candidate: ${_.candidate?_.candidate.candidate:"(null)"}`)}),$.addEventListener("iceconnectionstatechange",()=>{this.context.logger.info(`peer connection ice connection state changed: ${$.iceConnectionState}`)})}run(){return __awaiter$N(this,void 0,void 0,function*(){this.context.removableObservers.push(this);const _=this.context.turnCredentials&&this.context.turnCredentials.uris.length>0?{iceServers:[{urls:this.context.turnCredentials.uris,username:this.context.turnCredentials.username,credential:this.context.turnCredentials.password,credentialType:"password"}],iceTransportPolicy:"relay"}:{};_.bundlePolicy=this.context.browserBehavior.requiresBundlePolicy(),_.sdpSemantics="unified-plan",_.encodedInsertableStreams=this.context.audioProfile.hasRedundancyEnabled(),this.context.peer?this.context.logger.info("reusing peer connection"):(this.context.logger.info("creating new peer connection"),this.context.peer=new RTCPeerConnection(_),this.addPeerConnectionEventLogger()),this.removeTrackAddedEventListener=()=>{this.context.peer&&this.context.peer.removeEventListener("track",this.trackAddedHandler),this.removeTrackAddedEventListener=null},this.context.peer.addEventListener("track",this.trackAddedHandler)})}trackIsVideoInput($){return this.context.transceiverController.useTransceivers()?(this.logger.debug(()=>"getting video track type"),this.context.transceiverController.trackIsVideoInput($)):!1}addRemoteVideoTrack($,_){var tt;const nt=_.id,it=this.context.videoStreamIndex.attendeeIdForTrack(nt);let rt,ot;if(this.context.videoTileController.getVideoTileForAttendeeId?(ot=this.context.videoTileController.getVideoTileForAttendeeId(it),rt=!!(!((tt=ot==null?void 0:ot.state())===null||tt===void 0)&&tt.boundVideoStream)):rt=this.context.videoTileController.haveVideoTileForAttendeeId(it),rt){this.context.logger.info(`Not adding remote track. Already have tile for attendeeId:  ${it}`);return}ot||(ot=this.context.videoTileController.addVideoTile(),this.logger.info(`Created video tile ${ot.id()}`));let lt=this.context.videoStreamIndex.streamIdForTrack(nt);typeof lt>"u"&&(this.logger.warn(`stream not found for tile=${ot.id()} track=${nt}`),lt=null);let st=this.context.videoStreamIndex.groupIdForStreamId(lt);st===void 0&&(st=null);for(let St=0;St<this.trackEvents.length;St++){const gt=this.trackEvents[St],yt=_.getVideoTracks();if(yt&&yt.length){const vt=yt[0],Ct=()=>{this.context.logger.info(`received the ${gt} event for tile=${ot.id()} id=${$.id} streamId=${lt}`),gt==="ended"&&this.removeRemoteVideoTrack($,ot.state())};vt.addEventListener(gt,Ct),this.removeVideoTrackEventListeners[$.id]||(this.removeVideoTrackEventListeners[$.id]=[]),this.removeVideoTrackEventListeners[$.id].push(()=>{vt.removeEventListener(gt,Ct)})}}let at,ct;if($.getSettings){const St=$.getSettings();at=St.width,ct=St.height}else{const St=$.getCapabilities();at=St.width,ct=St.height}const dt=this.context.videoStreamIndex.externalUserIdForTrack(nt);ot.bindVideoStream(it,!1,_,at,ct,lt,dt,st),this.logger.info(`video track added, use tile=${ot.id()} track=${nt} streamId=${lt} groupId=${st}`);const ut="removetrack",ft=_,pt=()=>this.removeRemoteVideoTrack($,ot.state());this.removeTrackRemovedEventListeners[$.id]=()=>{ft.removeEventListener(ut,pt),delete this.removeTrackRemovedEventListeners[$.id]},ft.addEventListener(ut,pt)}removeRemoteVideoTrack($,_){if(this.removeTrackRemovedEventListeners.hasOwnProperty($.id)){this.removeTrackRemovedEventListeners[$.id]();for(const tt of this.removeVideoTrackEventListeners[$.id])tt();delete this.removeVideoTrackEventListeners[$.id]}this.logger.info(`video track ended, removing tile=${_.tileId} id=${$.id} stream=${_.streamId}`),_.streamId?this.context.videosPaused.remove(_.streamId):this.logger.warn(`no stream found for tile=${_.tileId}`),this.context.videoTileController.removeVideoTile(_.tileId)}}CreatePeerConnectionTask$1.default=CreatePeerConnectionTask;CreatePeerConnectionTask.REMOVE_HANDLER_INTERVAL_MS=1e4;var CreateSDPTask$1={},MeetingSessionStatusCode={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.MeetingSessionStatusCode=void 0;var $;(function(_){_[_.OK=0]="OK",_[_.Left=1]="Left",_[_.AudioJoinedFromAnotherDevice=2]="AudioJoinedFromAnotherDevice",_[_.AudioAuthenticationRejected=3]="AudioAuthenticationRejected",_[_.AudioCallAtCapacity=4]="AudioCallAtCapacity",_[_.MeetingEnded=5]="MeetingEnded",_[_.AudioInternalServerError=6]="AudioInternalServerError",_[_.AudioServiceUnavailable=7]="AudioServiceUnavailable",_[_.AudioDisconnected=8]="AudioDisconnected",_[_.VideoCallSwitchToViewOnly=9]="VideoCallSwitchToViewOnly",_[_.VideoCallAtSourceCapacity=10]="VideoCallAtSourceCapacity",_[_.SignalingBadRequest=11]="SignalingBadRequest",_[_.SignalingInternalServerError=12]="SignalingInternalServerError",_[_.SignalingRequestFailed=13]="SignalingRequestFailed",_[_.SignalingChannelClosedUnexpectedly=14]="SignalingChannelClosedUnexpectedly",_[_.ICEGatheringTimeoutWorkaround=15]="ICEGatheringTimeoutWorkaround",_[_.ConnectionHealthReconnect=16]="ConnectionHealthReconnect",_[_.RealtimeApiFailed=17]="RealtimeApiFailed",_[_.TaskFailed=18]="TaskFailed",_[_.IncompatibleSDP=19]="IncompatibleSDP",_[_.TURNCredentialsForbidden=20]="TURNCredentialsForbidden",_[_.NoAttendeePresent=21]="NoAttendeePresent",_[_.AudioAttendeeRemoved=22]="AudioAttendeeRemoved",_[_.AudioVideoWasRemovedFromPrimaryMeeting=23]="AudioVideoWasRemovedFromPrimaryMeeting",_[_.AudioVideoDisconnectedWhilePromoted=24]="AudioVideoDisconnectedWhilePromoted",_[_.AudioDisconnectAudio=25]="AudioDisconnectAudio"})($=et.MeetingSessionStatusCode||(et.MeetingSessionStatusCode={})),et.default=$})(MeetingSessionStatusCode);var SDP$1={},SDPCandidateType={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.SDPCandidateType=void 0;var $;(function(_){_.Host="host",_.ServerReflexive="srflx",_.PeerReflexive="prflx",_.Relay="relay"})($=et.SDPCandidateType||(et.SDPCandidateType={})),et.default=$})(SDPCandidateType);var SDPMediaSection$1={};Object.defineProperty(SDPMediaSection$1,"__esModule",{value:!0});class SDPMediaSection{}SDPMediaSection$1.default=SDPMediaSection;var VideoCodecCapability$1={};Object.defineProperty(VideoCodecCapability$1,"__esModule",{value:!0});const SignalingProtocol_1$2=SignalingProtocol;class VideoCodecCapability{constructor($,_){this.codecName=$,this.codecCapability=_}equals($){if($===void 0||this.codecName!==$.codecName||this.codecCapability.mimeType!==$.codecCapability.mimeType||this.codecCapability.clockRate!==$.codecCapability.clockRate)return!1;const _=this.codecCapability.sdpFmtpLine?this.cleanupFmtpLine(this.codecCapability.sdpFmtpLine,this.codecName):"",tt=$.codecCapability.sdpFmtpLine?this.cleanupFmtpLine($.codecCapability.sdpFmtpLine,$.codecName):"";return _===tt}fmtpLineMatches($,_){const tt=this.codecCapability.sdpFmtpLine;if(!tt)return!1;const nt=`a=fmtp:${_} `;if(!$.startsWith(nt))return!1;const it=$.substring(nt.length);return this.cleanupFmtpLine(it,this.codecName)===this.cleanupFmtpLine(tt,this.codecName)}cleanupFmtpLine($,_){const tt=/;x-google-start-bitrate=\d+/g;let nt=$.replace(tt,"");if(_==="H264"){const it=/profile-level-id=([0-9a-f]{4})[0-9a-f]{2}/i;nt=nt.replace(it,"profile-level-id=$1")}return nt}static vp8(){return new VideoCodecCapability("VP8",{clockRate:9e4,mimeType:"video/VP8"})}static h264BaselineProfile(){return new VideoCodecCapability("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f"})}static h264ConstrainedBaselineProfile(){return new VideoCodecCapability("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f"})}static h264MainProfile(){return new VideoCodecCapability("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=4d001f"})}static h264HighProfile(){return new VideoCodecCapability("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=64001f"})}static h264ConstrainedHighProfile(){return new VideoCodecCapability("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=640c1f"})}static h264(){return VideoCodecCapability.h264ConstrainedBaselineProfile()}static vp9Profile0(){return new VideoCodecCapability("VP9",{clockRate:9e4,mimeType:"video/VP9",sdpFmtpLine:"profile-id=0"})}static vp9(){return VideoCodecCapability.vp9Profile0()}static av1Main(){return new VideoCodecCapability("AV1",{clockRate:9e4,mimeType:"video/AV1"})}static av1(){return VideoCodecCapability.av1Main()}static fromSignaled($){switch($){case SignalingProtocol_1$2.SdkVideoCodecCapability.VP8:return VideoCodecCapability.vp8();case SignalingProtocol_1$2.SdkVideoCodecCapability.H264_BASELINE_PROFILE:return VideoCodecCapability.h264BaselineProfile();case SignalingProtocol_1$2.SdkVideoCodecCapability.H264_CONSTRAINED_BASELINE_PROFILE:return VideoCodecCapability.h264ConstrainedBaselineProfile();case SignalingProtocol_1$2.SdkVideoCodecCapability.H264_MAIN_PROFILE:return VideoCodecCapability.h264MainProfile();case SignalingProtocol_1$2.SdkVideoCodecCapability.H264_HIGH_PROFILE:return VideoCodecCapability.h264HighProfile();case SignalingProtocol_1$2.SdkVideoCodecCapability.H264_CONSTRAINED_HIGH_PROFILE:return VideoCodecCapability.h264ConstrainedHighProfile();case SignalingProtocol_1$2.SdkVideoCodecCapability.VP9_PROFILE_0:return VideoCodecCapability.vp9Profile0();case SignalingProtocol_1$2.SdkVideoCodecCapability.AV1_MAIN_PROFILE:return VideoCodecCapability.av1Main();default:return}}}VideoCodecCapability$1.default=VideoCodecCapability;var __importDefault$1b=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(SDP$1,"__esModule",{value:!0});const SDPCandidateType_1=__importDefault$1b(SDPCandidateType),SDPMediaSection_1=__importDefault$1b(SDPMediaSection$1),VideoCodecCapability_1$3=__importDefault$1b(VideoCodecCapability$1);class SDP{constructor($){this.sdp=$}clone(){return new SDP(this.sdp)}static isRTPCandidate($){const _=/candidate[:](\S+) (\d+)/g.exec($);return!(_===null||_[2]!=="1")}static linesToSDP($){return new SDP($.join(SDP.CRLF))}static candidateTypeFromString($){switch($){case SDPCandidateType_1.default.Host:return SDPCandidateType_1.default.Host;case SDPCandidateType_1.default.ServerReflexive:return SDPCandidateType_1.default.ServerReflexive;case SDPCandidateType_1.default.PeerReflexive:return SDPCandidateType_1.default.PeerReflexive;case SDPCandidateType_1.default.Relay:return SDPCandidateType_1.default.Relay}return null}static candidateType($){const _=/a[=]candidate[:].* typ ([a-z]+) /g.exec($);return _===null?null:SDP.candidateTypeFromString(_[1])}static mediaType($){const _=/m=(audio|video)/g.exec($);if(_!==null)return _[1]}static mid($){if($.includes("a=mid:"))return $.replace(/^(a=mid:)/,"")}static direction($){const _=/a=(sendrecv|sendonly|recvonly|inactive)/g.exec($);if(_!==null)return _[1]}static splitLines($){return $.trim().split(`
`).map(_=>_.trim())}static splitSections($){return $.split(`
m=`).map((tt,nt)=>(nt>0?"m="+tt:tt).trim()+SDP.CRLF)}static findActiveCameraSection($){let _=0,tt=!1;for(const nt of $){if(/^m=video/.test(nt)&&(nt.indexOf("sendrecv")>-1||nt.indexOf("sendonly")===-1&&nt.indexOf("recvonly")===-1&&nt.indexOf("inactive")===-1)){tt=!0;break}_++}return tt===!1&&(_=-1),_}static extractSSRCsFromFIDGroupLine($){return/^a=ssrc-group:FID\s(.+)/.exec($)[1]}static matchPrefix($,_){return SDP.splitLines($).filter(tt=>tt.indexOf(_)===0)}lines(){return this.sdp.split(SDP.CRLF)}hasVideo(){return/^m=video/gm.exec(this.sdp)!==null}hasCandidates(){return/a[=]candidate[:]/g.exec(this.sdp)!==null}hasCandidatesForAllMLines(){return!(this.sdp.indexOf("c=IN IP4 0.0.0.0")>-1)}withoutCandidateType($){return SDP.linesToSDP(this.lines().filter(_=>SDP.candidateType(_)!==$))}withoutServerReflexiveCandidates(){return this.withoutCandidateType(SDPCandidateType_1.default.ServerReflexive)}withAudioMaxAverageBitrate($){if(!$)return this.clone();$=Math.trunc(Math.min(Math.max($,SDP.rfc7587LowestBitrate),SDP.rfc7587HighestBitrate));const _=this.lines(),tt=SDP.findOpusFmtpAttributes(_),nt=SDP.updateOpusFmtpAttributes(_,tt,[`maxaveragebitrate=${$}`]);return SDP.linesToSDP(nt)}withStereoAudio(){const $=this.lines(),_=SDP.findOpusFmtpAttributes($),tt=SDP.updateOpusFmtpAttributes($,_,["stereo=1","sprop-stereo=1"]);return SDP.linesToSDP(tt)}static findOpusFmtpAttributes($){const _=/^a=rtpmap:\s*(\d+)\s+opus\/48000/;let tt=!1;const nt=[];for(const it of $)if(it.startsWith("m=audio")&&(nt.push(null),tt=!0),it.startsWith("m=video")&&(tt=!1),tt){const rt=_.exec(it);rt!==null&&(nt[nt.length-1]=`a=fmtp:${rt[1]} `)}return nt}static updateOpusFmtpAttributes($,_,tt){const nt=[];let it=0,rt=null;for(const ot of $)if(ot.startsWith("m=audio")&&(rt=_[it],it++),ot.startsWith("m=video")&&(rt=null),rt&&ot.startsWith(rt)){const lt=ot.slice(rt.length).split(";"),st=[];for(const at of lt)tt.findIndex(dt=>dt.startsWith(at.split("=")[0]))<0&&st.push(at);for(const at of tt)st.push(at);nt.push(rt+st.join(";"))}else nt.push(ot);return nt}withUnifiedPlanFormat(){let $=this.sdp;return $.includes("mozilla")?this.clone():($=$.replace("o=-","o=mozilla-chrome"),new SDP($))}getUniqueRtpHeaderExtensionId($){const _=[];for(const nt of $)if(/^a=extmap:/.test(nt.trim())){const rt=+nt.split("a=extmap:")[1].split(" ")[0];_.includes(rt)||_.push(rt)}_.sort((nt,it)=>nt-it);let tt=0;for(const nt of _){if(nt-tt>1)return tt+1;tt=nt}return tt===14?-1:tt+1}withVideoLayersAllocationRtpHeaderExtension($){return this.withRtpHeaderExtension($,SDP.videoLayersAllocationRtpHeaderExtensionUrl)}withDependencyDescriptorRtpHeaderExtension($){return this.withRtpHeaderExtension($,SDP.dependencyDescriptorRtpHeaderExtensionUrl)}withoutDependencyDescriptorRtpHeaderExtension(){const $=SDP.splitLines(this.sdp).filter(_=>!_.includes(SDP.dependencyDescriptorRtpHeaderExtensionUrl));return new SDP($.join(SDP.CRLF)+SDP.CRLF)}withRtpHeaderExtension($,_){const tt=$?$.getRtpHeaderExtensionId(_):-1,nt=tt===-1?this.getUniqueRtpHeaderExtensionId(SDP.splitLines(this.sdp)):tt,it=SDP.splitSections(this.sdp),rt=[];for(let lt of it){if(/^m=video/.test(lt)&&SDP.getRtpHeaderExtensionIdInSection(lt,_)===-1){const st=SDP.splitLines(lt),at=[];if(nt===-1||this.hasRtpHeaderExtensionId(nt)){rt.push(lt);continue}for(const ct of st)if(at.push(ct),/^a=sendrecv/.test(ct.trim())){const dt="a=extmap:"+nt+" "+_;at.push(dt)}lt=at.join(SDP.CRLF)+SDP.CRLF}else if(tt!==-1&&/^m=video/.test(lt)&&SDP.getRtpHeaderExtensionIdInSection(lt,_)!==tt){const st=SDP.splitLines(lt),at=[];for(const ct of st){if(/^a=extmap:/.test(ct.trim())&&ct.split("a=extmap:")[1].split(" ")[1]===_){if(!this.hasRtpHeaderExtensionId(tt)){const ut="a=extmap:"+tt+" "+_;at.push(ut)}continue}at.push(ct)}lt=at.join(SDP.CRLF)+SDP.CRLF}rt.push(lt)}const ot=rt.join("");return new SDP(ot)}ssrcForVideoSendingSection(){const $=this.sdp,_=SDP.splitSections($);if(_.length<2)return"";const tt=SDP.findActiveCameraSection(_);if(tt===-1)return"";const nt=SDP.matchPrefix(_[tt],"a=ssrc-group:FID ");if(nt.length<1)return"";const it=SDP.extractSSRCsFromFIDGroupLine(nt[0]),[rt]=it.split(" ").map(ot=>parseInt(ot,10));return rt.toString()}videoSendSectionHasDifferentSSRC($){const _=this.ssrcForVideoSendingSection(),tt=$.ssrcForVideoSendingSection();if(_===""||tt==="")return!1;const nt=parseInt(_,10),it=parseInt(tt,10);return nt!==it}removeH264SupportFromSendSection(){const $=this.sdp,_=SDP.splitSections($),tt=SDP.findActiveCameraSection(_);if(tt===-1)return new SDP(this.sdp);const nt=_[tt],it=SDP.splitLines(nt),rt=[],ot=new Map;it.forEach(ct=>{if(/^a=rtpmap:/.test(ct)){const dt=/^a=rtpmap:([0-9]+)\s/.exec(ct);dt&&ct.toLowerCase().includes("h264")&&rt.push(parseInt(dt[1],10))}if(/^a=fmtp:/.test(ct)){const dt=/^a=fmtp:([0-9]+) apt=([0-9]+)/.exec(ct);if(dt&&dt.length===3){const ut=parseInt(dt[1],10),ft=parseInt(dt[2],10);ot.has(ft)?ot.get(ft).push(ut):ot.set(ft,[ut])}}});const lt=new Set;for(const ct of rt){lt.add(ct);const dt=ot.get(ct);if(dt)for(const ut of dt)lt.add(ut)}if(rt.length>0){const ct=it[0].split(" ");it[0]=ct.filter(dt=>!lt.has(parseInt(dt))).join(" ")}const st=it.filter(ct=>{if(!ct.includes("rtpmap")&&!ct.includes("rtcp-fb")&&!ct.includes("fmtp"))return!0;for(const dt of lt)if(ct.includes(dt.toString()))return!1;return!0});_[tt]=st.join(SDP.CRLF)+SDP.CRLF;const at=_.join("");return new SDP(at)}mediaSections(){const $=SDP.splitSections(this.sdp);if($.length<2)return[];const _=[];for(let tt=1;tt<$.length;tt++){const nt=new SDPMediaSection_1.default,it=SDP.splitLines($[tt]);for(const rt of it){const ot=SDP.mediaType(rt);if(ot!==void 0){nt.mediaType=ot;continue}const lt=SDP.direction(rt);if(lt!==void 0){nt.direction=lt;continue}const st=SDP.mid(rt);if(st!==void 0){nt.mid=st;continue}}_.push(nt)}return _}static getRtpHeaderExtensionIdInSection($,_){const tt=SDP.splitLines($);for(const nt of tt)if(/^a=extmap:/.test(nt.trim())){const it=nt.split("a=extmap:")[1].split(" "),rt=+it[0];if(it[1]===_)return rt}return-1}getRtpHeaderExtensionId($){const _=SDP.splitSections(this.sdp);for(const tt of _)if(/^m=video/.test(tt)){const nt=SDP.getRtpHeaderExtensionIdInSection(tt,$);if(nt!==-1)return nt}return-1}hasRtpHeaderExtensionId($){const _=SDP.splitLines(this.sdp);for(const tt of _)if(/^a=extmap:/.test(tt.trim())&&+tt.split("a=extmap:")[1].split(" ")[0]===$)return!0;return!1}withVideoSendCodecPreferences($){const _=this.sdp,tt=SDP.splitSections(_),nt=SDP.findActiveCameraSection(tt);if(nt===-1)return new SDP(this.sdp);tt[nt]=this.sectionWithCodecPreferences(tt[nt],$);const it=tt.join("");return new SDP(it)}sectionWithCodecPreferences($,_){const tt=new Map,nt=SDP.splitLines($);nt.forEach(lt=>{if(!lt.startsWith("a=rtpmap:"))return;const st=/^a=rtpmap:(\d+)\s/.exec(lt);if(!st)return;const at=st[1];for(const ct of _){if(!lt.includes(`${ct.codecName}/${ct.codecCapability.clockRate}`))continue;let dt=!1;if(ct.codecCapability.sdpFmtpLine!==void 0){let ut=!1;for(const ft of nt){if(ct.fmtpLineMatches(ft,parseInt(at))){dt=!0;break}ut||(ut=ft.startsWith(`a=fmtp:${at} profile-id=`))}ct.equals(VideoCodecCapability_1$3.default.vp9Profile0())&&!ut&&(dt=!0)}else dt=!0;if(dt){tt.set(at,ct);break}}});const it=new Set(tt.keys()),rt=nt[0].split(" ").filter(lt=>!it.has(lt)),ot=Array.from(tt.entries()).sort(([lt,st],[at,ct])=>{const dt=_.indexOf(st),ut=_.indexOf(ct);return dt-ut}).map(([lt,st])=>lt);return rt.splice(3,0,...ot),nt[0]=rt.join(" "),nt.join(SDP.CRLF)+SDP.CRLF}highestPriorityVideoSendCodec(){const $=this.prioritizedSendVideoCodecCapabilities();return $.length>0?$[0]:void 0}prioritizedSendVideoCodecCapabilities(){const $=this.sdp,_=SDP.splitSections($),tt=SDP.findActiveCameraSection(_);if(tt===-1)return[];const nt=SDP.splitLines(_[tt]),it=nt[0].split(" ");return it.length<4?[]:it.slice(3).map(lt=>this.videoCodecCapabilityForPayloadType(nt,lt)).filter(lt=>lt!==void 0&&["VP8","H264","VP9","AV1"].includes(lt.codecName))}videoCodecCapabilityForPayloadType($,_){let tt,nt,it;for(const rt of $){const ot=/^a=rtpmap:([0-9]+)\s/.exec(rt);if(ot&&ot[1]===_){const st=rt.split(" ")[1].split("/");st.length>=2&&(tt=st[0],nt=st[1])}rt.startsWith(`a=fmtp:${_} `)&&(it=rt.split(" ")[1])}if(tt!==void 0)return new VideoCodecCapability_1$3.default(tt,{clockRate:parseInt(nt),mimeType:`video/${tt}`,sdpFmtpLine:it})}getAudioPayloadTypes(){const $=new Map,_=this.sdp,tt=SDP.splitSections(_);return $.set("opus",SDP.findAudioPayloadType("opus",tt)),$.set("red",SDP.findAudioPayloadType("red",tt)),$}static findAudioPayloadType($,_){const tt=`a=rtpmap:\\s*(\\d+)\\s+${$}\\/48000`,nt=new RegExp(tt);for(const it of _)if(/^m=audio/.test(it)){const rt=nt.exec(it);if(rt!==null)return Number(rt[1])}return 0}withStartingVideoSendBitrate($){const _=SDP.splitSections(this.sdp),tt=SDP.findActiveCameraSection(_);if(tt===-1)return this;const nt=SDP.splitLines(_[tt]),it=[];for(const ot of nt)if(/^a=fmtp:\d*/.test(ot)){const lt=ot+`;x-google-start-bitrate=${$}`;it.push(lt)}else it.push(ot);_[tt]=it.join(SDP.CRLF)+SDP.CRLF;const rt=_.join("");return new SDP(rt)}}SDP$1.default=SDP;SDP.CRLF=`\r
`;SDP.rfc7587LowestBitrate=6e3;SDP.rfc7587HighestBitrate=51e4;SDP.dependencyDescriptorRtpHeaderExtensionUrl="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";SDP.videoLayersAllocationRtpHeaderExtensionUrl="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00";var __awaiter$M=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1a=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(CreateSDPTask$1,"__esModule",{value:!0});const MeetingSessionStatusCode_1$6=__importDefault$1a(MeetingSessionStatusCode),SDP_1$4=__importDefault$1a(SDP$1),BaseTask_1$k=__importDefault$1a(BaseTask$1);class CreateSDPTask extends BaseTask_1$k.default{constructor($){super($.logger),this.context=$,this.taskName="CreateSDPTask"}cancel(){if(this.cancelPromise){const $=new Error(`canceling ${this.name()}`);this.cancelPromise($),delete this.cancelPromise}}sessionUsesAudio(){var $,_;return!!(!((_=($=this.context.meetingSessionConfiguration)===null||$===void 0?void 0:$.urls)===null||_===void 0)&&_.audioHostURL)}sessionUsesVideo(){let _;this.context.transceiverController.useTransceivers()?_=this.context.transceiverController.hasVideoInput():_=this.context.videoTileController.hasStartedLocalVideoTile();const tt=!!this.context.videosToReceive&&!this.context.videosToReceive.empty(),nt=_||tt;return this.context.logger.info(`uses video: ${nt} (enabled: ${!0}, sending: ${_}, receiving: ${tt})`),nt}run(){return __awaiter$M(this,void 0,void 0,function*(){const $={offerToReceiveAudio:this.sessionUsesAudio(),offerToReceiveVideo:this.sessionUsesVideo()};this.logger.info(`peer connection offerOptions: ${JSON.stringify($)}`),yield new Promise((_,tt)=>__awaiter$M(this,void 0,void 0,function*(){this.cancelPromise=nt=>{tt(nt)};try{if(this.context.sdpOfferInit=yield this.context.peer.createOffer($),this.context.logger.info("peer connection created offer"),this.context.previousSdpOffer&&new SDP_1$4.default(this.context.sdpOfferInit.sdp).videoSendSectionHasDifferentSSRC(this.context.previousSdpOffer)){const nt=new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1$6.default.IncompatibleSDP}`);this.context.previousSdpOffer=null,tt(nt);return}_()}catch(nt){tt(nt)}finally{delete this.cancelPromise}}))})}}CreateSDPTask$1.default=CreateSDPTask;var DataMessage$1={};Object.defineProperty(DataMessage$1,"__esModule",{value:!0});class DataMessage{constructor($,_,tt,nt,it,rt){this.timestampMs=$,this.topic=_,this.data=tt,this.senderAttendeeId=nt,this.senderExternalUserId=it,this.throttled=!!rt}text(){return new TextDecoder().decode(this.data)}json(){return JSON.parse(new TextDecoder().decode(this.data))}}DataMessage$1.default=DataMessage;var DefaultActiveSpeakerDetector$1={},__awaiter$L=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$19=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultActiveSpeakerDetector$1,"__esModule",{value:!0});const IntervalScheduler_1$4=__importDefault$19(IntervalScheduler$1);class DefaultActiveSpeakerDetector{constructor($,_,tt,nt=1e3,it=200){this.realtimeController=$,this.selfAttendeeId=_,this.hasBandwidthPriorityCallback=tt,this.waitIntervalMs=nt,this.updateIntervalMs=it,this.speakerScores={},this.speakerMuteState={},this.detectorCallbackToHandler=new Map,this.detectorCallbackToScoresTimer=new Map,this.detectorCallbackToActivityTimer=new Map,this.hasBandwidthPriority=!1,this.mostRecentUpdateTimestamp={}}needUpdate($){return this.activeSpeakers?this.speakerScores[$]===0&&this.activeSpeakers.includes($)||this.speakerScores[$]>0&&!this.activeSpeakers.includes($):!0}updateActiveSpeakers($,_,tt){if(!this.needUpdate(tt))return;const nt=[],it=Object.keys(this.speakerScores);for(let at=0;at<it.length;at++){const ct=it[at];nt.push({attendeeId:ct,activeScore:this.speakerScores[ct]})}const rt=nt.sort((at,ct)=>ct.activeScore-at.activeScore).filter(function(at){return at.activeScore>0}).map(function(at){return at.attendeeId});this.activeSpeakers=rt,_(rt);const lt=rt.length>0&&rt[0]===this.selfAttendeeId&&$.prioritizeVideoSendBandwidthForActiveSpeaker();this.hasBandwidthPriority!==lt&&(this.hasBandwidthPriority=lt,this.hasBandwidthPriorityCallback(lt))}updateScore($,_,tt,nt,it){const rt=$.calculateScore(tt,nt,it);this.speakerScores[tt]!==rt&&(this.speakerScores[tt]=rt,this.mostRecentUpdateTimestamp[tt]=Date.now(),this.updateActiveSpeakers($,_,tt))}subscribe($,_,tt,nt){const it=(ot,lt)=>{if(!lt){this.speakerScores[ot]=0,this.mostRecentUpdateTimestamp[ot]=Date.now(),this.updateActiveSpeakers($,_,ot);return}this.realtimeController.realtimeSubscribeToVolumeIndicator(ot,(st,at,ct,dt)=>{this.mostRecentUpdateTimestamp[st]=Date.now(),ct!==null&&(this.speakerMuteState[st]=ct),this.updateScore($,_,st,at,ct)})};this.detectorCallbackToHandler.set(_,it);const rt=new IntervalScheduler_1$4.default(this.updateIntervalMs);if(rt.start(()=>{for(const ot in this.speakerScores)Date.now()-this.mostRecentUpdateTimestamp[ot]>this.waitIntervalMs&&this.updateScore($,_,ot,0,this.speakerMuteState[ot])}),this.detectorCallbackToActivityTimer.set(_,rt),tt&&nt){const ot=new IntervalScheduler_1$4.default(nt);ot.start(()=>{tt(this.speakerScores)}),this.detectorCallbackToScoresTimer.set(_,ot)}this.realtimeController.realtimeSubscribeToAttendeeIdPresence(it)}unsubscribe($){const _=this.detectorCallbackToHandler.get($);this.detectorCallbackToHandler.delete($),_&&this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(_);const tt=this.detectorCallbackToActivityTimer.get($);tt&&(tt.stop(),this.detectorCallbackToActivityTimer.delete($));const nt=this.detectorCallbackToScoresTimer.get($);nt&&(nt.stop(),this.detectorCallbackToHandler.delete($))}destroy(){return __awaiter$L(this,void 0,void 0,function*(){for(const $ of this.detectorCallbackToHandler.values())this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence($);for(const $ of this.detectorCallbackToActivityTimer.values())$.stop();for(const $ of this.detectorCallbackToScoresTimer.values())$.stop();this.detectorCallbackToHandler.clear(),this.detectorCallbackToActivityTimer.clear(),this.detectorCallbackToScoresTimer.clear()})}}DefaultActiveSpeakerDetector$1.default=DefaultActiveSpeakerDetector;var DefaultActiveSpeakerPolicy$1={};Object.defineProperty(DefaultActiveSpeakerPolicy$1,"__esModule",{value:!0});class DefaultActiveSpeakerPolicy{constructor($=.9,_=.01,tt=.2,nt=.2){this.speakerWeight=$,this.cutoffThreshold=_,this.silenceThreshold=tt,this.takeoverRate=nt,this.volumes={}}calculateScore($,_,tt){(tt||_===null)&&(_=0),this.volumes.hasOwnProperty($)||(this.volumes[$]=0),_>this.silenceThreshold?_=1:_=0;const nt=this.volumes[$]*this.speakerWeight+_*(1-this.speakerWeight);this.volumes[$]=nt;for(const it in this.volumes)it!==$&&(this.volumes[it]=Math.max(this.volumes[it]-this.takeoverRate*_,0));return nt<this.cutoffThreshold?0:nt}prioritizeVideoSendBandwidthForActiveSpeaker(){return!0}}DefaultActiveSpeakerPolicy$1.default=DefaultActiveSpeakerPolicy;var DefaultAudioMixController$1={},__awaiter$K=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$18=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultAudioMixController$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$5=__importDefault$18(DefaultBrowserBehavior$1),AsyncScheduler_1$5=__importDefault$18(AsyncScheduler$1);class DefaultAudioMixController{constructor($){this.logger=$,this.audioDevice=null,this.audioElement=null,this.audioStream=null,this.browserBehavior=new DefaultBrowserBehavior_1$5.default,this.observers=new Set}bindAudioElement($){return __awaiter$K(this,void 0,void 0,function*(){if(!$)throw new Error(`Cannot bind audio element: ${$}`);return this.audioElement=$,this.audioElement.autoplay=!0,this.bindAudioMix()})}unbindAudioElement(){this.audioElement&&(this.audioElement.srcObject=null,this.audioElement=null,this.forEachObserver($=>{this.audioStream&&$.meetingAudioStreamBecameInactive(this.audioStream)}))}bindAudioStream($){return __awaiter$K(this,void 0,void 0,function*(){if($){this.audioStream=$;try{yield this.bindAudioMix()}catch(_){this.logger&&this.logger.warn(`Failed to bind audio stream: ${_}`)}}})}bindAudioDevice($){return __awaiter$K(this,void 0,void 0,function*(){if($&&!this.browserBehavior.supportsSetSinkId())throw new Error("Cannot select audio output device. This browser does not support setSinkId.");return this.audioDevice=$,this.bindAudioMix()})}forEachObserver($){for(const _ of this.observers)AsyncScheduler_1$5.default.nextTick(()=>{$(_)})}bindAudioMix(){var $,_;return __awaiter$K(this,void 0,void 0,function*(){if(!this.audioElement)return;const tt=this.audioElement.srcObject;this.audioStream&&(this.audioElement.srcObject=this.audioStream),tt!==this.audioStream&&this.forEachObserver(st=>{tt&&st.meetingAudioStreamBecameInactive(tt),this.audioStream&&st.meetingAudioStreamBecameActive(this.audioStream)});const nt=(($=this.audioDevice)===null||$===void 0?void 0:$.deviceId)!==this.audioElement.sinkId;if(nt&&typeof this.audioElement.sinkId>"u")throw new Error("Cannot select audio output device. This browser does not support setSinkId.");const it=this.audioDevice?this.audioDevice.deviceId:"",rt=this.audioElement.sinkId;if(it===rt)return;const ot=this.audioElement,lt=this.audioStream;if(this.browserBehavior.hasChromiumWebRTC()&&(ot.srcObject=null),nt)try{yield ot.setSinkId(it)}catch(st){throw(_=this.logger)===null||_===void 0||_.error(`Failed to set sinkId for audio element: ${st}`),st}this.browserBehavior.hasChromiumWebRTC()&&(ot.srcObject=lt)})}getCurrentMeetingAudioStream(){return __awaiter$K(this,void 0,void 0,function*(){return this.audioStream})}addAudioMixObserver($){return __awaiter$K(this,void 0,void 0,function*(){this.observers.add($)})}removeAudioMixObserver($){return __awaiter$K(this,void 0,void 0,function*(){this.observers.delete($)})}audioOutputDidChange($){return __awaiter$K(this,void 0,void 0,function*(){return this.logger.info("Receive an audio output change event"),this.bindAudioDevice($)})}}DefaultAudioMixController$1.default=DefaultAudioMixController;var DefaultAudioVideoController={},SignalingAndMetricsConnectionMonitor$1={};Object.defineProperty(SignalingAndMetricsConnectionMonitor$1,"__esModule",{value:!0});const Types_1$7=Types;class SignalingAndMetricsConnectionMonitor{constructor($,_,tt,nt,it){this.audioVideoController=$,this.realtimeController=_,this.connectionHealthData=tt,this.pingPong=nt,this.statsCollector=it,this.isActive=!1,this.hasSeenValidCandidatePairMetricsBefore=!1,this.lastTotalBytesReceived=0,this.lastTotalStunMessagesReceived=0,this.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(rt=>{this.isActive&&this.receiveSignalStrengthChange(rt)})}start(){this.isActive=!0,this.pingPong.addObserver(this),this.pingPong.start(),this.audioVideoController.addObserver(this)}stop(){this.isActive=!1,this.pingPong.removeObserver(this),this.pingPong.stop(),this.audioVideoController.removeObserver(this)}receiveSignalStrengthChange($){$===0?this.connectionHealthData.setLastNoSignalTimestampMs(Date.now()):$<=.5?this.connectionHealthData.setLastWeakSignalTimestampMs(Date.now()):this.connectionHealthData.setLastGoodSignalTimestampMs(Date.now()),this.updateConnectionHealth()}didReceivePong($,_,tt){this.connectionHealthData.setConsecutiveMissedPongs(0),this.statsCollector.logLatency("ping_pong",_),this.statsCollector.logLatency("ping_pong_clock_skew",tt),this.updateConnectionHealth()}didMissPongs(){this.connectionHealthData.setConsecutiveMissedPongs(this.connectionHealthData.consecutiveMissedPongs+1),this.updateConnectionHealth()}metricsDidReceive($){let _=0,tt=0;const nt=$.getObservableMetrics(),it=nt.audioPacketsReceived,rt=nt.audioPacketsReceivedFractionLoss,ot=nt.audioSpeakerDelayMs;typeof ot=="number"&&!isNaN(ot)&&this.connectionHealthData.setAudioSpeakerDelayMs(ot);const lt=$.getRTCStatsReport();let st=0,at=0;lt.forEach(ut=>{ut.type==="candidate-pair"&&(ut.bytesReceived&&(st+=ut.bytesReceived),ut.requestsReceived&&(at+=ut.requestsReceived),ut.responsesReceived&&(at+=ut.responsesReceived))});const ct=st-this.lastTotalBytesReceived;this.lastTotalBytesReceived=st;const dt=at-this.lastTotalStunMessagesReceived;if(this.lastTotalStunMessagesReceived=at,typeof it=="number"&&typeof rt=="number"){if(_=it,tt=rt,_<0||tt<0||ct<0||dt<0)return}else return;this.addToMinuteWindow(this.connectionHealthData.packetsReceivedInLastMinute,_),this.addToMinuteWindow(this.connectionHealthData.fractionPacketsLostInboundInLastMinute,tt),ct>0||dt>0?(this.hasSeenValidCandidatePairMetricsBefore=!0,this.connectionHealthData.setConsecutiveStatsWithNoPackets(0)):this.hasSeenValidCandidatePairMetricsBefore&&this.connectionHealthData.setConsecutiveStatsWithNoPackets(this.connectionHealthData.consecutiveStatsWithNoPackets+1),(_===0||tt>0)&&this.connectionHealthData.setLastPacketLossInboundTimestampMs(Date.now()),typeof nt.audioPacketsSent=="number"&&this.updateAudioPacketsSentInConnectionHealth(nt.audioPacketsSent),this.updateVideoEncodingHealth($),this.updateConnectionHealth()}updateAudioPacketsSentInConnectionHealth($){$>0?this.connectionHealthData.setConsecutiveStatsWithNoAudioPacketsSent(0):this.connectionHealthData.setConsecutiveStatsWithNoAudioPacketsSent(this.connectionHealthData.consecutiveStatsWithNoAudioPacketsSent+1)}updateVideoEncodingHealth($){const _=this.audioVideoController.videoTileController.hasStartedLocalVideoTile(),tt=$.getVideoUpstreamSsrcs();if(!_||tt.length===0){this.connectionHealthData.setIsVideoEncoderHardware(!1),this.connectionHealthData.setVideoEncodingTimePerFrameInMs(0),this.connectionHealthData.setCpuLimitationDuration(0),this.connectionHealthData.setVideoInputFps(0),this.connectionHealthData.setVideoEncodeFps(0);return}let nt=!1,it=0,rt=0,ot=0,lt=0;for(const at of tt)nt||(nt=!!$.getObservableVideoMetricValue("videoUpstreamEncoderImplementation",at)),it+=$.getObservableVideoMetricValue("videoUpstreamTotalEncodeTimePerSecond",at),rt+=$.getObservableVideoMetricValue("videoUpstreamCpuQualityLimitationDurationPerSecond",at),ot+=$.getObservableVideoMetricValue("videoUpstreamFramesInputPerSecond",at),lt+=$.getObservableVideoMetricValue("videoUpstreamFramesEncodedPerSecond",at);const st=lt>0?it/lt:0;this.connectionHealthData.setIsVideoEncoderHardware(!!nt),this.connectionHealthData.setVideoEncodingTimeInMs(it),this.connectionHealthData.setVideoEncodingTimePerFrameInMs(st),this.connectionHealthData.setCpuLimitationDuration(rt),this.connectionHealthData.setVideoInputFps(ot),this.connectionHealthData.setVideoEncodeFps(lt)}addToMinuteWindow($,_){$.unshift(_),$.length>60&&$.pop()}updateConnectionHealth(){this.audioVideoController.forEachObserver($=>{Types_1$7.Maybe.of($.connectionHealthDidChange).map(_=>_.bind($)(this.connectionHealthData.clone()))})}}SignalingAndMetricsConnectionMonitor$1.default=SignalingAndMetricsConnectionMonitor;var MeetingSessionStatus$1={},__importDefault$17=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(MeetingSessionStatus$1,"__esModule",{value:!0});const SignalingProtocol_js_1$e=SignalingProtocol,MeetingSessionStatusCode_1$5=__importDefault$17(MeetingSessionStatusCode);class MeetingSessionStatus{constructor($){this._statusCode=$}statusCode(){return this._statusCode}isFailure(){switch(this._statusCode){case MeetingSessionStatusCode_1$5.default.AudioAuthenticationRejected:case MeetingSessionStatusCode_1$5.default.AudioCallAtCapacity:case MeetingSessionStatusCode_1$5.default.AudioInternalServerError:case MeetingSessionStatusCode_1$5.default.AudioServiceUnavailable:case MeetingSessionStatusCode_1$5.default.AudioDisconnected:case MeetingSessionStatusCode_1$5.default.VideoCallAtSourceCapacity:case MeetingSessionStatusCode_1$5.default.SignalingBadRequest:case MeetingSessionStatusCode_1$5.default.SignalingInternalServerError:case MeetingSessionStatusCode_1$5.default.SignalingRequestFailed:case MeetingSessionStatusCode_1$5.default.ICEGatheringTimeoutWorkaround:case MeetingSessionStatusCode_1$5.default.ConnectionHealthReconnect:case MeetingSessionStatusCode_1$5.default.RealtimeApiFailed:case MeetingSessionStatusCode_1$5.default.TaskFailed:case MeetingSessionStatusCode_1$5.default.NoAttendeePresent:case MeetingSessionStatusCode_1$5.default.SignalingChannelClosedUnexpectedly:return!0;default:return!1}}isTerminal(){switch(this._statusCode){case MeetingSessionStatusCode_1$5.default.Left:case MeetingSessionStatusCode_1$5.default.AudioJoinedFromAnotherDevice:case MeetingSessionStatusCode_1$5.default.AudioAuthenticationRejected:case MeetingSessionStatusCode_1$5.default.AudioCallAtCapacity:case MeetingSessionStatusCode_1$5.default.MeetingEnded:case MeetingSessionStatusCode_1$5.default.AudioDisconnected:case MeetingSessionStatusCode_1$5.default.TURNCredentialsForbidden:case MeetingSessionStatusCode_1$5.default.SignalingBadRequest:case MeetingSessionStatusCode_1$5.default.SignalingRequestFailed:case MeetingSessionStatusCode_1$5.default.VideoCallAtSourceCapacity:case MeetingSessionStatusCode_1$5.default.RealtimeApiFailed:case MeetingSessionStatusCode_1$5.default.AudioAttendeeRemoved:return!0;default:return!1}}isAudioConnectionFailure(){switch(this._statusCode){case MeetingSessionStatusCode_1$5.default.AudioAuthenticationRejected:case MeetingSessionStatusCode_1$5.default.AudioInternalServerError:case MeetingSessionStatusCode_1$5.default.AudioServiceUnavailable:case MeetingSessionStatusCode_1$5.default.ICEGatheringTimeoutWorkaround:case MeetingSessionStatusCode_1$5.default.SignalingBadRequest:case MeetingSessionStatusCode_1$5.default.SignalingInternalServerError:case MeetingSessionStatusCode_1$5.default.SignalingRequestFailed:case MeetingSessionStatusCode_1$5.default.RealtimeApiFailed:case MeetingSessionStatusCode_1$5.default.NoAttendeePresent:return!0;default:return!1}}toString(){switch(this._statusCode){case MeetingSessionStatusCode_1$5.default.OK:return"Everything is OK so far.";case MeetingSessionStatusCode_1$5.default.Left:return"The attendee left the meeting.";case MeetingSessionStatusCode_1$5.default.AudioJoinedFromAnotherDevice:return"The attendee joined from another device.";case MeetingSessionStatusCode_1$5.default.AudioAuthenticationRejected:return"The meeting rejected the attendee.";case MeetingSessionStatusCode_1$5.default.AudioCallAtCapacity:return"The attendee couldn't join because the meeting was at capacity.";case MeetingSessionStatusCode_1$5.default.MeetingEnded:return"The meeting ended.";case MeetingSessionStatusCode_1$5.default.AudioInternalServerError:case MeetingSessionStatusCode_1$5.default.AudioServiceUnavailable:case MeetingSessionStatusCode_1$5.default.AudioDisconnected:return"The audio connection failed.";case MeetingSessionStatusCode_1$5.default.VideoCallSwitchToViewOnly:return"The attendee couldn't start the local video because the maximum video capacity was reached.";case MeetingSessionStatusCode_1$5.default.VideoCallAtSourceCapacity:return"The connection failed due to an internal server error.";case MeetingSessionStatusCode_1$5.default.SignalingBadRequest:case MeetingSessionStatusCode_1$5.default.SignalingInternalServerError:case MeetingSessionStatusCode_1$5.default.SignalingRequestFailed:return"The signaling connection failed.";case MeetingSessionStatusCode_1$5.default.ICEGatheringTimeoutWorkaround:return"Gathering ICE candidates timed out. In Chrome, this might indicate that the browser is in a bad state after reconnecting to VPN.";case MeetingSessionStatusCode_1$5.default.ConnectionHealthReconnect:return"The meeting was reconnected.";case MeetingSessionStatusCode_1$5.default.RealtimeApiFailed:return"The real-time API failed. This status code might indicate that the callback you passed to the real-time API threw an exception.";case MeetingSessionStatusCode_1$5.default.TaskFailed:return"The connection failed. See the error message for more details.";case MeetingSessionStatusCode_1$5.default.IncompatibleSDP:return"The connection failed due to incompatible SDP.";case MeetingSessionStatusCode_1$5.default.TURNCredentialsForbidden:return"The meeting ended, or the attendee was removed.";case MeetingSessionStatusCode_1$5.default.NoAttendeePresent:return"The attendee was not present.";case MeetingSessionStatusCode_1$5.default.AudioAttendeeRemoved:return"The meeting ended because attendee removed.";case MeetingSessionStatusCode_1$5.default.AudioVideoWasRemovedFromPrimaryMeeting:return"The Primary meeting credentials provided are no longer valid. chime::DeleteAttendee may have been called on them.";case MeetingSessionStatusCode_1$5.default.AudioVideoDisconnectedWhilePromoted:return"The client disconnected while promoted, which will automatically demote. The attendee must promote again to participate.";case MeetingSessionStatusCode_1$5.default.AudioDisconnectAudio:return"The audio connection failed.";case MeetingSessionStatusCode_1$5.default.SignalingChannelClosedUnexpectedly:return"The signaling channel was closed unexpectedly. This may be due to a network change or backend detected failure.";default:{const $=this._statusCode;throw new Error(`Unhandled case: ${$}`)}}}static fromSignalFrame($){return $.error&&$.error.status?this.fromSignalingStatus($.error.status):$.type===SignalingProtocol_js_1$e.SdkSignalFrame.Type.AUDIO_STATUS?$.audioStatus?this.fromAudioStatus($.audioStatus.audioStatus):new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.SignalingRequestFailed):$.type===SignalingProtocol_js_1$e.SdkSignalFrame.Type.PRIMARY_MEETING_LEAVE?new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.AudioVideoWasRemovedFromPrimaryMeeting):new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.OK)}static fromAudioStatus($){switch($){case 200:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.OK);case 301:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.AudioJoinedFromAnotherDevice);case 302:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.AudioDisconnectAudio);case 403:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.AudioAuthenticationRejected);case 409:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.AudioCallAtCapacity);case 410:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.MeetingEnded);case 411:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.AudioAttendeeRemoved);case 500:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.AudioInternalServerError);case 503:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.AudioServiceUnavailable);default:switch(Math.floor($/100)){case 2:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.OK);default:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.AudioDisconnected)}}}static fromSignalingStatus($){switch($){case 206:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.VideoCallSwitchToViewOnly);case 509:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.VideoCallAtSourceCapacity);case 403:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.AudioAuthenticationRejected);case 409:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.AudioCallAtCapacity);default:switch(Math.floor($/100)){case 2:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.OK);case 4:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.SignalingBadRequest);case 5:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.SignalingInternalServerError);default:return new MeetingSessionStatus(MeetingSessionStatusCode_1$5.default.SignalingRequestFailed)}}}}MeetingSessionStatus$1.default=MeetingSessionStatus;var MeetingSessionVideoAvailability$1={};Object.defineProperty(MeetingSessionVideoAvailability$1,"__esModule",{value:!0});class MeetingSessionVideoAvailability{constructor(){this.remoteVideoAvailable=!1,this.canStartLocalVideo=!1}equal($){return this.remoteVideoAvailable===$.remoteVideoAvailable&&this.canStartLocalVideo===$.canStartLocalVideo}clone(){const $=new MeetingSessionVideoAvailability;return $.remoteVideoAvailable=this.remoteVideoAvailable,$.canStartLocalVideo=this.canStartLocalVideo,$}}MeetingSessionVideoAvailability$1.default=MeetingSessionVideoAvailability;var DefaultPingPong$1={},__importDefault$16=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultPingPong$1,"__esModule",{value:!0});const AsyncScheduler_1$4=__importDefault$16(AsyncScheduler$1),IntervalScheduler_1$3=__importDefault$16(IntervalScheduler$1),SignalingClientEventType_1$b=__importDefault$16(SignalingClientEventType),SignalingProtocol_js_1$d=SignalingProtocol,Types_1$6=Types;class DefaultPingPong{constructor($,_,tt){this.signalingClient=$,this.intervalMs=_,this.logger=tt,this.observerQueue=new Set,this.consecutivePongsUnaccountedFor=0,this.intervalScheduler=new IntervalScheduler_1$3.default(this.intervalMs),this.pingId=0}addObserver($){this.logger.info("adding a ping-pong observer"),this.observerQueue.add($)}removeObserver($){this.logger.info("removing a ping-pong observer"),this.observerQueue.delete($)}forEachObserver($){for(const _ of this.observerQueue)AsyncScheduler_1$4.default.nextTick(()=>{this.observerQueue.has(_)&&$(_)})}start(){this.stop(),this.signalingClient.registerObserver(this),this.signalingClient.ready()&&this.startPingInterval()}stop(){this.stopPingInterval(),this.signalingClient.removeObserver(this)}startPingInterval(){this.intervalScheduler.start(()=>{this.ping()}),this.ping()}stopPingInterval(){this.intervalScheduler.stop(),this.pingId=0,this.consecutivePongsUnaccountedFor=0}ping(){this.consecutivePongsUnaccountedFor>0&&(this.logger.warn(`missed pong ${this.consecutivePongsUnaccountedFor} time(s)`),this.forEachObserver(_=>{Types_1$6.Maybe.of(_.didMissPongs).map(tt=>tt.bind(_)(this.consecutivePongsUnaccountedFor))})),this.consecutivePongsUnaccountedFor+=1,this.pingId=this.pingId+1&4294967295;const $=SignalingProtocol_js_1$d.SdkPingPongFrame.create();$.pingId=this.pingId,$.type=SignalingProtocol_js_1$d.SdkPingPongType.PING,this.pingTimestampLocalMs=this.signalingClient.pingPong($),this.logger.debug(()=>`sent ping ${this.pingId}`)}pong($){const _=SignalingProtocol_js_1$d.SdkPingPongFrame.create();_.pingId=$,_.type=SignalingProtocol_js_1$d.SdkPingPongType.PONG,this.signalingClient.pingPong(_)}handleSignalingClientEvent($){switch($.type){case SignalingClientEventType_1$b.default.WebSocketOpen:this.startPingInterval();break;case SignalingClientEventType_1$b.default.WebSocketFailed:case SignalingClientEventType_1$b.default.WebSocketError:this.logger.warn(`stopped pinging (${SignalingClientEventType_1$b.default[$.type]})`),this.stopPingInterval();break;case SignalingClientEventType_1$b.default.WebSocketClosing:case SignalingClientEventType_1$b.default.WebSocketClosed:this.logger.info(`stopped pinging (${SignalingClientEventType_1$b.default[$.type]})`),this.stopPingInterval();break;case SignalingClientEventType_1$b.default.ReceivedSignalFrame:if($.message.type!==SignalingProtocol_js_1$d.SdkSignalFrame.Type.PING_PONG)break;if($.message.pingPong.type===SignalingProtocol_js_1$d.SdkPingPongType.PONG){const _=$.message.pingPong.pingId;if(_!==this.pingId){this.logger.warn(`unexpected ping id ${_} (expected ${this.pingId})`);break}this.consecutivePongsUnaccountedFor=0;let tt;if(typeof $.message.timestampMs=="number")tt=$.message.timestampMs;else break;this.logger.debug(()=>`received pong ${_} with timestamp ${tt}`);const it=$.timestampMs-this.pingTimestampLocalMs,rt=Math.round(tt-it/2),ot=this.pingTimestampLocalMs-rt;this.logger.info(`local clock skew estimate=${ot}ms from ping-pong time=${it}ms`),this.forEachObserver(lt=>{Types_1$6.Maybe.of(lt.didReceivePong).map(st=>st.bind(lt)(_,ot,it))})}else this.pong($.message.pingPong.pingId);break}}}DefaultPingPong$1.default=DefaultPingPong;var DefaultRealtimeController$1={},DefaultTranscriptionController={},TranscriptEvent={},Transcript$1={};Object.defineProperty(Transcript$1,"__esModule",{value:!0});class Transcript{}Transcript$1.default=Transcript;var TranscriptionStatus$1={};Object.defineProperty(TranscriptionStatus$1,"__esModule",{value:!0});class TranscriptionStatus{}TranscriptionStatus$1.default=TranscriptionStatus;var TranscriptionStatusType$1={};Object.defineProperty(TranscriptionStatusType$1,"__esModule",{value:!0});var TranscriptionStatusType;(function(et){et.STARTED="started",et.INTERRUPTED="interrupted",et.RESUMED="resumed",et.STOPPED="stopped",et.FAILED="failed"})(TranscriptionStatusType||(TranscriptionStatusType={}));TranscriptionStatusType$1.default=TranscriptionStatusType;var TranscriptItemType$1={};Object.defineProperty(TranscriptItemType$1,"__esModule",{value:!0});var TranscriptItemType;(function(et){et.PRONUNCIATION="pronunciation",et.PUNCTUATION="punctuation"})(TranscriptItemType||(TranscriptItemType={}));TranscriptItemType$1.default=TranscriptItemType;var __importDefault$15=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(TranscriptEvent,"__esModule",{value:!0});TranscriptEvent.TranscriptEventConverter=void 0;const SignalingProtocol_1$1=SignalingProtocol,Transcript_1=__importDefault$15(Transcript$1),TranscriptionStatus_1=__importDefault$15(TranscriptionStatus$1),TranscriptionStatusType_1=__importDefault$15(TranscriptionStatusType$1),TranscriptItemType_1=__importDefault$15(TranscriptItemType$1),TranscriptionStatusTypes={[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.STARTED]:TranscriptionStatusType_1.default.STARTED,[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.INTERRUPTED]:TranscriptionStatusType_1.default.INTERRUPTED,[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.RESUMED]:TranscriptionStatusType_1.default.RESUMED,[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.STOPPED]:TranscriptionStatusType_1.default.STOPPED,[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.FAILED]:TranscriptionStatusType_1.default.FAILED};class TranscriptEventConverter{static from($){let _;try{_=SignalingProtocol_1$1.SdkTranscriptFrame.decode($.data)}catch(nt){throw new Error("Cannot decode transcript data message: "+nt)}const tt=[];for(const nt of _.events)if(nt.status){const it=TranscriptionStatusTypes[nt.status.type];if(!it)continue;const rt=new TranscriptionStatus_1.default;rt.type=it,rt.eventTimeMs=nt.status.eventTime,rt.transcriptionRegion=nt.status.transcriptionRegion,rt.transcriptionConfiguration=nt.status.transcriptionConfiguration,nt.status.message&&(rt.message=nt.status.message),tt.push(rt)}else if(nt.transcript){const it=new Transcript_1.default;it.results=[];for(const rt of nt.transcript.results){const ot={channelId:rt.channelId,isPartial:rt.isPartial,resultId:rt.resultId,startTimeMs:rt.startTime,endTimeMs:rt.endTime,alternatives:[]};if(rt.languageCode&&(ot.languageCode=rt.languageCode),rt.languageIdentification&&rt.languageIdentification.length>0){ot.languageIdentification=[];for(const lt of rt.languageIdentification){const st={languageCode:lt.languageCode,score:lt.score};ot.languageIdentification.push(st)}}for(const lt of rt.alternatives){const st={items:[],transcript:lt.transcript};for(const at of lt.items){const ct={content:at.content,attendee:{attendeeId:at.speakerAttendeeId,externalUserId:at.speakerExternalUserId},startTimeMs:at.startTime,endTimeMs:at.endTime,type:null};switch(at.vocabularyFilterMatch&&(ct.vocabularyFilterMatch=at.vocabularyFilterMatch),at.hasOwnProperty("stable")&&(ct.stable=at.stable),at.hasOwnProperty("confidence")&&(ct.confidence=at.confidence),at.type){case SignalingProtocol_1$1.SdkTranscriptItem.Type.PRONUNCIATION:ct.type=TranscriptItemType_1.default.PRONUNCIATION;break;case SignalingProtocol_1$1.SdkTranscriptItem.Type.PUNCTUATION:ct.type=TranscriptItemType_1.default.PUNCTUATION;break}st.items.push(ct)}for(const at of lt.entities){st.entities||(st.entities=[]);const ct={category:at.category,confidence:at.confidence,content:at.content,startTimeMs:at.startTime,endTimeMs:at.endTime};at.type&&(ct.type=at.type),st.entities.push(ct)}ot.alternatives.push(st)}it.results.push(ot)}tt.push(it)}return tt}}TranscriptEvent.TranscriptEventConverter=TranscriptEventConverter;(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.TRANSCRIPTION_DATA_MESSAGE_TOPIC=void 0;const $=TranscriptEvent;et.TRANSCRIPTION_DATA_MESSAGE_TOPIC="aws:chime:transcription";class _{constructor(nt){this.realtimeController=nt,this.transcriptEventCallbacks=new Set}subscribeToTranscriptEvent(nt){this.transcriptEventCallbacks.size===0&&this.realtimeController.realtimeSubscribeToReceiveDataMessage(et.TRANSCRIPTION_DATA_MESSAGE_TOPIC,it=>{for(const rt of $.TranscriptEventConverter.from(it))for(const ot of this.transcriptEventCallbacks)ot(rt)}),this.transcriptEventCallbacks.add(nt)}unsubscribeFromTranscriptEvent(nt){this.transcriptEventCallbacks.delete(nt),this.transcriptEventCallbacks.size===0&&this.realtimeController.realtimeUnsubscribeFromReceiveDataMessage(et.TRANSCRIPTION_DATA_MESSAGE_TOPIC)}}et.default=_})(DefaultTranscriptionController);var Utils={},__importDefault$14=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(Utils,"__esModule",{value:!0});Utils.iterateEvery=Utils.SuppressedError=Utils.getRandomValues=Utils.getFormattedOffset=Utils.getDefaultAssetSpec=Utils.toLowerCasePropertyNames=Utils.isIFramed=Utils.wait=void 0;const Versioning_1$7=__importDefault$14(Versioning$1);function wait(et){return new Promise($=>setTimeout($,et))}Utils.wait=wait;function isIFramed(){var et;try{return((et=window.frameElement)===null||et===void 0?void 0:et.nodeName)==="IFRAME"||parent!==top}catch{return!0}}Utils.isIFramed=isIFramed;function toLowerCasePropertyNames(et){return et===null?null:typeof et!="object"?et:Array.isArray(et)?et.map(toLowerCasePropertyNames):Object.keys(et).reduce(($,_)=>{const tt=et[_],nt=typeof tt=="object"?toLowerCasePropertyNames(tt):tt;return $[_.toLowerCase()]=nt,$},{})}Utils.toLowerCasePropertyNames=toLowerCasePropertyNames;function getDefaultAssetSpec(){const et=Versioning_1$7.default.sdkVersionSemVer;return{assetGroup:`sdk-${et.major}.${et.minor}`}}Utils.getDefaultAssetSpec=getDefaultAssetSpec;function getFormattedOffset(et){const $=Math.abs(et),_=et<=0?"+":"-",tt=Math.floor($/60).toString().padStart(2,"0"),nt=Math.floor($%60).toString().padStart(2,"0");return`${_}${tt}:${nt}`}Utils.getFormattedOffset=getFormattedOffset;function getRandomValues(et){try{window.crypto.getRandomValues(et)}catch{new DataView(et.buffer).setUint32(0,Math.trunc(Math.random()*Math.pow(2,32)),!0)}}Utils.getRandomValues=getRandomValues;let SuppressedError$1=class extends Error{constructor($,_,tt){var nt;super(tt??`${(nt=$==null?void 0:$.message)!==null&&nt!==void 0?nt:$}`),this.error=$,this.suppressed=_}};Utils.SuppressedError=SuppressedError$1;function iterateEvery(et,$){if(!et)return;let _;for(const tt of et)try{$(tt)}catch(nt){_=new SuppressedError$1(nt,_)}if(_)throw _}Utils.iterateEvery=iterateEvery;var RealtimeState$1={};Object.defineProperty(RealtimeState$1,"__esModule",{value:!0});class RealtimeState{constructor(){this.localAttendeeId=null,this.localExternalUserId=null,this.attendeeIdChangesCallbacks=[],this.canUnmute=!0,this.setCanUnmuteLocalAudioCallbacks=[],this.muted=!1,this.muteAndUnmuteLocalAudioCallbacks=[],this.volumeIndicatorState={},this.attendeeIdToExternalUserId={},this.volumeIndicatorCallbacks={},this.localSignalStrengthChangeCallbacks=[],this.fatalErrorCallbacks=[],this.sendDataMessageCallbacks=[],this.receiveDataMessageCallbacks=new Map}}RealtimeState$1.default=RealtimeState;var RealtimeVolumeIndicator$1={};Object.defineProperty(RealtimeVolumeIndicator$1,"__esModule",{value:!0});class RealtimeVolumeIndicator{constructor(){this.volume=null,this.muted=null,this.signalStrength=null}}RealtimeVolumeIndicator$1.default=RealtimeVolumeIndicator;var __importDefault$13=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultRealtimeController$1,"__esModule",{value:!0});const DefaultTranscriptionController_1=__importDefault$13(DefaultTranscriptionController),Utils_1$6=Utils,RealtimeState_1=__importDefault$13(RealtimeState$1),RealtimeVolumeIndicator_1=__importDefault$13(RealtimeVolumeIndicator$1);class DefaultRealtimeController{constructor($,_){this.mediaStreamBroker=$,this.state=new RealtimeState_1.default,this._transcriptionController=_||new DefaultTranscriptionController_1.default(this)}realtimeSetLocalAttendeeId($,_){this.state.localAttendeeId=$,this.state.localExternalUserId=_}realtimeSetAttendeeIdPresence($,_,tt,nt,it){try{_&&(this.state.attendeeIdToExternalUserId[$]=tt);for(const rt of this.state.attendeeIdChangesCallbacks)rt($,_,tt,nt,it)}catch(rt){this.onError(rt)}}realtimeSubscribeToAttendeeIdPresence($){try{this.state.attendeeIdChangesCallbacks.push($)}catch(_){this.onError(_)}}realtimeUnsubscribeToAttendeeIdPresence($){try{const _=this.state.attendeeIdChangesCallbacks.indexOf($);_!==-1&&this.state.attendeeIdChangesCallbacks.splice(_,1)}catch(_){this.onError(_)}}realtimeSetCanUnmuteLocalAudio($){try{if(this.state.canUnmute===$)return;this.state.canUnmute=$;for(const _ of this.state.setCanUnmuteLocalAudioCallbacks)_($)}catch(_){this.onError(_)}}realtimeSubscribeToSetCanUnmuteLocalAudio($){try{this.state.setCanUnmuteLocalAudioCallbacks.push($)}catch(_){this.onError(_)}}realtimeUnsubscribeToSetCanUnmuteLocalAudio($){try{const _=this.state.setCanUnmuteLocalAudioCallbacks.indexOf($);_!==-1&&this.state.setCanUnmuteLocalAudioCallbacks.splice(_,1)}catch(_){this.onError(_)}}realtimeCanUnmuteLocalAudio(){return this.state.canUnmute}realtimeMuteLocalAudio(){if(!this.state.muted)try{this.setAudioInputEnabled(!1),this.state.muted=!0,this.realtimeUpdateVolumeIndicator(this.state.localAttendeeId,null,null,null,this.state.localExternalUserId);for(const $ of this.state.muteAndUnmuteLocalAudioCallbacks)$(!0)}catch($){this.onError($)}}realtimeUnmuteLocalAudio(){if(!this.state.muted)return!0;if(!this.state.canUnmute)return!1;try{this.setAudioInputEnabled(!0),this.state.muted=!1,this.realtimeUpdateVolumeIndicator(this.state.localAttendeeId,null,null,null,this.state.localExternalUserId);for(const $ of this.state.muteAndUnmuteLocalAudioCallbacks)$(!1);return!0}catch($){return this.onError($),!1}}realtimeSubscribeToMuteAndUnmuteLocalAudio($){try{this.state.muteAndUnmuteLocalAudioCallbacks.push($)}catch(_){this.onError(_)}}realtimeUnsubscribeToMuteAndUnmuteLocalAudio($){try{const _=this.state.muteAndUnmuteLocalAudioCallbacks.indexOf($);_!==-1&&this.state.muteAndUnmuteLocalAudioCallbacks.splice(_,1)}catch(_){this.onError(_)}}realtimeIsLocalAudioMuted(){return this.state.muted}realtimeSubscribeToVolumeIndicator($,_){try{this.state.volumeIndicatorCallbacks.hasOwnProperty($)||(this.state.volumeIndicatorCallbacks[$]=[]),this.state.volumeIndicatorCallbacks[$].push(_),this.sendVolumeIndicatorChange($,!0,!0,!0,this.state.attendeeIdToExternalUserId[$])}catch(tt){this.onError(tt)}}realtimeUnsubscribeFromVolumeIndicator($,_){if(this.state.volumeIndicatorCallbacks[$])if(_){const nt=this.state.volumeIndicatorCallbacks[$].indexOf(_);nt>=0&&this.state.volumeIndicatorCallbacks[$].splice(nt,1)}else delete this.state.volumeIndicatorCallbacks[$]}realtimeUpdateVolumeIndicator($,_,tt,nt,it){try{tt=this.applyLocalMuteOverride($,tt);const rt=this.getVolumeIndicatorState($);let ot=!1,lt=!1,st=!1;tt!==null&&rt.muted!==tt&&(rt.muted=tt,lt=!0,rt.muted&&rt.volume!==0&&(rt.volume=0,ot=!0)),!rt.muted&&_!==null&&(rt.volume!==_&&(rt.volume=_,ot=!0),rt.muted===null&&(rt.muted=!1,lt=!0)),nt!==null&&rt.signalStrength!==nt&&(rt.signalStrength=nt,st=!0),this.sendVolumeIndicatorChange($,ot,lt,st,it)}catch(rt){this.onError(rt)}}realtimeSubscribeToLocalSignalStrengthChange($){try{if(this.state.localSignalStrengthChangeCallbacks.push($),this.state.localAttendeeId===null)return;this.sendLocalSignalStrengthChange(this.state.localAttendeeId,!0)}catch(_){this.onError(_)}}realtimeUnsubscribeToLocalSignalStrengthChange($){try{const _=this.state.localSignalStrengthChangeCallbacks.indexOf($);_!==-1&&this.state.localSignalStrengthChangeCallbacks.splice(_,1)}catch(_){this.onError(_)}}realtimeSubscribeToSendDataMessage($){try{this.state.sendDataMessageCallbacks.push($)}catch(_){this.onError(_)}}realtimeUnsubscribeFromSendDataMessage($){try{const _=this.state.sendDataMessageCallbacks.indexOf($);_!==-1&&this.state.sendDataMessageCallbacks.splice(_,1)}catch(_){this.onError(_)}}realtimeSendDataMessage($,_,tt){try{for(const nt of this.state.sendDataMessageCallbacks)nt($,_,tt)}catch(nt){this.onError(nt)}}realtimeSubscribeToReceiveDataMessage($,_){try{this.state.receiveDataMessageCallbacks.has($)?this.state.receiveDataMessageCallbacks.get($).push(_):this.state.receiveDataMessageCallbacks.set($,[_])}catch(tt){this.onError(tt)}}realtimeUnsubscribeFromReceiveDataMessage($){try{this.state.receiveDataMessageCallbacks.delete($)}catch(_){this.onError(_)}}realtimeReceiveDataMessage($){try{Utils_1$6.iterateEvery(this.state.receiveDataMessageCallbacks.get($.topic),_=>{_($)})}catch(_){Promise.reject(_)}}realtimeSubscribeToFatalError($){try{this.state.fatalErrorCallbacks.push($)}catch(_){this.onError(_)}}realtimeUnsubscribeToFatalError($){try{const _=this.state.fatalErrorCallbacks.indexOf($);_!==-1&&this.state.fatalErrorCallbacks.splice(_,1)}catch(_){this.onError(_)}}get transcriptionController(){return this._transcriptionController}setAudioInputEnabled($){$?this.mediaStreamBroker.unmuteLocalAudioInputStream():this.mediaStreamBroker.muteLocalAudioInputStream()}applyLocalMuteOverride($,_){const tt=this.state.localAttendeeId,nt=this.state.muted;return $!==tt||!("activeDevices"in this.mediaStreamBroker&&this.mediaStreamBroker.activeDevices.audio)?_:nt}sendVolumeIndicatorChange($,_,tt,nt,it){if(this.sendLocalSignalStrengthChange($,nt),!this.state.volumeIndicatorCallbacks.hasOwnProperty($))return;const rt=this.getVolumeIndicatorState($),ot=new RealtimeVolumeIndicator_1.default;if(_&&(ot.volume=rt.volume),tt&&(ot.muted=rt.muted),nt&&(ot.signalStrength=rt.signalStrength),!this.stateIsEmpty(ot))for(const lt of this.state.volumeIndicatorCallbacks[$])lt($,ot.volume,ot.muted,ot.signalStrength,it)}sendLocalSignalStrengthChange($,_){if(!_||$!==this.state.localAttendeeId)return;const nt=this.getVolumeIndicatorState($).signalStrength;if(nt!==null)for(const it of this.state.localSignalStrengthChangeCallbacks)it(nt)}getVolumeIndicatorState($){return this.state.volumeIndicatorState.hasOwnProperty($)||(this.state.volumeIndicatorState[$]=new RealtimeVolumeIndicator_1.default),this.state.volumeIndicatorState[$]}stateIsEmpty($){return $.volume===null&&$.muted===null&&$.signalStrength===null}onError($){try{for(const _ of this.state.fatalErrorCallbacks)_($)}catch(_){try{console.error($),console.error(_)}catch{}}}}DefaultRealtimeController$1.default=DefaultRealtimeController;var DefaultSessionStateController$1={},SessionStateControllerAction={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.SessionStateControllerAction=void 0;var $;(function(_){_[_.Connect=0]="Connect",_[_.FinishConnecting=1]="FinishConnecting",_[_.Update=2]="Update",_[_.FinishUpdating=3]="FinishUpdating",_[_.Reconnect=4]="Reconnect",_[_.Disconnect=5]="Disconnect",_[_.Fail=6]="Fail",_[_.FinishDisconnecting=7]="FinishDisconnecting"})($=et.SessionStateControllerAction||(et.SessionStateControllerAction={})),et.default=$})(SessionStateControllerAction);var SessionStateControllerDeferPriority={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.SessionStateControllerDeferPriority=void 0;var $;(function(_){_[_.DoNotDefer=0]="DoNotDefer",_[_.Low=1]="Low",_[_.Medium=2]="Medium",_[_.High=3]="High",_[_.VeryHigh=4]="VeryHigh"})($=et.SessionStateControllerDeferPriority||(et.SessionStateControllerDeferPriority={})),et.default=$})(SessionStateControllerDeferPriority);var SessionStateControllerState={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.SessionStateControllerState=void 0;var $;(function(_){_[_.NotConnected=0]="NotConnected",_[_.Connecting=1]="Connecting",_[_.Connected=2]="Connected",_[_.Updating=3]="Updating",_[_.Disconnecting=4]="Disconnecting"})($=et.SessionStateControllerState||(et.SessionStateControllerState={})),et.default=$})(SessionStateControllerState);var SessionStateControllerTransitionResult={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.SessionStateControllerTransitionResult=void 0;var $;(function(_){_[_.Transitioned=0]="Transitioned",_[_.NoTransitionAvailable=1]="NoTransitionAvailable",_[_.DeferredTransition=2]="DeferredTransition",_[_.TransitionFailed=3]="TransitionFailed"})($=et.SessionStateControllerTransitionResult||(et.SessionStateControllerTransitionResult={})),et.default=$})(SessionStateControllerTransitionResult);Object.defineProperty(DefaultSessionStateController$1,"__esModule",{value:!0});const SessionStateControllerAction_1=SessionStateControllerAction,SessionStateControllerDeferPriority_1=SessionStateControllerDeferPriority,SessionStateControllerState_1=SessionStateControllerState,SessionStateControllerTransitionResult_1=SessionStateControllerTransitionResult;class DefaultSessionStateController{constructor($){this.logger=$,this.currentState=SessionStateControllerState_1.SessionStateControllerState.NotConnected,this.deferredAction=null,this.deferredWork=null}perform($,_){const tt=this.currentState;if(tt===SessionStateControllerState_1.SessionStateControllerState.NotConnected&&$===SessionStateControllerAction_1.SessionStateControllerAction.Connect)this.transition(SessionStateControllerState_1.SessionStateControllerState.Connecting,$);else if(tt===SessionStateControllerState_1.SessionStateControllerState.Connecting&&$===SessionStateControllerAction_1.SessionStateControllerAction.Fail)this.transition(SessionStateControllerState_1.SessionStateControllerState.Disconnecting,$);else if(tt===SessionStateControllerState_1.SessionStateControllerState.Connecting&&$===SessionStateControllerAction_1.SessionStateControllerAction.FinishConnecting)this.transition(SessionStateControllerState_1.SessionStateControllerState.Connected,$);else if(tt===SessionStateControllerState_1.SessionStateControllerState.Connected&&$===SessionStateControllerAction_1.SessionStateControllerAction.Disconnect)this.transition(SessionStateControllerState_1.SessionStateControllerState.Disconnecting,$);else if(tt===SessionStateControllerState_1.SessionStateControllerState.Connected&&$===SessionStateControllerAction_1.SessionStateControllerAction.Reconnect)this.transition(SessionStateControllerState_1.SessionStateControllerState.Connecting,$);else if(tt===SessionStateControllerState_1.SessionStateControllerState.Connected&&$===SessionStateControllerAction_1.SessionStateControllerAction.Fail)this.transition(SessionStateControllerState_1.SessionStateControllerState.Disconnecting,$);else if(tt===SessionStateControllerState_1.SessionStateControllerState.Connected&&$===SessionStateControllerAction_1.SessionStateControllerAction.Update)this.transition(SessionStateControllerState_1.SessionStateControllerState.Updating,$);else if(tt===SessionStateControllerState_1.SessionStateControllerState.Updating&&$===SessionStateControllerAction_1.SessionStateControllerAction.Fail)this.transition(SessionStateControllerState_1.SessionStateControllerState.Disconnecting,$);else if(tt===SessionStateControllerState_1.SessionStateControllerState.Updating&&$===SessionStateControllerAction_1.SessionStateControllerAction.FinishUpdating)this.transition(SessionStateControllerState_1.SessionStateControllerState.Connected,$);else if(tt===SessionStateControllerState_1.SessionStateControllerState.Disconnecting&&$===SessionStateControllerAction_1.SessionStateControllerAction.FinishDisconnecting)this.transition(SessionStateControllerState_1.SessionStateControllerState.NotConnected,$);else return this.canDefer($)?(this.logger.info(`deferring transition from ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]} with ${SessionStateControllerAction_1.SessionStateControllerAction[$]}`),this.deferAction($,_),SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.DeferredTransition):(this.logger.warn(`no transition found from ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]} with ${SessionStateControllerAction_1.SessionStateControllerAction[$]}`),SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.NoTransitionAvailable);try{_()}catch(nt){return this.logger.error(`error during state ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]} with action ${SessionStateControllerAction_1.SessionStateControllerAction[$]}: ${nt}`),this.logger.info(`rolling back transition to ${SessionStateControllerState_1.SessionStateControllerState[tt]}`),this.currentState=tt,SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.TransitionFailed}return this.performDeferredAction(),SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.Transitioned}state(){return this.currentState}transition($,_){this.logger.info(`transitioning from ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]} to ${SessionStateControllerState_1.SessionStateControllerState[$]} with ${SessionStateControllerAction_1.SessionStateControllerAction[_]}`),this.currentState=$}deferPriority($){switch($){case SessionStateControllerAction_1.SessionStateControllerAction.Disconnect:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.VeryHigh;case SessionStateControllerAction_1.SessionStateControllerAction.Fail:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.High;case SessionStateControllerAction_1.SessionStateControllerAction.Reconnect:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.Medium;case SessionStateControllerAction_1.SessionStateControllerAction.Update:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.Low;default:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.DoNotDefer}}deferAction($,_){this.deferredAction!==null&&this.deferPriority(this.deferredAction)>this.deferPriority($)||(this.deferredAction=$,this.deferredWork=_)}canDefer($){return this.deferPriority($)!==SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.DoNotDefer&&(this.currentState===SessionStateControllerState_1.SessionStateControllerState.Connecting||this.currentState===SessionStateControllerState_1.SessionStateControllerState.Updating)}performDeferredAction(){if(!this.deferredAction)return;const $=this.deferredAction,_=this.deferredWork;this.deferredAction=null,this.deferredWork=null,this.logger.info(`performing deferred action ${SessionStateControllerAction_1.SessionStateControllerAction[$]}`),this.perform($,_)!==SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.Transitioned&&this.logger.info(`unable to perform deferred action ${SessionStateControllerAction_1.SessionStateControllerAction[$]} in state ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]}`)}}DefaultSessionStateController$1.default=DefaultSessionStateController;var DefaultSignalingClient$1={},VideoQualityAdaptationPreference={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.VideoQualityAdaptationPreference=void 0;var $;(function(_){_[_.Balanced=0]="Balanced",_[_.MaintainFramerate=1]="MaintainFramerate",_[_.MaintainResolution=2]="MaintainResolution"})($=et.VideoQualityAdaptationPreference||(et.VideoQualityAdaptationPreference={})),et.default=$})(VideoQualityAdaptationPreference);var WebSocketReadyState={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.WebSocketReadyState=void 0;var $;(function(_){_[_.None=0]="None",_[_.Connecting=1]="Connecting",_[_.Open=2]="Open",_[_.Closing=3]="Closing",_[_.Closed=4]="Closed"})($=et.WebSocketReadyState||(et.WebSocketReadyState={})),et.default=$})(WebSocketReadyState);var ServerSideNetworkAdaption={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.convertServerSideNetworkAdaptionEnumToSignaled=et.convertServerSideNetworkAdaptionEnumFromSignaled=et.serverSideNetworkAdaptionIsNoneOrDefault=et.ServerSideNetworkAdaption=void 0;const $=SignalingProtocol;var _;(function(rt){rt[rt.Default=0]="Default",rt[rt.None=1]="None",rt[rt.BandwidthProbing=2]="BandwidthProbing",rt[rt.BandwidthProbingAndRemoteVideoQualityAdaption=3]="BandwidthProbingAndRemoteVideoQualityAdaption"})(_=et.ServerSideNetworkAdaption||(et.ServerSideNetworkAdaption={})),et.default=_;function tt(rt){return rt===_.None||rt===_.Default}et.serverSideNetworkAdaptionIsNoneOrDefault=tt;function nt(rt){switch(rt){case $.SdkServerSideNetworkAdaption.DEFAULT:return _.Default;case $.SdkServerSideNetworkAdaption.NONE:return _.None;case $.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING:return _.BandwidthProbing;case $.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION:return _.BandwidthProbingAndRemoteVideoQualityAdaption}}et.convertServerSideNetworkAdaptionEnumFromSignaled=nt;function it(rt){switch(rt){case _.Default:return $.SdkServerSideNetworkAdaption.DEFAULT;case _.None:return $.SdkServerSideNetworkAdaption.NONE;case _.BandwidthProbing:return $.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING;case _.BandwidthProbingAndRemoteVideoQualityAdaption:return $.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION}}et.convertServerSideNetworkAdaptionEnumToSignaled=it})(ServerSideNetworkAdaption);var SignalingClientEvent$1={},__importDefault$12=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(SignalingClientEvent$1,"__esModule",{value:!0});const SignalingClientEventType_1$a=__importDefault$12(SignalingClientEventType);class SignalingClientEvent{constructor($,_,tt,nt,it){this.client=$,this.type=_,this.message=tt,this.closeCode=nt,this.closeReason=it,this.timestampMs=Date.now()}isConnectionTerminated(){switch(this.type){case SignalingClientEventType_1$a.default.WebSocketFailed:case SignalingClientEventType_1$a.default.WebSocketError:case SignalingClientEventType_1$a.default.WebSocketClosing:case SignalingClientEventType_1$a.default.WebSocketClosed:return!0;default:return!1}}}SignalingClientEvent$1.default=SignalingClientEvent;var __importDefault$11=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultSignalingClient$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$4=__importDefault$11(DefaultBrowserBehavior$1),TimeoutScheduler_1$2=__importDefault$11(TimeoutScheduler$1),SignalingProtocol_js_1$c=SignalingProtocol,Utils_1$5=Utils,Versioning_1$6=__importDefault$11(Versioning$1),VideoQualityAdaptationPreference_1$2=__importDefault$11(VideoQualityAdaptationPreference),WebSocketReadyState_1$2=__importDefault$11(WebSocketReadyState),ServerSideNetworkAdaption_1$6=ServerSideNetworkAdaption,SignalingClientEvent_1=__importDefault$11(SignalingClientEvent$1),SignalingClientEventType_1$9=__importDefault$11(SignalingClientEventType);class DefaultSignalingClient{constructor($,_){this.webSocket=$,this.logger=_,this.unloadHandler=null,this.closeEventHandler=tt=>{this.deactivatePageUnloadHandler(),this.resetConnection(),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketClosed,null,tt.code,tt.reason)),this.serviceConnectionRequestQueue()},this.observerQueue=new Set,this.connectionRequestQueue=[],this.resetConnection(),this.logger.debug(()=>"signaling client init"),this.audioSessionId=this.generateNewAudioSessionId()}registerObserver($){this.logger.debug(()=>"registering signaling client observer"),this.observerQueue.add($)}removeObserver($){this.logger.debug(()=>"removing signaling client observer"),this.observerQueue.delete($)}openConnection($){this.logger.info("adding connection request to queue: "+$.url()),this.connectionRequestQueue.push($),this.closeConnection()}pingPong($){this.logger.debug(()=>"sending ping");const _=SignalingProtocol_js_1$c.SdkSignalFrame.create();return _.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.PING_PONG,_.pingPong=$,this.sendMessage(_),_.timestampMs}join($){this.logger.info("sending join");const _=SignalingProtocol_js_1$c.SdkJoinFrame.create();_.protocolVersion=2,_.flags=SignalingProtocol_js_1$c.SdkJoinFlags.HAS_STREAM_UPDATE;const tt=new DefaultBrowserBehavior_1$4.default,nt={platformName:tt.name(),platformVersion:tt.version(),clientSource:Versioning_1$6.default.sdkName,chimeSdkVersion:Versioning_1$6.default.sdkVersion,clientUtcOffset:Utils_1$5.getFormattedOffset(new Date().getTimezoneOffset())};if($.applicationMetadata){const{appName:rt,appVersion:ot}=$.applicationMetadata;nt.appName=rt,nt.appVersion=ot}_.clientDetails=SignalingProtocol_js_1$c.SdkClientDetails.create(nt),_.audioSessionId=this.audioSessionId,_.wantsCompressedSdp=DefaultSignalingClient.CLIENT_SUPPORTS_COMPRESSION,_.disablePeriodicKeyframeRequestOnContentSender=$.disablePeriodicKeyframeRequestOnContentSender,_.serverSideNetworkAdaption=ServerSideNetworkAdaption_1$6.convertServerSideNetworkAdaptionEnumToSignaled($.serverSideNetworkAdaption),_.supportedServerSideNetworkAdaptions=$.supportedServerSideNetworkAdaptions.map(ServerSideNetworkAdaption_1$6.convertServerSideNetworkAdaptionEnumToSignaled),_.wantsAllTemporalLayersInIndex=$.wantsAllTemporalLayersInIndex;const it=SignalingProtocol_js_1$c.SdkSignalFrame.create();it.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.JOIN,it.join=_,this.sendMessage(it)}subscribe($){const _=SignalingProtocol_js_1$c.SdkSubscribeFrame.create();if(_.sendStreams=[],_.sdpOffer=$.sdpOffer,$.connectionTypeHasVideo&&(_.receiveStreamIds=$.receiveStreamIds),$.audioHost&&(_.audioCheckin=$.audioCheckin,_.audioHost=$.audioHost,_.audioMuted=$.audioMuted,!$.audioCheckin)){const nt=SignalingProtocol_js_1$c.SdkStreamDescriptor.create();nt.mediaType=SignalingProtocol_js_1$c.SdkStreamMediaType.AUDIO,nt.trackLabel="AmazonChimeExpressAudio",nt.attendeeId=$.attendeeId,nt.streamId=1,nt.groupId=1,nt.framerate=15,nt.maxBitrateKbps=600,nt.avgBitrateBps=4e5,_.sendStreams.push(nt)}if(_.compressedSdpOffer=$.compressedSdpOffer,_.duplex=SignalingProtocol_js_1$c.SdkStreamServiceType.RX,$.localVideoEnabled){_.duplex=SignalingProtocol_js_1$c.SdkStreamServiceType.DUPLEX;for(let nt=0;nt<$.videoStreamDescriptions.length;nt++){const it=$.videoStreamDescriptions[nt].clone();it.attendeeId=$.attendeeId,_.sendStreams.push(it.toStreamDescriptor())}}$.videoSubscriptionConfiguration.length>0&&(_.videoSubscriptionConfiguration=$.videoSubscriptionConfiguration.map(this.convertSignalingClientVideoSubscriptionConfiguration));const tt=SignalingProtocol_js_1$c.SdkSignalFrame.create();tt.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.SUBSCRIBE,tt.sub=_,this.sendMessage(tt)}remoteVideoUpdate($,_){const tt=SignalingProtocol_js_1$c.SdkRemoteVideoUpdateFrame.create();tt.addedOrUpdatedVideoSubscriptions=$.map(this.convertSignalingClientVideoSubscriptionConfiguration),tt.removedVideoSubscriptionMids=_;const nt=SignalingProtocol_js_1$c.SdkSignalFrame.create();nt.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.REMOTE_VIDEO_UPDATE,nt.remoteVideoUpdate=tt,this.sendMessage(nt)}convertSignalingClientVideoSubscriptionConfiguration($){const _=new SignalingProtocol_js_1$c.SdkVideoSubscriptionConfiguration;switch(_.mid=$.mid,_.attendeeId=$.attendeeId,_.streamId=$.streamId,_.groupId=$.groupId,_.priority=$.priority,_.targetBitrateKbps=$.targetBitrateKbps,$.qualityAdaptationPreference){case VideoQualityAdaptationPreference_1$2.default.Balanced:_.qualityAdaptationPreference=SignalingProtocol_js_1$c.SdkVideoQualityAdaptationPreference.BALANCED;break;case VideoQualityAdaptationPreference_1$2.default.MaintainFramerate:_.qualityAdaptationPreference=SignalingProtocol_js_1$c.SdkVideoQualityAdaptationPreference.MAINTAIN_FRAMERATE;break;case VideoQualityAdaptationPreference_1$2.default.MaintainResolution:_.qualityAdaptationPreference=SignalingProtocol_js_1$c.SdkVideoQualityAdaptationPreference.MAINTAIN_RESOLUTION;break;default:_.qualityAdaptationPreference=SignalingProtocol_js_1$c.SdkVideoQualityAdaptationPreference.BALANCED}return _}leave(){const $=SignalingProtocol_js_1$c.SdkSignalFrame.create();$.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.LEAVE,$.leave=SignalingProtocol_js_1$c.SdkLeaveFrame.create(),this.sendMessage($),this.logger.debug(()=>"sent leave")}sendClientMetrics($){const _=SignalingProtocol_js_1$c.SdkSignalFrame.create();_.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.CLIENT_METRIC,_.clientMetric=$,this.sendMessage(_)}sendDataMessage($){const _=SignalingProtocol_js_1$c.SdkSignalFrame.create();_.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.DATA_MESSAGE,_.dataMessage=$,this.sendMessage(_)}closeConnection(){var $,_;if(this.webSocket.readyState()!==WebSocketReadyState_1$2.default.None&&this.webSocket.readyState()!==WebSocketReadyState_1$2.default.Closed){this.isClosing=!0,this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketClosing,null));const tt=new TimeoutScheduler_1$2.default(DefaultSignalingClient.CLOSE_EVENT_TIMEOUT_MS),nt=it=>{var rt,ot;(ot=(rt=this.webSocket).removeEventListener)===null||ot===void 0||ot.call(rt,"close",nt),tt.stop(),this.closeEventHandler(it)};(_=($=this.webSocket).removeEventListener)===null||_===void 0||_.call($,"close",this.closeEventHandler),this.webSocket.addEventListener("close",nt),tt.start(()=>{nt(new CloseEvent("close",{wasClean:!1,code:1005,reason:"",bubbles:!1}))}),this.webSocket.close(),this.deactivatePageUnloadHandler()}else this.logger.info("no existing signaling client connection needs closing"),this.serviceConnectionRequestQueue()}ready(){return this.webSocket.readyState()===WebSocketReadyState_1$2.default.Open&&!this.isClosing&&this.wasOpened}mute($){const _=SignalingProtocol_js_1$c.SdkSignalFrame.create();_.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.AUDIO_CONTROL;const tt=SignalingProtocol_js_1$c.SdkAudioControlFrame.create();tt.muted=$,_.audioControl=tt,this.sendMessage(_)}pause($){const _=SignalingProtocol_js_1$c.SdkSignalFrame.create();_.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.PAUSE,_.pause=SignalingProtocol_js_1$c.SdkPauseResumeFrame.create(),_.pause.streamIds=$,this.sendMessage(_)}resume($){const _=SignalingProtocol_js_1$c.SdkSignalFrame.create();_.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.RESUME,_.pause=SignalingProtocol_js_1$c.SdkPauseResumeFrame.create(),_.pause.streamIds=$,this.sendMessage(_)}resetConnection(){this.webSocket.destroy(),this.wasOpened=!1}sendMessage($){$.timestampMs=Date.now(),this.logger.debug(()=>`sending: ${JSON.stringify($)}`);const _=this.prependWithFrameTypeRTC(SignalingProtocol_js_1$c.SdkSignalFrame.encode($).finish());if(this.ready()){if(!this.webSocket.send(_)){this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketSendMessageFailure,null));return}this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketSentMessage,null))}else this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketSkippedMessage,null))}receiveMessage($){let _;try{_=SignalingProtocol_js_1$c.SdkSignalFrame.decode($)}catch{this.logger.info(`failed to decode: ${$}`),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.ProtocolDecodeFailure,null));return}this.logger.debug(()=>`received: ${JSON.stringify(_)}`),this.webSocket.readyState()===WebSocketReadyState_1$2.default.Open?this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.ReceivedSignalFrame,_)):this.logger.info(`skipping notification of message since WebSocket is not open: ${JSON.stringify(_)}`)}stripFrameTypeRTC($){const _=$[0];return _!==DefaultSignalingClient.FRAME_TYPE_RTC&&_!==2&&this.logger.warn(`expected FrameTypeRTC for message but got ${_}`),$.slice(1)}prependWithFrameTypeRTC($){const _=new Uint8Array($.length+1);return _[0]=DefaultSignalingClient.FRAME_TYPE_RTC,_.set($,1),_}serviceConnectionRequestQueue(){if(this.connectionRequestQueue.length===0){this.logger.info("no connection requests to service");return}const $=this.connectionRequestQueue.shift();this.logger.info(`opening connection to ${$.url()}`),this.isClosing=!1,this.webSocket.create($.url(),$.protocols()),this.setUpEventListeners(),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketConnecting,null))}sendEvent($){switch($.type){case SignalingClientEventType_1$9.default.WebSocketMessage:case SignalingClientEventType_1$9.default.ReceivedSignalFrame:case SignalingClientEventType_1$9.default.WebSocketSentMessage:this.logger.debug(()=>`notifying event: ${SignalingClientEventType_1$9.default[$.type]}`);break;case SignalingClientEventType_1$9.default.WebSocketSkippedMessage:this.logger.debug(()=>`notifying event: ${SignalingClientEventType_1$9.default[$.type]}, websocket state=${WebSocketReadyState_1$2.default[this.webSocket.readyState()]}`);break;case SignalingClientEventType_1$9.default.WebSocketClosed:this.logger.info(`notifying event: ${SignalingClientEventType_1$9.default[$.type]}, 
              code: ${$.closeCode} reason: ${$.closeReason}`);break;default:this.logger.info(`notifying event: ${SignalingClientEventType_1$9.default[$.type]}`);break}for(const _ of this.observerQueue)_.handleSignalingClientEvent($)}setUpEventListeners(){this.webSocket.addEventListener("open",()=>{this.activatePageUnloadHandler(),this.wasOpened=!0,this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketOpen,null))}),this.webSocket.addEventListener("message",$=>{this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketMessage,null)),this.receiveMessage(this.stripFrameTypeRTC(new Uint8Array($.data)))}),this.webSocket.addEventListener("close",this.closeEventHandler),this.webSocket.addEventListener("error",()=>{if(this.isClosing&&!this.wasOpened){this.logger.info("Signaling WebSocket ignoring error closing while connecting");return}this.wasOpened?(this.logger.error("Signaling WebSocket received error while connected"),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketError,null))):(this.logger.error("Signaling WebSocket received error while connecting"),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$9.default.WebSocketFailed,null)))})}activatePageUnloadHandler(){this.unloadHandler=()=>{this.leave()};const $=window;$.window&&$.window.addEventListener&&window.addEventListener("unload",this.unloadHandler)}deactivatePageUnloadHandler(){const $=window;$.window&&$.window.removeEventListener&&window.removeEventListener("unload",this.unloadHandler),this.unloadHandler=null}generateNewAudioSessionId(){const $=new Uint32Array(1);return Utils_1$5.getRandomValues($),$[0]}promoteToPrimaryMeeting($){const _=SignalingProtocol_js_1$c.SdkMeetingSessionCredentials.create();_.attendeeId=$.attendeeId,_.externalUserId=$.externalUserId,_.joinToken=$.joinToken;const tt=SignalingProtocol_js_1$c.SdkPrimaryMeetingJoinFrame.create();tt.credentials=_;const nt=SignalingProtocol_js_1$c.SdkSignalFrame.create();nt.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN,nt.primaryMeetingJoin=tt,this.sendMessage(nt)}demoteFromPrimaryMeeting(){const $=SignalingProtocol_js_1$c.SdkPrimaryMeetingLeaveFrame.create(),_=SignalingProtocol_js_1$c.SdkSignalFrame.create();_.type=SignalingProtocol_js_1$c.SdkSignalFrame.Type.PRIMARY_MEETING_LEAVE,_.primaryMeetingLeave=$,this.sendMessage(_)}}DefaultSignalingClient$1.default=DefaultSignalingClient;DefaultSignalingClient.FRAME_TYPE_RTC=5;DefaultSignalingClient.CLOSE_EVENT_TIMEOUT_MS=2e3;DefaultSignalingClient.CLIENT_SUPPORTS_COMPRESSION=!0;var SignalingClientVideoSubscriptionConfiguration$1={};Object.defineProperty(SignalingClientVideoSubscriptionConfiguration$1,"__esModule",{value:!0});class SignalingClientVideoSubscriptionConfiguration{equals($){return $!==void 0&&this.mid===$.mid&&this.attendeeId===$.attendeeId&&this.streamId===$.streamId&&this.groupId===$.groupId&&this.priority===$.priority&&this.targetBitrateKbps===$.targetBitrateKbps&&this.qualityAdaptationPreference===$.qualityAdaptationPreference}}SignalingClientVideoSubscriptionConfiguration$1.default=SignalingClientVideoSubscriptionConfiguration;var StatsCollector$1={},RedundantAudioRecoveryMetricReport$1={};Object.defineProperty(RedundantAudioRecoveryMetricReport$1,"__esModule",{value:!0});class RedundantAudioRecoveryMetricReport{constructor(){this.currentTimestampMs=0,this.ssrc=0,this.totalAudioPacketsLost=0,this.totalAudioPacketsExpected=0,this.totalAudioPacketsRecoveredRed=0,this.totalAudioPacketsRecoveredFec=0}}RedundantAudioRecoveryMetricReport$1.default=RedundantAudioRecoveryMetricReport;var StreamMetricReport$1={};Object.defineProperty(StreamMetricReport$1,"__esModule",{value:!0});class StreamMetricReport{constructor(){this.previousMetrics={},this.currentMetrics={},this.currentStringMetrics={},this.previousObjectMetrics={},this.currentObjectMetrics={}}}StreamMetricReport$1.default=StreamMetricReport;var MeetingSessionLifecycleEvent={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.MeetingSessionLifecycleEvent=void 0;var $;(function(_){_[_.Connecting=0]="Connecting",_[_.Started=1]="Started",_[_.Stopped=2]="Stopped"})($=et.MeetingSessionLifecycleEvent||(et.MeetingSessionLifecycleEvent={})),et.default=$})(MeetingSessionLifecycleEvent);var MeetingSessionLifecycleEventCondition={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.MeetingSessionLifecycleEventCondition=void 0;var $;(function(_){_[_.ConnectingNew=0]="ConnectingNew",_[_.ReconnectingExisting=1]="ReconnectingExisting",_[_.StartedNew=2]="StartedNew",_[_.StartedExisting=3]="StartedExisting",_[_.StartedAfterReconnect=4]="StartedAfterReconnect",_[_.StoppedCleanly=5]="StoppedCleanly",_[_.StoppedWithFailure=6]="StoppedWithFailure"})($=et.MeetingSessionLifecycleEventCondition||(et.MeetingSessionLifecycleEventCondition={})),et.default=$})(MeetingSessionLifecycleEventCondition);var __awaiter$J=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$10=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(StatsCollector$1,"__esModule",{value:!0});const ClientMetricReport_1=__importDefault$10(ClientMetricReport$1),ClientMetricReportDirection_1$2=__importDefault$10(ClientMetricReportDirection),ClientMetricReportMediaType_1$2=__importDefault$10(ClientMetricReportMediaType),RedundantAudioRecoveryMetricReport_1$1=__importDefault$10(RedundantAudioRecoveryMetricReport$1),StreamMetricReport_1=__importDefault$10(StreamMetricReport$1),MeetingSessionLifecycleEvent_1=__importDefault$10(MeetingSessionLifecycleEvent),MeetingSessionLifecycleEventCondition_1=__importDefault$10(MeetingSessionLifecycleEventCondition),IntervalScheduler_1$2=__importDefault$10(IntervalScheduler$1),SignalingProtocol_js_1$b=SignalingProtocol,Types_1$5=Types,AudioLogEvent_1$1=__importDefault$10(AudioLogEvent),VideoLogEvent_1=__importDefault$10(VideoLogEvent);class StatsCollector{constructor($,_,tt=StatsCollector.INTERVAL_MS){this.audioVideoController=$,this.logger=_,this.interval=tt,this.intervalScheduler=null,this.redRecoveryMetricReport=new RedundantAudioRecoveryMetricReport_1$1.default,this.lastRedRecoveryMetricReportConsumedTimestampMs=0,this.videoCodecDegradationHighEncodeCpuCount=0,this.videoCodecDegradationEncodeFailureCount=0,this.videoCodecDegradationConcurrentSendersCount=0,this.resolutionMap=new Map,this.metricsAddTime=(nt,it,rt)=>{},this.metricsLogEvent=(nt,it)=>{}}toAttribute($){return this.toSuffix($).substring(1)}toSuffix($){return $.toLowerCase()===$?`_${$}`:$.toUpperCase()===$?`_${$.toLowerCase()}`:$.replace(/([A-Z][a-z]+)/g,function(_){return`_${_}`}).replace(/([A-Z][A-Z]+)/g,function(_){return`_${_}`}).toLowerCase()}logLatency($,_,tt){const nt=this.toSuffix($);this.logEventTime("meeting"+nt,_,tt)}logStateTimeout($,_){const tt=this.toSuffix($);this.logEvent("meeting_session_state_timeout",Object.assign(Object.assign({},_),{state:`state${tt}`}))}logAudioEvent($,_){const tt="audio"+this.toSuffix(AudioLogEvent_1$1.default[$]);this.logEvent(tt,_)}logVideoEvent($,_){const tt="video"+this.toSuffix(VideoLogEvent_1.default[$]);this.logEvent(tt,_)}logEventTime($,_,tt={}){const nt=Object.assign(Object.assign({},tt),{call_id:this.audioVideoController.configuration.meetingId,client_type:StatsCollector.CLIENT_TYPE,metric_type:"latency"});this.logger.debug(()=>`[StatsCollector] ${$}: ${JSON.stringify(nt)}`),this.metricsAddTime($,_,nt)}logMeetingSessionStatus($){const _=`${$.statusCode()}`;this.logEvent(_);const tt={status:_,status_code:`${$.statusCode()}`};this.logEvent("meeting_session_status",tt),$.isTerminal()&&this.logEvent("meeting_session_stopped",tt),$.isAudioConnectionFailure()&&this.logEvent("meeting_session_audio_failed",tt),$.isFailure()&&this.logEvent("meeting_session_failed",tt)}logLifecycleEvent($,_){const tt={lifecycle_event:`lifecycle${this.toSuffix(MeetingSessionLifecycleEvent_1.default[$])}`,lifecycle_event_code:`${$}`,lifecycle_event_condition:`condition${this.toSuffix(MeetingSessionLifecycleEventCondition_1.default[_])}`,lifecycle_event_condition_code:`${_}`};this.logEvent("meeting_session_lifecycle",tt)}logEvent($,_={}){const tt=Object.assign(Object.assign({},_),{call_id:this.audioVideoController.configuration.meetingId,client_type:StatsCollector.CLIENT_TYPE});this.logger.debug(()=>`[StatsCollector] ${$}: ${JSON.stringify(tt)}`),this.metricsLogEvent($,tt)}start($,_){return this.intervalScheduler?!1:(this.logger.info("Starting StatsCollector"),this.signalingClient=$,this.videoStreamIndex=_,this.clientMetricReport=new ClientMetricReport_1.default(this.logger,this.videoStreamIndex,this.audioVideoController.configuration.credentials.attendeeId),this.intervalScheduler=new IntervalScheduler_1$2.default(this.interval),this.intervalScheduler.start(()=>__awaiter$J(this,void 0,void 0,function*(){yield this.getStatsWrapper()})),!0)}stop(){this.logger.info("Stopping StatsCollector"),this.intervalScheduler&&this.intervalScheduler.stop(),this.intervalScheduler=null}videoTileResolutionDidChange($,_,tt){this.resolutionMap.set($,{width:_,height:tt})}videoTileUnbound($){this.resolutionMap.delete($)}updateMetricValues($,_){const tt=_?this.clientMetricReport.streamMetricReports[Number($.ssrc)]:this.clientMetricReport.globalMetricReport;let nt;if(_){const it=tt.mediaType,rt=tt.direction;nt=this.clientMetricReport.getMetricMap(it,rt),it===ClientMetricReportMediaType_1$2.default.VIDEO&&rt===ClientMetricReportDirection_1$2.default.DOWNSTREAM&&this.addRenderResolutionToVideoDownstreamMetrics(tt,$.ssrc)}else nt=this.clientMetricReport.getMetricMap();for(const it in $)it in nt&&(typeof $[it]=="number"?(tt.previousMetrics[it]=tt.currentMetrics[it],tt.currentMetrics[it]=$[it]):typeof $[it]=="string"?tt.currentStringMetrics[it]=$[it]:typeof $[it]=="object"?(tt.previousObjectMetrics[it]=tt.currentObjectMetrics[it]===void 0?$[it]:tt.currentObjectMetrics[it],tt.currentObjectMetrics[it]=$[it]):this.logger.error(`Unknown metric value type ${typeof $[it]} for metric ${it}`))}processRawMetricReports($){this.clientMetricReport.currentSsrcs={};const _=Date.now();for(const tt of $){if(this.isVideoSourceMetricReport(tt))continue;const nt=this.isStreamRawMetricReport(tt);if(nt){const it=this.clientMetricReport.streamMetricReports[Number(tt.ssrc)];if(it)it.mediaType===ClientMetricReportMediaType_1$2.default.VIDEO&&it.direction===ClientMetricReportDirection_1$2.default.UPSTREAM?it.streamId=this.videoStreamIndex.sendVideoStreamIdFromRid(tt.rid):it.streamId=this.videoStreamIndex.streamIdForSSRC(Number(tt.ssrc));else{const rt=new StreamMetricReport_1.default;rt.mediaType=this.getMediaType(tt),rt.direction=this.getDirectionType(tt),rt.mediaType===ClientMetricReportMediaType_1$2.default.VIDEO&&rt.direction===ClientMetricReportDirection_1$2.default.UPSTREAM?rt.streamId=this.videoStreamIndex.sendVideoStreamIdFromRid(tt.rid):this.videoStreamIndex.allStreams().empty()||(rt.streamId=this.videoStreamIndex.streamIdForSSRC(Number(tt.ssrc)),this.videoStreamIndex.groupIdForSSRC!==void 0&&(rt.groupId=this.videoStreamIndex.groupIdForSSRC(Number(tt.ssrc)))),this.clientMetricReport.streamMetricReports[Number(tt.ssrc)]=rt}this.clientMetricReport.currentSsrcs[Number(tt.ssrc)]=1}this.updateMetricValues(tt,nt)}this.clientMetricReport.removeDestroyedSsrcs(),this.clientMetricReport.previousTimestampMs=this.clientMetricReport.currentTimestampMs,this.clientMetricReport.currentTimestampMs=_,this.clientMetricReport.print()}addStreamMetricDimensionFrames($,_){const tt=this.clientMetricReport.getStreamDimensionMap();for(const nt in _.currentStringMetrics)if(nt in tt){const it=SignalingProtocol_js_1$b.SdkStreamDimension.create();it.type=tt[nt];const rt=SignalingProtocol_js_1$b.SdkDimensionValue.create();rt.stringValue=_.currentStringMetrics[nt],it.value=rt,$.dimensions.push(it)}}addMetricFrame($,_,tt,nt){const it=tt.type,rt=tt.transform,ot=tt.source,lt=_.streamMetricFrames.length,st=_.streamMetricFrames[lt-1];if(it){const at=SignalingProtocol_js_1$b.SdkMetric.create();at.type=it,at.value=rt(ot||$,nt),nt?st.metrics.push(at):_.globalMetrics.push(at)}}addGlobalMetricsToProtobuf($){const _=this.clientMetricReport.getMetricMap();for(const tt in this.clientMetricReport.globalMetricReport.currentMetrics)this.addMetricFrame(tt,$,_[tt])}addStreamMetricsToProtobuf($){for(const _ in this.clientMetricReport.streamMetricReports){const tt=this.clientMetricReport.streamMetricReports[_],nt=SignalingProtocol_js_1$b.SdkStreamMetricFrame.create();nt.streamId=tt.streamId,nt.mediaType=tt.mediaType===ClientMetricReportMediaType_1$2.default.AUDIO?SignalingProtocol_js_1$b.SdkStreamMediaType.AUDIO:SignalingProtocol_js_1$b.SdkStreamMediaType.VIDEO,nt.metrics=[],this.addStreamMetricDimensionFrames(nt,tt),$.streamMetricFrames.push(nt);const it=this.clientMetricReport.getMetricMap(tt.mediaType,tt.direction);for(const rt in it)this.hasMetricDependenciesInReport(rt,tt)&&this.addMetricFrame(rt,$,it[rt],Number(_))}}hasMetricDependenciesInReport($,_){return $==="decoderLoss"&&_.currentMetrics.concealedSamples!==void 0&&_.currentMetrics.totalSamplesReceived!==void 0||$==="jitterBufferMs"&&_.currentMetrics.jitterBufferDelay!==void 0&&_.currentMetrics.jitterBufferEmittedCount!==void 0||$ in _.currentMetrics||$ in _.currentStringMetrics||$ in _.currentObjectMetrics}makeClientMetricProtobuf(){const $=SignalingProtocol_js_1$b.SdkClientMetricFrame.create();return $.globalMetrics=[],$.streamMetricFrames=[],this.addGlobalMetricsToProtobuf($),this.addStreamMetricsToProtobuf($),$}sendClientMetricProtobuf($){this.signalingClient.sendClientMetrics($)}isStreamRawMetricReport($){return["inbound-rtp","inbound-rtp-red","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp"].includes($.type)||this.isVideoSourceMetricReport($)}getMediaType($){return $.kind==="audio"?ClientMetricReportMediaType_1$2.default.AUDIO:ClientMetricReportMediaType_1$2.default.VIDEO}getDirectionType($){const{type:_}=$;return _==="inbound-rtp"||_==="remote-outbound-rtp"||_==="inbound-rtp-red"?ClientMetricReportDirection_1$2.default.DOWNSTREAM:ClientMetricReportDirection_1$2.default.UPSTREAM}isValidStandardRawMetric($){return $.type==="inbound-rtp"||$.type==="inbound-rtp-red"||$.type==="outbound-rtp"||$.type==="remote-inbound-rtp"||$.type==="remote-outbound-rtp"||$.type==="candidate-pair"&&$.state==="succeeded"||$.type==="media-source"}isValidSsrc($){let _=!0;return this.isStreamRawMetricReport($)&&this.getDirectionType($)===ClientMetricReportDirection_1$2.default.DOWNSTREAM&&this.getMediaType($)===ClientMetricReportMediaType_1$2.default.VIDEO&&(_=this.videoStreamIndex.streamIdForSSRC(Number($.ssrc))>0),_}isValidRawMetricReport($){return this.isValidStandardRawMetric($)&&this.isValidSsrc($)}filterRawMetricReports($){const _=[];for(const tt of $)this.isValidRawMetricReport(tt)&&_.push(tt);return _}handleRawMetricReports($){const _=this.filterRawMetricReports($);this.logger.debug(()=>`Filtered raw metrics : ${JSON.stringify(_)}`);const tt=[];this.maybeAddRedRecoveryMetrics(tt);const nt=this.getVideoUpstreamSsrcFromRawMetricReports(_);nt!==null&&this.addVideoCodecDegradationMetrics(tt,nt),this.clientMetricReport.customStatsReports=tt,_.push(...tt),this.processRawMetricReports(_),this.updateVideoSourceMetrics(_);const it=this.makeClientMetricProtobuf();this.sendClientMetricProtobuf(it),this.audioVideoController.forEachObserver(rt=>{Types_1$5.Maybe.of(rt.metricsDidReceive).map(ot=>ot.bind(rt)(this.clientMetricReport.clone()))})}getStatsWrapper(){return __awaiter$J(this,void 0,void 0,function*(){if(!this.audioVideoController.rtcPeerConnection)return;const $=[];try{const _=yield this.audioVideoController.rtcPeerConnection.getStats();this.clientMetricReport.rtcStatsReport=_,_.forEach(tt=>{$.push(tt)}),this.handleRawMetricReports($)}catch(_){this.logger.error(_.message)}})}overrideObservableMetric($,_){this.clientMetricReport.overrideObservableMetric($,_)}recoveryMetricsDidReceive($){this.redRecoveryMetricReport=$}maybeAddRedRecoveryMetrics($){this.redRecoveryMetricReport.currentTimestampMs!==this.lastRedRecoveryMetricReportConsumedTimestampMs&&($.push({kind:"audio",type:"inbound-rtp-red",ssrc:this.redRecoveryMetricReport.ssrc,timestamp:this.redRecoveryMetricReport.currentTimestampMs,totalAudioPacketsLost:this.redRecoveryMetricReport.totalAudioPacketsLost,totalAudioPacketsExpected:this.redRecoveryMetricReport.totalAudioPacketsExpected,totalAudioPacketsRecoveredRed:this.redRecoveryMetricReport.totalAudioPacketsRecoveredRed,totalAudioPacketsRecoveredFec:this.redRecoveryMetricReport.totalAudioPacketsRecoveredFec}),this.lastRedRecoveryMetricReportConsumedTimestampMs=this.redRecoveryMetricReport.currentTimestampMs)}videoCodecDegradationHighEncodeCpuDidReceive(){this.videoCodecDegradationHighEncodeCpuCount+=1}videoCodecDegradationEncodeFailureDidReceive(){this.videoCodecDegradationEncodeFailureCount+=1}videoCodecDegradationConcurrentSendersDidReceive(){this.videoCodecDegradationConcurrentSendersCount+=1}addVideoCodecDegradationMetrics($,_){$.push({kind:"video",type:"outbound-rtp",ssrc:_,timestamp:Date.now(),videoCodecDegradationHighEncodeCpu:this.videoCodecDegradationHighEncodeCpuCount,videoCodecDegradationEncodeFailure:this.videoCodecDegradationEncodeFailureCount,videoCodecDegradationConcurrentSenders:this.videoCodecDegradationConcurrentSendersCount}),this.videoCodecDegradationHighEncodeCpuCount=0,this.videoCodecDegradationEncodeFailureCount=0,this.videoCodecDegradationConcurrentSendersCount=0}getVideoUpstreamSsrcFromRawMetricReports($){for(const _ of $)if(this.isStreamRawMetricReport(_)&&this.getMediaType(_)===ClientMetricReportMediaType_1$2.default.VIDEO&&this.getDirectionType(_)===ClientMetricReportDirection_1$2.default.UPSTREAM)return _.ssrc;return null}isVideoSourceMetricReport($){return $.type==="media-source"&&$.kind==="video"}addRenderResolutionToVideoDownstreamMetrics($,_){const tt=this.videoStreamIndex.streamIdForSSRC(Number(_)),nt=this.videoStreamIndex.attendeeIdForStreamId(tt);if(tt===void 0||nt===""){this.logger.warn(`No attendee found for ssrc ${_}`);return}this.resolutionMap.has(nt)&&($.currentMetrics.videoRenderWidth=this.resolutionMap.get(nt).width,$.currentMetrics.videoRenderHeight=this.resolutionMap.get(nt).height)}updateVideoSourceMetrics($){for(const _ of $)if(this.isVideoSourceMetricReport(_)){const tt=this.clientMetricReport.getVideoUpstreamSsrcs();if(tt.length===0){this.logger.warn("No video upstream ssrcs found");return}for(const nt of tt)this.clientMetricReport.streamMetricReports[nt].currentMetrics.videoInputWidth=_.width,this.clientMetricReport.streamMetricReports[nt].currentMetrics.videoInputHeight=_.height}}}StatsCollector$1.default=StatsCollector;StatsCollector.INTERVAL_MS=1e3;StatsCollector.CLIENT_TYPE="amazon-chime-sdk-js";var FinishGatheringICECandidatesTask$1={},__awaiter$I=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$$=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(FinishGatheringICECandidatesTask$1,"__esModule",{value:!0});const MeetingSessionStatusCode_1$4=__importDefault$$(MeetingSessionStatusCode),SDP_1$3=__importDefault$$(SDP$1),BaseTask_1$j=__importDefault$$(BaseTask$1);class FinishGatheringICECandidatesTask extends BaseTask_1$j.default{constructor($,_=FinishGatheringICECandidatesTask.CHROME_VPN_TIMEOUT_MS){super($.logger),this.context=$,this.chromeVpnTimeoutMs=_,this.taskName="FinishGatheringICECandidatesTask"}removeEventListener(){this.context.peer&&(this.context.peer.removeEventListener("icecandidate",this.context.iceCandidateHandler),this.context.turnCredentials||this.context.peer.removeEventListener("icegatheringstatechange",this.context.iceGatheringStateEventHandler))}cancel(){let $;this.context.browserBehavior.requiresIceCandidateGatheringTimeoutWorkaround()&&this.chromeVpnTimeoutMs<this.context.meetingSessionConfiguration.connectionTimeoutMs&&Date.now()-this.startTimestampMs>this.chromeVpnTimeoutMs&&($=new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1$4.default.ICEGatheringTimeoutWorkaround}`)),this.cancelPromise&&($=$||new Error(`canceling ${this.name()}`),this.cancelPromise($),delete this.cancelPromise)}run(){return __awaiter$I(this,void 0,void 0,function*(){if(this.context.peer||this.logAndThrow("session does not have peer connection; bypass ice gathering"),this.context.browserBehavior.requiresCheckForSdpConnectionAttributes()){if(new SDP_1$3.default(this.context.peer.localDescription.sdp).hasCandidatesForAllMLines()){this.context.logger.info(`ice gathering already complete; bypass gathering, current local description ${this.context.peer.localDescription.sdp}`);return}}else this.context.logger.info(`iOS device does not require checking for connection attributes in SDP, current local description ${this.context.peer.localDescription.sdp}`);if((this.context.browserBehavior.hasFirefoxWebRTC()||this.context.peer.iceGatheringState==="complete")&&new SDP_1$3.default(this.context.peer.localDescription.sdp).hasCandidates()){this.context.logger.info("ice gathering state is complete and candidates are in SDP; bypass gathering");return}try{yield new Promise(($,_)=>{this.cancelPromise=tt=>{this.removeEventListener(),_(tt)},this.context.turnCredentials||(this.context.iceGatheringStateEventHandler=()=>{if(this.context.peer.iceGatheringState==="complete"){this.removeEventListener(),$(),delete this.cancelPromise;return}},this.context.peer.addEventListener("icegatheringstatechange",this.context.iceGatheringStateEventHandler)),this.context.iceCandidateHandler=tt=>{if(this.context.logger.info(`ice candidate: ${tt.candidate?tt.candidate.candidate:"(null)"} state: ${this.context.peer.iceGatheringState}`),tt.candidate&&(SDP_1$3.default.isRTPCandidate(tt.candidate.candidate)&&this.context.iceCandidates.push(tt.candidate),this.context.turnCredentials&&this.context.iceCandidates.length>=1)){this.context.logger.info("gathered at least one relay candidate"),this.removeEventListener(),$(),delete this.cancelPromise;return}this.context.peer.iceGatheringState==="complete"&&(this.context.logger.info("done gathering ice candidates"),this.removeEventListener(),!new SDP_1$3.default(this.context.peer.localDescription.sdp).hasCandidates()||this.context.iceCandidates.length===0?(_(new Error("no ice candidates were gathered")),delete this.cancelPromise):($(),delete this.cancelPromise))},this.context.peer.addEventListener("icecandidate",this.context.iceCandidateHandler),this.startTimestampMs=Date.now()})}catch($){throw $}finally{this.startTimestampMs&&(this.context.iceGatheringDurationMs=Math.round(Date.now()-this.startTimestampMs))}})}}FinishGatheringICECandidatesTask$1.default=FinishGatheringICECandidatesTask;FinishGatheringICECandidatesTask.CHROME_VPN_TIMEOUT_MS=5e3;var JoinAndReceiveIndexTask$1={},MeetingSessionTURNCredentials$1={};Object.defineProperty(MeetingSessionTURNCredentials$1,"__esModule",{value:!0});class MeetingSessionTURNCredentials{constructor(){this.username=null,this.password=null,this.ttl=null,this.uris=null}}MeetingSessionTURNCredentials$1.default=MeetingSessionTURNCredentials;var SignalingClientJoin$1={},__importDefault$_=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(SignalingClientJoin$1,"__esModule",{value:!0});const ServerSideNetworkAdaption_1$5=__importDefault$_(ServerSideNetworkAdaption);class SignalingClientJoin{constructor($){this.applicationMetadata=$,this.serverSideNetworkAdaption=ServerSideNetworkAdaption_1$5.default.Default,this.supportedServerSideNetworkAdaptions=[],this.wantsAllTemporalLayersInIndex=!1,this.disablePeriodicKeyframeRequestOnContentSender=!1}}SignalingClientJoin$1.default=SignalingClientJoin;var __createBinding$1=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(et,$,_,tt){tt===void 0&&(tt=_),Object.defineProperty(et,tt,{enumerable:!0,get:function(){return $[_]}})}:function(et,$,_,tt){tt===void 0&&(tt=_),et[tt]=$[_]}),__setModuleDefault$1=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(et,$){Object.defineProperty(et,"default",{enumerable:!0,value:$})}:function(et,$){et.default=$}),__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(et){if(et&&et.__esModule)return et;var $={};if(et!=null)for(var _ in et)_!=="default"&&Object.prototype.hasOwnProperty.call(et,_)&&__createBinding$1($,et,_);return __setModuleDefault$1($,et),$},__awaiter$H=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$Z=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(JoinAndReceiveIndexTask$1,"__esModule",{value:!0});const MeetingSessionStatus_1$2=__importDefault$Z(MeetingSessionStatus$1),MeetingSessionStatusCode_1$3=__importDefault$Z(MeetingSessionStatusCode),MeetingSessionTURNCredentials_1=__importDefault$Z(MeetingSessionTURNCredentials$1),ServerSideNetworkAdaption_1$4=__importStar$1(ServerSideNetworkAdaption),SignalingClientEventType_1$8=__importDefault$Z(SignalingClientEventType),SignalingClientJoin_1=__importDefault$Z(SignalingClientJoin$1),SignalingProtocol_js_1$a=SignalingProtocol,BaseTask_1$i=__importDefault$Z(BaseTask$1);class JoinAndReceiveIndexTask extends BaseTask_1$i.default{constructor($){super($.logger),this.context=$,this.taskName="JoinAndReceiveIndexTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$H(this,void 0,void 0,function*(){const $=yield new Promise((_,tt)=>{const nt=this.context;nt.turnCredentials=null;class it{constructor(st){this.signalingClient=st}cancel(){this.signalingClient.removeObserver(this),tt(new Error("JoinAndReceiveIndexTask got canceled while waiting for SdkIndexFrame"))}handleSignalingClientEvent(st){if(st.type===SignalingClientEventType_1$8.default.WebSocketClosed){let ct=`The signaling connection was closed with code ${st.closeCode} and reason: ${st.closeReason}`;nt.logger.warn(ct);let dt=MeetingSessionStatusCode_1$3.default.SignalingBadRequest;st.closeCode===4410?(ct="The meeting already ended.",nt.logger.warn(ct),dt=MeetingSessionStatusCode_1$3.default.MeetingEnded):st.closeCode>=4500&&st.closeCode<4600&&(dt=MeetingSessionStatusCode_1$3.default.SignalingInternalServerError),nt.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1$2.default(dt),new Error(ct));return}if(st.type!==SignalingClientEventType_1$8.default.ReceivedSignalFrame)return;if(st.message.type===SignalingProtocol_js_1$a.SdkSignalFrame.Type.JOIN_ACK){const ct=st.message.joinack;if(!ct){nt.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1$2.default(MeetingSessionStatusCode_1$3.default.SignalingRequestFailed),new Error("Join ACK message did not include expected frame"));return}if(ct.videoSubscriptionLimit&&(nt.videoSubscriptionLimit=ct.videoSubscriptionLimit),nt.serverSupportsCompression=ct.wantsCompressedSdp,ct.defaultServerSideNetworkAdaption!==void 0&&ct.defaultServerSideNetworkAdaption!==ServerSideNetworkAdaption_1$4.default.Default&&nt.videoDownlinkBandwidthPolicy.setServerSideNetworkAdaption!==void 0){const dt=ct.defaultServerSideNetworkAdaption;nt.logger.info(`Overriding server side network adaption value to ${dt}`),nt.videoDownlinkBandwidthPolicy.setServerSideNetworkAdaption(ServerSideNetworkAdaption_1$4.convertServerSideNetworkAdaptionEnumFromSignaled(dt))}ct&&ct.turnCredentials?(nt.turnCredentials=new MeetingSessionTURNCredentials_1.default,nt.turnCredentials.username=ct.turnCredentials.username,nt.turnCredentials.password=ct.turnCredentials.password,nt.turnCredentials.ttl=ct.turnCredentials.ttl,nt.turnCredentials.uris=ct.turnCredentials.uris.map(dt=>nt.meetingSessionConfiguration.urls.urlRewriter(dt)).filter(dt=>!!dt)):nt.logger.error("missing TURN credentials in JoinAckFrame");return}if(st.message.type!==SignalingProtocol_js_1$a.SdkSignalFrame.Type.INDEX)return;this.signalingClient.removeObserver(this);const at=st.message.index;_(at)}}const rt=new it(this.context.signalingClient);this.context.signalingClient.registerObserver(rt),this.taskCanceler=rt,this.context.previousSdpAnswerAsString="",this.context.previousSdpOffer=null,this.context.serverSupportsCompression=!1;const ot=new SignalingClientJoin_1.default(this.context.meetingSessionConfiguration.applicationMetadata);this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption!==void 0&&this.context.videoDownlinkBandwidthPolicy.supportedServerSideNetworkAdaptions!==void 0&&(ot.serverSideNetworkAdaption=this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption(),ot.supportedServerSideNetworkAdaptions=this.context.videoDownlinkBandwidthPolicy.supportedServerSideNetworkAdaptions()),this.context.videoDownlinkBandwidthPolicy.wantsAllTemporalLayersInIndex!==void 0&&(ot.wantsAllTemporalLayersInIndex=this.context.videoDownlinkBandwidthPolicy.wantsAllTemporalLayersInIndex()),ot.disablePeriodicKeyframeRequestOnContentSender=this.context.meetingSessionConfiguration.disablePeriodicKeyframeRequestOnContentSender,this.context.signalingClient.join(ot)});this.context.logger.info(`received first index ${JSON.stringify($)}`),this.context.indexFrame=$})}}JoinAndReceiveIndexTask$1.default=JoinAndReceiveIndexTask;var LeaveAndReceiveLeaveAckTask$1={},__awaiter$G=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$Y=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(LeaveAndReceiveLeaveAckTask$1,"__esModule",{value:!0});const SignalingClientEventType_1$7=__importDefault$Y(SignalingClientEventType),SignalingProtocol_js_1$9=SignalingProtocol,BaseTask_1$h=__importDefault$Y(BaseTask$1);class LeaveAndReceiveLeaveAckTask extends BaseTask_1$h.default{constructor($){super($.logger),this.context=$,this.taskName="LeaveAndReceiveLeaveAckTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$G(this,void 0,void 0,function*(){this.context.signalingClient.ready()&&(this.context.signalingClient.leave(),this.context.logger.info("sent leave"),yield this.receiveLeaveAck())})}receiveLeaveAck(){return new Promise(($,_)=>{class tt{constructor(rt,ot){this.signalingClient=rt,this.logger=ot}cancel(){this.signalingClient.removeObserver(this),_(new Error("LeaveAndReceiveLeaveAckTask got canceled while waiting for IndexFrame"))}handleSignalingClientEvent(rt){if(rt.isConnectionTerminated()){this.signalingClient.removeObserver(this),this.logger.info("LeaveAndReceiveLeaveAckTask connection terminated"),$();return}rt.type===SignalingClientEventType_1$7.default.ReceivedSignalFrame&&rt.message.type===SignalingProtocol_js_1$9.SdkSignalFrame.Type.LEAVE_ACK&&(this.signalingClient.removeObserver(this),this.logger.info("got leave ack"),$())}}const nt=new tt(this.context.signalingClient,this.context.logger);this.taskCanceler=nt,this.context.signalingClient.registerObserver(nt)})}}LeaveAndReceiveLeaveAckTask$1.default=LeaveAndReceiveLeaveAckTask;var ListenForVolumeIndicatorsTask$1={},__awaiter$F=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$X=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(ListenForVolumeIndicatorsTask$1,"__esModule",{value:!0});const SignalingClientEventType_1$6=__importDefault$X(SignalingClientEventType),SignalingProtocol_js_1$8=SignalingProtocol,BaseTask_1$g=__importDefault$X(BaseTask$1);class ListenForVolumeIndicatorsTask extends BaseTask_1$g.default{constructor($){super($.logger),this.context=$,this.taskName="ListenForVolumeIndicatorsTask",this.realtimeMuteAndUnmuteHandler=_=>{this.context.signalingClient.mute(_)}}run(){return __awaiter$F(this,void 0,void 0,function*(){this.context.removableObservers.push(this),this.context.signalingClient.registerObserver(this),this.context.realtimeController.realtimeSubscribeToMuteAndUnmuteLocalAudio(this.realtimeMuteAndUnmuteHandler)})}removeObserver(){this.context.realtimeController.realtimeUnsubscribeToMuteAndUnmuteLocalAudio(this.realtimeMuteAndUnmuteHandler),this.context.signalingClient.removeObserver(this)}handleSignalingClientEvent($){if($.type===SignalingClientEventType_1$6.default.ReceivedSignalFrame){if($.message.type===SignalingProtocol_js_1$8.SdkSignalFrame.Type.AUDIO_STREAM_ID_INFO){const _=$.message.audioStreamIdInfo;this.context.volumeIndicatorAdapter.sendRealtimeUpdatesForAudioStreamIdInfo(_)}else if($.message.type===SignalingProtocol_js_1$8.SdkSignalFrame.Type.AUDIO_METADATA){const _=$.message.audioMetadata;this.context.volumeIndicatorAdapter.sendRealtimeUpdatesForAudioMetadata(_)}}}}ListenForVolumeIndicatorsTask$1.default=ListenForVolumeIndicatorsTask;var MonitorTask$1={},ReconnectionHealthPolicy$1={},__importDefault$W=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(ReconnectionHealthPolicy$1,"__esModule",{value:!0});const BaseConnectionHealthPolicy_1$2=__importDefault$W(BaseConnectionHealthPolicy$1);class ReconnectionHealthPolicy extends BaseConnectionHealthPolicy_1$2.default{constructor($,_,tt){super(_,tt,"Reconnection Health"),this.logger=$,this.audioDelayPointsOverMaximum=0,ReconnectionHealthPolicy.CONNECTION_UNHEALTHY_THRESHOLD=_.connectionUnhealthyThreshold,ReconnectionHealthPolicy.CONNECTION_WAIT_TIME_MS=_.connectionWaitTimeMs,ReconnectionHealthPolicy.MISSED_PONGS_THRESHOLD=_.missedPongsUpperThreshold,ReconnectionHealthPolicy.MAXIMUM_AUDIO_DELAY_MS=_.maximumAudioDelayMs,ReconnectionHealthPolicy.MAXIMUM_AUDIO_DELAY_DATA_POINTS=_.maximumAudioDelayDataPoints}health(){if(this.currentData.isConnectionStartRecent(ReconnectionHealthPolicy.CONNECTION_WAIT_TIME_MS))return 1;const _=this.currentData.consecutiveStatsWithNoPackets>=ReconnectionHealthPolicy.CONNECTION_UNHEALTHY_THRESHOLD,tt=this.currentData.consecutiveMissedPongs>=ReconnectionHealthPolicy.MISSED_PONGS_THRESHOLD;this.currentData.audioSpeakerDelayMs>ReconnectionHealthPolicy.MAXIMUM_AUDIO_DELAY_MS?this.audioDelayPointsOverMaximum+=1:this.audioDelayPointsOverMaximum=0;const nt=this.audioDelayPointsOverMaximum>ReconnectionHealthPolicy.MAXIMUM_AUDIO_DELAY_DATA_POINTS;return nt&&(this.audioDelayPointsOverMaximum=0),_||tt||nt?(this.logger.warn(`reconnection recommended due to: no packets received: ${_}, missed pongs: ${tt}, bad audio delay: ${nt}`),0):1}}ReconnectionHealthPolicy$1.default=ReconnectionHealthPolicy;var SendingAudioFailureConnectionHealthPolicy$1={},__importDefault$V=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(SendingAudioFailureConnectionHealthPolicy$1,"__esModule",{value:!0});const BaseConnectionHealthPolicy_1$1=__importDefault$V(BaseConnectionHealthPolicy$1);class SendingAudioFailureConnectionHealthPolicy extends BaseConnectionHealthPolicy_1$1.default{constructor($,_,tt){super(_,tt,"Sending Audio Health"),this.logger=$,this.sendingAudioFailureSamplesToConsider=_.sendingAudioFailureSamplesToConsider>0?_.sendingAudioFailureSamplesToConsider:1,this.sendingAudioFailureInitialWaitTimeMs=_.sendingAudioFailureInitialWaitTimeMs,this.maximumTimesToWarn=_.maximumTimesToWarn,this.coolDownTimeMs=_.cooldownTimeMs,this.lastWarnTimestampMs=0,this.warnCount=0}isSendingAudioUnhealthy(){const $=!this.currentData.isConnectionStartRecent(this.sendingAudioFailureInitialWaitTimeMs),_=this.currentData.consecutiveStatsWithNoAudioPacketsSent>=this.sendingAudioFailureSamplesToConsider;return $&&_}health(){if(this.isSendingAudioUnhealthy()){const $=Date.now()-this.lastWarnTimestampMs<this.coolDownTimeMs;return this.currentHealth>this.minimumHealth()&&!$?(this.logger.warn(`Sending Audio is unhealthy for ${this.sendingAudioFailureSamplesToConsider} seconds consecutively.`),this.warnCount++,this.warnCount>this.maximumTimesToWarn?(this.logger.warn("SendingAudioFailure health policy maximum warnings breached. Falling back to reporting healthy."),this.maximumHealth()):(this.lastWarnTimestampMs=Date.now(),this.minimumHealth())):this.currentHealth}return this.maximumHealth()}}SendingAudioFailureConnectionHealthPolicy$1.default=SendingAudioFailureConnectionHealthPolicy;var UnusableAudioWarningConnectionHealthPolicy$1={},__importDefault$U=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(UnusableAudioWarningConnectionHealthPolicy$1,"__esModule",{value:!0});const BaseConnectionHealthPolicy_1=__importDefault$U(BaseConnectionHealthPolicy$1);class UnusableAudioWarningConnectionHealthPolicy extends BaseConnectionHealthPolicy_1.default{constructor($,_){super($,_,"Unusable Audio Warning"),this.coolDownTimeMs=$.cooldownTimeMs,this.pastSamplesToConsider=$.pastSamplesToConsider,this.fractionalLoss=$.fractionalLoss,this.packetsExpected=$.packetsExpected,this.maximumTimesToWarn=$.maximumTimesToWarn,this.lastWarnTimestampMs=0,this.warnCount=0}calculateFractionalLoss(){if(this.currentData.packetsReceivedInLastMinute.length<this.pastSamplesToConsider)return 0;const $=this.pastSamplesToConsider,_=$*this.packetsExpected;let tt=0;for(let nt=0;nt<$;nt++)tt+=this.currentData.packetsReceivedInLastMinute[nt];return Math.min(Math.max(1-tt/_,0),1)}health(){return Date.now()-this.lastWarnTimestampMs<this.coolDownTimeMs?this.currentHealth:this.calculateFractionalLoss()>=this.fractionalLoss?this.currentHealth!==0&&(this.lastWarnTimestampMs=Date.now(),this.warnCount++,this.warnCount>this.maximumTimesToWarn)?1:0:1}}UnusableAudioWarningConnectionHealthPolicy$1.default=UnusableAudioWarningConnectionHealthPolicy;var __awaiter$E=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$T=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(MonitorTask$1,"__esModule",{value:!0});const ClientMetricReportDirection_1$1=__importDefault$T(ClientMetricReportDirection),ClientMetricReportMediaType_1$1=__importDefault$T(ClientMetricReportMediaType),ReconnectionHealthPolicy_1=__importDefault$T(ReconnectionHealthPolicy$1),SendingAudioFailureConnectionHealthPolicy_1=__importDefault$T(SendingAudioFailureConnectionHealthPolicy$1),UnusableAudioWarningConnectionHealthPolicy_1=__importDefault$T(UnusableAudioWarningConnectionHealthPolicy$1),VideoEncodingConnectionHealthPolicyName_1=__importDefault$T(VideoEncodingConnectionHealthPolicyName),MeetingSessionStatus_1$1=__importDefault$T(MeetingSessionStatus$1),MeetingSessionStatusCode_1$2=__importDefault$T(MeetingSessionStatusCode),VideoCodecCapability_1$2=__importDefault$T(VideoCodecCapability$1),SignalingClientEventType_1$5=__importDefault$T(SignalingClientEventType),SignalingProtocol_1=SignalingProtocol,AudioLogEvent_1=__importDefault$T(AudioLogEvent),Types_1$4=Types,BaseTask_1$f=__importDefault$T(BaseTask$1);class MonitorTask extends BaseTask_1$f.default{constructor($,_,tt){super($.logger),this.context=$,this.initialConnectionHealthData=tt,this.taskName="MonitorTask",this.prevSignalStrength=1,this.currentAvailableStreamAvgBitrates=null,this.hasSignalingError=!1,this.presenceHandlerCalled=!1,this.isResubscribeCheckPaused=!1,this.pendingMetricsReport=void 0,this.videoEncodingHealthPolicies=[],this.checkAndSendWeakSignalEvent=nt=>{const it=nt<1,rt=this.prevSignalStrength<1,ot=it?rt?null:AudioLogEvent_1.default.RedmicStartLoss:rt?AudioLogEvent_1.default.RedmicEndLoss:null;ot&&this.context.statsCollector.logAudioEvent(ot),this.prevSignalStrength=nt},this.realtimeFatalErrorCallback=nt=>{this.logger.error(`realtime error: ${nt}: ${nt.stack}`),this.context.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1$1.default(MeetingSessionStatusCode_1$2.default.RealtimeApiFailed),nt)},this.realtimeAttendeeIdPresenceHandler=(nt,it)=>{var rt;const ot=this.context.meetingSessionConfiguration.credentials.attendeeId;this.logger.info(`attendeePresenceReceived: ${ot}`),ot===nt&&it&&!this.presenceHandlerCalled&&(this.presenceHandlerCalled=!0,this.context.attendeePresenceDurationMs=Date.now()-this.context.startAudioVideoTimestamp,(rt=this.context.eventController)===null||rt===void 0||rt.publishEvent("attendeePresenceReceived",{attendeePresenceDurationMs:this.context.attendeePresenceDurationMs}))},this.generateBaseAudioVideoEventAttributes=()=>{const{signalingOpenDurationMs:nt,startTimeMs:it,iceGatheringDurationMs:rt,attendeePresenceDurationMs:ot,meetingStartDurationMs:lt}=this.context;return{meetingDurationMs:it===null?0:Math.round(Date.now()-it),signalingOpenDurationMs:nt,iceGatheringDurationMs:rt,attendeePresenceDurationMs:ot,meetingStartDurationMs:lt}},this.generateAudioVideoEventAttributesForReceivingAudioDropped=()=>{const nt=this.generateBaseAudioVideoEventAttributes();return Object.assign(Object.assign({},nt),{maxVideoTileCount:this.context.maxVideoTileCount,poorConnectionCount:this.context.poorConnectionCount})},this.reconnectionHealthPolicy=new ReconnectionHealthPolicy_1.default($.logger,Object.assign({},_),this.initialConnectionHealthData.clone()),this.unusableAudioWarningHealthPolicy=new UnusableAudioWarningConnectionHealthPolicy_1.default(Object.assign({},_),this.initialConnectionHealthData.clone()),this.sendingAudioFailureHealthPolicy=new SendingAudioFailureConnectionHealthPolicy_1.default($.logger,Object.assign({},_),this.initialConnectionHealthData.clone());for(const nt of _.videoEncodingHealthPolicies)this.videoEncodingHealthPolicies.push(new nt(Object.assign({},_),this.initialConnectionHealthData.clone()))}removeObserver(){this.context.audioVideoController.removeObserver(this),this.context.realtimeController.realtimeUnsubscribeToFatalError(this.realtimeFatalErrorCallback),this.context.realtimeController.realtimeUnsubscribeToLocalSignalStrengthChange(this.checkAndSendWeakSignalEvent),this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(this.realtimeAttendeeIdPresenceHandler),this.context.signalingClient.removeObserver(this)}run(){return __awaiter$E(this,void 0,void 0,function*(){this.context.removableObservers.push(this),this.context.audioVideoController.addObserver(this),this.context.realtimeController.realtimeSubscribeToFatalError(this.realtimeFatalErrorCallback),this.context.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(this.checkAndSendWeakSignalEvent),this.context.realtimeController.realtimeSubscribeToAttendeeIdPresence(this.realtimeAttendeeIdPresenceHandler),this.context.connectionMonitor.start(),this.context.statsCollector.start(this.context.signalingClient,this.context.videoStreamIndex),this.context.signalingClient.registerObserver(this)})}pauseResubscribeCheck(){this.isResubscribeCheckPaused=!0}resumeResubscribeCheck(){this.isResubscribeCheckPaused&&(this.isResubscribeCheckPaused=!1,this.pendingMetricsReport&&(this.context.logger.info("Resuming resubscribe check with pending metrics report"),this.checkResubscribe(this.pendingMetricsReport)&&this.context.audioVideoController.update({needsRenegotiation:!1})))}videoTileDidUpdate($){this.context.maxVideoTileCount=Math.max(this.context.maxVideoTileCount,this.context.videoTileController.getAllVideoTiles().length)}checkResubscribe($){if(this.isResubscribeCheckPaused){this.context.logger.info("Resubscribe check is paused, setting incoming client metric report as pending"),this.pendingMetricsReport=$;return}else this.pendingMetricsReport=void 0;const _=$.getObservableMetrics(),tt=_.availableOutgoingBitrate,nt=_.nackCountReceivedPerSecond;let it=!1;this.context.videoDownlinkBandwidthPolicy.updateMetrics($);const rt=this.context.videoDownlinkBandwidthPolicy.wantsResubscribe();if(it=it||rt,rt){const ot=this.context.videoDownlinkBandwidthPolicy.chooseSubscriptions();this.context.videosToReceive=ot.truncate(this.context.videoSubscriptionLimit),ot.size()>this.context.videosToReceive.size()&&this.logger.warn(`Video receive limit exceeded. Limiting the videos to ${this.context.videosToReceive.size()}. Please consider using AllHighestVideoBandwidthPolicy or VideoPriorityBasedPolicy along with chooseRemoteVideoSources api to select the video sources to be displayed.`),this.logger.info(`trigger resubscribe for down=${rt}; videosToReceive=[${this.context.videosToReceive.array()}]`)}if(this.context.videoTileController.hasStartedLocalVideoTile()){this.context.videoUplinkBandwidthPolicy.updateConnectionMetric({uplinkKbps:tt/1e3,nackCountPerSecond:nt});const ot=this.context.videoUplinkBandwidthPolicy.wantsResubscribe();it=it||ot,ot&&(this.logger.info(`trigger resubscribe for up=${ot}; videosToReceive=[${this.context.videosToReceive.array()}]`),this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters())}return it}metricsDidReceive($){if(this.checkResubscribe($)&&this.context.audioVideoController.update({needsRenegotiation:!1}),!this.currentAvailableStreamAvgBitrates)return;const _=$.streamMetricReports,tt=new Map;for(const nt in _)_[nt].mediaType===ClientMetricReportMediaType_1$1.default.VIDEO&&_[nt].direction===ClientMetricReportDirection_1$1.default.DOWNSTREAM&&tt.set(_[nt].streamId,_[nt])}connectionHealthDidChange($){$.consecutiveMissedPongs===0&&this.context.reconnectController&&this.context.reconnectController.setLastActiveTimestampMs(Date.now()),this.applyHealthPolicy(this.reconnectionHealthPolicy,$,()=>{this.context.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1$1.default(MeetingSessionStatusCode_1$2.default.ConnectionHealthReconnect),null)}),this.applyHealthPolicy(this.unusableAudioWarningHealthPolicy,$,()=>{var _;this.context.poorConnectionCount+=1;const tt=this.generateAudioVideoEventAttributesForReceivingAudioDropped();(_=this.context.eventController)===null||_===void 0||_.publishEvent("receivingAudioDropped",tt),this.context.videoTileController.haveVideoTilesWithStreams()?this.context.audioVideoController.forEachObserver(nt=>{Types_1$4.Maybe.of(nt.connectionDidSuggestStopVideo).map(it=>it.bind(nt)())}):this.context.audioVideoController.forEachObserver(nt=>{Types_1$4.Maybe.of(nt.connectionDidBecomePoor).map(it=>it.bind(nt)())})},()=>{this.context.audioVideoController.forEachObserver(_=>{Types_1$4.Maybe.of(_.connectionDidBecomeGood).map(tt=>tt.bind(_)())})});for(const _ of this.videoEncodingHealthPolicies)this.applyHealthPolicy(_,$,()=>{switch(this.degradeVideoCodec(_.name),_.name){case VideoEncodingConnectionHealthPolicyName_1.default.VideoEncodingCpuHealth:this.context.statsCollector.videoCodecDegradationHighEncodeCpuDidReceive();break;case VideoEncodingConnectionHealthPolicyName_1.default.VideoEncodingFramerateHealth:this.context.statsCollector.videoCodecDegradationEncodeFailureDidReceive();break;case VideoEncodingConnectionHealthPolicyName_1.default.VideoConcurrentSendersHealth:this.context.statsCollector.videoCodecDegradationConcurrentSendersDidReceive();break}});this.context.isSessionConnected&&this.applyHealthPolicy(this.sendingAudioFailureHealthPolicy,$,()=>{var _;const tt=this.generateBaseAudioVideoEventAttributes();(_=this.context.eventController)===null||_===void 0||_.publishEvent("sendingAudioFailed",tt)},()=>{var _;const tt=this.generateBaseAudioVideoEventAttributes();(_=this.context.eventController)===null||_===void 0||_.publishEvent("sendingAudioRecovered",tt)})}applyHealthPolicy($,_,tt,nt){$.update(_);const it=$.healthIfChanged();it!==null&&(this.logger.info(`${$.name} value is now ${it}`),it<=$.minimumHealth()?Types_1$4.Maybe.of(tt).map(rt=>rt.bind(this)()):Types_1$4.Maybe.of(nt).map(rt=>rt.bind(this)()))}handleBitrateFrame($){this.currentAvailableStreamAvgBitrates=$,$.serverAvailableOutgoingBitrate>0&&(this.logger.info(`Received server side estimation of available incoming bitrate ${$.serverAvailableOutgoingBitrate}kbps`),this.context.statsCollector.overrideObservableMetric("availableIncomingBitrate",$.serverAvailableOutgoingBitrate*1e3))}handleSignalingClientEvent($){var _;if($.type===SignalingClientEventType_1$5.default.WebSocketClosed&&this.isUnexpectedWebsocketCloseCode($.closeCode)||$.type===SignalingClientEventType_1$5.default.WebSocketError||$.type===SignalingClientEventType_1$5.default.WebSocketFailed){if($.type===SignalingClientEventType_1$5.default.WebSocketClosed&&this.context.logger.info(`The signaling connection was closed with code ${$.closeCode} and reason: ${$.closeReason}`),!this.hasSignalingError){const tt=this.generateAudioVideoEventAttributesForReceivingAudioDropped();(_=this.context.eventController)===null||_===void 0||_.publishEvent("signalingDropped",tt),this.hasSignalingError=!0}this.context.isSessionConnected&&this.context.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1$1.default(this.isInternalServerFailureCloseCode($.closeCode)?MeetingSessionStatusCode_1$2.default.SignalingInternalServerError:MeetingSessionStatusCode_1$2.default.SignalingChannelClosedUnexpectedly),null)}else $.type===SignalingClientEventType_1$5.default.WebSocketOpen&&(this.hasSignalingError=!1);if($.type===SignalingClientEventType_1$5.default.ReceivedSignalFrame){if($.message.type===SignalingProtocol_1.SdkSignalFrame.Type.NOTIFICATION){switch($.message.notification.level){case SignalingProtocol_1.SdkNotificationFrame.NotificationLevel.INFO:this.logger.info(`Received notification from server: ${$.message.notification.message}`);break;case SignalingProtocol_1.SdkNotificationFrame.NotificationLevel.WARNING:this.logger.warn(`Received warning from server: ${$.message.notification.message}`);break;case SignalingProtocol_1.SdkNotificationFrame.NotificationLevel.ERROR:this.logger.error(`Received error from server: ${$.message.notification.message}`);break;default:this.logger.error(`Received notification from server with unknown level ${$.message.notification.level}: ${$.message.notification.message}`);break}return}if($.message.bitrates){const nt=$.message.bitrates;this.context.videoStreamIndex.integrateBitratesFrame(nt),this.context.videoDownlinkBandwidthPolicy.updateIndex(this.context.videoStreamIndex),this.handleBitrateFrame($.message.bitrates)}const tt=MeetingSessionStatus_1$1.default.fromSignalFrame($.message);$.message.type!==SignalingProtocol_1.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN_ACK&&tt.statusCode()!==MeetingSessionStatusCode_1$2.default.OK&&this.context.audioVideoController.handleMeetingSessionStatus(tt,null)}}isUnexpectedWebsocketCloseCode($){return $===1006||this.isInternalServerFailureCloseCode($)}isInternalServerFailureCloseCode($){return $>=4500&&$<4600}degradeVideoCodec($){if(this.context.meetingSupportedVideoSendCodecPreferences!==void 0&&this.context.meetingSupportedVideoSendCodecPreferences.length>1&&!(this.context.meetingSupportedVideoSendCodecPreferences[0].equals(VideoCodecCapability_1$2.default.h264ConstrainedBaselineProfile())||this.context.meetingSupportedVideoSendCodecPreferences[0].equals(VideoCodecCapability_1$2.default.vp8()))){const _=[];for(const tt of this.context.videoSendCodecPreferences)tt.equals(this.context.meetingSupportedVideoSendCodecPreferences[0])||_.push(tt);_.length>0?(this.context.logger.info(`Downgrading codec from ${this.context.meetingSupportedVideoSendCodecPreferences[0].codecName} to ${_[0].codecName} due to ${$}`),this.context.degradedVideoSendCodecs.push(this.context.meetingSupportedVideoSendCodecPreferences[0]),this.context.meetingSupportedVideoSendCodecPreferences=_,this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs&&this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs(this.context.meetingSupportedVideoSendCodecPreferences,this.context.videoSendCodecPreferences),this.context.audioVideoController.update({needsRenegotiation:!0})):this.context.logger.warn(`Degrading video codec failed since there is no alternative codec to select. Currently degraded codecs: ${this.context.degradedVideoSendCodecs.map(tt=>tt.codecName).join(",")}`)}}}MonitorTask$1.default=MonitorTask;var OpenSignalingConnectionTask$1={},SignalingClientConnectionRequest$1={};Object.defineProperty(SignalingClientConnectionRequest$1,"__esModule",{value:!0});class SignalingClientConnectionRequest{constructor($,_){this.signalingURL=$,this.joinToken=_}url(){return this.signalingURL+"?X-Chime-Control-Protocol-Version=3&X-Amzn-Chime-Send-Close-On-Error=1"}protocols(){return["_aws_wt_session",this.joinToken]}}SignalingClientConnectionRequest$1.default=SignalingClientConnectionRequest;var __awaiter$D=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$S=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(OpenSignalingConnectionTask$1,"__esModule",{value:!0});const SignalingClientConnectionRequest_1=__importDefault$S(SignalingClientConnectionRequest$1),SignalingClientEventType_1$4=__importDefault$S(SignalingClientEventType),BaseTask_1$e=__importDefault$S(BaseTask$1);class OpenSignalingConnectionTask extends BaseTask_1$e.default{constructor($){super($.logger),this.context=$,this.taskName="OpenSignalingConnectionTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$D(this,void 0,void 0,function*(){const $=this.context.meetingSessionConfiguration;this.context.signalingClient.openConnection(new SignalingClientConnectionRequest_1.default($.urls.signalingURL,$.credentials.joinToken));const _=Date.now();try{yield new Promise((tt,nt)=>{class it{constructor(lt){this.signalingClient=lt}cancel(){this.signalingClient.removeObserver(this),nt(new Error("OpenSignalingConnectionTask got canceled while waiting to open signaling connection"))}handleSignalingClientEvent(lt){switch(lt.type){case SignalingClientEventType_1$4.default.WebSocketOpen:this.signalingClient.removeObserver(this),tt();break;case SignalingClientEventType_1$4.default.WebSocketFailed:this.signalingClient.removeObserver(this),nt(new Error("WebSocket connection failed"));break}}}const rt=new it(this.context.signalingClient);this.context.signalingClient.registerObserver(rt),this.taskCanceler=rt})}catch(tt){throw tt}finally{this.context.signalingOpenDurationMs=Math.round(Date.now()-_),this.logger.info(`Opening signaling connection took ${this.context.signalingOpenDurationMs} ms`)}})}}OpenSignalingConnectionTask$1.default=OpenSignalingConnectionTask;var ParallelGroupTask$1={},__awaiter$C=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$R=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(ParallelGroupTask$1,"__esModule",{value:!0});const BaseTask_1$d=__importDefault$R(BaseTask$1);class ParallelGroupTask extends BaseTask_1$d.default{constructor($,_,tt){super($),this.taskName=_,this.tasksToRunParallel=tt;for(const nt of tt)nt.setParent(this)}cancel(){for(const $ of this.tasksToRunParallel)this.logger.info(`canceling parallel group task ${this.name()} subtask ${$.name()}`),$.cancel()}run(){return __awaiter$C(this,void 0,void 0,function*(){const $=[];for(const tt of this.tasksToRunParallel)this.logger.info(`parallel group task ${this.name()} running subtask ${tt.name()}`),$.push(tt.run());const _=[];for(let tt=0;tt<$.length;tt++){try{yield $[tt]}catch(nt){_.push(`task ${this.tasksToRunParallel[tt].name()} failed: ${nt.message}`)}this.logger.info(`parallel group task ${this.name()} completed subtask ${this.tasksToRunParallel[tt].name()}`)}if(_.length>0){const tt=_.join(", ");this.logAndThrow(`parallel group task ${this.name()} failed for tasks: ${tt}`)}this.logger.info(`parallel group task ${this.name()} completed`)})}}ParallelGroupTask$1.default=ParallelGroupTask;var PromoteToPrimaryMeetingTask={},hasRequiredPromoteToPrimaryMeetingTask;function requirePromoteToPrimaryMeetingTask(){if(hasRequiredPromoteToPrimaryMeetingTask)return PromoteToPrimaryMeetingTask;hasRequiredPromoteToPrimaryMeetingTask=1;var et=commonjsGlobal&&commonjsGlobal.__awaiter||function(ot,lt,st,at){function ct(dt){return dt instanceof st?dt:new st(function(ut){ut(dt)})}return new(st||(st=Promise))(function(dt,ut){function ft(gt){try{St(at.next(gt))}catch(yt){ut(yt)}}function pt(gt){try{St(at.throw(gt))}catch(yt){ut(yt)}}function St(gt){gt.done?dt(gt.value):ct(gt.value).then(ft,pt)}St((at=at.apply(ot,lt||[])).next())})},$=commonjsGlobal&&commonjsGlobal.__importDefault||function(ot){return ot&&ot.__esModule?ot:{default:ot}};Object.defineProperty(PromoteToPrimaryMeetingTask,"__esModule",{value:!0});const _=requireBuild(),tt=$(SignalingClientEventType),nt=SignalingProtocol,it=$(BaseTask$1);let rt=class extends it.default{constructor(lt,st,at){super(lt.logger),this.context=lt,this.credentials=st,this.completionCallback=at,this.taskName="PromoteToPrimaryMeetingTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return et(this,void 0,void 0,function*(){this.context.signalingClient.ready()?(this.context.signalingClient.promoteToPrimaryMeeting(this.credentials),this.context.logger.info("Sent request to join primary meeting"),yield this.receivePrimaryMeetingJoinAck()):this.completionCallback(new _.MeetingSessionStatus(_.MeetingSessionStatusCode.SignalingRequestFailed))})}receivePrimaryMeetingJoinAck(){return new Promise((lt,st)=>{class at{constructor(ut,ft,pt){this.signalingClient=ut,this.completionCallback=ft,this.logger=pt}cancel(){this.signalingClient.removeObserver(this),this.completionCallback(new _.MeetingSessionStatus(_.MeetingSessionStatusCode.SignalingRequestFailed)),lt()}handleSignalingClientEvent(ut){ut.isConnectionTerminated()&&(this.signalingClient.removeObserver(this),this.logger.info("PromoteToPrimaryMeetingTask connection terminated"),this.completionCallback(new _.MeetingSessionStatus(_.MeetingSessionStatusCode.SignalingRequestFailed)),lt()),ut.type===tt.default.ReceivedSignalFrame&&ut.message.type===nt.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN_ACK&&(this.signalingClient.removeObserver(this),this.logger.info("Got a primary meeting join ACK"),this.completionCallback(_.MeetingSessionStatus.fromSignalFrame(ut.message)),lt())}}const ct=new at(this.context.signalingClient,this.completionCallback,this.context.logger);this.taskCanceler=ct,this.context.signalingClient.registerObserver(ct)})}};return PromoteToPrimaryMeetingTask.default=rt,PromoteToPrimaryMeetingTask}var ReceiveAudioInputTask$1={},__awaiter$B=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$Q=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(ReceiveAudioInputTask$1,"__esModule",{value:!0});const BaseTask_1$c=__importDefault$Q(BaseTask$1);class ReceiveAudioInputTask extends BaseTask_1$c.default{constructor($){super($.logger),this.context=$,this.taskName="ReceiveAudioInputTask"}run(){var $,_;return __awaiter$B(this,void 0,void 0,function*(){if(!(!((_=($=this.context.meetingSessionConfiguration)===null||$===void 0?void 0:$.urls)===null||_===void 0)&&_.audioHostURL)){this.context.logger.info("No audio connection: not acquiring audio input");return}if(this.context.activeAudioInput){this.context.logger.info("an active audio input exists");return}let tt;try{tt=yield this.context.mediaStreamBroker.acquireAudioInputStream()}catch{this.context.logger.warn("could not acquire audio input from current device")}tt?this.context.activeAudioInput=tt:this.context.logger.warn("an audio input is not available")})}}ReceiveAudioInputTask$1.default=ReceiveAudioInputTask;var ReceiveRemoteVideoPauseResumeTask={},__awaiter$A=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$P=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(ReceiveRemoteVideoPauseResumeTask,"__esModule",{value:!0});const SignalingClientEventType_1$3=__importDefault$P(SignalingClientEventType),SignalingProtocol_js_1$7=SignalingProtocol,BaseTask_1$b=__importDefault$P(BaseTask$1);class ReceiveRemoteVideoPauseResume extends BaseTask_1$b.default{constructor($){super($.logger),this.context=$,this.taskName="ReceiveRemoteVideoPauseResume",this.serverPausedVideoTileIds=new Set}removeObserver(){this.context.signalingClient.removeObserver(this)}run(){return __awaiter$A(this,void 0,void 0,function*(){this.context.signalingClient.registerObserver(this),this.context.removableObservers.push(this)})}updateSubscribedGroupdIds($){const _=new Set;for(const tt of $){const nt=this.context.videoStreamIndex.attendeeIdForGroupId(tt);if(nt.length===0){this.logger.warn(`Could not find attendee ID for newly subscribed group ID ${tt}`);continue}let it=this.context.videoTileController.getVideoTileForAttendeeId(nt);it===void 0&&(this.logger.info(`No existing video tile for attendee ID ${nt} with new group ID ${tt}. Creating new one.`),it=this.context.videoTileController.addVideoTile(),it.bindVideoStream(nt,!1,null,0,0,0,null)),_.add(it.id())}this.serverPausedVideoTileIds.forEach(tt=>{_.has(tt)||this.serverPausedVideoTileIds.delete(tt)})}handleSignalingClientEvent($){if($.type!==SignalingClientEventType_1$3.default.ReceivedSignalFrame||$.message.type!==SignalingProtocol_js_1$7.SdkSignalFrame.Type.PAUSE&&$.message.type!==SignalingProtocol_js_1$7.SdkSignalFrame.Type.RESUME)return;const _=$.message.pause,tt=$.message.type;if(this.logger.info(`Received new ${tt===SignalingProtocol_js_1$7.SdkSignalFrame.Type.PAUSE?"pause":"resume"} frame: ${JSON.stringify(_)}`),!_||this.context.videoTileController.getVideoTileForAttendeeId===void 0||this.context.videoDownlinkBandwidthPolicy.forEachObserver===void 0||this.context.videoStreamIndex.attendeeIdForGroupId===void 0)return;const nt=_.groupIds.map(it=>{const rt=this.context.videoStreamIndex.attendeeIdForGroupId(it);if(rt.length===0){this.logger.warn(`Could not find attendee ID for paused group ID ${it}`);return}return this.context.videoTileController.getVideoTileForAttendeeId(rt)});for(const it of nt)it!==void 0&&(tt===SignalingProtocol_js_1$7.SdkSignalFrame.Type.PAUSE?it.state().paused||(this.serverPausedVideoTileIds.add(it.id()),this.context.videoDownlinkBandwidthPolicy.forEachObserver(rt=>{rt.tileWillBePausedByDownlinkPolicy(it.id())}),it.pause()):it.state().paused&&this.serverPausedVideoTileIds.has(it.id())&&(this.serverPausedVideoTileIds.delete(it.id()),this.context.videoDownlinkBandwidthPolicy.forEachObserver(rt=>{rt.tileWillBeUnpausedByDownlinkPolicy(it.id())}),it.unpause()))}}ReceiveRemoteVideoPauseResumeTask.default=ReceiveRemoteVideoPauseResume;var ReceiveVideoInputTask$1={},__awaiter$z=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$O=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(ReceiveVideoInputTask$1,"__esModule",{value:!0});const DefaultModality_1$3=__importDefault$O(DefaultModality$1),SignalingProtocol_js_1$6=SignalingProtocol,BaseTask_1$a=__importDefault$O(BaseTask$1);class ReceiveVideoInputTask extends BaseTask_1$a.default{constructor($){super($.logger),this.context=$,this.taskName="ReceiveVideoInputTask"}checkAndApplyVideoConstraint($,_,tt,nt,it){return __awaiter$z(this,void 0,void 0,function*(){const rt=$?this.context.meetingSessionConfiguration.meetingFeatures.contentMaxResolution:this.context.meetingSessionConfiguration.meetingFeatures.videoMaxResolution;if(!$&&tt<=rt.videoWidth&&nt<=rt.videoHeight&&it<=rt.videoFrameRate)return;const ot={resizeMode:{ideal:"none"},width:{max:rt.videoWidth},height:{max:rt.videoHeight},frameRate:{ideal:it,max:rt.videoFrameRate}};try{yield _.applyConstraints(ot)}catch{this.context.logger.info(`Could not apply constraint for video track (content = ${$})`)}})}run(){return __awaiter$z(this,void 0,void 0,function*(){const $=this.context.videoDuplexMode===SignalingProtocol_js_1$6.SdkStreamServiceType.RX||this.context.videoDuplexMode===SignalingProtocol_js_1$6.SdkStreamServiceType.DUPLEX;if(this.context.videoTileController.hasStartedLocalVideoTile()?this.context.videoDuplexMode=$?SignalingProtocol_js_1$6.SdkStreamServiceType.DUPLEX:SignalingProtocol_js_1$6.SdkStreamServiceType.TX:this.context.videoDuplexMode=$?SignalingProtocol_js_1$6.SdkStreamServiceType.RX:0,this.context.videoCaptureAndEncodeParameter=this.context.videoUplinkBandwidthPolicy.chooseCaptureAndEncodeParameters(),!this.context.videoTileController.hasStartedLocalVideoTile()){this.context.logger.info("has not started local video tile"),this.context.activeVideoInput&&(this.context.activeVideoInput=void 0,this.context.videoStreamIndex.integrateUplinkPolicyDecision([]));return}const _=this.context.videoTileController.getLocalVideoTile();let tt;try{tt=yield this.context.mediaStreamBroker.acquireVideoInputStream()}catch{this.context.logger.warn("could not acquire video input from current device"),this.context.videoTileController.stopLocalVideoTile()}if(this.context.enableSimulcast){const nt=this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters();this.context.videoStreamIndex.integrateUplinkPolicyDecision(Array.from(nt.values()))}if(this.context.activeVideoInput=tt,tt){const nt=tt.getVideoTracks();if(!nt||nt.length===0)return;const it=this.context.meetingSessionConfiguration.credentials.attendeeId,rt=new DefaultModality_1$3.default(it).hasModality(DefaultModality_1$3.default.MODALITY_CONTENT),ot=nt[0].getSettings();this.checkAndApplyVideoConstraint(rt,nt[0],ot.width,ot.height,ot.frameRate);const lt=this.context.audioVideoController.configuration.credentials.externalUserId;_.bindVideoStream(it,!0,tt,ot.width,ot.height,null,lt);for(const st of nt)this.logger.info(`Using video device label=${st.label} id=${st.id}`),this.context.videoDeviceInformation.current_camera_name=st.label,this.context.videoDeviceInformation.current_camera_id=st.id}})}}ReceiveVideoInputTask$1.default=ReceiveVideoInputTask;var ReceiveVideoStreamIndexTask$1={},__awaiter$y=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$N=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(ReceiveVideoStreamIndexTask$1,"__esModule",{value:!0});const MeetingSessionVideoAvailability_1=__importDefault$N(MeetingSessionVideoAvailability$1),DefaultModality_1$2=__importDefault$N(DefaultModality$1),VideoCodecCapability_1$1=__importDefault$N(VideoCodecCapability$1),SignalingClientEventType_1$2=__importDefault$N(SignalingClientEventType),SignalingProtocol_js_1$5=SignalingProtocol,Types_1$3=Types,BaseTask_1$9=__importDefault$N(BaseTask$1);class ReceiveVideoStreamIndexTask extends BaseTask_1$9.default{constructor($){super($.logger),this.context=$,this.taskName="ReceiveVideoStreamIndexTask",this.isIngestionPaused=!1,this.pendingIndex=null}removeObserver(){this.context.signalingClient.removeObserver(this)}run(){return __awaiter$y(this,void 0,void 0,function*(){this.handleIndexFrame(this.context.indexFrame),this.context.signalingClient.registerObserver(this),this.context.removableObservers.push(this)})}handleSignalingClientEvent($){if($.type!==SignalingClientEventType_1$2.default.ReceivedSignalFrame||$.message.type!==SignalingProtocol_js_1$5.SdkSignalFrame.Type.INDEX)return;const _=$.message.index;this.context.logger.info(`received new index ${JSON.stringify(_)}`),this.handleIndexFrame(_)}pauseIngestion(){this.isIngestionPaused=!0}resumeIngestion(){this.isIngestionPaused&&(this.isIngestionPaused=!1,this.pendingIndex&&(this.context.logger.info("Resuming index ingestion with pending index"),this.handleIndexFrame(this.pendingIndex)))}handleIndexFrame($){if(!$)return;if(this.isIngestionPaused){this.context.logger.info("Index ingestion is paused, setting most recent index as pending"),this.pendingIndex=$;return}else this.pendingIndex=null;const _=this.context.audioVideoController.configuration.credentials.attendeeId;$.sources=$.sources.filter(lt=>{const st=new DefaultModality_1$2.default(lt.attendeeId);return!(st.base()===_&&st.hasModality(DefaultModality_1$2.default.MODALITY_CONTENT))});const{videoStreamIndex:tt,videoDownlinkBandwidthPolicy:nt,videoUplinkBandwidthPolicy:it}=this.context,rt=tt.allVideoSendingSourcesExcludingSelf(_);tt.integrateIndexFrame($),nt.updateIndex(tt),it.updateIndex(tt),this.resubscribe(nt,it),this.updateVideoAvailability($),this.handleIndexVideosPausedAtSource(),$.supportedReceiveCodecIntersection.length>0&&this.handleSupportedVideoReceiveCodecIntersection($);const ot=tt.allVideoSendingSourcesExcludingSelf(_);this.areVideoSourcesEqual(rt,ot)||this.context.audioVideoController.forEachObserver(lt=>{Types_1$3.Maybe.of(lt.remoteVideoSourcesDidChange).map(st=>st.bind(lt)(ot))})}areVideoSourcesEqual($,_){if($.length!==_.length)return!1;const tt=(rt,ot)=>rt.attendee.attendeeId.localeCompare(ot.attendee.attendeeId),nt=[...$].sort(tt),it=[..._].sort(tt);for(let rt=0;rt<nt.length;rt++)if(nt[rt].attendee.attendeeId!==it[rt].attendee.attendeeId)return!1;return!0}resubscribe($,_){const tt=$.wantsResubscribe(),nt=(this.context.videoDuplexMode===SignalingProtocol_js_1$5.SdkStreamServiceType.TX||this.context.videoDuplexMode===SignalingProtocol_js_1$5.SdkStreamServiceType.DUPLEX)&&_.wantsResubscribe(),it=tt||nt;if(this.logger.info(`should resubscribe: ${it} (downlink: ${tt} uplink: ${nt})`),!it)return;const rt=$.chooseSubscriptions();this.context.videosToReceive=rt.truncate(this.context.videoSubscriptionLimit),rt.size()>this.context.videosToReceive.size()&&this.logger.warn(`Video receive limit exceeded. Limiting the videos to ${this.context.videosToReceive.size()}. Please consider using AllHighestVideoBandwidthPolicy or VideoPriorityBasedPolicy along with chooseRemoteVideoSources api to select the video sources to be displayed.`),this.context.videoCaptureAndEncodeParameter=_.chooseCaptureAndEncodeParameters(),this.logger.info(`trigger resubscribe for up=${nt} down=${tt}; videosToReceive=[${this.context.videosToReceive.array()}] captureParams=${JSON.stringify(this.context.videoCaptureAndEncodeParameter)}`),this.context.audioVideoController.update({needsRenegotiation:!1})}updateVideoAvailability($){if(!this.context.videosToReceive){this.logger.error("videosToReceive must be set in the meeting context.");return}const _=new MeetingSessionVideoAvailability_1.default;_.remoteVideoAvailable=!this.context.videosToReceive.empty(),_.canStartLocalVideo=!$.atCapacity,(!this.context.lastKnownVideoAvailability||!this.context.lastKnownVideoAvailability.equal(_))&&(this.context.lastKnownVideoAvailability=_.clone(),this.context.audioVideoController.forEachObserver(tt=>{Types_1$3.Maybe.of(tt.videoAvailabilityDidChange).map(nt=>nt.bind(tt)(_.clone()))}))}handleSupportedVideoReceiveCodecIntersection($){if(this.context.videoSendCodecPreferences===void 0)return;const _=[];let tt=!1;for(const nt of this.context.videoSendCodecPreferences){if(this.context.degradedVideoSendCodecs.some(it=>nt.equals(it))){this.logger.info(`Skipping ${nt.codecName} since the codec has been identfied as degraded`);continue}for(const it of $.supportedReceiveCodecIntersection)if(nt.equals(VideoCodecCapability_1$1.default.fromSignaled(it))){_.push(nt);break}}if(_.length>0){const nt=_.find(it=>this.context.prioritizedSendVideoCodecCapabilities.some(rt=>it.equals(rt)));this.context.currentVideoSendCodec!==void 0&&(nt===void 0||!this.context.currentVideoSendCodec.equals(nt))&&(tt=!0),this.context.meetingSupportedVideoSendCodecPreferences=_}else this.logger.warn("Interesection of meeting receive codec support and send codec preferences has no overlap, falling back to just values provided in `setVideoCodecSendPreferences`"),this.context.meetingSupportedVideoSendCodecPreferences=void 0;this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs&&this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs(this.context.meetingSupportedVideoSendCodecPreferences,this.context.videoSendCodecPreferences),tt&&this.context.audioVideoController.update({needsRenegotiation:!0})}handleIndexVideosPausedAtSource(){const $=this.context.videoStreamIndex.streamsPausedAtSource();for(const _ of this.context.videoTileController.getAllVideoTiles()){const tt=_.state();$.contain(tt.streamId)?_.markPoorConnection()&&this.logger.info(`marks the tile ${tt.tileId} as having a poor connection`):_.unmarkPoorConnection()&&this.logger.info(`unmarks the tile ${tt.tileId} as having a poor connection`)}}}ReceiveVideoStreamIndexTask$1.default=ReceiveVideoStreamIndexTask;var SendAndReceiveDataMessagesTask$1={},__awaiter$x=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$M=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(SendAndReceiveDataMessagesTask$1,"__esModule",{value:!0});const DataMessage_1=__importDefault$M(DataMessage$1),SignalingClientEventType_1$1=__importDefault$M(SignalingClientEventType),SignalingProtocol_js_1$4=SignalingProtocol,BaseTask_1$8=__importDefault$M(BaseTask$1);class SendAndReceiveDataMessagesTask extends BaseTask_1$8.default{constructor($){super($.logger),this.context=$,this.taskName="SendAndReceiveDataMessagesTask",this.sendDataMessageHandler=(_,tt,nt)=>{if(this.context.signalingClient.ready()){let it;tt instanceof Uint8Array?it=tt:typeof tt=="string"?it=new TextEncoder().encode(tt):it=new TextEncoder().encode(JSON.stringify(tt)),this.validateDataMessage(_,it,nt);const rt=SignalingProtocol_js_1$4.SdkDataMessagePayload.create();rt.topic=_,rt.lifetimeMs=nt,rt.data=it;const ot=SignalingProtocol_js_1$4.SdkDataMessageFrame.create();ot.messages=[rt],this.context.signalingClient.sendDataMessage(ot)}else this.context.logger.error("Cannot send data message because signaling client is not ready")}}run(){return __awaiter$x(this,void 0,void 0,function*(){this.context.removableObservers.push(this),this.context.signalingClient.registerObserver(this),this.context.realtimeController.realtimeSubscribeToSendDataMessage(this.sendDataMessageHandler)})}removeObserver(){this.context.realtimeController.realtimeUnsubscribeFromSendDataMessage(this.sendDataMessageHandler),this.context.signalingClient.removeObserver(this)}handleSignalingClientEvent($){if($.type===SignalingClientEventType_1$1.default.ReceivedSignalFrame&&$.message.type===SignalingProtocol_js_1$4.SdkSignalFrame.Type.DATA_MESSAGE)for(const _ of $.message.dataMessage.messages){const tt=new DataMessage_1.default(_.ingestTimeNs/1e6,_.topic,_.data,_.senderAttendeeId,_.senderExternalUserId,_.ingestTimeNs===0);this.context.realtimeController.realtimeReceiveDataMessage(tt)}}validateDataMessage($,_,tt){if(!SendAndReceiveDataMessagesTask.TOPIC_REGEX.test($))throw new Error("Invalid topic");if(_.length>SendAndReceiveDataMessagesTask.DATA_SIZE)throw new Error("Data size has to be less than 2048 bytes");if(tt&&tt<0)throw new Error("The life time of the message has to be non negative")}}SendAndReceiveDataMessagesTask$1.default=SendAndReceiveDataMessagesTask;SendAndReceiveDataMessagesTask.TOPIC_REGEX=new RegExp(/^[a-zA-Z0-9_-]{1,36}$/);SendAndReceiveDataMessagesTask.DATA_SIZE=2048;var SerialGroupTask$1={},__awaiter$w=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$L=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(SerialGroupTask$1,"__esModule",{value:!0});const BaseTask_1$7=__importDefault$L(BaseTask$1),TaskStatus_1=__importDefault$L(TaskStatus$1);class SerialGroupTask extends BaseTask_1$7.default{constructor($,_,tt){super($),this.taskName=_,this.tasksToRunSerially=tt,this.currentTask=null;for(const nt of tt)nt.setParent(this)}cancel(){this.currentTask&&(this.logger.info(`canceling serial group task ${this.name()} subtask ${this.currentTask.name()}`),this.currentTask.cancel())}run(){return __awaiter$w(this,void 0,void 0,function*(){for(const $ of this.tasksToRunSerially){this.getStatus()===TaskStatus_1.default.CANCELED&&this.logAndThrow(`serial group task ${this.name()} was canceled`);try{this.logger.info(`serial group task ${this.name()} running subtask ${$.name()}`),this.currentTask=$,yield $.run(),this.logger.info(`serial group task ${this.name()} completed subtask ${$.name()}`)}catch(_){this.logAndThrow(`serial group task ${this.name()} was canceled due to subtask ${this.currentTask.name()} error: ${_.message}`)}finally{this.currentTask=null}}this.logger.info(`serial group task ${this.name()} completed`)})}}SerialGroupTask$1.default=SerialGroupTask;var SetLocalDescriptionTask$1={},__awaiter$v=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$K=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(SetLocalDescriptionTask$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$3=__importDefault$K(DefaultBrowserBehavior$1),SDP_1$2=__importDefault$K(SDP$1),BaseTask_1$6=__importDefault$K(BaseTask$1);class SetLocalDescriptionTask extends BaseTask_1$6.default{constructor($){super($.logger),this.context=$,this.taskName="SetLocalDescriptionTask"}cancel(){if(this.cancelPromise){const $=new Error(`canceling ${this.name()}`);this.cancelPromise($),delete this.cancelPromise}}run(){return __awaiter$v(this,void 0,void 0,function*(){const $=this.context.peer;let tt=this.context.sdpOfferInit.sdp;if(this.context.browserBehavior.supportsVideoLayersAllocationRtpHeaderExtension()&&(tt=new SDP_1$2.default(tt).withVideoLayersAllocationRtpHeaderExtension(this.context.previousSdpOffer).sdp),this.context.browserBehavior.supportsDependencyDescriptorRtpHeaderExtension()&&this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension!==void 0&&this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension()&&(tt=new SDP_1$2.default(tt).withDependencyDescriptorRtpHeaderExtension(this.context.previousSdpOffer).sdp),new DefaultBrowserBehavior_1$3.default().requiresDisablingH264Encoding()&&(tt=new SDP_1$2.default(tt).removeH264SupportFromSendSection().sdp),tt=new SDP_1$2.default(tt).withStartingVideoSendBitrate(1e3).sdp,this.context.videoSendCodecPreferences!==void 0&&this.context.videoSendCodecPreferences.length>0&&(tt=new SDP_1$2.default(tt).withVideoSendCodecPreferences(this.context.meetingSupportedVideoSendCodecPreferences!==void 0?this.context.meetingSupportedVideoSendCodecPreferences:this.context.videoSendCodecPreferences).sdp),this.context.audioProfile&&(tt=new SDP_1$2.default(tt).withAudioMaxAverageBitrate(this.context.audioProfile.audioBitrateBps).sdp,this.context.audioProfile.isStereo()&&(tt=new SDP_1$2.default(tt).withStereoAudio().sdp),this.context.audioProfile.hasRedundancyEnabled())){const it=new SDP_1$2.default(tt).getAudioPayloadTypes();this.context.transceiverController&&this.context.transceiverController.setAudioPayloadTypes&&this.context.transceiverController.setAudioPayloadTypes(it)}this.logger.debug(()=>`local description is >>>${tt}<<<`);const nt={type:"offer",sdp:tt,toJSON:null};yield new Promise((it,rt)=>__awaiter$v(this,void 0,void 0,function*(){this.cancelPromise=ot=>{rt(ot)};try{yield $.setLocalDescription(nt),it()}catch(ot){rt(ot)}finally{delete this.cancelPromise}})),this.context.logger.info("set local description")})}}SetLocalDescriptionTask$1.default=SetLocalDescriptionTask;var SetRemoteDescriptionTask$1={},__awaiter$u=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$J=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(SetRemoteDescriptionTask$1,"__esModule",{value:!0});const DefaultModality_1$1=__importDefault$J(DefaultModality$1),SDP_1$1=__importDefault$J(SDP$1),VideoCodecCapability_1=__importDefault$J(VideoCodecCapability$1),BaseTask_1$5=__importDefault$J(BaseTask$1);class SetRemoteDescriptionTask extends BaseTask_1$5.default{constructor($){super($.logger),this.context=$,this.taskName="SetRemoteDescriptionTask"}cancel(){this.cancelICEPromise&&this.cancelICEPromise()}run(){var $;return __awaiter$u(this,void 0,void 0,function*(){this.context.peer||this.logAndThrow("session does not have peer connection; bypass set remote description");let tt=this.context.sdpAnswer;tt=new SDP_1$1.default(tt).withoutServerReflexiveCandidates().sdp,this.context.audioProfile&&(tt=new SDP_1$1.default(tt).withAudioMaxAverageBitrate(this.context.audioProfile.audioBitrateBps).sdp,this.context.audioProfile.isStereo()&&(tt=new SDP_1$1.default(tt).withStereoAudio().sdp)),this.context.videoSendCodecPreferences!==void 0&&this.context.videoSendCodecPreferences.length>0&&(tt=new SDP_1$1.default(tt).withVideoSendCodecPreferences(this.context.meetingSupportedVideoSendCodecPreferences!==void 0?this.context.meetingSupportedVideoSendCodecPreferences:this.context.videoSendCodecPreferences).sdp),this.context.prioritizedSendVideoCodecCapabilities=new SDP_1$1.default(tt).prioritizedSendVideoCodecCapabilities(),this.context.currentVideoSendCodec=this.context.prioritizedSendVideoCodecCapabilities.length>0?this.context.prioritizedSendVideoCodecCapabilities[0]:void 0;const nt=this.context.activeVideoInput;if(nt!==void 0){const rt=this.context.audioVideoController.configuration.credentials.attendeeId,ot=new DefaultModality_1$1.default(rt).hasModality(DefaultModality_1$1.default.MODALITY_CONTENT),lt=nt.getVideoTracks()[0];ot&&((($=this.context.currentVideoSendCodec)===null||$===void 0?void 0:$.codecName)===VideoCodecCapability_1.default.av1Main().codecName?(lt.contentHint="text",this.logger.info(`Setting content hint to text for AV1, attendee: ${rt}`)):this.context.audioVideoController.configuration.enableSVC&&(lt.contentHint="motion",this.logger.info(`Setting content hint to motion to enable SVC, attendee: ${rt}`)))}this.logger.info(`processed remote description is >>>${tt}<<<`);const it={type:"answer",sdp:tt,toJSON:null};try{yield this.createICEConnectionCompletedPromise(it)}catch(rt){throw rt}})}createICEConnectionCompletedPromise($){return new Promise((_,tt)=>__awaiter$u(this,void 0,void 0,function*(){const nt=()=>{(this.context.peer.iceConnectionState==="connected"||this.context.peer.iceConnectionState==="completed")&&(this.context.peer.removeEventListener("iceconnectionstatechange",nt),_())};this.cancelICEPromise=()=>{this.context.peer&&this.context.peer.removeEventListener("iceconnectionstatechange",nt),tt(new Error(`${this.name()} got canceled while waiting for the ICE connection state`))},this.context.peer.addEventListener("iceconnectionstatechange",nt);try{yield this.context.peer.setRemoteDescription($),this.logger.info("set remote description, waiting for ICE connection"),nt()}catch(it){tt(it)}}))}}SetRemoteDescriptionTask$1.default=SetRemoteDescriptionTask;var SubscribeAndReceiveSubscribeAckTask$1={},ZLIBTextCompressor$1={},pako$1={},deflate$4={},deflate$3={},trees={};const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(et){let $=et.length;for(;--$>=0;)et[$]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(et,$,_,tt,nt){this.static_tree=et,this.extra_bits=$,this.extra_base=_,this.elems=tt,this.max_length=nt,this.has_stree=et&&et.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(et,$){this.dyn_tree=et,this.max_code=0,this.stat_desc=$}const d_code=et=>et<256?_dist_code[et]:_dist_code[256+(et>>>7)],put_short=(et,$)=>{et.pending_buf[et.pending++]=$&255,et.pending_buf[et.pending++]=$>>>8&255},send_bits=(et,$,_)=>{et.bi_valid>Buf_size-_?(et.bi_buf|=$<<et.bi_valid&65535,put_short(et,et.bi_buf),et.bi_buf=$>>Buf_size-et.bi_valid,et.bi_valid+=_-Buf_size):(et.bi_buf|=$<<et.bi_valid&65535,et.bi_valid+=_)},send_code=(et,$,_)=>{send_bits(et,_[$*2],_[$*2+1])},bi_reverse=(et,$)=>{let _=0;do _|=et&1,et>>>=1,_<<=1;while(--$>0);return _>>>1},bi_flush=et=>{et.bi_valid===16?(put_short(et,et.bi_buf),et.bi_buf=0,et.bi_valid=0):et.bi_valid>=8&&(et.pending_buf[et.pending++]=et.bi_buf&255,et.bi_buf>>=8,et.bi_valid-=8)},gen_bitlen=(et,$)=>{const _=$.dyn_tree,tt=$.max_code,nt=$.stat_desc.static_tree,it=$.stat_desc.has_stree,rt=$.stat_desc.extra_bits,ot=$.stat_desc.extra_base,lt=$.stat_desc.max_length;let st,at,ct,dt,ut,ft,pt=0;for(dt=0;dt<=MAX_BITS$1;dt++)et.bl_count[dt]=0;for(_[et.heap[et.heap_max]*2+1]=0,st=et.heap_max+1;st<HEAP_SIZE$1;st++)at=et.heap[st],dt=_[_[at*2+1]*2+1]+1,dt>lt&&(dt=lt,pt++),_[at*2+1]=dt,!(at>tt)&&(et.bl_count[dt]++,ut=0,at>=ot&&(ut=rt[at-ot]),ft=_[at*2],et.opt_len+=ft*(dt+ut),it&&(et.static_len+=ft*(nt[at*2+1]+ut)));if(pt!==0){do{for(dt=lt-1;et.bl_count[dt]===0;)dt--;et.bl_count[dt]--,et.bl_count[dt+1]+=2,et.bl_count[lt]--,pt-=2}while(pt>0);for(dt=lt;dt!==0;dt--)for(at=et.bl_count[dt];at!==0;)ct=et.heap[--st],!(ct>tt)&&(_[ct*2+1]!==dt&&(et.opt_len+=(dt-_[ct*2+1])*_[ct*2],_[ct*2+1]=dt),at--)}},gen_codes=(et,$,_)=>{const tt=new Array(MAX_BITS$1+1);let nt=0,it,rt;for(it=1;it<=MAX_BITS$1;it++)nt=nt+_[it-1]<<1,tt[it]=nt;for(rt=0;rt<=$;rt++){let ot=et[rt*2+1];ot!==0&&(et[rt*2]=bi_reverse(tt[ot]++,ot))}},tr_static_init=()=>{let et,$,_,tt,nt;const it=new Array(MAX_BITS$1+1);for(_=0,tt=0;tt<LENGTH_CODES$1-1;tt++)for(base_length[tt]=_,et=0;et<1<<extra_lbits[tt];et++)_length_code[_++]=tt;for(_length_code[_-1]=tt,nt=0,tt=0;tt<16;tt++)for(base_dist[tt]=nt,et=0;et<1<<extra_dbits[tt];et++)_dist_code[nt++]=tt;for(nt>>=7;tt<D_CODES$1;tt++)for(base_dist[tt]=nt<<7,et=0;et<1<<extra_dbits[tt]-7;et++)_dist_code[256+nt++]=tt;for($=0;$<=MAX_BITS$1;$++)it[$]=0;for(et=0;et<=143;)static_ltree[et*2+1]=8,et++,it[8]++;for(;et<=255;)static_ltree[et*2+1]=9,et++,it[9]++;for(;et<=279;)static_ltree[et*2+1]=7,et++,it[7]++;for(;et<=287;)static_ltree[et*2+1]=8,et++,it[8]++;for(gen_codes(static_ltree,L_CODES$1+1,it),et=0;et<D_CODES$1;et++)static_dtree[et*2+1]=5,static_dtree[et*2]=bi_reverse(et,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=et=>{let $;for($=0;$<L_CODES$1;$++)et.dyn_ltree[$*2]=0;for($=0;$<D_CODES$1;$++)et.dyn_dtree[$*2]=0;for($=0;$<BL_CODES$1;$++)et.bl_tree[$*2]=0;et.dyn_ltree[END_BLOCK*2]=1,et.opt_len=et.static_len=0,et.sym_next=et.matches=0},bi_windup=et=>{et.bi_valid>8?put_short(et,et.bi_buf):et.bi_valid>0&&(et.pending_buf[et.pending++]=et.bi_buf),et.bi_buf=0,et.bi_valid=0},smaller=(et,$,_,tt)=>{const nt=$*2,it=_*2;return et[nt]<et[it]||et[nt]===et[it]&&tt[$]<=tt[_]},pqdownheap=(et,$,_)=>{const tt=et.heap[_];let nt=_<<1;for(;nt<=et.heap_len&&(nt<et.heap_len&&smaller($,et.heap[nt+1],et.heap[nt],et.depth)&&nt++,!smaller($,tt,et.heap[nt],et.depth));)et.heap[_]=et.heap[nt],_=nt,nt<<=1;et.heap[_]=tt},compress_block=(et,$,_)=>{let tt,nt,it=0,rt,ot;if(et.sym_next!==0)do tt=et.pending_buf[et.sym_buf+it++]&255,tt+=(et.pending_buf[et.sym_buf+it++]&255)<<8,nt=et.pending_buf[et.sym_buf+it++],tt===0?send_code(et,nt,$):(rt=_length_code[nt],send_code(et,rt+LITERALS$1+1,$),ot=extra_lbits[rt],ot!==0&&(nt-=base_length[rt],send_bits(et,nt,ot)),tt--,rt=d_code(tt),send_code(et,rt,_),ot=extra_dbits[rt],ot!==0&&(tt-=base_dist[rt],send_bits(et,tt,ot)));while(it<et.sym_next);send_code(et,END_BLOCK,$)},build_tree=(et,$)=>{const _=$.dyn_tree,tt=$.stat_desc.static_tree,nt=$.stat_desc.has_stree,it=$.stat_desc.elems;let rt,ot,lt=-1,st;for(et.heap_len=0,et.heap_max=HEAP_SIZE$1,rt=0;rt<it;rt++)_[rt*2]!==0?(et.heap[++et.heap_len]=lt=rt,et.depth[rt]=0):_[rt*2+1]=0;for(;et.heap_len<2;)st=et.heap[++et.heap_len]=lt<2?++lt:0,_[st*2]=1,et.depth[st]=0,et.opt_len--,nt&&(et.static_len-=tt[st*2+1]);for($.max_code=lt,rt=et.heap_len>>1;rt>=1;rt--)pqdownheap(et,_,rt);st=it;do rt=et.heap[1],et.heap[1]=et.heap[et.heap_len--],pqdownheap(et,_,1),ot=et.heap[1],et.heap[--et.heap_max]=rt,et.heap[--et.heap_max]=ot,_[st*2]=_[rt*2]+_[ot*2],et.depth[st]=(et.depth[rt]>=et.depth[ot]?et.depth[rt]:et.depth[ot])+1,_[rt*2+1]=_[ot*2+1]=st,et.heap[1]=st++,pqdownheap(et,_,1);while(et.heap_len>=2);et.heap[--et.heap_max]=et.heap[1],gen_bitlen(et,$),gen_codes(_,lt,et.bl_count)},scan_tree=(et,$,_)=>{let tt,nt=-1,it,rt=$[0*2+1],ot=0,lt=7,st=4;for(rt===0&&(lt=138,st=3),$[(_+1)*2+1]=65535,tt=0;tt<=_;tt++)it=rt,rt=$[(tt+1)*2+1],!(++ot<lt&&it===rt)&&(ot<st?et.bl_tree[it*2]+=ot:it!==0?(it!==nt&&et.bl_tree[it*2]++,et.bl_tree[REP_3_6*2]++):ot<=10?et.bl_tree[REPZ_3_10*2]++:et.bl_tree[REPZ_11_138*2]++,ot=0,nt=it,rt===0?(lt=138,st=3):it===rt?(lt=6,st=3):(lt=7,st=4))},send_tree=(et,$,_)=>{let tt,nt=-1,it,rt=$[0*2+1],ot=0,lt=7,st=4;for(rt===0&&(lt=138,st=3),tt=0;tt<=_;tt++)if(it=rt,rt=$[(tt+1)*2+1],!(++ot<lt&&it===rt)){if(ot<st)do send_code(et,it,et.bl_tree);while(--ot!==0);else it!==0?(it!==nt&&(send_code(et,it,et.bl_tree),ot--),send_code(et,REP_3_6,et.bl_tree),send_bits(et,ot-3,2)):ot<=10?(send_code(et,REPZ_3_10,et.bl_tree),send_bits(et,ot-3,3)):(send_code(et,REPZ_11_138,et.bl_tree),send_bits(et,ot-11,7));ot=0,nt=it,rt===0?(lt=138,st=3):it===rt?(lt=6,st=3):(lt=7,st=4)}},build_bl_tree=et=>{let $;for(scan_tree(et,et.dyn_ltree,et.l_desc.max_code),scan_tree(et,et.dyn_dtree,et.d_desc.max_code),build_tree(et,et.bl_desc),$=BL_CODES$1-1;$>=3&&et.bl_tree[bl_order[$]*2+1]===0;$--);return et.opt_len+=3*($+1)+5+5+4,$},send_all_trees=(et,$,_,tt)=>{let nt;for(send_bits(et,$-257,5),send_bits(et,_-1,5),send_bits(et,tt-4,4),nt=0;nt<tt;nt++)send_bits(et,et.bl_tree[bl_order[nt]*2+1],3);send_tree(et,et.dyn_ltree,$-1),send_tree(et,et.dyn_dtree,_-1)},detect_data_type=et=>{let $=4093624447,_;for(_=0;_<=31;_++,$>>>=1)if($&1&&et.dyn_ltree[_*2]!==0)return Z_BINARY;if(et.dyn_ltree[9*2]!==0||et.dyn_ltree[10*2]!==0||et.dyn_ltree[13*2]!==0)return Z_TEXT;for(_=32;_<LITERALS$1;_++)if(et.dyn_ltree[_*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=et=>{static_init_done||(tr_static_init(),static_init_done=!0),et.l_desc=new TreeDesc(et.dyn_ltree,static_l_desc),et.d_desc=new TreeDesc(et.dyn_dtree,static_d_desc),et.bl_desc=new TreeDesc(et.bl_tree,static_bl_desc),et.bi_buf=0,et.bi_valid=0,init_block(et)},_tr_stored_block$1=(et,$,_,tt)=>{send_bits(et,(STORED_BLOCK<<1)+(tt?1:0),3),bi_windup(et),put_short(et,_),put_short(et,~_),_&&et.pending_buf.set(et.window.subarray($,$+_),et.pending),et.pending+=_},_tr_align$1=et=>{send_bits(et,STATIC_TREES<<1,3),send_code(et,END_BLOCK,static_ltree),bi_flush(et)},_tr_flush_block$1=(et,$,_,tt)=>{let nt,it,rt=0;et.level>0?(et.strm.data_type===Z_UNKNOWN$1&&(et.strm.data_type=detect_data_type(et)),build_tree(et,et.l_desc),build_tree(et,et.d_desc),rt=build_bl_tree(et),nt=et.opt_len+3+7>>>3,it=et.static_len+3+7>>>3,it<=nt&&(nt=it)):nt=it=_+5,_+4<=nt&&$!==-1?_tr_stored_block$1(et,$,_,tt):et.strategy===Z_FIXED$1||it===nt?(send_bits(et,(STATIC_TREES<<1)+(tt?1:0),3),compress_block(et,static_ltree,static_dtree)):(send_bits(et,(DYN_TREES<<1)+(tt?1:0),3),send_all_trees(et,et.l_desc.max_code+1,et.d_desc.max_code+1,rt+1),compress_block(et,et.dyn_ltree,et.dyn_dtree)),init_block(et),tt&&bi_windup(et)},_tr_tally$1=(et,$,_)=>(et.pending_buf[et.sym_buf+et.sym_next++]=$,et.pending_buf[et.sym_buf+et.sym_next++]=$>>8,et.pending_buf[et.sym_buf+et.sym_next++]=_,$===0?et.dyn_ltree[_*2]++:(et.matches++,$--,et.dyn_ltree[(_length_code[_]+LITERALS$1+1)*2]++,et.dyn_dtree[d_code($)*2]++),et.sym_next===et.sym_end);trees._tr_init=_tr_init$1;trees._tr_stored_block=_tr_stored_block$1;trees._tr_flush_block=_tr_flush_block$1;trees._tr_tally=_tr_tally$1;trees._tr_align=_tr_align$1;const adler32$2=(et,$,_,tt)=>{let nt=et&65535|0,it=et>>>16&65535|0,rt=0;for(;_!==0;){rt=_>2e3?2e3:_,_-=rt;do nt=nt+$[tt++]|0,it=it+nt|0;while(--rt);nt%=65521,it%=65521}return nt|it<<16|0};var adler32_1=adler32$2;const makeTable=()=>{let et,$=[];for(var _=0;_<256;_++){et=_;for(var tt=0;tt<8;tt++)et=et&1?3988292384^et>>>1:et>>>1;$[_]=et}return $},crcTable=new Uint32Array(makeTable()),crc32$2=(et,$,_,tt)=>{const nt=crcTable,it=tt+_;et^=-1;for(let rt=tt;rt<it;rt++)et=et>>>8^nt[(et^$[rt])&255];return et^-1};var crc32_1=crc32$2,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,adler32$1=adler32_1,crc32$1=crc32_1,msg$2=messages,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(et,$)=>(et.msg=msg$2[$],$),rank=et=>et*2-(et>4?9:0),zero=et=>{let $=et.length;for(;--$>=0;)et[$]=0},slide_hash=et=>{let $,_,tt,nt=et.w_size;$=et.hash_size,tt=$;do _=et.head[--tt],et.head[tt]=_>=nt?_-nt:0;while(--$);$=nt,tt=$;do _=et.prev[--tt],et.prev[tt]=_>=nt?_-nt:0;while(--$)};let HASH_ZLIB=(et,$,_)=>($<<et.hash_shift^_)&et.hash_mask,HASH=HASH_ZLIB;const flush_pending=et=>{const $=et.state;let _=$.pending;_>et.avail_out&&(_=et.avail_out),_!==0&&(et.output.set($.pending_buf.subarray($.pending_out,$.pending_out+_),et.next_out),et.next_out+=_,$.pending_out+=_,et.total_out+=_,et.avail_out-=_,$.pending-=_,$.pending===0&&($.pending_out=0))},flush_block_only=(et,$)=>{_tr_flush_block(et,et.block_start>=0?et.block_start:-1,et.strstart-et.block_start,$),et.block_start=et.strstart,flush_pending(et.strm)},put_byte=(et,$)=>{et.pending_buf[et.pending++]=$},putShortMSB=(et,$)=>{et.pending_buf[et.pending++]=$>>>8&255,et.pending_buf[et.pending++]=$&255},read_buf=(et,$,_,tt)=>{let nt=et.avail_in;return nt>tt&&(nt=tt),nt===0?0:(et.avail_in-=nt,$.set(et.input.subarray(et.next_in,et.next_in+nt),_),et.state.wrap===1?et.adler=adler32$1(et.adler,$,nt,_):et.state.wrap===2&&(et.adler=crc32$1(et.adler,$,nt,_)),et.next_in+=nt,et.total_in+=nt,nt)},longest_match=(et,$)=>{let _=et.max_chain_length,tt=et.strstart,nt,it,rt=et.prev_length,ot=et.nice_match;const lt=et.strstart>et.w_size-MIN_LOOKAHEAD?et.strstart-(et.w_size-MIN_LOOKAHEAD):0,st=et.window,at=et.w_mask,ct=et.prev,dt=et.strstart+MAX_MATCH;let ut=st[tt+rt-1],ft=st[tt+rt];et.prev_length>=et.good_match&&(_>>=2),ot>et.lookahead&&(ot=et.lookahead);do if(nt=$,!(st[nt+rt]!==ft||st[nt+rt-1]!==ut||st[nt]!==st[tt]||st[++nt]!==st[tt+1])){tt+=2,nt++;do;while(st[++tt]===st[++nt]&&st[++tt]===st[++nt]&&st[++tt]===st[++nt]&&st[++tt]===st[++nt]&&st[++tt]===st[++nt]&&st[++tt]===st[++nt]&&st[++tt]===st[++nt]&&st[++tt]===st[++nt]&&tt<dt);if(it=MAX_MATCH-(dt-tt),tt=dt-MAX_MATCH,it>rt){if(et.match_start=$,rt=it,it>=ot)break;ut=st[tt+rt-1],ft=st[tt+rt]}}while(($=ct[$&at])>lt&&--_!==0);return rt<=et.lookahead?rt:et.lookahead},fill_window=et=>{const $=et.w_size;let _,tt,nt;do{if(tt=et.window_size-et.lookahead-et.strstart,et.strstart>=$+($-MIN_LOOKAHEAD)&&(et.window.set(et.window.subarray($,$+$-tt),0),et.match_start-=$,et.strstart-=$,et.block_start-=$,et.insert>et.strstart&&(et.insert=et.strstart),slide_hash(et),tt+=$),et.strm.avail_in===0)break;if(_=read_buf(et.strm,et.window,et.strstart+et.lookahead,tt),et.lookahead+=_,et.lookahead+et.insert>=MIN_MATCH)for(nt=et.strstart-et.insert,et.ins_h=et.window[nt],et.ins_h=HASH(et,et.ins_h,et.window[nt+1]);et.insert&&(et.ins_h=HASH(et,et.ins_h,et.window[nt+MIN_MATCH-1]),et.prev[nt&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=nt,nt++,et.insert--,!(et.lookahead+et.insert<MIN_MATCH)););}while(et.lookahead<MIN_LOOKAHEAD&&et.strm.avail_in!==0)},deflate_stored=(et,$)=>{let _=et.pending_buf_size-5>et.w_size?et.w_size:et.pending_buf_size-5,tt,nt,it,rt=0,ot=et.strm.avail_in;do{if(tt=65535,it=et.bi_valid+42>>3,et.strm.avail_out<it||(it=et.strm.avail_out-it,nt=et.strstart-et.block_start,tt>nt+et.strm.avail_in&&(tt=nt+et.strm.avail_in),tt>it&&(tt=it),tt<_&&(tt===0&&$!==Z_FINISH$3||$===Z_NO_FLUSH$2||tt!==nt+et.strm.avail_in)))break;rt=$===Z_FINISH$3&&tt===nt+et.strm.avail_in?1:0,_tr_stored_block(et,0,0,rt),et.pending_buf[et.pending-4]=tt,et.pending_buf[et.pending-3]=tt>>8,et.pending_buf[et.pending-2]=~tt,et.pending_buf[et.pending-1]=~tt>>8,flush_pending(et.strm),nt&&(nt>tt&&(nt=tt),et.strm.output.set(et.window.subarray(et.block_start,et.block_start+nt),et.strm.next_out),et.strm.next_out+=nt,et.strm.avail_out-=nt,et.strm.total_out+=nt,et.block_start+=nt,tt-=nt),tt&&(read_buf(et.strm,et.strm.output,et.strm.next_out,tt),et.strm.next_out+=tt,et.strm.avail_out-=tt,et.strm.total_out+=tt)}while(rt===0);return ot-=et.strm.avail_in,ot&&(ot>=et.w_size?(et.matches=2,et.window.set(et.strm.input.subarray(et.strm.next_in-et.w_size,et.strm.next_in),0),et.strstart=et.w_size,et.insert=et.strstart):(et.window_size-et.strstart<=ot&&(et.strstart-=et.w_size,et.window.set(et.window.subarray(et.w_size,et.w_size+et.strstart),0),et.matches<2&&et.matches++,et.insert>et.strstart&&(et.insert=et.strstart)),et.window.set(et.strm.input.subarray(et.strm.next_in-ot,et.strm.next_in),et.strstart),et.strstart+=ot,et.insert+=ot>et.w_size-et.insert?et.w_size-et.insert:ot),et.block_start=et.strstart),et.high_water<et.strstart&&(et.high_water=et.strstart),rt?BS_FINISH_DONE:$!==Z_NO_FLUSH$2&&$!==Z_FINISH$3&&et.strm.avail_in===0&&et.strstart===et.block_start?BS_BLOCK_DONE:(it=et.window_size-et.strstart,et.strm.avail_in>it&&et.block_start>=et.w_size&&(et.block_start-=et.w_size,et.strstart-=et.w_size,et.window.set(et.window.subarray(et.w_size,et.w_size+et.strstart),0),et.matches<2&&et.matches++,it+=et.w_size,et.insert>et.strstart&&(et.insert=et.strstart)),it>et.strm.avail_in&&(it=et.strm.avail_in),it&&(read_buf(et.strm,et.window,et.strstart,it),et.strstart+=it,et.insert+=it>et.w_size-et.insert?et.w_size-et.insert:it),et.high_water<et.strstart&&(et.high_water=et.strstart),it=et.bi_valid+42>>3,it=et.pending_buf_size-it>65535?65535:et.pending_buf_size-it,_=it>et.w_size?et.w_size:it,nt=et.strstart-et.block_start,(nt>=_||(nt||$===Z_FINISH$3)&&$!==Z_NO_FLUSH$2&&et.strm.avail_in===0&&nt<=it)&&(tt=nt>it?it:nt,rt=$===Z_FINISH$3&&et.strm.avail_in===0&&tt===nt?1:0,_tr_stored_block(et,et.block_start,tt,rt),et.block_start+=tt,flush_pending(et.strm)),rt?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(et,$)=>{let _,tt;for(;;){if(et.lookahead<MIN_LOOKAHEAD){if(fill_window(et),et.lookahead<MIN_LOOKAHEAD&&$===Z_NO_FLUSH$2)return BS_NEED_MORE;if(et.lookahead===0)break}if(_=0,et.lookahead>=MIN_MATCH&&(et.ins_h=HASH(et,et.ins_h,et.window[et.strstart+MIN_MATCH-1]),_=et.prev[et.strstart&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=et.strstart),_!==0&&et.strstart-_<=et.w_size-MIN_LOOKAHEAD&&(et.match_length=longest_match(et,_)),et.match_length>=MIN_MATCH)if(tt=_tr_tally(et,et.strstart-et.match_start,et.match_length-MIN_MATCH),et.lookahead-=et.match_length,et.match_length<=et.max_lazy_match&&et.lookahead>=MIN_MATCH){et.match_length--;do et.strstart++,et.ins_h=HASH(et,et.ins_h,et.window[et.strstart+MIN_MATCH-1]),_=et.prev[et.strstart&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=et.strstart;while(--et.match_length!==0);et.strstart++}else et.strstart+=et.match_length,et.match_length=0,et.ins_h=et.window[et.strstart],et.ins_h=HASH(et,et.ins_h,et.window[et.strstart+1]);else tt=_tr_tally(et,0,et.window[et.strstart]),et.lookahead--,et.strstart++;if(tt&&(flush_block_only(et,!1),et.strm.avail_out===0))return BS_NEED_MORE}return et.insert=et.strstart<MIN_MATCH-1?et.strstart:MIN_MATCH-1,$===Z_FINISH$3?(flush_block_only(et,!0),et.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):et.sym_next&&(flush_block_only(et,!1),et.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(et,$)=>{let _,tt,nt;for(;;){if(et.lookahead<MIN_LOOKAHEAD){if(fill_window(et),et.lookahead<MIN_LOOKAHEAD&&$===Z_NO_FLUSH$2)return BS_NEED_MORE;if(et.lookahead===0)break}if(_=0,et.lookahead>=MIN_MATCH&&(et.ins_h=HASH(et,et.ins_h,et.window[et.strstart+MIN_MATCH-1]),_=et.prev[et.strstart&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=et.strstart),et.prev_length=et.match_length,et.prev_match=et.match_start,et.match_length=MIN_MATCH-1,_!==0&&et.prev_length<et.max_lazy_match&&et.strstart-_<=et.w_size-MIN_LOOKAHEAD&&(et.match_length=longest_match(et,_),et.match_length<=5&&(et.strategy===Z_FILTERED||et.match_length===MIN_MATCH&&et.strstart-et.match_start>4096)&&(et.match_length=MIN_MATCH-1)),et.prev_length>=MIN_MATCH&&et.match_length<=et.prev_length){nt=et.strstart+et.lookahead-MIN_MATCH,tt=_tr_tally(et,et.strstart-1-et.prev_match,et.prev_length-MIN_MATCH),et.lookahead-=et.prev_length-1,et.prev_length-=2;do++et.strstart<=nt&&(et.ins_h=HASH(et,et.ins_h,et.window[et.strstart+MIN_MATCH-1]),_=et.prev[et.strstart&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=et.strstart);while(--et.prev_length!==0);if(et.match_available=0,et.match_length=MIN_MATCH-1,et.strstart++,tt&&(flush_block_only(et,!1),et.strm.avail_out===0))return BS_NEED_MORE}else if(et.match_available){if(tt=_tr_tally(et,0,et.window[et.strstart-1]),tt&&flush_block_only(et,!1),et.strstart++,et.lookahead--,et.strm.avail_out===0)return BS_NEED_MORE}else et.match_available=1,et.strstart++,et.lookahead--}return et.match_available&&(tt=_tr_tally(et,0,et.window[et.strstart-1]),et.match_available=0),et.insert=et.strstart<MIN_MATCH-1?et.strstart:MIN_MATCH-1,$===Z_FINISH$3?(flush_block_only(et,!0),et.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):et.sym_next&&(flush_block_only(et,!1),et.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(et,$)=>{let _,tt,nt,it;const rt=et.window;for(;;){if(et.lookahead<=MAX_MATCH){if(fill_window(et),et.lookahead<=MAX_MATCH&&$===Z_NO_FLUSH$2)return BS_NEED_MORE;if(et.lookahead===0)break}if(et.match_length=0,et.lookahead>=MIN_MATCH&&et.strstart>0&&(nt=et.strstart-1,tt=rt[nt],tt===rt[++nt]&&tt===rt[++nt]&&tt===rt[++nt])){it=et.strstart+MAX_MATCH;do;while(tt===rt[++nt]&&tt===rt[++nt]&&tt===rt[++nt]&&tt===rt[++nt]&&tt===rt[++nt]&&tt===rt[++nt]&&tt===rt[++nt]&&tt===rt[++nt]&&nt<it);et.match_length=MAX_MATCH-(it-nt),et.match_length>et.lookahead&&(et.match_length=et.lookahead)}if(et.match_length>=MIN_MATCH?(_=_tr_tally(et,1,et.match_length-MIN_MATCH),et.lookahead-=et.match_length,et.strstart+=et.match_length,et.match_length=0):(_=_tr_tally(et,0,et.window[et.strstart]),et.lookahead--,et.strstart++),_&&(flush_block_only(et,!1),et.strm.avail_out===0))return BS_NEED_MORE}return et.insert=0,$===Z_FINISH$3?(flush_block_only(et,!0),et.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):et.sym_next&&(flush_block_only(et,!1),et.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(et,$)=>{let _;for(;;){if(et.lookahead===0&&(fill_window(et),et.lookahead===0)){if($===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(et.match_length=0,_=_tr_tally(et,0,et.window[et.strstart]),et.lookahead--,et.strstart++,_&&(flush_block_only(et,!1),et.strm.avail_out===0))return BS_NEED_MORE}return et.insert=0,$===Z_FINISH$3?(flush_block_only(et,!0),et.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):et.sym_next&&(flush_block_only(et,!1),et.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(et,$,_,tt,nt){this.good_length=et,this.max_lazy=$,this.nice_length=_,this.max_chain=tt,this.func=nt}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=et=>{et.window_size=2*et.w_size,zero(et.head),et.max_lazy_match=configuration_table[et.level].max_lazy,et.good_match=configuration_table[et.level].good_length,et.nice_match=configuration_table[et.level].nice_length,et.max_chain_length=configuration_table[et.level].max_chain,et.strstart=0,et.block_start=0,et.lookahead=0,et.insert=0,et.match_length=et.prev_length=MIN_MATCH-1,et.match_available=0,et.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=et=>{if(!et)return 1;const $=et.state;return!$||$.strm!==et||$.status!==INIT_STATE&&$.status!==GZIP_STATE&&$.status!==EXTRA_STATE&&$.status!==NAME_STATE&&$.status!==COMMENT_STATE&&$.status!==HCRC_STATE&&$.status!==BUSY_STATE&&$.status!==FINISH_STATE?1:0},deflateResetKeep=et=>{if(deflateStateCheck(et))return err(et,Z_STREAM_ERROR$2);et.total_in=et.total_out=0,et.data_type=Z_UNKNOWN;const $=et.state;return $.pending=0,$.pending_out=0,$.wrap<0&&($.wrap=-$.wrap),$.status=$.wrap===2?GZIP_STATE:$.wrap?INIT_STATE:BUSY_STATE,et.adler=$.wrap===2?0:1,$.last_flush=-2,_tr_init($),Z_OK$3},deflateReset=et=>{const $=deflateResetKeep(et);return $===Z_OK$3&&lm_init(et.state),$},deflateSetHeader=(et,$)=>deflateStateCheck(et)||et.state.wrap!==2?Z_STREAM_ERROR$2:(et.state.gzhead=$,Z_OK$3),deflateInit2=(et,$,_,tt,nt,it)=>{if(!et)return Z_STREAM_ERROR$2;let rt=1;if($===Z_DEFAULT_COMPRESSION$1&&($=6),tt<0?(rt=0,tt=-tt):tt>15&&(rt=2,tt-=16),nt<1||nt>MAX_MEM_LEVEL||_!==Z_DEFLATED$2||tt<8||tt>15||$<0||$>9||it<0||it>Z_FIXED||tt===8&&rt!==1)return err(et,Z_STREAM_ERROR$2);tt===8&&(tt=9);const ot=new DeflateState;return et.state=ot,ot.strm=et,ot.status=INIT_STATE,ot.wrap=rt,ot.gzhead=null,ot.w_bits=tt,ot.w_size=1<<ot.w_bits,ot.w_mask=ot.w_size-1,ot.hash_bits=nt+7,ot.hash_size=1<<ot.hash_bits,ot.hash_mask=ot.hash_size-1,ot.hash_shift=~~((ot.hash_bits+MIN_MATCH-1)/MIN_MATCH),ot.window=new Uint8Array(ot.w_size*2),ot.head=new Uint16Array(ot.hash_size),ot.prev=new Uint16Array(ot.w_size),ot.lit_bufsize=1<<nt+6,ot.pending_buf_size=ot.lit_bufsize*4,ot.pending_buf=new Uint8Array(ot.pending_buf_size),ot.sym_buf=ot.lit_bufsize,ot.sym_end=(ot.lit_bufsize-1)*3,ot.level=$,ot.strategy=it,ot.method=_,deflateReset(et)},deflateInit=(et,$)=>deflateInit2(et,$,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(et,$)=>{if(deflateStateCheck(et)||$>Z_BLOCK$1||$<0)return et?err(et,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const _=et.state;if(!et.output||et.avail_in!==0&&!et.input||_.status===FINISH_STATE&&$!==Z_FINISH$3)return err(et,et.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const tt=_.last_flush;if(_.last_flush=$,_.pending!==0){if(flush_pending(et),et.avail_out===0)return _.last_flush=-1,Z_OK$3}else if(et.avail_in===0&&rank($)<=rank(tt)&&$!==Z_FINISH$3)return err(et,Z_BUF_ERROR$1);if(_.status===FINISH_STATE&&et.avail_in!==0)return err(et,Z_BUF_ERROR$1);if(_.status===INIT_STATE&&_.wrap===0&&(_.status=BUSY_STATE),_.status===INIT_STATE){let nt=Z_DEFLATED$2+(_.w_bits-8<<4)<<8,it=-1;if(_.strategy>=Z_HUFFMAN_ONLY||_.level<2?it=0:_.level<6?it=1:_.level===6?it=2:it=3,nt|=it<<6,_.strstart!==0&&(nt|=PRESET_DICT),nt+=31-nt%31,putShortMSB(_,nt),_.strstart!==0&&(putShortMSB(_,et.adler>>>16),putShortMSB(_,et.adler&65535)),et.adler=1,_.status=BUSY_STATE,flush_pending(et),_.pending!==0)return _.last_flush=-1,Z_OK$3}if(_.status===GZIP_STATE){if(et.adler=0,put_byte(_,31),put_byte(_,139),put_byte(_,8),_.gzhead)put_byte(_,(_.gzhead.text?1:0)+(_.gzhead.hcrc?2:0)+(_.gzhead.extra?4:0)+(_.gzhead.name?8:0)+(_.gzhead.comment?16:0)),put_byte(_,_.gzhead.time&255),put_byte(_,_.gzhead.time>>8&255),put_byte(_,_.gzhead.time>>16&255),put_byte(_,_.gzhead.time>>24&255),put_byte(_,_.level===9?2:_.strategy>=Z_HUFFMAN_ONLY||_.level<2?4:0),put_byte(_,_.gzhead.os&255),_.gzhead.extra&&_.gzhead.extra.length&&(put_byte(_,_.gzhead.extra.length&255),put_byte(_,_.gzhead.extra.length>>8&255)),_.gzhead.hcrc&&(et.adler=crc32$1(et.adler,_.pending_buf,_.pending,0)),_.gzindex=0,_.status=EXTRA_STATE;else if(put_byte(_,0),put_byte(_,0),put_byte(_,0),put_byte(_,0),put_byte(_,0),put_byte(_,_.level===9?2:_.strategy>=Z_HUFFMAN_ONLY||_.level<2?4:0),put_byte(_,OS_CODE),_.status=BUSY_STATE,flush_pending(et),_.pending!==0)return _.last_flush=-1,Z_OK$3}if(_.status===EXTRA_STATE){if(_.gzhead.extra){let nt=_.pending,it=(_.gzhead.extra.length&65535)-_.gzindex;for(;_.pending+it>_.pending_buf_size;){let ot=_.pending_buf_size-_.pending;if(_.pending_buf.set(_.gzhead.extra.subarray(_.gzindex,_.gzindex+ot),_.pending),_.pending=_.pending_buf_size,_.gzhead.hcrc&&_.pending>nt&&(et.adler=crc32$1(et.adler,_.pending_buf,_.pending-nt,nt)),_.gzindex+=ot,flush_pending(et),_.pending!==0)return _.last_flush=-1,Z_OK$3;nt=0,it-=ot}let rt=new Uint8Array(_.gzhead.extra);_.pending_buf.set(rt.subarray(_.gzindex,_.gzindex+it),_.pending),_.pending+=it,_.gzhead.hcrc&&_.pending>nt&&(et.adler=crc32$1(et.adler,_.pending_buf,_.pending-nt,nt)),_.gzindex=0}_.status=NAME_STATE}if(_.status===NAME_STATE){if(_.gzhead.name){let nt=_.pending,it;do{if(_.pending===_.pending_buf_size){if(_.gzhead.hcrc&&_.pending>nt&&(et.adler=crc32$1(et.adler,_.pending_buf,_.pending-nt,nt)),flush_pending(et),_.pending!==0)return _.last_flush=-1,Z_OK$3;nt=0}_.gzindex<_.gzhead.name.length?it=_.gzhead.name.charCodeAt(_.gzindex++)&255:it=0,put_byte(_,it)}while(it!==0);_.gzhead.hcrc&&_.pending>nt&&(et.adler=crc32$1(et.adler,_.pending_buf,_.pending-nt,nt)),_.gzindex=0}_.status=COMMENT_STATE}if(_.status===COMMENT_STATE){if(_.gzhead.comment){let nt=_.pending,it;do{if(_.pending===_.pending_buf_size){if(_.gzhead.hcrc&&_.pending>nt&&(et.adler=crc32$1(et.adler,_.pending_buf,_.pending-nt,nt)),flush_pending(et),_.pending!==0)return _.last_flush=-1,Z_OK$3;nt=0}_.gzindex<_.gzhead.comment.length?it=_.gzhead.comment.charCodeAt(_.gzindex++)&255:it=0,put_byte(_,it)}while(it!==0);_.gzhead.hcrc&&_.pending>nt&&(et.adler=crc32$1(et.adler,_.pending_buf,_.pending-nt,nt))}_.status=HCRC_STATE}if(_.status===HCRC_STATE){if(_.gzhead.hcrc){if(_.pending+2>_.pending_buf_size&&(flush_pending(et),_.pending!==0))return _.last_flush=-1,Z_OK$3;put_byte(_,et.adler&255),put_byte(_,et.adler>>8&255),et.adler=0}if(_.status=BUSY_STATE,flush_pending(et),_.pending!==0)return _.last_flush=-1,Z_OK$3}if(et.avail_in!==0||_.lookahead!==0||$!==Z_NO_FLUSH$2&&_.status!==FINISH_STATE){let nt=_.level===0?deflate_stored(_,$):_.strategy===Z_HUFFMAN_ONLY?deflate_huff(_,$):_.strategy===Z_RLE?deflate_rle(_,$):configuration_table[_.level].func(_,$);if((nt===BS_FINISH_STARTED||nt===BS_FINISH_DONE)&&(_.status=FINISH_STATE),nt===BS_NEED_MORE||nt===BS_FINISH_STARTED)return et.avail_out===0&&(_.last_flush=-1),Z_OK$3;if(nt===BS_BLOCK_DONE&&($===Z_PARTIAL_FLUSH?_tr_align(_):$!==Z_BLOCK$1&&(_tr_stored_block(_,0,0,!1),$===Z_FULL_FLUSH$1&&(zero(_.head),_.lookahead===0&&(_.strstart=0,_.block_start=0,_.insert=0))),flush_pending(et),et.avail_out===0))return _.last_flush=-1,Z_OK$3}return $!==Z_FINISH$3?Z_OK$3:_.wrap<=0?Z_STREAM_END$3:(_.wrap===2?(put_byte(_,et.adler&255),put_byte(_,et.adler>>8&255),put_byte(_,et.adler>>16&255),put_byte(_,et.adler>>24&255),put_byte(_,et.total_in&255),put_byte(_,et.total_in>>8&255),put_byte(_,et.total_in>>16&255),put_byte(_,et.total_in>>24&255)):(putShortMSB(_,et.adler>>>16),putShortMSB(_,et.adler&65535)),flush_pending(et),_.wrap>0&&(_.wrap=-_.wrap),_.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=et=>{if(deflateStateCheck(et))return Z_STREAM_ERROR$2;const $=et.state.status;return et.state=null,$===BUSY_STATE?err(et,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(et,$)=>{let _=$.length;if(deflateStateCheck(et))return Z_STREAM_ERROR$2;const tt=et.state,nt=tt.wrap;if(nt===2||nt===1&&tt.status!==INIT_STATE||tt.lookahead)return Z_STREAM_ERROR$2;if(nt===1&&(et.adler=adler32$1(et.adler,$,_,0)),tt.wrap=0,_>=tt.w_size){nt===0&&(zero(tt.head),tt.strstart=0,tt.block_start=0,tt.insert=0);let lt=new Uint8Array(tt.w_size);lt.set($.subarray(_-tt.w_size,_),0),$=lt,_=tt.w_size}const it=et.avail_in,rt=et.next_in,ot=et.input;for(et.avail_in=_,et.next_in=0,et.input=$,fill_window(tt);tt.lookahead>=MIN_MATCH;){let lt=tt.strstart,st=tt.lookahead-(MIN_MATCH-1);do tt.ins_h=HASH(tt,tt.ins_h,tt.window[lt+MIN_MATCH-1]),tt.prev[lt&tt.w_mask]=tt.head[tt.ins_h],tt.head[tt.ins_h]=lt,lt++;while(--st);tt.strstart=lt,tt.lookahead=MIN_MATCH-1,fill_window(tt)}return tt.strstart+=tt.lookahead,tt.block_start=tt.strstart,tt.insert=tt.lookahead,tt.lookahead=0,tt.match_length=tt.prev_length=MIN_MATCH-1,tt.match_available=0,et.next_in=rt,et.input=ot,et.avail_in=it,tt.wrap=nt,Z_OK$3};deflate$3.deflateInit=deflateInit;deflate$3.deflateInit2=deflateInit2;deflate$3.deflateReset=deflateReset;deflate$3.deflateResetKeep=deflateResetKeep;deflate$3.deflateSetHeader=deflateSetHeader;deflate$3.deflate=deflate$2;deflate$3.deflateEnd=deflateEnd;deflate$3.deflateSetDictionary=deflateSetDictionary;deflate$3.deflateInfo="pako deflate (from Nodeca project)";var common={};const _has=(et,$)=>Object.prototype.hasOwnProperty.call(et,$);common.assign=function(et){const $=Array.prototype.slice.call(arguments,1);for(;$.length;){const _=$.shift();if(_){if(typeof _!="object")throw new TypeError(_+"must be non-object");for(const tt in _)_has(_,tt)&&(et[tt]=_[tt])}}return et};common.flattenChunks=et=>{let $=0;for(let tt=0,nt=et.length;tt<nt;tt++)$+=et[tt].length;const _=new Uint8Array($);for(let tt=0,nt=0,it=et.length;tt<it;tt++){let rt=et[tt];_.set(rt,nt),nt+=rt.length}return _};var strings$2={};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(et){STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let et=0;et<256;et++)_utf8len[et]=et>=252?6:et>=248?5:et>=240?4:et>=224?3:et>=192?2:1;_utf8len[254]=_utf8len[254]=1;strings$2.string2buf=et=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(et);let $,_,tt,nt,it,rt=et.length,ot=0;for(nt=0;nt<rt;nt++)_=et.charCodeAt(nt),(_&64512)===55296&&nt+1<rt&&(tt=et.charCodeAt(nt+1),(tt&64512)===56320&&(_=65536+(_-55296<<10)+(tt-56320),nt++)),ot+=_<128?1:_<2048?2:_<65536?3:4;for($=new Uint8Array(ot),it=0,nt=0;it<ot;nt++)_=et.charCodeAt(nt),(_&64512)===55296&&nt+1<rt&&(tt=et.charCodeAt(nt+1),(tt&64512)===56320&&(_=65536+(_-55296<<10)+(tt-56320),nt++)),_<128?$[it++]=_:_<2048?($[it++]=192|_>>>6,$[it++]=128|_&63):_<65536?($[it++]=224|_>>>12,$[it++]=128|_>>>6&63,$[it++]=128|_&63):($[it++]=240|_>>>18,$[it++]=128|_>>>12&63,$[it++]=128|_>>>6&63,$[it++]=128|_&63);return $};const buf2binstring=(et,$)=>{if($<65534&&et.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,et.length===$?et:et.subarray(0,$));let _="";for(let tt=0;tt<$;tt++)_+=String.fromCharCode(et[tt]);return _};strings$2.buf2string=(et,$)=>{const _=$||et.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(et.subarray(0,$));let tt,nt;const it=new Array(_*2);for(nt=0,tt=0;tt<_;){let rt=et[tt++];if(rt<128){it[nt++]=rt;continue}let ot=_utf8len[rt];if(ot>4){it[nt++]=65533,tt+=ot-1;continue}for(rt&=ot===2?31:ot===3?15:7;ot>1&&tt<_;)rt=rt<<6|et[tt++]&63,ot--;if(ot>1){it[nt++]=65533;continue}rt<65536?it[nt++]=rt:(rt-=65536,it[nt++]=55296|rt>>10&1023,it[nt++]=56320|rt&1023)}return buf2binstring(it,nt)};strings$2.utf8border=(et,$)=>{$=$||et.length,$>et.length&&($=et.length);let _=$-1;for(;_>=0&&(et[_]&192)===128;)_--;return _<0||_===0?$:_+_utf8len[et[_]]>$?_:$};function ZStream$2(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream$2;const zlib_deflate=deflate$3,utils$1=common,strings$1=strings$2,msg$1=messages,ZStream$1=zstream,toString$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(et){this.options=utils$1.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},et||{});let $=this.options;$.raw&&$.windowBits>0?$.windowBits=-$.windowBits:$.gzip&&$.windowBits>0&&$.windowBits<16&&($.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream$1,this.strm.avail_out=0;let _=zlib_deflate.deflateInit2(this.strm,$.level,$.method,$.windowBits,$.memLevel,$.strategy);if(_!==Z_OK$2)throw new Error(msg$1[_]);if($.header&&zlib_deflate.deflateSetHeader(this.strm,$.header),$.dictionary){let tt;if(typeof $.dictionary=="string"?tt=strings$1.string2buf($.dictionary):toString$1.call($.dictionary)==="[object ArrayBuffer]"?tt=new Uint8Array($.dictionary):tt=$.dictionary,_=zlib_deflate.deflateSetDictionary(this.strm,tt),_!==Z_OK$2)throw new Error(msg$1[_]);this._dict_set=!0}}Deflate$1.prototype.push=function(et,$){const _=this.strm,tt=this.options.chunkSize;let nt,it;if(this.ended)return!1;for($===~~$?it=$:it=$===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof et=="string"?_.input=strings$1.string2buf(et):toString$1.call(et)==="[object ArrayBuffer]"?_.input=new Uint8Array(et):_.input=et,_.next_in=0,_.avail_in=_.input.length;;){if(_.avail_out===0&&(_.output=new Uint8Array(tt),_.next_out=0,_.avail_out=tt),(it===Z_SYNC_FLUSH||it===Z_FULL_FLUSH)&&_.avail_out<=6){this.onData(_.output.subarray(0,_.next_out)),_.avail_out=0;continue}if(nt=zlib_deflate.deflate(_,it),nt===Z_STREAM_END$2)return _.next_out>0&&this.onData(_.output.subarray(0,_.next_out)),nt=zlib_deflate.deflateEnd(this.strm),this.onEnd(nt),this.ended=!0,nt===Z_OK$2;if(_.avail_out===0){this.onData(_.output);continue}if(it>0&&_.next_out>0){this.onData(_.output.subarray(0,_.next_out)),_.avail_out=0;continue}if(_.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(et){this.chunks.push(et)};Deflate$1.prototype.onEnd=function(et){et===Z_OK$2&&(this.result=utils$1.flattenChunks(this.chunks)),this.chunks=[],this.err=et,this.msg=this.strm.msg};function deflate$1(et,$){const _=new Deflate$1($);if(_.push(et,!0),_.err)throw _.msg||msg$1[_.err];return _.result}function deflateRaw$1(et,$){return $=$||{},$.raw=!0,deflate$1(et,$)}function gzip$1(et,$){return $=$||{},$.gzip=!0,deflate$1(et,$)}deflate$4.Deflate=Deflate$1;deflate$4.deflate=deflate$1;deflate$4.deflateRaw=deflateRaw$1;deflate$4.gzip=gzip$1;deflate$4.constants=constants$2;var inflate$4={},inflate$3={};const BAD$1=16209,TYPE$1=16191;var inffast=function et($,_){let tt,nt,it,rt,ot,lt,st,at,ct,dt,ut,ft,pt,St,gt,yt,vt,Ct,Et,Mt,Rt,At,Dt,It;const Vt=$.state;tt=$.next_in,Dt=$.input,nt=tt+($.avail_in-5),it=$.next_out,It=$.output,rt=it-(_-$.avail_out),ot=it+($.avail_out-257),lt=Vt.dmax,st=Vt.wsize,at=Vt.whave,ct=Vt.wnext,dt=Vt.window,ut=Vt.hold,ft=Vt.bits,pt=Vt.lencode,St=Vt.distcode,gt=(1<<Vt.lenbits)-1,yt=(1<<Vt.distbits)-1;e:do{ft<15&&(ut+=Dt[tt++]<<ft,ft+=8,ut+=Dt[tt++]<<ft,ft+=8),vt=pt[ut&gt];t:for(;;){if(Ct=vt>>>24,ut>>>=Ct,ft-=Ct,Ct=vt>>>16&255,Ct===0)It[it++]=vt&65535;else if(Ct&16){Et=vt&65535,Ct&=15,Ct&&(ft<Ct&&(ut+=Dt[tt++]<<ft,ft+=8),Et+=ut&(1<<Ct)-1,ut>>>=Ct,ft-=Ct),ft<15&&(ut+=Dt[tt++]<<ft,ft+=8,ut+=Dt[tt++]<<ft,ft+=8),vt=St[ut&yt];n:for(;;){if(Ct=vt>>>24,ut>>>=Ct,ft-=Ct,Ct=vt>>>16&255,Ct&16){if(Mt=vt&65535,Ct&=15,ft<Ct&&(ut+=Dt[tt++]<<ft,ft+=8,ft<Ct&&(ut+=Dt[tt++]<<ft,ft+=8)),Mt+=ut&(1<<Ct)-1,Mt>lt){$.msg="invalid distance too far back",Vt.mode=BAD$1;break e}if(ut>>>=Ct,ft-=Ct,Ct=it-rt,Mt>Ct){if(Ct=Mt-Ct,Ct>at&&Vt.sane){$.msg="invalid distance too far back",Vt.mode=BAD$1;break e}if(Rt=0,At=dt,ct===0){if(Rt+=st-Ct,Ct<Et){Et-=Ct;do It[it++]=dt[Rt++];while(--Ct);Rt=it-Mt,At=It}}else if(ct<Ct){if(Rt+=st+ct-Ct,Ct-=ct,Ct<Et){Et-=Ct;do It[it++]=dt[Rt++];while(--Ct);if(Rt=0,ct<Et){Ct=ct,Et-=Ct;do It[it++]=dt[Rt++];while(--Ct);Rt=it-Mt,At=It}}}else if(Rt+=ct-Ct,Ct<Et){Et-=Ct;do It[it++]=dt[Rt++];while(--Ct);Rt=it-Mt,At=It}for(;Et>2;)It[it++]=At[Rt++],It[it++]=At[Rt++],It[it++]=At[Rt++],Et-=3;Et&&(It[it++]=At[Rt++],Et>1&&(It[it++]=At[Rt++]))}else{Rt=it-Mt;do It[it++]=It[Rt++],It[it++]=It[Rt++],It[it++]=It[Rt++],Et-=3;while(Et>2);Et&&(It[it++]=It[Rt++],Et>1&&(It[it++]=It[Rt++]))}}else if(Ct&64){$.msg="invalid distance code",Vt.mode=BAD$1;break e}else{vt=St[(vt&65535)+(ut&(1<<Ct)-1)];continue n}break}}else if(Ct&64)if(Ct&32){Vt.mode=TYPE$1;break e}else{$.msg="invalid literal/length code",Vt.mode=BAD$1;break e}else{vt=pt[(vt&65535)+(ut&(1<<Ct)-1)];continue t}break}}while(tt<nt&&it<ot);Et=ft>>3,tt-=Et,ft-=Et<<3,ut&=(1<<ft)-1,$.next_in=tt,$.next_out=it,$.avail_in=tt<nt?5+(nt-tt):5-(tt-nt),$.avail_out=it<ot?257+(ot-it):257-(it-ot),Vt.hold=ut,Vt.bits=ft};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table$1=(et,$,_,tt,nt,it,rt,ot)=>{const lt=ot.bits;let st=0,at=0,ct=0,dt=0,ut=0,ft=0,pt=0,St=0,gt=0,yt=0,vt,Ct,Et,Mt,Rt,At=null,Dt;const It=new Uint16Array(MAXBITS+1),Vt=new Uint16Array(MAXBITS+1);let jt=null,qt,cn,dn;for(st=0;st<=MAXBITS;st++)It[st]=0;for(at=0;at<tt;at++)It[$[_+at]]++;for(ut=lt,dt=MAXBITS;dt>=1&&It[dt]===0;dt--);if(ut>dt&&(ut=dt),dt===0)return nt[it++]=1<<24|64<<16|0,nt[it++]=1<<24|64<<16|0,ot.bits=1,0;for(ct=1;ct<dt&&It[ct]===0;ct++);for(ut<ct&&(ut=ct),St=1,st=1;st<=MAXBITS;st++)if(St<<=1,St-=It[st],St<0)return-1;if(St>0&&(et===CODES$1||dt!==1))return-1;for(Vt[1]=0,st=1;st<MAXBITS;st++)Vt[st+1]=Vt[st]+It[st];for(at=0;at<tt;at++)$[_+at]!==0&&(rt[Vt[$[_+at]]++]=at);if(et===CODES$1?(At=jt=rt,Dt=20):et===LENS$1?(At=lbase,jt=lext,Dt=257):(At=dbase,jt=dext,Dt=0),yt=0,at=0,st=ct,Rt=it,ft=ut,pt=0,Et=-1,gt=1<<ut,Mt=gt-1,et===LENS$1&&gt>ENOUGH_LENS$1||et===DISTS$1&&gt>ENOUGH_DISTS$1)return 1;for(;;){qt=st-pt,rt[at]+1<Dt?(cn=0,dn=rt[at]):rt[at]>=Dt?(cn=jt[rt[at]-Dt],dn=At[rt[at]-Dt]):(cn=32+64,dn=0),vt=1<<st-pt,Ct=1<<ft,ct=Ct;do Ct-=vt,nt[Rt+(yt>>pt)+Ct]=qt<<24|cn<<16|dn|0;while(Ct!==0);for(vt=1<<st-1;yt&vt;)vt>>=1;if(vt!==0?(yt&=vt-1,yt+=vt):yt=0,at++,--It[st]===0){if(st===dt)break;st=$[_+rt[at]]}if(st>ut&&(yt&Mt)!==Et){for(pt===0&&(pt=ut),Rt+=ct,ft=st-pt,St=1<<ft;ft+pt<dt&&(St-=It[ft+pt],!(St<=0));)ft++,St<<=1;if(gt+=1<<ft,et===LENS$1&&gt>ENOUGH_LENS$1||et===DISTS$1&&gt>ENOUGH_DISTS$1)return 1;Et=yt&Mt,nt[Et]=ut<<24|ft<<16|Rt-it|0}}return yt!==0&&(nt[Rt+yt]=st-pt<<24|64<<16|0),ot.bits=ut,0};var inftrees=inflate_table$1;const adler32=adler32_1,crc32=crc32_1,inflate_fast=inffast,inflate_table=inftrees,CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=et=>(et>>>24&255)+(et>>>8&65280)+((et&65280)<<8)+((et&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=et=>{if(!et)return 1;const $=et.state;return!$||$.strm!==et||$.mode<HEAD||$.mode>SYNC?1:0},inflateResetKeep=et=>{if(inflateStateCheck(et))return Z_STREAM_ERROR$1;const $=et.state;return et.total_in=et.total_out=$.total=0,et.msg="",$.wrap&&(et.adler=$.wrap&1),$.mode=HEAD,$.last=0,$.havedict=0,$.flags=-1,$.dmax=32768,$.head=null,$.hold=0,$.bits=0,$.lencode=$.lendyn=new Int32Array(ENOUGH_LENS),$.distcode=$.distdyn=new Int32Array(ENOUGH_DISTS),$.sane=1,$.back=-1,Z_OK$1},inflateReset=et=>{if(inflateStateCheck(et))return Z_STREAM_ERROR$1;const $=et.state;return $.wsize=0,$.whave=0,$.wnext=0,inflateResetKeep(et)},inflateReset2=(et,$)=>{let _;if(inflateStateCheck(et))return Z_STREAM_ERROR$1;const tt=et.state;return $<0?(_=0,$=-$):(_=($>>4)+5,$<48&&($&=15)),$&&($<8||$>15)?Z_STREAM_ERROR$1:(tt.window!==null&&tt.wbits!==$&&(tt.window=null),tt.wrap=_,tt.wbits=$,inflateReset(et))},inflateInit2=(et,$)=>{if(!et)return Z_STREAM_ERROR$1;const _=new InflateState;et.state=_,_.strm=et,_.window=null,_.mode=HEAD;const tt=inflateReset2(et,$);return tt!==Z_OK$1&&(et.state=null),tt},inflateInit=et=>inflateInit2(et,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=et=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let $=0;for(;$<144;)et.lens[$++]=8;for(;$<256;)et.lens[$++]=9;for(;$<280;)et.lens[$++]=7;for(;$<288;)et.lens[$++]=8;for(inflate_table(LENS,et.lens,0,288,lenfix,0,et.work,{bits:9}),$=0;$<32;)et.lens[$++]=5;inflate_table(DISTS,et.lens,0,32,distfix,0,et.work,{bits:5}),virgin=!1}et.lencode=lenfix,et.lenbits=9,et.distcode=distfix,et.distbits=5},updatewindow=(et,$,_,tt)=>{let nt;const it=et.state;return it.window===null&&(it.wsize=1<<it.wbits,it.wnext=0,it.whave=0,it.window=new Uint8Array(it.wsize)),tt>=it.wsize?(it.window.set($.subarray(_-it.wsize,_),0),it.wnext=0,it.whave=it.wsize):(nt=it.wsize-it.wnext,nt>tt&&(nt=tt),it.window.set($.subarray(_-tt,_-tt+nt),it.wnext),tt-=nt,tt?(it.window.set($.subarray(_-tt,_),0),it.wnext=tt,it.whave=it.wsize):(it.wnext+=nt,it.wnext===it.wsize&&(it.wnext=0),it.whave<it.wsize&&(it.whave+=nt))),0},inflate$2=(et,$)=>{let _,tt,nt,it,rt,ot,lt,st,at,ct,dt,ut,ft,pt,St=0,gt,yt,vt,Ct,Et,Mt,Rt,At;const Dt=new Uint8Array(4);let It,Vt;const jt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(et)||!et.output||!et.input&&et.avail_in!==0)return Z_STREAM_ERROR$1;_=et.state,_.mode===TYPE&&(_.mode=TYPEDO),rt=et.next_out,nt=et.output,lt=et.avail_out,it=et.next_in,tt=et.input,ot=et.avail_in,st=_.hold,at=_.bits,ct=ot,dt=lt,At=Z_OK$1;e:for(;;)switch(_.mode){case HEAD:if(_.wrap===0){_.mode=TYPEDO;break}for(;at<16;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}if(_.wrap&2&&st===35615){_.wbits===0&&(_.wbits=15),_.check=0,Dt[0]=st&255,Dt[1]=st>>>8&255,_.check=crc32(_.check,Dt,2,0),st=0,at=0,_.mode=FLAGS;break}if(_.head&&(_.head.done=!1),!(_.wrap&1)||(((st&255)<<8)+(st>>8))%31){et.msg="incorrect header check",_.mode=BAD;break}if((st&15)!==Z_DEFLATED){et.msg="unknown compression method",_.mode=BAD;break}if(st>>>=4,at-=4,Rt=(st&15)+8,_.wbits===0&&(_.wbits=Rt),Rt>15||Rt>_.wbits){et.msg="invalid window size",_.mode=BAD;break}_.dmax=1<<_.wbits,_.flags=0,et.adler=_.check=1,_.mode=st&512?DICTID:TYPE,st=0,at=0;break;case FLAGS:for(;at<16;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}if(_.flags=st,(_.flags&255)!==Z_DEFLATED){et.msg="unknown compression method",_.mode=BAD;break}if(_.flags&57344){et.msg="unknown header flags set",_.mode=BAD;break}_.head&&(_.head.text=st>>8&1),_.flags&512&&_.wrap&4&&(Dt[0]=st&255,Dt[1]=st>>>8&255,_.check=crc32(_.check,Dt,2,0)),st=0,at=0,_.mode=TIME;case TIME:for(;at<32;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}_.head&&(_.head.time=st),_.flags&512&&_.wrap&4&&(Dt[0]=st&255,Dt[1]=st>>>8&255,Dt[2]=st>>>16&255,Dt[3]=st>>>24&255,_.check=crc32(_.check,Dt,4,0)),st=0,at=0,_.mode=OS;case OS:for(;at<16;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}_.head&&(_.head.xflags=st&255,_.head.os=st>>8),_.flags&512&&_.wrap&4&&(Dt[0]=st&255,Dt[1]=st>>>8&255,_.check=crc32(_.check,Dt,2,0)),st=0,at=0,_.mode=EXLEN;case EXLEN:if(_.flags&1024){for(;at<16;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}_.length=st,_.head&&(_.head.extra_len=st),_.flags&512&&_.wrap&4&&(Dt[0]=st&255,Dt[1]=st>>>8&255,_.check=crc32(_.check,Dt,2,0)),st=0,at=0}else _.head&&(_.head.extra=null);_.mode=EXTRA;case EXTRA:if(_.flags&1024&&(ut=_.length,ut>ot&&(ut=ot),ut&&(_.head&&(Rt=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Uint8Array(_.head.extra_len)),_.head.extra.set(tt.subarray(it,it+ut),Rt)),_.flags&512&&_.wrap&4&&(_.check=crc32(_.check,tt,ut,it)),ot-=ut,it+=ut,_.length-=ut),_.length))break e;_.length=0,_.mode=NAME;case NAME:if(_.flags&2048){if(ot===0)break e;ut=0;do Rt=tt[it+ut++],_.head&&Rt&&_.length<65536&&(_.head.name+=String.fromCharCode(Rt));while(Rt&&ut<ot);if(_.flags&512&&_.wrap&4&&(_.check=crc32(_.check,tt,ut,it)),ot-=ut,it+=ut,Rt)break e}else _.head&&(_.head.name=null);_.length=0,_.mode=COMMENT;case COMMENT:if(_.flags&4096){if(ot===0)break e;ut=0;do Rt=tt[it+ut++],_.head&&Rt&&_.length<65536&&(_.head.comment+=String.fromCharCode(Rt));while(Rt&&ut<ot);if(_.flags&512&&_.wrap&4&&(_.check=crc32(_.check,tt,ut,it)),ot-=ut,it+=ut,Rt)break e}else _.head&&(_.head.comment=null);_.mode=HCRC;case HCRC:if(_.flags&512){for(;at<16;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}if(_.wrap&4&&st!==(_.check&65535)){et.msg="header crc mismatch",_.mode=BAD;break}st=0,at=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),et.adler=_.check=0,_.mode=TYPE;break;case DICTID:for(;at<32;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}et.adler=_.check=zswap32(st),st=0,at=0,_.mode=DICT;case DICT:if(_.havedict===0)return et.next_out=rt,et.avail_out=lt,et.next_in=it,et.avail_in=ot,_.hold=st,_.bits=at,Z_NEED_DICT$1;et.adler=_.check=1,_.mode=TYPE;case TYPE:if($===Z_BLOCK||$===Z_TREES)break e;case TYPEDO:if(_.last){st>>>=at&7,at-=at&7,_.mode=CHECK;break}for(;at<3;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}switch(_.last=st&1,st>>>=1,at-=1,st&3){case 0:_.mode=STORED;break;case 1:if(fixedtables(_),_.mode=LEN_,$===Z_TREES){st>>>=2,at-=2;break e}break;case 2:_.mode=TABLE;break;case 3:et.msg="invalid block type",_.mode=BAD}st>>>=2,at-=2;break;case STORED:for(st>>>=at&7,at-=at&7;at<32;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}if((st&65535)!==(st>>>16^65535)){et.msg="invalid stored block lengths",_.mode=BAD;break}if(_.length=st&65535,st=0,at=0,_.mode=COPY_,$===Z_TREES)break e;case COPY_:_.mode=COPY;case COPY:if(ut=_.length,ut){if(ut>ot&&(ut=ot),ut>lt&&(ut=lt),ut===0)break e;nt.set(tt.subarray(it,it+ut),rt),ot-=ut,it+=ut,lt-=ut,rt+=ut,_.length-=ut;break}_.mode=TYPE;break;case TABLE:for(;at<14;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}if(_.nlen=(st&31)+257,st>>>=5,at-=5,_.ndist=(st&31)+1,st>>>=5,at-=5,_.ncode=(st&15)+4,st>>>=4,at-=4,_.nlen>286||_.ndist>30){et.msg="too many length or distance symbols",_.mode=BAD;break}_.have=0,_.mode=LENLENS;case LENLENS:for(;_.have<_.ncode;){for(;at<3;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}_.lens[jt[_.have++]]=st&7,st>>>=3,at-=3}for(;_.have<19;)_.lens[jt[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,It={bits:_.lenbits},At=inflate_table(CODES,_.lens,0,19,_.lencode,0,_.work,It),_.lenbits=It.bits,At){et.msg="invalid code lengths set",_.mode=BAD;break}_.have=0,_.mode=CODELENS;case CODELENS:for(;_.have<_.nlen+_.ndist;){for(;St=_.lencode[st&(1<<_.lenbits)-1],gt=St>>>24,yt=St>>>16&255,vt=St&65535,!(gt<=at);){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}if(vt<16)st>>>=gt,at-=gt,_.lens[_.have++]=vt;else{if(vt===16){for(Vt=gt+2;at<Vt;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}if(st>>>=gt,at-=gt,_.have===0){et.msg="invalid bit length repeat",_.mode=BAD;break}Rt=_.lens[_.have-1],ut=3+(st&3),st>>>=2,at-=2}else if(vt===17){for(Vt=gt+3;at<Vt;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}st>>>=gt,at-=gt,Rt=0,ut=3+(st&7),st>>>=3,at-=3}else{for(Vt=gt+7;at<Vt;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}st>>>=gt,at-=gt,Rt=0,ut=11+(st&127),st>>>=7,at-=7}if(_.have+ut>_.nlen+_.ndist){et.msg="invalid bit length repeat",_.mode=BAD;break}for(;ut--;)_.lens[_.have++]=Rt}}if(_.mode===BAD)break;if(_.lens[256]===0){et.msg="invalid code -- missing end-of-block",_.mode=BAD;break}if(_.lenbits=9,It={bits:_.lenbits},At=inflate_table(LENS,_.lens,0,_.nlen,_.lencode,0,_.work,It),_.lenbits=It.bits,At){et.msg="invalid literal/lengths set",_.mode=BAD;break}if(_.distbits=6,_.distcode=_.distdyn,It={bits:_.distbits},At=inflate_table(DISTS,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,It),_.distbits=It.bits,At){et.msg="invalid distances set",_.mode=BAD;break}if(_.mode=LEN_,$===Z_TREES)break e;case LEN_:_.mode=LEN;case LEN:if(ot>=6&&lt>=258){et.next_out=rt,et.avail_out=lt,et.next_in=it,et.avail_in=ot,_.hold=st,_.bits=at,inflate_fast(et,dt),rt=et.next_out,nt=et.output,lt=et.avail_out,it=et.next_in,tt=et.input,ot=et.avail_in,st=_.hold,at=_.bits,_.mode===TYPE&&(_.back=-1);break}for(_.back=0;St=_.lencode[st&(1<<_.lenbits)-1],gt=St>>>24,yt=St>>>16&255,vt=St&65535,!(gt<=at);){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}if(yt&&!(yt&240)){for(Ct=gt,Et=yt,Mt=vt;St=_.lencode[Mt+((st&(1<<Ct+Et)-1)>>Ct)],gt=St>>>24,yt=St>>>16&255,vt=St&65535,!(Ct+gt<=at);){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}st>>>=Ct,at-=Ct,_.back+=Ct}if(st>>>=gt,at-=gt,_.back+=gt,_.length=vt,yt===0){_.mode=LIT;break}if(yt&32){_.back=-1,_.mode=TYPE;break}if(yt&64){et.msg="invalid literal/length code",_.mode=BAD;break}_.extra=yt&15,_.mode=LENEXT;case LENEXT:if(_.extra){for(Vt=_.extra;at<Vt;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}_.length+=st&(1<<_.extra)-1,st>>>=_.extra,at-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=DIST;case DIST:for(;St=_.distcode[st&(1<<_.distbits)-1],gt=St>>>24,yt=St>>>16&255,vt=St&65535,!(gt<=at);){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}if(!(yt&240)){for(Ct=gt,Et=yt,Mt=vt;St=_.distcode[Mt+((st&(1<<Ct+Et)-1)>>Ct)],gt=St>>>24,yt=St>>>16&255,vt=St&65535,!(Ct+gt<=at);){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}st>>>=Ct,at-=Ct,_.back+=Ct}if(st>>>=gt,at-=gt,_.back+=gt,yt&64){et.msg="invalid distance code",_.mode=BAD;break}_.offset=vt,_.extra=yt&15,_.mode=DISTEXT;case DISTEXT:if(_.extra){for(Vt=_.extra;at<Vt;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}_.offset+=st&(1<<_.extra)-1,st>>>=_.extra,at-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){et.msg="invalid distance too far back",_.mode=BAD;break}_.mode=MATCH;case MATCH:if(lt===0)break e;if(ut=dt-lt,_.offset>ut){if(ut=_.offset-ut,ut>_.whave&&_.sane){et.msg="invalid distance too far back",_.mode=BAD;break}ut>_.wnext?(ut-=_.wnext,ft=_.wsize-ut):ft=_.wnext-ut,ut>_.length&&(ut=_.length),pt=_.window}else pt=nt,ft=rt-_.offset,ut=_.length;ut>lt&&(ut=lt),lt-=ut,_.length-=ut;do nt[rt++]=pt[ft++];while(--ut);_.length===0&&(_.mode=LEN);break;case LIT:if(lt===0)break e;nt[rt++]=_.length,lt--,_.mode=LEN;break;case CHECK:if(_.wrap){for(;at<32;){if(ot===0)break e;ot--,st|=tt[it++]<<at,at+=8}if(dt-=lt,et.total_out+=dt,_.total+=dt,_.wrap&4&&dt&&(et.adler=_.check=_.flags?crc32(_.check,nt,dt,rt-dt):adler32(_.check,nt,dt,rt-dt)),dt=lt,_.wrap&4&&(_.flags?st:zswap32(st))!==_.check){et.msg="incorrect data check",_.mode=BAD;break}st=0,at=0}_.mode=LENGTH;case LENGTH:if(_.wrap&&_.flags){for(;at<32;){if(ot===0)break e;ot--,st+=tt[it++]<<at,at+=8}if(_.wrap&4&&st!==(_.total&4294967295)){et.msg="incorrect length check",_.mode=BAD;break}st=0,at=0}_.mode=DONE;case DONE:At=Z_STREAM_END$1;break e;case BAD:At=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return et.next_out=rt,et.avail_out=lt,et.next_in=it,et.avail_in=ot,_.hold=st,_.bits=at,(_.wsize||dt!==et.avail_out&&_.mode<BAD&&(_.mode<CHECK||$!==Z_FINISH$1))&&updatewindow(et,et.output,et.next_out,dt-et.avail_out),ct-=et.avail_in,dt-=et.avail_out,et.total_in+=ct,et.total_out+=dt,_.total+=dt,_.wrap&4&&dt&&(et.adler=_.check=_.flags?crc32(_.check,nt,dt,et.next_out-dt):adler32(_.check,nt,dt,et.next_out-dt)),et.data_type=_.bits+(_.last?64:0)+(_.mode===TYPE?128:0)+(_.mode===LEN_||_.mode===COPY_?256:0),(ct===0&&dt===0||$===Z_FINISH$1)&&At===Z_OK$1&&(At=Z_BUF_ERROR),At},inflateEnd=et=>{if(inflateStateCheck(et))return Z_STREAM_ERROR$1;let $=et.state;return $.window&&($.window=null),et.state=null,Z_OK$1},inflateGetHeader=(et,$)=>{if(inflateStateCheck(et))return Z_STREAM_ERROR$1;const _=et.state;return _.wrap&2?(_.head=$,$.done=!1,Z_OK$1):Z_STREAM_ERROR$1},inflateSetDictionary=(et,$)=>{const _=$.length;let tt,nt,it;return inflateStateCheck(et)||(tt=et.state,tt.wrap!==0&&tt.mode!==DICT)?Z_STREAM_ERROR$1:tt.mode===DICT&&(nt=1,nt=adler32(nt,$,_,0),nt!==tt.check)?Z_DATA_ERROR$1:(it=updatewindow(et,$,_,_),it?(tt.mode=MEM,Z_MEM_ERROR$1):(tt.havedict=1,Z_OK$1))};inflate$3.inflateReset=inflateReset;inflate$3.inflateReset2=inflateReset2;inflate$3.inflateResetKeep=inflateResetKeep;inflate$3.inflateInit=inflateInit;inflate$3.inflateInit2=inflateInit2;inflate$3.inflate=inflate$2;inflate$3.inflateEnd=inflateEnd;inflate$3.inflateGetHeader=inflateGetHeader;inflate$3.inflateSetDictionary=inflateSetDictionary;inflate$3.inflateInfo="pako inflate (from Nodeca project)";function GZheader$1(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader$1;const zlib_inflate=inflate$3,utils=common,strings=strings$2,msg=messages,ZStream=zstream,GZheader=gzheader,toString=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(et){this.options=utils.assign({chunkSize:1024*64,windowBits:15,to:""},et||{});const $=this.options;$.raw&&$.windowBits>=0&&$.windowBits<16&&($.windowBits=-$.windowBits,$.windowBits===0&&($.windowBits=-15)),$.windowBits>=0&&$.windowBits<16&&!(et&&et.windowBits)&&($.windowBits+=32),$.windowBits>15&&$.windowBits<48&&($.windowBits&15||($.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream,this.strm.avail_out=0;let _=zlib_inflate.inflateInit2(this.strm,$.windowBits);if(_!==Z_OK)throw new Error(msg[_]);if(this.header=new GZheader,zlib_inflate.inflateGetHeader(this.strm,this.header),$.dictionary&&(typeof $.dictionary=="string"?$.dictionary=strings.string2buf($.dictionary):toString.call($.dictionary)==="[object ArrayBuffer]"&&($.dictionary=new Uint8Array($.dictionary)),$.raw&&(_=zlib_inflate.inflateSetDictionary(this.strm,$.dictionary),_!==Z_OK)))throw new Error(msg[_])}Inflate$1.prototype.push=function(et,$){const _=this.strm,tt=this.options.chunkSize,nt=this.options.dictionary;let it,rt,ot;if(this.ended)return!1;for($===~~$?rt=$:rt=$===!0?Z_FINISH:Z_NO_FLUSH,toString.call(et)==="[object ArrayBuffer]"?_.input=new Uint8Array(et):_.input=et,_.next_in=0,_.avail_in=_.input.length;;){for(_.avail_out===0&&(_.output=new Uint8Array(tt),_.next_out=0,_.avail_out=tt),it=zlib_inflate.inflate(_,rt),it===Z_NEED_DICT&&nt&&(it=zlib_inflate.inflateSetDictionary(_,nt),it===Z_OK?it=zlib_inflate.inflate(_,rt):it===Z_DATA_ERROR&&(it=Z_NEED_DICT));_.avail_in>0&&it===Z_STREAM_END&&_.state.wrap>0&&et[_.next_in]!==0;)zlib_inflate.inflateReset(_),it=zlib_inflate.inflate(_,rt);switch(it){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(it),this.ended=!0,!1}if(ot=_.avail_out,_.next_out&&(_.avail_out===0||it===Z_STREAM_END))if(this.options.to==="string"){let lt=strings.utf8border(_.output,_.next_out),st=_.next_out-lt,at=strings.buf2string(_.output,lt);_.next_out=st,_.avail_out=tt-st,st&&_.output.set(_.output.subarray(lt,lt+st),0),this.onData(at)}else this.onData(_.output.length===_.next_out?_.output:_.output.subarray(0,_.next_out));if(!(it===Z_OK&&ot===0)){if(it===Z_STREAM_END)return it=zlib_inflate.inflateEnd(this.strm),this.onEnd(it),this.ended=!0,!0;if(_.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(et){this.chunks.push(et)};Inflate$1.prototype.onEnd=function(et){et===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=et,this.msg=this.strm.msg};function inflate$1(et,$){const _=new Inflate$1($);if(_.push(et),_.err)throw _.msg||msg[_.err];return _.result}function inflateRaw$1(et,$){return $=$||{},$.raw=!0,inflate$1(et,$)}inflate$4.Inflate=Inflate$1;inflate$4.inflate=inflate$1;inflate$4.inflateRaw=inflateRaw$1;inflate$4.ungzip=inflate$1;inflate$4.constants=constants$2;const{Deflate,deflate,deflateRaw,gzip}=deflate$4,{Inflate,inflate,inflateRaw,ungzip}=inflate$4,constants$1=constants$2;pako$1.Deflate=Deflate;pako$1.deflate=deflate;pako$1.deflateRaw=deflateRaw;pako$1.gzip=gzip;pako$1.Inflate=Inflate;pako$1.inflate=inflate;pako$1.inflateRaw=inflateRaw;pako$1.ungzip=ungzip;pako$1.constants=constants$1;Object.defineProperty(ZLIBTextCompressor$1,"__esModule",{value:!0});const pako=pako$1;class ZLIBTextCompressor{constructor($){this.logger=$}compress($,_){if(_.length>0){const it=Math.min(_.length,ZLIBTextCompressor.MAX_DICTIONARY_SIZE);_=_.slice(0,it)}const tt={memLevel:ZLIBTextCompressor.Z_MEM_LEVEL,dictionary:_};return pako.deflateRaw($,tt)}decompress($,_){if(_.length>0){const it=Math.min(_.length,ZLIBTextCompressor.MAX_DICTIONARY_SIZE);_=_.slice(0,it)}const tt={to:"string",dictionary:_,chunkSize:4096};let nt="";try{nt=pako.inflateRaw($,tt)}catch(it){this.logger.error(`failed to decompress the string with error: [${it}]`)}return nt}}ZLIBTextCompressor$1.default=ZLIBTextCompressor;ZLIBTextCompressor.Z_MEM_LEVEL=9;ZLIBTextCompressor.MAX_DICTIONARY_SIZE=31744;var SignalingClientSubscribe$1={};Object.defineProperty(SignalingClientSubscribe$1,"__esModule",{value:!0});class SignalingClientSubscribe{constructor($,_,tt,nt,it,rt,ot,lt,st,at){this.attendeeId=$,this.sdpOffer=_,this.audioHost=tt,this.audioMuted=nt,this.audioCheckin=it,this.receiveStreamIds=rt,this.localVideoEnabled=ot,this.videoStreamDescriptions=lt,this.connectionTypeHasVideo=st,this.compressedSdpOffer=at,this.videoSubscriptionConfiguration=[]}}SignalingClientSubscribe$1.default=SignalingClientSubscribe;var VideoPreferences$1={},__importDefault$I=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(VideoPreferences$1,"__esModule",{value:!0});VideoPreferences$1.VideoPreferences=VideoPreferences$1.MutableVideoPreferences=VideoPreferences$1.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration=void 0;const SignalingClientVideoSubscriptionConfiguration_1=__importDefault$I(SignalingClientVideoSubscriptionConfiguration$1);function convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration(et,$,_){if(et.transceiverController.getMidForGroupId===void 0||et.videoStreamIndex.attendeeIdForGroupId===void 0||_===void 0)return[];const tt=new Array,nt=new Map,it=new Map;for(const rt of $){const ot=et.transceiverController.getMidForGroupId(rt);if(ot===void 0)continue;const lt=et.videoStreamIndex.attendeeIdForGroupId(rt);nt.set(lt,ot),it.set(lt,rt)}for(const rt of _){const ot=new SignalingClientVideoSubscriptionConfiguration_1.default,lt=nt.get(rt.attendeeId);lt!==void 0&&(ot.mid=lt,ot.attendeeId=rt.attendeeId,ot.groupId=it.get(rt.attendeeId),ot.priority=Number.MAX_SAFE_INTEGER-rt.priority,ot.targetBitrateKbps=rt.targetSizeToBitrateKbps(rt.targetSize),ot.qualityAdaptationPreference=rt.degradationPreference,tt.push(ot))}return tt}VideoPreferences$1.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration=convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration;class ObjectSet{constructor($=[]){this.items=$}static default(){return new ObjectSet([])}[Symbol.iterator](){let $=0;const _=this.items;return{next(){return $<_.length?{done:!1,value:_[$++]}:{done:!0,value:null}}}}first(){return this.items[0]}add($){this.items.push($)}replaceFirst($,_){const tt=this.items.findIndex(_);tt===-1?this.items.push($):this.has($)?this.items.splice(tt,1):this.items[tt]=$}remove($){this.items=this.items.filter(_=>!_.equals($))}clear(){this.items=[]}isEmpty(){return this.items.length===0}equals($){if($===this)return!0;if($.items.length!==this.items.length)return!1;for(const _ of this.items)if(!$.items.some(tt=>tt.equals(_)))return!1;return!0}has($){return this.items.some(_=>_.equals($))}some($){return this.items.some($)}clone(){return new ObjectSet([...this.items])}sort(){this.items.sort(($,_)=>$.partialCompare(_))}modify(){return new SetBuilder(this)}}class SetBuilder{constructor($=new ObjectSet){this.items=$,this.copied=!1}cow(){this.copied||(this.items=this.items.clone(),this.copied=!0)}add($){this.items.has($)||(this.cow(),this.items.add($))}replaceFirst($,_){this.items.has($)&&!this.items.some(_)||(this.cow(),this.items.replaceFirst($,_))}remove($){this.items.has($)&&(this.cow(),this.items.remove($))}some($){return this.items.some($)}clear(){this.items.isEmpty()||(this.cow(),this.items.clear())}build(){return this.copied&&this.items.sort(),this.copied=!1,this.items}}class MutableVideoPreferences{constructor($){this.builder=$}add($){this.builder.add($)}replaceFirst($,_){this.builder.replaceFirst($,_)}remove($){this.builder.remove($)}some($){return this.builder.some($)}clear(){this.builder.clear()}build(){return new VideoPreferences(this.builder.build())}}VideoPreferences$1.MutableVideoPreferences=MutableVideoPreferences;class VideoPreferences{constructor($){this.items=$}static prepare(){return new MutableVideoPreferences(new SetBuilder)}static default(){return new VideoPreferences(ObjectSet.default())}[Symbol.iterator](){return this.items[Symbol.iterator]()}highestPriority(){var $;return($=this.items.first())===null||$===void 0?void 0:$.priority}sorted(){return this.items[Symbol.iterator]()}equals($){return $===this||this.items.equals($.items)}modify(){return new MutableVideoPreferences(this.items.modify())}some($){return this.items.some($)}isEmpty(){return this.items.isEmpty()}clone(){const $=VideoPreferences.prepare();for(const _ of this.items)$.add(_.clone());return $.build()}}VideoPreferences$1.VideoPreferences=VideoPreferences;VideoPreferences$1.default=VideoPreferences;var __awaiter$t=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$H=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(SubscribeAndReceiveSubscribeAckTask$1,"__esModule",{value:!0});const MeetingSessionStatus_1=__importDefault$H(MeetingSessionStatus$1),MeetingSessionStatusCode_1$1=__importDefault$H(MeetingSessionStatusCode),SDP_1=__importDefault$H(SDP$1),ZLIBTextCompressor_1=__importDefault$H(ZLIBTextCompressor$1),ServerSideNetworkAdaption_1$3=ServerSideNetworkAdaption,SignalingClientEventType_1=__importDefault$H(SignalingClientEventType),SignalingClientSubscribe_1=__importDefault$H(SignalingClientSubscribe$1),SignalingProtocol_js_1$3=SignalingProtocol,VideoPreferences_1$2=VideoPreferences$1,BaseTask_1$4=__importDefault$H(BaseTask$1);class SubscribeAndReceiveSubscribeAckTask extends BaseTask_1$4.default{constructor($){super($.logger),this.context=$,this.taskName="SubscribeAndReceiveSubscribeAckTask",this.taskCanceler=null,this.textCompressor=new ZLIBTextCompressor_1.default($.logger)}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$t(this,void 0,void 0,function*(){let $="";if(this.context.peer&&this.context.peer.localDescription&&($=new SDP_1.default(this.context.peer.localDescription.sdp).withUnifiedPlanFormat().sdp),!this.context.enableSimulcast){let st=0,at=0;this.context.videoCaptureAndEncodeParameter&&(st=this.context.videoCaptureAndEncodeParameter.captureFrameRate(),at=this.context.videoCaptureAndEncodeParameter.encodeBitrates()[0]);const ct={rid:"hi",maxBitrate:at*1e3,maxFramerate:st,active:!0};this.context.videoStreamIndex.integrateUplinkPolicyDecision([ct])}const _=this.fixUpSubscriptionOrder($,this.context.videoSubscriptions),tt=this.context.videoDuplexMode===SignalingProtocol_js_1$3.SdkStreamServiceType.TX||this.context.videoDuplexMode===SignalingProtocol_js_1$3.SdkStreamServiceType.DUPLEX;let nt,it=$;if((this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension===void 0||!this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension())&&(it=new SDP_1.default(it).withoutDependencyDescriptorRtpHeaderExtension().sdp),this.context.serverSupportsCompression){const st=this.context.previousSdpOffer?this.context.previousSdpOffer.sdp:"";nt=this.textCompressor.compress(it,st),this.context.logger.info(`Compressed the SDP message from ${it.length} to ${nt.length} bytes.`),$=""}this.context.previousSdpOffer=new SDP_1.default($);const rt=new SignalingClientSubscribe_1.default(this.context.meetingSessionConfiguration.credentials.attendeeId,$,this.context.meetingSessionConfiguration.urls.audioHostURL,this.context.realtimeController.realtimeIsLocalAudioMuted(),!1,_,tt,this.context.videoStreamIndex.localStreamDescriptions(),!0,nt);this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption!==void 0&&!ServerSideNetworkAdaption_1$3.serverSideNetworkAdaptionIsNoneOrDefault(this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption())&&this.context.videoDownlinkBandwidthPolicy.getVideoPreferences!==void 0&&(rt.videoSubscriptionConfiguration=VideoPreferences_1$2.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration(this.context,_.map(st=>st===0?0:this.context.videoStreamIndex.groupIdForStreamId(st)),this.context.videoDownlinkBandwidthPolicy.getVideoPreferences())),this.context.logger.info(`sending subscribe: ${JSON.stringify(rt)}`),this.context.signalingClient.subscribe(rt);const ot=yield this.receiveSubscribeAck();this.context.logger.info(`got subscribe ack: ${JSON.stringify(ot)}`);let lt="";ot.compressedSdpAnswer&&ot.compressedSdpAnswer.length?(lt=this.textCompressor.decompress(ot.compressedSdpAnswer,this.context.previousSdpAnswerAsString),lt.length===0&&(this.context.sdpAnswer="",this.context.previousSdpAnswerAsString="",this.logAndThrow("Error occurred while trying to decompress the SDP answer.")),this.context.logger.info(`Decompressed the SDP message from ${ot.compressedSdpAnswer.length} to ${lt.length} bytes.`),this.context.sdpAnswer=lt):this.context.sdpAnswer=ot.sdpAnswer,this.context.previousSdpAnswerAsString=this.context.sdpAnswer,this.context.videoStreamIndex.integrateSubscribeAckFrame(ot)})}fixUpSubscriptionOrder($,_){if(this.context.transceiverController.getMidForStreamId===void 0)return _;const tt=new Map;for(const rt of _){const ot=this.context.transceiverController.getMidForStreamId(rt);if(ot===void 0){rt!==0&&this.logger.warn(`Could not find MID for stream ID: ${rt}`);continue}tt.set(ot,rt)}const nt=new SDP_1.default($).mediaSections(),it=[];for(const rt of nt)if(rt.mediaType==="video")if(rt.direction==="recvonly"){const ot=tt.get(rt.mid);if(ot===void 0){this.logger.warn(`Could not find stream ID for MID: ${rt.mid}`);continue}it.push(ot)}else it.push(0);return this.logger.info(`Fixed up ${JSON.stringify(_)} to ${JSON.stringify(it)} (may be same))}`),it}receiveSubscribeAck(){return new Promise(($,_)=>{const tt=this.context;class nt{constructor(ot){this.signalingClient=ot}cancel(){this.signalingClient.removeObserver(this),_(new Error("SubscribeAndReceiveSubscribeAckTask got canceled while waiting for SdkSubscribeAckFrame"))}handleSignalingClientEvent(ot){if(ot.isConnectionTerminated()){const st=`SubscribeAndReceiveSubscribeAckTask connection was terminated with code ${ot.closeCode} and reason: ${ot.closeReason}`;tt.logger.warn(st);let at=MeetingSessionStatusCode_1$1.default.TaskFailed;ot.closeCode>=4500&&ot.closeCode<4600&&(at=MeetingSessionStatusCode_1$1.default.SignalingInternalServerError),tt.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1.default(at),new Error(st));return}if(ot.type!==SignalingClientEventType_1.default.ReceivedSignalFrame||ot.message.type!==SignalingProtocol_js_1$3.SdkSignalFrame.Type.SUBSCRIBE_ACK)return;this.signalingClient.removeObserver(this);const lt=ot.message.suback;$(lt)}}const it=new nt(this.context.signalingClient);this.context.signalingClient.registerObserver(it),this.taskCanceler=it})}}SubscribeAndReceiveSubscribeAckTask$1.default=SubscribeAndReceiveSubscribeAckTask;var TimeoutTask$1={},__awaiter$s=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$G=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(TimeoutTask$1,"__esModule",{value:!0});const TimeoutScheduler_1$1=__importDefault$G(TimeoutScheduler$1),BaseTask_1$3=__importDefault$G(BaseTask$1);class TimeoutTask extends BaseTask_1$3.default{constructor($,_,tt){super($),this.taskToRunBeforeTimeout=_,this.timeoutMs=tt,this.taskName=`Timeout${this.timeoutMs}ms`,_.setParent(this)}cancel(){this.logger.info(`canceling timeout task ${this.name()} subtask ${this.taskToRunBeforeTimeout}`),this.taskToRunBeforeTimeout.cancel()}run(){return __awaiter$s(this,void 0,void 0,function*(){const $=new TimeoutScheduler_1$1.default(this.timeoutMs);$.start(()=>{this.logger.info(`timeout reached for task ${this.name()}`),this.taskToRunBeforeTimeout.cancel()});try{yield this.taskToRunBeforeTimeout.run()}finally{$.stop()}this.logger.info(`timeout task ${this.name()} completed`)})}}TimeoutTask$1.default=TimeoutTask;var WaitForAttendeePresenceTask$1={},__awaiter$r=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$F=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(WaitForAttendeePresenceTask$1,"__esModule",{value:!0});const MeetingSessionStatusCode_1=__importDefault$F(MeetingSessionStatusCode),BaseTask_1$2=__importDefault$F(BaseTask$1);class WaitForAttendeePresenceTask extends BaseTask_1$2.default{constructor($){super($.logger),this.context=$,this.taskName="WaitForAttendeePresenceTask"}cancel(){if(this.cancelPromise){const $=new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1.default.NoAttendeePresent}`);this.cancelPromise($),delete this.cancelPromise}}run(){return __awaiter$r(this,void 0,void 0,function*(){const $=this.context.meetingSessionConfiguration.credentials.attendeeId;return new Promise((_,tt)=>{const nt=(it,rt,ot,lt,st)=>{$===it&&rt&&(this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(nt),_(),delete this.cancelPromise)};this.cancelPromise=it=>{this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(nt),tt(it)},this.context.realtimeController.realtimeSubscribeToAttendeeIdPresence(nt)})})}}WaitForAttendeePresenceTask$1.default=WaitForAttendeePresenceTask;var DefaultTransceiverController$1={},RedundantAudioEncoder$1={};Object.defineProperty(RedundantAudioEncoder$1,"__esModule",{value:!0});class RedundantAudioEncoder{constructor(){this.maxRedPacketSizeBytes=1024,this.maxAudioPayloadSizeBytes=1e3,this.maxRedTimestampOffset=16384,this.redHeaderSizeBytes=4,this.redLastHeaderSizeBytes=1,this.redPacketizationTime=960,this.redPacketDistance=2,this.maxRedEncodings=2,this.redMaxRecoveryDistance=this.redPacketDistance*this.maxRedEncodings+1,this.maxEncodingHistorySize=10,this.numRedundantEncodings=0,this.redundancyEnabled=!0,this.lossReportInterval=48e3*5,this.maxOutOfOrderPacketDistance=16,this.OPUS_BAD_ARG=-1,this.OPUS_INVALID_PACKET=-4,this.OPUS_MAX_OPUS_FRAMES=48,this.OPUS_MAX_FRAME_SIZE_BYTES=1275,this.encodingHistory=new Array,this.opusPayloadType=0,this.redPayloadType=0,this.initializePacketLogs()}static initializeWorker(){RedundantAudioEncoder.log("Initializing RedundantAudioEncoder");const $=new RedundantAudioEncoder;self.RTCRtpScriptTransformer&&(self.onrtctransform=_=>{_.transformer.options.type==="SenderTransform"?$.setupSenderTransform(_.transformer.readable,_.transformer.writable):_.transformer.options.type==="ReceiverTransform"?$.setupReceiverTransform(_.transformer.readable,_.transformer.writable):_.transformer.options.type==="PassthroughTransform"&&$.setupPassthroughTransform(_.transformer.readable,_.transformer.writable)}),self.onmessage=_=>{_.data.msgType==="StartRedWorker"?($.setupSenderTransform(_.data.send.readable,_.data.send.writable),$.setupReceiverTransform(_.data.receive.readable,_.data.receive.writable)):_.data.msgType==="PassthroughTransform"?($.setupPassthroughTransform(_.data.send.readable,_.data.send.writable),$.setupPassthroughTransform(_.data.receive.readable,_.data.receive.writable)):_.data.msgType==="RedPayloadType"?$.setRedPayloadType(_.data.payloadType):_.data.msgType==="OpusPayloadType"?$.setOpusPayloadType(_.data.payloadType):_.data.msgType==="UpdateNumRedundantEncodings"?$.setNumRedundantEncodings(_.data.numRedundantEncodings):_.data.msgType==="Enable"?$.setRedundancyEnabled(!0):_.data.msgType==="Disable"&&$.setRedundancyEnabled(!1)}}static log($){RedundantAudioEncoder.shouldLog&&self.postMessage({type:"REDWorkerLog",log:`[AudioRed] ${$}`})}static getNumRedundantEncodingsForPacketLoss($){let _=0,tt=!1;return $<=8?_=0:$<=18?_=1:$<=75?_=2:(_=0,tt=!0),[_,tt]}setupPassthroughTransform($,_){RedundantAudioEncoder.log("Setting up passthrough transform"),$.pipeTo(_)}setupSenderTransform($,_){RedundantAudioEncoder.log("Setting up sender RED transform");const tt=new TransformStream({transform:this.senderTransform.bind(this)});$.pipeThrough(tt).pipeTo(_)}setupReceiverTransform($,_){RedundantAudioEncoder.log("Setting up receiver RED transform");const tt=new TransformStream({transform:this.receivePacketLogTransform.bind(this)});$.pipeThrough(tt).pipeTo(_)}setRedPayloadType($){this.redPayloadType=$,RedundantAudioEncoder.log(`red payload type set to ${this.redPayloadType}`)}setOpusPayloadType($){this.opusPayloadType=$,RedundantAudioEncoder.log(`opus payload type set to ${this.opusPayloadType}`)}setNumRedundantEncodings($){this.numRedundantEncodings=$,this.numRedundantEncodings>this.maxRedEncodings&&(this.numRedundantEncodings=this.maxRedEncodings),RedundantAudioEncoder.log(`Updated numRedundantEncodings to ${this.numRedundantEncodings}`)}setRedundancyEnabled($){this.redundancyEnabled=$,RedundantAudioEncoder.log(`redundancy ${this.redundancyEnabled?"enabled":"disabled"}`)}enqueueAudioFrameIfPayloadSizeIsValid($,_){$.data.byteLength>this.maxAudioPayloadSizeBytes||_.enqueue($)}senderTransform($,_){if($.getMetadata().payloadType!==this.redPayloadType){this.enqueueAudioFrameIfPayloadSizeIsValid($,_);return}const nt=this.getPrimaryPayload($.timestamp,$.data);if(!nt){this.enqueueAudioFrameIfPayloadSizeIsValid($,_);return}const it=this.encode($.timestamp,nt);if(!it){this.enqueueAudioFrameIfPayloadSizeIsValid($,_);return}$.data=it,this.enqueueAudioFrameIfPayloadSizeIsValid($,_)}getPrimaryPayload($,_){const tt=this.splitEncodings($,_);return!tt||tt.length<1?null:tt[tt.length-1].payload}splitEncodings($,_,tt=!1,nt=void 0){const it=new DataView(_);let rt=it.byteLength,ot=0,lt=0,st=0,at=0,ct=!1;const dt=new Array,ut=new Array,ft=new Array;for(;rt>0;)if(ct=(it.getUint8(at)&128)===0,ct){if((it.getUint8(at)&127)!==this.opusPayloadType||(ot+=this.redLastHeaderSizeBytes,lt+=this.redLastHeaderSizeBytes,ot>=it.byteLength))return null;st=it.byteLength-ot;break}else{if(rt<this.redHeaderSizeBytes)return null;const Ct=((it.getUint8(at+2)&3)<<8)+it.getUint8(at+3);ut.push(Ct);const Et=it.getUint16(at+1)>>2,Mt=$-Et;ft.push(Mt),ot+=Ct+this.redHeaderSizeBytes,lt+=this.redHeaderSizeBytes,at+=this.redHeaderSizeBytes,rt-=this.redHeaderSizeBytes}if(!ct)return nt!==void 0?(dt.push({payload:_,isRedundant:!1,seq:nt}),dt):null;let pt=lt;for(let Ct=0;Ct<ft.length;Ct++){const Et=new ArrayBuffer(ut[Ct]);new Uint8Array(Et).set(new Uint8Array(it.buffer,pt,ut[Ct]),0);const Rt={timestamp:ft[Ct],payload:Et,isRedundant:!0};tt&&(Rt.hasFec=this.opusPacketHasFec(new DataView(Et),Et.byteLength)),dt.push(Rt),pt+=ut[Ct]}const St=it.byteLength-st,gt=new ArrayBuffer(st);new Uint8Array(gt).set(new Uint8Array(it.buffer,St,st),0);const vt={timestamp:$,payload:gt,isRedundant:!1,seq:nt};return tt&&(vt.hasFec=this.opusPacketHasFec(new DataView(gt),gt.byteLength)),dt.push(vt),dt}encode($,_){const tt=_.byteLength;if(tt===0||tt>=this.maxRedPacketSizeBytes||tt>=this.maxAudioPayloadSizeBytes)return null;const nt=this.numRedundantEncodings;let it=this.redLastHeaderSizeBytes,rt=tt,ot=this.maxAudioPayloadSizeBytes-tt-it;const lt=new Array,st=new Array;if(this.redundancyEnabled){let ft=this.uint32WrapAround($-this.redPacketizationTime*this.redPacketDistance);for(let pt=0;pt<nt&&!(this.uint32WrapAround($-ft)>=this.maxRedTimestampOffset);pt++){let St=ft,gt=this.encodingHistory.find(yt=>yt.timestamp===St);if(gt||(St=this.uint32WrapAround(ft-this.redPacketizationTime),gt=this.encodingHistory.find(yt=>yt.timestamp===St)),gt){const yt=gt.payload.byteLength;if(ot<this.redHeaderSizeBytes+yt)break;ot-=this.redHeaderSizeBytes+yt,it+=this.redHeaderSizeBytes,rt+=yt,lt.unshift(gt.timestamp),st.unshift(gt.payload)}ft-=this.redPacketizationTime*this.redPacketDistance,ft=this.uint32WrapAround(ft)}}const at=new ArrayBuffer(it+rt),ct=new DataView(at);let dt=0;for(let ft=0;ft<lt.length;ft++){const pt=$-lt[ft];ct.setUint8(dt,this.opusPayloadType|128),ct.setUint16(dt+1,pt<<2|st[ft].byteLength>>8),ct.setUint8(dt+3,st[ft].byteLength&255),dt+=this.redHeaderSizeBytes}ct.setUint8(dt,this.opusPayloadType),dt+=this.redLastHeaderSizeBytes;const ut=new Uint8Array(at);for(let ft=0;ft<st.length;ft++)ut.set(new Uint8Array(st[ft]),dt),dt+=st[ft].byteLength;return ut.set(new Uint8Array(_),dt),dt+=_.byteLength,dt!==it+rt?null:(this.updateEncodingHistory($,_),at)}updateEncodingHistory($,_){for(const nt of this.encodingHistory){const it=this.redPacketizationTime*this.redMaxRecoveryDistance;if($-nt.timestamp>=it)this.encodingHistory.shift();else break}const tt=new DataView(_);(this.opusPacketIsCeltOnly(tt)||this.opusPacketHasVoiceActivity(tt,tt.byteLength)>0)&&(this.encodingHistory.length+1>this.maxEncodingHistorySize&&(this.encodingHistory.length=0),this.encodingHistory.push({timestamp:$,payload:_}))}initializePacketLogs(){const $=this.maxOutOfOrderPacketDistance+this.redMaxRecoveryDistance;this.primaryPacketLog={window:new Array($),index:0,windowSize:$},this.redRecoveryLog={window:new Array($),index:0,windowSize:$},this.fecRecoveryLog={window:new Array($),index:0,windowSize:$},this.totalAudioPacketsExpected=0,this.totalAudioPacketsLost=0,this.totalAudioPacketsRecoveredRed=0,this.totalAudioPacketsRecoveredFec=0}receivePacketLogTransform($,_){const tt=$.getMetadata();if(tt.payloadType!==this.redPayloadType){this.enqueueAudioFrameIfPayloadSizeIsValid($,_);return}const nt=this.splitEncodings($.timestamp,$.data,!0,tt.sequenceNumber);if(!nt){this.enqueueAudioFrameIfPayloadSizeIsValid($,_);return}for(let it=nt.length-1;it>=0;it--)this.updateLossStats(nt[it])&&(this.updateRedStats(nt[it]),this.updateFecStats(nt[it]));this.maybeReportLossStats(tt.synchronizationSource,nt[nt.length-1].timestamp),this.enqueueAudioFrameIfPayloadSizeIsValid($,_)}updateLossStats($){if($.isRedundant)return!0;const _=$.timestamp,tt=$.seq;if(this.totalAudioPacketsExpected===0)return this.totalAudioPacketsExpected=1,this.newestSequenceNumber=tt,this.addTimestamp(this.primaryPacketLog,_),!0;const nt=this.int16(tt-this.newestSequenceNumber);return nt<-this.maxOutOfOrderPacketDistance?!1:(nt<0?this.hasTimestamp(this.primaryPacketLog,_)||(this.totalAudioPacketsLost>0&&this.totalAudioPacketsLost--,this.addTimestamp(this.primaryPacketLog,_),this.removeFromRecoveryWindows(_)):nt>1&&(this.totalAudioPacketsLost+=nt-1),nt>0&&(this.totalAudioPacketsExpected+=nt,this.newestSequenceNumber=$.seq,this.addTimestamp(this.primaryPacketLog,_)),!0)}updateRedStats($){if(!$.isRedundant||this.totalAudioPacketsLost===0)return;const _=$.timestamp;this.hasTimestamp(this.primaryPacketLog,_)||(this.hasTimestamp(this.redRecoveryLog,_)||(this.totalAudioPacketsRecoveredRed++,this.addTimestamp(this.redRecoveryLog,_)),this.removeTimestamp(this.fecRecoveryLog,_)&&this.totalAudioPacketsRecoveredFec>0&&this.totalAudioPacketsRecoveredFec--)}updateFecStats($){if(!$.hasFec||this.totalAudioPacketsLost===0)return;const _=$.timestamp-this.redPacketizationTime;this.hasTimestamp(this.primaryPacketLog,_)||this.hasTimestamp(this.redRecoveryLog,_)||this.hasTimestamp(this.fecRecoveryLog,_)||(this.totalAudioPacketsRecoveredFec++,this.addTimestamp(this.fecRecoveryLog,_))}maybeReportLossStats($,_){_===void 0||_-this.lastLossReportTimestamp<this.lossReportInterval||(RedundantAudioEncoder.shouldReportStats&&self.postMessage({type:"RedundantAudioEncoderStats",ssrc:$,totalAudioPacketsLost:this.totalAudioPacketsLost,totalAudioPacketsExpected:this.totalAudioPacketsExpected,totalAudioPacketsRecoveredRed:this.totalAudioPacketsRecoveredRed,totalAudioPacketsRecoveredFec:this.totalAudioPacketsRecoveredFec}),this.lastLossReportTimestamp=_)}addTimestamp($,_){_!==void 0&&($.window[$.index]=_,$.index=($.index+1)%$.windowSize)}hasTimestamp($,_){return!!$.window.find(nt=>nt===_)}removeTimestamp($,_){const tt=$.window.indexOf(_);return tt>=0?($.window[tt]=void 0,!0):!1}removeFromRecoveryWindows($){let _=this.removeTimestamp(this.redRecoveryLog,$);_&&this.totalAudioPacketsRecoveredRed>0&&this.totalAudioPacketsRecoveredRed--,_=this.removeTimestamp(this.fecRecoveryLog,$),_&&this.totalAudioPacketsRecoveredFec>0&&this.totalAudioPacketsRecoveredFec--}uint32WrapAround($){let tt=$;return $>=4294967296?tt=$-4294967296:$<0&&(tt=4294967296+$),tt}int16($){return $<<16>>16}opusPacketIsCeltOnly($){return!!($.getUint8(0)&128)}opusPacketGetSamplesPerFrame($,_){_=Math.round(_),_=Math.min(Math.max(_,-Math.pow(2,32)),Math.pow(2,32)-1);let tt,nt;return this.opusPacketIsCeltOnly($)?(nt=$.getUint8(0)>>3&3,tt=(_<<nt)/400):($.getUint8(0)&96)===96?tt=$.getUint8(0)&8?_/50:_/100:(nt=$.getUint8(0)>>3&3,nt===3?tt=_*60/1e3:tt=(_<<nt)/100),tt}opusNumSilkFrames($){let _=this.opusPacketGetSamplesPerFrame($,48e3)/48;switch(_<10&&(_=10),_){case 10:case 20:return 1;case 40:return 2;case 60:return 3;default:return 0}}opusPacketGetNumChannels($){return $.getUint8(0)&4?2:1}opusParseSize($,_,tt,nt){return tt<1?(nt[0]=-1,-1):$.getUint8(_)<252?(nt[0]=$.getUint8(_),1):tt<2?(nt[0]=-1,-1):(nt[0]=4*$.getUint8(_+1)+$.getUint8(_),2)}opusPacketParseImpl($,_,tt,nt,it,rt,ot,lt){if(!rt||_<0)return this.OPUS_BAD_ARG;if(_===0)return this.OPUS_INVALID_PACKET;let st,at,ct=0,dt=!1;const ut=$.getUint8(0);nt&&(nt[0]=ut);let ft=_-1,pt=1,St=ft;switch(ut&3){case 0:st=1;break;case 1:if(st=2,dt=!0,!tt){if(ft&1)return this.OPUS_INVALID_PACKET;St=ft/2,rt[0][0]=St}break;case 2:if(st=2,at=this.opusParseSize($,pt,ft,rt[0]),ft-=at,rt[0][0]<0||rt[0][0]>ft)return this.OPUS_INVALID_PACKET;pt+=at,St=ft-rt[0][0];break;default:if(ft<1)return this.OPUS_INVALID_PACKET;const gt=$.getUint8(pt++);if(--ft,st=gt&63,st<=0)return this.OPUS_INVALID_PACKET;if(this.opusPacketGetSamplesPerFrame($,48e3)*st>5760)return this.OPUS_INVALID_PACKET;if(gt&64){let vt,Ct;do{if(ft<=0)return this.OPUS_INVALID_PACKET;vt=$.getUint8(pt++),--ft,Ct=vt===255?254:vt,ft-=Ct,ct+=Ct}while(vt===255)}if(ft<0)return this.OPUS_INVALID_PACKET;if(dt=!(gt&128),dt){if(!tt){if(St=Math.trunc(ft/st),St*st!==ft)return this.OPUS_INVALID_PACKET;for(let vt=0;vt<st-1;++vt)rt[vt][0]=St}}else{St=ft;for(let vt=0;vt<st-1;++vt){if(at=this.opusParseSize($,pt,ft,rt[vt]),ft-=at,rt[vt][0]<0||rt[vt][0]>ft)return this.OPUS_INVALID_PACKET;pt+=at,St-=at+rt[vt][0]}if(St<0)return this.OPUS_INVALID_PACKET}}if(tt){if(at=this.opusParseSize($,pt,ft,rt[st-1]),ft-=at,rt[st-1][0]<0||rt[st-1][0]>ft)return this.OPUS_INVALID_PACKET;if(pt+=at,dt){if(rt[st-1][0]*st>ft)return this.OPUS_INVALID_PACKET;for(let gt=0;gt<st-1;++gt)rt[gt][0]=rt[st-1][0]}else if(!(at+rt[st-1][0]<=St))return this.OPUS_INVALID_PACKET}else{if(St>this.OPUS_MAX_FRAME_SIZE_BYTES)return this.OPUS_INVALID_PACKET;rt[st-1][0]=St}ot&&(ot[0]=pt);for(let gt=0;gt<st;++gt)it&&(it[gt][0]=pt),pt+=rt[gt][0];return lt&&(lt[0]=pt+ct),st}opusPacketParse($,_,tt,nt,it,rt){return this.opusPacketParseImpl($,_,!1,tt,nt,it,rt,null)}opusPacketHasVoiceActivity($,_){if(!$||_<=0)return 0;if(this.opusPacketIsCeltOnly($))return-1;const tt=this.opusNumSilkFrames($);if(tt===0)return-1;const nt=new Array(this.OPUS_MAX_OPUS_FRAMES),it=new Array(this.OPUS_MAX_OPUS_FRAMES);for(let ot=0;ot<this.OPUS_MAX_OPUS_FRAMES;++ot)nt[ot]=[void 0],it[ot]=[void 0];const rt=this.opusPacketParse($,_,null,nt,it,null);if(rt<0)return-1;for(let ot=0;ot<rt;++ot){if(it[ot][0]<1)continue;if($.getUint8(nt[ot][0])>>8-tt||this.opusPacketGetNumChannels($)===2&&$.getUint8(nt[ot][0])<<tt+1>>8-tt)return 1}return 0}opusPacketHasFec($,_){if(!$||_<=0||this.opusPacketIsCeltOnly($))return!1;const tt=new Array(this.OPUS_MAX_OPUS_FRAMES),nt=new Array(this.OPUS_MAX_OPUS_FRAMES);for(let lt=0;lt<this.OPUS_MAX_OPUS_FRAMES;++lt)tt[lt]=[void 0],nt[lt]=[void 0];if(this.opusPacketParse($,_,null,tt,nt,null)<0||nt[0][0]<=1)return!1;const rt=this.opusNumSilkFrames($);if(rt===0)return!1;const ot=this.opusPacketGetNumChannels($);if(ot!==1&&ot!==2)return!1;for(let lt=0;lt<ot;lt++)if($.getUint8(tt[0][0])&128>>(lt+1)*(rt+1)-1)return!0;return!1}}RedundantAudioEncoder$1.default=RedundantAudioEncoder;RedundantAudioEncoder.shouldLog=!1;RedundantAudioEncoder.shouldReportStats=!1;var RedundantAudioEncoderWorkerCode$1={};Object.defineProperty(RedundantAudioEncoderWorkerCode$1,"__esModule",{value:!0});const RedundantAudioEncoderWorkerCode=`class RedundantAudioEncoder {
    constructor() {
        // Each payload must be less than 1024 bytes to fit the 10 bit block length
        this.maxRedPacketSizeBytes = 1 << 10;
        // Limit payload to 1000 bytes to handle small MTU. 1000 is chosen because in Chromium-based browsers, writing audio
        // payloads larger than 1000 bytes using the WebRTC Insertable Streams API (which is used to enable dynamic audio
        // redundancy) will cause an error to be thrown and cause audio flow to permanently stop. See
        // https://crbug.com/1248479.
        this.maxAudioPayloadSizeBytes = 1000;
        // Each payload can encode a timestamp delta of 14 bits
        this.maxRedTimestampOffset = 1 << 14;
        // 4 byte RED header
        this.redHeaderSizeBytes = 4;
        // reduced size for last RED header
        this.redLastHeaderSizeBytes = 1;
        // P-Time for Opus 20 msec packets
        // We do not support other p-times or clock rates
        this.redPacketizationTime = 960;
        // distance between redundant payloads, Opus FEC handles a distance of 1
        // TODO(https://issues.amazon.com/issues/ChimeSDKAudio-55):
        // Consider making this dynamic
        this.redPacketDistance = 2;
        // maximum number of redundant payloads per RTP packet
        this.maxRedEncodings = 2;
        // Maximum number of encodings that can be recovered with a single RED packet, assuming the primary and redundant
        // payloads have FEC.
        this.redMaxRecoveryDistance = this.redPacketDistance * this.maxRedEncodings + 1;
        // maximum history of prior payloads to keep
        // generally we will expire old entries based on timestamp
        // this limit is in place just to make sure the history does not
        // grow too large in the case of erroneous timestamp inputs
        this.maxEncodingHistorySize = 10;
        // Current number of encodings we want to send
        // to the remote end. This will be dynamically
        // updated through the setNumEncodingsFromPacketloss API
        this.numRedundantEncodings = 0;
        // Used to enable or disable redundancy
        // in response to very high packet loss events
        this.redundancyEnabled = true;
        // Loss stats are reported to the main thread every 5 seconds.
        // Since timestamp differences between 2 consecutive packets
        // give us the number of samples in each channel, 1 second
        // is equivalent to 48000 samples:
        // P-time * (1000ms/1s)
        // = (960 samples/20ms) * (1000ms/1s)
        // = 48000 samples/s
        this.lossReportInterval = 48000 * 5;
        // Maximum distance of a packet from the most recent packet timestamp
        // that we will consider for recovery.
        this.maxOutOfOrderPacketDistance = 16;
        /**
         * Below are Opus helper methods and constants.
         */
        this.OPUS_BAD_ARG = -1;
        this.OPUS_INVALID_PACKET = -4;
        // Max number of Opus frames in an Opus packet is 48 (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.5).
        this.OPUS_MAX_OPUS_FRAMES = 48;
        // Max number of bytes that any individual Opus frame can have.
        this.OPUS_MAX_FRAME_SIZE_BYTES = 1275;
        this.encodingHistory = new Array();
        this.opusPayloadType = 0;
        this.redPayloadType = 0;
        this.initializePacketLogs();
    }
    /**
     * Creates an instance of RedundantAudioEncoder and sets up callbacks.
     */
    static initializeWorker() {
        RedundantAudioEncoder.log('Initializing RedundantAudioEncoder');
        const encoder = new RedundantAudioEncoder();
        // RED encoding is done using WebRTC Encoded Transform
        // https://github.com/w3c/webrtc-encoded-transform/blob/main/explainer.md
        // Check the DedicatedWorkerGlobalScope for existence of
        // RTCRtpScriptTransformer interface. If exists, then
        // RTCRtpScriptTransform is supported by this browser.
        // @ts-ignore
        if (self.RTCRtpScriptTransformer) {
            // @ts-ignore
            self.onrtctransform = (event) => {
                if (event.transformer.options.type === 'SenderTransform') {
                    encoder.setupSenderTransform(event.transformer.readable, event.transformer.writable);
                }
                else if (event.transformer.options.type === 'ReceiverTransform') {
                    encoder.setupReceiverTransform(event.transformer.readable, event.transformer.writable);
                }
                else if (event.transformer.options.type === 'PassthroughTransform') {
                    encoder.setupPassthroughTransform(event.transformer.readable, event.transformer.writable);
                }
            };
        }
        self.onmessage = (event) => {
            if (event.data.msgType === 'StartRedWorker') {
                encoder.setupSenderTransform(event.data.send.readable, event.data.send.writable);
                encoder.setupReceiverTransform(event.data.receive.readable, event.data.receive.writable);
            }
            else if (event.data.msgType === 'PassthroughTransform') {
                encoder.setupPassthroughTransform(event.data.send.readable, event.data.send.writable);
                encoder.setupPassthroughTransform(event.data.receive.readable, event.data.receive.writable);
            }
            else if (event.data.msgType === 'RedPayloadType') {
                encoder.setRedPayloadType(event.data.payloadType);
            }
            else if (event.data.msgType === 'OpusPayloadType') {
                encoder.setOpusPayloadType(event.data.payloadType);
            }
            else if (event.data.msgType === 'UpdateNumRedundantEncodings') {
                encoder.setNumRedundantEncodings(event.data.numRedundantEncodings);
            }
            else if (event.data.msgType === 'Enable') {
                encoder.setRedundancyEnabled(true);
            }
            else if (event.data.msgType === 'Disable') {
                encoder.setRedundancyEnabled(false);
            }
        };
    }
    /**
     * Post logs to the main thread
     */
    static log(msg) {
        if (RedundantAudioEncoder.shouldLog) {
            // @ts-ignore
            self.postMessage({
                type: 'REDWorkerLog',
                log: \`[AudioRed] \${msg}\`,
            });
        }
    }
    /**
     * Returns the number of encodings based on packetLoss value. This is used by \`DefaultTransceiverController\` to
     * determine when to alert the encoder to update the number of encodings. It also determines if we need to
     * turn off red in cases of very high packet loss to avoid congestion collapse.
     */
    static getNumRedundantEncodingsForPacketLoss(packetLoss) {
        let recommendedRedundantEncodings = 0;
        let shouldTurnOffRed = false;
        if (packetLoss <= 8) {
            recommendedRedundantEncodings = 0;
        }
        else if (packetLoss <= 18) {
            recommendedRedundantEncodings = 1;
        }
        else if (packetLoss <= 75) {
            recommendedRedundantEncodings = 2;
        }
        else {
            recommendedRedundantEncodings = 0;
            shouldTurnOffRed = true;
        }
        return [recommendedRedundantEncodings, shouldTurnOffRed];
    }
    /**
     * Sets up a passthrough (no-op) transform for the given streams.
     */
    setupPassthroughTransform(readable, writable) {
        RedundantAudioEncoder.log('Setting up passthrough transform');
        readable.pipeTo(writable);
    }
    /**
     * Sets up the transform stream and pipes the outgoing encoded audio frames through the transform function.
     */
    setupSenderTransform(readable, writable) {
        RedundantAudioEncoder.log('Setting up sender RED transform');
        const transformStream = new TransformStream({
            transform: this.senderTransform.bind(this),
        });
        readable.pipeThrough(transformStream).pipeTo(writable);
        return;
    }
    /**
     * Sets up the transform stream and pipes the received encoded audio frames through the transform function.
     */
    setupReceiverTransform(readable, writable) {
        RedundantAudioEncoder.log('Setting up receiver RED transform');
        const transformStream = new TransformStream({
            transform: this.receivePacketLogTransform.bind(this),
        });
        readable.pipeThrough(transformStream).pipeTo(writable);
        return;
    }
    /**
     * Set the RED payload type ideally obtained from local offer.
     */
    setRedPayloadType(payloadType) {
        this.redPayloadType = payloadType;
        RedundantAudioEncoder.log(\`red payload type set to \${this.redPayloadType}\`);
    }
    /**
     * Set the opus payload type ideally obtained from local offer.
     */
    setOpusPayloadType(payloadType) {
        this.opusPayloadType = payloadType;
        RedundantAudioEncoder.log(\`opus payload type set to \${this.opusPayloadType}\`);
    }
    /**
     * Set the number of redundant encodings
     */
    setNumRedundantEncodings(numRedundantEncodings) {
        this.numRedundantEncodings = numRedundantEncodings;
        if (this.numRedundantEncodings > this.maxRedEncodings) {
            this.numRedundantEncodings = this.maxRedEncodings;
        }
        RedundantAudioEncoder.log(\`Updated numRedundantEncodings to \${this.numRedundantEncodings}\`);
    }
    /**
     * Enable or disable redundancy in response to
     * high packet loss event.
     */
    setRedundancyEnabled(enabled) {
        this.redundancyEnabled = enabled;
        RedundantAudioEncoder.log(\`redundancy \${this.redundancyEnabled ? 'enabled' : 'disabled'}\`);
    }
    /**
     * Helper function to only enqueue audio frames if they do not exceed the audio payload byte limit imposed by
     * Chromium-based browsers. Chromium will throw an error (https://crbug.com/1248479) if an audio payload larger than
     * 1000 bytes is enqueued. Any controller that attempts to enqueue an audio payload larger than 1000 bytes will
     * encounter this error and will permanently stop sending or receiving audio.
     */
    enqueueAudioFrameIfPayloadSizeIsValid(
    // @ts-ignore
    frame, controller) {
        if (frame.data.byteLength > this.maxAudioPayloadSizeBytes)
            return;
        controller.enqueue(frame);
    }
    /**
     * Receives encoded frames and modifies as needed before sending to transport.
     */
    senderTransform(
    // @ts-ignore
    frame, controller) {
        const frameMetadata = frame.getMetadata();
        // @ts-ignore
        if (frameMetadata.payloadType !== this.redPayloadType) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        const primaryPayloadBuffer = this.getPrimaryPayload(frame.timestamp, frame.data);
        if (!primaryPayloadBuffer) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        const encodedBuffer = this.encode(frame.timestamp, primaryPayloadBuffer);
        /* istanbul ignore next */
        if (!encodedBuffer) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        frame.data = encodedBuffer;
        this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
        return;
    }
    /**
     * Get the primary payload from encoding
     */
    getPrimaryPayload(primaryTimestamp, frame) {
        const encodings = this.splitEncodings(primaryTimestamp, frame);
        if (!encodings || encodings.length < 1)
            return null;
        return encodings[encodings.length - 1].payload;
    }
    /**
     * Split up the encoding received into primary and redundant encodings
     * These will be ordered oldest to newest which is the same ordering
     * in the RTP red payload.
     */
    splitEncodings(primaryTimestamp, frame, getFecInfo = false, primarySequenceNumber = undefined) {
        // process RED headers (according to RFC 2198)
        //   0                   1                   2                   3
        //   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
        //  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        //  |F|   block PT  |  timestamp offset         |   block length    |
        //  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        //
        // last header
        //   0 1 2 3 4 5 6 7
        //  +-+-+-+-+-+-+-+-+
        //  |0|   Block PT  |
        //  +-+-+-+-+-+-+-+-+
        const payload = new DataView(frame);
        let payloadSizeBytes = payload.byteLength;
        let totalPayloadSizeBytes = 0;
        let totalHeaderSizeBytes = 0;
        let primaryPayloadSizeBytes = 0;
        let payloadOffset = 0;
        let gotLastBlock = false;
        const encodings = new Array();
        const redundantEncodingBlockLengths = new Array();
        const redundantEncodingTimestamps = new Array();
        while (payloadSizeBytes > 0) {
            gotLastBlock = (payload.getUint8(payloadOffset) & 0x80) === 0;
            if (gotLastBlock) {
                // Bits 1 through 7 are payload type
                const payloadType = payload.getUint8(payloadOffset) & 0x7f;
                // Unexpected payload type. This is a bad packet.
                if (payloadType !== this.opusPayloadType) {
                    return null;
                }
                totalPayloadSizeBytes += this.redLastHeaderSizeBytes;
                totalHeaderSizeBytes += this.redLastHeaderSizeBytes;
                // Accumulated block lengths are equal to or larger than the buffer, which means there is no primary block. This
                // is a bad packet.
                if (totalPayloadSizeBytes >= payload.byteLength) {
                    return null;
                }
                primaryPayloadSizeBytes = payload.byteLength - totalPayloadSizeBytes;
                break;
            }
            else {
                if (payloadSizeBytes < this.redHeaderSizeBytes) {
                    return null;
                }
                // Bits 22 through 31 are payload length
                const blockLength = ((payload.getUint8(payloadOffset + 2) & 0x03) << 8) + payload.getUint8(payloadOffset + 3);
                redundantEncodingBlockLengths.push(blockLength);
                const timestampOffset = payload.getUint16(payloadOffset + 1) >> 2;
                const timestamp = primaryTimestamp - timestampOffset;
                redundantEncodingTimestamps.push(timestamp);
                totalPayloadSizeBytes += blockLength + this.redHeaderSizeBytes;
                totalHeaderSizeBytes += this.redHeaderSizeBytes;
                payloadOffset += this.redHeaderSizeBytes;
                payloadSizeBytes -= this.redHeaderSizeBytes;
            }
        }
        // The last block was never found. The packet we received
        // does not have a good RED payload.
        if (!gotLastBlock) {
            // Note that sequence numbers only exist for
            // incoming audio frames.
            if (primarySequenceNumber !== undefined) {
                // This could be a possible padding packet used
                // for BWE with a good sequence number.
                // Create a dummy encoding to make sure loss values
                // are calculated correctly by consuming sequence number.
                // Note that for the receive side, we process packets only
                // for loss/recovery calculations and forward the original
                // packet without changing it even in the error case.
                encodings.push({
                    payload: frame,
                    isRedundant: false,
                    seq: primarySequenceNumber,
                });
                return encodings;
            }
            // This is a bad packet.
            return null;
        }
        let redundantPayloadOffset = totalHeaderSizeBytes;
        for (let i = 0; i < redundantEncodingTimestamps.length; i++) {
            const redundantPayloadBuffer = new ArrayBuffer(redundantEncodingBlockLengths[i]);
            const redundantPayloadArray = new Uint8Array(redundantPayloadBuffer);
            redundantPayloadArray.set(new Uint8Array(payload.buffer, redundantPayloadOffset, redundantEncodingBlockLengths[i]), 0);
            const encoding = {
                timestamp: redundantEncodingTimestamps[i],
                payload: redundantPayloadBuffer,
                isRedundant: true,
            };
            if (getFecInfo) {
                encoding.hasFec = this.opusPacketHasFec(new DataView(redundantPayloadBuffer), redundantPayloadBuffer.byteLength);
            }
            encodings.push(encoding);
            redundantPayloadOffset += redundantEncodingBlockLengths[i];
        }
        const primaryPayloadOffset = payload.byteLength - primaryPayloadSizeBytes;
        const primaryPayloadBuffer = new ArrayBuffer(primaryPayloadSizeBytes);
        const primaryArray = new Uint8Array(primaryPayloadBuffer);
        primaryArray.set(new Uint8Array(payload.buffer, primaryPayloadOffset, primaryPayloadSizeBytes), 0);
        const encoding = {
            timestamp: primaryTimestamp,
            payload: primaryPayloadBuffer,
            isRedundant: false,
            seq: primarySequenceNumber,
        };
        if (getFecInfo) {
            encoding.hasFec = this.opusPacketHasFec(new DataView(primaryPayloadBuffer), primaryPayloadBuffer.byteLength);
        }
        encodings.push(encoding);
        return encodings;
    }
    /**
     * Create a new encoding with current primary payload and the older payloads of choice.
     */
    encode(primaryTimestamp, primaryPayload) {
        const primaryPayloadSize = primaryPayload.byteLength;
        // Payload size needs to be valid.
        if (primaryPayloadSize === 0 ||
            primaryPayloadSize >= this.maxRedPacketSizeBytes ||
            primaryPayloadSize >= this.maxAudioPayloadSizeBytes) {
            return null;
        }
        const numRedundantEncodings = this.numRedundantEncodings;
        let headerSizeBytes = this.redLastHeaderSizeBytes;
        let payloadSizeBytes = primaryPayloadSize;
        let bytesAvailable = this.maxAudioPayloadSizeBytes - primaryPayloadSize - headerSizeBytes;
        const redundantEncodingTimestamps = new Array();
        const redundantEncodingPayloads = new Array();
        // If redundancy is disabled then only send the primary payload
        if (this.redundancyEnabled) {
            // Determine how much redundancy we can fit into our packet
            let redundantTimestamp = this.uint32WrapAround(primaryTimestamp - this.redPacketizationTime * this.redPacketDistance);
            for (let i = 0; i < numRedundantEncodings; i++) {
                // Do not add redundant encodings that are beyond the maximum timestamp offset.
                if (this.uint32WrapAround(primaryTimestamp - redundantTimestamp) >= this.maxRedTimestampOffset) {
                    break;
                }
                let findTimestamp = redundantTimestamp;
                let encoding = this.encodingHistory.find(e => e.timestamp === findTimestamp);
                if (!encoding) {
                    // If not found or not important then look for the previous packet.
                    // The current packet may have included FEC for the previous, so just
                    // use the previous packet instead provided that it has voice activity.
                    findTimestamp = this.uint32WrapAround(redundantTimestamp - this.redPacketizationTime);
                    encoding = this.encodingHistory.find(e => e.timestamp === findTimestamp);
                }
                if (encoding) {
                    const redundantEncodingSizeBytes = encoding.payload.byteLength;
                    // Only add redundancy if there are enough bytes available.
                    if (bytesAvailable < this.redHeaderSizeBytes + redundantEncodingSizeBytes)
                        break;
                    bytesAvailable -= this.redHeaderSizeBytes + redundantEncodingSizeBytes;
                    headerSizeBytes += this.redHeaderSizeBytes;
                    payloadSizeBytes += redundantEncodingSizeBytes;
                    redundantEncodingTimestamps.unshift(encoding.timestamp);
                    redundantEncodingPayloads.unshift(encoding.payload);
                }
                redundantTimestamp -= this.redPacketizationTime * this.redPacketDistance;
                redundantTimestamp = this.uint32WrapAround(redundantTimestamp);
            }
        }
        const redPayloadBuffer = new ArrayBuffer(headerSizeBytes + payloadSizeBytes);
        const redPayloadView = new DataView(redPayloadBuffer);
        // Add redundant encoding header(s) to new buffer
        let redPayloadOffset = 0;
        for (let i = 0; i < redundantEncodingTimestamps.length; i++) {
            const timestampDelta = primaryTimestamp - redundantEncodingTimestamps[i];
            redPayloadView.setUint8(redPayloadOffset, this.opusPayloadType | 0x80);
            redPayloadView.setUint16(redPayloadOffset + 1, (timestampDelta << 2) | (redundantEncodingPayloads[i].byteLength >> 8));
            redPayloadView.setUint8(redPayloadOffset + 3, redundantEncodingPayloads[i].byteLength & 0xff);
            redPayloadOffset += this.redHeaderSizeBytes;
        }
        // Add primary encoding header to new buffer
        redPayloadView.setUint8(redPayloadOffset, this.opusPayloadType);
        redPayloadOffset += this.redLastHeaderSizeBytes;
        // Add redundant payload(s) to new buffer
        const redPayloadArray = new Uint8Array(redPayloadBuffer);
        for (let i = 0; i < redundantEncodingPayloads.length; i++) {
            redPayloadArray.set(new Uint8Array(redundantEncodingPayloads[i]), redPayloadOffset);
            redPayloadOffset += redundantEncodingPayloads[i].byteLength;
        }
        // Add primary payload to new buffer
        redPayloadArray.set(new Uint8Array(primaryPayload), redPayloadOffset);
        redPayloadOffset += primaryPayload.byteLength;
        /* istanbul ignore next */
        // Sanity check that we got the expected total payload size.
        if (redPayloadOffset !== headerSizeBytes + payloadSizeBytes)
            return null;
        this.updateEncodingHistory(primaryTimestamp, primaryPayload);
        return redPayloadBuffer;
    }
    /**
     * Update the encoding history with the latest primary encoding
     */
    updateEncodingHistory(primaryTimestamp, primaryPayload) {
        // Remove encodings from the history if they are too old.
        for (const encoding of this.encodingHistory) {
            const maxTimestampDelta = this.redPacketizationTime * this.redMaxRecoveryDistance;
            if (primaryTimestamp - encoding.timestamp >= maxTimestampDelta) {
                this.encodingHistory.shift();
            }
            else {
                break;
            }
        }
        // Only add an encoding to the history if the encoding is deemed to be important. An encoding is important if it is
        // a CELT-only packet or contains voice activity.
        const packet = new DataView(primaryPayload);
        if (this.opusPacketIsCeltOnly(packet) ||
            this.opusPacketHasVoiceActivity(packet, packet.byteLength) > 0) {
            // Check if adding an encoding will cause the length of the encoding history to exceed the maximum history size.
            // This is not expected to happen but could occur if we get incorrect timestamps. We want to make sure our memory
            // usage is bounded. In this case, just clear the history and start over from empty.
            if (this.encodingHistory.length + 1 > this.maxEncodingHistorySize)
                this.encodingHistory.length = 0;
            this.encodingHistory.push({ timestamp: primaryTimestamp, payload: primaryPayload });
        }
    }
    /**
     * Initialize packet logs and metric values.
     */
    initializePacketLogs() {
        // The extra space from the max RED recovery distance is to ensure that we do not incorrectly count recovery for
        // packets that have already been received but are outside of the max out-of-order distance.
        const packetLogSize = this.maxOutOfOrderPacketDistance + this.redMaxRecoveryDistance;
        this.primaryPacketLog = {
            window: new Array(packetLogSize),
            index: 0,
            windowSize: packetLogSize,
        };
        this.redRecoveryLog = {
            window: new Array(packetLogSize),
            index: 0,
            windowSize: packetLogSize,
        };
        this.fecRecoveryLog = {
            window: new Array(packetLogSize),
            index: 0,
            windowSize: packetLogSize,
        };
        this.totalAudioPacketsExpected = 0;
        this.totalAudioPacketsLost = 0;
        this.totalAudioPacketsRecoveredRed = 0;
        this.totalAudioPacketsRecoveredFec = 0;
    }
    /**
     * Receives encoded frames from the server
     * and adds the timestamps to a packet log
     * to calculate an approximate recovery metric.
     */
    receivePacketLogTransform(
    // @ts-ignore
    frame, controller) {
        const frameMetadata = frame.getMetadata();
        // @ts-ignore
        if (frameMetadata.payloadType !== this.redPayloadType) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        // @ts-ignore
        const encodings = this.splitEncodings(frame.timestamp, frame.data, 
        /*getFecInfo*/ true, frameMetadata.sequenceNumber);
        if (!encodings) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        for (let i = encodings.length - 1; i >= 0; i--) {
            if (this.updateLossStats(encodings[i])) {
                this.updateRedStats(encodings[i]);
                this.updateFecStats(encodings[i]);
            }
        }
        this.maybeReportLossStats(frameMetadata.synchronizationSource, encodings[encodings.length - 1].timestamp);
        this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
    }
    /**
     * Adds a timestamp to the primary packet log.
     * This also updates totalAudioPacketsLost and totalAudioPacketsExpected by looking
     * at the difference between timestamps.
     *
     * @param encoding : The encoding to be analyzed
     * @returns false if sequence number was greater than max out of order distance
     *          true otherwise
     */
    updateLossStats(encoding) {
        if (encoding.isRedundant)
            return true;
        const timestamp = encoding.timestamp;
        const seq = encoding.seq;
        if (this.totalAudioPacketsExpected === 0) {
            this.totalAudioPacketsExpected = 1;
            this.newestSequenceNumber = seq;
            this.addTimestamp(this.primaryPacketLog, timestamp);
            return true;
        }
        const diff = this.int16(seq - this.newestSequenceNumber);
        if (diff < -this.maxOutOfOrderPacketDistance)
            return false;
        if (diff < 0) {
            if (!this.hasTimestamp(this.primaryPacketLog, timestamp)) {
                if (this.totalAudioPacketsLost > 0)
                    this.totalAudioPacketsLost--;
                this.addTimestamp(this.primaryPacketLog, timestamp);
                this.removeFromRecoveryWindows(timestamp);
            }
        }
        else if (diff > 1) {
            this.totalAudioPacketsLost += diff - 1;
        }
        if (diff > 0) {
            this.totalAudioPacketsExpected += diff;
            this.newestSequenceNumber = encoding.seq;
            this.addTimestamp(this.primaryPacketLog, timestamp);
        }
        return true;
    }
    /**
     * Adds a timestamp to the red recovery log if it is not present in
     * the primary packet log and if it's not too old.
     *
     * @param encoding : The encoding to be analyzed
     */
    updateRedStats(encoding) {
        if (!encoding.isRedundant || this.totalAudioPacketsLost === 0)
            return;
        const timestamp = encoding.timestamp;
        if (!this.hasTimestamp(this.primaryPacketLog, timestamp)) {
            if (!this.hasTimestamp(this.redRecoveryLog, timestamp)) {
                this.totalAudioPacketsRecoveredRed++;
                this.addTimestamp(this.redRecoveryLog, timestamp);
            }
            if (this.removeTimestamp(this.fecRecoveryLog, timestamp)) {
                /* istanbul ignore else */
                if (this.totalAudioPacketsRecoveredFec > 0)
                    this.totalAudioPacketsRecoveredFec--;
            }
        }
    }
    /**
     * Adds a timestamp to the fec recovery log if it is not present in
     * the primary packet log and red recovery log and if it is not too old.
     *
     * @param encoding : The encoding to be analyzed
     */
    updateFecStats(encoding) {
        if (!encoding.hasFec || this.totalAudioPacketsLost === 0)
            return;
        const fecTimestamp = encoding.timestamp - this.redPacketizationTime;
        if (this.hasTimestamp(this.primaryPacketLog, fecTimestamp) ||
            this.hasTimestamp(this.redRecoveryLog, fecTimestamp) ||
            this.hasTimestamp(this.fecRecoveryLog, fecTimestamp)) {
            return;
        }
        this.totalAudioPacketsRecoveredFec++;
        this.addTimestamp(this.fecRecoveryLog, fecTimestamp);
    }
    /**
     * Reports loss metrics to DefaultTransceiverController
     *
     * @param timestamp : Timestamp of most recent primary packet
     */
    maybeReportLossStats(ssrc, timestamp) {
        if (timestamp === undefined ||
            timestamp - this.lastLossReportTimestamp < this.lossReportInterval)
            return;
        /* istanbul ignore next */
        if (RedundantAudioEncoder.shouldReportStats) {
            // @ts-ignore
            self.postMessage({
                type: 'RedundantAudioEncoderStats',
                ssrc,
                totalAudioPacketsLost: this.totalAudioPacketsLost,
                totalAudioPacketsExpected: this.totalAudioPacketsExpected,
                totalAudioPacketsRecoveredRed: this.totalAudioPacketsRecoveredRed,
                totalAudioPacketsRecoveredFec: this.totalAudioPacketsRecoveredFec,
            });
        }
        this.lastLossReportTimestamp = timestamp;
    }
    /**
     * Adds a timestamp to a packet log
     *
     * @param packetLog : The packetlog to add the timestamp to
     * @param timestamp : The timestamp that should be added
     */
    addTimestamp(packetLog, timestamp) {
        if (timestamp === undefined) {
            return;
        }
        packetLog.window[packetLog.index] = timestamp;
        packetLog.index = (packetLog.index + 1) % packetLog.windowSize;
    }
    /**
     * Checks if a timestamp is in a packetlog
     *
     * @param packetLog : The packetlog to search
     * @param timestamp : The timestamp to search for
     * @returns true if timestamp is present, false otherwise
     */
    hasTimestamp(packetLog, timestamp) {
        const element = packetLog.window.find(t => t === timestamp);
        return !!element;
    }
    /**
     * Removes a timestamp from a packet log
     *
     * @param packetLog : The packetlog from which the timestamp should be removed
     * @param timestamp : The timestamp to be removed
     * @returns true if timestamp was present in the log and removed, false otherwise
     */
    removeTimestamp(packetLog, timestamp) {
        const index = packetLog.window.indexOf(timestamp);
        if (index >= 0) {
            packetLog.window[index] = undefined;
            return true;
        }
        return false;
    }
    /**
     * Removes a timestamp from red and fec recovery windows.
     *
     * @param timestamp : The timestamp to be removed
     */
    removeFromRecoveryWindows(timestamp) {
        let removed = this.removeTimestamp(this.redRecoveryLog, timestamp);
        if (removed) {
            if (this.totalAudioPacketsRecoveredRed > 0)
                this.totalAudioPacketsRecoveredRed--;
        }
        removed = this.removeTimestamp(this.fecRecoveryLog, timestamp);
        if (removed) {
            if (this.totalAudioPacketsRecoveredFec > 0)
                this.totalAudioPacketsRecoveredFec--;
        }
    }
    /**
     * Converts the supplied argument to 32-bit unsigned integer
     */
    uint32WrapAround(num) {
        const mod = 4294967296; // 2^32
        let res = num;
        if (num >= mod) {
            res = num - mod;
        }
        else if (num < 0) {
            res = mod + num;
        }
        return res;
    }
    /**
     * Converts the supplied argument to 16-bit signed integer
     */
    int16(num) {
        return (num << 16) >> 16;
    }
    /**
     * Determines if an Opus packet is in CELT-only mode.
     *
     * @param packet Opus packet.
     * @returns \`true\` if the packet is in CELT-only mode.
     */
    opusPacketIsCeltOnly(packet) {
        // TOC byte format (https://www.rfc-editor.org/rfc/rfc6716#section-3.1):
        //  0
        //  0 1 2 3 4 5 6 7
        // +-+-+-+-+-+-+-+-+
        // | config  |s| c |
        // +-+-+-+-+-+-+-+-+
        // Since CELT-only packets are represented using configurations 16 to 31, the highest 'config' bit will always be 1
        // for CELT-only packets.
        return !!(packet.getUint8(0) & 0x80);
    }
    /**
     * Gets the number of samples per frame from an Opus packet.
     *
     * @param packet Opus packet. This must contain at least one byte of data.
     * @param sampleRateHz 32-bit integer sampling rate in Hz. This must be a multiple of 400 or inaccurate results will
     *                     be returned.
     * @returns Number of samples per frame.
     */
    opusPacketGetSamplesPerFrame(packet, sampleRateHz) {
        // Sample rate must be a 32-bit integer.
        sampleRateHz = Math.round(sampleRateHz);
        sampleRateHz = Math.min(Math.max(sampleRateHz, -(Math.pow(2, 32))), Math.pow(2, 32) - 1);
        // TOC byte format (https://www.rfc-editor.org/rfc/rfc6716#section-3.1):
        //  0
        //  0 1 2 3 4 5 6 7
        // +-+-+-+-+-+-+-+-+
        // | config  |s| c |
        // +-+-+-+-+-+-+-+-+
        let numSamples;
        let frameSizeOption;
        // Case for CELT-only packet.
        if (this.opusPacketIsCeltOnly(packet)) {
            // The lower 3 'config' bits indicate the frame size option.
            frameSizeOption = (packet.getUint8(0) >> 3) & 0x3;
            // The frame size options 0, 1, 2, 3 correspond to frame sizes of 2.5, 5, 10, 20 ms. Notice that the frame sizes
            // can be represented as (2.5 * 2^0), (2.5 * 2^1), (2.5 * 2^2), (2.5 * 2^3) ms. So, the number of samples can be
            // calculated as follows:
            // (sample/s) * (1s/1000ms) * (2.5ms) * 2^(frameSizeOption)
            // = (sample/s) * (1s/400) * 2^(frameSizeOption)
            // = (sample/s) * 2^(frameSizeOption) * (1s/400)
            numSamples = (sampleRateHz << frameSizeOption) / 400;
        }
        // Case for Hybrid packet. Since Hybrid packets are represented using configurations 12 to 15, bits 1 and 2 in the
        // above TOC byte diagram will both be 1.
        else if ((packet.getUint8(0) & 0x60) === 0x60) {
            // In the case of configuration 13 or 15, bit 4 in the above TOC byte diagram will be 1. Configurations 13 and 15
            // correspond to a 20ms frame size, so the number of samples is calculated as follows:
            // (sample/s) * (1s/1000ms) * (20ms)
            // = (sample/s) * (1s/50)
            //
            // In the case of configuration 12 or 14, bit 4 in the above TOC byte diagram will be 0. Configurations 12 and 14
            // correspond to a 10ms frame size, so the number of samples is calculated as follows:
            // (sample/s) * (1s/1000ms) * (10ms)
            // = (sample/s) * (1s/100)
            numSamples = packet.getUint8(0) & 0x08 ? sampleRateHz / 50 : sampleRateHz / 100;
        }
        // Case for SILK-only packet.
        else {
            // The lower 3 'config' bits indicate the frame size option for SILK-only packets.
            frameSizeOption = (packet.getUint8(0) >> 3) & 0x3;
            if (frameSizeOption === 3) {
                // Frame size option 3 corresponds to a frame size of 60ms, so the number of samples is calculated as follows:
                // (sample/s) * (1s/1000ms) * (60ms)
                // = (sample/s) * (60ms) * (1s/1000ms)
                numSamples = (sampleRateHz * 60) / 1000;
            }
            else {
                // The frame size options 0, 1, 2 correspond to frame sizes of 10, 20, 40 ms. Notice that the frame sizes can be
                // represented as (10 * 2^0), (10 * 2^1), (10 * 2^2) ms. So, the number of samples can be calculated as follows:
                // (sample/s) * (1s/1000ms) * (10ms) * 2^(frameSizeOption)
                // = (sample/s) * (1s/100) * 2^(frameSizeOption)
                // = (sample/s) * 2^(frameSizeOption) * (1s/100)
                numSamples = (sampleRateHz << frameSizeOption) / 100;
            }
        }
        return numSamples;
    }
    /**
     * Gets the number of SILK frames per Opus frame.
     *
     * @param packet Opus packet.
     * @returns Number of SILK frames per Opus frame.
     */
    opusNumSilkFrames(packet) {
        // For computing the frame length in ms, the sample rate is not important since it cancels out. We use 48 kHz, but
        // any valid sample rate would work.
        //
        // To calculate the length of a frame (with a 48kHz sample rate) in ms:
        // (samples/frame) * (1s/48000 samples) * (1000ms/s)
        // = (samples/frame) * (1000ms/48000 samples)
        // = (samples/frame) * (1ms/48 samples)
        let frameLengthMs = this.opusPacketGetSamplesPerFrame(packet, 48000) / 48;
        if (frameLengthMs < 10)
            frameLengthMs = 10;
        // The number of SILK frames per Opus frame is described in https://www.rfc-editor.org/rfc/rfc6716#section-4.2.2.
        switch (frameLengthMs) {
            case 10:
            case 20:
                return 1;
            case 40:
                return 2;
            case 60:
                return 3;
            // It is not possible to reach the default case since an Opus packet can only encode sizes of 2.5, 5, 10, 20, 40,
            // or 60 ms, so we ignore the default case for test coverage.
            /* istanbul ignore next */
            default:
                return 0;
        }
    }
    /**
     * Gets the number of channels from an Opus packet.
     *
     * @param packet Opus packet.
     * @returns Number of channels.
     */
    opusPacketGetNumChannels(packet) {
        // TOC byte format (https://www.rfc-editor.org/rfc/rfc6716#section-3.1):
        //  0
        //  0 1 2 3 4 5 6 7
        // +-+-+-+-+-+-+-+-+
        // | config  |s| c |
        // +-+-+-+-+-+-+-+-+
        // The 's' bit indicates mono or stereo audio, with 0 indicating mono and 1 indicating stereo.
        return packet.getUint8(0) & 0x4 ? 2 : 1;
    }
    /**
     * Determine the size (in bytes) of an Opus frame.
     *
     * @param packet Opus packet.
     * @param byteOffset Offset (from the start of the packet) to the byte containing the size information.
     * @param remainingBytes Remaining number of bytes to parse from the Opus packet.
     * @param sizeBytes Variable to store the parsed frame size (in bytes).
     * @returns Number of bytes that were parsed to determine the frame size.
     */
    opusParseSize(packet, byteOffset, remainingBytes, sizeBytes) {
        // See https://www.rfc-editor.org/rfc/rfc6716#section-3.2.1 for an explanation of how frame size is represented.
        // If there are no remaining bytes to parse the size from, then the size cannot be determined.
        if (remainingBytes < 1) {
            sizeBytes[0] = -1;
            return -1;
        }
        // If the first byte is in the range 0...251, then this value is the size of the frame.
        else if (packet.getUint8(byteOffset) < 252) {
            sizeBytes[0] = packet.getUint8(byteOffset);
            return 1;
        }
        // If the first byte is in the range 252...255, a second byte is needed. If there is no second byte, then the size
        // cannot be determined.
        else if (remainingBytes < 2) {
            sizeBytes[0] = -1;
            return -1;
        }
        // The total size of the frame given two size bytes is:
        // (4 * secondSizeByte) + firstSizeByte
        else {
            sizeBytes[0] = 4 * packet.getUint8(byteOffset + 1) + packet.getUint8(byteOffset);
            return 2;
        }
    }
    /**
     * Parse binary data containing an Opus packet into one or more Opus frames.
     *
     * @param data Binary data containing an Opus packet to be parsed. The data should begin with the first byte (i.e the
     *             TOC byte) of an Opus packet. Note that the size of the data does not have to equal the size of the
     *             contained Opus packet.
     * @param lenBytes Size of the data (in bytes).
     * @param selfDelimited Indicates if the Opus packet is self-delimiting
     *                      (https://www.rfc-editor.org/rfc/rfc6716#appendix-B).
     * @param tocByte Optional variable to store the TOC (table of contents) byte.
     * @param frameOffsets Optional variable to store the offsets (from the start of the data) to the first bytes of each
     *                     Opus frame.
     * @param frameSizes Required variable to store the sizes (in bytes) of each Opus frame.
     * @param payloadOffset Optional variable to store the offset (from the start of the data) to the first byte of the
     *                      payload.
     * @param packetLenBytes Optional variable to store the length of the Opus packet (in bytes).
     * @returns Number of Opus frames.
     */
    opusPacketParseImpl(data, lenBytes, selfDelimited, tocByte, frameOffsets, frameSizes, payloadOffset, packetLenBytes) {
        if (!frameSizes || lenBytes < 0)
            return this.OPUS_BAD_ARG;
        if (lenBytes === 0)
            return this.OPUS_INVALID_PACKET;
        // The number of Opus frames in the packet.
        let numFrames;
        // Intermediate storage for the number of bytes parsed to determine the size of a frame.
        let numBytesParsed;
        // The number of the padding bytes (excluding the padding count bytes) in the packet.
        let paddingBytes = 0;
        // Indicates whether CBR (constant bitrate) framing is used.
        let cbr = false;
        // The TOC (table of contents) byte (https://www.rfc-editor.org/rfc/rfc6716#section-3.1).
        const toc = data.getUint8(0);
        // Store the TOC byte.
        if (tocByte)
            tocByte[0] = toc;
        // The remaining number of bytes to parse from the packet. Note that the TOC byte has already been parsed, hence the
        // minus 1.
        let remainingBytes = lenBytes - 1;
        // This keeps track of where we are in the packet. This starts at 1 since the TOC byte has already been read.
        let byteOffset = 1;
        // The size of the last Opus frame in bytes.
        let lastSizeBytes = remainingBytes;
        // Read the \`c\` bits (i.e. code bits) from the TOC byte.
        switch (toc & 0x3) {
            // A code 0 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.2) has one frame.
            case 0:
                numFrames = 1;
                break;
            // A code 1 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.3) has two CBR (constant bitrate) frames.
            case 1:
                numFrames = 2;
                cbr = true;
                if (!selfDelimited) {
                    // Undelimited code 1 packets must be an even number of data bytes, otherwise the packet is invalid.
                    if (remainingBytes & 0x1)
                        return this.OPUS_INVALID_PACKET;
                    // The sizes of both frames are equal (i.e. half of the number of data bytes).
                    lastSizeBytes = remainingBytes / 2;
                    // If \`lastSizeBytes\` is too large, we will catch it later.
                    frameSizes[0][0] = lastSizeBytes;
                }
                break;
            // A code 2 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.4) has two VBR (variable bitrate) frames.
            case 2:
                numFrames = 2;
                numBytesParsed = this.opusParseSize(data, byteOffset, remainingBytes, frameSizes[0]);
                remainingBytes -= numBytesParsed;
                // The parsed size of the first frame cannot be larger than the number of remaining bytes in the packet.
                if (frameSizes[0][0] < 0 || frameSizes[0][0] > remainingBytes) {
                    return this.OPUS_INVALID_PACKET;
                }
                byteOffset += numBytesParsed;
                // The size of the second frame is the remaining number of bytes after the first frame.
                lastSizeBytes = remainingBytes - frameSizes[0][0];
                break;
            // A code 3 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.5) has multiple CBR/VBR frames (from 0 to
            // 120 ms).
            default:
                // Code 3 packets must have at least 2 bytes (i.e. at least 1 byte after the TOC byte).
                if (remainingBytes < 1)
                    return this.OPUS_INVALID_PACKET;
                // Frame count byte format:
                //  0
                //  0 1 2 3 4 5 6 7
                // +-+-+-+-+-+-+-+-+
                // |v|p|     M     |
                // +-+-+-+-+-+-+-+-+
                //
                // Read the frame count byte, which immediately follows the TOC byte.
                const frameCountByte = data.getUint8(byteOffset++);
                --remainingBytes;
                // Read the 'M' bits of the frame count byte, which encode the number of frames.
                numFrames = frameCountByte & 0x3f;
                // The number of frames in a code 3 packet must not be 0.
                if (numFrames <= 0)
                    return this.OPUS_INVALID_PACKET;
                const samplesPerFrame = this.opusPacketGetSamplesPerFrame(data, 48000);
                // A single frame can have at most 2880 samples, which happens in the case where 60ms of 48kHz audio is encoded
                // per frame. A code 3 packet cannot contain more than 120ms of audio, so the total number of samples cannot
                // exceed 2880 * 2 = 5760.
                if (samplesPerFrame * numFrames > 5760)
                    return this.OPUS_INVALID_PACKET;
                // Parse padding bytes if the 'p' bit is 1.
                if (frameCountByte & 0x40) {
                    let paddingCountByte;
                    let numPaddingBytes;
                    // Remove padding bytes (including padding count bytes) from the remaining byte count.
                    do {
                        // Sanity check that there are enough bytes to parse and remove the padding.
                        if (remainingBytes <= 0)
                            return this.OPUS_INVALID_PACKET;
                        // Get the next padding count byte.
                        paddingCountByte = data.getUint8(byteOffset++);
                        --remainingBytes;
                        // If the padding count byte has a value in the range 0...254, then the total size of the padding is the
                        // value in the padding count byte.
                        //
                        // If the padding count byte has value 255, then the total size of the padding is 254 plus the value in the
                        // next padding count byte. Therefore, keep reading padding count bytes while the value is 255.
                        numPaddingBytes = paddingCountByte === 255 ? 254 : paddingCountByte;
                        remainingBytes -= numPaddingBytes;
                        paddingBytes += numPaddingBytes;
                    } while (paddingCountByte === 255);
                }
                // Sanity check that the remaining number of bytes is not negative after removing the padding.
                if (remainingBytes < 0)
                    return this.OPUS_INVALID_PACKET;
                // Read the 'v' bit (i.e. VBR bit).
                cbr = !(frameCountByte & 0x80);
                // VBR case
                if (!cbr) {
                    lastSizeBytes = remainingBytes;
                    // Let M be the number of frames. There will be M - 1 frame length indicators (which can be 1 or 2 bytes)
                    // corresponding to the lengths of frames 0 to M - 2. The size of the last frame (i.e. frame M - 1) is the
                    // number of data bytes after the end of frame M - 2 and before the start of the padding bytes.
                    for (let i = 0; i < numFrames - 1; ++i) {
                        numBytesParsed = this.opusParseSize(data, byteOffset, remainingBytes, frameSizes[i]);
                        remainingBytes -= numBytesParsed;
                        // The remaining number of data bytes must be enough to contain each frame.
                        if (frameSizes[i][0] < 0 || frameSizes[i][0] > remainingBytes) {
                            return this.OPUS_INVALID_PACKET;
                        }
                        byteOffset += numBytesParsed;
                        lastSizeBytes -= numBytesParsed + frameSizes[i][0];
                    }
                    // Sanity check that the size of the last frame is not negative.
                    if (lastSizeBytes < 0)
                        return this.OPUS_INVALID_PACKET;
                }
                // CBR case
                else if (!selfDelimited) {
                    // The size of each frame is the number of data bytes divided by the number of frames.
                    lastSizeBytes = Math.trunc(remainingBytes / numFrames);
                    // The number of data bytes must be a non-negative integer multiple of the number of frames.
                    if (lastSizeBytes * numFrames !== remainingBytes)
                        return this.OPUS_INVALID_PACKET;
                    // All frames have equal size in the undelimited CBR case.
                    for (let i = 0; i < numFrames - 1; ++i) {
                        frameSizes[i][0] = lastSizeBytes;
                    }
                }
        }
        // Self-delimited framing uses an extra 1 or 2 bytes, immediately preceding the data bytes, to indicate either the
        // size of the last frame (for code 0, code 2, and VBR code 3 packets) or the size of all the frames (for code 1 and
        // CBR code 3 packets). See https://www.rfc-editor.org/rfc/rfc6716#appendix-B.
        if (selfDelimited) {
            // The extra frame size byte(s) will always indicate the size of the last frame.
            numBytesParsed = this.opusParseSize(data, byteOffset, remainingBytes, frameSizes[numFrames - 1]);
            remainingBytes -= numBytesParsed;
            // There must be enough data bytes for the last frame.
            if (frameSizes[numFrames - 1][0] < 0 || frameSizes[numFrames - 1][0] > remainingBytes) {
                return this.OPUS_INVALID_PACKET;
            }
            byteOffset += numBytesParsed;
            // For CBR packets, the sizes of all the frames are equal.
            if (cbr) {
                // There must be enough data bytes for all the frames.
                if (frameSizes[numFrames - 1][0] * numFrames > remainingBytes) {
                    return this.OPUS_INVALID_PACKET;
                }
                for (let i = 0; i < numFrames - 1; ++i) {
                    frameSizes[i][0] = frameSizes[numFrames - 1][0];
                }
            }
            // At this point, \`lastSizeBytes\` contains the size of the last frame plus the size of the extra frame size
            // byte(s), so sanity check that \`lastSizeBytes\` is the upper bound for the size of the last frame.
            else if (!(numBytesParsed + frameSizes[numFrames - 1][0] <= lastSizeBytes)) {
                return this.OPUS_INVALID_PACKET;
            }
        }
        // Undelimited case
        else {
            // Because the size of the last packet is not encoded explicitly, it is possible that the size of the last packet
            // (or of all the packets, for the CBR case) is larger than maximum frame size.
            if (lastSizeBytes > this.OPUS_MAX_FRAME_SIZE_BYTES)
                return this.OPUS_INVALID_PACKET;
            frameSizes[numFrames - 1][0] = lastSizeBytes;
        }
        // Store the offset to the start of the payload.
        if (payloadOffset)
            payloadOffset[0] = byteOffset;
        // Store the offsets to the start of each frame.
        for (let i = 0; i < numFrames; ++i) {
            if (frameOffsets)
                frameOffsets[i][0] = byteOffset;
            byteOffset += frameSizes[i][0];
        }
        // Store the length of the Opus packet.
        if (packetLenBytes)
            packetLenBytes[0] = byteOffset + paddingBytes;
        return numFrames;
    }
    /**
     * Parse a single undelimited Opus packet into one or more Opus frames.
     *
     * @param packet Opus packet to be parsed.
     * @param lenBytes Size of the packet (in bytes).
     * @param tocByte Optional variable to store the TOC (table of contents) byte.
     * @param frameOffsets Optional variable to store the offsets (from the start of the packet) to the first bytes of
     *                     each Opus frame.
     * @param frameSizes Required variable to store the sizes (in bytes) of each Opus frame.
     * @param payloadOffset Optional variable to store the offset (from the start of the packet) to the first byte of the
     *                      payload.
     * @returns Number of Opus frames.
     */
    opusPacketParse(packet, lenBytes, tocByte, frameOffsets, frameSizes, payloadOffset) {
        return this.opusPacketParseImpl(packet, lenBytes, 
        /* selfDelimited */ false, tocByte, frameOffsets, frameSizes, payloadOffset, null);
    }
    /**
     * This function returns the SILK VAD (voice activity detection) information encoded in the Opus packet. For CELT-only
     * packets that do not have VAD information, it returns -1.
     *
     * @param packet Opus packet.
     * @param lenBytes Size of the packet (in bytes).
     * @returns  0: no frame had the VAD flag set.
     *           1: at least one frame had the VAD flag set.
     *          -1: VAD status could not be determined.
     */
    opusPacketHasVoiceActivity(packet, lenBytes) {
        if (!packet || lenBytes <= 0)
            return 0;
        // In CELT-only mode, we can not determine whether there is VAD.
        if (this.opusPacketIsCeltOnly(packet))
            return -1;
        const numSilkFrames = this.opusNumSilkFrames(packet);
        // It is not possible for \`opusNumSilkFrames()\` to return 0, so we ignore the next sanity check for test coverage.
        /* istanbul ignore next */
        if (numSilkFrames === 0)
            return -1;
        const opusFrameOffsets = new Array(this.OPUS_MAX_OPUS_FRAMES);
        const opusFrameSizes = new Array(this.OPUS_MAX_OPUS_FRAMES);
        for (let i = 0; i < this.OPUS_MAX_OPUS_FRAMES; ++i) {
            opusFrameOffsets[i] = [undefined];
            opusFrameSizes[i] = [undefined];
        }
        // Parse packet to get the Opus frames.
        const numOpusFrames = this.opusPacketParse(packet, lenBytes, null, opusFrameOffsets, opusFrameSizes, null);
        // VAD status cannot be determined for invalid packets.
        if (numOpusFrames < 0)
            return -1;
        // Iterate over all Opus frames, which may contain multiple SILK frames, to determine the VAD status.
        for (let i = 0; i < numOpusFrames; ++i) {
            if (opusFrameSizes[i][0] < 1)
                continue;
            // LP layer header bits format (https://www.rfc-editor.org/rfc/rfc6716#section-4.2.3):
            //
            // Mono case:
            // +-----------------+----------+
            // | 1 to 3 VAD bits | LBRR bit |
            // +-----------------+----------+
            //
            // Stereo case:
            // +---------------------+--------------+----------------------+---------------+
            // | 1 to 3 mid VAD bits | mid LBRR bit | 1 to 3 side VAD bits | side LBRR bit |
            // +---------------------+--------------+----------------------+---------------+
            // The upper 1 to 3 bits (dependent on the number of SILK frames) of the LP layer contain VAD bits. If any of
            // these VAD bits are 1, then voice activity is present.
            if (packet.getUint8(opusFrameOffsets[i][0]) >> (8 - numSilkFrames))
                return 1;
            // In the stereo case, there is a second set of 1 to 3 VAD bits, so also check these VAD bits.
            const channels = this.opusPacketGetNumChannels(packet);
            if (channels === 2 &&
                (packet.getUint8(opusFrameOffsets[i][0]) << (numSilkFrames + 1)) >> (8 - numSilkFrames)) {
                return 1;
            }
        }
        // No voice activity was detected.
        return 0;
    }
    /**
     * This method is based on Definition of the Opus Audio Codec
     * (https://tools.ietf.org/html/rfc6716). Basically, this method is based on
     * parsing the LP layer of an Opus packet, particularly the LBRR flag.
     *
     * @param packet Opus packet.
     * @param lenBytes Size of the packet (in bytes).
     * @returns  true: packet has fec encoding about previous packet.
     *           false: no fec encoding present.
     */
    opusPacketHasFec(packet, lenBytes) {
        if (!packet || lenBytes <= 0)
            return false;
        // In CELT-only mode, packets should not have FEC.
        if (this.opusPacketIsCeltOnly(packet))
            return false;
        const opusFrameOffsets = new Array(this.OPUS_MAX_OPUS_FRAMES);
        const opusFrameSizes = new Array(this.OPUS_MAX_OPUS_FRAMES);
        for (let i = 0; i < this.OPUS_MAX_OPUS_FRAMES; ++i) {
            opusFrameOffsets[i] = [undefined];
            opusFrameSizes[i] = [undefined];
        }
        // Parse packet to get the Opus frames.
        const numOpusFrames = this.opusPacketParse(packet, lenBytes, null, opusFrameOffsets, opusFrameSizes, null);
        if (numOpusFrames < 0)
            return false;
        /* istanbul ignore next */
        if (opusFrameSizes[0][0] <= 1)
            return false;
        const numSilkFrames = this.opusNumSilkFrames(packet);
        /* istanbul ignore next */
        if (numSilkFrames === 0)
            return false;
        const channels = this.opusPacketGetNumChannels(packet);
        /* istanbul ignore next */
        if (channels !== 1 && channels !== 2)
            return false;
        // A frame starts with the LP layer. The LP layer begins with two to eight
        // header bits.These consist of one VAD bit per SILK frame (up to 3),
        // followed by a single flag indicating the presence of LBRR frames.
        // For a stereo packet, these first flags correspond to the mid channel, and
        // a second set of flags is included for the side channel. Because these are
        // the first symbols decoded by the range coder and because they are coded
        // as binary values with uniform probability, they can be extracted directly
        // from the most significant bits of the first byte of compressed data.
        for (let i = 0; i < channels; i++) {
            if (packet.getUint8(opusFrameOffsets[0][0]) & (0x80 >> ((i + 1) * (numSilkFrames + 1) - 1)))
                return true;
        }
        return false;
    }
}
RedundantAudioEncoder.shouldLog = true;
RedundantAudioEncoder.shouldReportStats = true;
RedundantAudioEncoder.initializeWorker();
`;RedundantAudioEncoderWorkerCode$1.default=RedundantAudioEncoderWorkerCode;var __awaiter$q=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$E=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultTransceiverController$1,"__esModule",{value:!0});const AudioProfile_1=__importDefault$E(AudioProfile$1),RedundantAudioRecoveryMetricReport_1=__importDefault$E(RedundantAudioRecoveryMetricReport$1),RedundantAudioEncoder_1=__importDefault$E(RedundantAudioEncoder$1),RedundantAudioEncoderWorkerCode_1=__importDefault$E(RedundantAudioEncoderWorkerCode$1),AsyncScheduler_1$3=__importDefault$E(AsyncScheduler$1);class DefaultTransceiverController{constructor($,_,tt){this.logger=$,this.browserBehavior=_,this.meetingSessionContext=tt,this._localCameraTransceiver=null,this._localAudioTransceiver=null,this.videoSubscriptions=[],this.defaultMediaStream=null,this.peer=null,this.streamIdToTransceiver=new Map,this.groupIdToTransceiver=new Map,this.audioRedWorker=null,this.audioRedWorkerURL=null,this.audioMetricsHistory=new Array,this.redMetricsObservers=new Set,this.currentNumRedundantEncodings=0,this.lastRedHolddownTimerStartTimestampMs=0,this.lastHighPacketLossEventTimestampMs=0,this.lastAudioRedTurnOffTimestampMs=0,this.maxAudioMetricsHistory=20,this.audioRedPacketLossShortEvalPeriodMs=5*1e3,this.audioRedPacketLossLongEvalPeriodMs=15*1e3,this.audioRedHoldDownTimeMs=5*60*1e3,this.redRecoveryTimeMs=1*60*1e3}setEncodingParameters($){return __awaiter$q(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;const _=this._localCameraTransceiver.sender;if(!$||$.size===0)return;const tt=Array.from($.values()),nt=_.getParameters();if(!nt.encodings||nt.encodings.length===0)nt.encodings=tt;else for(const it of nt.encodings)for(const rt of tt){if((it.rid||rt.rid)&&it.rid!==rt.rid)continue;let ot;for(ot in rt)ot==="rid"||ot==="codecPayloadType"||rt.hasOwnProperty(ot)&&(it[ot]=rt[ot])}yield _.setParameters(nt)})}localAudioTransceiver(){return this._localAudioTransceiver}localVideoTransceiver(){return this._localCameraTransceiver}setVideoSendingBitrateKbps($){return __awaiter$q(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;const _=this._localCameraTransceiver.sender;if(!_||$<=0)return;const tt=_.getParameters();tt.encodings||(tt.encodings=[{}]);for(const nt of tt.encodings)nt.maxBitrate=$*1e3;yield _.setParameters(tt)})}setPeer($){this.peer=$}reset(){this.destroyAudioRedWorkerAndStates(),this._localCameraTransceiver=null,this._localAudioTransceiver=null,this.videoSubscriptions=[],this.defaultMediaStream=null,this.peer=null}useTransceivers(){return!!this.peer&&typeof this.peer.getTransceivers<"u"}hasVideoInput(){return!(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")}trackIsVideoInput($){return this._localCameraTransceiver?$===this._localCameraTransceiver.sender.track||$===this._localCameraTransceiver.receiver.track:!1}setupLocalTransceivers(){var $,_;this.useTransceivers()&&(!this.defaultMediaStream&&typeof MediaStream<"u"&&(this.defaultMediaStream=new MediaStream),this._localAudioTransceiver||(this._localAudioTransceiver=this.peer.addTransceiver("audio",{direction:"inactive",streams:[this.defaultMediaStream]}),!((_=($=this.meetingSessionContext)===null||$===void 0?void 0:$.audioProfile)===null||_===void 0)&&_.hasRedundancyEnabled()&&this.setupAudioRedWorker()),this._localCameraTransceiver||(this._localCameraTransceiver=this.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream]})))}replaceAudioTrack($){return __awaiter$q(this,void 0,void 0,function*(){return!this._localAudioTransceiver||this._localAudioTransceiver.direction!=="sendrecv"?(this.logger.info("audio transceiver direction is not set up or not activated"),!1):(yield this._localAudioTransceiver.sender.replaceTrack($),!0)})}setAudioInput($){return __awaiter$q(this,void 0,void 0,function*(){yield this.setTransceiverInput(this._localAudioTransceiver,$)})}setVideoInput($){return __awaiter$q(this,void 0,void 0,function*(){yield this.setTransceiverInput(this._localCameraTransceiver,$)})}updateVideoTransceivers($,_){if(!this.useTransceivers())return _.array();const tt=this.peer.getTransceivers();return this.videoSubscriptions=[0],_=_.clone(),this.updateTransceivers(tt,$,_),this.logger.debug(()=>this.debugDumpTransceivers()),this.videoSubscriptions}updateTransceivers($,_,tt){const nt=tt.array();$.length!==0&&!$[0].stop?(this.logger.info("Updating transceivers without `stop` function"),this.updateTransceiverWithoutStop($,_,nt)):$.length!==0&&this.updateTransceiverWithStop($,_,nt);for(const it of nt){const rt=this.addTransceiver("video",{direction:"recvonly",streams:[new MediaStream]});this.streamIdToTransceiver.set(it,rt),this.groupIdToTransceiver.set(_.groupIdForStreamId(it),rt),this.videoSubscriptions.push(it),this.logger.info(`adding transceiver mid: ${rt.mid} subscription: ${it} direction: recvonly`)}}updateTransceiverWithStop($,_,tt){let nt=1;this.videoSubscriptions=[0];for(const it of $){if(it===this._localCameraTransceiver||!this.transceiverIsVideo(it)||!it.mid)continue;let rt=!1;const ot=_.streamIdForTrack("v_"+it.mid);if(it.direction!=="inactive"&&ot!==void 0){for(const[lt,st]of tt.entries())if(_.StreamIdsInSameGroup(ot,st)){it.direction="recvonly",this.videoSubscriptions[nt]=st,rt=!0,this.streamIdToTransceiver.delete(ot),this.streamIdToTransceiver.set(st,it),tt.splice(lt,1);break}}if(!rt){this.videoSubscriptions[nt]=0,this.logger.info(`Stopping MID: ${it.mid}, direction: ${it.direction}, current direction: ${it.currentDirection}`),it.stop();for(const[lt,st]of this.streamIdToTransceiver.entries())it.mid===st.mid&&(this.streamIdToTransceiver.delete(lt),this.groupIdToTransceiver.delete(_.groupIdForStreamId(lt)))}nt+=1}}updateTransceiverWithoutStop($,_,tt){let nt=1;for(const it of $)if(!(it===this._localCameraTransceiver||!this.transceiverIsVideo(it))){if(this.videoSubscriptions[nt]=0,it.direction!=="inactive"){const rt=_.streamIdForTrack("v_"+it.mid);if(rt!==void 0){for(const[ot,lt]of tt.entries())if(_.StreamIdsInSameGroup(rt,lt)){it.direction="recvonly",this.videoSubscriptions[nt]=lt,this.streamIdToTransceiver.delete(rt),this.streamIdToTransceiver.set(lt,it),tt.splice(ot,1);break}}}nt+=1}nt=1;for(const it of $)if(!(it===this._localCameraTransceiver||!this.transceiverIsVideo(it))){if(it.direction==="inactive"&&tt.length>0){it.direction="recvonly";const rt=tt.shift();this.videoSubscriptions[nt]=rt,this.streamIdToTransceiver.set(rt,it),this.groupIdToTransceiver.set(_.groupIdForStreamId(rt),it)}else if(this.videoSubscriptions[nt]===0){it.direction="inactive";for(const[rt,ot]of this.streamIdToTransceiver.entries())it===ot&&(this.streamIdToTransceiver.delete(rt),this.groupIdToTransceiver.delete(_.groupIdForStreamId(rt)))}nt+=1}}getMidForStreamId($){var _;return(_=this.streamIdToTransceiver.get($))===null||_===void 0?void 0:_.mid}setStreamIdForMid($,_){for(const[tt,nt]of this.streamIdToTransceiver.entries())if(nt.mid===$){this.streamIdToTransceiver.delete(tt),this.streamIdToTransceiver.set(_,nt);return}}getMidForGroupId($){var _,tt;return(tt=(_=this.groupIdToTransceiver.get($))===null||_===void 0?void 0:_.mid)!==null&&tt!==void 0?tt:void 0}transceiverIsVideo($){return $.receiver&&$.receiver.track&&$.receiver.track.kind==="video"||$.sender&&$.sender.track&&$.sender.track.kind==="video"}debugDumpTransceivers(){let $="",_=0;for(const tt of this.peer.getTransceivers())this.transceiverIsVideo(tt)&&($+=`transceiver index=${_} mid=${tt.mid} subscription=${this.videoSubscriptions[_]} direction=${tt.direction}
`,_+=1);return $}setTransceiverInput($,_){return __awaiter$q(this,void 0,void 0,function*(){$&&(_?$.direction="sendrecv":$.direction="inactive",yield $.sender.replaceTrack(_))})}forEachRedMetricsObserver($){for(const _ of this.redMetricsObservers)AsyncScheduler_1$3.default.nextTick(()=>{this.redMetricsObservers.has(_)&&_.recoveryMetricsDidReceive($)})}disableAudioRedundancy(){this.meetingSessionContext.audioProfile=new AudioProfile_1.default(this.meetingSessionContext.audioProfile.audioBitrateBps,!1),this.meetingSessionContext.audioVideoController.setAudioProfile(this.meetingSessionContext.audioProfile)}setupAudioRedWorker(){var $,_;const tt=!!window.RTCRtpScriptTransform,nt=!!RTCRtpSender.prototype.createEncodedStreams;if(tt)this.logger.info("[AudioRed] Supports encoded insertable streams using RTCRtpScriptTransform");else if(nt)this.logger.info("[AudioRed] Supports encoded insertable streams using TransformStream");else throw this.disableAudioRedundancy(),new Error("[AudioRed] Encoded insertable streams not supported. Recreating peer connection with audio redundancy disabled.");try{this.audioRedWorkerURL=URL.createObjectURL(new Blob([RedundantAudioEncoderWorkerCode_1.default],{type:"application/javascript"})),this.logger.info(`[AudioRed] Redundant audio worker URL ${this.audioRedWorkerURL}`),this.audioRedWorker=new Worker(this.audioRedWorkerURL)}catch(it){throw this.logger.error(`[AudioRed] Unable to create audio red worker due to ${it}`),URL.revokeObjectURL(this.audioRedWorkerURL),this.audioRedWorkerURL=null,this.audioRedWorker=null,this.disableAudioRedundancy(),this.logger.info("[AudioRed] Recreating peer connection with audio redundancy disabled"),it}if(this.audioRedEnabled=!0,this.audioRedWorker.onmessage=it=>{if(it.data.type==="REDWorkerLog")this.logger.info(it.data.log);else if(it.data.type==="RedundantAudioEncoderStats"){const rt=new RedundantAudioRecoveryMetricReport_1.default;rt.currentTimestampMs=Date.now(),rt.ssrc=it.data.ssrc,rt.totalAudioPacketsLost=it.data.totalAudioPacketsLost,rt.totalAudioPacketsExpected=it.data.totalAudioPacketsExpected,rt.totalAudioPacketsRecoveredRed=it.data.totalAudioPacketsRecoveredRed,rt.totalAudioPacketsRecoveredFec=it.data.totalAudioPacketsRecoveredFec,this.forEachRedMetricsObserver(rt)}},tt)this._localAudioTransceiver.sender.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"SenderTransform"}),this._localAudioTransceiver.receiver.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"ReceiverTransform"});else if(nt){const it=this._localAudioTransceiver.sender.createEncodedStreams(),rt=this._localAudioTransceiver.receiver.createEncodedStreams();this.audioRedWorker.postMessage({msgType:"StartRedWorker",send:it,receive:rt},[it.readable,it.writable,rt.readable,rt.writable])}($=this.meetingSessionContext)===null||$===void 0||$.audioVideoController.addObserver(this),this.addRedundantAudioRecoveryMetricsObserver((_=this.meetingSessionContext)===null||_===void 0?void 0:_.statsCollector)}addTransceiver($,_){var tt;const nt=this.peer.addTransceiver($,_);if(!(!((tt=this.peer.getConfiguration())===null||tt===void 0)&&tt.encodedInsertableStreams)||!this.audioRedWorker)return nt;const it=!!window.RTCRtpScriptTransform,rt=!!RTCRtpSender.prototype.createEncodedStreams;if(it)nt.sender.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"PassthroughTransform"}),nt.receiver.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"PassthroughTransform"});else if(rt){const ot=nt.sender.createEncodedStreams(),lt=nt.receiver.createEncodedStreams();this.audioRedWorker.postMessage({msgType:"PassthroughTransform",send:ot,receive:lt},[ot.readable,ot.writable,lt.readable,lt.writable])}return nt}destroyAudioRedWorkerAndStates(){var $,_;this.audioRedWorker&&(URL.revokeObjectURL(this.audioRedWorkerURL),this.audioRedWorkerURL=null,this.audioRedWorker.terminate(),this.audioRedWorker=null,this.currentNumRedundantEncodings=0,this.lastRedHolddownTimerStartTimestampMs=0,this.lastAudioRedTurnOffTimestampMs=0,this.lastHighPacketLossEventTimestampMs=0,this.audioRedEnabled=!0,($=this.meetingSessionContext)===null||$===void 0||$.audioVideoController.removeObserver(this),this.removeRedundantAudioRecoveryMetricsObserver((_=this.meetingSessionContext)===null||_===void 0?void 0:_.statsCollector))}setAudioPayloadTypes($){this.audioRedWorker&&(this.audioRedWorker.postMessage({msgType:"RedPayloadType",payloadType:$.get("red")}),this.audioRedWorker.postMessage({msgType:"OpusPayloadType",payloadType:$.get("opus")}))}metricsDidReceive($){const{currentTimestampMs:_}=$,tt=$.getRTCStatsReport();let nt=0,it=0,rt=0;tt.forEach(dt=>{dt.kind==="audio"&&(dt.type==="outbound-rtp"?it=dt.packetsSent:dt.type==="remote-inbound-rtp"&&(nt=dt.timestamp,rt=dt.packetsLost))}),(this.audioMetricsHistory.length===0||nt>this.audioMetricsHistory[this.audioMetricsHistory.length-1].timestampMs&&it>this.audioMetricsHistory[this.audioMetricsHistory.length-1].totalPacketsSent)&&this.audioMetricsHistory.push({timestampMs:nt,totalPacketsSent:it,totalPacketsLost:rt}),this.audioMetricsHistory.length>this.maxAudioMetricsHistory&&this.audioMetricsHistory.shift();const ot=this.lossPercent(this.audioRedPacketLossShortEvalPeriodMs),lt=this.lossPercent(this.audioRedPacketLossLongEvalPeriodMs),st=Math.max(ot,lt),[at,ct]=RedundantAudioEncoder_1.default.getNumRedundantEncodingsForPacketLoss(st);if(ct){this.lastHighPacketLossEventTimestampMs=_,this.audioRedEnabled&&(this.audioRedWorker&&this.audioRedWorker.postMessage({msgType:"Disable"}),this.audioRedEnabled=!1,this.lastAudioRedTurnOffTimestampMs=_);return}else if(!this.audioRedEnabled){const dt=_-this.lastAudioRedTurnOffTimestampMs,ut=_-this.lastHighPacketLossEventTimestampMs;if(dt>=this.audioRedPacketLossLongEvalPeriodMs&&ut<this.redRecoveryTimeMs)return;this.audioRedWorker&&this.audioRedWorker.postMessage({msgType:"Enable"}),this.audioRedEnabled=!0,this.maybeResetHoldDownTimer(_)}this.shouldUpdateAudioRedWorkerEncodings(_,at)&&this.audioRedWorker&&this.audioRedWorker.postMessage({msgType:"UpdateNumRedundantEncodings",numRedundantEncodings:at})}maybeResetHoldDownTimer($){this.currentNumRedundantEncodings>0&&(this.lastRedHolddownTimerStartTimestampMs=$)}lossPercent($){if(this.audioMetricsHistory.length<2)return 0;const _=this.audioMetricsHistory[this.audioMetricsHistory.length-1].timestampMs,tt=this.audioMetricsHistory[this.audioMetricsHistory.length-1].totalPacketsSent,nt=this.audioMetricsHistory[this.audioMetricsHistory.length-1].totalPacketsLost;for(let it=this.audioMetricsHistory.length-2;it>=0;it--)if(_-this.audioMetricsHistory[it].timestampMs>=$){const rt=nt-this.audioMetricsHistory[it].totalPacketsLost,ot=tt-this.audioMetricsHistory[it].totalPacketsSent,lt=100*(rt/ot);return Math.max(0,Math.min(lt,100))}return 0}shouldUpdateAudioRedWorkerEncodings($,_){return this.currentNumRedundantEncodings===_?(this.maybeResetHoldDownTimer($),!1):_<this.currentNumRedundantEncodings&&$-this.lastRedHolddownTimerStartTimestampMs<this.audioRedHoldDownTimeMs?!1:(this.currentNumRedundantEncodings=_,this.maybeResetHoldDownTimer($),!0)}addRedundantAudioRecoveryMetricsObserver($){this.redMetricsObservers.add($)}removeRedundantAudioRecoveryMetricsObserver($){this.redMetricsObservers.delete($)}}DefaultTransceiverController$1.default=DefaultTransceiverController;var SimulcastContentShareTransceiverController$1={},SimulcastTransceiverController$1={},__awaiter$p=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$D=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(SimulcastTransceiverController$1,"__esModule",{value:!0});const DefaultTransceiverController_1$1=__importDefault$D(DefaultTransceiverController$1);class SimulcastTransceiverController extends DefaultTransceiverController_1$1.default{constructor($,_,tt){super($,_,tt),this.videoQualityControlParameterMap=new Map;let nt=4;for(let it=0;it<SimulcastTransceiverController.NAME_ARR_ASCENDING.length;it++){const rt=SimulcastTransceiverController.NAME_ARR_ASCENDING[it];this.videoQualityControlParameterMap.set(rt,{rid:rt,scaleResolutionDownBy:nt,maxBitrate:SimulcastTransceiverController.BITRATE_ARR_ASCENDING[it]*1e3}),nt=nt/2}}setEncodingParameters($){return __awaiter$p(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;const _=this._localCameraTransceiver.sender,tt=Array.from($.values());if(tt.length<=0)return;const nt=_.getParameters();if(!nt.encodings)nt.encodings=tt;else for(const it of nt.encodings)it.rid===SimulcastTransceiverController.LOW_LEVEL_NAME&&this.copyEncodingParams($.get(SimulcastTransceiverController.LOW_LEVEL_NAME),it),it.rid===SimulcastTransceiverController.MID_LEVEL_NAME&&this.copyEncodingParams($.get(SimulcastTransceiverController.MID_LEVEL_NAME),it),it.rid===SimulcastTransceiverController.HIGH_LEVEL_NAME&&this.copyEncodingParams($.get(SimulcastTransceiverController.HIGH_LEVEL_NAME),it);yield _.setParameters(nt),this.logVideoTransceiverParameters()})}setVideoSendingBitrateKbps($){return __awaiter$p(this,void 0,void 0,function*(){})}setupLocalTransceivers(){var $,_;if(this.useTransceivers()&&(!this.defaultMediaStream&&typeof MediaStream<"u"&&(this.defaultMediaStream=new MediaStream),this._localAudioTransceiver||(this._localAudioTransceiver=this.peer.addTransceiver("audio",{direction:"inactive",streams:[this.defaultMediaStream]}),!((_=($=this.meetingSessionContext)===null||$===void 0?void 0:$.audioProfile)===null||_===void 0)&&_.hasRedundancyEnabled()&&this.setupAudioRedWorker()),!this._localCameraTransceiver)){const tt=Array.from(this.videoQualityControlParameterMap.values());this._localCameraTransceiver=this.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream],sendEncodings:tt})}}logVideoTransceiverParameters(){const _=this._localCameraTransceiver.sender.getParameters().encodings;let tt=`simulcast: current encoding parameters 
`;for(const nt of _)tt+=`rid=${nt.rid} maxBitrate=${nt.maxBitrate} active=${nt.active} scaleDownBy=${nt.scaleResolutionDownBy} maxFrameRate = ${nt.maxFramerate} 
`;this.logger.info(tt)}copyEncodingParams($,_){_.active=$.active,_.maxBitrate=$.maxBitrate,_.scaleResolutionDownBy=$.scaleResolutionDownBy,_.maxFramerate=$.maxFramerate}}SimulcastTransceiverController$1.default=SimulcastTransceiverController;SimulcastTransceiverController.LOW_LEVEL_NAME="low";SimulcastTransceiverController.MID_LEVEL_NAME="mid";SimulcastTransceiverController.HIGH_LEVEL_NAME="hi";SimulcastTransceiverController.NAME_ARR_ASCENDING=["low","mid","hi"];SimulcastTransceiverController.BITRATE_ARR_ASCENDING=[200,400,1100];var __awaiter$o=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$C=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(SimulcastContentShareTransceiverController$1,"__esModule",{value:!0});const SimulcastTransceiverController_1$1=__importDefault$C(SimulcastTransceiverController$1);class SimulcastContentShareTransceiverController extends SimulcastTransceiverController_1$1.default{constructor($,_,tt){super($,_,tt);let nt=2;this.videoQualityControlParameterMap=new Map;for(let it=0;it<SimulcastContentShareTransceiverController.NAME_ARR_ASCENDING.length;it++){const rt=SimulcastContentShareTransceiverController.NAME_ARR_ASCENDING[it];this.videoQualityControlParameterMap.set(rt,{rid:rt,scaleResolutionDownBy:nt,maxBitrate:SimulcastContentShareTransceiverController.BITRATE_ARR_ASCENDING[it]*1e3}),nt=nt/2}}setEncodingParameters($){return __awaiter$o(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;const _=this._localCameraTransceiver.sender,tt=Array.from($.values());if(tt.length<=0)return;const nt=_.getParameters();if(!nt.encodings)nt.encodings=tt;else for(let it=0;it<nt.encodings.length;it++)nt.encodings[it].rid===SimulcastTransceiverController_1$1.default.LOW_LEVEL_NAME&&this.copyEncodingParams($.get(SimulcastTransceiverController_1$1.default.LOW_LEVEL_NAME),nt.encodings[it]),nt.encodings[it].rid===SimulcastTransceiverController_1$1.default.HIGH_LEVEL_NAME&&this.copyEncodingParams($.get(SimulcastTransceiverController_1$1.default.HIGH_LEVEL_NAME),nt.encodings[it]);yield _.setParameters(nt),this.logVideoTransceiverParameters()})}}SimulcastContentShareTransceiverController$1.default=SimulcastContentShareTransceiverController;SimulcastContentShareTransceiverController.NAME_ARR_ASCENDING=["low","hi"];SimulcastContentShareTransceiverController.BITRATE_ARR_ASCENDING=[300,1200];var VideoOnlyTransceiverController$1={},__importDefault$B=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(VideoOnlyTransceiverController$1,"__esModule",{value:!0});const DefaultTransceiverController_1=__importDefault$B(DefaultTransceiverController$1);class VideoOnlyTransceiverController extends DefaultTransceiverController_1.default{constructor($,_,tt){super($,_,tt)}setupLocalTransceivers(){this.useTransceivers()&&(!this.defaultMediaStream&&typeof MediaStream<"u"&&(this.defaultMediaStream=new MediaStream),this._localCameraTransceiver||(this._localCameraTransceiver=this.peer.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream]})))}}VideoOnlyTransceiverController$1.default=VideoOnlyTransceiverController;var DefaultVideoCaptureAndEncodeParameter$1={};Object.defineProperty(DefaultVideoCaptureAndEncodeParameter$1,"__esModule",{value:!0});class DefaultVideoCaptureAndEncodeParameter{constructor($,_,tt,nt,it,rt=1,ot=!1){this.cameraWidth=$,this.cameraHeight=_,this.cameraFrameRate=tt,this.maxEncodeBitrateKbps=nt,this.isSimulcast=it,this.scaleResolutionDownBy=rt,this.isSVC=ot}equal($){let _=$.captureWidth()===this.cameraWidth&&$.captureHeight()===this.cameraHeight&&$.captureFrameRate()===this.cameraFrameRate&&$.encodeBitrates().length===this.encodeBitrates().length&&$.encodeScaleResolutionDownBy().length===this.encodeScaleResolutionDownBy().length&&$.encodeWidths().length===this.encodeWidths().length&&$.encodeHeights().length===this.encodeHeights().length&&$.isSVCEncoding()===this.isSVC;if(_){for(let tt=0;tt<$.encodeWidths().length;tt++)if($.encodeWidths()[tt]!==this.encodeWidths()[tt]||$.encodeHeights()[tt]!==this.encodeHeights()[tt]||$.encodeBitrates()[tt]!==this.encodeBitrates()[tt]||$.encodeScaleResolutionDownBy()[tt]!==this.encodeScaleResolutionDownBy()[tt])return _=!1,_}return _}clone(){return new DefaultVideoCaptureAndEncodeParameter(this.cameraWidth,this.cameraHeight,this.cameraFrameRate,this.maxEncodeBitrateKbps,this.isSimulcast,this.scaleResolutionDownBy,this.isSVC)}captureWidth(){return this.cameraWidth}captureHeight(){return this.cameraHeight}captureFrameRate(){return this.cameraFrameRate}encodeBitrates(){return[this.maxEncodeBitrateKbps]}encodeScaleResolutionDownBy(){return[this.scaleResolutionDownBy]}encodeWidths(){return[this.cameraWidth]}encodeHeights(){return[this.cameraHeight]}isSVCEncoding(){return this.isSVC}}DefaultVideoCaptureAndEncodeParameter$1.default=DefaultVideoCaptureAndEncodeParameter;var VideoAdaptiveProbePolicy$1={},VideoPreference$1={},TargetDisplaySize={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.TargetDisplaySize=void 0;var $;(function(_){_[_.Low=0]="Low",_[_.Medium=1]="Medium",_[_.High=2]="High",_[_.Maximum=3]="Maximum"})($=et.TargetDisplaySize||(et.TargetDisplaySize={})),et.default=$})(TargetDisplaySize);var __importDefault$A=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(VideoPreference$1,"__esModule",{value:!0});const TargetDisplaySize_1$1=__importDefault$A(TargetDisplaySize),VideoQualityAdaptationPreference_1$1=__importDefault$A(VideoQualityAdaptationPreference);class VideoPreference{constructor($,_,tt,nt){this.attendeeId=$,this.priority=_,this.targetSize=tt!==void 0?tt:TargetDisplaySize_1$1.default.Maximum,this.degradationPreference=nt!==void 0?nt:VideoQualityAdaptationPreference_1$1.default.Balanced}partialCompare($){return this.priority-$.priority}equals($){return this.attendeeId===$.attendeeId&&this.targetSize===$.targetSize&&this.priority===$.priority&&this.degradationPreference===$.degradationPreference}clone(){return new VideoPreference(this.attendeeId,this.priority,this.targetSize,this.degradationPreference)}targetSizeToBitrateKbps($){switch($){case TargetDisplaySize_1$1.default.Maximum:return VideoPreference.MAXIMUM_BITRATE_KBPS;case TargetDisplaySize_1$1.default.High:return VideoPreference.HIGH_BITRATE_KBPS;case TargetDisplaySize_1$1.default.Medium:return VideoPreference.MID_BITRATE_KBPS;case TargetDisplaySize_1$1.default.Low:return VideoPreference.LOW_BITRATE_KBPS}}}VideoPreference$1.default=VideoPreference;VideoPreference.LOW_BITRATE_KBPS=300;VideoPreference.MID_BITRATE_KBPS=600;VideoPreference.HIGH_BITRATE_KBPS=1500;VideoPreference.MAXIMUM_BITRATE_KBPS=1e4;var VideoPriorityBasedPolicy$1={},VideoSource$1={};Object.defineProperty(VideoSource$1,"__esModule",{value:!0});class VideoSource{}VideoSource$1.default=VideoSource;var VideoPriorityBasedPolicyConfig$1={},__importDefault$z=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(VideoPriorityBasedPolicyConfig$1,"__esModule",{value:!0});const ServerSideNetworkAdaption_1$2=__importDefault$z(ServerSideNetworkAdaption);class VideoPriorityBasedPolicyConfig{constructor($=0,_=0){this.networkIssueResponseDelayFactor=$,this.networkIssueRecoveryDelayFactor=_,this.currentNetworkEvent=0,this.bandwidthDecreaseTimestamp=0,this.referenceBitrate=0,this.serverSideNetworkAdaption=ServerSideNetworkAdaption_1$2.default.BandwidthProbingAndRemoteVideoQualityAdaption,$<0?$=0:$>1&&($=1),this.networkIssueResponseDelayFactor=$,_<0?_=0:_>1&&(_=1),this.networkIssueRecoveryDelayFactor=_}allowSubscribe($,_){let tt=0;const nt=this.currentNetworkEvent;if(_>this.referenceBitrate)return this.currentNetworkEvent=2,this.referenceBitrate=_,!0;if(_<this.referenceBitrate){if(this.currentNetworkEvent=1,tt=this.getSubscribeDelay(this.currentNetworkEvent,$),nt!==1)this.bandwidthDecreaseTimestamp=Date.now();else if(Date.now()-this.bandwidthDecreaseTimestamp>tt)return this.referenceBitrate=_,!0;return!1}else return this.currentNetworkEvent=0,!1}getSubscribeDelay($,_){let tt=VideoPriorityBasedPolicyConfig.MINIMUM_DELAY_MS;const nt=VideoPriorityBasedPolicyConfig.MAXIMUM_DELAY_MS-VideoPriorityBasedPolicyConfig.MINIMUM_DELAY_MS,it=this.networkIssueResponseDelayFactor;switch($){case 1:tt+=nt*it*(1+_/10),tt=Math.min(VideoPriorityBasedPolicyConfig.MAXIMUM_DELAY_MS,tt);break}return tt}}VideoPriorityBasedPolicyConfig$1.default=VideoPriorityBasedPolicyConfig;VideoPriorityBasedPolicyConfig.MINIMUM_DELAY_MS=2e3;VideoPriorityBasedPolicyConfig.MAXIMUM_DELAY_MS=8e3;VideoPriorityBasedPolicyConfig.Default=new VideoPriorityBasedPolicyConfig(0,0);VideoPriorityBasedPolicyConfig.UnstableNetworkPreset=new VideoPriorityBasedPolicyConfig(0,1);VideoPriorityBasedPolicyConfig.StableNetworkPreset=new VideoPriorityBasedPolicyConfig(1,0);var __createBinding=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(et,$,_,tt){tt===void 0&&(tt=_),Object.defineProperty(et,tt,{enumerable:!0,get:function(){return $[_]}})}:function(et,$,_,tt){tt===void 0&&(tt=_),et[tt]=$[_]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(et,$){Object.defineProperty(et,"default",{enumerable:!0,value:$})}:function(et,$){et.default=$}),__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(et){if(et&&et.__esModule)return et;var $={};if(et!=null)for(var _ in et)_!=="default"&&Object.prototype.hasOwnProperty.call(et,_)&&__createBinding($,et,_);return __setModuleDefault($,et),$},__importDefault$y=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(VideoPriorityBasedPolicy$1,"__esModule",{value:!0});const Attendee_1=__importDefault$y(Attendee$1),ClientMetricReportDirection_1=__importDefault$y(ClientMetricReportDirection),ClientMetricReportMediaType_1=__importDefault$y(ClientMetricReportMediaType),ContentShareConstants_1$2=__importDefault$y(ContentShareConstants$1),LogLevel_1$4=LogLevel,ServerSideNetworkAdaption_1$1=__importStar(ServerSideNetworkAdaption),VideoSource_1=__importDefault$y(VideoSource$1),DefaultVideoStreamIdSet_1$2=__importDefault$y(DefaultVideoStreamIdSet$1),AllHighestVideoBandwidthPolicy_1=__importDefault$y(AllHighestVideoBandwidthPolicy$1),TargetDisplaySize_1=__importDefault$y(TargetDisplaySize),VideoPreference_1$1=__importDefault$y(VideoPreference$1),VideoPreferences_1$1=VideoPreferences$1,VideoPriorityBasedPolicyConfig_1$1=__importDefault$y(VideoPriorityBasedPolicyConfig$1),VideoQualityAdaptationPreference_1=__importDefault$y(VideoQualityAdaptationPreference);class LinkMediaStats{constructor(){this.bandwidthEstimateKbps=0,this.usedBandwidthKbps=0,this.packetsLost=0,this.nackCount=0,this.rttMs=0}}class VideoPriorityBasedPolicy{constructor($,_=VideoPriorityBasedPolicyConfig_1$1.default.Default){this.logger=$,this.videoPriorityBasedPolicyConfig=_,this.shouldPauseTiles=!0,this.observerQueue=new Set,this.pausedBwAttendeeIds=new Set,this.wantsResubscribeObserver=void 0,this.videoPriorityBasedPolicyConfig.serverSideNetworkAdaption===ServerSideNetworkAdaption_1$1.default.Default&&(this.videoPriorityBasedPolicyConfig.serverSideNetworkAdaption=ServerSideNetworkAdaption_1$1.default.BandwidthProbingAndRemoteVideoQualityAdaption),this.reset()}reset(){this.allHighestPolicy=new AllHighestVideoBandwidthPolicy_1.default(""),this.optimalReceiveSet=new DefaultVideoStreamIdSet_1$2.default,this.optimalReceiveStreams=[],this.optimalNonPausedReceiveStreams=[],this.subscribedReceiveSet=new DefaultVideoStreamIdSet_1$2.default,this.subscribedReceiveStreams=[],this.videoPreferences=void 0,this.defaultVideoPreferences=void 0,this.shouldPauseTiles=!0,this.pausedStreamIds=new DefaultVideoStreamIdSet_1$2.default,this.pausedBwAttendeeIds=new Set,this.videoPreferencesUpdated=!1,this.logCount=0,this.startupPeriod=!0,this.usingPrevTargetRate=!1,this.rateProbeState="Not Probing",this.firstEstimateTimestamp=0,this.lastUpgradeRateKbps=0,this.timeBeforeAllowSubscribeMs=VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_SUBSCRIBE_MS,this.lastProbeTimestamp=Date.now(),this.timeBeforeAllowProbeMs=VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_PROBE_MS,this.downlinkStats=new LinkMediaStats,this.prevDownlinkStats=new LinkMediaStats,this.probeFailed=!1,this.serverSideNetworkAdaption=this.videoPriorityBasedPolicyConfig.serverSideNetworkAdaption,this.pendingActionAfterUpdatedPreferences=!1}bindToTileController($){this.tileController=$,this.logger.info("tileController bound")}setWantsResubscribeObserver($){this.wantsResubscribeObserver=$}chooseRemoteVideoSources($){var _;if(!(!((_=this.videoPreferences)===null||_===void 0)&&_.equals($))){if(this.videoPreferences=$==null?void 0:$.clone(),!ServerSideNetworkAdaption_1$1.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)&&(this.pendingActionAfterUpdatedPreferences=!0,this.wantsResubscribeObserver!==void 0&&(this.wantsResubscribeObserver(),this.pendingActionAfterUpdatedPreferences=!1),this.serverSideNetworkAdaption===ServerSideNetworkAdaption_1$1.default.BandwidthProbingAndRemoteVideoQualityAdaption)){const tt=new Array;for(const nt of this.videoPreferences){const it=new VideoSource_1.default;it.attendee=new Attendee_1.default,it.attendee.attendeeId=nt.attendeeId,tt.push(it)}this.allHighestPolicy.chooseRemoteVideoSources(tt);return}this.videoPreferencesUpdated=!0,this.logger.info(`bwe: setVideoPreferences bwe: new preferences: ${JSON.stringify($)}`)}}updateIndex($){this.videoIndex=$,this.serverSideNetworkAdaption===ServerSideNetworkAdaption_1$1.default.BandwidthProbingAndRemoteVideoQualityAdaption&&this.allHighestPolicy.updateIndex($),this.videoPreferences||this.updateDefaultVideoPreferences()}updateDefaultVideoPreferences(){const $=new Set;for(const it of this.videoIndex.remoteStreamDescriptions())$.add(it.attendeeId);const _=VideoPreferences_1$1.VideoPreferences.prepare(),tt=$.size;let nt=TargetDisplaySize_1.default.Maximum;tt>8?nt=TargetDisplaySize_1.default.Low:tt>4&&(nt=TargetDisplaySize_1.default.Medium);for(const it of $)_.add(new VideoPreference_1$1.default(it,1,nt));this.defaultVideoPreferences=_.build()}updateMetrics($){if(!this.videoIndex||this.videoIndex.allStreams().empty())return;this.prevDownlinkStats=this.downlinkStats,this.downlinkStats=new LinkMediaStats;const _=$.getObservableMetrics();this.downlinkStats.bandwidthEstimateKbps=_.availableIncomingBitrate/1e3;for(const tt in $.streamMetricReports){const nt=Number.parseInt(tt,10),it=$.streamMetricReports[nt];it.direction===ClientMetricReportDirection_1.default.DOWNSTREAM&&it.mediaType===ClientMetricReportMediaType_1.default.VIDEO&&(it.currentMetrics.hasOwnProperty("nackCount")&&(this.downlinkStats.nackCount+=$.countPerSecond("nackCount",nt)),it.currentMetrics.hasOwnProperty("packetsLost")&&(this.downlinkStats.packetsLost+=$.countPerSecond("packetsLost",nt)),it.currentMetrics.hasOwnProperty("bytesReceived")&&(this.downlinkStats.usedBandwidthKbps+=$.bitsPerSecond("bytesReceived",nt)/1e3))}}wantsResubscribe(){let $=!1;return!ServerSideNetworkAdaption_1$1.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)&&($||($=this.pendingActionAfterUpdatedPreferences),this.serverSideNetworkAdaption===ServerSideNetworkAdaption_1$1.default.BandwidthProbingAndRemoteVideoQualityAdaption)?$||this.allHighestPolicy.wantsResubscribe():(this.calculateOptimalReceiveSet(),$||($=!this.subscribedReceiveSet.equal(this.optimalReceiveSet)),$)}chooseSubscriptions(){return!ServerSideNetworkAdaption_1$1.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)&&(this.pendingActionAfterUpdatedPreferences=!1,this.serverSideNetworkAdaption===ServerSideNetworkAdaption_1$1.default.BandwidthProbingAndRemoteVideoQualityAdaption)?this.allHighestPolicy.chooseSubscriptions():(this.subscribedReceiveSet.equal(this.optimalReceiveSet)||(this.lastSubscribeTimestamp=Date.now()),this.subscribedReceiveSet=this.optimalReceiveSet.clone(),this.subscribedReceiveStreams=this.optimalReceiveStreams.slice(),this.subscribedReceiveSet.clone())}addObserver($){this.observerQueue.add($)}removeObserver($){this.observerQueue.delete($)}forEachObserver($){for(const _ of this.observerQueue)$(_)}setVideoPriorityBasedPolicyConfigs($){this.videoPriorityBasedPolicyConfig=$}calculateOptimalReceiveStreams(){var $;const _=[],tt=this.videoIndex.remoteStreamDescriptions();if(tt.length===0||!(($=this.videoPreferences)===null||$===void 0)&&$.isEmpty()){this.optimalReceiveStreams=[];return}const nt=this.rateProbeState;this.cleanBwPausedTiles(tt),this.handleAppPausedStreams(_,tt);const it=new Map;for(const vt of this.getCurrentVideoPreferences())it.set(vt.attendeeId,vt);const rt=tt.filter(vt=>it.has(vt.attendeeId)),ot=!this.streamsWithPreferenceDidChange(rt),lt=!this.startupPeriod&&ot;if(lt&&Date.now()-this.lastSubscribeTimestamp<this.timeBeforeAllowSubscribeMs)return;rt.sort((vt,Ct)=>vt.maxBitrateKbps===Ct.maxBitrateKbps?vt.streamId-Ct.streamId:vt.maxBitrateKbps-Ct.maxBitrateKbps);for(const vt of rt)(vt.avgBitrateKbps===0||vt.avgBitrateKbps>vt.maxBitrateKbps)&&(vt.attendeeId.endsWith(ContentShareConstants_1$2.default.Modality)&&vt.maxBitrateKbps<100?vt.maxBitrateKbps=vt.avgBitrateKbps:vt.avgBitrateKbps=vt.maxBitrateKbps);const st=new Set;for(const vt of this.getCurrentVideoPreferences()){const Ct=rt.filter(At=>At.attendeeId===vt.attendeeId);if(Ct.length<3)continue;let Et=15,Mt=320*480;Ct.forEach(At=>{Et=Math.max(Et,At.maxFrameRate),Mt=Math.max(Mt,At.totalPixels())}),Ct.sort((At,Dt)=>{if(vt.degradationPreference===VideoQualityAdaptationPreference_1.default.MaintainResolution)return Math.abs(At.maxFrameRate-Dt.maxFrameRate)<2?At.totalPixels()-Dt.totalPixels():At.maxFrameRate-Dt.maxFrameRate;if(vt.degradationPreference===VideoQualityAdaptationPreference_1.default.MaintainFramerate)return At.totalPixels()===Dt.totalPixels()?At.maxFrameRate-Dt.maxFrameRate:At.totalPixels()-Dt.totalPixels();{const jt=qt=>qt.avgBitrateKbps*Math.pow(2,5*qt.maxFrameRate/Et*Math.pow(4,qt.totalPixels()/Mt));return jt(At)-jt(Dt)}});let Rt;for(const At of Ct){if(Rt!==void 0&&(At.maxFrameRate<Rt.maxFrameRate&&Math.abs(Rt.maxFrameRate-At.maxFrameRate)>2||At.totalPixels()<Rt.totalPixels())){st.add(At.streamId);continue}Rt=At}}const at=rt.filter(vt=>!st.has(vt.streamId));this.logger.info(`Filtered to ${JSON.stringify(at)}`);const ct={targetDownlinkBitrate:0,chosenTotalBitrate:0,deltaToNextUpgrade:0};ct.targetDownlinkBitrate=this.determineTargetRate();const dt=this.subscribedReceiveSet.size(),ut=this.downlinkStats.bandwidthEstimateKbps,ft=!this.videoPriorityBasedPolicyConfig.allowSubscribe(dt,ut);if(this.probeFailed&&(this.probeFailed=!1,this.timeBeforeAllowSubscribeMs=VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_SUBSCRIBE_MS,lt&&ft))return;const pt=this.priorityPolicy(ct,at,_),St=!ServerSideNetworkAdaption_1$1.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption);let gt=0;if(!St&&!this.startupPeriod&&ot?this.rateProbeState==="Probing"?gt=this.handleProbe(_,ct.targetDownlinkBitrate):ct.deltaToNextUpgrade!==0&&(gt=this.maybeOverrideOrProbe(_,ct,pt)):(this.setProbeState("Not Probing"),this.lastUpgradeRateKbps=0),this.previousStreamsWithPreference=rt,this.videoPreferencesUpdated=!1,gt===1){this.logger.info(`bwe: keepSameSubscriptions stats:${JSON.stringify(this.downlinkStats)}`),this.prevTargetRateKbps=ct.targetDownlinkBitrate;return}if(gt===2){const vt=this.calculateSubscribeRate(this.preProbeNonPausedReceiveStreams);this.optimalReceiveStreams=this.preProbeReceiveStreams.slice(),this.processBwPausedStreams(rt,this.preProbeNonPausedReceiveStreams),this.logger.info("bwe: Use Pre-Probe subscription subscribedRate:"+vt);return}this.optimalNonPausedReceiveStreams=_.slice();const yt=this.pausedBwAttendeeIds.size;this.processBwPausedStreams(rt,_),this.logger.getLogLevel()<=LogLevel_1$4.LogLevel.INFO&&(this.logCount%15===0||this.rateProbeState!==nt||this.optimalReceiveStreams.length!==_.length||yt!==this.pausedBwAttendeeIds.size)&&(this.logger.info(this.policyStateLogStr(tt,ct.targetDownlinkBitrate)),this.logCount=0),this.logCount++,this.prevTargetRateKbps=ct.targetDownlinkBitrate,this.optimalReceiveStreams=_.slice()}calculateOptimalReceiveSet(){const $=new DefaultVideoStreamIdSet_1$2.default;this.calculateOptimalReceiveStreams();for(const _ of this.optimalReceiveStreams)$.add(_.streamId);if(!this.optimalReceiveSet.equal($)){const _=this.calculateSubscribeRate(this.optimalReceiveStreams);this.logger.info(`bwe: new streamSelection: ${JSON.stringify($)} subscribedRate:${_}`)}this.optimalReceiveSet=$}determineTargetRate(){let $=0;const _=Date.now();return this.downlinkStats.bandwidthEstimateKbps!==0?(this.firstEstimateTimestamp===0&&(this.firstEstimateTimestamp=_),this.startupPeriod&&(this.downlinkStats.bandwidthEstimateKbps>VideoPriorityBasedPolicy.DEFAULT_BANDWIDTH_KBPS||this.downlinkStats.packetsLost>0||_-this.firstEstimateTimestamp>VideoPriorityBasedPolicy.STARTUP_PERIOD_MS&&this.downlinkStats.bandwidthEstimateKbps<=this.prevDownlinkStats.bandwidthEstimateKbps)&&(this.startupPeriod=!1,this.prevTargetRateKbps=this.downlinkStats.bandwidthEstimateKbps),this.startupPeriod?$=VideoPriorityBasedPolicy.DEFAULT_BANDWIDTH_KBPS:this.rateProbeState==="Probing"&&this.downlinkStats.usedBandwidthKbps>this.downlinkStats.bandwidthEstimateKbps&&this.downlinkStats.packetsLost<VideoPriorityBasedPolicy.SPURIOUS_PACKET_LOST_THRESHOLD?(this.logger.info(`bwe: In probe state, overriding estimate ${this.downlinkStats.bandwidthEstimateKbps} with actual receive bitrate ${this.downlinkStats.usedBandwidthKbps}`),$=this.downlinkStats.usedBandwidthKbps+VideoPriorityBasedPolicy.USED_BANDWIDTH_OVERRIDE_BUFFER_KBPS):$=this.downlinkStats.bandwidthEstimateKbps):this.firstEstimateTimestamp===0?$=VideoPriorityBasedPolicy.DEFAULT_BANDWIDTH_KBPS:$=this.prevTargetRateKbps,!this.startupPeriod&&(this.usingPrevTargetRate&&this.downlinkStats.bandwidthEstimateKbps<this.prevTargetRateKbps||this.downlinkStats.bandwidthEstimateKbps<this.prevTargetRateKbps*(100-VideoPriorityBasedPolicy.LARGE_RATE_CHANGE_TRIGGER_PERCENT)/100||this.downlinkStats.bandwidthEstimateKbps<this.downlinkStats.usedBandwidthKbps*VideoPriorityBasedPolicy.LARGE_RATE_CHANGE_TRIGGER_PERCENT/100)&&this.downlinkStats.packetsLost===0?(this.logger.debug(()=>"bwe: ValidateRate: Using Previous rate "+this.prevTargetRateKbps),this.usingPrevTargetRate=!0,$=this.prevTargetRateKbps):this.usingPrevTargetRate=!1,$>15e3&&this.logger.warn("bwe: "+$+" exceeds maximum limit (15000). Limit TargetDisplaySize with VideoPreferences to avoid this."),Math.min($,15e3)}setProbeState($){if(this.rateProbeState===$)return!1;const _=Date.now();switch($){case"Not Probing":this.probePendingStartTimestamp=0;break;case"Probe Pending":if(this.lastProbeTimestamp===0||_-this.lastProbeTimestamp>VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_PROBE_MS)this.probePendingStartTimestamp=_;else return!1;break;case"Probing":if(_-this.probePendingStartTimestamp>this.timeBeforeAllowProbeMs)this.lastProbeTimestamp=_,this.preProbeReceiveStreams=this.subscribedReceiveStreams.slice(),this.preProbeNonPausedReceiveStreams=this.optimalNonPausedReceiveStreams,this.timeBeforeAllowProbeMs=Math.min(this.timeBeforeAllowProbeMs*2,VideoPriorityBasedPolicy.MAX_HOLD_BEFORE_PROBE_MS);else return!1;break}return this.logger.info("bwe: setProbeState to "+$+" from "+this.rateProbeState),this.rateProbeState=$,!0}upgradeToStream($,_){for(let tt=0;tt<$.length;tt++)if($[tt].groupId===_.groupId){const nt=_.avgBitrateKbps-$[tt].avgBitrateKbps;return this.logger.info("bwe: upgradeStream from "+JSON.stringify($[tt])+" to "+_),this.lastUpgradeRateKbps=nt,$[tt]=_,nt}return $.push(_),this.lastUpgradeRateKbps=_.avgBitrateKbps,this.lastUpgradeRateKbps}handleProbe($,_){if(Date.now()-this.lastProbeTimestamp>VideoPriorityBasedPolicy.MAX_ALLOWED_PROBE_TIME_MS)return this.logger.info("bwe: Canceling probe due to timeout"),this.setProbeState("Not Probing"),0;if(this.downlinkStats.packetsLost>0&&(this.logger.info(`bwe: Probe encountering packets lost:${this.downlinkStats.packetsLost}`),this.downlinkStats.packetsLost>VideoPriorityBasedPolicy.SPURIOUS_PACKET_LOST_THRESHOLD))return this.setProbeState("Not Probing"),this.logger.info(`bwe: Canceling probe due to packets lost:${this.downlinkStats.packetsLost}`),this.probeFailed=!0,this.timeBeforeAllowSubscribeMs=Math.max(VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_SUBSCRIBE_MS,this.timeBeforeAllowSubscribeMs)*3,2;const tt=this.calculateSubscribeRate(this.optimalReceiveStreams);return this.chosenStreamsSameAsLast($)||_>tt?(this.logger.info("bwe: Probe successful"),this.setProbeState("Not Probing"),this.timeBeforeAllowProbeMs=VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_PROBE_MS,0):1}maybeOverrideOrProbe($,_,tt){const nt=this.chosenStreamsSameAsLast($);let it=0;const rt=_.targetDownlinkBitrate>VideoPriorityBasedPolicy.LOW_BITRATE_THRESHOLD_KBPS?VideoPriorityBasedPolicy.TARGET_RATE_CHANGE_TRIGGER_PERCENT:VideoPriorityBasedPolicy.TARGET_RATE_CHANGE_TRIGGER_PERCENT*2,ot=_.targetDownlinkBitrate*rt/100;if(this.targetRateBaselineForDeltaCheckKbps=this.targetRateBaselineForDeltaCheckKbps!==void 0?this.targetRateBaselineForDeltaCheckKbps:this.prevTargetRateKbps,!nt&&Math.abs(_.targetDownlinkBitrate-this.targetRateBaselineForDeltaCheckKbps)<ot?(this.logger.info("bwe: MaybeOverrideOrProbe: Reuse last decision based on delta rate. {"+JSON.stringify(this.subscribedReceiveSet)+"}"),it=1):this.targetRateBaselineForDeltaCheckKbps=_.targetDownlinkBitrate,this.downlinkStats.packetsLost>this.prevDownlinkStats.packetsLost)return this.setProbeState("Not Probing"),this.lastUpgradeRateKbps=0,it;if(nt||it===1)switch(this.rateProbeState){case"Not Probing":this.setProbeState("Probe Pending");break;case"Probe Pending":this.setProbeState("Probing")&&(this.upgradeToStream($,tt),it=0);break}else this.setProbeState("Not Probing");return it}calculateSubscribeRate($){let _=0;for(const tt of $)!this.pausedStreamIds.contain(tt.streamId)&&!this.pausedBwAttendeeIds.has(tt.attendeeId)&&(_+=tt.maxBitrateKbps);return _}handleAppPausedStreams($,_){if(!this.tileController){this.logger.warn("tileController not found!");return}this.pausedStreamIds=new DefaultVideoStreamIdSet_1$2.default;const tt=this.tileController.getAllRemoteVideoTiles();for(const nt of tt){const it=nt.state();if(it.paused&&!this.pausedBwAttendeeIds.has(it.boundAttendeeId)){let rt=_.length;for(;rt--;)_[rt].attendeeId===it.boundAttendeeId&&(this.logger.info("bwe: removed paused attendee "+it.boundAttendeeId+" streamId: "+_[rt].streamId),this.pausedStreamIds.add(_[rt].streamId),this.subscribedReceiveSet.contain(_[rt].streamId)&&$.push(_[rt]),_.splice(rt,1))}}}processBwPausedStreams($,_){if(!this.tileController){this.logger.warn("tileController not found!");return}const tt=this.getCurrentVideoPreferences();if(tt&&this.shouldPauseTiles){const nt=this.tileController.getAllVideoTiles();for(const it of tt){const rt=this.getVideoTileForAttendeeId(it.attendeeId,nt),ot=(rt==null?void 0:rt.state().paused)||!1;if(_.some(lt=>lt.attendeeId===it.attendeeId))ot&&this.pausedBwAttendeeIds.has(it.attendeeId)&&(this.logger.info(`bwe: unpausing attendee ${it.attendeeId} due to bandwidth`),this.forEachObserver(lt=>{lt.tileWillBeUnpausedByDownlinkPolicy(rt.id())}),this.tileController.unpauseVideoTile(rt.id()),this.pausedBwAttendeeIds.delete(it.attendeeId));else{const lt=$.some(st=>st.attendeeId===it.attendeeId);if(rt&&lt){const st=this.optimalReceiveStreams.find(at=>at.attendeeId===it.attendeeId);st!==void 0&&(ot||(this.logger.info(`bwe: pausing streamId ${st.streamId} attendee ${it.attendeeId} due to bandwidth`),this.forEachObserver(at=>{at.tileWillBePausedByDownlinkPolicy(rt.id())}),this.tileController.pauseVideoTile(rt.id())),_.push(st)),this.pausedBwAttendeeIds.add(it.attendeeId)}else if(lt){const st=this.tileController.addVideoTile();st.bindVideoStream(it.attendeeId,!1,null,0,0,0,null),this.forEachObserver(at=>{at.tileWillBePausedByDownlinkPolicy(st.id())}),st.pause(),this.logger.info(`bwe: Created video tile ${st.id()} for bw paused attendee ${it.attendeeId}`),this.pausedBwAttendeeIds.add(it.attendeeId)}}}}}cleanBwPausedTiles($){if(!this.tileController){this.logger.warn("tileController not found!");return}const _=this.tileController.getAllRemoteVideoTiles(),tt=this.getCurrentVideoPreferences();for(const nt of _){const it=nt.state();it.boundVideoStream||($.some(rt=>rt.attendeeId===it.boundAttendeeId)?tt!==void 0&&!tt.some(rt=>rt.attendeeId===it.boundAttendeeId)&&this.tileController.removeVideoTile(it.tileId):(this.tileController.removeVideoTile(it.tileId),this.logger.info(`bwe: Removed video tile ${it.tileId} for bw paused attendee ${it.boundAttendeeId}`)))}}priorityPolicy($,_,tt){let nt;const it=this.getCurrentVideoPreferences(),rt=it.highestPriority();let ot,lt=rt;for(;lt!==-1;){ot=-1;for(const st of it)if(st.priority===lt)for(const at of _)at.attendeeId===st.attendeeId&&(tt.some(ct=>ct.groupId===at.groupId)||($.chosenTotalBitrate+at.avgBitrateKbps<=$.targetDownlinkBitrate?(tt.push(at),$.chosenTotalBitrate+=at.avgBitrateKbps):$.deltaToNextUpgrade===0&&($.deltaToNextUpgrade=at.avgBitrateKbps,nt=at)));else if(st.priority>lt){ot=st.priority;break}for(const st of it)if(st.priority===lt){for(const at of _)if(at.attendeeId===st.attendeeId){const ct=tt.findIndex(dt=>dt.groupId===at.groupId&&dt.maxBitrateKbps<=at.maxBitrateKbps&&dt.avgBitrateKbps<at.avgBitrateKbps);if(ct!==-1){const dt=at.avgBitrateKbps-tt[ct].avgBitrateKbps;this.hasSimulcastStreams(_,at.attendeeId,at.groupId)&&this.canUpgrade(at.avgBitrateKbps,st.targetSize,st.targetSizeToBitrateKbps(st.targetSize),at.attendeeId.endsWith(ContentShareConstants_1$2.default.Modality))?(this.logger.info(`bwe: attendee: ${at.attendeeId} group: ${at.groupId} has simulcast and can upgrade avgBitrate: ${at.avgBitrateKbps} target: ${st.targetSizeToBitrateKbps(st.targetSize)} targetTotalBitrate: ${$.targetDownlinkBitrate}`),$.chosenTotalBitrate+dt<=$.targetDownlinkBitrate?($.chosenTotalBitrate+=dt,tt[ct]=at):$.deltaToNextUpgrade===0&&($.deltaToNextUpgrade=dt,nt=at)):this.logger.info("bwe: cannot upgrade stream quality beyond target size")}}}else if(st.priority>lt)break;if(lt===rt&&$.deltaToNextUpgrade!==0)break;lt=ot}return nt}getVideoTileForAttendeeId($,_){for(const tt of _)if(tt.state().boundAttendeeId===$)return tt;return null}canUpgrade($,_,tt,nt){let it=!1;return(_===TargetDisplaySize_1.default.High||!nt&&$<=tt||nt&&_===TargetDisplaySize_1.default.Medium&&$<=tt)&&(it=!0),it?(this.logger.info(`bwe: canUpgrade: bitrateKbps: ${$} targetBitrateKbps: ${tt}`),!0):(this.logger.info(`bwe: cannot Upgrade: bitrateKbps: ${$} targetBitrateKbps: ${tt}`),!1)}hasSimulcastStreams($,_,tt){let nt=0;for(const it of $)it.attendeeId===_&&it.groupId===tt&&nt++;return this.logger.info(`bwe: attendeeId: ${_} groupId: ${tt} hasSimulcastStreams: streamCount: ${nt}`),nt>1}streamsWithPreferenceDidChange($){if(this.previousStreamsWithPreference===void 0||$.length!==this.previousStreamsWithPreference.length||this.videoPreferencesUpdated===!0)return!0;for(const _ of $)if(this.previousStreamsWithPreference.find(nt=>nt.groupId===_.groupId&&nt.streamId===_.streamId&&nt.maxBitrateKbps===_.maxBitrateKbps)===void 0)return!0;return!1}chosenStreamsSameAsLast($){if(this.optimalNonPausedReceiveStreams.length!==$.length)return!1;for(const _ of this.optimalNonPausedReceiveStreams)if(!$.some(tt=>tt.streamId===_.streamId))return!1;return!0}policyStateLogStr($,_){const tt=this.calculateSubscribeRate(this.optimalReceiveStreams),nt={targetBitrate:_,subscribedRate:tt,probeState:this.rateProbeState,startupPeriod:this.startupPeriod};let it="remoteInfos: [";for(const ot of $)it+=`{grpId:${ot.groupId} strId:${ot.streamId} maxBr:${ot.maxBitrateKbps} avgBr:${ot.avgBitrateKbps}}, `;it+="]";let rt=`bwe: optimalReceiveSet ${JSON.stringify(nt)}
bwe:   prev ${JSON.stringify(this.prevDownlinkStats)}
bwe:   now  ${JSON.stringify(this.downlinkStats)}
bwe:   ${it}
`;return(this.pausedStreamIds.size()>0||this.pausedBwAttendeeIds.size>0)&&(rt+=`bwe:   paused: app stream ids ${JSON.stringify(this.pausedStreamIds)}  bw attendees { ${Array.from(this.pausedBwAttendeeIds).join(" ")} }
`),this.videoPreferences?rt+=`bwe:   preferences: ${JSON.stringify(this.videoPreferences)}`:rt+=`bwe:   default preferences: ${JSON.stringify(this.defaultVideoPreferences)}`,rt}getCurrentVideoPreferences(){return this.videoPreferences||this.defaultVideoPreferences}getServerSideNetworkAdaption(){return this.serverSideNetworkAdaption}setServerSideNetworkAdaption($){this.serverSideNetworkAdaption=$,this.setProbeState("Not Probing")}supportedServerSideNetworkAdaptions(){return[ServerSideNetworkAdaption_1$1.default.None,ServerSideNetworkAdaption_1$1.default.BandwidthProbing,ServerSideNetworkAdaption_1$1.default.BandwidthProbingAndRemoteVideoQualityAdaption]}getVideoPreferences(){let $=this.getCurrentVideoPreferences();return $||($=VideoPreferences_1$1.VideoPreferences.prepare().build()),$}wantsAllTemporalLayersInIndex(){return!0}}VideoPriorityBasedPolicy$1.default=VideoPriorityBasedPolicy;VideoPriorityBasedPolicy.DEFAULT_BANDWIDTH_KBPS=2800;VideoPriorityBasedPolicy.STARTUP_PERIOD_MS=6e3;VideoPriorityBasedPolicy.LARGE_RATE_CHANGE_TRIGGER_PERCENT=20;VideoPriorityBasedPolicy.TARGET_RATE_CHANGE_TRIGGER_PERCENT=15;VideoPriorityBasedPolicy.LOW_BITRATE_THRESHOLD_KBPS=300;VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_PROBE_MS=5e3;VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_SUBSCRIBE_MS=2e3;VideoPriorityBasedPolicy.MAX_HOLD_BEFORE_PROBE_MS=3e4;VideoPriorityBasedPolicy.MAX_ALLOWED_PROBE_TIME_MS=6e4;VideoPriorityBasedPolicy.SPURIOUS_PACKET_LOST_THRESHOLD=2;VideoPriorityBasedPolicy.USED_BANDWIDTH_OVERRIDE_BUFFER_KBPS=100;var __importDefault$x=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(VideoAdaptiveProbePolicy$1,"__esModule",{value:!0});const ContentShareConstants_1$1=__importDefault$x(ContentShareConstants$1),ServerSideNetworkAdaption_1=__importDefault$x(ServerSideNetworkAdaption),VideoPreference_1=__importDefault$x(VideoPreference$1),VideoPreferences_1=VideoPreferences$1,VideoPriorityBasedPolicy_1=__importDefault$x(VideoPriorityBasedPolicy$1),VideoPriorityBasedPolicyConfig_1=__importDefault$x(VideoPriorityBasedPolicyConfig$1);class VideoAdaptiveProbePolicy extends VideoPriorityBasedPolicy_1.default{constructor($){super($,VideoAdaptiveProbePolicy.createConfig()),this.logger=$,super.shouldPauseTiles=!1,this.videoPreferences=void 0}static createConfig(){const $=new VideoPriorityBasedPolicyConfig_1.default;return $.serverSideNetworkAdaption=ServerSideNetworkAdaption_1.default.None,$}reset(){super.reset(),super.shouldPauseTiles=!1,this.videoPreferences=void 0}updateIndex($){super.updateIndex($);const _=VideoPreferences_1.VideoPreferences.prepare();let tt=!1;const nt=$.remoteStreamDescriptions();for(const it of nt)_.some(rt=>rt.attendeeId===it.attendeeId)||(it.attendeeId.endsWith(ContentShareConstants_1$1.default.Modality)?(_.add(new VideoPreference_1.default(it.attendeeId,1)),tt=!0):_.add(new VideoPreference_1.default(it.attendeeId,2)));tt?(this.videoPreferences=_.build(),this.videoPreferencesUpdated=!0):this.videoPreferences=void 0}chooseRemoteVideoSources($){this.logger.error("chooseRemoteVideoSources should not be called by VideoAdaptiveProbePolicy")}}VideoAdaptiveProbePolicy$1.default=VideoAdaptiveProbePolicy;var DefaultVideoStreamIndex$1={},VideoStreamDescription$1={};Object.defineProperty(VideoStreamDescription$1,"__esModule",{value:!0});const SignalingProtocol_js_1$2=SignalingProtocol;class VideoStreamDescription{constructor($,_,tt,nt,it){this.attendeeId="",this.groupId=0,this.streamId=0,this.ssrc=0,this.trackLabel="",this.maxBitrateKbps=0,this.avgBitrateKbps=0,this.maxFrameRate=0,this.width=0,this.height=0,this.timeEnabled=0,this.disabledByWebRTC=!1,this.disabledByUplinkPolicy=!1,this.rid="",this.attendeeId=$,this.groupId=_,this.streamId=tt,this.maxBitrateKbps=nt,this.avgBitrateKbps=it}clone(){const $=new VideoStreamDescription;return $.attendeeId=this.attendeeId,$.groupId=this.groupId,$.streamId=this.streamId,$.ssrc=this.ssrc,$.trackLabel=this.trackLabel,$.maxBitrateKbps=this.maxBitrateKbps,$.avgBitrateKbps=this.avgBitrateKbps,$.maxFrameRate=this.maxFrameRate,$.timeEnabled=this.timeEnabled,$.disabledByUplinkPolicy=this.disabledByUplinkPolicy,$.width=this.width,$.height=this.height,$}toStreamDescriptor(){const $=SignalingProtocol_js_1$2.SdkStreamDescriptor.create();return $.mediaType=SignalingProtocol_js_1$2.SdkStreamMediaType.VIDEO,$.trackLabel=this.trackLabel,$.attendeeId=this.attendeeId,$.streamId=this.streamId,$.groupId=this.groupId,$.framerate=this.maxFrameRate,$.maxBitrateKbps=this.disabledByUplinkPolicy?0:this.maxBitrateKbps,$.avgBitrateBps=this.avgBitrateKbps,$}totalPixels(){return this.width*this.height}}VideoStreamDescription$1.default=VideoStreamDescription;var __importDefault$w=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultVideoStreamIndex$1,"__esModule",{value:!0});const SignalingProtocol_js_1$1=SignalingProtocol,DefaultVideoStreamIdSet_1$1=__importDefault$w(DefaultVideoStreamIdSet$1),VideoStreamDescription_1$1=__importDefault$w(VideoStreamDescription$1);class DefaultVideoStreamIndex{constructor($){this.logger=$,this.currentIndex=null,this.indexForSubscribe=null,this.indexForLastRemoteVideoUpdate=null,this.currentSubscribeAck=null,this.subscribeTrackToStreamMap=null,this.subscribeStreamToAttendeeMap=null,this.subscribeStreamToExternalUserIdMap=null,this.subscribeSsrcToStreamMap=null,this.subscribeSsrcToGroupMap=null,this.streamToAttendeeMap=null,this.groupIdToAttendeeMap=null,this.streamToExternalUserIdMap=null,this.videoStreamDescription=new VideoStreamDescription_1$1.default,this.sendVideoStreamId=0,this.videoStreamDescription.trackLabel="AmazonChimeExpressVideo",this.videoStreamDescription.streamId=2,this.videoStreamDescription.groupId=2}localStreamDescriptions(){return[this.videoStreamDescription.clone()]}convertBpsToKbps($){return $>0&&$<1e3?1:Math.trunc($/1e3)}remoteStreamDescriptions(){if(!this.currentIndex||!this.currentIndex.sources)return[];const $=[];return this.currentIndex.sources.forEach(_=>{const tt=new VideoStreamDescription_1$1.default;tt.attendeeId=_.attendeeId,tt.groupId=_.groupId,tt.streamId=_.streamId,tt.maxBitrateKbps=_.maxBitrateKbps,tt.avgBitrateKbps=this.convertBpsToKbps(_.avgBitrateBps),tt.width=_.width,tt.height=_.height,tt.maxFrameRate=_.framerate,$.push(tt)}),$}integrateUplinkPolicyDecision($){if($&&$.length){const _=$[0];this.videoStreamDescription.maxBitrateKbps=_.maxBitrate/1e3,this.videoStreamDescription.maxFrameRate=_.maxFramerate}}integrateIndexFrame($){if(this.currentIndex=$,!$)return;const _=new Map;let tt=!1;for(const nt of $.sources){if(!_.has(nt.attendeeId)){_.set(nt.attendeeId,nt.groupId);continue}const it=_.get(nt.attendeeId);it<nt.groupId&&(this.logger.warn(`Old group ID ${it} found for attendee ID ${nt.attendeeId}, replacing with newer group ID ${nt.groupId}`),_.set(nt.attendeeId,nt.groupId)),tt=!0}tt&&(this.currentIndex.sources=this.currentIndex.sources.filter(nt=>_.get(nt.attendeeId)===nt.groupId)),this.streamToAttendeeMap=null,this.groupIdToAttendeeMap=null,this.streamToExternalUserIdMap=null}subscribeFrameSent(){this.indexForSubscribe=this.currentIndex}remoteVideoUpdateSent(){this.indexForLastRemoteVideoUpdate=this.currentIndex}integrateSubscribeAckFrame($){this.currentSubscribeAck=$,this.subscribeTrackToStreamMap=this.buildTrackToStreamMap(this.currentSubscribeAck),this.subscribeSsrcToStreamMap=this.buildSSRCToStreamMap(this.currentSubscribeAck),this.subscribeSsrcToGroupMap=this.buildSSRCToGroupMap(this.currentSubscribeAck),this.subscribeStreamToAttendeeMap=this.buildStreamToAttendeeMap(this.indexForSubscribe),this.subscribeStreamToExternalUserIdMap=this.buildStreamExternalUserIdMap(this.indexForSubscribe),this.sendVideoStreamId=0,$.allocations&&$.allocations!==void 0&&$.allocations.length>0&&(this.sendVideoStreamId=$.allocations[0].streamId)}integrateBitratesFrame($){if(this.currentIndex)for(const _ of $.bitrates){const tt=this.currentIndex.sources.find(nt=>nt.streamId===_.sourceStreamId);tt!==void 0&&(tt.avgBitrateBps=_.avgBitrateBps)}}allStreams(){const $=new DefaultVideoStreamIdSet_1$1.default;if(this.currentIndex)for(const _ of this.currentIndex.sources)$.add(_.streamId);return $}allVideoSendingSourcesExcludingSelf($){const _=[],tt=new Set;if(this.currentIndex&&this.currentIndex.sources&&this.currentIndex.sources.length)for(const nt of this.currentIndex.sources){const{attendeeId:it,externalUserId:rt,mediaType:ot}=nt;it!==$&&ot===SignalingProtocol_js_1$1.SdkStreamMediaType.VIDEO&&(tt.has(it)||(_.push({attendee:{attendeeId:it,externalUserId:rt}}),tt.add(it)))}return _}streamSelectionUnderBandwidthConstraint($,_,tt,nt){const it=new Set;if(this.currentIndex)for(const at of this.currentIndex.sources)at.attendeeId===$||at.mediaType!==SignalingProtocol_js_1$1.SdkStreamMediaType.VIDEO||!_.has(at.attendeeId)&&!tt.has(at.attendeeId)&&it.add(at.attendeeId);const rt=this.buildAttendeeToSortedStreamDescriptorMapExcludingSelf($),ot=new Map;let lt=0;rt.forEach((at,ct)=>{ot.set(ct,at[0]),lt+=at[0].maxBitrateKbps}),lt=this.trySelectHighBitrateForAttendees(rt,_,lt,nt,ot),this.trySelectHighBitrateForAttendees(rt,it,lt,nt,ot);const st=new DefaultVideoStreamIdSet_1$1.default;for(const at of ot.values())st.add(at.streamId);return st}highestQualityStreamFromEachGroupExcludingSelf($){const _=new DefaultVideoStreamIdSet_1$1.default;if(this.currentIndex){const tt=new Map;for(const nt of this.currentIndex.sources)nt.attendeeId===$||nt.mediaType!==SignalingProtocol_js_1$1.SdkStreamMediaType.VIDEO||(!tt.has(nt.groupId)||nt.maxBitrateKbps>tt.get(nt.groupId).maxBitrateKbps)&&tt.set(nt.groupId,nt);for(const nt of tt.values())_.add(nt.streamId)}return _}numberOfVideoPublishingParticipantsExcludingSelf($){return this.highestQualityStreamFromEachGroupExcludingSelf($).array().length}numberOfParticipants(){return this.currentIndex.numParticipants?this.currentIndex.numParticipants:-1}attendeeIdForTrack($){const _=this.streamIdForTrack($);if(_===void 0||!this.subscribeStreamToAttendeeMap)return this.logger.warn(`no attendee found for track ${$}`),"";const tt=this.subscribeStreamToAttendeeMap.get(_);return tt||(this.logger.info(`track ${$} (stream ${_}) does not correspond to a known attendee`),"")}externalUserIdForTrack($){const _=this.streamIdForTrack($);if(_===void 0||!this.subscribeStreamToExternalUserIdMap)return this.logger.warn(`no external user id found for track ${$}`),"";const tt=this.subscribeStreamToExternalUserIdMap.get(_);return tt||(this.logger.info(`track ${$} (stream ${_}) does not correspond to a known externalUserId`),"")}attendeeIdForStreamId($){if(!this.streamToAttendeeMap)if(this.currentIndex)this.streamToAttendeeMap=this.buildStreamToAttendeeMap(this.currentIndex);else return"";const _=this.streamToAttendeeMap.get($);return _||(this.logger.info(`stream ID ${$} does not correspond to a known attendee`),"")}attendeeIdForGroupId($){if(!this.groupIdToAttendeeMap)if(this.currentIndex)this.groupIdToAttendeeMap=this.buildGroupIdToAttendeeMap(this.currentIndex);else return"";const _=this.groupIdToAttendeeMap.get($);return _||(this.logger.info(`group ID ${$} does not correspond to a known attendee`),"")}groupIdForStreamId($){if(!(!this.currentIndex||!this.currentIndex.sources)){for(const _ of this.currentIndex.sources)if(_.streamId===$)return _.groupId;if(this.indexForSubscribe){for(const _ of this.indexForSubscribe.sources)if(_.streamId===$)return _.groupId}if(this.indexForLastRemoteVideoUpdate){for(const _ of this.indexForLastRemoteVideoUpdate.sources)if(_.streamId===$)return _.groupId}}}StreamIdsInSameGroup($,_){return this.groupIdForStreamId($)===this.groupIdForStreamId(_)}streamIdForTrack($){if(this.subscribeTrackToStreamMap)return this.subscribeTrackToStreamMap.get($)}streamIdForSSRC($){if(this.subscribeSsrcToStreamMap)return this.subscribeSsrcToStreamMap.get($)}overrideStreamIdMappings($,_){if(this.subscribeTrackToStreamMap){for(const[tt,nt]of this.subscribeTrackToStreamMap.entries())if($===nt){this.subscribeTrackToStreamMap.set(tt,_);break}}if(this.subscribeSsrcToStreamMap){for(const[tt,nt]of this.subscribeSsrcToStreamMap.entries())if($===nt){this.subscribeSsrcToStreamMap.set(tt,_);break}}}groupIdForSSRC($){if(this.subscribeSsrcToGroupMap)return this.subscribeSsrcToGroupMap.get($)}streamsPausedAtSource(){const $=new DefaultVideoStreamIdSet_1$1.default;if(this.currentIndex)for(const _ of this.currentIndex.pausedAtSourceIds)$.add(_);return $}sendVideoStreamIdFromRid($){return this.sendVideoStreamId}buildTrackToStreamMap($){const _=new Map;this.logger.debug(()=>`trackMap ${JSON.stringify($.tracks)}`);for(const tt of $.tracks)tt.trackLabel.length>0&&tt.streamId>0&&_.set(tt.trackLabel,tt.streamId);return _}buildSSRCToStreamMap($){const _=new Map;this.logger.debug(()=>`ssrcMap ${JSON.stringify($.tracks)}`);for(const tt of $.tracks)tt.trackLabel.length>0&&tt.streamId>0&&_.set(tt.ssrc,tt.streamId);return _}buildSSRCToGroupMap($){const _=new Map;for(const tt of $.tracks)tt.trackLabel.length>0&&tt.streamId>0&&_.set(tt.ssrc,this.groupIdForStreamId(tt.streamId));return _}buildStreamToAttendeeMap($){const _=new Map;if($)for(const tt of $.sources)_.set(tt.streamId,tt.attendeeId);return _}buildGroupIdToAttendeeMap($){const _=new Map;for(const tt of $.sources)_.set(tt.groupId,tt.attendeeId);return _}buildStreamExternalUserIdMap($){const _=new Map;if($)for(const tt of $.sources)tt.externalUserId&&_.set(tt.streamId,tt.externalUserId);return _}trySelectHighBitrateForAttendees($,_,tt,nt,it){for(const rt of _){if(tt>=nt)break;if($.has(rt)){const ot=$.get(rt);for(const lt of ot.reverse())if(tt-it.get(rt).maxBitrateKbps+lt.maxBitrateKbps<nt){tt=tt-it.get(rt).maxBitrateKbps+lt.maxBitrateKbps,it.set(rt,lt);break}}}return tt}buildAttendeeToSortedStreamDescriptorMapExcludingSelf($){const _=new Map;if(this.currentIndex)for(const tt of this.currentIndex.sources)tt.attendeeId===$||tt.mediaType!==SignalingProtocol_js_1$1.SdkStreamMediaType.VIDEO||(_.has(tt.attendeeId)?_.get(tt.attendeeId).push(tt):_.set(tt.attendeeId,[tt]));return _.forEach((tt,nt)=>{tt.sort((it,rt)=>it.maxBitrateKbps>rt.maxBitrateKbps?1:it.maxBitrateKbps<rt.maxBitrateKbps?-1:0)}),_}}DefaultVideoStreamIndex$1.default=DefaultVideoStreamIndex;var SimulcastVideoStreamIndex$1={},__importDefault$v=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(SimulcastVideoStreamIndex$1,"__esModule",{value:!0});const SignalingProtocol_js_1=SignalingProtocol,DefaultVideoStreamIndex_1=__importDefault$v(DefaultVideoStreamIndex$1),VideoStreamDescription_1=__importDefault$v(VideoStreamDescription$1);class SimulcastVideoStreamIndex extends DefaultVideoStreamIndex_1.default{constructor(){super(...arguments),this.streamIdToBitrateKbpsMap=new Map,this._localStreamInfos=[],this._sendRidToVideoStreamIdMap=new Map}localStreamDescriptions(){const $=[];return this._localStreamInfos.forEach(_=>{$.push(_.clone())}),$}integrateUplinkPolicyDecision($){let _=!0,tt=0;for(let nt=0;nt<$.length;nt++){const it=$[nt].maxBitrate/1e3,rt=$[nt].maxFramerate;if(!_||nt===this._localStreamInfos.length){_=!1;const ot=new VideoStreamDescription_1.default;ot.maxBitrateKbps=it,ot.maxFrameRate=rt,ot.disabledByUplinkPolicy=it===0,ot.rid=$[nt].rid,it!==0&&(ot.timeEnabled=Date.now()),this._localStreamInfos.push(ot),tt++;continue}this._localStreamInfos[tt].maxBitrateKbps===0&&it>0&&(this._localStreamInfos[tt].timeEnabled=Date.now()),this._localStreamInfos[tt].maxBitrateKbps=it,this._localStreamInfos[tt].maxFrameRate=rt,this._localStreamInfos[tt].disabledByUplinkPolicy=it===0,tt++}_&&this._localStreamInfos.splice(tt)}integrateBitratesFrame($){super.integrateBitratesFrame($);const _=new Set,tt=new Set(this.streamIdToBitrateKbpsMap.keys());for(const nt of $.bitrates)_.add(nt.sourceStreamId),this.streamIdToBitrateKbpsMap.set(nt.sourceStreamId,this.convertBpsToKbps(nt.avgBitrateBps));for(const nt of tt)_.has(nt)||(this.streamIdToBitrateKbpsMap.get(nt)===SimulcastVideoStreamIndex.UNSEEN_STREAM_BITRATE?this.streamIdToBitrateKbpsMap.set(nt,SimulcastVideoStreamIndex.RECENTLY_INACTIVE_STREAM_BITRATE):this.streamIdToBitrateKbpsMap.set(nt,SimulcastVideoStreamIndex.NOT_SENDING_STREAM_BITRATE));this.logLocalStreamDescriptions()}logLocalStreamDescriptions(){let $="";for(const _ of this._localStreamInfos)$+=`streamId=${_.streamId} maxBitrate=${_.maxBitrateKbps} disabledByUplink=${_.disabledByUplinkPolicy}
`;this.logger.debug(()=>$)}integrateIndexFrame($){super.integrateIndexFrame($);const _=new Set,tt=new Set(this.streamIdToBitrateKbpsMap.keys());for(const nt of this.currentIndex.sources)nt.mediaType===SignalingProtocol_js_1.SdkStreamMediaType.VIDEO&&(_.add(nt.streamId),this.streamIdToBitrateKbpsMap.has(nt.streamId)||this.streamIdToBitrateKbpsMap.set(nt.streamId,SimulcastVideoStreamIndex.UNSEEN_STREAM_BITRATE));for(const nt of tt)_.has(nt)||this.streamIdToBitrateKbpsMap.delete(nt)}integrateSubscribeAckFrame($){if(super.integrateSubscribeAckFrame($),!$.allocations||$.allocations===void 0)return;let _=0;this._sendRidToVideoStreamIdMap.clear();for(const tt of $.allocations){if(this._localStreamInfos.length<_+1){this.logger.info("simulcast: allocation has more than number of local streams");break}this._localStreamInfos[_].groupId=tt.groupId,this._localStreamInfos[_].streamId=tt.streamId,this.streamIdToBitrateKbpsMap.has(tt.streamId)||this.streamIdToBitrateKbpsMap.set(tt.streamId,SimulcastVideoStreamIndex.UNSEEN_STREAM_BITRATE),this._sendRidToVideoStreamIdMap.set(this._localStreamInfos[_].rid,tt.streamId),_++}}sendVideoStreamIdFromRid($){let _=0;return this._sendRidToVideoStreamIdMap.has($)&&(_=this._sendRidToVideoStreamIdMap.get($)),_}}SimulcastVideoStreamIndex$1.default=SimulcastVideoStreamIndex;SimulcastVideoStreamIndex.UNSEEN_STREAM_BITRATE=-2;SimulcastVideoStreamIndex.RECENTLY_INACTIVE_STREAM_BITRATE=-1;SimulcastVideoStreamIndex.NOT_SENDING_STREAM_BITRATE=0;SimulcastVideoStreamIndex.BitratesMsgFrequencyMs=4e3;var DefaultVideoTileController$1={},DefaultDevicePixelRatioMonitor$1={},__awaiter$n=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(DefaultDevicePixelRatioMonitor$1,"__esModule",{value:!0});class DefaultDevicePixelRatioMonitor{constructor($,_){if(this.devicePixelRatioSource=$,this.observerQueue=new Set,this.mediaQueryListener=()=>{this.observerQueue.forEach(nt=>{nt.devicePixelRatioChanged(this.devicePixelRatioSource.devicePixelRatio())})},typeof window>"u")return;const tt=matchMedia(`(resolution: ${this.devicePixelRatioSource.devicePixelRatio()}dppx)`);typeof tt.addEventListener=="function"?(tt.addEventListener("change",this.mediaQueryListener),this.mediaQueryList=tt):typeof tt.addListener=="function"?(tt.addListener(this.mediaQueryListener),this.mediaQueryList=tt):_.warn("ignoring DefaultDevicePixelRatioMonitor")}destroy(){return __awaiter$n(this,void 0,void 0,function*(){this.mediaQueryList&&(typeof this.mediaQueryList.addEventListener=="function"?this.mediaQueryList.removeEventListener("change",this.mediaQueryListener):this.mediaQueryList.removeListener(this.mediaQueryListener)),delete this.mediaQueryListener,this.observerQueue.clear()})}registerObserver($){this.observerQueue.add($),$.devicePixelRatioChanged(this.devicePixelRatioSource.devicePixelRatio())}removeObserver($){this.observerQueue.delete($)}}DefaultDevicePixelRatioMonitor$1.default=DefaultDevicePixelRatioMonitor;var DevicePixelRatioWindowSource$1={};Object.defineProperty(DevicePixelRatioWindowSource$1,"__esModule",{value:!0});class DevicePixelRatioWindowSource{devicePixelRatio(){return typeof window>"u"||!window||!window.devicePixelRatio?1:window.devicePixelRatio}}DevicePixelRatioWindowSource$1.default=DevicePixelRatioWindowSource;var DefaultVideoElementResolutionMonitor$1={};Object.defineProperty(DefaultVideoElementResolutionMonitor$1,"__esModule",{value:!0});class DefaultVideoElementResolutionMonitor{constructor(){this.observerQueue=new Set,this.element=null,this.resizeObserver=new ResizeObserver($=>{for(const _ of $){const{width:tt,height:nt}=_.contentRect;this.notifyObservers(tt,nt)}})}notifyObservers($,_){for(const tt of this.observerQueue)tt.videoElementResolutionChanged($,_)}registerObserver($){this.observerQueue.add($)}removeObserver($){this.observerQueue.delete($)}bindVideoElement($){this.element!==$&&(this.element&&this.resizeObserver.unobserve(this.element),this.element=$,this.element&&this.resizeObserver.observe(this.element))}}DefaultVideoElementResolutionMonitor$1.default=DefaultVideoElementResolutionMonitor;var __awaiter$m=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$u=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultVideoTileController$1,"__esModule",{value:!0});const VideoQualitySettings_1$4=__importDefault$u(VideoQualitySettings$1),DefaultDevicePixelRatioMonitor_1=__importDefault$u(DefaultDevicePixelRatioMonitor$1),DevicePixelRatioWindowSource_1=__importDefault$u(DevicePixelRatioWindowSource$1),Types_1$2=Types,DefaultVideoElementResolutionMonitor_1=__importDefault$u(DefaultVideoElementResolutionMonitor$1),DefaultVideoTile_1$1=__importDefault$u(DefaultVideoTile$1);class DefaultVideoTileController{constructor($,_,tt){this.tileFactory=$,this.audioVideoController=_,this.logger=tt,this.tileMap=new Map,this.nextTileId=1,this.currentLocalTile=null,this.currentPausedTilesByIds=new Set,this.resolutionObservers=new Set,this.keepLastFrameWhenPaused=!1,this.keepLastFrameWhenPaused=_.configuration.keepLastFrameWhenPaused}createDevicePixelRatioMonitorIfNeeded(){this.devicePixelRatioMonitor||(this.devicePixelRatioMonitor=new DefaultDevicePixelRatioMonitor_1.default(new DevicePixelRatioWindowSource_1.default,this.logger))}discardDevicePixelRatioMonitorIfNotNeeded(){return __awaiter$m(this,void 0,void 0,function*(){if(this.tileMap.size||!this.devicePixelRatioMonitor)return;const $=this.devicePixelRatioMonitor;return this.devicePixelRatioMonitor=void 0,$.destroy()})}bindVideoElement($,_){const tt=this.getVideoTile($);if(tt===null){this.logger.warn(`Ignoring video element binding for unknown tile id ${$}`);return}tt.bindVideoElement(_)}unbindVideoElement($,_=!0){const tt=this.getVideoTile($);if(tt===null){this.logger.warn(`Ignoring video element unbinding for unknown tile id ${$}`);return}this.logger.info("Unbinding the video element"),this.notifyRemoteObserversOfUnbound(tt.state().boundAttendeeId);const nt=tt.stateRef().boundVideoElement;tt.bindVideoElement(null),_&&(this.logger.info("Cleaning up the video element"),DefaultVideoTile_1$1.default.disconnectVideoStreamFromVideoElement(nt,!1))}startLocalVideoTile(){if(this.audioVideoController.configuration.meetingFeatures.videoMaxResolution===VideoQualitySettings_1$4.default.VideoDisabled)return this.logger.warn("Could not start camera video because max video resolution was set to None"),-1;const $=this.findOrCreateLocalVideoTile();return this.currentLocalTile.stateRef().localTileStarted=!0,this.audioVideoController.update({needsRenegotiation:!0}),$.id()}stopLocalVideoTile(){this.currentLocalTile&&(this.currentLocalTile.stateRef().localTileStarted=!1,this.currentLocalTile.bindVideoStream(this.audioVideoController.configuration.credentials.attendeeId,!0,null,null,null,null,this.audioVideoController.configuration.credentials.externalUserId),this.audioVideoController.update({needsRenegotiation:!0}))}hasStartedLocalVideoTile(){return!!(this.currentLocalTile&&this.currentLocalTile.stateRef().localTileStarted)}removeLocalVideoTile(){this.currentLocalTile&&this.removeVideoTile(this.currentLocalTile.id())}getLocalVideoTile(){return this.currentLocalTile}pauseVideoTile($){const _=this.getVideoTile($);_&&(this.currentPausedTilesByIds.has($)||(this.audioVideoController.pauseReceivingStream(_.stateRef().streamId),this.currentPausedTilesByIds.add($)),_.pause())}unpauseVideoTile($){const _=this.getVideoTile($);_&&(this.currentPausedTilesByIds.has($)&&(this.audioVideoController.resumeReceivingStream(_.stateRef().streamId),this.currentPausedTilesByIds.delete($)),_.unpause())}getVideoTile($){return this.tileMap.has($)?this.tileMap.get($):null}getVideoTileArea($){const _=$.state();let tt=0,nt=0;return _.boundVideoElement&&(tt=_.boundVideoElement.clientHeight*_.devicePixelRatio,nt=_.boundVideoElement.clientWidth*_.devicePixelRatio),tt*nt}getAllRemoteVideoTiles(){const $=new Array;return this.tileMap.forEach((_,tt)=>{(!this.currentLocalTile||tt!==this.currentLocalTile.id())&&$.push(_)}),$}getAllVideoTiles(){return Array.from(this.tileMap.values())}addVideoTile($=!1){const _=this.nextTileId;this.nextTileId+=1,this.createDevicePixelRatioMonitorIfNeeded();const tt=this.tileFactory.makeTile(_,$,this,this.devicePixelRatioMonitor,this.createResolutionMonitor(_));return this.tileMap.set(_,tt),tt}removeVideoTile($){if(!this.tileMap.has($))return;const _=this.tileMap.get($);this.currentLocalTile===_&&(this.currentLocalTile=null),_.destroy(),this.tileMap.delete($),this.audioVideoController.forEachObserver(tt=>{Types_1$2.Maybe.of(tt.videoTileWasRemoved).map(nt=>nt.bind(tt)($))}),this.discardDevicePixelRatioMonitorIfNotNeeded()}removeVideoTilesByAttendeeId($){const _=[];for(const tt of this.getAllVideoTiles()){const nt=tt.state();nt.boundAttendeeId===$&&(this.removeVideoTile(nt.tileId),_.push(nt.tileId))}return _}removeAllVideoTiles(){const $=Array.from(this.tileMap.keys());for(const _ of $)this.removeVideoTile(_)}sendTileStateUpdate($){this.audioVideoController.forEachObserver(_=>{Types_1$2.Maybe.of(_.videoTileDidUpdate).map(tt=>tt.bind(_)($))})}haveVideoTilesWithStreams(){for(const $ of this.getAllVideoTiles())if($.state().boundVideoStream)return!0;return!1}haveVideoTileForAttendeeId($){return!!this.getVideoTileForAttendeeId($)}getVideoTileForAttendeeId($){for(const _ of this.getAllVideoTiles())if(_.state().boundAttendeeId===$)return _}captureVideoTile($){const _=this.getVideoTile($);return _?_.capture():null}registerVideoTileResolutionObserver($){this.resolutionObservers.add($)}removeVideoTileResolutionObserver($){this.resolutionObservers.delete($)}notifyResolutionObserversOfChange($,_,tt){for(const nt of this.resolutionObservers)nt.videoTileResolutionDidChange($,_,tt)}notifyRemoteObserversOfUnbound($){for(const _ of this.resolutionObservers)_.videoTileUnbound($)}createResolutionMonitor($){const _=new class{constructor(nt,it){this.controller=nt,this.tileId=it}videoElementResolutionChanged(nt,it){const rt=this.controller.getVideoTile(this.tileId);if(rt){const ot=rt.state().boundAttendeeId;this.controller.notifyResolutionObserversOfChange(ot,nt,it)}}}(this,$),tt=new DefaultVideoElementResolutionMonitor_1.default;return tt.registerObserver(_),tt}findOrCreateLocalVideoTile(){return this.currentLocalTile?this.currentLocalTile:(this.currentLocalTile=this.addVideoTile(!0),this.currentLocalTile.bindVideoStream(this.audioVideoController.configuration.credentials.attendeeId,!0,null,null,null,null,this.audioVideoController.configuration.credentials.externalUserId),this.currentLocalTile)}}DefaultVideoTileController$1.default=DefaultVideoTileController;var DefaultVideoTileFactory$1={},__importDefault$t=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultVideoTileFactory$1,"__esModule",{value:!0});const DefaultVideoTile_1=__importDefault$t(DefaultVideoTile$1);class DefaultVideoTileFactory{makeTile($,_,tt,nt,it){return new DefaultVideoTile_1.default($,_,tt,nt,it)}}DefaultVideoTileFactory$1.default=DefaultVideoTileFactory;var DefaultSimulcastUplinkPolicy$1={},SimulcastLayers={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.SimulcastLayers=void 0;var $;(function(_){_[_.Low=0]="Low",_[_.LowAndMedium=1]="LowAndMedium",_[_.LowAndHigh=2]="LowAndHigh",_[_.Medium=3]="Medium",_[_.MediumAndHigh=4]="MediumAndHigh",_[_.High=5]="High"})($=et.SimulcastLayers||(et.SimulcastLayers={})),et.default=$})(SimulcastLayers);var __importDefault$s=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultSimulcastUplinkPolicy$1,"__esModule",{value:!0});const SimulcastLayers_1=__importDefault$s(SimulcastLayers),SimulcastTransceiverController_1=__importDefault$s(SimulcastTransceiverController$1),Types_1$1=Types,DefaultVideoCaptureAndEncodeParameter_1$2=__importDefault$s(DefaultVideoCaptureAndEncodeParameter$1),BitrateParameters_1=__importDefault$s(BitrateParameters$1);class DefaultSimulcastUplinkPolicy{constructor($,_){this.selfAttendeeId=$,this.logger=_,this.numSenders=0,this.shouldDisableSimulcast=!1,this.newQualityMap=new Map,this.currentQualityMap=new Map,this.newActiveStreams=1,this.videoIndex=null,this.observerQueue=new Set,this.hiTargetBitrateKbps=DefaultSimulcastUplinkPolicy.kHiTargetBitrateKbpsHd,this.midTargetBitrateKbps=DefaultSimulcastUplinkPolicy.kMidTargetBitrateKbpsHd,this.lowTargetBitrateKbps=DefaultSimulcastUplinkPolicy.kLowTargetBitrateKbpsHd,this.enableFhdVideo=!1,this.optimalParameters=new DefaultVideoCaptureAndEncodeParameter_1$2.default(0,0,0,0,!0),this.parametersInEffect=new DefaultVideoCaptureAndEncodeParameter_1$2.default(0,0,0,0,!0),this.currentQualityMap=this.fillEncodingParamWithBitrates([this.lowTargetBitrateKbps,0,this.hiTargetBitrateKbps]),this.newQualityMap=this.fillEncodingParamWithBitrates([this.lowTargetBitrateKbps,0,this.hiTargetBitrateKbps])}updateConnectionMetric($){}calculateEncodingParameters(){const $=[new BitrateParameters_1.default,new BitrateParameters_1.default,new BitrateParameters_1.default];this.shouldDisableSimulcast?(this.newActiveStreams=0,$[0].maxBitrateKbps=0,$[1].maxBitrateKbps=this.hiTargetBitrateKbps,$[2].maxBitrateKbps=0):this.numSenders<=4?(this.newActiveStreams=1,$[0].maxBitrateKbps=this.lowTargetBitrateKbps,$[1].maxBitrateKbps=0,$[2].maxBitrateKbps=this.hiTargetBitrateKbps):(this.newActiveStreams=2,$[0].maxBitrateKbps=this.lowTargetBitrateKbps*2/3,$[1].maxBitrateKbps=this.numSenders<=6?this.midTargetBitrateKbps:this.midTargetBitrateKbps*.6,$[2].maxBitrateKbps=0);const _=$.map((tt,nt,it)=>tt.maxBitrateKbps);return this.newQualityMap=this.fillEncodingParamWithBitrates(_),this.encodingParametersEqual()||this.logger.info(`simulcast: policy:calculateEncodingParameters numSources:${this.numSenders} shouldDisableSimulcast:${this.shouldDisableSimulcast} newQualityMap: ${this.getQualityMapString(this.newQualityMap)}`),this.newQualityMap}chooseMediaTrackConstraints(){}chooseEncodingParameters(){return this.currentQualityMap=this.newQualityMap,this.activeStreamsToPublish!==this.newActiveStreams&&(this.activeStreamsToPublish=this.newActiveStreams,this.publishEncodingSimulcastLayer()),this.currentQualityMap}updateIndex($){const _=$.numberOfVideoPublishingParticipantsExcludingSelf(this.selfAttendeeId)+1,tt=_!==this.numSenders,nt=$.numberOfParticipants(),it=nt>=0&&nt<=2,rt=this.shouldDisableSimulcast!==it;this.numSenders=_,this.shouldDisableSimulcast=it,this.optimalParameters=new DefaultVideoCaptureAndEncodeParameter_1$2.default(this.captureWidth(),this.captureHeight(),this.captureFrameRate(),this.maxBandwidthKbps(),!1),this.videoIndex=$,(tt||rt)&&(this.newQualityMap=this.calculateEncodingParameters())}wantsResubscribe(){return!this.encodingParametersEqual()}compareEncodingParameter($,_){return JSON.stringify($)===JSON.stringify(_)}encodingParametersEqual(){let $=!1;for(const _ of SimulcastTransceiverController_1.default.NAME_ARR_ASCENDING)if($=$||!this.compareEncodingParameter(this.newQualityMap.get(_),this.currentQualityMap.get(_)),$)break;return!$}chooseCaptureAndEncodeParameters(){return this.parametersInEffect=this.optimalParameters.clone(),this.parametersInEffect.clone()}captureWidth(){return this.enableFhdVideo?1920:1280}captureHeight(){return this.enableFhdVideo?1080:768}captureFrameRate(){return 15}maxBandwidthKbps(){return this.enableFhdVideo?2500:1400}setIdealMaxBandwidthKbps($){}setHasBandwidthPriority($){}setHighResolutionFeatureEnabled($){this.enableFhdVideo=$,this.hiTargetBitrateKbps=$?DefaultSimulcastUplinkPolicy.kHiTargetBitrateKbpsFhd:DefaultSimulcastUplinkPolicy.kHiTargetBitrateKbpsHd,this.midTargetBitrateKbps=$?DefaultSimulcastUplinkPolicy.kMidTargetBitrateKbpsFhd:DefaultSimulcastUplinkPolicy.kMidTargetBitrateKbpsHd,this.lowTargetBitrateKbps=$?DefaultSimulcastUplinkPolicy.kLowTargetBitrateKbpsFhd:DefaultSimulcastUplinkPolicy.kLowTargetBitrateKbpsHd}wantsVideoDependencyDescriptorRtpHeaderExtension(){return!0}fillEncodingParamWithBitrates($){const _=new Map,tt=1e3,nt=SimulcastTransceiverController_1.default.NAME_ARR_ASCENDING,it=$;let rt=this.shouldDisableSimulcast?1:4;for(let ot=0;ot<nt.length;ot++){const lt=nt[ot];_.set(lt,{rid:lt,active:it[ot]>0,scaleResolutionDownBy:Math.max(rt,1),maxBitrate:it[ot]*tt}),rt=rt/2}return _}getQualityMapString($){let _="";return this.videoIndex.localStreamDescriptions().length===3&&$.forEach(nt=>{_+=`{ rid: ${nt.rid} active:${nt.active} maxBitrate:${nt.maxBitrate}}`}),_}getEncodingSimulcastLayer($){switch($){case 0:return SimulcastLayers_1.default.High;case 1:return SimulcastLayers_1.default.LowAndHigh;case 2:return SimulcastLayers_1.default.LowAndMedium}}publishEncodingSimulcastLayer(){const $=this.getEncodingSimulcastLayer(this.activeStreamsToPublish);this.forEachObserver(_=>{Types_1$1.Maybe.of(_.encodingSimulcastLayersDidChange).map(tt=>tt.bind(_)($))})}addObserver($){this.logger.info("adding simulcast uplink observer"),this.observerQueue.add($)}removeObserver($){this.logger.info("removing simulcast uplink observer"),this.observerQueue.delete($)}forEachObserver($){for(const _ of this.observerQueue)$(_)}}DefaultSimulcastUplinkPolicy$1.default=DefaultSimulcastUplinkPolicy;DefaultSimulcastUplinkPolicy.kHiTargetBitrateKbpsHd=1200;DefaultSimulcastUplinkPolicy.kMidTargetBitrateKbpsHd=600;DefaultSimulcastUplinkPolicy.kLowTargetBitrateKbpsHd=300;DefaultSimulcastUplinkPolicy.kHiTargetBitrateKbpsFhd=2e3;DefaultSimulcastUplinkPolicy.kMidTargetBitrateKbpsFhd=1e3;DefaultSimulcastUplinkPolicy.kLowTargetBitrateKbpsFhd=500;var NScaleVideoUplinkBandwidthPolicy$1={},__awaiter$l=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$r=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(NScaleVideoUplinkBandwidthPolicy$1,"__esModule",{value:!0});const DefaultVideoCaptureAndEncodeParameter_1$1=__importDefault$r(DefaultVideoCaptureAndEncodeParameter$1);class NScaleVideoUplinkBandwidthPolicy{constructor($,_=!0,tt=void 0,nt=void 0){this.selfAttendeeId=$,this.scaleResolution=_,this.logger=tt,this.browserBehavior=nt,this.numberOfPublishedVideoSources=void 0,this.idealMaxBandwidthKbps=1500,this.hasBandwidthPriority=!1,this.encodingParamMap=new Map,this.enableHighResolutionFeature=!1,this.enableSVC=!1,this.isUsingSVCCodec=!0,this.numParticipants=0,this.reset()}reset(){this.numberOfPublishedVideoSources=void 0,this.optimalParameters=new DefaultVideoCaptureAndEncodeParameter_1$1.default(0,0,0,0,!1),this.parametersInEffect=new DefaultVideoCaptureAndEncodeParameter_1$1.default(0,0,0,0,!1),this.encodingParamMap.set(NScaleVideoUplinkBandwidthPolicy.encodingMapKey,{maxBitrate:0})}updateConnectionMetric($){}chooseMediaTrackConstraints(){return{}}chooseEncodingParameters(){return new Map}updateIndex($){var _;let tt=!0;this.transceiverController&&(tt=this.transceiverController.hasVideoInput());const nt=$.numberOfVideoPublishingParticipantsExcludingSelf(this.selfAttendeeId)+(tt?1:0),it=$.numberOfParticipants();if(this.numParticipants===it&&this.numberOfPublishedVideoSources===nt){(_=this.logger)===null||_===void 0||_.debug("Skipping update index; Number of participants has not changed");return}this.numberOfPublishedVideoSources=nt,this.numParticipants=it,this.updateOptimalParameters()}wantsResubscribe(){return!this.parametersInEffect.equal(this.optimalParameters)}chooseCaptureAndEncodeParameters(){return this.parametersInEffect=this.optimalParameters.clone(),this.parametersInEffect.clone()}updateOptimalParameters(){let $=1;if(this.transceiverController){const _=this.getStreamCaptureSetting();_&&($=this.calculateEncodingParameters(_).scaleResolutionDownBy)}this.optimalParameters=new DefaultVideoCaptureAndEncodeParameter_1$1.default(this.captureWidth(),this.captureHeight(),this.captureFrameRate(),this.maxBandwidthKbps(),!1,$,this.enableSVC&&this.numParticipants>2&&this.isUsingSVCCodec)}captureWidth(){let $=640;return this.getNumberOfPublishedVideoSources()>4&&($=320),$}captureHeight(){let $=384;return this.getNumberOfPublishedVideoSources()>4&&($=192),$}captureFrameRate(){return 15}maxBandwidthKbps(){if(this.hasBandwidthPriority)return Math.trunc(this.idealMaxBandwidthKbps);let $=0;return this.getNumberOfPublishedVideoSources()<=2?$=this.idealMaxBandwidthKbps:this.getNumberOfPublishedVideoSources()<=4?$=this.idealMaxBandwidthKbps*2/3:$=(544/11+14880/(11*this.getNumberOfPublishedVideoSources()))/600*this.idealMaxBandwidthKbps,Math.trunc($)}setIdealMaxBandwidthKbps($){this.idealMaxBandwidthKbps=$}setHasBandwidthPriority($){this.hasBandwidthPriority=$}setTransceiverController($){this.transceiverController=$}setSVCEnabled($){var _;this.enableSVC=$,(_=this.logger)===null||_===void 0||_.info(`setSVCEnabled, enable: ${$}}`)}setHighResolutionFeatureEnabled($){this.enableHighResolutionFeature=$}updateTransceiverController(){return __awaiter$l(this,void 0,void 0,function*(){const $=this.getStreamCaptureSetting();if(!$)return;const _=this.calculateEncodingParameters($);this.shouldUpdateEndcodingParameters(_)&&(this.encodingParamMap.set(NScaleVideoUplinkBandwidthPolicy.encodingMapKey,_),this.transceiverController.setEncodingParameters(this.encodingParamMap))})}shouldUpdateEndcodingParameters($){var _,tt;const nt=(tt=(_=this.transceiverController.localVideoTransceiver().sender.getParameters())===null||_===void 0?void 0:_.encodings)===null||tt===void 0?void 0:tt[0];return $.maxBitrate!==(nt==null?void 0:nt.maxBitrate)||$.scaleResolutionDownBy!==(nt==null?void 0:nt.scaleResolutionDownBy)||($==null?void 0:$.scalabilityMode)!==(nt==null?void 0:nt.scalabilityMode)}calculateEncodingParameters($){var _,tt,nt;const it=this.maxBandwidthKbps()*1e3;let rt=1,ot=720;if($.height!==void 0&&$.width!==void 0&&this.scaleResolution&&!this.hasBandwidthPriority&&this.getNumberOfPublishedVideoSources()>2&&(ot=NScaleVideoUplinkBandwidthPolicy.targetHeightArray[Math.min(this.getNumberOfPublishedVideoSources(),NScaleVideoUplinkBandwidthPolicy.targetHeightArray.length-1)][this.enableHighResolutionFeature?1:0],ot===480&&(!((_=this.browserBehavior)===null||_===void 0)&&_.disable480pResolutionScaleDown())&&(ot=360),rt=Math.max(Math.min($.height,$.width)/ot,1),(tt=this.logger)===null||tt===void 0||tt.info(`Resolution scale factor is ${rt} for capture resolution ${$.width}x${$.height}. New dimension is ${$.width/rt}x${$.height/rt}`)),this.enableSVC){let lt;return this.numParticipants>=0&&this.numParticipants<3||!this.isUsingSVCCodec?lt="L1T1":lt="L3T3",(nt=this.logger)===null||nt===void 0||nt.info(`calculateEncodingParameters: SVC: ${this.enableSVC}    participants: ${this.numParticipants}     publishers: ${this.getNumberOfPublishedVideoSources()}     bitrate: ${it}  targetHeight: ${ot}  scalabilityMode: ${lt}   isUsingSVCCodec: ${this.isUsingSVCCodec}`),{scaleResolutionDownBy:rt,maxBitrate:it,scalabilityMode:lt}}else return{scaleResolutionDownBy:rt,maxBitrate:it}}getStreamCaptureSetting(){var $,_,tt,nt;return(nt=(tt=(_=($=this.transceiverController)===null||$===void 0?void 0:$.localVideoTransceiver())===null||_===void 0?void 0:_.sender)===null||tt===void 0?void 0:tt.track)===null||nt===void 0?void 0:nt.getSettings()}getNumberOfPublishedVideoSources(){var $;return($=this.numberOfPublishedVideoSources)!==null&&$!==void 0?$:0}wantsVideoDependencyDescriptorRtpHeaderExtension(){return this.enableSVC}setMeetingSupportedVideoSendCodecs($,_){const tt=$??_,nt=tt.length>0&&NScaleVideoUplinkBandwidthPolicy.SVCCodecNames.includes(tt[0].codecName);nt!==this.isUsingSVCCodec&&(this.isUsingSVCCodec=nt,this.updateOptimalParameters())}}NScaleVideoUplinkBandwidthPolicy$1.default=NScaleVideoUplinkBandwidthPolicy;NScaleVideoUplinkBandwidthPolicy.encodingMapKey="video";NScaleVideoUplinkBandwidthPolicy.targetHeightArray=[[0,0],[0,0],[0,0],[540,720],[540,720],[480,540],[480,540],[480,540],[480,540],[360,480],[360,480],[360,480],[360,480],[270,360],[270,360],[270,360],[270,360],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270]];NScaleVideoUplinkBandwidthPolicy.SVCCodecNames=["VP9"];var DefaultVolumeIndicatorAdapter$1={};Object.defineProperty(DefaultVolumeIndicatorAdapter$1,"__esModule",{value:!0});class DefaultVolumeIndicatorAdapter{constructor($,_,tt,nt,it){this.logger=$,this.realtimeController=_,this.minVolumeDecibels=tt,this.maxVolumeDecibels=nt,this.selfAttendeeId=it,this.streamIdToAttendeeId={},this.streamIdToExternalUserId={},this.warnedAboutMissingStreamIdMapping={},this.attendeeIdToStreamId={},this.sessionReconnected=!1}onReconnect(){this.sessionReconnected=!0}sendRealtimeUpdatesForAudioStreamIdInfo($){let _=0;for(const tt of $.streams){const nt=!!tt.attendeeId,it=!!tt.externalUserId,rt=tt.hasOwnProperty("muted"),ot=!!tt.dropped;if(nt){this.attendeeIdToStreamId[tt.attendeeId]&&this.attendeeIdToStreamId[tt.attendeeId]<tt.audioStreamId&&delete this.attendeeIdToStreamId[tt.attendeeId],this.streamIdToAttendeeId[tt.audioStreamId]=tt.attendeeId;const lt=it?tt.externalUserId:tt.attendeeId;this.streamIdToExternalUserId[tt.audioStreamId]=lt,this.attendeeIdToStreamId[tt.attendeeId]=tt.audioStreamId,this.realtimeController.realtimeSetAttendeeIdPresence(tt.attendeeId,!0,lt,!1,{attendeeIndex:_++,attendeesInFrame:$.streams.length})}if(rt){const lt=this.streamIdToAttendeeId[tt.audioStreamId],st=this.streamIdToExternalUserId[tt.audioStreamId];this.realtimeController.realtimeUpdateVolumeIndicator(lt,null,tt.muted,null,st)}if(!nt&&!rt){const lt=this.streamIdToAttendeeId[tt.audioStreamId];if(lt){const st=this.streamIdToExternalUserId[tt.audioStreamId];delete this.streamIdToAttendeeId[tt.audioStreamId],delete this.streamIdToExternalUserId[tt.audioStreamId],delete this.warnedAboutMissingStreamIdMapping[tt.audioStreamId],this.attendeeIdToStreamId[lt]===tt.audioStreamId&&delete this.attendeeIdToStreamId[lt];let at=!1;for(const ct of Object.keys(this.streamIdToAttendeeId)){const dt=parseInt(ct);if(dt>tt.audioStreamId&&this.streamIdToAttendeeId[dt]===lt){at=!0;break}}at||this.realtimeController.realtimeSetAttendeeIdPresence(lt,!1,st,ot,{attendeeIndex:_++,attendeesInFrame:$.streams.length})}}}this.sessionReconnected&&(this.cleanUpState($),this.sessionReconnected=!1)}cleanUpState($){const _=Object.values(this.streamIdToAttendeeId),tt=$.streams.map(it=>it.attendeeId),nt=_.filter(it=>!tt.includes(it));for(const[it,rt]of nt.entries()){const ot=this.attendeeIdToStreamId[rt],lt=this.streamIdToExternalUserId[ot];if(delete this.streamIdToAttendeeId[ot],delete this.streamIdToExternalUserId[ot],delete this.warnedAboutMissingStreamIdMapping[ot],delete this.attendeeIdToStreamId[rt],rt===this.selfAttendeeId){this.logger.warn("the volume indicator adapter cleans up the current attendee (presence = false) after reconnection");continue}this.realtimeController.realtimeSetAttendeeIdPresence(rt,!1,lt,!1,{attendeeIndex:it,attendeesInFrame:rt.length})}}sendRealtimeUpdatesForAudioMetadata($){let _=null,tt=null;for(const nt of $.attendeeStates){const it=this.attendeeIdForStreamId(nt.audioStreamId);nt.hasOwnProperty("volume")&&(_===null&&(_={}),it!==null&&(_[it]=this.normalizedVolume(nt))),nt.hasOwnProperty("signalStrength")&&(tt===null&&(tt={}),it!==null&&(tt[it]=this.normalizedSignalStrength(nt)))}this.applyRealtimeUpdatesForAudioMetadata(_,tt)}normalizedVolume($){const tt=1-(-$.volume-this.maxVolumeDecibels)/(this.minVolumeDecibels-this.maxVolumeDecibels);return Math.min(Math.max(tt,0),1)}normalizedSignalStrength($){const _=$.signalStrength/DefaultVolumeIndicatorAdapter.MAX_SIGNAL_STRENGTH_LEVELS;return Math.min(Math.max(_,0),1)}applyRealtimeUpdatesForAudioMetadata($,_){for(const tt in this.streamIdToAttendeeId){const nt=this.streamIdToAttendeeId[tt],it=this.streamIdToExternalUserId[tt];let rt=null,ot=null;$!==null&&($.hasOwnProperty(nt)?rt=$[nt]:rt=DefaultVolumeIndicatorAdapter.IMPLICIT_VOLUME),_!==null&&(_.hasOwnProperty(nt)?ot=_[nt]:ot=DefaultVolumeIndicatorAdapter.IMPLICIT_SIGNAL_STRENGTH),(rt!==null||ot!==null)&&this.realtimeController.realtimeUpdateVolumeIndicator(nt,rt,null,ot,it)}}attendeeIdForStreamId($){if($===0)return null;const _=this.streamIdToAttendeeId[$];return _||(this.warnedAboutMissingStreamIdMapping[$]||(this.warnedAboutMissingStreamIdMapping[$]=!0,this.logger.warn(`volume indicator stream id ${$} seen before being defined`)),null)}}DefaultVolumeIndicatorAdapter$1.default=DefaultVolumeIndicatorAdapter;DefaultVolumeIndicatorAdapter.MAX_SIGNAL_STRENGTH_LEVELS=2;DefaultVolumeIndicatorAdapter.IMPLICIT_VOLUME=0;DefaultVolumeIndicatorAdapter.IMPLICIT_SIGNAL_STRENGTH=1;var hasRequiredDefaultAudioVideoController;function requireDefaultAudioVideoController(){if(hasRequiredDefaultAudioVideoController)return DefaultAudioVideoController;hasRequiredDefaultAudioVideoController=1;var et=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(Ft,Tt,xt,Lt){Lt===void 0&&(Lt=xt),Object.defineProperty(Ft,Lt,{enumerable:!0,get:function(){return Tt[xt]}})}:function(Ft,Tt,xt,Lt){Lt===void 0&&(Lt=xt),Ft[Lt]=Tt[xt]}),$=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(Ft,Tt){Object.defineProperty(Ft,"default",{enumerable:!0,value:Tt})}:function(Ft,Tt){Ft.default=Tt}),_=commonjsGlobal&&commonjsGlobal.__importStar||function(Ft){if(Ft&&Ft.__esModule)return Ft;var Tt={};if(Ft!=null)for(var xt in Ft)xt!=="default"&&Object.prototype.hasOwnProperty.call(Ft,xt)&&et(Tt,Ft,xt);return $(Tt,Ft),Tt},tt=commonjsGlobal&&commonjsGlobal.__awaiter||function(Ft,Tt,xt,Lt){function Xt(Ht){return Ht instanceof xt?Ht:new xt(function(zt){zt(Ht)})}return new(xt||(xt=Promise))(function(Ht,zt){function nn(un){try{pn(Lt.next(un))}catch(On){zt(On)}}function vn(un){try{pn(Lt.throw(un))}catch(On){zt(On)}}function pn(un){un.done?Ht(un.value):Xt(un.value).then(nn,vn)}pn((Lt=Lt.apply(Ft,Tt||[])).next())})},nt=commonjsGlobal&&commonjsGlobal.__importDefault||function(Ft){return Ft&&Ft.__esModule?Ft:{default:Ft}};Object.defineProperty(DefaultAudioVideoController,"__esModule",{value:!0});const it=nt(DefaultActiveSpeakerDetector$1),rt=nt(DefaultAudioMixController$1),ot=nt(AudioProfile$1),lt=nt(DefaultBrowserBehavior$1),st=nt(ConnectionHealthData$1),at=nt(SignalingAndMetricsConnectionMonitor$1),ct=nt(VideoQualitySettings$1),dt=nt(MeetingSessionStatus$1),ut=nt(MeetingSessionStatusCode),ft=nt(MeetingSessionVideoAvailability$1),pt=nt(DefaultModality$1),St=nt(DefaultPingPong$1),gt=nt(DefaultRealtimeController$1),yt=nt(AsyncScheduler$1),vt=nt(VideoCodecCapability$1),Ct=nt(DefaultSessionStateController$1),Et=nt(SessionStateControllerAction),Mt=nt(SessionStateControllerState),Rt=nt(SessionStateControllerTransitionResult),At=nt(DefaultSignalingClient$1),Dt=_(ServerSideNetworkAdaption),It=nt(SignalingClientEventType),Vt=nt(SignalingClientVideoSubscriptionConfiguration$1),jt=SignalingProtocol,qt=nt(StatsCollector$1),cn=nt(AttachMediaInputTask$1),dn=nt(CleanRestartedSessionTask$1),an=nt(CleanStoppedSessionTask$1),bn=nt(CreatePeerConnectionTask$1),Ut=nt(CreateSDPTask$1),Kt=nt(FinishGatheringICECandidatesTask$1),Gt=nt(JoinAndReceiveIndexTask$1),Wt=nt(LeaveAndReceiveLeaveAckTask$1),Jt=nt(ListenForVolumeIndicatorsTask$1),_n=nt(MonitorTask$1),mn=nt(OpenSignalingConnectionTask$1),hn=nt(ParallelGroupTask$1),gn=nt(requirePromoteToPrimaryMeetingTask()),yn=nt(ReceiveAudioInputTask$1),En=nt(ReceiveRemoteVideoPauseResumeTask),Mn=nt(ReceiveVideoInputTask$1),Rn=nt(ReceiveVideoStreamIndexTask$1),Pn=nt(SendAndReceiveDataMessagesTask$1),Sn=nt(SerialGroupTask$1),Dn=nt(SetLocalDescriptionTask$1),An=nt(SetRemoteDescriptionTask$1),In=nt(SubscribeAndReceiveSubscribeAckTask$1),Cn=nt(TimeoutTask$1),Fn=nt(WaitForAttendeePresenceTask$1),wt=nt(DefaultTransceiverController$1),mt=nt(SimulcastContentShareTransceiverController$1),ht=nt(SimulcastTransceiverController$1),bt=nt(VideoOnlyTransceiverController$1),kt=Types,Ot=nt(DefaultVideoCaptureAndEncodeParameter$1),Nt=nt(AllHighestVideoBandwidthPolicy$1),en=nt(VideoAdaptiveProbePolicy$1),rn=VideoPreferences$1,ln=nt(DefaultVideoStreamIdSet$1),Zt=nt(DefaultVideoStreamIndex$1),on=nt(SimulcastVideoStreamIndex$1),kn=nt(DefaultVideoTileController$1),Yt=nt(DefaultVideoTileFactory$1),tn=nt(DefaultSimulcastUplinkPolicy$1),Qt=nt(NScaleVideoUplinkBandwidthPolicy$1),$t=nt(DefaultVolumeIndicatorAdapter$1),Bt=nt(AudioVideoControllerState);let sn=class Wn{constructor(Tt,xt,Lt,Xt,Ht,zt){this._audioProfile=new ot.default,this.connectionHealthData=new st.default,this.observerQueue=new Set,this.meetingSessionContext=new Bt.default,this.enableSimulcast=!1,this.enableSVC=!1,this.useUpdateTransceiverControllerForUplink=!1,this.totalRetryCount=0,this.startAudioVideoTimestamp=0,this.mayNeedRenegotiationForSimulcastLayerChange=!1,this.promotedToPrimaryMeeting=!1,this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent=!1,this.receiveIndexTask=void 0,this.monitorTask=void 0,this.receiveRemotePauseResumeTask=void 0,this.destroyed=!1,this._logger=xt,this.sessionStateController=new Ct.default(this._logger),this._configuration=Tt,this._webSocketAdapter=Lt,this._realtimeController=new gt.default(Xt),this._realtimeController.realtimeSetLocalAttendeeId(Tt.credentials.attendeeId,Tt.credentials.externalUserId),this._mediaStreamBroker=Xt,this._reconnectController=Ht,this._videoTileController=new kn.default(new Yt.default,this,this._logger),this._audioMixController=new rt.default(this._logger),this._mediaStreamBroker.addMediaStreamBrokerObserver(this._audioMixController),this.meetingSessionContext.logger=this._logger,this._eventController=zt,this.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers||(new pt.default(this.configuration.credentials.attendeeId).hasModality(pt.default.MODALITY_CONTENT)&&new lt.default().hasChromiumWebRTC()?this.videoSendCodecPreferences=[vt.default.av1Main(),vt.default.vp9Profile0(),vt.default.h264ConstrainedBaselineProfile(),vt.default.vp8()]:this.videoSendCodecPreferences=[vt.default.vp9Profile0(),vt.default.h264ConstrainedBaselineProfile(),vt.default.vp8()])}destroy(){return tt(this,void 0,void 0,function*(){this.observerQueue.clear(),this._mediaStreamBroker.removeMediaStreamBrokerObserver(this._audioMixController),this.destroyed=!0})}get configuration(){return this._configuration}get realtimeController(){return this._realtimeController}get activeSpeakerDetector(){return this._activeSpeakerDetector||(this._activeSpeakerDetector=new it.default(this._realtimeController,this._configuration.credentials.attendeeId,this.handleHasBandwidthPriority.bind(this))),this._activeSpeakerDetector}get videoTileController(){return this._videoTileController}get audioMixController(){return this._audioMixController}get logger(){return this._logger}get rtcPeerConnection(){return this.meetingSessionContext&&this.meetingSessionContext.peer||null}get mediaStreamBroker(){return this._mediaStreamBroker}get eventController(){return this._eventController}getRTCPeerConnectionStats(Tt){return this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent||(this.logger.warn("The `getRTCPeerConnectionStats()` is on its way to be deprecated. It makes an additional call to the `getStats` API and therefore may cause slight performance degradation. Please use the new API `clientMetricReport.getRTCStatsReport()` returned by `metricsDidReceive(clientMetricReport)` callback instead."),this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent=!0),this.rtcPeerConnection?this.rtcPeerConnection.getStats(Tt):null}setAudioProfile(Tt){this._audioProfile=Tt}addObserver(Tt){this.logger.info("adding meeting observer"),this.observerQueue.add(Tt)}removeObserver(Tt){this.logger.info("removing meeting observer"),this.observerQueue.delete(Tt)}forEachObserver(Tt){for(const xt of this.observerQueue)yt.default.nextTick(()=>{this.observerQueue.has(xt)&&Tt(xt)})}initSignalingClient(){this.connectionHealthData.reset(),!this.meetingSessionContext.signalingClient&&(this.meetingSessionContext=new Bt.default,this.meetingSessionContext.logger=this.logger,this.meetingSessionContext.eventController=this.eventController,this.meetingSessionContext.browserBehavior=new lt.default,this.meetingSessionContext.videoSendCodecPreferences=this.videoSendCodecPreferences,this.meetingSessionContext.audioProfile=this._audioProfile,this.meetingSessionContext.meetingSessionConfiguration=this.configuration,this.meetingSessionContext.signalingClient=new At.default(this._webSocketAdapter,this.logger))}uninstallPreStartObserver(){this.meetingSessionContext.signalingClient.removeObserver(this.preStartObserver),this.preStartObserver=void 0}prestart(){return this.logger.info("Pre-connecting signaling connection."),this.createOrReuseSignalingTask().run().then(()=>{const Tt=()=>tt(this,void 0,void 0,function*(){this.logger.info("Early connection closed; discarding signaling task."),this.signalingTask=void 0,this.uninstallPreStartObserver()});this.preStartObserver={handleSignalingClientEvent(xt){xt.type===It.default.WebSocketClosed&&Tt()}},this.meetingSessionContext.signalingClient.registerObserver(this.preStartObserver)}).catch(Tt=>{this.logger.error(`Signaling task pre-start failed: ${Tt}`),this.signalingTask=void 0})}start(Tt){this.startReturningPromise(Tt).then(()=>{this.logger.info("start completed")}).catch(xt=>{this.logger.error(`start failed: ${xt}`)})}startReturningPromise(Tt){return(Tt==null?void 0:Tt.signalingOnly)===!0?this.prestart():(this.activeSpeakerDetector,new Promise((xt,Lt)=>{this.sessionStateController.perform(Et.default.Connect,()=>{this.actionConnect(!1).then(xt).catch(Lt)})}))}connectWithPromises(Tt){const xt=this.meetingSessionContext,Lt=($n,xn)=>new Cn.default(this.logger,xn,$n);this.monitorTask=new _n.default(xt,this.configuration.connectionHealthPolicyConfiguration,this.connectionHealthData);const Xt=this.monitorTask.once(),Ht=new yn.default(xt).once();this.receiveIndexTask=new Rn.default(xt),this.monitorTask.pauseResubscribeCheck(),this.receiveIndexTask.pauseIngestion();const zt=new Sn.default(this.logger,"Signaling",[this.createOrReuseSignalingTask(),new Jt.default(xt),new Pn.default(xt),new Gt.default(xt),this.receiveIndexTask]).once(),nn=new bn.default(xt).once(zt),vn=new cn.default(xt).once(nn,Ht),pn=new Ut.default(xt).once(vn),un=new Dn.default(xt).once(pn),On=new Kt.default(xt).once(un),fn=new In.default(xt).once(On);return this.receiveRemotePauseResumeTask=new En.default(xt),this.receiveRemotePauseResumeTask.once(fn),new Sn.default(this.logger,this.wrapTaskName("AudioVideoStart"),[Xt,Lt(this.configuration.connectionTimeoutMs,new Sn.default(this.logger,"Peer",[fn,this.receiveRemotePauseResumeTask,Tt?new Cn.default(this.logger,new hn.default(this.logger,"FinalizeConnection",[new Fn.default(xt),new An.default(xt)]),this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs):new An.default(xt)]))])}actionConnect(Tt){var xt;return tt(this,void 0,void 0,function*(){this.initSignalingClient(),this.uninstallPreStartObserver(),this.meetingSessionContext.mediaStreamBroker=this._mediaStreamBroker,this.meetingSessionContext.realtimeController=this._realtimeController,this.meetingSessionContext.audioMixController=this._audioMixController,this.meetingSessionContext.audioVideoController=this,this.enableSimulcast=this.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers&&new lt.default().hasChromiumWebRTC(),this.enableSimulcast&&this.configuration.enableSVC&&this.logger.warn("SVC cannot be enabled at the same time as simulcast. Disabling SVC, using simulcast."),this.enableSVC=!this.enableSimulcast&&this.configuration.enableSVC&&new lt.default().supportsScalableVideoCoding();const Lt=!!this.configuration.urls.audioHostURL;if(Lt?this.enableSimulcast?(this.logger.info("Using transceiver controller with simulcast support"),new pt.default(this.configuration.credentials.attendeeId).hasModality(pt.default.MODALITY_CONTENT)?this.meetingSessionContext.transceiverController=new mt.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext):this.meetingSessionContext.transceiverController=new ht.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext)):(this.logger.info("Using default transceiver controller"),this.meetingSessionContext.transceiverController=new wt.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext)):(this.logger.info("Using video only transceiver controller"),this.meetingSessionContext.transceiverController=new bt.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext)),this.meetingSessionContext.volumeIndicatorAdapter=new $t.default(this.logger,this._realtimeController,Wn.MIN_VOLUME_DECIBELS,Wn.MAX_VOLUME_DECIBELS,this.configuration.credentials.attendeeId),this.meetingSessionContext.videoTileController=this._videoTileController,this.meetingSessionContext.videoDownlinkBandwidthPolicy=this.configuration.videoDownlinkBandwidthPolicy,this.meetingSessionContext.videoUplinkBandwidthPolicy=this.configuration.videoUplinkBandwidthPolicy,this.meetingSessionContext.enableSimulcast=this.enableSimulcast,this.meetingSessionContext.enableSVC=this.enableSVC,this.enableSimulcast){let zt=this.meetingSessionContext.videoUplinkBandwidthPolicy;zt||(zt=new tn.default(this.configuration.credentials.attendeeId,this.meetingSessionContext.logger),this.meetingSessionContext.videoUplinkBandwidthPolicy=zt),zt.addObserver(this),this.meetingSessionContext.videoDownlinkBandwidthPolicy||(this.meetingSessionContext.videoDownlinkBandwidthPolicy=new en.default(this.meetingSessionContext.logger)),this.meetingSessionContext.videoStreamIndex=new on.default(this.logger)}else this.meetingSessionContext.enableSimulcast=!1,this.meetingSessionContext.videoStreamIndex=new Zt.default(this.logger),this.meetingSessionContext.videoUplinkBandwidthPolicy||(this.meetingSessionContext.videoUplinkBandwidthPolicy=new Qt.default(this.configuration.credentials.attendeeId,!this.meetingSessionContext.browserBehavior.disableResolutionScaleDown(),this.meetingSessionContext.logger,this.meetingSessionContext.browserBehavior),this.meetingSessionContext.videoUplinkBandwidthPolicy.setSVCEnabled(this.enableSVC)),this.meetingSessionContext.videoDownlinkBandwidthPolicy||(this.meetingSessionContext.videoDownlinkBandwidthPolicy=new Nt.default(this.configuration.credentials.attendeeId)),this.meetingSessionContext.videoUplinkBandwidthPolicy.setTransceiverController&&this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController&&(this.useUpdateTransceiverControllerForUplink=!0,this.meetingSessionContext.videoUplinkBandwidthPolicy.setTransceiverController(this.meetingSessionContext.transceiverController)),this.meetingSessionContext.audioProfile=this._audioProfile;if(new pt.default(this.configuration.credentials.attendeeId).hasModality(pt.default.MODALITY_CONTENT)){const zt=this.configuration.meetingFeatures.contentMaxResolution===ct.default.VideoResolutionUHD;zt&&this.setVideoMaxBandwidthKbps(2500),this.meetingSessionContext.videoUplinkBandwidthPolicy.setHighResolutionFeatureEnabled(zt)}else{const zt=this.configuration.meetingFeatures.videoMaxResolution===ct.default.VideoResolutionFHD;this.meetingSessionContext.videoUplinkBandwidthPolicy.setHighResolutionFeatureEnabled(zt)}this.meetingSessionContext.videoUplinkBandwidthPolicy&&this.maxUplinkBandwidthKbps&&this.meetingSessionContext.videoUplinkBandwidthPolicy.setIdealMaxBandwidthKbps(this.maxUplinkBandwidthKbps),this.meetingSessionContext.videoDownlinkBandwidthPolicy.bindToTileController&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.bindToTileController(this._videoTileController),this.meetingSessionContext.videoDownlinkBandwidthPolicy.setWantsResubscribeObserver&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.setWantsResubscribeObserver(()=>this.update({needsRenegotiation:!1})),this.meetingSessionContext.lastKnownVideoAvailability=new ft.default,this.meetingSessionContext.videoCaptureAndEncodeParameter=new Ot.default(0,0,0,0,!1),this.meetingSessionContext.videosToReceive=new ln.default,this.meetingSessionContext.videosPaused=new ln.default,this.meetingSessionContext.statsCollector=new qt.default(this,this.logger),this.meetingSessionContext.connectionMonitor=new at.default(this,this._realtimeController,this.connectionHealthData,new St.default(this.meetingSessionContext.signalingClient,Wn.PING_PONG_INTERVAL_MS,this.logger),this.meetingSessionContext.statsCollector),this.meetingSessionContext.reconnectController=this._reconnectController,this.meetingSessionContext.videoDeviceInformation={},this._videoTileController.registerVideoTileResolutionObserver(this.meetingSessionContext.statsCollector),Tt||(this.totalRetryCount=0,this._reconnectController.reset(),this.startAudioVideoTimestamp=Date.now(),this.forEachObserver(zt=>{kt.Maybe.of(zt.audioVideoDidStartConnecting).map(nn=>nn.bind(zt)(!1))}),(xt=this.eventController)===null||xt===void 0||xt.publishEvent("meetingStartRequested")),this.meetingSessionContext.startAudioVideoTimestamp=this.startAudioVideoTimestamp,this._reconnectController.hasStartedConnectionAttempt()?this._reconnectController.startedConnectionAttempt(!1):this._reconnectController.startedConnectionAttempt(!0);const Xt=Lt&&this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs>0;this.logger.info("Needs to wait for attendee presence? "+Xt);const Ht=this.connectWithPromises(Xt);try{yield Ht.run(),this.connectionHealthData.setConnectionStartTime();const zt=new pt.default(this.configuration.credentials.attendeeId).hasModality(pt.default.MODALITY_CONTENT);this.connectionHealthData.setIsContentShare(zt),this._mediaStreamBroker.addMediaStreamBrokerObserver(this),this.sessionStateController.perform(Et.default.FinishConnecting,()=>{this.eventController&&(this.meetingSessionContext.meetingStartDurationMs=Date.now()-this.startAudioVideoTimestamp,this.eventController.publishEvent("meetingStartSucceeded",{maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,poorConnectionCount:this.meetingSessionContext.poorConnectionCount,retryCount:this.totalRetryCount,signalingOpenDurationMs:this.meetingSessionContext.signalingOpenDurationMs,iceGatheringDurationMs:this.meetingSessionContext.iceGatheringDurationMs,meetingStartDurationMs:this.meetingSessionContext.meetingStartDurationMs})),this.meetingSessionContext.startTimeMs=Date.now(),this.actionFinishConnecting()})}catch(zt){this.signalingTask=void 0;const nn=new dt.default(this.getMeetingStatusCode(zt)||ut.default.TaskFailed);if(this.logger.info(`Start failed: ${nn} due to error ${zt}.`),this.sessionStateController.state()===Mt.default.NotConnected){this.logger.info("Start failed and not connected. Not cleaning up.");return}this.sessionStateController.perform(Et.default.Fail,()=>tt(this,void 0,void 0,function*(){yield this.actionDisconnect(nn,!0,zt),this.handleMeetingSessionStatus(nn,zt)||this.notifyStop(nn,zt)}))}})}createOrReuseSignalingTask(){return this.signalingTask||(this.initSignalingClient(),this.signalingTask=new Cn.default(this.logger,new mn.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs).once()),this.signalingTask}actionFinishConnecting(){this.signalingTask=void 0,this.meetingSessionContext.videoDuplexMode=jt.SdkStreamServiceType.RX,this.meetingSessionContext.enableSimulcast||(this.useUpdateTransceiverControllerForUplink?this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController():this.enforceBandwidthLimitationForSender(this.meetingSessionContext.videoCaptureAndEncodeParameter.encodeBitrates()[0])),this.meetingSessionContext.isSessionConnected=!0,this.forEachObserver(Tt=>{kt.Maybe.of(Tt.audioVideoDidStart).map(xt=>xt.bind(Tt)())}),this._reconnectController.reset(),this.receiveIndexTask.resumeIngestion(),this.monitorTask.resumeResubscribeCheck()}stopReturningPromise(){var Tt;return this._reconnectController.disableReconnect(),this.sessionStateController.state()===Mt.default.NotConnected?((Tt=this.meetingSessionContext.signalingClient)===null||Tt===void 0||Tt.closeConnection(),this.cleanUpMediaStreamsAfterStop(),Promise.resolve()):new Promise((xt,Lt)=>{this.sessionStateController.perform(Et.default.Disconnect,()=>{this.logger.info("attendee left meeting, session will not be reconnected"),this.actionDisconnect(new dt.default(ut.default.Left),!1,null).then(xt).catch(Lt)})})}stop(){this.stopReturningPromise()}actionDisconnect(Tt,xt,Lt){return tt(this,void 0,void 0,function*(){try{yield new Sn.default(this.logger,this.wrapTaskName("AudioVideoStop"),[new Cn.default(this.logger,new Wt.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs)]).run()}catch{this.logger.info("fail to stop")}try{const Xt=[new Cn.default(this.logger,new an.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs)];this.cleanUpMediaStreamsAfterStop(),yield new Sn.default(this.logger,this.wrapTaskName("AudioVideoClean"),Xt).run()}catch{this.logger.info("fail to clean")}this.sessionStateController.perform(Et.default.FinishDisconnecting,()=>{xt||this.notifyStop(Tt,Lt)}),this._videoTileController.removeVideoTileResolutionObserver(this.meetingSessionContext.statsCollector)})}update(Tt={needsRenegotiation:!0}){let xt=Tt.needsRenegotiation;if(xt||(xt=this.meetingSessionContext.peer===void 0),xt||(xt=!this.updateRemoteVideosFromPolicy()),xt||(xt=!this.updateLocalVideoFromPolicy()),this.meetingSessionContext.lastVideosToReceive=this.meetingSessionContext.videosToReceive,!xt)return this.logger.info("Update request does not require resubscribe"),this.actionFinishUpdating(),!0;this.logger.info("Update request requires resubscribe"),this.updateNumberOfPublishedVideoSources();const Lt=this.sessionStateController.perform(Et.default.Update,()=>{this.actionUpdateWithRenegotiation(!0)});return Lt===Rt.default.Transitioned||Lt===Rt.default.DeferredTransition}updateNumberOfPublishedVideoSources(){const Tt=this.configuration.credentials.attendeeId,xt=this._videoTileController.hasStartedLocalVideoTile();if(this.meetingSessionContext.videoStreamIndex!==null){const Lt=this.meetingSessionContext.videoStreamIndex.numberOfVideoPublishingParticipantsExcludingSelf(Tt)+(xt?1:0);this.connectionHealthData.setNumberOfPublishedVideoSources(Lt)}}updateRemoteVideosFromPolicy(){if(this.meetingSessionContext.videoDownlinkBandwidthPolicy&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.getVideoPreferences!==void 0&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption!==void 0&&!Dt.serverSideNetworkAdaptionIsNoneOrDefault(this.meetingSessionContext.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption())){if(!this.sendRemoteVideoUpdate())return!1;if(this.meetingSessionContext.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption()===Dt.default.BandwidthProbingAndRemoteVideoQualityAdaption)return this.isNotAddingOrRemovingStreams()}return this.updateRemoteVideosIfNotAddingOrRemovingStreams()}updateRemoteVideosIfNotAddingOrRemovingStreams(){const Tt=this.detectChangesInVideosToReceive();if(Tt===void 0)return!1;const xt=Tt.added,Lt=Tt.simulcastStreamUpdates,Xt=Tt.removed,Ht=this.meetingSessionContext,zt=[];for(const[nn,vn]of Lt.entries()){const pn=new Vt.default;if(pn.streamId=vn,pn.attendeeId=Ht.videoStreamIndex.attendeeIdForStreamId(vn),pn.mid=Ht.transceiverController.getMidForStreamId(nn),pn.mid===void 0)return this.logger.info(`No MID found for stream ID ${nn}, cannot update stream without renegotiation`),!1;if(zt.push(pn),Ht.transceiverController.setStreamIdForMid(pn.mid,vn),Ht.videoStreamIndex.overrideStreamIdMappings(nn,vn),Ht.videoTileController.haveVideoTileForAttendeeId(pn.attendeeId)){const un=Ht.videoTileController.getVideoTileForAttendeeId(pn.attendeeId);if(!un.setStreamId)return!1;un.setStreamId(vn)}}return zt.length!==0&&Ht.signalingClient.remoteVideoUpdate(zt,[]),xt.length!==0||Xt.length!==0?!1:(Ht.videoStreamIndex.remoteVideoUpdateSent(),!0)}detectChangesInVideosToReceive(){const Tt=this.meetingSessionContext;if(Tt.videosToReceive===null||!Tt.transceiverController||!Tt.transceiverController.getMidForStreamId||!Tt.transceiverController.setStreamIdForMid||!Tt.videosToReceive.forEach||!Tt.signalingClient.remoteVideoUpdate||!Tt.videoStreamIndex.overrideStreamIdMappings)return;let xt=[];const Lt=new Map;let Xt=[];if(Tt.lastVideosToReceive===null)xt=Tt.videosToReceive.array();else{const Ht=Tt.videoStreamIndex;Tt.videosToReceive.forEach(zt=>{if(Tt.lastVideosToReceive.contain(zt))return;let nn=!1;Tt.lastVideosToReceive.forEach(vn=>{nn||Ht.StreamIdsInSameGroup(vn,zt)&&(Lt.set(vn,zt),nn=!0)}),nn||xt.push(zt)}),Xt=Tt.lastVideosToReceive.array().filter(zt=>{const nn=Tt.videosToReceive.contain(zt),vn=Lt.has(zt);return!nn&&!vn})}return this.logger.info(`Request to update remote videos with added: [${xt}], updated: [${Array.from(Lt.entries()).map(([Ht,zt])=>`${Ht}->${zt}`).join(",")}], removed: [${Xt}]`),{added:xt,removed:Xt,simulcastStreamUpdates:Lt}}isNotAddingOrRemovingStreams(){const Tt=this.detectChangesInVideosToReceive();if(Tt===void 0)return!1;const xt=Tt.added,Lt=Tt.removed;return xt.length!==0||Lt.length!==0?!1:(this.meetingSessionContext.videoStreamIndex.remoteVideoUpdateSent(),!0)}sendRemoteVideoUpdate(){const Tt=this.meetingSessionContext;if(Tt.videosToReceive===null)return!1;const xt=Tt.videosToReceive.array().map(nn=>Tt.videoStreamIndex.groupIdForStreamId(nn));this.receiveRemotePauseResumeTask.updateSubscribedGroupdIds(new Set(xt));const Lt=rn.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration(Tt,xt,Tt.videoDownlinkBandwidthPolicy.getVideoPreferences()),Xt=new Map,Ht=[];for(const nn of Lt){let vn=!1;if(!Tt.lastVideoSubscriptionConfiguration.has(nn.groupId))vn=!0;else{const pn=Tt.lastVideoSubscriptionConfiguration.get(nn.groupId);nn.equals(pn)||(this.logger.debug(`${JSON.stringify(nn)} does not equal ${JSON.stringify(pn)}, sending update`),vn=!0)}Xt.set(nn.groupId,nn),vn&&Ht.push(nn)}Tt.lastVideoSubscriptionConfiguration=Xt;const zt=[];if(Tt.lastVideosToReceive!==null){const nn=new Set(xt);for(const vn of Tt.lastVideosToReceive.array()){const pn=Tt.videoStreamIndex.groupIdForStreamId(vn);if(!nn.has(pn)){const un=Tt.transceiverController.getMidForGroupId(pn);if(un===void 0){Tt.logger.warn(`Could not find MID for group ID to remove: ${pn}`);continue}zt.push(un)}}}return(Ht.length!==0||zt.length!==0)&&Tt.signalingClient.remoteVideoUpdate(Ht,zt),!0}updateLocalVideoFromPolicy(){if(this.meetingSessionContext.enableSimulcast){const Tt=this.meetingSessionContext.videoUplinkBandwidthPolicy.chooseEncodingParameters();if(this.mayNeedRenegotiationForSimulcastLayerChange&&this.meetingSessionContext.transceiverController.hasVideoInput()&&!this.negotiatedBitrateLayersAllocationRtpHeaderExtension())return this.logger.info("Needs regenotiation for local video simulcast layer change"),this.mayNeedRenegotiationForSimulcastLayerChange=!1,!1;this.meetingSessionContext.transceiverController.setEncodingParameters(Tt)}else this.meetingSessionContext.videoCaptureAndEncodeParameter=this.meetingSessionContext.videoUplinkBandwidthPolicy.chooseCaptureAndEncodeParameters();return this.logger.info("Updated local video from policy without renegotiation"),!0}negotiatedBitrateLayersAllocationRtpHeaderExtension(){if(!this.meetingSessionContext.transceiverController.localVideoTransceiver())return!1;const Tt=this.meetingSessionContext.transceiverController.localVideoTransceiver().sender.getParameters();return!Tt||!Tt.headerExtensions?!1:Tt.headerExtensions.some(xt=>xt.uri==="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00")}restartLocalVideo(Tt){const xt=()=>tt(this,void 0,void 0,function*(){this._videoTileController.hasStartedLocalVideoTile()&&(this.logger.info("stopping local video tile prior to local video restart"),this._videoTileController.stopLocalVideoTile(),this.logger.info("preparing local video restart update"),yield this.actionUpdateWithRenegotiation(!1),this.logger.info("starting local video tile for local video restart"),this._videoTileController.startLocalVideoTile()),this.logger.info("finalizing local video restart update"),yield this.actionUpdateWithRenegotiation(!0),Tt()}),Lt=this.sessionStateController.perform(Et.default.Update,()=>{xt()});return Lt===Rt.default.Transitioned||Lt===Rt.default.DeferredTransition}replaceLocalVideo(Tt){return tt(this,void 0,void 0,function*(){if(!Tt||Tt.getVideoTracks().length<1)throw new Error("could not acquire video track");if(!this.meetingSessionContext||!this.meetingSessionContext.peer)throw new Error("no active meeting and peer connection");const xt=this.meetingSessionContext.videoTileController.getLocalVideoTile();if(xt){const Lt=xt.state(),Xt=Tt.getVideoTracks()[0].getSettings();xt.bindVideoStream(Lt.boundAttendeeId,!0,Tt,Xt.width,Xt.height,Lt.streamId,Lt.boundExternalUserId)}yield this.meetingSessionContext.transceiverController.setVideoInput(Tt.getVideoTracks()[0]),this.meetingSessionContext.activeVideoInput=Tt,this.logger.info("Local video input is updated")})}replaceLocalAudio(Tt){return tt(this,void 0,void 0,function*(){if(!Tt||Tt.getAudioTracks().length<1)throw new Error("could not acquire audio track");if(!this.meetingSessionContext||!this.meetingSessionContext.peer)throw new Error("no active meeting and peer connection");if(this.connectionHealthData.reset(),this.connectionHealthData.setConnectionStartTime(),!(yield this.meetingSessionContext.transceiverController.replaceAudioTrack(Tt.getAudioTracks()[0])))throw new Error("Failed to replace audio track");this.meetingSessionContext.activeAudioInput=Tt,this.logger.info("Local audio input is updated")})}actionUpdateWithRenegotiation(Tt){return tt(this,void 0,void 0,function*(){this.monitorTask.pauseResubscribeCheck(),this.receiveIndexTask.pauseIngestion();try{yield new Sn.default(this.logger,this.wrapTaskName("AudioVideoUpdate"),[new Mn.default(this.meetingSessionContext),new Cn.default(this.logger,new Sn.default(this.logger,"UpdateSession",[new cn.default(this.meetingSessionContext),new Ut.default(this.meetingSessionContext),new Dn.default(this.meetingSessionContext),new Kt.default(this.meetingSessionContext),new In.default(this.meetingSessionContext),new An.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs)]).run(),Tt&&this.sessionStateController.perform(Et.default.FinishUpdating,()=>{this.actionFinishUpdating()})}catch(xt){this.sessionStateController.perform(Et.default.FinishUpdating,()=>{const Lt=new dt.default(this.getMeetingStatusCode(xt)||ut.default.TaskFailed);Lt.statusCode()!==ut.default.IncompatibleSDP&&this.logger.info("failed to update audio-video session"),this.handleMeetingSessionStatus(Lt,xt)})}})}notifyStop(Tt,xt){var Lt;if(this.forEachObserver(Xt=>{kt.Maybe.of(Xt.audioVideoDidStop).map(Ht=>Ht.bind(Xt)(Tt))}),this.eventController){const{signalingOpenDurationMs:Xt,poorConnectionCount:Ht,startTimeMs:zt,iceGatheringDurationMs:nn,attendeePresenceDurationMs:vn,meetingStartDurationMs:pn}=this.meetingSessionContext,un={maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,meetingDurationMs:zt===null?0:Math.round(Date.now()-zt),meetingStatus:ut.default[Tt.statusCode()],signalingOpenDurationMs:Xt,iceGatheringDurationMs:nn,attendeePresenceDurationMs:vn,poorConnectionCount:Ht,meetingStartDurationMs:pn,retryCount:this.totalRetryCount},On=xt&&xt.message||((Lt=Tt.toString)===null||Lt===void 0?void 0:Lt.call(Tt))||"";un.meetingDurationMs===0?(un.meetingErrorMessage=On,delete un.meetingDurationMs,delete un.attendeePresenceDurationMs,delete un.meetingStartDurationMs,this.eventController.publishEvent("meetingStartFailed",un)):Tt.isFailure()||Tt.isAudioConnectionFailure()?(un.meetingErrorMessage=On,this.eventController.publishEvent("meetingFailed",un)):this.eventController.publishEvent("meetingEnded",un)}}actionFinishUpdating(){if(!this.meetingSessionContext.enableSimulcast)if(this.useUpdateTransceiverControllerForUplink)this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController();else{const Tt=this.meetingSessionContext.videoCaptureAndEncodeParameter.encodeBitrates()[0];this.enforceBandwidthLimitationForSender(Tt)}this.monitorTask.resumeResubscribeCheck(),this.receiveIndexTask.resumeIngestion(),this.logger.info("updated audio-video session")}reconnect(Tt,xt){this.promotedToPrimaryMeeting&&(this.promotedToPrimaryMeeting=!1,this.forEachObserver(Xt=>{kt.Maybe.of(Xt.audioVideoWasDemotedFromPrimaryMeeting).map(Ht=>Ht.bind(Xt)(new dt.default(ut.default.AudioVideoDisconnectedWhilePromoted)))}));const Lt=this._reconnectController.retryWithBackoff(()=>tt(this,void 0,void 0,function*(){this.sessionStateController.state()===Mt.default.NotConnected?this.sessionStateController.perform(Et.default.Connect,()=>{this.actionConnect(!0)}):this.sessionStateController.perform(Et.default.Reconnect,()=>{this.actionReconnect(Tt)}),this.totalRetryCount+=1}),()=>{this.logger.info("canceled retry")});return Lt||this.sessionStateController.perform(Et.default.Fail,()=>{this.actionDisconnect(Tt,!1,xt)}),Lt}actionReconnect(Tt){return tt(this,void 0,void 0,function*(){this._reconnectController.hasStartedConnectionAttempt()||(this._reconnectController.startedConnectionAttempt(!1),this.forEachObserver(xt=>{kt.Maybe.of(xt.audioVideoDidStartConnecting).map(Lt=>Lt.bind(xt)(!0))})),this.meetingSessionContext.volumeIndicatorAdapter.onReconnect(),this.connectionHealthData.reset(),this.receiveRemotePauseResumeTask=new En.default(this.meetingSessionContext);try{yield new Sn.default(this.logger,this.wrapTaskName("AudioVideoReconnect"),[new Cn.default(this.logger,new Sn.default(this.logger,"Media",[new dn.default(this.meetingSessionContext),new Sn.default(this.logger,"Signaling",[new mn.default(this.meetingSessionContext),new Gt.default(this.meetingSessionContext)]),new bn.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs),new Mn.default(this.meetingSessionContext),new Cn.default(this.logger,new Sn.default(this.logger,"UpdateSession",[new cn.default(this.meetingSessionContext),new Ut.default(this.meetingSessionContext),new Dn.default(this.meetingSessionContext),new Kt.default(this.meetingSessionContext),new In.default(this.meetingSessionContext),new An.default(this.meetingSessionContext),this.receiveRemotePauseResumeTask]),this.configuration.connectionTimeoutMs)]).run(),this.sessionStateController.perform(Et.default.FinishConnecting,()=>{if(this.eventController){const{signalingOpenDurationMs:xt,poorConnectionCount:Lt,startTimeMs:Xt,iceGatheringDurationMs:Ht,attendeePresenceDurationMs:zt,meetingStartDurationMs:nn}=this.meetingSessionContext,vn={maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,meetingDurationMs:Math.round(Date.now()-Xt),meetingStatus:ut.default[Tt.statusCode()],signalingOpenDurationMs:xt,iceGatheringDurationMs:Ht,attendeePresenceDurationMs:zt,poorConnectionCount:Lt,meetingStartDurationMs:nn,retryCount:this.totalRetryCount};this.eventController.publishEvent("meetingReconnected",vn)}this.actionFinishConnecting()})}catch(xt){this.sessionStateController.perform(Et.default.FinishConnecting,()=>{this.logger.info("failed to reconnect audio-video session");const Lt=new dt.default(this.getMeetingStatusCode(xt)||ut.default.TaskFailed);this.handleMeetingSessionStatus(Lt,xt)})}this.connectionHealthData.setConnectionStartTime()})}wrapTaskName(Tt){return`${Tt}/${this.configuration.meetingId}/${this.configuration.credentials.attendeeId}`}cleanUpMediaStreamsAfterStop(){this._mediaStreamBroker.removeMediaStreamBrokerObserver(this),this.meetingSessionContext.activeAudioInput=void 0,this.meetingSessionContext.activeVideoInput=void 0}getMeetingStatusCode(Tt){const xt=/the meeting status code: (\d+)/.exec(Tt&&Tt.message);return xt&&xt.length>1?Number.parseInt(xt[1],10):null}enforceBandwidthLimitationForSender(Tt){return tt(this,void 0,void 0,function*(){yield this.meetingSessionContext.transceiverController.setVideoSendingBitrateKbps(Tt)})}handleMeetingSessionStatus(Tt,xt){if(this.logger.info(`handling status: ${ut.default[Tt.statusCode()]}`),Tt.isTerminal()||this.meetingSessionContext.statsCollector&&this.meetingSessionContext.statsCollector.logMeetingSessionStatus(Tt),Tt.statusCode()===ut.default.IncompatibleSDP)return this.restartLocalVideo(()=>{this.logger.info("handled incompatible SDP by attempting to restart video")}),!0;if(Tt.statusCode()===ut.default.VideoCallSwitchToViewOnly)return this._videoTileController.removeLocalVideoTile(),this.forEachObserver(Lt=>{kt.Maybe.of(Lt.videoSendDidBecomeUnavailable).map(Xt=>Xt.bind(Lt)())}),!1;if(Tt.statusCode()===ut.default.AudioVideoWasRemovedFromPrimaryMeeting)return this.forEachObserver(Lt=>{kt.Maybe.of(Lt.audioVideoWasDemotedFromPrimaryMeeting).map(Xt=>Xt.bind(Lt)(Tt))}),!1;if(Tt.isTerminal()&&(this.logger.error("session will not be reconnected"),this.meetingSessionContext.reconnectController&&this.meetingSessionContext.reconnectController.disableReconnect()),(Tt.isFailure()||Tt.isTerminal())&&this.meetingSessionContext.reconnectController){const Lt=this.reconnect(Tt,xt);return Lt?this.logger.warn(`The audio video controller will reconnect due to status code ${ut.default[Tt.statusCode()]}${xt?` and error: ${xt.message}`:""}`):this.logger.error(`The audio video controller failed with status code ${ut.default[Tt.statusCode()]}${xt?` and error: ${xt.message}`:""}`),Lt}return!1}setVideoMaxBandwidthKbps(Tt){if(Tt<=0)throw new Error("Max bandwidth kbps has to be greater than 0");this.meetingSessionContext&&this.meetingSessionContext.videoUplinkBandwidthPolicy&&(this.logger.info(`video send has ideal max bandwidth ${Tt} kbps`),this.meetingSessionContext.videoUplinkBandwidthPolicy.setIdealMaxBandwidthKbps(Tt)),this.maxUplinkBandwidthKbps=Tt}handleHasBandwidthPriority(Tt){return tt(this,void 0,void 0,function*(){if(this.meetingSessionContext&&this.meetingSessionContext.videoUplinkBandwidthPolicy&&!this.meetingSessionContext.enableSimulcast){if(this.useUpdateTransceiverControllerForUplink){this.meetingSessionContext.videoUplinkBandwidthPolicy.setHasBandwidthPriority(Tt),yield this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController();return}const xt=this.meetingSessionContext.videoUplinkBandwidthPolicy.maxBandwidthKbps();this.meetingSessionContext.videoUplinkBandwidthPolicy.setHasBandwidthPriority(Tt);const Lt=this.meetingSessionContext.videoUplinkBandwidthPolicy.maxBandwidthKbps();xt!==Lt&&(this.logger.info(`video send bandwidth priority ${Tt} max has changed from ${xt} kbps to ${Lt} kbps`),yield this.enforceBandwidthLimitationForSender(Lt))}})}pauseReceivingStream(Tt){this.meetingSessionContext&&this.meetingSessionContext.signalingClient&&this.meetingSessionContext.signalingClient.pause([Tt])}resumeReceivingStream(Tt){this.meetingSessionContext&&this.meetingSessionContext.signalingClient&&this.meetingSessionContext.signalingClient.resume([Tt])}setVideoCodecSendPreferences(Tt){this.videoSendCodecPreferences=Tt,this.meetingSessionContext.videoSendCodecPreferences=Tt,this.sessionStateController.state()!==Mt.default.NotConnected&&this.update({needsRenegotiation:!0})}getRemoteVideoSources(){const{videoStreamIndex:Tt}=this.meetingSessionContext;if(!Tt)return this.logger.info("meeting has not started"),[];const xt=this.configuration.credentials.attendeeId;return Tt.allVideoSendingSourcesExcludingSelf(xt)}encodingSimulcastLayersDidChange(Tt){this.mayNeedRenegotiationForSimulcastLayerChange=!0,this.forEachObserver(xt=>{kt.Maybe.of(xt.encodingSimulcastLayersDidChange).map(Lt=>Lt.bind(xt)(Tt))})}promoteToPrimaryMeeting(Tt){return this.actionPromoteToPrimaryMeeting(Tt)}actionPromoteToPrimaryMeeting(Tt){return tt(this,void 0,void 0,function*(){let xt=new dt.default(ut.default.SignalingRequestFailed);return yield new Sn.default(this.logger,this.wrapTaskName("PromoteToPrimaryMeeting"),[new Cn.default(this.logger,new gn.default(this.meetingSessionContext,Tt,Lt=>{xt=Lt}),this.configuration.connectionTimeoutMs)]).run(),this.promotedToPrimaryMeeting=xt.statusCode()===ut.default.OK,xt})}demoteFromPrimaryMeeting(){this.meetingSessionContext.signalingClient.demoteFromPrimaryMeeting(),this.forEachObserver(Tt=>{kt.Maybe.of(Tt.audioVideoWasDemotedFromPrimaryMeeting).map(xt=>xt.bind(Tt)(new dt.default(ut.default.OK)))})}videoInputDidChange(Tt){return tt(this,void 0,void 0,function*(){if(this.logger.info("Receive a video input change event"),!this.meetingSessionContext||!this.meetingSessionContext.peer){this.logger.info("Skip updating video input because there is no active meeting and peer connection");return}this._videoTileController.hasStartedLocalVideoTile()&&(Tt?yield this.replaceLocalVideo(Tt):this._videoTileController.stopLocalVideoTile())})}audioInputDidChange(Tt){return tt(this,void 0,void 0,function*(){if(this.logger.info("Receive an audio input change event"),!this.meetingSessionContext||!this.meetingSessionContext.peer){this.logger.info("Skip updating audio input because there is no active meeting and peer connection");return}if(!Tt)try{Tt=yield this.mediaStreamBroker.acquireAudioInputStream()}catch{this.logger.error("Could not acquire audio track from mediaStreamBroker");return}yield this.replaceLocalAudio(Tt)})}};return DefaultAudioVideoController.default=sn,sn.MIN_VOLUME_DECIBELS=-42,sn.MAX_VOLUME_DECIBELS=-14,sn.PING_PONG_INTERVAL_MS=1e4,DefaultAudioVideoController}var DefaultAudioVideoFacade$1={},__awaiter$k=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(DefaultAudioVideoFacade$1,"__esModule",{value:!0});const VideoTransformDevice_1=VideoTransformDevice;class DefaultAudioVideoFacade{constructor($,_,tt,nt,it,rt){this.audioVideoController=$,this.videoTileController=_,this.realtimeController=tt,this.audioMixController=nt,this.deviceController=it,this.contentShareController=rt}addObserver($){this.audioVideoController.addObserver($),this.trace("addObserver")}removeObserver($){this.audioVideoController.removeObserver($),this.trace("removeObserver")}setAudioProfile($){this.trace("setAudioProfile",$),this.audioVideoController.setAudioProfile($)}start($){this.audioVideoController.start($),this.trace("start")}stop(){this.audioVideoController.stop(),this.trace("stop")}getRTCPeerConnectionStats($){return this.trace("getRTCPeerConnectionStats",$?$.id:null),this.audioVideoController.getRTCPeerConnectionStats($)}bindAudioElement($){const _=this.audioMixController.bindAudioElement($);return this.trace("bindAudioElement",$.id,_),_}unbindAudioElement(){this.audioMixController.unbindAudioElement(),this.trace("unbindAudioElement")}getCurrentMeetingAudioStream(){return this.trace("getCurrentConferenceStream"),this.audioMixController.getCurrentMeetingAudioStream()}addAudioMixObserver($){this.trace("addAudioMixObserver"),this.audioMixController.addAudioMixObserver($)}removeAudioMixObserver($){this.trace("removeAudioMixObserver"),this.audioMixController.removeAudioMixObserver($)}bindVideoElement($,_){this.videoTileController.bindVideoElement($,_),this.trace("bindVideoElement",{tileId:$,videoElementId:_.id})}unbindVideoElement($,_=!0){this.videoTileController.unbindVideoElement($,_),this.trace("unbindVideoElement",{tileId:$,cleanUpVideoElement:_})}startLocalVideoTile(){const $=this.videoTileController.startLocalVideoTile();return this.trace("startLocalVideoTile",null,$),$}stopLocalVideoTile(){this.videoTileController.stopLocalVideoTile(),this.trace("stopLocalVideoTile")}hasStartedLocalVideoTile(){const $=this.videoTileController.hasStartedLocalVideoTile();return this.trace("hasStartedLocalVideoTile",null,$),$}removeLocalVideoTile(){this.videoTileController.removeLocalVideoTile(),this.trace("removeLocalVideoTile")}getLocalVideoTile(){const $=this.videoTileController.getLocalVideoTile();return this.trace("getLocalVideoTile"),$}pauseVideoTile($){this.videoTileController.pauseVideoTile($),this.trace("pauseVideoTile",$)}unpauseVideoTile($){this.videoTileController.unpauseVideoTile($),this.trace("unpauseVideoTile",$)}getVideoTile($){const _=this.videoTileController.getVideoTile($);return this.trace("getVideoTile",$),_}getAllRemoteVideoTiles(){const $=this.videoTileController.getAllRemoteVideoTiles();return this.trace("getAllRemoteVideoTiles"),$}getAllVideoTiles(){const $=this.videoTileController.getAllVideoTiles();return this.trace("getAllVideoTiles"),$}addVideoTile(){const $=this.videoTileController.addVideoTile();return this.trace("addVideoTile",null,$.state()),$}removeVideoTile($){this.videoTileController.removeVideoTile($),this.trace("removeVideoTile",$)}removeVideoTilesByAttendeeId($){const _=this.videoTileController.removeVideoTilesByAttendeeId($);return this.trace("removeVideoTilesByAttendeeId",$,_),_}removeAllVideoTiles(){this.videoTileController.removeAllVideoTiles(),this.trace("removeAllVideoTiles")}captureVideoTile($){const _=this.videoTileController.captureVideoTile($);return this.trace("captureVideoTile",$),_}realtimeSubscribeToAttendeeIdPresence($){this.realtimeController.realtimeSubscribeToAttendeeIdPresence($),this.trace("realtimeSubscribeToAttendeeIdPresence")}realtimeUnsubscribeToAttendeeIdPresence($){this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence($),this.trace("realtimeUnsubscribeToAttendeeIdPresence")}realtimeSetCanUnmuteLocalAudio($){this.realtimeController.realtimeSetCanUnmuteLocalAudio($),this.trace("realtimeSetCanUnmuteLocalAudio",$)}realtimeSubscribeToSetCanUnmuteLocalAudio($){this.realtimeController.realtimeSubscribeToSetCanUnmuteLocalAudio($),this.trace("realtimeSubscribeToSetCanUnmuteLocalAudio")}realtimeUnsubscribeToSetCanUnmuteLocalAudio($){this.realtimeController.realtimeUnsubscribeToSetCanUnmuteLocalAudio($),this.trace("realtimeUnsubscribeToSetCanUnmuteLocalAudio")}realtimeCanUnmuteLocalAudio(){const $=this.realtimeController.realtimeCanUnmuteLocalAudio();return this.trace("realtimeCanUnmuteLocalAudio",null,$),$}realtimeMuteLocalAudio(){this.realtimeController.realtimeMuteLocalAudio(),this.trace("realtimeMuteLocalAudio")}realtimeUnmuteLocalAudio(){const $=this.realtimeController.realtimeUnmuteLocalAudio();return this.trace("realtimeUnmuteLocalAudio"),$}realtimeSubscribeToMuteAndUnmuteLocalAudio($){this.realtimeController.realtimeSubscribeToMuteAndUnmuteLocalAudio($),this.trace("realtimeSubscribeToMuteAndUnmuteLocalAudio")}realtimeUnsubscribeToMuteAndUnmuteLocalAudio($){this.realtimeController.realtimeUnsubscribeToMuteAndUnmuteLocalAudio($),this.trace("realtimeUnsubscribeToMuteAndUnmuteLocalAudio")}realtimeIsLocalAudioMuted(){const $=this.realtimeController.realtimeIsLocalAudioMuted();return this.trace("realtimeIsLocalAudioMuted"),$}realtimeSubscribeToVolumeIndicator($,_){this.realtimeController.realtimeSubscribeToVolumeIndicator($,_),this.trace("realtimeSubscribeToVolumeIndicator",$)}realtimeUnsubscribeFromVolumeIndicator($,_){this.realtimeController.realtimeUnsubscribeFromVolumeIndicator($,_),this.trace("realtimeUnsubscribeFromVolumeIndicator",$,_)}realtimeSubscribeToLocalSignalStrengthChange($){this.realtimeController.realtimeSubscribeToLocalSignalStrengthChange($),this.trace("realtimeSubscribeToLocalSignalStrengthChange")}realtimeUnsubscribeToLocalSignalStrengthChange($){this.realtimeController.realtimeUnsubscribeToLocalSignalStrengthChange($),this.trace("realtimeUnsubscribeToLocalSignalStrengthChange")}realtimeSendDataMessage($,_,tt){this.realtimeController.realtimeSendDataMessage($,_,tt),this.trace("realtimeSendDataMessage")}realtimeSubscribeToReceiveDataMessage($,_){this.realtimeController.realtimeSubscribeToReceiveDataMessage($,_),this.trace("realtimeSubscribeToReceiveDataMessage")}realtimeUnsubscribeFromReceiveDataMessage($){this.realtimeController.realtimeUnsubscribeFromReceiveDataMessage($),this.trace("realtimeUnsubscribeFromReceiveDataMessage")}realtimeSubscribeToFatalError($){this.realtimeController.realtimeSubscribeToFatalError($),this.trace("realtimeSubscribeToFatalError")}realtimeUnsubscribeToFatalError($){this.realtimeController.realtimeUnsubscribeToFatalError($),this.trace("realtimeUnsubscribeToFatalError")}subscribeToActiveSpeakerDetector($,_,tt,nt){this.audioVideoController.activeSpeakerDetector.subscribe($,_,tt,nt),this.trace("subscribeToActiveSpeakerDetector")}unsubscribeFromActiveSpeakerDetector($){this.audioVideoController.activeSpeakerDetector.unsubscribe($),this.trace("unsubscribeFromActiveSpeakerDetector")}listAudioInputDevices($=!1){return __awaiter$k(this,void 0,void 0,function*(){const _=yield this.deviceController.listAudioInputDevices($);return this.trace("listAudioInputDevices",$,_),_})}listVideoInputDevices($=!1){return __awaiter$k(this,void 0,void 0,function*(){const _=yield this.deviceController.listVideoInputDevices($);return this.trace("listVideoInputDevices",$,_),_})}listAudioOutputDevices($=!1){return __awaiter$k(this,void 0,void 0,function*(){const _=yield this.deviceController.listAudioOutputDevices($);return this.trace("listAudioOutputDevices",$,_),_})}startAudioInput($){return __awaiter$k(this,void 0,void 0,function*(){return this.trace("startAudioInput",$),this.deviceController.startAudioInput($)})}stopAudioInput(){return __awaiter$k(this,void 0,void 0,function*(){return this.trace("stopAudioInput"),this.deviceController.stopAudioInput()})}startVideoInput($){return __awaiter$k(this,void 0,void 0,function*(){return VideoTransformDevice_1.isVideoTransformDevice($)?this.trace("startVideoInput with transform device"):this.trace("startVideoInput",$),this.deviceController.startVideoInput($)})}stopVideoInput(){return __awaiter$k(this,void 0,void 0,function*(){return this.trace("stopVideoInput"),this.deviceController.stopVideoInput()})}chooseAudioOutput($){const _=this.deviceController.chooseAudioOutput($);return this.trace("chooseAudioOutput",$),_}addDeviceChangeObserver($){this.deviceController.addDeviceChangeObserver($),this.trace("addDeviceChangeObserver")}removeDeviceChangeObserver($){this.deviceController.removeDeviceChangeObserver($),this.trace("removeDeviceChangeObserver")}createAnalyserNodeForAudioInput(){const $=this.deviceController.createAnalyserNodeForAudioInput();return this.trace("createAnalyserNodeForAudioInput"),$}startVideoPreviewForVideoInput($){this.deviceController.startVideoPreviewForVideoInput($),this.trace("startVideoPreviewForVideoInput",$.id)}stopVideoPreviewForVideoInput($){this.deviceController.stopVideoPreviewForVideoInput($),this.trace("stopVideoPreviewForVideoInput",$.id)}setDeviceLabelTrigger($){this.deviceController.setDeviceLabelTrigger($),this.trace("setDeviceLabelTrigger")}mixIntoAudioInput($){const _=this.deviceController.mixIntoAudioInput($);return this.trace("mixIntoAudioInput",$.id),_}chooseVideoInputQuality($,_,tt){this.deviceController.chooseVideoInputQuality($,_,tt),this.trace("chooseVideoInputQuality",{width:$,height:_,frameRate:tt})}setVideoMaxBandwidthKbps($){this.audioVideoController.setVideoMaxBandwidthKbps($),this.trace("setVideoMaxBandwidthKbps",$)}setVideoCodecSendPreferences($){this.audioVideoController.setVideoCodecSendPreferences($),this.trace("setVideoCodecSendPreferences",$)}getVideoInputQualitySettings(){const $=this.deviceController.getVideoInputQualitySettings();return this.trace("getVideoInputQualitySettings"),$}setContentAudioProfile($){this.trace("setContentAudioProfile",$),this.contentShareController.setContentAudioProfile($)}enableSimulcastForContentShare($,_){this.trace("enableSimulcastForContentShare"),this.contentShareController.enableSimulcastForContentShare($,_)}enableSVCForContentShare($){this.trace("enableSVCForContentShare"),this.contentShareController.enableSVCForContentShare($)}startContentShare($){const _=this.contentShareController.startContentShare($);return this.trace("startContentShare"),_}startContentShareFromScreenCapture($,_){const tt=this.contentShareController.startContentShareFromScreenCapture($,_);return this.trace("startContentShareFromScreenCapture"),tt}pauseContentShare(){this.contentShareController.pauseContentShare(),this.trace("pauseContentShare")}unpauseContentShare(){this.contentShareController.unpauseContentShare(),this.trace("unpauseContentShare")}stopContentShare(){this.contentShareController.stopContentShare(),this.trace("stopContentShare")}addContentShareObserver($){this.contentShareController.addContentShareObserver($),this.trace("addContentShareObserver")}removeContentShareObserver($){this.contentShareController.removeContentShareObserver($),this.trace("removeContentShareObserver")}setContentShareVideoCodecPreferences($){this.contentShareController.setContentShareVideoCodecPreferences($),this.trace("setContentShareVideoCodecPreferences")}trace($,_,tt){const nt=this.audioVideoController.configuration.meetingId,it=this.audioVideoController.configuration.credentials.attendeeId;let rt=`API/DefaultAudioVideoFacade/${nt}/${it}/${$}`;typeof _<"u"&&(rt+=` ${JSON.stringify(_)}`),typeof tt<"u"&&(rt+=` -> ${JSON.stringify(tt)}`),this.audioVideoController.logger.info(rt)}getRemoteVideoSources(){const $=this.audioVideoController.getRemoteVideoSources();return this.trace("getRemoteVideoSources",null,$),$}get transcriptionController(){return this.realtimeController.transcriptionController}promoteToPrimaryMeeting($){this.audioVideoController.removeObserver(this),this.audioVideoController.addObserver(this);const _=this.audioVideoController.promoteToPrimaryMeeting($);return this.trace("promoteToPrimaryMeeting",null,_),_}demoteFromPrimaryMeeting(){this.trace("demoteFromPrimaryMeeting"),this.audioVideoController.demoteFromPrimaryMeeting()}audioVideoWasDemotedFromPrimaryMeeting($){this.contentShareController.stopContentShare(),this.audioVideoController.removeObserver(this)}}DefaultAudioVideoFacade$1.default=DefaultAudioVideoFacade;var DefaultContentShareController$1={},MeetingSessionConfiguration$1={},MeetingFeatures$1={},__importDefault$q=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(MeetingFeatures$1,"__esModule",{value:!0});const VideoQualitySettings_1$3=__importDefault$q(VideoQualitySettings$1);class MeetingFeatures{constructor($=VideoQualitySettings_1$3.default.VideoResolutionHD,_=VideoQualitySettings_1$3.default.VideoResolutionFHD){this.videoMaxResolution=$,this.contentMaxResolution=_}clone(){return new MeetingFeatures(this.videoMaxResolution,this.contentMaxResolution)}}MeetingFeatures$1.default=MeetingFeatures;var MeetingSessionCredentials$1={};Object.defineProperty(MeetingSessionCredentials$1,"__esModule",{value:!0});class MeetingSessionCredentials{constructor(){this.attendeeId=null,this.externalUserId=null,this.joinToken=null}toJSON(){return{attendeeId:this.attendeeId,joinToken:this.joinToken===null?null:"<redacted>"}}}MeetingSessionCredentials$1.default=MeetingSessionCredentials;var MeetingSessionURLs$1={};Object.defineProperty(MeetingSessionURLs$1,"__esModule",{value:!0});class MeetingSessionURLs{constructor(){this._audioHostURL=null,this._signalingURL=null,this._turnControlURL=null,this._eventIngestionURL=null,this.urlRewriter=$=>$}get audioHostURL(){return this.urlRewriter(this._audioHostURL)}set audioHostURL($){this._audioHostURL=$}get signalingURL(){return this.urlRewriter(this._signalingURL)}set signalingURL($){this._signalingURL=$}get turnControlURL(){return this.urlRewriter(this._turnControlURL)}set turnControlURL($){this._turnControlURL=$}get eventIngestionURL(){return this.urlRewriter(this._eventIngestionURL)}set eventIngestionURL($){this._eventIngestionURL=$}}MeetingSessionURLs$1.default=MeetingSessionURLs;var __importDefault$p=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(MeetingSessionConfiguration$1,"__esModule",{value:!0});const ConnectionHealthPolicyConfiguration_1=__importDefault$p(ConnectionHealthPolicyConfiguration$1),VideoQualitySettings_1$2=__importDefault$p(VideoQualitySettings$1),Utils_1$4=Utils,MeetingFeatures_1=__importDefault$p(MeetingFeatures$1),MeetingSessionCredentials_1$1=__importDefault$p(MeetingSessionCredentials$1),MeetingSessionURLs_1=__importDefault$p(MeetingSessionURLs$1);class MeetingSessionConfiguration{constructor($,_){var tt,nt;if(this.meetingId=null,this.externalMeetingId=null,this.credentials=null,this.urls=null,this.connectionTimeoutMs=15e3,this.attendeePresenceTimeoutMs=0,this.connectionHealthPolicyConfiguration=new ConnectionHealthPolicyConfiguration_1.default,this.reconnectTimeoutMs=120*1e3,this.reconnectFixedWaitMs=0,this.reconnectShortBackOffMs=1*1e3,this.reconnectLongBackOffMs=5*1e3,this.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.enableSVC=!1,this.videoDownlinkBandwidthPolicy=null,this.videoUplinkBandwidthPolicy=null,this.keepLastFrameWhenPaused=!1,this.disablePeriodicKeyframeRequestOnContentSender=!1,this.meetingFeatures=new MeetingFeatures_1.default,$){$=Utils_1$4.toLowerCasePropertyNames($),$.meeting&&($=$.meeting),this.meetingId=$.meetingid,this.externalMeetingId=$.externalmeetingid,this.urls=new MeetingSessionURLs_1.default,this.urls.audioHostURL=$.mediaplacement.audiohosturl,this.urls.signalingURL=$.mediaplacement.signalingurl,this.urls.turnControlURL=$.mediaplacement.turncontrolurl,$.mediaplacement.eventingestionurl&&(this.urls.eventIngestionURL=$.mediaplacement.eventingestionurl);const it=(rt,ot)=>{switch(rt){case"None":return VideoQualitySettings_1$2.default.VideoDisabled;case"HD":return VideoQualitySettings_1$2.default.VideoResolutionHD;case"FHD":return VideoQualitySettings_1$2.default.VideoResolutionFHD;case"UHD":return VideoQualitySettings_1$2.default.VideoResolutionUHD;default:return ot}};if(((tt=$.meetingfeatures)===null||tt===void 0?void 0:tt.video)!==void 0||((nt=$.meetingfeatures)===null||nt===void 0?void 0:nt.content)!==void 0){const rt=$.meetingfeatures.video===void 0?"HD":$.meetingfeatures.video.maxresolution,ot=$.meetingfeatures.content===void 0?"FHD":$.meetingfeatures.content.maxresolution;this.meetingFeatures=new MeetingFeatures_1.default(it(rt,VideoQualitySettings_1$2.default.VideoResolutionHD),it(ot,VideoQualitySettings_1$2.default.VideoResolutionFHD))}}_&&(_=Utils_1$4.toLowerCasePropertyNames(_),_.attendee&&(_=_.attendee),this.credentials=new MeetingSessionCredentials_1$1.default,this.credentials.attendeeId=_.attendeeid,this.credentials.externalUserId=_.externaluserid,this.credentials.joinToken=_.jointoken)}}MeetingSessionConfiguration$1.default=MeetingSessionConfiguration;var NoVideoDownlinkBandwidthPolicy$1={},__importDefault$o=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(NoVideoDownlinkBandwidthPolicy$1,"__esModule",{value:!0});const DefaultVideoStreamIdSet_1=__importDefault$o(DefaultVideoStreamIdSet$1);class NoVideoDownlinkBandwidthPolicy{reset(){}updateIndex($){}updateMetrics($){}wantsResubscribe(){return!1}chooseSubscriptions(){return new DefaultVideoStreamIdSet_1.default}}NoVideoDownlinkBandwidthPolicy$1.default=NoVideoDownlinkBandwidthPolicy;var DefaultSimulcastUplinkPolicyForContentShare$1={},__importDefault$n=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultSimulcastUplinkPolicyForContentShare$1,"__esModule",{value:!0});const SimulcastContentShareTransceiverController_1=__importDefault$n(SimulcastContentShareTransceiverController$1);class DefaultSimulcastUplinkPolicyForContentShare{constructor($,_){this.encodingParams=_,this.enableUhdContent=!1,this.defaultHiTargetBitrateKbps=1200,this.defaultLowTargetBitrateKbps=300}updateConnectionMetric($){}chooseMediaTrackConstraints(){}chooseEncodingParameters(){var $,_,tt,nt,it,rt,ot,lt,st,at,ct,dt;const ut=new Map,ft=1e3,pt=SimulcastContentShareTransceiverController_1.default.NAME_ARR_ASCENDING;return ut.set(pt[0],{rid:pt[0],active:!0,scaleResolutionDownBy:((_=($=this.encodingParams)===null||$===void 0?void 0:$.low)===null||_===void 0?void 0:_.scaleResolutionDownBy)||2,maxBitrate:(((nt=(tt=this.encodingParams)===null||tt===void 0?void 0:tt.low)===null||nt===void 0?void 0:nt.maxBitrateKbps)||this.defaultLowTargetBitrateKbps)*ft,maxFramerate:((rt=(it=this.encodingParams)===null||it===void 0?void 0:it.low)===null||rt===void 0?void 0:rt.maxFramerate)||5}),ut.set(pt[1],{rid:pt[1],active:!0,scaleResolutionDownBy:((lt=(ot=this.encodingParams)===null||ot===void 0?void 0:ot.high)===null||lt===void 0?void 0:lt.scaleResolutionDownBy)||1,maxBitrate:(((at=(st=this.encodingParams)===null||st===void 0?void 0:st.high)===null||at===void 0?void 0:at.maxBitrateKbps)||this.defaultHiTargetBitrateKbps)*ft,maxFramerate:(dt=(ct=this.encodingParams)===null||ct===void 0?void 0:ct.high)===null||dt===void 0?void 0:dt.maxFramerate}),ut}updateIndex($){}wantsResubscribe(){return!1}chooseCaptureAndEncodeParameters(){}maxBandwidthKbps(){return this.enableUhdContent?2e3:1200}setIdealMaxBandwidthKbps($){}setHasBandwidthPriority($){}setHighResolutionFeatureEnabled($){this.enableUhdContent=$,this.defaultHiTargetBitrateKbps=$?2e3:1200,this.defaultLowTargetBitrateKbps=$?500:300}addObserver($){}removeObserver($){}forEachObserver($){}}DefaultSimulcastUplinkPolicyForContentShare$1.default=DefaultSimulcastUplinkPolicyForContentShare;var __awaiter$j=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$m=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultContentShareController$1,"__esModule",{value:!0});const VideoQualitySettings_1$1=__importDefault$m(VideoQualitySettings$1),MeetingSessionConfiguration_1=__importDefault$m(MeetingSessionConfiguration$1),MeetingSessionCredentials_1=__importDefault$m(MeetingSessionCredentials$1),DefaultModality_1=__importDefault$m(DefaultModality$1),AsyncScheduler_1$2=__importDefault$m(AsyncScheduler$1),Types_1=Types,NoVideoDownlinkBandwidthPolicy_1=__importDefault$m(NoVideoDownlinkBandwidthPolicy$1),DefaultSimulcastUplinkPolicyForContentShare_1=__importDefault$m(DefaultSimulcastUplinkPolicyForContentShare$1),ContentShareConstants_1=__importDefault$m(ContentShareConstants$1);class DefaultContentShareController{constructor($,_,tt){this.mediaStreamBroker=$,this.contentAudioVideo=_,this.attendeeAudioVideo=tt,this.observerQueue=new Set,this.destroyed=!1,this.contentAudioVideo.addObserver(this),this.setupContentShareEvents()}static createContentShareMeetingSessionConfigure($){const _=new MeetingSessionConfiguration_1.default;return _.meetingId=$.meetingId,_.externalMeetingId=$.externalMeetingId,_.urls=$.urls,_.disablePeriodicKeyframeRequestOnContentSender=$.disablePeriodicKeyframeRequestOnContentSender,_.credentials=new MeetingSessionCredentials_1.default,_.credentials.attendeeId=$.credentials.attendeeId+ContentShareConstants_1.default.Modality,_.credentials.externalUserId=$.credentials.externalUserId,_.credentials.joinToken=$.credentials.joinToken+ContentShareConstants_1.default.Modality,_.meetingFeatures=$.meetingFeatures.clone(),_.videoDownlinkBandwidthPolicy=new NoVideoDownlinkBandwidthPolicy_1.default,_}setContentAudioProfile($){this.contentAudioVideo.setAudioProfile($)}enableSimulcastForContentShare($,_){$?(this.contentAudioVideo.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!0,this.contentAudioVideo.configuration.videoUplinkBandwidthPolicy=new DefaultSimulcastUplinkPolicyForContentShare_1.default(this.contentAudioVideo.logger,_)):(this.contentAudioVideo.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.contentAudioVideo.configuration.videoUplinkBandwidthPolicy=void 0)}enableSVCForContentShare($){$?this.contentAudioVideo.configuration.enableSVC=!0:this.contentAudioVideo.configuration.enableSVC=!1}startContentShare($){return __awaiter$j(this,void 0,void 0,function*(){if($){if(this.contentAudioVideo.configuration.meetingFeatures.contentMaxResolution===VideoQualitySettings_1$1.default.VideoDisabled){this.contentAudioVideo.logger.info("Could not start content because max content resolution was set to None");return}this.mediaStreamBroker.mediaStream=$;for(let _=0;_<this.mediaStreamBroker.mediaStream.getTracks().length;_++)this.mediaStreamBroker.mediaStream.getTracks()[_].addEventListener("ended",()=>{this.stopContentShare()});this.contentAudioVideo.start()}})}startContentShareFromScreenCapture($,_){return __awaiter$j(this,void 0,void 0,function*(){const tt=yield this.mediaStreamBroker.acquireScreenCaptureDisplayInputStream($,_);return yield this.startContentShare(tt),tt})}pauseContentShare(){this.mediaStreamBroker.toggleMediaStream(!1)&&this.forEachContentShareObserver($=>{Types_1.Maybe.of($.contentShareDidPause).map(_=>_.call($))})}unpauseContentShare(){this.mediaStreamBroker.toggleMediaStream(!0)&&this.forEachContentShareObserver($=>{Types_1.Maybe.of($.contentShareDidUnpause).map(_=>_.call($))})}setContentShareVideoCodecPreferences($){this.contentAudioVideo.setVideoCodecSendPreferences($)}destroy(){return __awaiter$j(this,void 0,void 0,function*(){this.contentAudioVideo&&(this.destroyed=!0,this.contentAudioVideo.removeObserver(this),this.stopContentShare(),this.observerQueue.clear(),this.contentAudioVideo=void 0,this.attendeeAudioVideo=void 0,this.mediaStreamBroker=void 0)})}stopContentShare(){this.contentAudioVideo.stop(),this.mediaStreamBroker.cleanup()}addContentShareObserver($){this.observerQueue.add($)}removeContentShareObserver($){this.observerQueue.delete($)}forEachContentShareObserver($){for(const _ of this.observerQueue)AsyncScheduler_1$2.default.nextTick(()=>{this.observerQueue.has(_)&&$(_)})}audioVideoDidStart(){var $;(($=this.mediaStreamBroker.mediaStream)===null||$===void 0?void 0:$.getVideoTracks().length)>0&&this.contentAudioVideo.videoTileController.startLocalVideoTile()}audioVideoDidStop($){this.mediaStreamBroker.cleanup(),this.contentShareTile&&(this.attendeeAudioVideo.videoTileController.removeVideoTile(this.contentShareTile.id()),this.contentShareTile=null),this.forEachContentShareObserver(_=>{Types_1.Maybe.of(_.contentShareDidStop).map(tt=>tt.call(_))})}setupContentShareEvents(){this.attendeeAudioVideo.realtimeController.realtimeSubscribeToAttendeeIdPresence(($,_,tt,nt)=>{const it=new DefaultModality_1.default($).hasModality(DefaultModality_1.default.MODALITY_CONTENT),rt=new DefaultModality_1.default($).base()===this.attendeeAudioVideo.configuration.credentials.attendeeId;if(!it||!rt||!_||this.contentShareTile)return;const ot=this.mediaStreamBroker.mediaStream;if(ot!=null&&ot.getVideoTracks().length){this.contentShareTile=this.attendeeAudioVideo.videoTileController.addVideoTile();const lt=ot.getVideoTracks()[0];let st,at;if(lt.getSettings){const ct=lt.getSettings();st=ct.width,at=ct.height}else{const ct=lt.getCapabilities();st=ct.width,at=ct.height}this.contentShareTile.bindVideoStream(this.contentAudioVideo.configuration.credentials.attendeeId,!1,ot,st,at,null,this.contentAudioVideo.configuration.credentials.externalUserId)}this.forEachContentShareObserver(lt=>{Types_1.Maybe.of(lt.contentShareDidStart).map(st=>st.call(lt))})})}}DefaultContentShareController$1.default=DefaultContentShareController;var DefaultEventController$1={},Destroyable={};Object.defineProperty(Destroyable,"__esModule",{value:!0});Destroyable.isDestroyable=void 0;function isDestroyable(et){return et&&"destroy"in et}Destroyable.isDestroyable=isDestroyable;var EventIngestionConfiguration$1={},EventBufferConfiguration$1={};Object.defineProperty(EventBufferConfiguration$1,"__esModule",{value:!0});class EventBufferConfiguration{constructor($=5e3,_=2,tt=64,nt=100,it=15){this.flushIntervalMs=$,this.flushSize=_,this.maxBufferCapacityKb=tt,this.totalBufferItems=nt,this.retryCountLimit=it}}EventBufferConfiguration$1.default=EventBufferConfiguration;var __importDefault$l=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(EventIngestionConfiguration$1,"__esModule",{value:!0});const EventBufferConfiguration_1=__importDefault$l(EventBufferConfiguration$1);class EventIngestionConfiguration{constructor($,_,tt=new EventBufferConfiguration_1.default){this.eventsClientConfiguration=$,this.ingestionURL=_,this.eventBufferConfiguration=tt}}EventIngestionConfiguration$1.default=EventIngestionConfiguration;var DefaultMeetingEventReporter$1={},InMemoryJSONEventBuffer$1={},FullJitterBackoff$1={};Object.defineProperty(FullJitterBackoff$1,"__esModule",{value:!0});class FullJitterBackoff{constructor($,_,tt){this.fixedWaitMs=$,this.shortBackoffMs=_,this.longBackoffMs=tt,this.currentRetry=0,this.fixedWaitMs<0&&(this.fixedWaitMs=0),this.shortBackoffMs<0&&(this.shortBackoffMs=0),this.longBackoffMs<0&&(this.longBackoffMs=0),this.reset()}reset(){this.currentRetry=0}nextBackoffAmountMs(){const $=Math.random()*Math.min(this.longBackoffMs,this.shortBackoffMs*Math.pow(2,this.currentRetry))+this.fixedWaitMs;return this.currentRetry+=1,$}}FullJitterBackoff$1.default=FullJitterBackoff;var DefaultUserAgentParser$1={},__importDefault$k=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultUserAgentParser$1,"__esModule",{value:!0});const ua_parser_js_1$1=uaParserExports,Versioning_1$5=__importDefault$k(Versioning$1);class DefaultUserAgentParser{constructor($){var _,tt,nt,it,rt,ot,lt;try{this.parserResult=navigator&&navigator.userAgent?new ua_parser_js_1$1.UAParser(navigator.userAgent).getResult():void 0}catch(st){$.error(st.message)}this.browserMajorVersion=((nt=(tt=(_=this.parserResult)===null||_===void 0?void 0:_.browser)===null||tt===void 0?void 0:tt.version)===null||nt===void 0?void 0:nt.split(".")[0])||DefaultUserAgentParser.UNAVAILABLE,this.browserName=((it=this.parserResult)===null||it===void 0?void 0:it.browser.name)||DefaultUserAgentParser.UNAVAILABLE,this.browserVersion=((rt=this.parserResult)===null||rt===void 0?void 0:rt.browser.version)||DefaultUserAgentParser.UNAVAILABLE,this.deviceName=[((ot=this.parserResult)===null||ot===void 0?void 0:ot.device.vendor)||"",((lt=this.parserResult)===null||lt===void 0?void 0:lt.device.model)||""].join(" ").trim()||DefaultUserAgentParser.UNAVAILABLE}getParserResult(){var $,_;return{browserMajorVersion:this.browserMajorVersion,browserName:this.browserName,browserVersion:this.browserVersion,deviceName:this.deviceName,osName:(($=this.parserResult)===null||$===void 0?void 0:$.os.name)||DefaultUserAgentParser.UNAVAILABLE,osVersion:((_=this.parserResult)===null||_===void 0?void 0:_.os.version)||DefaultUserAgentParser.UNAVAILABLE,sdkVersion:Versioning_1$5.default.sdkVersion,sdkName:Versioning_1$5.default.sdkName}}}DefaultUserAgentParser$1.default=DefaultUserAgentParser;DefaultUserAgentParser.UNAVAILABLE="Unavailable";var __awaiter$i=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__rest=commonjsGlobal&&commonjsGlobal.__rest||function(et,$){var _={};for(var tt in et)Object.prototype.hasOwnProperty.call(et,tt)&&$.indexOf(tt)<0&&(_[tt]=et[tt]);if(et!=null&&typeof Object.getOwnPropertySymbols=="function")for(var nt=0,tt=Object.getOwnPropertySymbols(et);nt<tt.length;nt++)$.indexOf(tt[nt])<0&&Object.prototype.propertyIsEnumerable.call(et,tt[nt])&&(_[tt[nt]]=et[tt[nt]]);return _},__importDefault$j=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(InMemoryJSONEventBuffer$1,"__esModule",{value:!0});const FullJitterBackoff_1$3=__importDefault$j(FullJitterBackoff$1),IntervalScheduler_1$1=__importDefault$j(IntervalScheduler$1),DefaultUserAgentParser_1=__importDefault$j(DefaultUserAgentParser$1),Utils_1$3=Utils;class InMemoryJSONEventBuffer{constructor($,_,tt,nt,it){this.buffer=[],this.bufferSize=0,this.maxBufferItemCapacityBytes=0,this.ingestionEventSize=0,this.flushIntervalMs=0,this.flushSize=0,this.failedIngestionEvents=[],this.retryCountLimit=15,this.lock=!1,this.cancellableEvents=new Map,this.attributesToFilter=["externalUserId","externalMeetingId","timestampMs"],this.deepCopyCurrentIngestionEvent=gt=>({type:gt.type,v:gt.v,payloads:[...gt.payloads]}),this.sendEvents=()=>__awaiter$i(this,void 0,void 0,function*(){if(this.lock)return;const gt=this.getItems(this.flushSize);if(gt.length===0)return;this.lock=!0;const yt=this.makeRequestBody(gt);let vt=!1;const Ct=Date.now();this.metadata.browserName.toLowerCase()==="firefox"&&this.cancellableEvents.set(Ct,gt);try{this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - sending body ${yt}`);const Et=yield this.send(yt);if(this.cancellableEvents.delete(Ct),!Et.ok)this.logger.error(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - Failed to send events ${yt} with response status ${Et.status}`),vt=!0;else try{const Mt=yield Et.json();this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - send successful events: ${yt} message: ${JSON.stringify(Mt)}`)}catch(Mt){this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEvents error reading OK response ${Mt} for events ${yt}`)}}catch(Et){vt=!0,this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - Error in sending events ${yt} to the ingestion endpoint ${Et}`)}finally{this.lock=!1}vt&&(this.cancellableEvents.delete(Ct),this.failedIngestionEvents.push(...gt))});const rt=new DefaultUserAgentParser_1.default(it).getParserResult(),ot=__rest(rt,["browserMajorVersion"]),lt=_.toJSON(),{type:st,v:at}=lt,ct=__rest(lt,["type","v"]);this.authenticationToken=_.getAuthenticationToken(),this.metadata=Object.assign(Object.assign({},ot),ct),Object.keys(this.metadata).forEach(gt=>this.attributesToFilter.push(gt)),this.type=st,this.v=at,this.ingestionURL=tt,this.logger=it,this.importantEvents=new Set(nt);const{maxBufferCapacityKb:dt,totalBufferItems:ut,flushSize:ft,flushIntervalMs:pt,retryCountLimit:St}=$;this.maxBufferCapacityBytes=dt*1024,this.totalBufferItems=ut,this.maxBufferItemCapacityBytes=Math.round(this.maxBufferCapacityBytes/ut),this.flushIntervalMs=pt,this.flushSize=ft,this.retryCountLimit=St,this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent(),this.beaconEventListener=gt=>this.beaconEventHandler(gt),this.addEventListeners()}addEventListeners(){!this.beaconEventListener||!("window"in window)||!window.addEventListener||!("document"in window)||!document.addEventListener||(this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - addEventListeners - adding pagehide and visibility change event listeners"),window.addEventListener("pagehide",this.beaconEventListener),document.addEventListener("visibilitychange",this.beaconEventListener))}beaconEventHandler($){($.type==="visibilitychange"&&document.visibilityState==="hidden"||$.type==="pagehide")&&(this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - beaconEventHandler is triggered calling sendBeacon"),this.sendBeacon())}removeEventListeners(){!this.beaconEventListener||!("window"in window)||!window.removeEventListener||!("document"in window)||!document.removeEventListener||(window.removeEventListener("pagehide",this.beaconEventListener),document.removeEventListener("visibilitychange",this.beaconEventListener),this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - removeEventListeners - removing pagehide and visibility change event listeners"))}start(){var $;this.removeEventListeners(),this.addEventListeners(),($=this.intervalScheduler)===null||$===void 0||$.stop(),this.intervalScheduler=new IntervalScheduler_1$1.default(this.flushIntervalMs),this.intervalScheduler.start(()=>this.sendEvents())}stop(){var $;($=this.intervalScheduler)===null||$===void 0||$.stop(),this.intervalScheduler=void 0,this.sendBeacon(),this.removeEventListeners()}addItem($){return __awaiter$i(this,void 0,void 0,function*(){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - received event ${JSON.stringify($)}`);const{name:_,ts:tt,attributes:nt}=$,it=nt&&this.filterAttributes(nt,this.attributesToFilter),rt=Object.assign({name:_,ts:tt},it);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - event after filtering attributes ${JSON.stringify(rt)}`);const ot=this.getSize(rt);if(ot>InMemoryJSONEventBuffer.MAX_ITEM_SIZE_BYTES_ALLOWED)throw new Error(`Event Reporting - Item to be added has size ${ot} bytes. Item cannot exceed max item size allowed of ${InMemoryJSONEventBuffer.MAX_ITEM_SIZE_BYTES_ALLOWED} bytes.`);if(this.importantEvents.has(_)){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - sending important event ${JSON.stringify(rt)}`),this.sendEventImmediately({name:_,ts:tt,attributes:it});return}if(this.isFull())throw this.logger.warn("Event Reporting - Event buffer is full"),new Error("Buffer full");if(this.currentIngestionEvent.payloads.push(rt),this.ingestionEventSize+=ot,this.bufferItemThresholdReached(ot)){const lt=this.deepCopyCurrentIngestionEvent(this.currentIngestionEvent);this.buffer.push(lt),this.bufferSize+=this.ingestionEventSize,this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent(),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - buffer item threshold reached updated buffer ${JSON.stringify(this.buffer)}`)}})}filterAttributes($,_){const tt=new Set(_);return Object.keys($).filter(it=>tt.has(it)).forEach(it=>delete $[it]),$}initializeAndGetCurrentIngestionEvent(){const $={type:this.type,v:this.v,payloads:[]};return this.ingestionEventSize=this.getSize($),$}bufferItemThresholdReached($){return $+this.ingestionEventSize>=this.maxBufferItemCapacityBytes||this.currentIngestionEvent.payloads.length===InMemoryJSONEventBuffer.MAX_PAYLOAD_ITEMS}getSize($){let _=0;if(typeof $=="object")for(const[tt,nt]of Object.entries($))_+=this.getPrimitiveSize(tt),_+=this.getSize(nt);else _+=this.getPrimitiveSize($);return _}getPrimitiveSize($){let _=0;return typeof $=="string"?_+=$.length*2:typeof $=="number"&&(_+=8),_}isFull(){return this.bufferSize===this.maxBufferCapacityBytes||this.buffer.length===this.totalBufferItems}isEmpty(){return this.buffer.length===0||this.bufferSize===0}getItems($,_=0){return this.isEmpty()?[]:($=Math.min(this.buffer.length,$+1),this.buffer.splice(_,$))}makeBeaconRequestBody($){const _={metadata:this.metadata,events:$,authorization:this.authenticationToken};return JSON.stringify(_)}makeRequestBody($){const _={metadata:this.metadata,events:$};return JSON.stringify(_)}sendEventImmediately($){return __awaiter$i(this,void 0,void 0,function*(){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - important event received ${JSON.stringify($)}`);const{name:_,ts:tt,attributes:nt}=$,it={type:this.type,v:this.v,payloads:[Object.assign({name:_,ts:tt},nt)]};let rt=!1,ot=null;const lt=this.makeRequestBody([it]);try{if(ot=yield this.send(lt),ot.ok){try{const st=yield ot.json();this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - send successful event: ${lt}, message: ${JSON.stringify(st)}`)}catch(st){this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - Error reading OK response ${st} for event ${lt}`)}return}else this.logger.error(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - Failed to send an important event ${lt} with response status ${ot.status}`),rt=!0}catch(st){this.logger.warn(`Event Reporting - There may be a failure in sending an important event ${lt} to the ingestion endpoint ${st}.`),rt=!0;try{if(this.metadata.browserName.toLowerCase()==="firefox"){const at=this.makeBeaconRequestBody([it]);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - beaconing data out ${at}`),navigator.sendBeacon(`${this.ingestionURL}?beacon=1`,at)?rt=!1:rt=!0}}catch{this.logger.warn(`Event Reporting - Error sending beacon for an important event ${lt}`),rt=!0}}rt&&(this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - pushing to failed events ${lt}`),this.failedIngestionEvents.push(it))})}send($){return __awaiter$i(this,void 0,void 0,function*(){const _=new FullJitterBackoff_1$3.default(InMemoryJSONEventBuffer.RETRY_FIXED_BACKOFF_WAIT_MS,InMemoryJSONEventBuffer.RETRY_SHORT_BACKOFF_MS,InMemoryJSONEventBuffer.RETRY_LONG_BACKOFF_MS);try{let tt=0;for(;tt<this.retryCountLimit;){const nt=yield fetch(this.ingestionURL,{method:"POST",headers:{Authorization:`Bearer ${this.authenticationToken}`},body:$});if(nt.ok||!InMemoryJSONEventBuffer.SENDING_FAILURE_CODES.has(nt.status))return nt;if(this.logger.warn(`Will retry sending failure for ${$} due to status code ${nt.status}.`),tt++,tt<this.retryCountLimit){const it=_.nextBackoffAmountMs();yield Utils_1$3.wait(it)}}if(tt===this.retryCountLimit)throw new Error(`Retry count limit reached for ${$}`)}catch(tt){throw tt}})}sendBeacon(){return __awaiter$i(this,void 0,void 0,function*(){const $=this.buffer;if(this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out buffer events ${JSON.stringify($)}`),this.buffer=[],this.currentIngestionEvent.payloads.length>0){const tt=this.deepCopyCurrentIngestionEvent(this.currentIngestionEvent);$.push(tt),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out current ingestion event ${JSON.stringify(tt)}`),this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent()}if(this.failedIngestionEvents.length>0){const tt=this.failedIngestionEvents.map(nt=>this.deepCopyCurrentIngestionEvent(nt));$.push(...tt),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out any failed ingestion event ${JSON.stringify(tt)}`),this.failedIngestionEvents=[]}if(this.cancellableEvents.size>0&&(this.cancellableEvents.forEach(tt=>{$.push(...tt),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out each cancellable event ${JSON.stringify(tt)}`)}),this.cancellableEvents.clear()),$.length===0)return;const _=this.makeBeaconRequestBody($);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - beacon data to send ${_}`);try{navigator.sendBeacon(`${this.ingestionURL}?beacon=1`,_)||this.logger.warn(`Event Reporting - Browser failed to queue beacon data ${_}`)}catch(tt){this.logger.warn(`Event Reporting - Sending beacon data ${_} failed with error ${tt}`)}})}reset(){this.maxBufferCapacityBytes=0,this.totalBufferItems=0,this.buffer=[],this.bufferSize=0,this.maxBufferItemCapacityBytes=0,this.ingestionEventSize=0,this.flushIntervalMs=0,this.flushSize=0,this.failedIngestionEvents=[],this.lock=!1,this.beaconEventListener=void 0,this.cancellableEvents.clear()}destroy(){return __awaiter$i(this,void 0,void 0,function*(){this.stop(),this.reset()})}}InMemoryJSONEventBuffer$1.default=InMemoryJSONEventBuffer;InMemoryJSONEventBuffer.SENDING_FAILURE_CODES=new Set([408,429,500,502,503,504]);InMemoryJSONEventBuffer.RETRY_FIXED_BACKOFF_WAIT_MS=0;InMemoryJSONEventBuffer.RETRY_SHORT_BACKOFF_MS=1e3;InMemoryJSONEventBuffer.RETRY_LONG_BACKOFF_MS=15e3;InMemoryJSONEventBuffer.MAX_PAYLOAD_ITEMS=2;InMemoryJSONEventBuffer.MAX_ITEM_SIZE_BYTES_ALLOWED=3e3;var __awaiter$h=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$i=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultMeetingEventReporter$1,"__esModule",{value:!0});const Destroyable_1$1=Destroyable,InMemoryJSONEventBuffer_1=__importDefault$i(InMemoryJSONEventBuffer$1);class DefaultMeetingEventReporter{constructor($,_){this.reportingEvents=!1,this.importantEvents=["meetingEnded","meetingFailed","meetingStartFailed","audioInputFailed","videoInputFailed","meetingStartSucceeded","deviceLabelTriggerFailed"],this.destroyed=!1;const{eventsClientConfiguration:tt,ingestionURL:nt,eventBufferConfiguration:it}=$,{eventsToIgnore:rt}=tt;this.eventBuffer=new InMemoryJSONEventBuffer_1.default(it,tt,nt,this.importantEvents,_),this.logger=_,this.eventsToIgnore=rt,this.start()}start(){if(!this.reportingEvents)try{this.eventBuffer.start(),this.logger.info("Event reporting started"),this.reportingEvents=!0}catch($){this.logger.error(`Event Reporting - Error starting the event buffer ${$}`)}}stop(){if(this.reportingEvents)try{this.eventBuffer.stop(),this.logger.info("Event reporting stopped"),this.reportingEvents=!1}catch($){this.logger.error(`Event Reporting - Error stopping the event buffer ${$}`)}}reportEvent($,_,tt){return __awaiter$h(this,void 0,void 0,function*(){if(this.logger.debug(`Event Reporting - DefaultMeetingEventReporter - event received in reportEvent ${$}, ${_}, ${JSON.stringify(tt)}`),this.eventsToIgnore.includes(_)){this.logger.debug(`Event Reporting - DefaultMeetingEventReporter - ${_} event will be ignored as it is in events to ignore`);return}try{this.logger.debug("Event Reporting - DefaultMeetingEventReporter - adding item to event buffer"),yield this.eventBuffer.addItem({ts:$,name:_,attributes:tt})}catch(nt){this.logger.error(`Event Reporting - Error adding event to buffer ${nt}`)}})}destroy(){return __awaiter$h(this,void 0,void 0,function*(){this.destroyed=!0,this.stop(),Destroyable_1$1.isDestroyable(this.eventBuffer)&&this.eventBuffer.destroy(),this.eventBuffer=void 0})}}DefaultMeetingEventReporter$1.default=DefaultMeetingEventReporter;var MeetingEventsClientConfiguration$1={};Object.defineProperty(MeetingEventsClientConfiguration$1,"__esModule",{value:!0});class MeetingEventsClientConfiguration{constructor($,_,tt,nt=[]){this.type="Meet",this.v=1,this.meetingId=$,this.attendeeId=_,this.eventsToIgnore=nt,this.authenticationToken=tt}getAuthenticationToken(){return this.authenticationToken}toJSON(){const $={};return $.type=this.type,$.v=this.v,$.meetingId=this.meetingId,$.attendeeId=this.attendeeId,$}}MeetingEventsClientConfiguration$1.default=MeetingEventsClientConfiguration;var flattenEventAttributes$1={};Object.defineProperty(flattenEventAttributes$1,"__esModule",{value:!0});const flattenEventAttributes=et=>{const $={};for(const[_,tt]of Object.entries(et))if(!(tt==null||tt===""))if(typeof tt=="number"||typeof tt=="string")$[_]=tt;else throw new TypeError("Unhandled type received while flattening attributes.");return $};flattenEventAttributes$1.default=flattenEventAttributes;var __awaiter$g=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$h=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultEventController$1,"__esModule",{value:!0});const ua_parser_js_1=uaParserExports,Destroyable_1=Destroyable,EventIngestionConfiguration_1=__importDefault$h(EventIngestionConfiguration$1),DefaultMeetingEventReporter_1=__importDefault$h(DefaultMeetingEventReporter$1),MeetingEventsClientConfiguration_1=__importDefault$h(MeetingEventsClientConfiguration$1),AsyncScheduler_1$1=__importDefault$h(AsyncScheduler$1),Versioning_1$4=__importDefault$h(Versioning$1),flattenEventAttributes_1=__importDefault$h(flattenEventAttributes$1);class DefaultEventController{constructor($,_,tt){var nt,it,rt,ot,lt,st,at;this.meetingHistoryStates=[],this.observerSet=new Set,this.destroyed=!1,this.logger=_,this.configuration=$,this.setupEventReporter($,_,tt);try{this.parserResult=navigator&&navigator.userAgent?new ua_parser_js_1.UAParser(navigator.userAgent).getResult():null}catch(ct){this.logger.error(ct.message)}this.browserMajorVersion=((rt=(it=(nt=this.parserResult)===null||nt===void 0?void 0:nt.browser)===null||it===void 0?void 0:it.version)===null||rt===void 0?void 0:rt.split(".")[0])||DefaultEventController.UNAVAILABLE,this.browserName=((ot=this.parserResult)===null||ot===void 0?void 0:ot.browser.name)||DefaultEventController.UNAVAILABLE,this.browserVersion=((lt=this.parserResult)===null||lt===void 0?void 0:lt.browser.version)||DefaultEventController.UNAVAILABLE,this.deviceName=[((st=this.parserResult)===null||st===void 0?void 0:st.device.vendor)||"",((at=this.parserResult)===null||at===void 0?void 0:at.device.model)||""].join(" ").trim()||DefaultEventController.UNAVAILABLE}addObserver($){this.observerSet.add($)}removeObserver($){this.observerSet.delete($)}forEachObserver($){for(const _ of this.observerSet)AsyncScheduler_1$1.default.nextTick(()=>{this.observerSet.has(_)&&$(_)})}publishEvent($,_){return __awaiter$g(this,void 0,void 0,function*(){const tt=Date.now();this.meetingHistoryStates.push({name:$,timestampMs:tt});const nt=Object.freeze(Object.assign(this.getAttributes(tt),_));this.forEachObserver(it=>{it.eventDidReceive($,nt)}),this.reportEvent($,tt,_)})}reportEvent($,_,tt){var nt;return __awaiter$g(this,void 0,void 0,function*(){let it;try{tt&&(it=flattenEventAttributes_1.default(tt)),yield(nt=this.eventReporter)===null||nt===void 0?void 0:nt.reportEvent(_,$,it)}catch(rt){this.logger.error(`Error reporting event ${rt}`)}})}setupEventReporter($,_,tt){if(tt)this._eventReporter=tt;else if($.urls){const nt=$.urls.eventIngestionURL;if(nt){this.logger.info("Event ingestion URL is present in the configuration");const{meetingId:it,credentials:{attendeeId:rt,joinToken:ot}}=$,lt=new MeetingEventsClientConfiguration_1.default(it,rt,ot),st=new EventIngestionConfiguration_1.default(lt,nt);this._eventReporter=new DefaultMeetingEventReporter_1.default(st,_)}}}getAttributes($){var _,tt;return{attendeeId:this.configuration.credentials.attendeeId,browserMajorVersion:this.browserMajorVersion,browserName:this.browserName,browserVersion:this.browserVersion,deviceName:this.deviceName,externalMeetingId:typeof this.configuration.externalMeetingId=="string"?this.configuration.externalMeetingId:"",externalUserId:this.configuration.credentials.externalUserId,meetingHistory:this.meetingHistoryStates,meetingId:this.configuration.meetingId,osName:((_=this.parserResult)===null||_===void 0?void 0:_.os.name)||DefaultEventController.UNAVAILABLE,osVersion:((tt=this.parserResult)===null||tt===void 0?void 0:tt.os.version)||DefaultEventController.UNAVAILABLE,sdkVersion:Versioning_1$4.default.sdkVersion,sdkName:Versioning_1$4.default.sdkName,timestampMs:$}}get eventReporter(){return this._eventReporter}destroy(){return __awaiter$g(this,void 0,void 0,function*(){Destroyable_1.isDestroyable(this.eventReporter)&&(yield this.eventReporter.destroy()),this.logger=void 0,this.configuration=void 0,this._eventReporter=void 0,this.destroyed=!0})}}DefaultEventController$1.default=DefaultEventController;DefaultEventController.UNAVAILABLE="Unavailable";var DefaultMeetingReadinessChecker$1={},MeetingReadinessCheckerConfiguration$1={};Object.defineProperty(MeetingReadinessCheckerConfiguration$1,"__esModule",{value:!0});class MeetingReadinessCheckerConfiguration{constructor(){this.timeoutMs=1e4,this.waitDurationMs=3e3,this.audioOutputFrequency=440,this.audioOutputGain=.1}}MeetingReadinessCheckerConfiguration$1.default=MeetingReadinessCheckerConfiguration;var __awaiter$f=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$g=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultMeetingReadinessChecker$1,"__esModule",{value:!0});const DefaultAudioMixController_1=__importDefault$g(DefaultAudioMixController$1),DefaultBrowserBehavior_1$2=__importDefault$g(DefaultBrowserBehavior$1),DefaultDeviceController_1=__importDefault$g(DefaultDeviceController$1),PermissionDeniedError_1=__importDefault$g(PermissionDeniedError$1),BaseTask_1$1=__importDefault$g(BaseTask$1),TimeoutTask_1=__importDefault$g(TimeoutTask$1),CheckAudioConnectivityFeedback_1=__importDefault$g(CheckAudioConnectivityFeedback),CheckAudioInputFeedback_1=__importDefault$g(CheckAudioInputFeedback),CheckAudioOutputFeedback_1=__importDefault$g(CheckAudioOutputFeedback),CheckCameraResolutionFeedback_1=__importDefault$g(CheckCameraResolutionFeedback),CheckContentShareConnectivityFeedback_1=__importDefault$g(CheckContentShareConnectivityFeedback),CheckNetworkTCPConnectivityFeedback_1=__importDefault$g(CheckNetworkTCPConnectivityFeedback),CheckNetworkUDPConnectivityFeedback_1=__importDefault$g(CheckNetworkUDPConnectivityFeedback),CheckVideoConnectivityFeedback_1=__importDefault$g(CheckVideoConnectivityFeedback),CheckVideoInputFeedback_1=__importDefault$g(CheckVideoInputFeedback),MeetingReadinessCheckerConfiguration_1=__importDefault$g(MeetingReadinessCheckerConfiguration$1);class DefaultMeetingReadinessChecker{constructor($,_,tt=new MeetingReadinessCheckerConfiguration_1.default){this.logger=$,this.meetingSession=_,this.configuration=tt,this.browserBehavior=new DefaultBrowserBehavior_1$2.default}static delay($){return __awaiter$f(this,void 0,void 0,function*(){return new Promise(_=>setTimeout(_,$))})}checkAudioInput($){return __awaiter$f(this,void 0,void 0,function*(){try{return yield this.meetingSession.audioVideo.startAudioInput($),yield this.meetingSession.audioVideo.stopAudioInput(),CheckAudioInputFeedback_1.default.Succeeded}catch(_){return this.logger.error(`MeetingReadinessChecker: Audio input check failed with error ${_}`),_ instanceof PermissionDeniedError_1.default?CheckAudioInputFeedback_1.default.PermissionDenied:CheckAudioInputFeedback_1.default.Failed}})}checkAudioOutput($,_,tt=null){return __awaiter$f(this,void 0,void 0,function*(){try{const nt=$?DefaultDeviceController_1.default.getIntrinsicDeviceId($):"";return yield this.playTone(nt,this.configuration.audioOutputFrequency,tt),(yield _())?CheckAudioOutputFeedback_1.default.Succeeded:CheckAudioOutputFeedback_1.default.Failed}catch(nt){return this.logger.error(`MeetingReadinessChecker: Audio output check failed with error: ${nt}`),CheckAudioOutputFeedback_1.default.Failed}finally{this.stopTone()}})}playTone($,_,tt){return __awaiter$f(this,void 0,void 0,function*(){const it=this.configuration.audioOutputGain;this.oscillatorNode&&this.stopTone(),this.audioContext=DefaultDeviceController_1.default.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=0,this.oscillatorNode=this.audioContext.createOscillator(),this.oscillatorNode.frequency.value=_,this.oscillatorNode.connect(this.gainNode),this.destinationStream=this.audioContext.createMediaStreamDestination(),this.gainNode.connect(this.destinationStream);const ot=this.audioContext.currentTime+.1;this.gainNode.gain.linearRampToValueAtTime(0,ot),this.gainNode.gain.linearRampToValueAtTime(it,ot+.1),this.oscillatorNode.start();const lt=new DefaultAudioMixController_1.default(this.logger);try{this.browserBehavior.supportsSetSinkId()&&(yield lt.bindAudioDevice({deviceId:$}))}catch(st){this.logger.error(`Failed to bind audio device: ${st}`)}try{yield lt.bindAudioElement(tt||new Audio)}catch(st){this.logger.error(`Failed to bind audio element: ${st}`)}yield lt.bindAudioStream(this.destinationStream.stream)})}stopTone(){if(!this.audioContext||!this.gainNode||!this.oscillatorNode||!this.destinationStream)return;const $=1,_=.1,tt=this.configuration.audioOutputGain,nt=this.audioContext.currentTime;this.gainNode.gain.linearRampToValueAtTime(tt,nt+_+$),this.gainNode.gain.linearRampToValueAtTime(0,nt+_*2+$),this.oscillatorNode.stop(),this.oscillatorNode.disconnect(this.gainNode),this.gainNode.disconnect(this.destinationStream),this.oscillatorNode=null,this.gainNode=null,this.destinationStream=null}checkVideoInput($){return __awaiter$f(this,void 0,void 0,function*(){try{return yield this.meetingSession.audioVideo.startVideoInput($),yield this.meetingSession.audioVideo.stopVideoInput(),CheckVideoInputFeedback_1.default.Succeeded}catch(_){return this.logger.error(`MeetingReadinessChecker: Video check failed with error ${_}`),_ instanceof PermissionDeniedError_1.default?CheckVideoInputFeedback_1.default.PermissionDenied:CheckVideoInputFeedback_1.default.Failed}})}checkCameraResolution($,_,tt){return __awaiter$f(this,void 0,void 0,function*(){let nt;try{const it=DefaultDeviceController_1.default.getIntrinsicDeviceId($),rt={video:this.calculateVideoConstraint(it,_,tt)};nt=yield navigator.mediaDevices.getUserMedia(rt)}catch(it){return this.logger.error(`MeetingReadinessChecker: Camera resolution check with width: ${_} height ${tt} failed with error ${it}`),it&&it.name==="OverconstrainedError"?CheckCameraResolutionFeedback_1.default.ResolutionNotSupported:it&&it.name==="NotAllowedError"?CheckCameraResolutionFeedback_1.default.PermissionDenied:CheckCameraResolutionFeedback_1.default.Failed}finally{nt&&nt.getTracks().forEach(function(it){it.stop()})}return CheckCameraResolutionFeedback_1.default.Succeeded})}calculateVideoConstraint($,_,tt){const nt=this.browserBehavior.requiresResolutionAlignment(_,tt),it={};return this.browserBehavior.requiresNoExactMediaStreamConstraints()?(it.deviceId=$,it.width=_,it.height=tt):(it.deviceId={exact:$},it.width={exact:nt[0]},it.height={exact:nt[1]}),it}checkContentShareConnectivity($){return __awaiter$f(this,void 0,void 0,function*(){let _=!1,tt=!1;const nt={contentShareDidStart:()=>{_=!0}},it={audioVideoDidStart:()=>{tt=!0}};try{return this.meetingSession.audioVideo.addObserver(it),this.meetingSession.audioVideo.start(),this.meetingSession.audioVideo.addContentShareObserver(nt),yield this.meetingSession.audioVideo.startContentShareFromScreenCapture($),yield this.executeTimeoutTask(()=>__awaiter$f(this,void 0,void 0,function*(){return tt&&_})),tt?(yield this.stopMeeting(),_?CheckContentShareConnectivityFeedback_1.default.Succeeded:CheckContentShareConnectivityFeedback_1.default.TimedOut):CheckContentShareConnectivityFeedback_1.default.ConnectionFailed}catch(rt){return this.logger.error(`MeetingReadinessChecker: Content share check failed with error ${rt}`),rt.name==="NotAllowedError"?CheckContentShareConnectivityFeedback_1.default.PermissionDenied:CheckContentShareConnectivityFeedback_1.default.Failed}finally{this.meetingSession.audioVideo.removeObserver(it),this.meetingSession.audioVideo.stopContentShare(),this.meetingSession.audioVideo.removeContentShareObserver(nt)}})}checkAudioConnectivity($){return __awaiter$f(this,void 0,void 0,function*(){let _=!1;const tt={packetsReceived:0},nt=this.meetingSession.audioVideo,it={metricsDidReceive(ot){ot.getRTCStatsReport().forEach(lt=>{lt.type==="inbound-rtp"&&(lt.mediaType==="audio"||lt.kind==="audio")&&(tt.packetsReceived=lt.packetsReceived)})}},rt=(ot,lt,st,at)=>{ot===this.meetingSession.configuration.credentials.attendeeId&&lt&&(_=!0)};try{yield nt.startAudioInput($)}catch(ot){return this.logger.error(`MeetingReadinessChecker: Failed to get audio input device with error ${ot}`),ot instanceof PermissionDeniedError_1.default?CheckAudioConnectivityFeedback_1.default.AudioInputPermissionDenied:CheckAudioConnectivityFeedback_1.default.AudioInputRequestFailed}return nt.realtimeSubscribeToAttendeeIdPresence(rt),nt.addObserver(it),(yield this.startMeeting())?(yield this.executeTimeoutTask(()=>__awaiter$f(this,void 0,void 0,function*(){return this.isAudioConnectionSuccessful(_,tt)})),nt.removeObserver(it),nt.realtimeUnsubscribeToAttendeeIdPresence(rt),yield this.stopMeeting(),yield this.meetingSession.audioVideo.stopAudioInput(),this.isAudioConnectionSuccessful(_,tt)?CheckAudioConnectivityFeedback_1.default.Succeeded:CheckAudioConnectivityFeedback_1.default.AudioNotReceived):(nt.removeObserver(it),nt.realtimeUnsubscribeToAttendeeIdPresence(rt),yield this.meetingSession.audioVideo.stopAudioInput(),CheckAudioConnectivityFeedback_1.default.ConnectionFailed)})}checkVideoConnectivity($){return __awaiter$f(this,void 0,void 0,function*(){const _=this.meetingSession.audioVideo;let tt=0;const nt={metricsDidReceive(it){it.getRTCStatsReport().forEach(ot=>{ot.type==="outbound-rtp"&&(ot.mediaType==="video"||ot.kind==="video")&&(tt=ot.packetsSent)})}};try{yield _.startVideoInput($)}catch(it){return this.logger.error(`MeetingReadinessChecker: Failed to get video input device with error ${it}`),it instanceof PermissionDeniedError_1.default?CheckVideoConnectivityFeedback_1.default.VideoInputPermissionDenied:CheckVideoConnectivityFeedback_1.default.VideoInputRequestFailed}return _.addObserver(nt),(yield this.startMeeting())?(_.startLocalVideoTile(),yield this.executeTimeoutTask(()=>__awaiter$f(this,void 0,void 0,function*(){return tt>0})),yield _.stopVideoInput(),yield this.stopMeeting(),_.removeObserver(nt),tt<=0?CheckVideoConnectivityFeedback_1.default.VideoNotSent:CheckVideoConnectivityFeedback_1.default.Succeeded):CheckVideoConnectivityFeedback_1.default.ConnectionFailed})}checkNetworkUDPConnectivity(){return __awaiter$f(this,void 0,void 0,function*(){let $=!1;const _={metricsDidReceive(nt){nt.getRTCStatsReport().forEach(rt=>{rt.type==="candidate-pair"&&rt.state==="succeeded"&&($=!0)})}};try{this.originalURLRewriter=this.meetingSession.configuration.urls.urlRewriter}catch(nt){return this.logger.error(`MeetingSessionConfiguration.urls doesn't exist. Error: ${nt}`),CheckNetworkUDPConnectivityFeedback_1.default.MeetingSessionURLsNotInitialized}this.meetingSession.configuration.urls.urlRewriter=nt=>{const it=this.originalURLRewriter(nt);return it.includes("transport=tcp")?"":it};const tt=this.meetingSession.audioVideo;return tt.addObserver(_),(yield this.startMeeting())?(yield this.executeTimeoutTask(()=>__awaiter$f(this,void 0,void 0,function*(){return $})),this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,yield this.stopMeeting(),tt.removeObserver(_),$?CheckNetworkUDPConnectivityFeedback_1.default.Succeeded:CheckNetworkUDPConnectivityFeedback_1.default.ICENegotiationFailed):(this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,CheckNetworkUDPConnectivityFeedback_1.default.ConnectionFailed)})}checkNetworkTCPConnectivity(){return __awaiter$f(this,void 0,void 0,function*(){let $=!1;const _={metricsDidReceive(nt){nt.getRTCStatsReport().forEach(rt=>{rt.type==="candidate-pair"&&rt.state==="succeeded"&&($=!0)})}};try{this.originalURLRewriter=this.meetingSession.configuration.urls.urlRewriter}catch(nt){return this.logger.error(`MeetingSessionConfiguration.urls doesn't exist. Error: ${nt}`),CheckNetworkTCPConnectivityFeedback_1.default.MeetingSessionURLsNotInitialized}this.meetingSession.configuration.urls.urlRewriter=nt=>{const it=this.originalURLRewriter(nt);return it.includes("transport=udp")?"":it};const tt=this.meetingSession.audioVideo;return tt.addObserver(_),(yield this.startMeeting())?(yield this.executeTimeoutTask(()=>__awaiter$f(this,void 0,void 0,function*(){return $})),this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,yield this.stopMeeting(),tt.removeObserver(_),$?CheckNetworkTCPConnectivityFeedback_1.default.Succeeded:CheckNetworkTCPConnectivityFeedback_1.default.ICENegotiationFailed):(this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,CheckNetworkTCPConnectivityFeedback_1.default.ConnectionFailed)})}startMeeting(){return __awaiter$f(this,void 0,void 0,function*(){let $=!1;const _={audioVideoDidStart:()=>{$=!0}};return this.meetingSession.audioVideo.addObserver(_),this.meetingSession.audioVideo.start(),yield this.executeTimeoutTask(()=>__awaiter$f(this,void 0,void 0,function*(){return $})),this.meetingSession.audioVideo.removeObserver(_),$})}stopMeeting(){return __awaiter$f(this,void 0,void 0,function*(){let $=!1;const _={audioVideoDidStop:tt=>{$=!0}};return this.meetingSession.audioVideo.addObserver(_),this.meetingSession.audioVideo.stop(),yield this.executeTimeoutTask(()=>__awaiter$f(this,void 0,void 0,function*(){return $})),this.meetingSession.audioVideo.removeObserver(_),$})}executeTimeoutTask($){return __awaiter$f(this,void 0,void 0,function*(){let _=!1;class tt extends BaseTask_1$1.default{constructor(rt,ot){super(rt),this.waitDurationMs=ot,this.isCancelled=!1}cancel(){this.isCancelled=!0}run(){return __awaiter$f(this,void 0,void 0,function*(){for(;!this.isCancelled;){if(yield $()){_=!0;break}yield DefaultMeetingReadinessChecker.delay(this.waitDurationMs)}})}}return yield new TimeoutTask_1.default(this.logger,new tt(this.logger,this.configuration.waitDurationMs),this.configuration.timeoutMs).run(),_})}isAudioConnectionSuccessful($,_){return $&&_.packetsReceived>0}}DefaultMeetingReadinessChecker$1.default=DefaultMeetingReadinessChecker;var DefaultMeetingSession={},DefaultReconnectController$1={},__importDefault$f=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultReconnectController$1,"__esModule",{value:!0});const TimeoutScheduler_1=__importDefault$f(TimeoutScheduler$1);class DefaultReconnectController{constructor($,_){this.reconnectTimeoutMs=$,this.backoffPolicy=_,this.shouldReconnect=!0,this.onlyRestartPeerConnection=!1,this.firstConnectionAttempted=!1,this.firstConnectionAttemptTimestampMs=0,this.lastActiveTimestampMs=1/0,this._isFirstConnection=!0,this.backoffTimer=null,this.backoffCancel=null,this.reset()}timeSpentReconnectingMs(){return this.firstConnectionAttempted?Date.now()-this.firstConnectionAttemptTimestampMs:0}hasPastReconnectDeadline(){return Date.now()-this.lastActiveTimestampMs>=this.reconnectTimeoutMs?!0:this.timeSpentReconnectingMs()>=this.reconnectTimeoutMs}reset(){this.cancel(),this.shouldReconnect=!0,this.onlyRestartPeerConnection=!1,this.firstConnectionAttempted=!1,this.firstConnectionAttemptTimestampMs=0,this.lastActiveTimestampMs=1/0,this.backoffPolicy.reset()}startedConnectionAttempt($){this._isFirstConnection=$,this.firstConnectionAttempted||(this.firstConnectionAttempted=!0,this.firstConnectionAttemptTimestampMs=Date.now())}hasStartedConnectionAttempt(){return this.firstConnectionAttempted}isFirstConnection(){return this._isFirstConnection}disableReconnect(){this.shouldReconnect=!1}enableRestartPeerConnection(){this.onlyRestartPeerConnection=!0}cancel(){this.disableReconnect(),this.backoffTimer&&(this.backoffTimer.stop(),this.backoffCancel&&(this.backoffCancel(),this.backoffCancel=null))}retryWithBackoff($,_){const tt=this.shouldReconnect&&!this.hasPastReconnectDeadline();return tt&&(this.backoffCancel=_,this.backoffTimer=new TimeoutScheduler_1.default(this.backoffPolicy.nextBackoffAmountMs()),this.backoffTimer.start(()=>{this.backoffCancel=null,$()})),tt}shouldOnlyRestartPeerConnection(){return this.onlyRestartPeerConnection}clone(){return new DefaultReconnectController(this.reconnectTimeoutMs,this.backoffPolicy)}setLastActiveTimestampMs($){this.lastActiveTimestampMs=$}}DefaultReconnectController$1.default=DefaultReconnectController;var DefaultWebSocketAdapter$1={},__importDefault$e=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultWebSocketAdapter$1,"__esModule",{value:!0});const Versioning_1$3=__importDefault$e(Versioning$1),WebSocketReadyState_1$1=__importDefault$e(WebSocketReadyState);class DefaultWebSocketAdapter{constructor($){this.logger=$}create($,_,tt){this.connection=new WebSocket(tt?$:Versioning_1$3.default.urlWithVersion($),_),this.connection.binaryType="arraybuffer"}send($){if(!this.connection)return this.logger.error("WebSocket not yet created or already destroyed."),!1;try{return $ instanceof Uint8Array?this.connection.send($.buffer):this.connection.send($),!0}catch(_){return this.logger.debug(()=>`send error: ${_.message}, websocket state=${WebSocketReadyState_1$1.default[this.readyState()]}`),!1}}close($,_){var tt;(tt=this.connection)===null||tt===void 0||tt.close($,_)}destroy(){this.connection=void 0}addEventListener($,_){if(!this.connection){this.logger.warn("Cannot add event listener with no WebSocket connection.");return}this.connection.addEventListener($,_)}removeEventListener($,_){var tt;(tt=this.connection)===null||tt===void 0||tt.removeEventListener($,_)}readyState(){if(!this.connection)return WebSocketReadyState_1$1.default.None;switch(this.connection.readyState){case WebSocket.CONNECTING:return WebSocketReadyState_1$1.default.Connecting;case WebSocket.OPEN:return WebSocketReadyState_1$1.default.Open;case WebSocket.CLOSING:return WebSocketReadyState_1$1.default.Closing;case WebSocket.CLOSED:return WebSocketReadyState_1$1.default.Closed}}}DefaultWebSocketAdapter$1.default=DefaultWebSocketAdapter;var hasRequiredDefaultMeetingSession;function requireDefaultMeetingSession(){if(hasRequiredDefaultMeetingSession)return DefaultMeetingSession;hasRequiredDefaultMeetingSession=1;var et=commonjsGlobal&&commonjsGlobal.__awaiter||function(ft,pt,St,gt){function yt(vt){return vt instanceof St?vt:new St(function(Ct){Ct(vt)})}return new(St||(St=Promise))(function(vt,Ct){function Et(At){try{Rt(gt.next(At))}catch(Dt){Ct(Dt)}}function Mt(At){try{Rt(gt.throw(At))}catch(Dt){Ct(Dt)}}function Rt(At){At.done?vt(At.value):yt(At.value).then(Et,Mt)}Rt((gt=gt.apply(ft,pt||[])).next())})},$=commonjsGlobal&&commonjsGlobal.__importDefault||function(ft){return ft&&ft.__esModule?ft:{default:ft}};Object.defineProperty(DefaultMeetingSession,"__esModule",{value:!0});const _=$(requireDefaultAudioVideoController()),tt=$(DefaultAudioVideoFacade$1),nt=$(FullJitterBackoff$1),it=$(DefaultBrowserBehavior$1),rt=$(ContentShareMediaStreamBroker$1),ot=$(DefaultContentShareController$1),lt=$(CSPMonitor$1),st=Destroyable,at=$(DefaultEventController$1),ct=$(DefaultReconnectController$1),dt=$(DefaultWebSocketAdapter$1);let ut=class{constructor(pt,St,gt,yt){this._eventController=yt,this._configuration=pt,this._logger=St,this.checkBrowserSupportAndFeatureConfiguration(),lt.default.addLogger(this._logger),lt.default.register(),this._eventController||(this._eventController=new at.default(pt,St)),gt.eventController||(gt.eventController=this.eventController),this.audioVideoController=new _.default(this._configuration,this._logger,new dt.default(this._logger),gt,new ct.default(this._configuration.reconnectTimeoutMs,new nt.default(this._configuration.reconnectFixedWaitMs,this._configuration.reconnectShortBackOffMs,this._configuration.reconnectLongBackOffMs)),this.eventController),this._deviceController=gt,this.logger.info(`MeetingFeatures: ${JSON.stringify(pt.meetingFeatures)}`);const vt=new rt.default(this._logger);this.contentShareController=new ot.default(vt,new _.default(ot.default.createContentShareMeetingSessionConfigure(this._configuration),this._logger,new dt.default(this._logger),vt,new ct.default(this._configuration.reconnectTimeoutMs,new nt.default(this._configuration.reconnectFixedWaitMs,this._configuration.reconnectShortBackOffMs,this._configuration.reconnectLongBackOffMs))),this.audioVideoController),this.audioVideoFacade=new tt.default(this.audioVideoController,this.audioVideoController.videoTileController,this.audioVideoController.realtimeController,this.audioVideoController.audioMixController,this._deviceController,this.contentShareController)}get configuration(){return this._configuration}get logger(){return this._logger}get audioVideo(){return this.audioVideoFacade}get contentShare(){return this.contentShareController}get deviceController(){return this._deviceController}get eventController(){return this._eventController}destroy(){return et(this,void 0,void 0,function*(){st.isDestroyable(this.contentShareController)&&(yield this.contentShareController.destroy()),st.isDestroyable(this.audioVideoController)&&(yield this.audioVideoController.destroy()),st.isDestroyable(this.eventController)&&(yield this.eventController.destroy()),lt.default.removeLogger(this._logger),this._logger=void 0,this._configuration=void 0,this._deviceController=void 0,this.audioVideoFacade=void 0,this.audioVideoController=void 0,this.contentShareController=void 0,this._eventController=void 0})}checkBrowserSupportAndFeatureConfiguration(){const pt=new it.default,St=`${pt.name()} ${pt.majorVersion()} (${pt.version()})`;if(this.logger.info(`browser is ${St}`),pt.isSupported()||this.logger.warn(`this browser is not currently supported. Stability may suffer. Supported browsers are: ${pt.supportString()}.`),this._configuration.videoUplinkBandwidthPolicy)if(this.isSimulcastUplinkPolicy(this._configuration.videoUplinkBandwidthPolicy)){if(!pt.hasChromiumWebRTC())throw new Error("Simulcast is only supported on Chromium-based browsers");this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!0}else this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1;this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers&&(pt.hasChromiumWebRTC()?this.logger.info(`Simulcast is enabled for ${pt.name()}`):(this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.logger.info("Simulcast is only supported on Chromium-based browsers")),this._configuration.enableSVC&&(this._configuration.enableSVC=!1,this.logger.info("SVC is not successfully enabled since simulcast is enabled"))),this._configuration.enableSVC&&!pt.supportsScalableVideoCoding()&&(this._configuration.enableSVC=!1,this.logger.info("SVC is only supported on Chromium-based browsers with version 111 or above"))}isSimulcastUplinkPolicy(pt){return!!(pt&&pt.addObserver)}};return DefaultMeetingSession.default=ut,DefaultMeetingSession}var DefaultMessagingSession$1={};const getHttpHandlerExtensionConfiguration=et=>({setHttpHandler($){et.httpHandler=$},httpHandler(){return et.httpHandler},updateHttpClientConfig($,_){var tt;(tt=et.httpHandler)==null||tt.updateHttpClientConfig($,_)},httpHandlerConfigs(){return et.httpHandler.httpHandlerConfigs()}}),resolveHttpHandlerRuntimeConfig=et=>({httpHandler:et.httpHandler()});var EndpointURLScheme;(function(et){et.HTTP="http",et.HTTPS="https"})(EndpointURLScheme||(EndpointURLScheme={}));var AlgorithmId;(function(et){et.MD5="md5",et.CRC32="crc32",et.CRC32C="crc32c",et.SHA1="sha1",et.SHA256="sha256"})(AlgorithmId||(AlgorithmId={}));const SMITHY_CONTEXT_KEY="__smithy_context";class HttpRequest{constructor($){Pt(this,"method");Pt(this,"protocol");Pt(this,"hostname");Pt(this,"port");Pt(this,"path");Pt(this,"query");Pt(this,"headers");Pt(this,"username");Pt(this,"password");Pt(this,"fragment");Pt(this,"body");this.method=$.method||"GET",this.hostname=$.hostname||"localhost",this.port=$.port,this.query=$.query||{},this.headers=$.headers||{},this.body=$.body,this.protocol=$.protocol?$.protocol.slice(-1)!==":"?`${$.protocol}:`:$.protocol:"https:",this.path=$.path?$.path.charAt(0)!=="/"?`/${$.path}`:$.path:"/",this.username=$.username,this.password=$.password,this.fragment=$.fragment}static clone($){const _=new HttpRequest({...$,headers:{...$.headers}});return _.query&&(_.query=cloneQuery(_.query)),_}static isInstance($){if(!$)return!1;const _=$;return"method"in _&&"protocol"in _&&"hostname"in _&&"path"in _&&typeof _.query=="object"&&typeof _.headers=="object"}clone(){return HttpRequest.clone(this)}}function cloneQuery(et){return Object.keys(et).reduce(($,_)=>{const tt=et[_];return{...$,[_]:Array.isArray(tt)?[...tt]:tt}},{})}class HttpResponse{constructor($){Pt(this,"statusCode");Pt(this,"reason");Pt(this,"headers");Pt(this,"body");this.statusCode=$.statusCode,this.reason=$.reason,this.headers=$.headers||{},this.body=$.body}static isInstance($){if(!$)return!1;const _=$;return typeof _.statusCode=="number"&&typeof _.headers=="object"}}function resolveHostHeaderConfig(et){return et}const hostHeaderMiddleware=et=>$=>async _=>{if(!HttpRequest.isInstance(_.request))return $(_);const{request:tt}=_,{handlerProtocol:nt=""}=et.requestHandler.metadata||{};if(nt.indexOf("h2")>=0&&!tt.headers[":authority"])delete tt.headers.host,tt.headers[":authority"]=tt.hostname+(tt.port?":"+tt.port:"");else if(!tt.headers.host){let it=tt.hostname;tt.port!=null&&(it+=`:${tt.port}`),tt.headers.host=it}return $(_)},hostHeaderMiddlewareOptions={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},getHostHeaderPlugin=et=>({applyToStack:$=>{$.add(hostHeaderMiddleware(et),hostHeaderMiddlewareOptions)}}),loggerMiddleware=()=>(et,$)=>async _=>{var tt,nt;try{const it=await et(_),{clientName:rt,commandName:ot,logger:lt,dynamoDbDocumentClientOptions:st={}}=$,{overrideInputFilterSensitiveLog:at,overrideOutputFilterSensitiveLog:ct}=st,dt=at??$.inputFilterSensitiveLog,ut=ct??$.outputFilterSensitiveLog,{$metadata:ft,...pt}=it.output;return(tt=lt==null?void 0:lt.info)==null||tt.call(lt,{clientName:rt,commandName:ot,input:dt(_.input),output:ut(pt),metadata:ft}),it}catch(it){const{clientName:rt,commandName:ot,logger:lt,dynamoDbDocumentClientOptions:st={}}=$,{overrideInputFilterSensitiveLog:at}=st,ct=at??$.inputFilterSensitiveLog;throw(nt=lt==null?void 0:lt.error)==null||nt.call(lt,{clientName:rt,commandName:ot,input:ct(_.input),error:it,metadata:it.$metadata}),it}},loggerMiddlewareOptions={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},getLoggerPlugin=et=>({applyToStack:$=>{$.add(loggerMiddleware(),loggerMiddlewareOptions)}}),recursionDetectionMiddlewareOptions={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},recursionDetectionMiddleware=()=>et=>async $=>et($),getRecursionDetectionPlugin=et=>({applyToStack:$=>{$.add(recursionDetectionMiddleware(),recursionDetectionMiddlewareOptions)}}),getSmithyContext=et=>et[SMITHY_CONTEXT_KEY]||(et[SMITHY_CONTEXT_KEY]={}),normalizeProvider$1=et=>{if(typeof et=="function")return et;const $=Promise.resolve(et);return()=>$},resolveAuthOptions=(et,$)=>{if(!$||$.length===0)return et;const _=[];for(const tt of $)for(const nt of et)nt.schemeId.split("#")[1]===tt&&_.push(nt);for(const tt of et)_.find(({schemeId:nt})=>nt===tt.schemeId)||_.push(tt);return _};function convertHttpAuthSchemesToMap(et){const $=new Map;for(const _ of et)$.set(_.schemeId,_);return $}const httpAuthSchemeMiddleware=(et,$)=>(_,tt)=>async nt=>{var ct;const it=et.httpAuthSchemeProvider(await $.httpAuthSchemeParametersProvider(et,tt,nt.input)),rt=et.authSchemePreference?await et.authSchemePreference():[],ot=resolveAuthOptions(it,rt),lt=convertHttpAuthSchemesToMap(et.httpAuthSchemes),st=getSmithyContext(tt),at=[];for(const dt of ot){const ut=lt.get(dt.schemeId);if(!ut){at.push(`HttpAuthScheme \`${dt.schemeId}\` was not enabled for this service.`);continue}const ft=ut.identityProvider(await $.identityProviderConfigProvider(et));if(!ft){at.push(`HttpAuthScheme \`${dt.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:pt={},signingProperties:St={}}=((ct=dt.propertiesExtractor)==null?void 0:ct.call(dt,et,tt))||{};dt.identityProperties=Object.assign(dt.identityProperties||{},pt),dt.signingProperties=Object.assign(dt.signingProperties||{},St),st.selectedHttpAuthScheme={httpAuthOption:dt,identity:await ft(dt.identityProperties),signer:ut.signer};break}if(!st.selectedHttpAuthScheme)throw new Error(at.join(`
`));return _(nt)},httpAuthSchemeEndpointRuleSetMiddlewareOptions={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},getHttpAuthSchemeEndpointRuleSetPlugin=(et,{httpAuthSchemeParametersProvider:$,identityProviderConfigProvider:_})=>({applyToStack:tt=>{tt.addRelativeTo(httpAuthSchemeMiddleware(et,{httpAuthSchemeParametersProvider:$,identityProviderConfigProvider:_}),httpAuthSchemeEndpointRuleSetMiddlewareOptions)}}),serializerMiddlewareOption$1={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0},defaultErrorHandler=et=>$=>{throw $},defaultSuccessHandler=(et,$)=>{},httpSigningMiddleware=et=>($,_)=>async tt=>{if(!HttpRequest.isInstance(tt.request))return $(tt);const it=getSmithyContext(_).selectedHttpAuthScheme;if(!it)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:rt={}},identity:ot,signer:lt}=it,st=await $({...tt,request:await lt.sign(tt.request,ot,rt)}).catch((lt.errorHandler||defaultErrorHandler)(rt));return(lt.successHandler||defaultSuccessHandler)(st.response,rt),st},httpSigningMiddlewareOptions={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},getHttpSigningPlugin=et=>({applyToStack:$=>{$.addRelativeTo(httpSigningMiddleware(),httpSigningMiddlewareOptions)}}),normalizeProvider=et=>{if(typeof et=="function")return et;const $=Promise.resolve(et);return()=>$},makePagedClientRequest=async(et,$,_,tt=it=>it,...nt)=>{let it=new et(_);return it=tt(it)??it,await $.send(it,...nt)};function createPaginator(et,$,_,tt,nt){return async function*(rt,ot,...lt){const st=ot;let at=rt.startingToken??st[_],ct=!0,dt;for(;ct;){if(st[_]=at,nt&&(st[nt]=st[nt]??rt.pageSize),rt.client instanceof et)dt=await makePagedClientRequest($,rt.client,ot,rt.withCommand,...lt);else throw new Error(`Invalid client, expected instance of ${et.name}`);yield dt;const ut=at;at=get(dt,tt),ct=!!(at&&(!rt.stopOnSameToken||at!==ut))}return void 0}}const get=(et,$)=>{let _=et;const tt=$.split(".");for(const nt of tt){if(!_||typeof _!="object")return;_=_[nt]}return _},chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",alphabetByEncoding=Object.entries(chars).reduce((et,[$,_])=>(et[_]=Number($),et),{}),alphabetByValue=chars.split(""),bitsPerLetter=6,bitsPerByte=8,maxLetterValue=63,fromBase64=et=>{let $=et.length/4*3;et.slice(-2)==="=="?$-=2:et.slice(-1)==="="&&$--;const _=new ArrayBuffer($),tt=new DataView(_);for(let nt=0;nt<et.length;nt+=4){let it=0,rt=0;for(let st=nt,at=nt+3;st<=at;st++)if(et[st]!=="="){if(!(et[st]in alphabetByEncoding))throw new TypeError(`Invalid character ${et[st]} in base64 string.`);it|=alphabetByEncoding[et[st]]<<(at-st)*bitsPerLetter,rt+=bitsPerLetter}else it>>=bitsPerLetter;const ot=nt/4*3;it>>=rt%bitsPerByte;const lt=Math.floor(rt/bitsPerByte);for(let st=0;st<lt;st++){const at=(lt-st-1)*bitsPerByte;tt.setUint8(ot+st,(it&255<<at)>>at)}}return new Uint8Array(_)},fromUtf8$2=et=>new TextEncoder().encode(et),toUint8Array=et=>typeof et=="string"?fromUtf8$2(et):ArrayBuffer.isView(et)?new Uint8Array(et.buffer,et.byteOffset,et.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(et),toUtf8=et=>{if(typeof et=="string")return et;if(typeof et!="object"||typeof et.byteOffset!="number"||typeof et.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(et)};function toBase64(et){let $;typeof et=="string"?$=fromUtf8$2(et):$=et;const _=typeof $=="object"&&typeof $.length=="number",tt=typeof $=="object"&&typeof $.byteOffset=="number"&&typeof $.byteLength=="number";if(!_&&!tt)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let nt="";for(let it=0;it<$.length;it+=3){let rt=0,ot=0;for(let st=it,at=Math.min(it+3,$.length);st<at;st++)rt|=$[st]<<(at-st-1)*bitsPerByte,ot+=bitsPerByte;const lt=Math.ceil(ot/bitsPerLetter);rt<<=lt*bitsPerLetter-ot;for(let st=1;st<=lt;st++){const at=(lt-st)*bitsPerLetter;nt+=alphabetByValue[(rt&maxLetterValue<<at)>>at]}nt+="==".slice(0,4-lt)}return nt}class Uint8ArrayBlobAdapter extends Uint8Array{static fromString($,_="utf-8"){if(typeof $=="string")return _==="base64"?Uint8ArrayBlobAdapter.mutate(fromBase64($)):Uint8ArrayBlobAdapter.mutate(fromUtf8$2($));throw new Error(`Unsupported conversion from ${typeof $} to Uint8ArrayBlobAdapter.`)}static mutate($){return Object.setPrototypeOf($,Uint8ArrayBlobAdapter.prototype),$}transformToString($="utf-8"){return $==="base64"?toBase64(this):toUtf8(this)}}const isReadableStream=et=>{var $;return typeof ReadableStream=="function"&&((($=et==null?void 0:et.constructor)==null?void 0:$.name)===ReadableStream.name||et instanceof ReadableStream)},escapeUri=et=>encodeURIComponent(et).replace(/[!'()*]/g,hexEncode),hexEncode=et=>`%${et.charCodeAt(0).toString(16).toUpperCase()}`;function buildQueryString(et){const $=[];for(let _ of Object.keys(et).sort()){const tt=et[_];if(_=escapeUri(_),Array.isArray(tt))for(let nt=0,it=tt.length;nt<it;nt++)$.push(`${_}=${escapeUri(tt[nt])}`);else{let nt=_;(tt||typeof tt=="string")&&(nt+=`=${escapeUri(tt)}`),$.push(nt)}}return $.join("&")}function createRequest(et,$){return new Request(et,$)}function requestTimeout(et=0){return new Promise(($,_)=>{et&&setTimeout(()=>{const tt=new Error(`Request did not complete within ${et} ms`);tt.name="TimeoutError",_(tt)},et)})}const keepAliveSupport={supported:void 0};class FetchHttpHandler{constructor($){Pt(this,"config");Pt(this,"configProvider");typeof $=="function"?this.configProvider=$().then(_=>_||{}):(this.config=$??{},this.configProvider=Promise.resolve(this.config)),keepAliveSupport.supported===void 0&&(keepAliveSupport.supported=typeof Request<"u"&&"keepalive"in createRequest("https://[::1]"))}static create($){return typeof($==null?void 0:$.handle)=="function"?$:new FetchHttpHandler($)}destroy(){}async handle($,{abortSignal:_,requestTimeout:tt}={}){var yt;this.config||(this.config=await this.configProvider);const nt=tt??this.config.requestTimeout,it=this.config.keepAlive===!0,rt=this.config.credentials;if(_!=null&&_.aborted){const vt=new Error("Request aborted");return vt.name="AbortError",Promise.reject(vt)}let ot=$.path;const lt=buildQueryString($.query||{});lt&&(ot+=`?${lt}`),$.fragment&&(ot+=`#${$.fragment}`);let st="";if($.username!=null||$.password!=null){const vt=$.username??"",Ct=$.password??"";st=`${vt}:${Ct}@`}const{port:at,method:ct}=$,dt=`${$.protocol}//${st}${$.hostname}${at?`:${at}`:""}${ot}`,ut=ct==="GET"||ct==="HEAD"?void 0:$.body,ft={body:ut,headers:new Headers($.headers),method:ct,credentials:rt};(yt=this.config)!=null&&yt.cache&&(ft.cache=this.config.cache),ut&&(ft.duplex="half"),typeof AbortController<"u"&&(ft.signal=_),keepAliveSupport.supported&&(ft.keepalive=it),typeof this.config.requestInit=="function"&&Object.assign(ft,this.config.requestInit($));let pt=()=>{};const St=createRequest(dt,ft),gt=[fetch(St).then(vt=>{const Ct=vt.headers,Et={};for(const Rt of Ct.entries())Et[Rt[0]]=Rt[1];return vt.body!=null?{response:new HttpResponse({headers:Et,reason:vt.statusText,statusCode:vt.status,body:vt.body})}:vt.blob().then(Rt=>({response:new HttpResponse({headers:Et,reason:vt.statusText,statusCode:vt.status,body:Rt})}))}),requestTimeout(nt)];return _&&gt.push(new Promise((vt,Ct)=>{const Et=()=>{const Mt=new Error("Request aborted");Mt.name="AbortError",Ct(Mt)};if(typeof _.addEventListener=="function"){const Mt=_;Mt.addEventListener("abort",Et,{once:!0}),pt=()=>Mt.removeEventListener("abort",Et)}else _.onabort=Et})),Promise.race(gt).finally(pt)}updateHttpClientConfig($,_){this.config=void 0,this.configProvider=this.configProvider.then(tt=>(tt[$]=_,tt))}httpHandlerConfigs(){return this.config??{}}}const streamCollector=async et=>{var $;return typeof Blob=="function"&&et instanceof Blob||(($=et.constructor)==null?void 0:$.name)==="Blob"?Blob.prototype.arrayBuffer!==void 0?new Uint8Array(await et.arrayBuffer()):collectBlob(et):collectStream(et)};async function collectBlob(et){const $=await readToBase64(et),_=fromBase64($);return new Uint8Array(_)}async function collectStream(et){const $=[],_=et.getReader();let tt=!1,nt=0;for(;!tt;){const{done:ot,value:lt}=await _.read();lt&&($.push(lt),nt+=lt.length),tt=ot}const it=new Uint8Array(nt);let rt=0;for(const ot of $)it.set(ot,rt),rt+=ot.length;return it}function readToBase64(et){return new Promise(($,_)=>{const tt=new FileReader;tt.onloadend=()=>{if(tt.readyState!==2)return _(new Error("Reader aborted too early"));const nt=tt.result??"",it=nt.indexOf(","),rt=it>-1?it+1:nt.length;$(nt.substring(rt))},tt.onabort=()=>_(new Error("Read aborted")),tt.onerror=()=>_(tt.error),tt.readAsDataURL(et)})}const SHORT_TO_HEX$1={},HEX_TO_SHORT$1={};for(let et=0;et<256;et++){let $=et.toString(16).toLowerCase();$.length===1&&($=`0${$}`),SHORT_TO_HEX$1[et]=$,HEX_TO_SHORT$1[$]=et}function fromHex$1(et){if(et.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const $=new Uint8Array(et.length/2);for(let _=0;_<et.length;_+=2){const tt=et.slice(_,_+2).toLowerCase();if(tt in HEX_TO_SHORT$1)$[_/2]=HEX_TO_SHORT$1[tt];else throw new Error(`Cannot decode unrecognized sequence ${tt} as hexadecimal`)}return $}function toHex$1(et){let $="";for(let _=0;_<et.byteLength;_++)$+=SHORT_TO_HEX$1[et[_]];return $}const ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED="The stream has already been transformed.",sdkStreamMixin=et=>{var nt,it;if(!isBlobInstance(et)&&!isReadableStream(et)){const rt=((it=(nt=et==null?void 0:et.__proto__)==null?void 0:nt.constructor)==null?void 0:it.name)||et;throw new Error(`Unexpected stream implementation, expect Blob or ReadableStream, got ${rt}`)}let $=!1;const _=async()=>{if($)throw new Error(ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED);return $=!0,await streamCollector(et)},tt=rt=>{if(typeof rt.stream!="function")throw new Error(`Cannot transform payload Blob to web stream. Please make sure the Blob.stream() is polyfilled.
If you are using React Native, this API is not yet supported, see: https://react-native.canny.io/feature-requests/p/fetch-streaming-body`);return rt.stream()};return Object.assign(et,{transformToByteArray:_,transformToString:async rt=>{const ot=await _();if(rt==="base64")return toBase64(ot);if(rt==="hex")return toHex$1(ot);if(rt===void 0||rt==="utf8"||rt==="utf-8")return toUtf8(ot);if(typeof TextDecoder=="function")return new TextDecoder(rt).decode(ot);throw new Error("TextDecoder is not available, please make sure polyfill is provided.")},transformToWebStream:()=>{if($)throw new Error(ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED);if($=!0,isBlobInstance(et))return tt(et);if(isReadableStream(et))return et;throw new Error(`Cannot transform payload to web stream, got ${et}`)}})},isBlobInstance=et=>typeof Blob=="function"&&et instanceof Blob,collectBody=async(et=new Uint8Array,$)=>{if(et instanceof Uint8Array)return Uint8ArrayBlobAdapter.mutate(et);if(!et)return Uint8ArrayBlobAdapter.mutate(new Uint8Array);const _=$.streamCollector(et);return Uint8ArrayBlobAdapter.mutate(await _)};function extendedEncodeURIComponent(et){return encodeURIComponent(et).replace(/[!'()*]/g,function($){return"%"+$.charCodeAt(0).toString(16).toUpperCase()})}const deref=et=>typeof et=="function"?et():et,operation=(et,$,_,tt,nt)=>({name:$,namespace:et,traits:_,input:tt,output:nt}),schemaDeserializationMiddleware=et=>($,_)=>async tt=>{var ct,dt,ut,ft;const{response:nt}=await $(tt),{operationSchema:it}=getSmithyContext(_),[,rt,ot,lt,st,at]=it??[];try{const pt=await et.protocol.deserializeResponse(operation(rt,ot,lt,st,at),{...et,..._},nt);return{response:nt,output:pt}}catch(pt){if(Object.defineProperty(pt,"$response",{value:nt,enumerable:!1,writable:!1,configurable:!1}),!("$metadata"in pt)){const St="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";try{pt.message+=`
  `+St}catch{!_.logger||((dt=(ct=_.logger)==null?void 0:ct.constructor)==null?void 0:dt.name)==="NoOpLogger"?console.warn(St):(ft=(ut=_.logger)==null?void 0:ut.warn)==null||ft.call(ut,St)}typeof pt.$responseBodyText<"u"&&pt.$response&&(pt.$response.body=pt.$responseBodyText);try{if(HttpResponse.isInstance(nt)){const{headers:gt={}}=nt,yt=Object.entries(gt);pt.$metadata={httpStatusCode:nt.statusCode,requestId:findHeader(/^x-[\w-]+-request-?id$/,yt),extendedRequestId:findHeader(/^x-[\w-]+-id-2$/,yt),cfId:findHeader(/^x-[\w-]+-cf-id$/,yt)}}}catch{}}throw pt}},findHeader=(et,$)=>($.find(([_])=>_.match(et))||[void 0,void 0])[1],schemaSerializationMiddleware=et=>($,_)=>async tt=>{var dt;const{operationSchema:nt}=getSmithyContext(_),[,it,rt,ot,lt,st]=nt??[],at=(dt=_.endpointV2)!=null&&dt.url&&et.urlParser?async()=>et.urlParser(_.endpointV2.url):et.endpoint,ct=await et.protocol.serializeRequest(operation(it,rt,ot,lt,st),tt.input,{...et,..._,endpoint:at});return $({...tt,request:ct})},deserializerMiddlewareOption={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},serializerMiddlewareOption={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function getSchemaSerdePlugin(et){return{applyToStack:$=>{$.add(schemaSerializationMiddleware(et),serializerMiddlewareOption),$.add(schemaDeserializationMiddleware(et),deserializerMiddlewareOption),et.protocol.setSerdeContext(et)}}}function translateTraits(et){if(typeof et=="object")return et;et=et|0;const $={};let _=0;for(const tt of["httpLabel","idempotent","idempotencyToken","sensitive","httpPayload","httpResponseCode","httpQueryParams"])(et>>_++&1)===1&&($[tt]=1);return $}const Un=class Un{constructor($,_){Pt(this,"ref");Pt(this,"memberName");Pt(this,"symbol",Un.symbol);Pt(this,"name");Pt(this,"schema");Pt(this,"_isMemberSchema");Pt(this,"traits");Pt(this,"memberTraits");Pt(this,"normalizedTraits");this.ref=$,this.memberName=_;const tt=[];let nt=$,it=$;for(this._isMemberSchema=!1;isMemberSchema(nt);)tt.push(nt[1]),nt=nt[0],it=deref(nt),this._isMemberSchema=!0;if(tt.length>0){this.memberTraits={};for(let rt=tt.length-1;rt>=0;--rt){const ot=tt[rt];Object.assign(this.memberTraits,translateTraits(ot))}}else this.memberTraits=0;if(it instanceof Un){const rt=this.memberTraits;Object.assign(this,it),this.memberTraits=Object.assign({},rt,it.getMemberTraits(),this.getMemberTraits()),this.normalizedTraits=void 0,this.memberName=_??it.memberName;return}if(this.schema=deref(it),isStaticSchema(this.schema)?(this.name=`${this.schema[1]}#${this.schema[2]}`,this.traits=this.schema[3]):(this.name=this.memberName??String(it),this.traits=0),this._isMemberSchema&&!_)throw new Error(`@smithy/core/schema - NormalizedSchema member init ${this.getName(!0)} missing member name.`)}static[Symbol.hasInstance]($){const _=this.prototype.isPrototypeOf($);return!_&&typeof $=="object"&&$!==null?$.symbol===this.symbol:_}static of($){const _=deref($);if(_ instanceof Un)return _;if(isMemberSchema(_)){const[tt,nt]=_;if(tt instanceof Un)return Object.assign(tt.getMergedTraits(),translateTraits(nt)),tt;throw new Error(`@smithy/core/schema - may not init unwrapped member schema=${JSON.stringify($,null,2)}.`)}return new Un(_)}getSchema(){const $=this.schema;return $[0]===0?$[4]:$}getName($=!1){const{name:_}=this;return!$&&_&&_.includes("#")?_.split("#")[1]:_||void 0}getMemberName(){return this.memberName}isMemberSchema(){return this._isMemberSchema}isListSchema(){const $=this.getSchema();return typeof $=="number"?$>=64&&$<128:$[0]===1}isMapSchema(){const $=this.getSchema();return typeof $=="number"?$>=128&&$<=255:$[0]===2}isStructSchema(){const _=this.getSchema()[0];return _===3||_===-3||_===4}isUnionSchema(){return this.getSchema()[0]===4}isBlobSchema(){const $=this.getSchema();return $===21||$===42}isTimestampSchema(){const $=this.getSchema();return typeof $=="number"&&$>=4&&$<=7}isUnitSchema(){return this.getSchema()==="unit"}isDocumentSchema(){return this.getSchema()===15}isStringSchema(){return this.getSchema()===0}isBooleanSchema(){return this.getSchema()===2}isNumericSchema(){return this.getSchema()===1}isBigIntegerSchema(){return this.getSchema()===17}isBigDecimalSchema(){return this.getSchema()===19}isStreaming(){const{streaming:$}=this.getMergedTraits();return!!$||this.getSchema()===42}isIdempotencyToken(){const $=it=>(it&4)===4||!!(it!=null&&it.idempotencyToken),{normalizedTraits:_,traits:tt,memberTraits:nt}=this;return $(_)||$(tt)||$(nt)}getMergedTraits(){return this.normalizedTraits??(this.normalizedTraits={...this.getOwnTraits(),...this.getMemberTraits()})}getMemberTraits(){return translateTraits(this.memberTraits)}getOwnTraits(){return translateTraits(this.traits)}getKeySchema(){const[$,_]=[this.isDocumentSchema(),this.isMapSchema()];if(!$&&!_)throw new Error(`@smithy/core/schema - cannot get key for non-map: ${this.getName(!0)}`);const tt=this.getSchema(),nt=$?15:tt[4]??0;return member([nt,0],"key")}getValueSchema(){const $=this.getSchema(),[_,tt,nt]=[this.isDocumentSchema(),this.isMapSchema(),this.isListSchema()],it=typeof $=="number"?63&$:$&&typeof $=="object"&&(tt||nt)?$[3+$[0]]:_?15:void 0;if(it!=null)return member([it,0],tt?"value":"member");throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no value member.`)}getMemberSchema($){const _=this.getSchema();if(this.isStructSchema()&&_[4].includes($)){const tt=_[4].indexOf($),nt=_[5][tt];return member(isMemberSchema(nt)?nt:[nt,0],$)}if(this.isDocumentSchema())return member([15,0],$);throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no no member=${$}.`)}getMemberSchemas(){const $={};try{for(const[_,tt]of this.structIterator())$[_]=tt}catch{}return $}getEventStreamMember(){if(this.isStructSchema()){for(const[$,_]of this.structIterator())if(_.isStreaming()&&_.isStructSchema())return $}return""}*structIterator(){if(this.isUnitSchema())return;if(!this.isStructSchema())throw new Error("@smithy/core/schema - cannot iterate non-struct schema.");const $=this.getSchema();for(let _=0;_<$[4].length;++_)yield[$[4][_],member([$[5][_],0],$[4][_])]}};Pt(Un,"symbol",Symbol.for("@smithy/nor"));let NormalizedSchema=Un;function member(et,$){if(et instanceof NormalizedSchema)return Object.assign(et,{memberName:$,_isMemberSchema:!0});const _=NormalizedSchema;return new _(et,$)}const isMemberSchema=et=>Array.isArray(et)&&et.length===2,isStaticSchema=et=>Array.isArray(et)&&et.length>=5,Vn=class Vn{constructor($,_=new Map,tt=new Map){Pt(this,"namespace");Pt(this,"schemas");Pt(this,"exceptions");this.namespace=$,this.schemas=_,this.exceptions=tt}static for($){return Vn.registries.has($)||Vn.registries.set($,new Vn($)),Vn.registries.get($)}register($,_){const tt=this.normalizeShapeId($);Vn.for(tt.split("#")[0]).schemas.set(tt,_)}getSchema($){const _=this.normalizeShapeId($);if(!this.schemas.has(_))throw new Error(`@smithy/core/schema - schema not found for ${_}`);return this.schemas.get(_)}registerError($,_){const tt=$,nt=Vn.for(tt[1]);nt.schemas.set(tt[1]+"#"+tt[2],tt),nt.exceptions.set(tt,_)}getErrorCtor($){const _=$;return Vn.for(_[1]).exceptions.get(_)}getBaseException(){for(const $ of this.exceptions.keys())if(Array.isArray($)){const[,_,tt]=$,nt=_+"#"+tt;if(nt.startsWith("smithy.ts.sdk.synthetic.")&&nt.endsWith("ServiceException"))return $}}find($){return[...this.schemas.values()].find($)}clear(){this.schemas.clear(),this.exceptions.clear()}normalizeShapeId($){return $.includes("#")?$:this.namespace+"#"+$}};Pt(Vn,"registries",new Map);let TypeRegistry=Vn;const expectNumber=et=>{if(et!=null){if(typeof et=="string"){const $=parseFloat(et);if(!Number.isNaN($))return String($)!==String(et)&&logger.warn(stackTraceWarning(`Expected number but observed string: ${et}`)),$}if(typeof et=="number")return et;throw new TypeError(`Expected number, got ${typeof et}: ${et}`)}},MAX_FLOAT=Math.ceil(2**127*(2-2**-23)),expectFloat32=et=>{const $=expectNumber(et);if($!==void 0&&!Number.isNaN($)&&$!==1/0&&$!==-1/0&&Math.abs($)>MAX_FLOAT)throw new TypeError(`Expected 32-bit float, got ${et}`);return $},expectLong=et=>{if(et!=null){if(Number.isInteger(et)&&!Number.isNaN(et))return et;throw new TypeError(`Expected integer, got ${typeof et}: ${et}`)}},expectShort=et=>expectSizedInt(et,16),expectByte=et=>expectSizedInt(et,8),expectSizedInt=(et,$)=>{const _=expectLong(et);if(_!==void 0&&castInt(_,$)!==_)throw new TypeError(`Expected ${$}-bit integer, got ${et}`);return _},castInt=(et,$)=>{switch($){case 32:return Int32Array.of(et)[0];case 16:return Int16Array.of(et)[0];case 8:return Int8Array.of(et)[0]}},strictParseDouble=et=>expectNumber(typeof et=="string"?parseNumber(et):et),strictParseFloat32=et=>expectFloat32(typeof et=="string"?parseNumber(et):et),NUMBER_REGEX=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,parseNumber=et=>{const $=et.match(NUMBER_REGEX);if($===null||$[0].length!==et.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(et)},strictParseShort=et=>expectShort(typeof et=="string"?parseNumber(et):et),strictParseByte=et=>expectByte(typeof et=="string"?parseNumber(et):et),stackTraceWarning=et=>String(new TypeError(et).stack||et).split(`
`).slice(0,5).filter($=>!$.includes("stackTraceWarning")).join(`
`),logger={warn:console.warn},DAYS=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],MONTHS=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function dateToUtcString(et){const $=et.getUTCFullYear(),_=et.getUTCMonth(),tt=et.getUTCDay(),nt=et.getUTCDate(),it=et.getUTCHours(),rt=et.getUTCMinutes(),ot=et.getUTCSeconds(),lt=nt<10?`0${nt}`:`${nt}`,st=it<10?`0${it}`:`${it}`,at=rt<10?`0${rt}`:`${rt}`,ct=ot<10?`0${ot}`:`${ot}`;return`${DAYS[tt]}, ${lt} ${MONTHS[_]} ${$} ${st}:${at}:${ct} GMT`}const RFC3339_WITH_OFFSET$1=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),parseRfc3339DateTimeWithOffset=et=>{if(et==null)return;if(typeof et!="string")throw new TypeError("RFC-3339 date-times must be expressed as strings");const $=RFC3339_WITH_OFFSET$1.exec(et);if(!$)throw new TypeError("Invalid RFC-3339 date-time value");const[_,tt,nt,it,rt,ot,lt,st,at]=$,ct=strictParseShort(stripLeadingZeroes(tt)),dt=parseDateValue(nt,"month",1,12),ut=parseDateValue(it,"day",1,31),ft=buildDate(ct,dt,ut,{hours:rt,minutes:ot,seconds:lt,fractionalMilliseconds:st});return at.toUpperCase()!="Z"&&ft.setTime(ft.getTime()-parseOffsetToMilliseconds(at)),ft},IMF_FIXDATE$1=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d{2}) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),RFC_850_DATE$1=new RegExp(/^(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d{2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),ASC_TIME$1=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( [1-9]|\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? (\d{4})$/),parseRfc7231DateTime=et=>{if(et==null)return;if(typeof et!="string")throw new TypeError("RFC-7231 date-times must be expressed as strings");let $=IMF_FIXDATE$1.exec(et);if($){const[_,tt,nt,it,rt,ot,lt,st]=$;return buildDate(strictParseShort(stripLeadingZeroes(it)),parseMonthByShortName(nt),parseDateValue(tt,"day",1,31),{hours:rt,minutes:ot,seconds:lt,fractionalMilliseconds:st})}if($=RFC_850_DATE$1.exec(et),$){const[_,tt,nt,it,rt,ot,lt,st]=$;return adjustRfc850Year(buildDate(parseTwoDigitYear(it),parseMonthByShortName(nt),parseDateValue(tt,"day",1,31),{hours:rt,minutes:ot,seconds:lt,fractionalMilliseconds:st}))}if($=ASC_TIME$1.exec(et),$){const[_,tt,nt,it,rt,ot,lt,st]=$;return buildDate(strictParseShort(stripLeadingZeroes(st)),parseMonthByShortName(tt),parseDateValue(nt.trimLeft(),"day",1,31),{hours:it,minutes:rt,seconds:ot,fractionalMilliseconds:lt})}throw new TypeError("Invalid RFC-7231 date-time value")},parseEpochTimestamp=et=>{if(et==null)return;let $;if(typeof et=="number")$=et;else if(typeof et=="string")$=strictParseDouble(et);else if(typeof et=="object"&&et.tag===1)$=et.value;else throw new TypeError("Epoch timestamps must be expressed as floating point numbers or their string representation");if(Number.isNaN($)||$===1/0||$===-1/0)throw new TypeError("Epoch timestamps must be valid, non-Infinite, non-NaN numerics");return new Date(Math.round($*1e3))},buildDate=(et,$,_,tt)=>{const nt=$-1;return validateDayOfMonth(et,nt,_),new Date(Date.UTC(et,nt,_,parseDateValue(tt.hours,"hour",0,23),parseDateValue(tt.minutes,"minute",0,59),parseDateValue(tt.seconds,"seconds",0,60),parseMilliseconds(tt.fractionalMilliseconds)))},parseTwoDigitYear=et=>{const $=new Date().getUTCFullYear(),_=Math.floor($/100)*100+strictParseShort(stripLeadingZeroes(et));return _<$?_+100:_},FIFTY_YEARS_IN_MILLIS=50*365*24*60*60*1e3,adjustRfc850Year=et=>et.getTime()-new Date().getTime()>FIFTY_YEARS_IN_MILLIS?new Date(Date.UTC(et.getUTCFullYear()-100,et.getUTCMonth(),et.getUTCDate(),et.getUTCHours(),et.getUTCMinutes(),et.getUTCSeconds(),et.getUTCMilliseconds())):et,parseMonthByShortName=et=>{const $=MONTHS.indexOf(et);if($<0)throw new TypeError(`Invalid month: ${et}`);return $+1},DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],validateDayOfMonth=(et,$,_)=>{let tt=DAYS_IN_MONTH[$];if($===1&&isLeapYear(et)&&(tt=29),_>tt)throw new TypeError(`Invalid day for ${MONTHS[$]} in ${et}: ${_}`)},isLeapYear=et=>et%4===0&&(et%100!==0||et%400===0),parseDateValue=(et,$,_,tt)=>{const nt=strictParseByte(stripLeadingZeroes(et));if(nt<_||nt>tt)throw new TypeError(`${$} must be between ${_} and ${tt}, inclusive`);return nt},parseMilliseconds=et=>et==null?0:strictParseFloat32("0."+et)*1e3,parseOffsetToMilliseconds=et=>{const $=et[0];let _=1;if($=="+")_=1;else if($=="-")_=-1;else throw new TypeError(`Offset direction, ${$}, must be "+" or "-"`);const tt=Number(et.substring(1,3)),nt=Number(et.substring(4,6));return _*(tt*60+nt)*60*1e3},stripLeadingZeroes=et=>{let $=0;for(;$<et.length-1&&et.charAt($)==="0";)$++;return $===0?et:et.slice($)},randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),decimalToHex=Array.from({length:256},(et,$)=>$.toString(16).padStart(2,"0")),v4=()=>{if(randomUUID)return randomUUID();const et=new Uint8Array(16);return crypto.getRandomValues(et),et[6]=et[6]&15|64,et[8]=et[8]&63|128,decimalToHex[et[0]]+decimalToHex[et[1]]+decimalToHex[et[2]]+decimalToHex[et[3]]+"-"+decimalToHex[et[4]]+decimalToHex[et[5]]+"-"+decimalToHex[et[6]]+decimalToHex[et[7]]+"-"+decimalToHex[et[8]]+decimalToHex[et[9]]+"-"+decimalToHex[et[10]]+decimalToHex[et[11]]+decimalToHex[et[12]]+decimalToHex[et[13]]+decimalToHex[et[14]]+decimalToHex[et[15]]},LazyJsonString=function et($){return Object.assign(new String($),{deserializeJSON(){return JSON.parse(String($))},toString(){return String($)},toJSON(){return String($)}})};LazyJsonString.from=et=>et&&typeof et=="object"&&(et instanceof LazyJsonString||"deserializeJSON"in et)?et:typeof et=="string"||Object.getPrototypeOf(et)===String.prototype?LazyJsonString(String(et)):LazyJsonString(JSON.stringify(et));LazyJsonString.fromObject=LazyJsonString.from;function quoteHeader(et){return(et.includes(",")||et.includes('"'))&&(et=`"${et.replace(/"/g,'\\"')}"`),et}const ddd="(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun)(?:[ne|u?r]?s?day)?",mmm="(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)",time="(\\d?\\d):(\\d{2}):(\\d{2})(?:\\.(\\d+))?",date="(\\d?\\d)",year="(\\d{4})",RFC3339_WITH_OFFSET=new RegExp(/^(\d{4})-(\d\d)-(\d\d)[tT](\d\d):(\d\d):(\d\d)(\.(\d+))?(([-+]\d\d:\d\d)|[zZ])$/),IMF_FIXDATE=new RegExp(`^${ddd}, ${date} ${mmm} ${year} ${time} GMT$`),RFC_850_DATE=new RegExp(`^${ddd}, ${date}-${mmm}-(\\d\\d) ${time} GMT$`),ASC_TIME=new RegExp(`^${ddd} ${mmm} ( [1-9]|\\d\\d) ${time} ${year}$`),months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_parseEpochTimestamp=et=>{if(et==null)return;let $=NaN;if(typeof et=="number")$=et;else if(typeof et=="string"){if(!/^-?\d*\.?\d+$/.test(et))throw new TypeError("parseEpochTimestamp - numeric string invalid.");$=Number.parseFloat(et)}else typeof et=="object"&&et.tag===1&&($=et.value);if(isNaN($)||Math.abs($)===1/0)throw new TypeError("Epoch timestamps must be valid finite numbers.");return new Date(Math.round($*1e3))},_parseRfc3339DateTimeWithOffset=et=>{if(et==null)return;if(typeof et!="string")throw new TypeError("RFC3339 timestamps must be strings");const $=RFC3339_WITH_OFFSET.exec(et);if(!$)throw new TypeError(`Invalid RFC3339 timestamp format ${et}`);const[,_,tt,nt,it,rt,ot,,lt,st]=$;range(tt,1,12),range(nt,1,31),range(it,0,23),range(rt,0,59),range(ot,0,60);const at=new Date(Date.UTC(Number(_),Number(tt)-1,Number(nt),Number(it),Number(rt),Number(ot),Number(lt)?Math.round(parseFloat(`0.${lt}`)*1e3):0));if(at.setUTCFullYear(Number(_)),st.toUpperCase()!="Z"){const[,ct,dt,ut]=/([+-])(\d\d):(\d\d)/.exec(st)||[void 0,"+",0,0],ft=ct==="-"?1:-1;at.setTime(at.getTime()+ft*(Number(dt)*60*60*1e3+Number(ut)*60*1e3))}return at},_parseRfc7231DateTime=et=>{if(et==null)return;if(typeof et!="string")throw new TypeError("RFC7231 timestamps must be strings.");let $,_,tt,nt,it,rt,ot,lt;if((lt=IMF_FIXDATE.exec(et))?[,$,_,tt,nt,it,rt,ot]=lt:(lt=RFC_850_DATE.exec(et))?([,$,_,tt,nt,it,rt,ot]=lt,tt=(Number(tt)+1900).toString()):(lt=ASC_TIME.exec(et))&&([,_,$,nt,it,rt,ot,tt]=lt),tt&&rt){const st=Date.UTC(Number(tt),months.indexOf(_),Number($),Number(nt),Number(it),Number(rt),ot?Math.round(parseFloat(`0.${ot}`)*1e3):0);range($,1,31),range(nt,0,23),range(it,0,59),range(rt,0,60);const at=new Date(st);return at.setUTCFullYear(Number(tt)),at}throw new TypeError(`Invalid RFC7231 date-time value ${et}.`)};function range(et,$,_){const tt=Number(et);if(tt<$||tt>_)throw new Error(`Value ${tt} out of range [${$}, ${_}]`)}function splitEvery(et,$,_){if(_<=0||!Number.isInteger(_))throw new Error("Invalid number of delimiters ("+_+") for splitEvery.");const tt=et.split($);if(_===1)return tt;const nt=[];let it="";for(let rt=0;rt<tt.length;rt++)it===""?it=tt[rt]:it+=$+tt[rt],(rt+1)%_===0&&(nt.push(it),it="");return it!==""&&nt.push(it),nt}const splitHeader=et=>{const $=et.length,_=[];let tt=!1,nt,it=0;for(let rt=0;rt<$;++rt){const ot=et[rt];switch(ot){case'"':nt!=="\\"&&(tt=!tt);break;case",":tt||(_.push(et.slice(it,rt)),it=rt+1);break}nt=ot}return _.push(et.slice(it)),_.map(rt=>{rt=rt.trim();const ot=rt.length;return ot<2?rt:(rt[0]==='"'&&rt[ot-1]==='"'&&(rt=rt.slice(1,ot-1)),rt.replace(/\\"/g,'"'))})},format=/^-?\d*(\.\d+)?$/;class NumericValue{constructor($,_){Pt(this,"string");Pt(this,"type");if(this.string=$,this.type=_,!format.test($))throw new Error('@smithy/core/serde - NumericValue must only contain [0-9], at most one decimal point ".", and an optional negation prefix "-".')}toString(){return this.string}static[Symbol.hasInstance]($){if(!$||typeof $!="object")return!1;const _=$;return NumericValue.prototype.isPrototypeOf($)||_.type==="bigDecimal"&&format.test(_.string)}}const scriptRel="modulepreload",assetsURL=function(et,$){return new URL(et,$).href},seen={},__vitePreload=function et($,_,tt){if(!_||_.length===0)return $();const nt=document.getElementsByTagName("link");return Promise.all(_.map(it=>{if(it=assetsURL(it,tt),it in seen)return;seen[it]=!0;const rt=it.endsWith(".css"),ot=rt?'[rel="stylesheet"]':"";if(!!tt)for(let at=nt.length-1;at>=0;at--){const ct=nt[at];if(ct.href===it&&(!rt||ct.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${it}"]${ot}`))return;const st=document.createElement("link");if(st.rel=rt?"stylesheet":scriptRel,rt||(st.as="script",st.crossOrigin=""),st.href=it,document.head.appendChild(st),rt)return new Promise((at,ct)=>{st.addEventListener("load",at),st.addEventListener("error",()=>ct(new Error(`Unable to preload CSS for ${it}`)))})})).then(()=>$()).catch(it=>{const rt=new Event("vite:preloadError",{cancelable:!0});if(rt.payload=it,window.dispatchEvent(rt),!rt.defaultPrevented)throw it})};class SerdeContext{constructor(){Pt(this,"serdeContext")}setSerdeContext($){this.serdeContext=$}}class HttpProtocol extends SerdeContext{constructor(_){super();Pt(this,"options");this.options=_}getRequestType(){return HttpRequest}getResponseType(){return HttpResponse}setSerdeContext(_){this.serdeContext=_,this.serializer.setSerdeContext(_),this.deserializer.setSerdeContext(_),this.getPayloadCodec()&&this.getPayloadCodec().setSerdeContext(_)}updateServiceEndpoint(_,tt){if("url"in tt){_.protocol=tt.url.protocol,_.hostname=tt.url.hostname,_.port=tt.url.port?Number(tt.url.port):void 0,_.path=tt.url.pathname,_.fragment=tt.url.hash||void 0,_.username=tt.url.username||void 0,_.password=tt.url.password||void 0,_.query||(_.query={});for(const[nt,it]of tt.url.searchParams.entries())_.query[nt]=it;return _}else return _.protocol=tt.protocol,_.hostname=tt.hostname,_.port=tt.port?Number(tt.port):void 0,_.path=tt.path,_.query={...tt.query},_}setHostPrefix(_,tt,nt){var ot;const it=NormalizedSchema.of(tt.input),rt=translateTraits(tt.traits??{});if(rt.endpoint){let lt=(ot=rt.endpoint)==null?void 0:ot[0];if(typeof lt=="string"){const st=[...it.structIterator()].filter(([,at])=>at.getMergedTraits().hostLabel);for(const[at]of st){const ct=nt[at];if(typeof ct!="string")throw new Error(`@smithy/core/schema - ${at} in input must be a string as hostLabel.`);lt=lt.replace(`{${at}}`,ct)}_.hostname=lt+_.hostname}}}deserializeMetadata(_){return{httpStatusCode:_.statusCode,requestId:_.headers["x-amzn-requestid"]??_.headers["x-amzn-request-id"]??_.headers["x-amz-request-id"],extendedRequestId:_.headers["x-amz-id-2"],cfId:_.headers["x-amz-cf-id"]}}async serializeEventStream({eventStream:_,requestSchema:tt,initialRequest:nt}){return(await this.loadEventStreamCapability()).serializeEventStream({eventStream:_,requestSchema:tt,initialRequest:nt})}async deserializeEventStream({response:_,responseSchema:tt,initialResponseContainer:nt}){return(await this.loadEventStreamCapability()).deserializeEventStream({response:_,responseSchema:tt,initialResponseContainer:nt})}async loadEventStreamCapability(){const{EventStreamSerde:_}=await __vitePreload(()=>import("./index-303653f8.js"),[],import.meta.url);return new _({marshaller:this.getEventStreamMarshaller(),serializer:this.serializer,deserializer:this.deserializer,serdeContext:this.serdeContext,defaultContentType:this.getDefaultContentType()})}getDefaultContentType(){throw new Error(`@smithy/core/protocols - ${this.constructor.name} getDefaultContentType() implementation missing.`)}async deserializeHttpMessage(_,tt,nt,it,rt){return[]}getEventStreamMarshaller(){const _=this.serdeContext;if(!_.eventStreamMarshaller)throw new Error("@smithy/core - HttpProtocol: eventStreamMarshaller missing in serdeContext.");return _.eventStreamMarshaller}}class HttpBindingProtocol extends HttpProtocol{async serializeRequest($,_,tt){const nt={..._??{}},it=this.serializer,rt={},ot={},lt=await tt.endpoint(),st=NormalizedSchema.of($==null?void 0:$.input),at=st.getSchema();let ct=!1,dt;const ut=new HttpRequest({protocol:"",hostname:"",port:void 0,path:"",fragment:void 0,query:rt,headers:ot,body:void 0});if(lt){this.updateServiceEndpoint(ut,lt),this.setHostPrefix(ut,$,nt);const ft=translateTraits($.traits);if(ft.http){ut.method=ft.http[0];const[pt,St]=ft.http[1].split("?");ut.path=="/"?ut.path=pt:ut.path+=pt;const gt=new URLSearchParams(St??"");Object.assign(rt,Object.fromEntries(gt))}}for(const[ft,pt]of st.structIterator()){const St=pt.getMergedTraits()??{},gt=nt[ft];if(!(gt==null&&!pt.isIdempotencyToken()))if(St.httpPayload)pt.isStreaming()?pt.isStructSchema()?nt[ft]&&(dt=await this.serializeEventStream({eventStream:nt[ft],requestSchema:st})):dt=gt:(it.write(pt,gt),dt=it.flush()),delete nt[ft];else if(St.httpLabel){it.write(pt,gt);const yt=it.flush();ut.path.includes(`{${ft}+}`)?ut.path=ut.path.replace(`{${ft}+}`,yt.split("/").map(extendedEncodeURIComponent).join("/")):ut.path.includes(`{${ft}}`)&&(ut.path=ut.path.replace(`{${ft}}`,extendedEncodeURIComponent(yt))),delete nt[ft]}else if(St.httpHeader)it.write(pt,gt),ot[St.httpHeader.toLowerCase()]=String(it.flush()),delete nt[ft];else if(typeof St.httpPrefixHeaders=="string"){for(const[yt,vt]of Object.entries(gt)){const Ct=St.httpPrefixHeaders+yt;it.write([pt.getValueSchema(),{httpHeader:Ct}],vt),ot[Ct.toLowerCase()]=it.flush()}delete nt[ft]}else St.httpQuery||St.httpQueryParams?(this.serializeQuery(pt,gt,rt),delete nt[ft]):ct=!0}return ct&&nt&&(it.write(at,nt),dt=it.flush()),ut.headers=ot,ut.query=rt,ut.body=dt,ut}serializeQuery($,_,tt){const nt=this.serializer,it=$.getMergedTraits();if(it.httpQueryParams){for(const[rt,ot]of Object.entries(_))if(!(rt in tt)){const lt=$.getValueSchema();Object.assign(lt.getMergedTraits(),{...it,httpQuery:rt,httpQueryParams:void 0}),this.serializeQuery(lt,ot,tt)}return}if($.isListSchema()){const rt=!!$.getMergedTraits().sparse,ot=[];for(const lt of _){nt.write([$.getValueSchema(),it],lt);const st=nt.flush();(rt||st!==void 0)&&ot.push(st)}tt[it.httpQuery]=ot}else nt.write([$,it],_),tt[it.httpQuery]=nt.flush()}async deserializeResponse($,_,tt){const nt=this.deserializer,it=NormalizedSchema.of($.output),rt={};if(tt.statusCode>=300){const lt=await collectBody(tt.body,_);throw lt.byteLength>0&&Object.assign(rt,await nt.read(15,lt)),await this.handleError($,_,tt,rt,this.deserializeMetadata(tt)),new Error("@smithy/core/protocols - HTTP Protocol error handler failed to throw.")}for(const lt in tt.headers){const st=tt.headers[lt];delete tt.headers[lt],tt.headers[lt.toLowerCase()]=st}const ot=await this.deserializeHttpMessage(it,_,tt,rt);if(ot.length){const lt=await collectBody(tt.body,_);if(lt.byteLength>0){const st=await nt.read(it,lt);for(const at of ot)rt[at]=st[at]}}else ot.discardResponseBody&&await collectBody(tt.body,_);return rt.$metadata=this.deserializeMetadata(tt),rt}async deserializeHttpMessage($,_,tt,nt,it){let rt;nt instanceof Set?rt=it:rt=nt;let ot=!0;const lt=this.deserializer,st=NormalizedSchema.of($),at=[];for(const[ct,dt]of st.structIterator()){const ut=dt.getMemberTraits();if(ut.httpPayload){if(ot=!1,dt.isStreaming())dt.isStructSchema()?rt[ct]=await this.deserializeEventStream({response:tt,responseSchema:st}):rt[ct]=sdkStreamMixin(tt.body);else if(tt.body){const pt=await collectBody(tt.body,_);pt.byteLength>0&&(rt[ct]=await lt.read(dt,pt))}}else if(ut.httpHeader){const ft=String(ut.httpHeader).toLowerCase(),pt=tt.headers[ft];if(pt!=null)if(dt.isListSchema()){const St=dt.getValueSchema();St.getMergedTraits().httpHeader=ft;let gt;St.isTimestampSchema()&&St.getSchema()===4?gt=splitEvery(pt,",",2):gt=splitHeader(pt);const yt=[];for(const vt of gt)yt.push(await lt.read(St,vt.trim()));rt[ct]=yt}else rt[ct]=await lt.read(dt,pt)}else if(ut.httpPrefixHeaders!==void 0){rt[ct]={};for(const[ft,pt]of Object.entries(tt.headers))if(ft.startsWith(ut.httpPrefixHeaders)){const St=dt.getValueSchema();St.getMergedTraits().httpHeader=ft,rt[ct][ft.slice(ut.httpPrefixHeaders.length)]=await lt.read(St,pt)}}else ut.httpResponseCode?rt[ct]=tt.statusCode:at.push(ct)}return at.discardResponseBody=ot,at}}function determineTimestampFormat(et,$){if($.timestampFormat.useTrait&&et.isTimestampSchema()&&(et.getSchema()===5||et.getSchema()===6||et.getSchema()===7))return et.getSchema();const{httpLabel:_,httpPrefixHeaders:tt,httpHeader:nt,httpQuery:it}=et.getMergedTraits();return($.httpBindings?typeof tt=="string"||nt?6:it||_?5:void 0:void 0)??$.timestampFormat.default}class FromStringShapeDeserializer extends SerdeContext{constructor(_){super();Pt(this,"settings");this.settings=_}read(_,tt){var it;const nt=NormalizedSchema.of(_);if(nt.isListSchema())return splitHeader(tt).map(rt=>this.read(nt.getValueSchema(),rt));if(nt.isBlobSchema())return(((it=this.serdeContext)==null?void 0:it.base64Decoder)??fromBase64)(tt);if(nt.isTimestampSchema())switch(determineTimestampFormat(nt,this.settings)){case 5:return _parseRfc3339DateTimeWithOffset(tt);case 6:return _parseRfc7231DateTime(tt);case 7:return _parseEpochTimestamp(tt);default:return console.warn("Missing timestamp format, parsing value with Date constructor:",tt),new Date(tt)}if(nt.isStringSchema()){const rt=nt.getMergedTraits().mediaType;let ot=tt;if(rt)return nt.getMergedTraits().httpHeader&&(ot=this.base64ToUtf8(ot)),(rt==="application/json"||rt.endsWith("+json"))&&(ot=LazyJsonString.from(ot)),ot}return nt.isNumericSchema()?Number(tt):nt.isBigIntegerSchema()?BigInt(tt):nt.isBigDecimalSchema()?new NumericValue(tt,"bigDecimal"):nt.isBooleanSchema()?String(tt).toLowerCase()==="true":tt}base64ToUtf8(_){var tt,nt;return(((tt=this.serdeContext)==null?void 0:tt.utf8Encoder)??toUtf8)((((nt=this.serdeContext)==null?void 0:nt.base64Decoder)??fromBase64)(_))}}class HttpInterceptingShapeDeserializer extends SerdeContext{constructor(_,tt){super();Pt(this,"codecDeserializer");Pt(this,"stringDeserializer");this.codecDeserializer=_,this.stringDeserializer=new FromStringShapeDeserializer(tt)}setSerdeContext(_){this.stringDeserializer.setSerdeContext(_),this.codecDeserializer.setSerdeContext(_),this.serdeContext=_}read(_,tt){var ot,lt;const nt=NormalizedSchema.of(_),it=nt.getMergedTraits(),rt=((ot=this.serdeContext)==null?void 0:ot.utf8Encoder)??toUtf8;if(it.httpHeader||it.httpResponseCode)return this.stringDeserializer.read(nt,rt(tt));if(it.httpPayload){if(nt.isBlobSchema()){const st=((lt=this.serdeContext)==null?void 0:lt.utf8Decoder)??fromUtf8$2;return typeof tt=="string"?st(tt):tt}else if(nt.isStringSchema())return"byteLength"in tt?rt(tt):tt}return this.codecDeserializer.read(nt,tt)}}class ToStringShapeSerializer extends SerdeContext{constructor(_){super();Pt(this,"settings");Pt(this,"stringBuffer","");this.settings=_}write(_,tt){var it,rt;const nt=NormalizedSchema.of(_);switch(typeof tt){case"object":if(tt===null){this.stringBuffer="null";return}if(nt.isTimestampSchema()){if(!(tt instanceof Date))throw new Error(`@smithy/core/protocols - received non-Date value ${tt} when schema expected Date in ${nt.getName(!0)}`);switch(determineTimestampFormat(nt,this.settings)){case 5:this.stringBuffer=tt.toISOString().replace(".000Z","Z");break;case 6:this.stringBuffer=dateToUtcString(tt);break;case 7:this.stringBuffer=String(tt.getTime()/1e3);break;default:console.warn("Missing timestamp format, using epoch seconds",tt),this.stringBuffer=String(tt.getTime()/1e3)}return}if(nt.isBlobSchema()&&"byteLength"in tt){this.stringBuffer=(((it=this.serdeContext)==null?void 0:it.base64Encoder)??toBase64)(tt);return}if(nt.isListSchema()&&Array.isArray(tt)){let st="";for(const at of tt){this.write([nt.getValueSchema(),nt.getMergedTraits()],at);const ct=this.flush(),dt=nt.getValueSchema().isTimestampSchema()?ct:quoteHeader(ct);st!==""&&(st+=", "),st+=dt}this.stringBuffer=st;return}this.stringBuffer=JSON.stringify(tt,null,2);break;case"string":const ot=nt.getMergedTraits().mediaType;let lt=tt;if(ot&&((ot==="application/json"||ot.endsWith("+json"))&&(lt=LazyJsonString.from(lt)),nt.getMergedTraits().httpHeader)){this.stringBuffer=(((rt=this.serdeContext)==null?void 0:rt.base64Encoder)??toBase64)(lt.toString());return}this.stringBuffer=tt;break;default:nt.isIdempotencyToken()?this.stringBuffer=v4():this.stringBuffer=String(tt)}}flush(){const _=this.stringBuffer;return this.stringBuffer="",_}}class HttpInterceptingShapeSerializer{constructor($,_,tt=new ToStringShapeSerializer(_)){Pt(this,"codecSerializer");Pt(this,"stringSerializer");Pt(this,"buffer");this.codecSerializer=$,this.stringSerializer=tt}setSerdeContext($){this.codecSerializer.setSerdeContext($),this.stringSerializer.setSerdeContext($)}write($,_){const tt=NormalizedSchema.of($),nt=tt.getMergedTraits();if(nt.httpHeader||nt.httpLabel||nt.httpQuery){this.stringSerializer.write(tt,_),this.buffer=this.stringSerializer.flush();return}return this.codecSerializer.write(tt,_)}flush(){if(this.buffer!==void 0){const $=this.buffer;return this.buffer=void 0,$}return this.codecSerializer.flush()}}function setFeature$1(et,$,_){et.__smithy_context?et.__smithy_context.features||(et.__smithy_context.features={}):et.__smithy_context={features:{}},et.__smithy_context.features[$]=_}class DefaultIdentityProviderConfig{constructor($){Pt(this,"authSchemes",new Map);for(const[_,tt]of Object.entries($))tt!==void 0&&this.authSchemes.set(_,tt)}getIdentityProvider($){return this.authSchemes.get($)}}const createIsIdentityExpiredFunction=et=>function(_){return doesIdentityRequireRefresh(_)&&_.expiration.getTime()-Date.now()<et},EXPIRATION_MS=3e5,isIdentityExpired=createIsIdentityExpiredFunction(EXPIRATION_MS),doesIdentityRequireRefresh=et=>et.expiration!==void 0,memoizeIdentityProvider=(et,$,_)=>{if(et===void 0)return;const tt=typeof et!="function"?async()=>Promise.resolve(et):et;let nt,it,rt,ot=!1;const lt=async st=>{it||(it=tt(st));try{nt=await it,rt=!0,ot=!1}finally{it=void 0}return nt};return $===void 0?async st=>((!rt||st!=null&&st.forceRefresh)&&(nt=await lt(st)),nt):async st=>((!rt||st!=null&&st.forceRefresh)&&(nt=await lt(st)),ot?nt:_(nt)?($(nt)&&await lt(st),nt):(ot=!0,nt))},DEFAULT_UA_APP_ID=void 0;function isValidUserAgentAppId(et){return et===void 0?!0:typeof et=="string"&&et.length<=50}function resolveUserAgentConfig(et){const $=normalizeProvider(et.userAgentAppId??DEFAULT_UA_APP_ID),{customUserAgent:_}=et;return Object.assign(et,{customUserAgent:typeof _=="string"?[[_]]:_,userAgentAppId:async()=>{var nt,it;const tt=await $();if(!isValidUserAgentAppId(tt)){const rt=((it=(nt=et.logger)==null?void 0:nt.constructor)==null?void 0:it.name)==="NoOpLogger"||!et.logger?console:et.logger;typeof tt!="string"?rt==null||rt.warn("userAgentAppId must be a string or undefined."):tt.length>50&&(rt==null||rt.warn("The provided userAgentAppId exceeds the maximum length of 50 characters."))}return tt}})}class EndpointCache{constructor({size:$,params:_}){Pt(this,"capacity");Pt(this,"data",new Map);Pt(this,"parameters",[]);this.capacity=$??50,_&&(this.parameters=_)}get($,_){const tt=this.hash($);if(tt===!1)return _();if(!this.data.has(tt)){if(this.data.size>this.capacity+10){const nt=this.data.keys();let it=0;for(;;){const{value:rt,done:ot}=nt.next();if(this.data.delete(rt),ot||++it>10)break}}this.data.set(tt,_())}return this.data.get(tt)}size(){return this.data.size}hash($){let _="";const{parameters:tt}=this;if(tt.length===0)return!1;for(const nt of tt){const it=String($[nt]??"");if(it.includes("|;"))return!1;_+=it+"|;"}return _}}const IP_V4_REGEX=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),isIpAddress=et=>IP_V4_REGEX.test(et)||et.startsWith("[")&&et.endsWith("]"),VALID_HOST_LABEL_REGEX=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),isValidHostLabel=(et,$=!1)=>{if(!$)return VALID_HOST_LABEL_REGEX.test(et);const _=et.split(".");for(const tt of _)if(!isValidHostLabel(tt))return!1;return!0},customEndpointFunctions={},debugId="endpoints";function toDebugString(et){return typeof et!="object"||et==null?et:"ref"in et?`$${toDebugString(et.ref)}`:"fn"in et?`${et.fn}(${(et.argv||[]).map(toDebugString).join(", ")})`:JSON.stringify(et,null,2)}class EndpointError extends Error{constructor($){super($),this.name="EndpointError"}}const booleanEquals=(et,$)=>et===$,getAttrPathList=et=>{const $=et.split("."),_=[];for(const tt of $){const nt=tt.indexOf("[");if(nt!==-1){if(tt.indexOf("]")!==tt.length-1)throw new EndpointError(`Path: '${et}' does not end with ']'`);const it=tt.slice(nt+1,-1);if(Number.isNaN(parseInt(it)))throw new EndpointError(`Invalid array index: '${it}' in path: '${et}'`);nt!==0&&_.push(tt.slice(0,nt)),_.push(it)}else _.push(tt)}return _},getAttr=(et,$)=>getAttrPathList($).reduce((_,tt)=>{if(typeof _!="object")throw new EndpointError(`Index '${tt}' in '${$}' not found in '${JSON.stringify(et)}'`);return Array.isArray(_)?_[parseInt(tt)]:_[tt]},et),isSet=et=>et!=null,not=et=>!et,DEFAULT_PORTS={[EndpointURLScheme.HTTP]:80,[EndpointURLScheme.HTTPS]:443},parseURL=et=>{const $=(()=>{try{if(et instanceof URL)return et;if(typeof et=="object"&&"hostname"in et){const{hostname:dt,port:ut,protocol:ft="",path:pt="",query:St={}}=et,gt=new URL(`${ft}//${dt}${ut?`:${ut}`:""}${pt}`);return gt.search=Object.entries(St).map(([yt,vt])=>`${yt}=${vt}`).join("&"),gt}return new URL(et)}catch{return null}})();if(!$)return console.error(`Unable to parse ${JSON.stringify(et)} as a whatwg URL.`),null;const _=$.href,{host:tt,hostname:nt,pathname:it,protocol:rt,search:ot}=$;if(ot)return null;const lt=rt.slice(0,-1);if(!Object.values(EndpointURLScheme).includes(lt))return null;const st=isIpAddress(nt),at=_.includes(`${tt}:${DEFAULT_PORTS[lt]}`)||typeof et=="string"&&et.includes(`${tt}:${DEFAULT_PORTS[lt]}`),ct=`${tt}${at?`:${DEFAULT_PORTS[lt]}`:""}`;return{scheme:lt,authority:ct,path:it,normalizedPath:it.endsWith("/")?it:`${it}/`,isIp:st}},stringEquals=(et,$)=>et===$,substring=(et,$,_,tt)=>$>=_||et.length<_?null:tt?et.substring(et.length-_,et.length-$):et.substring($,_),uriEncode=et=>encodeURIComponent(et).replace(/[!*'()]/g,$=>`%${$.charCodeAt(0).toString(16).toUpperCase()}`),endpointFunctions={booleanEquals,getAttr,isSet,isValidHostLabel,not,parseURL,stringEquals,substring,uriEncode},evaluateTemplate=(et,$)=>{const _=[],tt={...$.endpointParams,...$.referenceRecord};let nt=0;for(;nt<et.length;){const it=et.indexOf("{",nt);if(it===-1){_.push(et.slice(nt));break}_.push(et.slice(nt,it));const rt=et.indexOf("}",it);if(rt===-1){_.push(et.slice(it));break}et[it+1]==="{"&&et[rt+1]==="}"&&(_.push(et.slice(it+1,rt)),nt=rt+2);const ot=et.substring(it+1,rt);if(ot.includes("#")){const[lt,st]=ot.split("#");_.push(getAttr(tt[lt],st))}else _.push(tt[ot]);nt=rt+1}return _.join("")},getReferenceValue=({ref:et},$)=>({...$.endpointParams,...$.referenceRecord})[et],evaluateExpression=(et,$,_)=>{if(typeof et=="string")return evaluateTemplate(et,_);if(et.fn)return group$2.callFunction(et,_);if(et.ref)return getReferenceValue(et,_);throw new EndpointError(`'${$}': ${String(et)} is not a string, function or reference.`)},callFunction=({fn:et,argv:$},_)=>{const tt=$.map(it=>["boolean","number"].includes(typeof it)?it:group$2.evaluateExpression(it,"arg",_)),nt=et.split(".");return nt[0]in customEndpointFunctions&&nt[1]!=null?customEndpointFunctions[nt[0]][nt[1]](...tt):endpointFunctions[et](...tt)},group$2={evaluateExpression,callFunction},evaluateCondition=({assign:et,...$},_)=>{var nt,it;if(et&&et in _.referenceRecord)throw new EndpointError(`'${et}' is already defined in Reference Record.`);const tt=callFunction($,_);return(it=(nt=_.logger)==null?void 0:nt.debug)==null||it.call(nt,`${debugId} evaluateCondition: ${toDebugString($)} = ${toDebugString(tt)}`),{result:tt===""?!0:!!tt,...et!=null&&{toAssign:{name:et,value:tt}}}},evaluateConditions=(et=[],$)=>{var tt,nt;const _={};for(const it of et){const{result:rt,toAssign:ot}=evaluateCondition(it,{...$,referenceRecord:{...$.referenceRecord,..._}});if(!rt)return{result:rt};ot&&(_[ot.name]=ot.value,(nt=(tt=$.logger)==null?void 0:tt.debug)==null||nt.call(tt,`${debugId} assign: ${ot.name} := ${toDebugString(ot.value)}`))}return{result:!0,referenceRecord:_}},getEndpointHeaders=(et,$)=>Object.entries(et).reduce((_,[tt,nt])=>({..._,[tt]:nt.map(it=>{const rt=evaluateExpression(it,"Header value entry",$);if(typeof rt!="string")throw new EndpointError(`Header '${tt}' value '${rt}' is not a string`);return rt})}),{}),getEndpointProperties=(et,$)=>Object.entries(et).reduce((_,[tt,nt])=>({..._,[tt]:group$1.getEndpointProperty(nt,$)}),{}),getEndpointProperty=(et,$)=>{if(Array.isArray(et))return et.map(_=>getEndpointProperty(_,$));switch(typeof et){case"string":return evaluateTemplate(et,$);case"object":if(et===null)throw new EndpointError(`Unexpected endpoint property: ${et}`);return group$1.getEndpointProperties(et,$);case"boolean":return et;default:throw new EndpointError(`Unexpected endpoint property type: ${typeof et}`)}},group$1={getEndpointProperty,getEndpointProperties},getEndpointUrl=(et,$)=>{const _=evaluateExpression(et,"Endpoint URL",$);if(typeof _=="string")try{return new URL(_)}catch(tt){throw console.error(`Failed to construct URL with ${_}`,tt),tt}throw new EndpointError(`Endpoint URL must be a string, got ${typeof _}`)},evaluateEndpointRule=(et,$)=>{var at,ct;const{conditions:_,endpoint:tt}=et,{result:nt,referenceRecord:it}=evaluateConditions(_,$);if(!nt)return;const rt={...$,referenceRecord:{...$.referenceRecord,...it}},{url:ot,properties:lt,headers:st}=tt;return(ct=(at=$.logger)==null?void 0:at.debug)==null||ct.call(at,`${debugId} Resolving endpoint from template: ${toDebugString(tt)}`),{...st!=null&&{headers:getEndpointHeaders(st,rt)},...lt!=null&&{properties:getEndpointProperties(lt,rt)},url:getEndpointUrl(ot,rt)}},evaluateErrorRule=(et,$)=>{const{conditions:_,error:tt}=et,{result:nt,referenceRecord:it}=evaluateConditions(_,$);if(nt)throw new EndpointError(evaluateExpression(tt,"Error",{...$,referenceRecord:{...$.referenceRecord,...it}}))},evaluateRules=(et,$)=>{for(const _ of et)if(_.type==="endpoint"){const tt=evaluateEndpointRule(_,$);if(tt)return tt}else if(_.type==="error")evaluateErrorRule(_,$);else if(_.type==="tree"){const tt=group.evaluateTreeRule(_,$);if(tt)return tt}else throw new EndpointError(`Unknown endpoint rule: ${_}`);throw new EndpointError("Rules evaluation failed")},evaluateTreeRule=(et,$)=>{const{conditions:_,rules:tt}=et,{result:nt,referenceRecord:it}=evaluateConditions(_,$);if(nt)return group.evaluateRules(tt,{...$,referenceRecord:{...$.referenceRecord,...it}})},group={evaluateRules,evaluateTreeRule},resolveEndpoint=(et,$)=>{var st,at,ct,dt;const{endpointParams:_,logger:tt}=$,{parameters:nt,rules:it}=et;(at=(st=$.logger)==null?void 0:st.debug)==null||at.call(st,`${debugId} Initial EndpointParams: ${toDebugString(_)}`);const rt=Object.entries(nt).filter(([,ut])=>ut.default!=null).map(([ut,ft])=>[ut,ft.default]);if(rt.length>0)for(const[ut,ft]of rt)_[ut]=_[ut]??ft;const ot=Object.entries(nt).filter(([,ut])=>ut.required).map(([ut])=>ut);for(const ut of ot)if(_[ut]==null)throw new EndpointError(`Missing required parameter: '${ut}'`);const lt=evaluateRules(it,{endpointParams:_,logger:tt,referenceRecord:{}});return(dt=(ct=$.logger)==null?void 0:ct.debug)==null||dt.call(ct,`${debugId} Resolved endpoint: ${toDebugString(lt)}`),lt},isVirtualHostableS3Bucket=(et,$=!1)=>{if($){for(const _ of et.split("."))if(!isVirtualHostableS3Bucket(_))return!1;return!0}return!(!isValidHostLabel(et)||et.length<3||et.length>63||et!==et.toLowerCase()||isIpAddress(et))},ARN_DELIMITER=":",RESOURCE_DELIMITER="/",parseArn=et=>{const $=et.split(ARN_DELIMITER);if($.length<6)return null;const[_,tt,nt,it,rt,...ot]=$;if(_!=="arn"||tt===""||nt===""||ot.join(ARN_DELIMITER)==="")return null;const lt=ot.map(st=>st.split(RESOURCE_DELIMITER)).flat();return{partition:tt,service:nt,region:it,accountId:rt,resourceId:lt}},partitions=[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il|mx)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-east-2":{description:"Asia Pacific (Taipei)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"ap-southeast-5":{description:"Asia Pacific (Malaysia)"},"ap-southeast-6":{description:"Asia Pacific (New Zealand)"},"ap-southeast-7":{description:"Asia Pacific (Thailand)"},"aws-global":{description:"aws global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"mx-central-1":{description:"Mexico (Central)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"aws-cn global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-eusc",outputs:{dnsSuffix:"amazonaws.eu",dualStackDnsSuffix:"api.amazonwebservices.eu",implicitGlobalRegion:"eusc-de-east-1",name:"aws-eusc",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^eusc\\-(de)\\-\\w+\\-\\d+$",regions:{"eusc-de-east-1":{description:"EU (Germany)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"api.aws.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"aws-iso global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"api.aws.scloud",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"aws-iso-b global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"},"us-isob-west-1":{description:"US ISOB West"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"api.cloud-aws.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"aws-iso-e-global":{description:"aws-iso-e global region"},"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"api.aws.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{"aws-iso-f-global":{description:"aws-iso-f global region"},"us-isof-east-1":{description:"US ISOF EAST"},"us-isof-south-1":{description:"US ISOF SOUTH"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"aws-us-gov global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}}],version$1="1.1",partitionsInfo={partitions,version:version$1};let selectedPartitionsInfo=partitionsInfo;const partition=et=>{const{partitions:$}=selectedPartitionsInfo;for(const tt of $){const{regions:nt,outputs:it}=tt;for(const[rt,ot]of Object.entries(nt))if(rt===et)return{...it,...ot}}for(const tt of $){const{regionRegex:nt,outputs:it}=tt;if(new RegExp(nt).test(et))return{...it}}const _=$.find(tt=>tt.id==="aws");if(!_)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{..._.outputs}},awsEndpointFunctions={isVirtualHostableS3Bucket,parseArn,partition};customEndpointFunctions.aws=awsEndpointFunctions;function parseQueryString(et){const $={};if(et=et.replace(/^\?/,""),et)for(const _ of et.split("&")){let[tt,nt=null]=_.split("=");tt=decodeURIComponent(tt),nt&&(nt=decodeURIComponent(nt)),tt in $?Array.isArray($[tt])?$[tt].push(nt):$[tt]=[$[tt],nt]:$[tt]=nt}return $}const parseUrl=et=>{if(typeof et=="string")return parseUrl(new URL(et));const{hostname:$,pathname:_,port:tt,protocol:nt,search:it}=et;let rt;return it&&(rt=parseQueryString(it)),{hostname:$,port:tt?parseInt(tt):void 0,protocol:nt,path:_,query:rt}};function setCredentialFeature(et,$,_){return et.$source||(et.$source={}),et.$source[$]=_,et}function setFeature(et,$,_){et.__aws_sdk_context?et.__aws_sdk_context.features||(et.__aws_sdk_context.features={}):et.__aws_sdk_context={features:{}},et.__aws_sdk_context.features[$]=_}const getDateHeader=et=>{var $,_;return HttpResponse.isInstance(et)?(($=et.headers)==null?void 0:$.date)??((_=et.headers)==null?void 0:_.Date):void 0},getSkewCorrectedDate=et=>new Date(Date.now()+et),isClockSkewed=(et,$)=>Math.abs(getSkewCorrectedDate($).getTime()-et)>=3e5,getUpdatedSystemClockOffset=(et,$)=>{const _=Date.parse(et);return isClockSkewed(_,$)?_-Date.now():$},throwSigningPropertyError=(et,$)=>{if(!$)throw new Error(`Property \`${et}\` is not resolved for AWS SDK SigV4Auth`);return $},validateSigningProperties=async et=>{var st,at,ct;const $=throwSigningPropertyError("context",et.context),_=throwSigningPropertyError("config",et.config),tt=(ct=(at=(st=$.endpointV2)==null?void 0:st.properties)==null?void 0:at.authSchemes)==null?void 0:ct[0],it=await throwSigningPropertyError("signer",_.signer)(tt),rt=et==null?void 0:et.signingRegion,ot=et==null?void 0:et.signingRegionSet,lt=et==null?void 0:et.signingName;return{config:_,signer:it,signingRegion:rt,signingRegionSet:ot,signingName:lt}};class AwsSdkSigV4Signer{async sign($,_,tt){var ct;if(!HttpRequest.isInstance($))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const nt=await validateSigningProperties(tt),{config:it,signer:rt}=nt;let{signingRegion:ot,signingName:lt}=nt;const st=tt.context;if(((ct=st==null?void 0:st.authSchemes)==null?void 0:ct.length)??0>1){const[dt,ut]=st.authSchemes;(dt==null?void 0:dt.name)==="sigv4a"&&(ut==null?void 0:ut.name)==="sigv4"&&(ot=(ut==null?void 0:ut.signingRegion)??ot,lt=(ut==null?void 0:ut.signingName)??lt)}return await rt.sign($,{signingDate:getSkewCorrectedDate(it.systemClockOffset),signingRegion:ot,signingService:lt})}errorHandler($){return _=>{const tt=_.ServerTime??getDateHeader(_.$response);if(tt){const nt=throwSigningPropertyError("config",$.config),it=nt.systemClockOffset;nt.systemClockOffset=getUpdatedSystemClockOffset(tt,nt.systemClockOffset),nt.systemClockOffset!==it&&_.$metadata&&(_.$metadata.clockSkewCorrected=!0)}throw _}}successHandler($,_){const tt=getDateHeader($);if(tt){const nt=throwSigningPropertyError("config",_.config);nt.systemClockOffset=getUpdatedSystemClockOffset(tt,nt.systemClockOffset)}}}const memoize=(et,$,_)=>{let tt,nt,it,rt=!1;const ot=async()=>{nt||(nt=et());try{tt=await nt,it=!0,rt=!1}finally{nt=void 0}return tt};return $===void 0?async lt=>((!it||lt!=null&&lt.forceRefresh)&&(tt=await ot()),tt):async lt=>((!it||lt!=null&&lt.forceRefresh)&&(tt=await ot()),rt?tt:_&&!_(tt)?(rt=!0,tt):($(tt)&&await ot(),tt))},ALGORITHM_QUERY_PARAM="X-Amz-Algorithm",CREDENTIAL_QUERY_PARAM="X-Amz-Credential",AMZ_DATE_QUERY_PARAM="X-Amz-Date",SIGNED_HEADERS_QUERY_PARAM="X-Amz-SignedHeaders",EXPIRES_QUERY_PARAM="X-Amz-Expires",SIGNATURE_QUERY_PARAM="X-Amz-Signature",TOKEN_QUERY_PARAM="X-Amz-Security-Token",AUTH_HEADER="authorization",AMZ_DATE_HEADER=AMZ_DATE_QUERY_PARAM.toLowerCase(),DATE_HEADER="date",GENERATED_HEADERS=[AUTH_HEADER,AMZ_DATE_HEADER,DATE_HEADER],SIGNATURE_HEADER=SIGNATURE_QUERY_PARAM.toLowerCase(),SHA256_HEADER="x-amz-content-sha256",TOKEN_HEADER=TOKEN_QUERY_PARAM.toLowerCase(),ALWAYS_UNSIGNABLE_HEADERS={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},PROXY_HEADER_PATTERN=/^proxy-/,SEC_HEADER_PATTERN=/^sec-/,ALGORITHM_IDENTIFIER="AWS4-HMAC-SHA256",EVENT_ALGORITHM_IDENTIFIER="AWS4-HMAC-SHA256-PAYLOAD",UNSIGNED_PAYLOAD="UNSIGNED-PAYLOAD",MAX_CACHE_SIZE=50,KEY_TYPE_IDENTIFIER="aws4_request",MAX_PRESIGNED_TTL=60*60*24*7,signingKeyCache={},cacheQueue=[],createScope=(et,$,_)=>`${et}/${$}/${_}/${KEY_TYPE_IDENTIFIER}`,getSigningKey=async(et,$,_,tt,nt)=>{const it=await hmac(et,$.secretAccessKey,$.accessKeyId),rt=`${_}:${tt}:${nt}:${toHex$1(it)}:${$.sessionToken}`;if(rt in signingKeyCache)return signingKeyCache[rt];for(cacheQueue.push(rt);cacheQueue.length>MAX_CACHE_SIZE;)delete signingKeyCache[cacheQueue.shift()];let ot=`AWS4${$.secretAccessKey}`;for(const lt of[_,tt,nt,KEY_TYPE_IDENTIFIER])ot=await hmac(et,ot,lt);return signingKeyCache[rt]=ot},hmac=(et,$,_)=>{const tt=new et($);return tt.update(toUint8Array(_)),tt.digest()},getCanonicalHeaders=({headers:et},$,_)=>{const tt={};for(const nt of Object.keys(et).sort()){if(et[nt]==null)continue;const it=nt.toLowerCase();(it in ALWAYS_UNSIGNABLE_HEADERS||$!=null&&$.has(it)||PROXY_HEADER_PATTERN.test(it)||SEC_HEADER_PATTERN.test(it))&&(!_||_&&!_.has(it))||(tt[it]=et[nt].trim().replace(/\s+/g," "))}return tt},isArrayBuffer=et=>typeof ArrayBuffer=="function"&&et instanceof ArrayBuffer||Object.prototype.toString.call(et)==="[object ArrayBuffer]",getPayloadHash=async({headers:et,body:$},_)=>{for(const tt of Object.keys(et))if(tt.toLowerCase()===SHA256_HEADER)return et[tt];if($==null)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if(typeof $=="string"||ArrayBuffer.isView($)||isArrayBuffer($)){const tt=new _;return tt.update(toUint8Array($)),toHex$1(await tt.digest())}return UNSIGNED_PAYLOAD};class HeaderFormatter{format($){const _=[];for(const it of Object.keys($)){const rt=fromUtf8$2(it);_.push(Uint8Array.from([rt.byteLength]),rt,this.formatHeaderValue($[it]))}const tt=new Uint8Array(_.reduce((it,rt)=>it+rt.byteLength,0));let nt=0;for(const it of _)tt.set(it,nt),nt+=it.byteLength;return tt}formatHeaderValue($){switch($.type){case"boolean":return Uint8Array.from([$.value?0:1]);case"byte":return Uint8Array.from([2,$.value]);case"short":const _=new DataView(new ArrayBuffer(3));return _.setUint8(0,3),_.setInt16(1,$.value,!1),new Uint8Array(_.buffer);case"integer":const tt=new DataView(new ArrayBuffer(5));return tt.setUint8(0,4),tt.setInt32(1,$.value,!1),new Uint8Array(tt.buffer);case"long":const nt=new Uint8Array(9);return nt[0]=5,nt.set($.value.bytes,1),nt;case"binary":const it=new DataView(new ArrayBuffer(3+$.value.byteLength));it.setUint8(0,6),it.setUint16(1,$.value.byteLength,!1);const rt=new Uint8Array(it.buffer);return rt.set($.value,3),rt;case"string":const ot=fromUtf8$2($.value),lt=new DataView(new ArrayBuffer(3+ot.byteLength));lt.setUint8(0,7),lt.setUint16(1,ot.byteLength,!1);const st=new Uint8Array(lt.buffer);return st.set(ot,3),st;case"timestamp":const at=new Uint8Array(9);return at[0]=8,at.set(Int64.fromNumber($.value.valueOf()).bytes,1),at;case"uuid":if(!UUID_PATTERN.test($.value))throw new Error(`Invalid UUID received: ${$.value}`);const ct=new Uint8Array(17);return ct[0]=9,ct.set(fromHex$1($.value.replace(/\-/g,"")),1),ct}}}var HEADER_VALUE_TYPE;(function(et){et[et.boolTrue=0]="boolTrue",et[et.boolFalse=1]="boolFalse",et[et.byte=2]="byte",et[et.short=3]="short",et[et.integer=4]="integer",et[et.long=5]="long",et[et.byteArray=6]="byteArray",et[et.string=7]="string",et[et.timestamp=8]="timestamp",et[et.uuid=9]="uuid"})(HEADER_VALUE_TYPE||(HEADER_VALUE_TYPE={}));const UUID_PATTERN=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;class Int64{constructor($){Pt(this,"bytes");if(this.bytes=$,$.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber($){if($>9223372036854776e3||$<-9223372036854776e3)throw new Error(`${$} is too large (or, if negative, too small) to represent as an Int64`);const _=new Uint8Array(8);for(let tt=7,nt=Math.abs(Math.round($));tt>-1&&nt>0;tt--,nt/=256)_[tt]=nt;return $<0&&negate(_),new Int64(_)}valueOf(){const $=this.bytes.slice(0),_=$[0]&128;return _&&negate($),parseInt(toHex$1($),16)*(_?-1:1)}toString(){return String(this.valueOf())}}function negate(et){for(let $=0;$<8;$++)et[$]^=255;for(let $=7;$>-1&&(et[$]++,et[$]===0);$--);}const hasHeader=(et,$)=>{et=et.toLowerCase();for(const _ of Object.keys($))if(et===_.toLowerCase())return!0;return!1},moveHeadersToQuery=(et,$={})=>{var nt,it;const{headers:_,query:tt={}}=HttpRequest.clone(et);for(const rt of Object.keys(_)){const ot=rt.toLowerCase();(ot.slice(0,6)==="x-amz-"&&!((nt=$.unhoistableHeaders)!=null&&nt.has(ot))||(it=$.hoistableHeaders)!=null&&it.has(ot))&&(tt[rt]=_[rt],delete _[rt])}return{...et,headers:_,query:tt}},prepareRequest=et=>{et=HttpRequest.clone(et);for(const $ of Object.keys(et.headers))GENERATED_HEADERS.indexOf($.toLowerCase())>-1&&delete et.headers[$];return et},getCanonicalQuery=({query:et={}})=>{const $=[],_={};for(const tt of Object.keys(et)){if(tt.toLowerCase()===SIGNATURE_HEADER)continue;const nt=escapeUri(tt);$.push(nt);const it=et[tt];typeof it=="string"?_[nt]=`${nt}=${escapeUri(it)}`:Array.isArray(it)&&(_[nt]=it.slice(0).reduce((rt,ot)=>rt.concat([`${nt}=${escapeUri(ot)}`]),[]).sort().join("&"))}return $.sort().map(tt=>_[tt]).filter(tt=>tt).join("&")},iso8601=et=>toDate(et).toISOString().replace(/\.\d{3}Z$/,"Z"),toDate=et=>typeof et=="number"?new Date(et*1e3):typeof et=="string"?Number(et)?new Date(Number(et)*1e3):new Date(et):et;class SignatureV4Base{constructor({applyChecksum:$,credentials:_,region:tt,service:nt,sha256:it,uriEscapePath:rt=!0}){Pt(this,"service");Pt(this,"regionProvider");Pt(this,"credentialProvider");Pt(this,"sha256");Pt(this,"uriEscapePath");Pt(this,"applyChecksum");this.service=nt,this.sha256=it,this.uriEscapePath=rt,this.applyChecksum=typeof $=="boolean"?$:!0,this.regionProvider=normalizeProvider$1(tt),this.credentialProvider=normalizeProvider$1(_)}createCanonicalRequest($,_,tt){const nt=Object.keys(_).sort();return`${$.method}
${this.getCanonicalPath($)}
${getCanonicalQuery($)}
${nt.map(it=>`${it}:${_[it]}`).join(`
`)}

${nt.join(";")}
${tt}`}async createStringToSign($,_,tt,nt){const it=new this.sha256;it.update(toUint8Array(tt));const rt=await it.digest();return`${nt}
${$}
${_}
${toHex$1(rt)}`}getCanonicalPath({path:$}){if(this.uriEscapePath){const _=[];for(const it of $.split("/"))(it==null?void 0:it.length)!==0&&it!=="."&&(it===".."?_.pop():_.push(it));const tt=`${$!=null&&$.startsWith("/")?"/":""}${_.join("/")}${_.length>0&&($!=null&&$.endsWith("/"))?"/":""}`;return escapeUri(tt).replace(/%2F/g,"/")}return $}validateResolvedCredentials($){if(typeof $!="object"||typeof $.accessKeyId!="string"||typeof $.secretAccessKey!="string")throw new Error("Resolved credential object is not valid")}formatDate($){const _=iso8601($).replace(/[\-:]/g,"");return{longDate:_,shortDate:_.slice(0,8)}}getCanonicalHeaderList($){return Object.keys($).sort().join(";")}}class SignatureV4 extends SignatureV4Base{constructor({applyChecksum:_,credentials:tt,region:nt,service:it,sha256:rt,uriEscapePath:ot=!0}){super({applyChecksum:_,credentials:tt,region:nt,service:it,sha256:rt,uriEscapePath:ot});Pt(this,"headerFormatter",new HeaderFormatter)}async presign(_,tt={}){const{signingDate:nt=new Date,expiresIn:it=3600,unsignableHeaders:rt,unhoistableHeaders:ot,signableHeaders:lt,hoistableHeaders:st,signingRegion:at,signingService:ct}=tt,dt=await this.credentialProvider();this.validateResolvedCredentials(dt);const ut=at??await this.regionProvider(),{longDate:ft,shortDate:pt}=this.formatDate(nt);if(it>MAX_PRESIGNED_TTL)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const St=createScope(pt,ut,ct??this.service),gt=moveHeadersToQuery(prepareRequest(_),{unhoistableHeaders:ot,hoistableHeaders:st});dt.sessionToken&&(gt.query[TOKEN_QUERY_PARAM]=dt.sessionToken),gt.query[ALGORITHM_QUERY_PARAM]=ALGORITHM_IDENTIFIER,gt.query[CREDENTIAL_QUERY_PARAM]=`${dt.accessKeyId}/${St}`,gt.query[AMZ_DATE_QUERY_PARAM]=ft,gt.query[EXPIRES_QUERY_PARAM]=it.toString(10);const yt=getCanonicalHeaders(gt,rt,lt);return gt.query[SIGNED_HEADERS_QUERY_PARAM]=this.getCanonicalHeaderList(yt),gt.query[SIGNATURE_QUERY_PARAM]=await this.getSignature(ft,St,this.getSigningKey(dt,ut,pt,ct),this.createCanonicalRequest(gt,yt,await getPayloadHash(_,this.sha256))),gt}async sign(_,tt){return typeof _=="string"?this.signString(_,tt):_.headers&&_.payload?this.signEvent(_,tt):_.message?this.signMessage(_,tt):this.signRequest(_,tt)}async signEvent({headers:_,payload:tt},{signingDate:nt=new Date,priorSignature:it,signingRegion:rt,signingService:ot}){const lt=rt??await this.regionProvider(),{shortDate:st,longDate:at}=this.formatDate(nt),ct=createScope(st,lt,ot??this.service),dt=await getPayloadHash({headers:{},body:tt},this.sha256),ut=new this.sha256;ut.update(_);const ft=toHex$1(await ut.digest()),pt=[EVENT_ALGORITHM_IDENTIFIER,at,ct,it,ft,dt].join(`
`);return this.signString(pt,{signingDate:nt,signingRegion:lt,signingService:ot})}async signMessage(_,{signingDate:tt=new Date,signingRegion:nt,signingService:it}){return this.signEvent({headers:this.headerFormatter.format(_.message.headers),payload:_.message.body},{signingDate:tt,signingRegion:nt,signingService:it,priorSignature:_.priorSignature}).then(ot=>({message:_.message,signature:ot}))}async signString(_,{signingDate:tt=new Date,signingRegion:nt,signingService:it}={}){const rt=await this.credentialProvider();this.validateResolvedCredentials(rt);const ot=nt??await this.regionProvider(),{shortDate:lt}=this.formatDate(tt),st=new this.sha256(await this.getSigningKey(rt,ot,lt,it));return st.update(toUint8Array(_)),toHex$1(await st.digest())}async signRequest(_,{signingDate:tt=new Date,signableHeaders:nt,unsignableHeaders:it,signingRegion:rt,signingService:ot}={}){const lt=await this.credentialProvider();this.validateResolvedCredentials(lt);const st=rt??await this.regionProvider(),at=prepareRequest(_),{longDate:ct,shortDate:dt}=this.formatDate(tt),ut=createScope(dt,st,ot??this.service);at.headers[AMZ_DATE_HEADER]=ct,lt.sessionToken&&(at.headers[TOKEN_HEADER]=lt.sessionToken);const ft=await getPayloadHash(at,this.sha256);!hasHeader(SHA256_HEADER,at.headers)&&this.applyChecksum&&(at.headers[SHA256_HEADER]=ft);const pt=getCanonicalHeaders(at,it,nt),St=await this.getSignature(ct,ut,this.getSigningKey(lt,st,dt,ot),this.createCanonicalRequest(at,pt,ft));return at.headers[AUTH_HEADER]=`${ALGORITHM_IDENTIFIER} Credential=${lt.accessKeyId}/${ut}, SignedHeaders=${this.getCanonicalHeaderList(pt)}, Signature=${St}`,at}async getSignature(_,tt,nt,it){const rt=await this.createStringToSign(_,tt,it,ALGORITHM_IDENTIFIER),ot=new this.sha256(await nt);return ot.update(toUint8Array(rt)),toHex$1(await ot.digest())}getSigningKey(_,tt,nt,it){return getSigningKey(this.sha256,_,nt,tt,it||this.service)}}const resolveAwsSdkSigV4Config=et=>{let $=et.credentials,_=!!et.credentials,tt;Object.defineProperty(et,"credentials",{set(st){st&&st!==$&&st!==tt&&(_=!0),$=st;const at=normalizeCredentialProvider(et,{credentials:$,credentialDefaultProvider:et.credentialDefaultProvider}),ct=bindCallerConfig(et,at);_&&!ct.attributed?(tt=async dt=>ct(dt).then(ut=>setCredentialFeature(ut,"CREDENTIALS_CODE","e")),tt.memoized=ct.memoized,tt.configBound=ct.configBound,tt.attributed=!0):tt=ct},get(){return tt},enumerable:!0,configurable:!0}),et.credentials=$;const{signingEscapePath:nt=!0,systemClockOffset:it=et.systemClockOffset||0,sha256:rt}=et;let ot;return et.signer?ot=normalizeProvider(et.signer):et.regionInfoProvider?ot=()=>normalizeProvider(et.region)().then(async st=>[await et.regionInfoProvider(st,{useFipsEndpoint:await et.useFipsEndpoint(),useDualstackEndpoint:await et.useDualstackEndpoint()})||{},st]).then(([st,at])=>{const{signingRegion:ct,signingService:dt}=st;et.signingRegion=et.signingRegion||ct||at,et.signingName=et.signingName||dt||et.serviceId;const ut={...et,credentials:et.credentials,region:et.signingRegion,service:et.signingName,sha256:rt,uriEscapePath:nt},ft=et.signerConstructor||SignatureV4;return new ft(ut)}):ot=async st=>{st=Object.assign({},{name:"sigv4",signingName:et.signingName||et.defaultSigningName,signingRegion:await normalizeProvider(et.region)(),properties:{}},st);const at=st.signingRegion,ct=st.signingName;et.signingRegion=et.signingRegion||at,et.signingName=et.signingName||ct||et.serviceId;const dt={...et,credentials:et.credentials,region:et.signingRegion,service:et.signingName,sha256:rt,uriEscapePath:nt},ut=et.signerConstructor||SignatureV4;return new ut(dt)},Object.assign(et,{systemClockOffset:it,signingEscapePath:nt,signer:ot})};function normalizeCredentialProvider(et,{credentials:$,credentialDefaultProvider:_}){let tt;return $?$!=null&&$.memoized?tt=$:tt=memoizeIdentityProvider($,isIdentityExpired,doesIdentityRequireRefresh):_?tt=normalizeProvider(_(Object.assign({},et,{parentClientConfig:et}))):tt=async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")},tt.memoized=!0,tt}function bindCallerConfig(et,$){if($.configBound)return $;const _=async tt=>$({...tt,callerClientConfig:et});return _.memoized=$.memoized,_.configBound=!0,_}const TEXT_ENCODER=typeof TextEncoder=="function"?new TextEncoder:null,calculateBodyLength=et=>{if(typeof et=="string"){if(TEXT_ENCODER)return TEXT_ENCODER.encode(et).byteLength;let $=et.length;for(let _=$-1;_>=0;_--){const tt=et.charCodeAt(_);tt>127&&tt<=2047?$++:tt>2047&&tt<=65535&&($+=2),tt>=56320&&tt<=57343&&_--}return $}else{if(typeof et.byteLength=="number")return et.byteLength;if(typeof et.size=="number")return et.size}throw new Error(`Body Length computation failed for ${et}`)},getAllAliases=(et,$)=>{const _=[];if(et&&_.push(et),$)for(const tt of $)_.push(tt);return _},getMiddlewareNameWithAliases=(et,$)=>`${et||"anonymous"}${$&&$.length>0?` (a.k.a. ${$.join(",")})`:""}`,constructStack=()=>{let et=[],$=[],_=!1;const tt=new Set,nt=ct=>ct.sort((dt,ut)=>stepWeights[ut.step]-stepWeights[dt.step]||priorityWeights[ut.priority||"normal"]-priorityWeights[dt.priority||"normal"]),it=ct=>{let dt=!1;const ut=ft=>{const pt=getAllAliases(ft.name,ft.aliases);if(pt.includes(ct)){dt=!0;for(const St of pt)tt.delete(St);return!1}return!0};return et=et.filter(ut),$=$.filter(ut),dt},rt=ct=>{let dt=!1;const ut=ft=>{if(ft.middleware===ct){dt=!0;for(const pt of getAllAliases(ft.name,ft.aliases))tt.delete(pt);return!1}return!0};return et=et.filter(ut),$=$.filter(ut),dt},ot=ct=>{var dt;return et.forEach(ut=>{ct.add(ut.middleware,{...ut})}),$.forEach(ut=>{ct.addRelativeTo(ut.middleware,{...ut})}),(dt=ct.identifyOnResolve)==null||dt.call(ct,at.identifyOnResolve()),ct},lt=ct=>{const dt=[];return ct.before.forEach(ut=>{ut.before.length===0&&ut.after.length===0?dt.push(ut):dt.push(...lt(ut))}),dt.push(ct),ct.after.reverse().forEach(ut=>{ut.before.length===0&&ut.after.length===0?dt.push(ut):dt.push(...lt(ut))}),dt},st=(ct=!1)=>{const dt=[],ut=[],ft={};return et.forEach(St=>{const gt={...St,before:[],after:[]};for(const yt of getAllAliases(gt.name,gt.aliases))ft[yt]=gt;dt.push(gt)}),$.forEach(St=>{const gt={...St,before:[],after:[]};for(const yt of getAllAliases(gt.name,gt.aliases))ft[yt]=gt;ut.push(gt)}),ut.forEach(St=>{if(St.toMiddleware){const gt=ft[St.toMiddleware];if(gt===void 0){if(ct)return;throw new Error(`${St.toMiddleware} is not found when adding ${getMiddlewareNameWithAliases(St.name,St.aliases)} middleware ${St.relation} ${St.toMiddleware}`)}St.relation==="after"&&gt.after.push(St),St.relation==="before"&&gt.before.push(St)}}),nt(dt).map(lt).reduce((St,gt)=>(St.push(...gt),St),[])},at={add:(ct,dt={})=>{const{name:ut,override:ft,aliases:pt}=dt,St={step:"initialize",priority:"normal",middleware:ct,...dt},gt=getAllAliases(ut,pt);if(gt.length>0){if(gt.some(yt=>tt.has(yt))){if(!ft)throw new Error(`Duplicate middleware name '${getMiddlewareNameWithAliases(ut,pt)}'`);for(const yt of gt){const vt=et.findIndex(Et=>{var Mt;return Et.name===yt||((Mt=Et.aliases)==null?void 0:Mt.some(Rt=>Rt===yt))});if(vt===-1)continue;const Ct=et[vt];if(Ct.step!==St.step||St.priority!==Ct.priority)throw new Error(`"${getMiddlewareNameWithAliases(Ct.name,Ct.aliases)}" middleware with ${Ct.priority} priority in ${Ct.step} step cannot be overridden by "${getMiddlewareNameWithAliases(ut,pt)}" middleware with ${St.priority} priority in ${St.step} step.`);et.splice(vt,1)}}for(const yt of gt)tt.add(yt)}et.push(St)},addRelativeTo:(ct,dt)=>{const{name:ut,override:ft,aliases:pt}=dt,St={middleware:ct,...dt},gt=getAllAliases(ut,pt);if(gt.length>0){if(gt.some(yt=>tt.has(yt))){if(!ft)throw new Error(`Duplicate middleware name '${getMiddlewareNameWithAliases(ut,pt)}'`);for(const yt of gt){const vt=$.findIndex(Et=>{var Mt;return Et.name===yt||((Mt=Et.aliases)==null?void 0:Mt.some(Rt=>Rt===yt))});if(vt===-1)continue;const Ct=$[vt];if(Ct.toMiddleware!==St.toMiddleware||Ct.relation!==St.relation)throw new Error(`"${getMiddlewareNameWithAliases(Ct.name,Ct.aliases)}" middleware ${Ct.relation} "${Ct.toMiddleware}" middleware cannot be overridden by "${getMiddlewareNameWithAliases(ut,pt)}" middleware ${St.relation} "${St.toMiddleware}" middleware.`);$.splice(vt,1)}}for(const yt of gt)tt.add(yt)}$.push(St)},clone:()=>ot(constructStack()),use:ct=>{ct.applyToStack(at)},remove:ct=>typeof ct=="string"?it(ct):rt(ct),removeByTag:ct=>{let dt=!1;const ut=ft=>{const{tags:pt,name:St,aliases:gt}=ft;if(pt&&pt.includes(ct)){const yt=getAllAliases(St,gt);for(const vt of yt)tt.delete(vt);return dt=!0,!1}return!0};return et=et.filter(ut),$=$.filter(ut),dt},concat:ct=>{var ut;const dt=ot(constructStack());return dt.use(ct),dt.identifyOnResolve(_||dt.identifyOnResolve()||(((ut=ct.identifyOnResolve)==null?void 0:ut.call(ct))??!1)),dt},applyToStack:ot,identify:()=>st(!0).map(ct=>{const dt=ct.step??ct.relation+" "+ct.toMiddleware;return getMiddlewareNameWithAliases(ct.name,ct.aliases)+" - "+dt}),identifyOnResolve(ct){return typeof ct=="boolean"&&(_=ct),_},resolve:(ct,dt)=>{for(const ut of st().map(ft=>ft.middleware).reverse())ct=ut(ct,dt);return _&&console.log(at.identify()),ct}};return at},stepWeights={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},priorityWeights={high:3,normal:2,low:1};class Client{constructor($){Pt(this,"config");Pt(this,"middlewareStack",constructStack());Pt(this,"initConfig");Pt(this,"handlers");this.config=$;const{protocol:_,protocolSettings:tt}=$;tt&&typeof _=="function"&&($.protocol=new _(tt))}send($,_,tt){const nt=typeof _!="function"?_:void 0,it=typeof _=="function"?_:tt,rt=nt===void 0&&this.config.cacheMiddleware===!0;let ot;if(rt){this.handlers||(this.handlers=new WeakMap);const lt=this.handlers;lt.has($.constructor)?ot=lt.get($.constructor):(ot=$.resolveMiddleware(this.middlewareStack,this.config,nt),lt.set($.constructor,ot))}else delete this.handlers,ot=$.resolveMiddleware(this.middlewareStack,this.config,nt);if(it)ot($).then(lt=>it(null,lt.output),lt=>it(lt)).catch(()=>{});else return ot($).then(lt=>lt.output)}destroy(){var $,_,tt;(tt=(_=($=this.config)==null?void 0:$.requestHandler)==null?void 0:_.destroy)==null||tt.call(_),delete this.handlers}}const SENSITIVE_STRING="***SensitiveInformation***";function schemaLogFilter(et,$){if($==null)return $;const _=NormalizedSchema.of(et);if(_.getMergedTraits().sensitive)return SENSITIVE_STRING;if(_.isListSchema()){if(!!_.getValueSchema().getMergedTraits().sensitive)return SENSITIVE_STRING}else if(_.isMapSchema()){if(!!_.getKeySchema().getMergedTraits().sensitive||!!_.getValueSchema().getMergedTraits().sensitive)return SENSITIVE_STRING}else if(_.isStructSchema()&&typeof $=="object"){const tt=$,nt={};for(const[it,rt]of _.structIterator())tt[it]!=null&&(nt[it]=schemaLogFilter(rt,tt[it]));return nt}return $}class Command{constructor(){Pt(this,"middlewareStack",constructStack());Pt(this,"schema")}static classBuilder(){return new ClassBuilder}resolveMiddlewareWithContext($,_,tt,{middlewareFn:nt,clientName:it,commandName:rt,inputFilterSensitiveLog:ot,outputFilterSensitiveLog:lt,smithyContext:st,additionalContext:at,CommandCtor:ct}){for(const St of nt.bind(this)(ct,$,_,tt))this.middlewareStack.use(St);const dt=$.concat(this.middlewareStack),{logger:ut}=_,ft={logger:ut,clientName:it,commandName:rt,inputFilterSensitiveLog:ot,outputFilterSensitiveLog:lt,[SMITHY_CONTEXT_KEY]:{commandInstance:this,...st},...at},{requestHandler:pt}=_;return dt.resolve(St=>pt.handle(St.request,tt||{}),ft)}}class ClassBuilder{constructor(){Pt(this,"_init",()=>{});Pt(this,"_ep",{});Pt(this,"_middlewareFn",()=>[]);Pt(this,"_commandName","");Pt(this,"_clientName","");Pt(this,"_additionalContext",{});Pt(this,"_smithyContext",{});Pt(this,"_inputFilterSensitiveLog");Pt(this,"_outputFilterSensitiveLog");Pt(this,"_serializer",null);Pt(this,"_deserializer",null);Pt(this,"_operationSchema")}init($){this._init=$}ep($){return this._ep=$,this}m($){return this._middlewareFn=$,this}s($,_,tt={}){return this._smithyContext={service:$,operation:_,...tt},this}c($={}){return this._additionalContext=$,this}n($,_){return this._clientName=$,this._commandName=_,this}f($=tt=>tt,_=tt=>tt){return this._inputFilterSensitiveLog=$,this._outputFilterSensitiveLog=_,this}ser($){return this._serializer=$,this}de($){return this._deserializer=$,this}sc($){return this._operationSchema=$,this._smithyContext.operationSchema=$,this}build(){const $=this;let _;return _=class extends Command{constructor(...[nt]){super();Pt(this,"input");Pt(this,"serialize",$._serializer);Pt(this,"deserialize",$._deserializer);this.input=nt??{},$._init(this),this.schema=$._operationSchema}static getEndpointParameterInstructions(){return $._ep}resolveMiddleware(nt,it,rt){const ot=$._operationSchema,lt=(ot==null?void 0:ot[4])??(ot==null?void 0:ot.input),st=(ot==null?void 0:ot[5])??(ot==null?void 0:ot.output);return this.resolveMiddlewareWithContext(nt,it,rt,{CommandCtor:_,middlewareFn:$._middlewareFn,clientName:$._clientName,commandName:$._commandName,inputFilterSensitiveLog:$._inputFilterSensitiveLog??(ot?schemaLogFilter.bind(null,lt):at=>at),outputFilterSensitiveLog:$._outputFilterSensitiveLog??(ot?schemaLogFilter.bind(null,st):at=>at),smithyContext:$._smithyContext,additionalContext:$._additionalContext})}}}}const createAggregatedClient=(et,$)=>{for(const _ of Object.keys(et)){const tt=et[_],nt=async function(rt,ot,lt){const st=new tt(rt);if(typeof ot=="function")this.send(st,ot);else if(typeof lt=="function"){if(typeof ot!="object")throw new Error(`Expected http options but got ${typeof ot}`);this.send(st,ot||{},lt)}else return this.send(st,ot)},it=(_[0].toLowerCase()+_.slice(1)).replace(/Command$/,"");$.prototype[it]=nt}};class ServiceException extends Error{constructor(_){super(_.message);Pt(this,"$fault");Pt(this,"$response");Pt(this,"$retryable");Pt(this,"$metadata");Object.setPrototypeOf(this,Object.getPrototypeOf(this).constructor.prototype),this.name=_.name,this.$fault=_.$fault,this.$metadata=_.$metadata}static isInstance(_){if(!_)return!1;const tt=_;return ServiceException.prototype.isPrototypeOf(tt)||!!tt.$fault&&!!tt.$metadata&&(tt.$fault==="client"||tt.$fault==="server")}static[Symbol.hasInstance](_){if(!_)return!1;const tt=_;return this===ServiceException?ServiceException.isInstance(_):ServiceException.isInstance(_)?tt.name&&this.name?this.prototype.isPrototypeOf(_)||tt.name===this.name:this.prototype.isPrototypeOf(_):!1}}const decorateServiceException=(et,$={})=>{Object.entries($).filter(([,tt])=>tt!==void 0).forEach(([tt,nt])=>{(et[tt]==null||et[tt]==="")&&(et[tt]=nt)});const _=et.message||et.Message||"UnknownError";return et.message=_,delete et.Message,et},loadConfigsForDefaultMode=et=>{switch(et){case"standard":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}},getChecksumConfiguration=et=>{const $=[];for(const _ in AlgorithmId){const tt=AlgorithmId[_];et[tt]!==void 0&&$.push({algorithmId:()=>tt,checksumConstructor:()=>et[tt]})}return{addChecksumAlgorithm(_){$.push(_)},checksumAlgorithms(){return $}}},resolveChecksumRuntimeConfig=et=>{const $={};return et.checksumAlgorithms().forEach(_=>{$[_.algorithmId()]=_.checksumConstructor()}),$},getRetryConfiguration=et=>({setRetryStrategy($){et.retryStrategy=$},retryStrategy(){return et.retryStrategy}}),resolveRetryRuntimeConfig=et=>{const $={};return $.retryStrategy=et.retryStrategy(),$},getDefaultExtensionConfiguration=et=>Object.assign(getChecksumConfiguration(et),getRetryConfiguration(et)),resolveDefaultRuntimeConfig=et=>Object.assign(resolveChecksumRuntimeConfig(et),resolveRetryRuntimeConfig(et));let NoOpLogger$2=class{trace(){}debug(){}info(){}warn(){}error(){}};class ProtocolLib{constructor($=!1){Pt(this,"queryCompat");this.queryCompat=$}resolveRestContentType($,_){const tt=_.getMemberSchemas(),nt=Object.values(tt).find(it=>!!it.getMergedTraits().httpPayload);if(nt){const it=nt.getMergedTraits().mediaType;return it||(nt.isStringSchema()?"text/plain":nt.isBlobSchema()?"application/octet-stream":$)}else if(!_.isUnitSchema()&&Object.values(tt).find(rt=>{const{httpQuery:ot,httpQueryParams:lt,httpHeader:st,httpLabel:at,httpPrefixHeaders:ct}=rt.getMergedTraits();return!ot&&!lt&&!st&&!at&&ct===void 0}))return $}async getErrorSchemaOrThrowBaseException($,_,tt,nt,it,rt){let ot=_,lt=$;$.includes("#")&&([ot,lt]=$.split("#"));const st={$metadata:it,$fault:tt.statusCode<500?"client":"server"},at=TypeRegistry.for(ot);try{return{errorSchema:(rt==null?void 0:rt(at,lt))??at.getSchema($),errorMetadata:st}}catch{nt.message=nt.message??nt.Message??"UnknownError";const dt=TypeRegistry.for("smithy.ts.sdk.synthetic."+ot),ut=dt.getBaseException();if(ut){const ft=dt.getErrorCtor(ut)??Error;throw this.decorateServiceException(Object.assign(new ft({name:lt}),st),nt)}throw this.decorateServiceException(Object.assign(new Error(lt),st),nt)}}decorateServiceException($,_={}){if(this.queryCompat){const tt=$.Message??_.Message,nt=decorateServiceException($,_);tt&&(nt.message=tt),nt.Error={...nt.Error,Type:nt.Error.Type,Code:nt.Error.Code,Message:nt.Error.message??nt.Error.Message??tt};const it=nt.$metadata.requestId;return it&&(nt.RequestId=it),nt}return decorateServiceException($,_)}setQueryCompatError($,_){var nt;const tt=(nt=_.headers)==null?void 0:nt["x-amzn-query-error"];if($!==void 0&&tt!=null){const[it,rt]=tt.split(";"),ot=Object.entries($),lt={Code:it,Type:rt};Object.assign($,lt);for(const[st,at]of ot)lt[st==="message"?"Message":st]=at;delete lt.__type,$.Error=lt}}queryCompatOutput($,_){$.Error&&(_.Error=$.Error),$.Type&&(_.Type=$.Type),$.Code&&(_.Code=$.Code)}findQueryCompatibleError($,_){try{return $.getSchema(_)}catch{return $.find(nt=>{var it;return((it=NormalizedSchema.of(nt).getMergedTraits().awsQueryError)==null?void 0:it[0])===_})}}}class SerdeContextConfig{constructor(){Pt(this,"serdeContext")}setSerdeContext($){this.serdeContext=$}}function*serializingStructIterator(et,$){if(et.isUnitSchema())return;const _=et.getSchema();for(let tt=0;tt<_[4].length;++tt){const nt=_[4][tt],it=_[5][tt],rt=new NormalizedSchema([it,0],nt);!(nt in $)&&!rt.isIdempotencyToken()||(yield[nt,rt])}}function*deserializingStructIterator(et,$,_){if(et.isUnitSchema())return;const tt=et.getSchema();let nt=Object.keys($).filter(it=>it!=="__type").length;for(let it=0;it<tt[4].length&&nt!==0;++it){const rt=tt[4][it],ot=tt[5][it],lt=new NormalizedSchema([ot,0],rt);let st=rt;_&&(st=lt.getMergedTraits()[_]??rt),st in $&&(yield[rt,lt],nt-=1)}}class UnionSerde{constructor($,_){Pt(this,"from");Pt(this,"to");Pt(this,"keys");this.from=$,this.to=_,this.keys=new Set(Object.keys(this.from).filter(tt=>tt!=="__type"))}mark($){this.keys.delete($)}hasUnknown(){return this.keys.size===1&&Object.keys(this.to).length===0}writeUnknown(){if(this.hasUnknown()){const $=this.keys.values().next().value,_=this.from[$];this.to.$unknown=[$,_]}}}function jsonReviver(et,$,_){if(_!=null&&_.source){const tt=_.source;if(typeof $=="number"&&($>Number.MAX_SAFE_INTEGER||$<Number.MIN_SAFE_INTEGER||tt!==String($)))return tt.includes(".")?new NumericValue(tt,"bigDecimal"):BigInt(tt)}return $}const collectBodyString=(et,$)=>collectBody(et,$).then(_=>(($==null?void 0:$.utf8Encoder)??toUtf8)(_)),parseJsonBody=(et,$)=>collectBodyString(et,$).then(_=>{if(_.length)try{return JSON.parse(_)}catch(tt){throw(tt==null?void 0:tt.name)==="SyntaxError"&&Object.defineProperty(tt,"$responseBodyText",{value:_}),tt}return{}}),loadRestJsonErrorCode=(et,$)=>{const _=(it,rt)=>Object.keys(it).find(ot=>ot.toLowerCase()===rt.toLowerCase()),tt=it=>{let rt=it;return typeof rt=="number"&&(rt=rt.toString()),rt.indexOf(",")>=0&&(rt=rt.split(",")[0]),rt.indexOf(":")>=0&&(rt=rt.split(":")[0]),rt.indexOf("#")>=0&&(rt=rt.split("#")[1]),rt},nt=_(et.headers,"x-amzn-errortype");if(nt!==void 0)return tt(et.headers[nt]);if($&&typeof $=="object"){const it=_($,"code");if(it&&$[it]!==void 0)return tt($[it]);if($.__type!==void 0)return tt($.__type)}};class JsonShapeDeserializer extends SerdeContextConfig{constructor(_){super();Pt(this,"settings");this.settings=_}async read(_,tt){return this._read(_,typeof tt=="string"?JSON.parse(tt,jsonReviver):await parseJsonBody(tt,this.serdeContext))}readObject(_,tt){return this._read(_,tt)}_read(_,tt){const nt=tt!==null&&typeof tt=="object",it=NormalizedSchema.of(_);if(nt){if(it.isStructSchema()){const ot=it.isUnionSchema(),lt={};let st;ot&&(st=new UnionSerde(tt,lt));for(const[at,ct]of deserializingStructIterator(it,tt,this.settings.jsonName?"jsonName":!1)){const dt=this.settings.jsonName?ct.getMergedTraits().jsonName??at:at;ot&&st.mark(dt),tt[dt]!=null&&(lt[at]=this._read(ct,tt[dt]))}return ot&&st.writeUnknown(),lt}if(Array.isArray(tt)&&it.isListSchema()){const ot=it.getValueSchema(),lt=[],st=!!it.getMergedTraits().sparse;for(const at of tt)(st||at!=null)&&lt.push(this._read(ot,at));return lt}if(it.isMapSchema()){const ot=it.getValueSchema(),lt={},st=!!it.getMergedTraits().sparse;for(const[at,ct]of Object.entries(tt))(st||ct!=null)&&(lt[at]=this._read(ot,ct));return lt}}if(it.isBlobSchema()&&typeof tt=="string")return fromBase64(tt);const rt=it.getMergedTraits().mediaType;if(it.isStringSchema()&&typeof tt=="string"&&rt)return rt==="application/json"||rt.endsWith("+json")?LazyJsonString.from(tt):tt;if(it.isTimestampSchema()&&tt!=null)switch(determineTimestampFormat(it,this.settings)){case 5:return parseRfc3339DateTimeWithOffset(tt);case 6:return parseRfc7231DateTime(tt);case 7:return parseEpochTimestamp(tt);default:return console.warn("Missing timestamp format, parsing value with Date constructor:",tt),new Date(tt)}if(it.isBigIntegerSchema()&&(typeof tt=="number"||typeof tt=="string"))return BigInt(tt);if(it.isBigDecimalSchema()&&tt!=null){if(tt instanceof NumericValue)return tt;const ot=tt;return ot.type==="bigDecimal"&&"string"in ot?new NumericValue(ot.string,ot.type):new NumericValue(String(tt),"bigDecimal")}if(it.isNumericSchema()&&typeof tt=="string"){switch(tt){case"Infinity":return 1/0;case"-Infinity":return-1/0;case"NaN":return NaN}return tt}if(it.isDocumentSchema())if(nt){const ot=Array.isArray(tt)?[]:{};for(const[lt,st]of Object.entries(tt))st instanceof NumericValue?ot[lt]=st:ot[lt]=this._read(it,st);return ot}else return structuredClone(tt);return tt}}const NUMERIC_CONTROL_CHAR=String.fromCharCode(925);class JsonReplacer{constructor(){Pt(this,"values",new Map);Pt(this,"counter",0);Pt(this,"stage",0)}createReplacer(){if(this.stage===1)throw new Error("@aws-sdk/core/protocols - JsonReplacer already created.");if(this.stage===2)throw new Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");return this.stage=1,($,_)=>{if(_ instanceof NumericValue){const tt=`${NUMERIC_CONTROL_CHAR+"nv"+this.counter++}_`+_.string;return this.values.set(`"${tt}"`,_.string),tt}if(typeof _=="bigint"){const tt=_.toString(),nt=`${NUMERIC_CONTROL_CHAR+"b"+this.counter++}_`+tt;return this.values.set(`"${nt}"`,tt),nt}return _}}replaceInJson($){if(this.stage===0)throw new Error("@aws-sdk/core/protocols - JsonReplacer not created yet.");if(this.stage===2)throw new Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");if(this.stage=2,this.counter===0)return $;for(const[_,tt]of this.values)$=$.replace(_,tt);return $}}class JsonShapeSerializer extends SerdeContextConfig{constructor(_){super();Pt(this,"settings");Pt(this,"buffer");Pt(this,"useReplacer",!1);Pt(this,"rootSchema");this.settings=_}write(_,tt){this.rootSchema=NormalizedSchema.of(_),this.buffer=this._write(this.rootSchema,tt)}writeDiscriminatedDocument(_,tt){this.write(_,tt),typeof this.buffer=="object"&&(this.buffer.__type=NormalizedSchema.of(_).getName(!0))}flush(){const{rootSchema:_,useReplacer:tt}=this;if(this.rootSchema=void 0,this.useReplacer=!1,_!=null&&_.isStructSchema()||_!=null&&_.isDocumentSchema()){if(!tt)return JSON.stringify(this.buffer);const nt=new JsonReplacer;return nt.replaceInJson(JSON.stringify(this.buffer,nt.createReplacer(),0))}return this.buffer}_write(_,tt,nt){var ot,lt;const it=tt!==null&&typeof tt=="object",rt=NormalizedSchema.of(_);if(it){if(rt.isStructSchema()){const st={};for(const[at,ct]of serializingStructIterator(rt,tt)){const dt=this._write(ct,tt[at],rt);if(dt!==void 0){const ut=ct.getMergedTraits().jsonName,ft=this.settings.jsonName?ut??at:at;st[ft]=dt}}if(rt.isUnionSchema()&&Object.keys(st).length===0){const{$unknown:at}=tt;if(Array.isArray(at)){const[ct,dt]=at;st[ct]=this._write(15,dt)}}return st}if(Array.isArray(tt)&&rt.isListSchema()){const st=rt.getValueSchema(),at=[],ct=!!rt.getMergedTraits().sparse;for(const dt of tt)(ct||dt!=null)&&at.push(this._write(st,dt));return at}if(rt.isMapSchema()){const st=rt.getValueSchema(),at={},ct=!!rt.getMergedTraits().sparse;for(const[dt,ut]of Object.entries(tt))(ct||ut!=null)&&(at[dt]=this._write(st,ut));return at}if(tt instanceof Uint8Array&&(rt.isBlobSchema()||rt.isDocumentSchema()))return rt===this.rootSchema?tt:(((ot=this.serdeContext)==null?void 0:ot.base64Encoder)??toBase64)(tt);if(tt instanceof Date&&(rt.isTimestampSchema()||rt.isDocumentSchema()))switch(determineTimestampFormat(rt,this.settings)){case 5:return tt.toISOString().replace(".000Z","Z");case 6:return dateToUtcString(tt);case 7:return tt.getTime()/1e3;default:return console.warn("Missing timestamp format, using epoch seconds",tt),tt.getTime()/1e3}tt instanceof NumericValue&&(this.useReplacer=!0)}if(!(tt===null&&(nt!=null&&nt.isStructSchema()))){if(rt.isStringSchema()){if(typeof tt>"u"&&rt.isIdempotencyToken())return v4();const st=rt.getMergedTraits().mediaType;return tt!=null&&st&&(st==="application/json"||st.endsWith("+json"))?LazyJsonString.from(tt):tt}if(typeof tt=="number"&&rt.isNumericSchema())return Math.abs(tt)===1/0||isNaN(tt)?String(tt):tt;if(typeof tt=="string"&&rt.isBlobSchema())return rt===this.rootSchema?tt:(((lt=this.serdeContext)==null?void 0:lt.base64Encoder)??toBase64)(tt);if(typeof tt=="bigint"&&(this.useReplacer=!0),rt.isDocumentSchema())if(it){const st=Array.isArray(tt)?[]:{};for(const[at,ct]of Object.entries(tt))ct instanceof NumericValue?(this.useReplacer=!0,st[at]=ct):st[at]=this._write(rt,ct);return st}else return structuredClone(tt);return tt}}}class JsonCodec extends SerdeContextConfig{constructor(_){super();Pt(this,"settings");this.settings=_}createSerializer(){const _=new JsonShapeSerializer(this.settings);return _.setSerdeContext(this.serdeContext),_}createDeserializer(){const _=new JsonShapeDeserializer(this.settings);return _.setSerdeContext(this.serdeContext),_}}class AwsRestJsonProtocol extends HttpBindingProtocol{constructor({defaultNamespace:_}){super({defaultNamespace:_});Pt(this,"serializer");Pt(this,"deserializer");Pt(this,"codec");Pt(this,"mixin",new ProtocolLib);const tt={timestampFormat:{useTrait:!0,default:7},httpBindings:!0,jsonName:!0};this.codec=new JsonCodec(tt),this.serializer=new HttpInterceptingShapeSerializer(this.codec.createSerializer(),tt),this.deserializer=new HttpInterceptingShapeDeserializer(this.codec.createDeserializer(),tt)}getShapeId(){return"aws.protocols#restJson1"}getPayloadCodec(){return this.codec}setSerdeContext(_){this.codec.setSerdeContext(_),super.setSerdeContext(_)}async serializeRequest(_,tt,nt){const it=await super.serializeRequest(_,tt,nt),rt=NormalizedSchema.of(_.input);if(!it.headers["content-type"]){const ot=this.mixin.resolveRestContentType(this.getDefaultContentType(),rt);ot&&(it.headers["content-type"]=ot)}return it.body==null&&it.headers["content-type"]===this.getDefaultContentType()&&(it.body="{}"),it}async deserializeResponse(_,tt,nt){const it=await super.deserializeResponse(_,tt,nt),rt=NormalizedSchema.of(_.output);for(const[ot,lt]of rt.structIterator())lt.getMemberTraits().httpPayload&&!(ot in it)&&(it[ot]=null);return it}async handleError(_,tt,nt,it,rt){const ot=loadRestJsonErrorCode(nt,it)??"Unknown",{errorSchema:lt,errorMetadata:st}=await this.mixin.getErrorSchemaOrThrowBaseException(ot,this.options.defaultNamespace,nt,it,rt),at=NormalizedSchema.of(lt),ct=it.message??it.Message??"Unknown",dt=TypeRegistry.for(lt[1]).getErrorCtor(lt)??Error,ut=new dt(ct);await this.deserializeHttpMessage(lt,tt,nt,it);const ft={};for(const[pt,St]of at.structIterator()){const gt=St.getMergedTraits().jsonName??pt;ft[pt]=this.codec.createDeserializer().readObject(St,it[gt])}throw this.mixin.decorateServiceException(Object.assign(ut,st,{$fault:at.getMergedTraits().error,message:ct},ft),it)}getDefaultContentType(){return"application/json"}}const ACCOUNT_ID_ENDPOINT_REGEX=/\d{12}\.ddb/;async function checkFeatures(et,$,_){var it,rt,ot,lt,st,at,ct;const tt=_.request;if(((it=tt==null?void 0:tt.headers)==null?void 0:it["smithy-protocol"])==="rpc-v2-cbor"&&setFeature(et,"PROTOCOL_RPC_V2_CBOR","M"),typeof $.retryStrategy=="function"){const dt=await $.retryStrategy();typeof dt.acquireInitialRetryToken=="function"?(ot=(rt=dt.constructor)==null?void 0:rt.name)!=null&&ot.includes("Adaptive")?setFeature(et,"RETRY_MODE_ADAPTIVE","F"):setFeature(et,"RETRY_MODE_STANDARD","E"):setFeature(et,"RETRY_MODE_LEGACY","D")}if(typeof $.accountIdEndpointMode=="function"){const dt=et.endpointV2;switch(String((lt=dt==null?void 0:dt.url)==null?void 0:lt.hostname).match(ACCOUNT_ID_ENDPOINT_REGEX)&&setFeature(et,"ACCOUNT_ID_ENDPOINT","O"),await((st=$.accountIdEndpointMode)==null?void 0:st.call($))){case"disabled":setFeature(et,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":setFeature(et,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":setFeature(et,"ACCOUNT_ID_MODE_REQUIRED","R");break}}const nt=(ct=(at=et.__smithy_context)==null?void 0:at.selectedHttpAuthScheme)==null?void 0:ct.identity;if(nt!=null&&nt.$source){const dt=nt;dt.accountId&&setFeature(et,"RESOLVED_ACCOUNT_ID","T");for(const[ut,ft]of Object.entries(dt.$source??{}))setFeature(et,ut,ft)}}const USER_AGENT="user-agent",X_AMZ_USER_AGENT="x-amz-user-agent",SPACE=" ",UA_NAME_SEPARATOR="/",UA_NAME_ESCAPE_REGEX=/[^!$%&'*+\-.^_`|~\w]/g,UA_VALUE_ESCAPE_REGEX=/[^!$%&'*+\-.^_`|~\w#]/g,UA_ESCAPE_CHAR="-",BYTE_LIMIT=1024;function encodeFeatures(et){let $="";for(const _ in et){const tt=et[_];if($.length+tt.length+1<=BYTE_LIMIT){$.length?$+=","+tt:$+=tt;continue}break}return $}const userAgentMiddleware=et=>($,_)=>async tt=>{var ut,ft,pt,St;const{request:nt}=tt;if(!HttpRequest.isInstance(nt))return $(tt);const{headers:it}=nt,rt=((ut=_==null?void 0:_.userAgent)==null?void 0:ut.map(escapeUserAgent))||[],ot=(await et.defaultUserAgentProvider()).map(escapeUserAgent);await checkFeatures(_,et,tt);const lt=_;ot.push(`m/${encodeFeatures(Object.assign({},(ft=_.__smithy_context)==null?void 0:ft.features,(pt=lt.__aws_sdk_context)==null?void 0:pt.features))}`);const st=((St=et==null?void 0:et.customUserAgent)==null?void 0:St.map(escapeUserAgent))||[],at=await et.userAgentAppId();at&&ot.push(escapeUserAgent(["app",`${at}`]));const ct=[].concat([...ot,...rt,...st]).join(SPACE),dt=[...ot.filter(gt=>gt.startsWith("aws-sdk-")),...st].join(SPACE);return et.runtime!=="browser"?(dt&&(it[X_AMZ_USER_AGENT]=it[X_AMZ_USER_AGENT]?`${it[USER_AGENT]} ${dt}`:dt),it[USER_AGENT]=ct):it[X_AMZ_USER_AGENT]=ct,$({...tt,request:nt})},escapeUserAgent=et=>{var rt;const $=et[0].split(UA_NAME_SEPARATOR).map(ot=>ot.replace(UA_NAME_ESCAPE_REGEX,UA_ESCAPE_CHAR)).join(UA_NAME_SEPARATOR),_=(rt=et[1])==null?void 0:rt.replace(UA_VALUE_ESCAPE_REGEX,UA_ESCAPE_CHAR),tt=$.indexOf(UA_NAME_SEPARATOR),nt=$.substring(0,tt);let it=$.substring(tt+1);return nt==="api"&&(it=it.toLowerCase()),[nt,it,_].filter(ot=>ot&&ot.length>0).reduce((ot,lt,st)=>{switch(st){case 0:return lt;case 1:return`${ot}/${lt}`;default:return`${ot}#${lt}`}},"")},getUserAgentMiddlewareOptions={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},getUserAgentPlugin=et=>({applyToStack:$=>{$.add(userAgentMiddleware(et),getUserAgentMiddlewareOptions)}}),DEFAULT_USE_DUALSTACK_ENDPOINT=!1,DEFAULT_USE_FIPS_ENDPOINT=!1,validRegions=new Set,checkRegion=(et,$=isValidHostLabel)=>{if(!validRegions.has(et)&&!$(et))if(et==="*")console.warn('@smithy/config-resolver WARN - Please use the caller region instead of "*". See "sigv4a" in https://github.com/aws/aws-sdk-js-v3/blob/main/supplemental-docs/CLIENTS.md.');else throw new Error(`Region not accepted: region="${et}" is not a valid hostname component.`);else validRegions.add(et)},isFipsRegion=et=>typeof et=="string"&&(et.startsWith("fips-")||et.endsWith("-fips")),getRealRegion=et=>isFipsRegion(et)?["fips-aws-window","aws-fips"].includes(et)?"us-east-1":et.replace(/fips-(dkr-|prod-)?|-fips/,""):et,resolveRegionConfig=et=>{const{region:$,useFipsEndpoint:_}=et;if(!$)throw new Error("Region is missing");return Object.assign(et,{region:async()=>{const tt=typeof $=="function"?await $():$,nt=getRealRegion(tt);return checkRegion(nt),nt},useFipsEndpoint:async()=>{const tt=typeof $=="string"?$:await $();return isFipsRegion(tt)?!0:typeof _!="function"?Promise.resolve(!!_):_()}})},CONTENT_LENGTH_HEADER="content-length";function contentLengthMiddleware(et){return $=>async _=>{const tt=_.request;if(HttpRequest.isInstance(tt)){const{body:nt,headers:it}=tt;if(nt&&Object.keys(it).map(rt=>rt.toLowerCase()).indexOf(CONTENT_LENGTH_HEADER)===-1)try{const rt=et(nt);tt.headers={...tt.headers,[CONTENT_LENGTH_HEADER]:String(rt)}}catch{}}return $({..._,request:tt})}}const contentLengthMiddlewareOptions={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},getContentLengthPlugin=et=>({applyToStack:$=>{$.add(contentLengthMiddleware(et.bodyLengthChecker),contentLengthMiddlewareOptions)}}),resolveParamsForS3=async et=>{const $=(et==null?void 0:et.Bucket)||"";if(typeof et.Bucket=="string"&&(et.Bucket=$.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),isArnBucketName($)){if(et.ForcePathStyle===!0)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!isDnsCompatibleBucketName($)||$.indexOf(".")!==-1&&!String(et.Endpoint).startsWith("http:")||$.toLowerCase()!==$||$.length<3)&&(et.ForcePathStyle=!0);return et.DisableMultiRegionAccessPoints&&(et.disableMultiRegionAccessPoints=!0,et.DisableMRAP=!0),et},DOMAIN_PATTERN=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,IP_ADDRESS_PATTERN=/(\d+\.){3}\d+/,DOTS_PATTERN=/\.\./,isDnsCompatibleBucketName=et=>DOMAIN_PATTERN.test(et)&&!IP_ADDRESS_PATTERN.test(et)&&!DOTS_PATTERN.test(et),isArnBucketName=et=>{const[$,_,tt,,,nt]=et.split(":"),it=$==="arn"&&et.split(":").length>=6,rt=!!(it&&_&&tt&&nt);if(it&&!rt)throw new Error(`Invalid ARN: ${et} was an invalid ARN.`);return rt},createConfigValueProvider=(et,$,_,tt=!1)=>{const nt=async()=>{let it;if(tt){const rt=_.clientContextParams;it=(rt==null?void 0:rt[et])??_[et]??_[$]}else it=_[et]??_[$];return typeof it=="function"?it():it};return et==="credentialScope"||$==="CredentialScope"?async()=>{const it=typeof _.credentials=="function"?await _.credentials():_.credentials;return(it==null?void 0:it.credentialScope)??(it==null?void 0:it.CredentialScope)}:et==="accountId"||$==="AccountId"?async()=>{const it=typeof _.credentials=="function"?await _.credentials():_.credentials;return(it==null?void 0:it.accountId)??(it==null?void 0:it.AccountId)}:et==="endpoint"||$==="endpoint"?async()=>{if(_.isCustomEndpoint===!1)return;const it=await nt();if(it&&typeof it=="object"){if("url"in it)return it.url.href;if("hostname"in it){const{protocol:rt,hostname:ot,port:lt,path:st}=it;return`${rt}//${ot}${lt?":"+lt:""}${st}`}}return it}:nt},getEndpointFromConfig=async et=>{},toEndpointV1=et=>typeof et=="object"?"url"in et?parseUrl(et.url):et:parseUrl(et),getEndpointFromInstructions=async(et,$,_,tt)=>{if(!_.isCustomEndpoint){let rt;_.serviceConfiguredEndpoint?rt=await _.serviceConfiguredEndpoint():rt=await getEndpointFromConfig(_.serviceId),rt&&(_.endpoint=()=>Promise.resolve(toEndpointV1(rt)),_.isCustomEndpoint=!0)}const nt=await resolveParams(et,$,_);if(typeof _.endpointProvider!="function")throw new Error("config.endpointProvider is not set.");return _.endpointProvider(nt,tt)},resolveParams=async(et,$,_)=>{var it;const tt={},nt=((it=$==null?void 0:$.getEndpointParameterInstructions)==null?void 0:it.call($))||{};for(const[rt,ot]of Object.entries(nt))switch(ot.type){case"staticContextParams":tt[rt]=ot.value;break;case"contextParams":tt[rt]=et[ot.name];break;case"clientContextParams":case"builtInParams":tt[rt]=await createConfigValueProvider(ot.name,rt,_,ot.type!=="builtInParams")();break;case"operationContextParams":tt[rt]=ot.get(et);break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(ot))}return Object.keys(nt).length===0&&Object.assign(tt,_),String(_.serviceId).toLowerCase()==="s3"&&await resolveParamsForS3(tt),tt},endpointMiddleware=({config:et,instructions:$})=>(_,tt)=>async nt=>{var ot,lt,st;et.isCustomEndpoint&&setFeature$1(tt,"ENDPOINT_OVERRIDE","N");const it=await getEndpointFromInstructions(nt.input,{getEndpointParameterInstructions(){return $}},{...et},tt);tt.endpointV2=it,tt.authSchemes=(ot=it.properties)==null?void 0:ot.authSchemes;const rt=(lt=tt.authSchemes)==null?void 0:lt[0];if(rt){tt.signing_region=rt.signingRegion,tt.signing_service=rt.signingName;const at=getSmithyContext(tt),ct=(st=at==null?void 0:at.selectedHttpAuthScheme)==null?void 0:st.httpAuthOption;ct&&(ct.signingProperties=Object.assign(ct.signingProperties||{},{signing_region:rt.signingRegion,signingRegion:rt.signingRegion,signing_service:rt.signingName,signingName:rt.signingName,signingRegionSet:rt.signingRegionSet},rt.properties))}return _({...nt})},endpointMiddlewareOptions={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:serializerMiddlewareOption$1.name},getEndpointPlugin=(et,$)=>({applyToStack:_=>{_.addRelativeTo(endpointMiddleware({config:et,instructions:$}),endpointMiddlewareOptions)}}),resolveEndpointConfig=et=>{const $=et.tls??!0,{endpoint:_,useDualstackEndpoint:tt,useFipsEndpoint:nt}=et,it=_!=null?async()=>toEndpointV1(await normalizeProvider$1(_)()):void 0,ot=Object.assign(et,{endpoint:it,tls:$,isCustomEndpoint:!!_,useDualstackEndpoint:normalizeProvider$1(tt??!1),useFipsEndpoint:normalizeProvider$1(nt??!1)});let lt;return ot.serviceConfiguredEndpoint=async()=>(et.serviceId&&!lt&&(lt=getEndpointFromConfig(et.serviceId)),lt),ot};var RETRY_MODES;(function(et){et.STANDARD="standard",et.ADAPTIVE="adaptive"})(RETRY_MODES||(RETRY_MODES={}));const DEFAULT_MAX_ATTEMPTS=3,DEFAULT_RETRY_MODE=RETRY_MODES.STANDARD,THROTTLING_ERROR_CODES=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],TRANSIENT_ERROR_CODES=["TimeoutError","RequestTimeout","RequestTimeoutException"],TRANSIENT_ERROR_STATUS_CODES=[500,502,503,504],NODEJS_TIMEOUT_ERROR_CODES=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],NODEJS_NETWORK_ERROR_CODES=["EHOSTUNREACH","ENETUNREACH","ENOTFOUND"],isRetryableByTrait=et=>(et==null?void 0:et.$retryable)!==void 0,isClockSkewCorrectedError=et=>{var $;return($=et.$metadata)==null?void 0:$.clockSkewCorrected},isBrowserNetworkError=et=>{const $=new Set(["Failed to fetch","NetworkError when attempting to fetch resource","The Internet connection appears to be offline","Load failed","Network request failed"]);return et&&et instanceof TypeError?$.has(et.message):!1},isThrottlingError=et=>{var $,_;return(($=et.$metadata)==null?void 0:$.httpStatusCode)===429||THROTTLING_ERROR_CODES.includes(et.name)||((_=et.$retryable)==null?void 0:_.throttling)==!0},isTransientError=(et,$=0)=>{var _;return isRetryableByTrait(et)||isClockSkewCorrectedError(et)||TRANSIENT_ERROR_CODES.includes(et.name)||NODEJS_TIMEOUT_ERROR_CODES.includes((et==null?void 0:et.code)||"")||NODEJS_NETWORK_ERROR_CODES.includes((et==null?void 0:et.code)||"")||TRANSIENT_ERROR_STATUS_CODES.includes(((_=et.$metadata)==null?void 0:_.httpStatusCode)||0)||isBrowserNetworkError(et)||et.cause!==void 0&&$<=10&&isTransientError(et.cause,$+1)},isServerError=et=>{var $;if((($=et.$metadata)==null?void 0:$.httpStatusCode)!==void 0){const _=et.$metadata.httpStatusCode;return 500<=_&&_<=599&&!isTransientError(et)}return!1},Kn=class Kn{constructor($){Pt(this,"beta");Pt(this,"minCapacity");Pt(this,"minFillRate");Pt(this,"scaleConstant");Pt(this,"smooth");Pt(this,"currentCapacity",0);Pt(this,"enabled",!1);Pt(this,"lastMaxRate",0);Pt(this,"measuredTxRate",0);Pt(this,"requestCount",0);Pt(this,"fillRate");Pt(this,"lastThrottleTime");Pt(this,"lastTimestamp",0);Pt(this,"lastTxRateBucket");Pt(this,"maxCapacity");Pt(this,"timeWindow",0);this.beta=($==null?void 0:$.beta)??.7,this.minCapacity=($==null?void 0:$.minCapacity)??1,this.minFillRate=($==null?void 0:$.minFillRate)??.5,this.scaleConstant=($==null?void 0:$.scaleConstant)??.4,this.smooth=($==null?void 0:$.smooth)??.8;const _=this.getCurrentTimeInSeconds();this.lastThrottleTime=_,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket($){if(this.enabled){if(this.refillTokenBucket(),$>this.currentCapacity){const _=($-this.currentCapacity)/this.fillRate*1e3;await new Promise(tt=>Kn.setTimeoutFn(tt,_))}this.currentCapacity=this.currentCapacity-$}}refillTokenBucket(){const $=this.getCurrentTimeInSeconds();if(!this.lastTimestamp){this.lastTimestamp=$;return}const _=($-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+_),this.lastTimestamp=$}updateClientSendingRate($){let _;if(this.updateMeasuredRate(),isThrottlingError($)){const nt=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=nt,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),_=this.cubicThrottle(nt),this.enableTokenBucket()}else this.calculateTimeWindow(),_=this.cubicSuccess(this.getCurrentTimeInSeconds());const tt=Math.min(_,2*this.measuredTxRate);this.updateTokenBucketRate(tt)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle($){return this.getPrecise($*this.beta)}cubicSuccess($){return this.getPrecise(this.scaleConstant*Math.pow($-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate($){this.refillTokenBucket(),this.fillRate=Math.max($,this.minFillRate),this.maxCapacity=Math.max($,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const $=this.getCurrentTimeInSeconds(),_=Math.floor($*2)/2;if(this.requestCount++,_>this.lastTxRateBucket){const tt=this.requestCount/(_-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(tt*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=_}}getPrecise($){return parseFloat($.toFixed(8))}};Pt(Kn,"setTimeoutFn",setTimeout);let DefaultRateLimiter=Kn;const DEFAULT_RETRY_DELAY_BASE=100,MAXIMUM_RETRY_DELAY=20*1e3,THROTTLING_RETRY_DELAY_BASE=500,INITIAL_RETRY_TOKENS=500,RETRY_COST=5,TIMEOUT_RETRY_COST=10,NO_RETRY_INCREMENT=1,INVOCATION_ID_HEADER="amz-sdk-invocation-id",REQUEST_HEADER="amz-sdk-request",getDefaultRetryBackoffStrategy=()=>{let et=DEFAULT_RETRY_DELAY_BASE;return{computeNextBackoffDelay:tt=>Math.floor(Math.min(MAXIMUM_RETRY_DELAY,Math.random()*2**tt*et)),setDelayBase:tt=>{et=tt}}},createDefaultRetryToken=({retryDelay:et,retryCount:$,retryCost:_})=>({getRetryCount:()=>$,getRetryDelay:()=>Math.min(MAXIMUM_RETRY_DELAY,et),getRetryCost:()=>_});class StandardRetryStrategy{constructor($){Pt(this,"maxAttempts");Pt(this,"mode",RETRY_MODES.STANDARD);Pt(this,"capacity",INITIAL_RETRY_TOKENS);Pt(this,"retryBackoffStrategy",getDefaultRetryBackoffStrategy());Pt(this,"maxAttemptsProvider");this.maxAttempts=$,this.maxAttemptsProvider=typeof $=="function"?$:async()=>$}async acquireInitialRetryToken($){return createDefaultRetryToken({retryDelay:DEFAULT_RETRY_DELAY_BASE,retryCount:0})}async refreshRetryTokenForRetry($,_){const tt=await this.getMaxAttempts();if(this.shouldRetry($,_,tt)){const nt=_.errorType;this.retryBackoffStrategy.setDelayBase(nt==="THROTTLING"?THROTTLING_RETRY_DELAY_BASE:DEFAULT_RETRY_DELAY_BASE);const it=this.retryBackoffStrategy.computeNextBackoffDelay($.getRetryCount()),rt=_.retryAfterHint?Math.max(_.retryAfterHint.getTime()-Date.now()||0,it):it,ot=this.getCapacityCost(nt);return this.capacity-=ot,createDefaultRetryToken({retryDelay:rt,retryCount:$.getRetryCount()+1,retryCost:ot})}throw new Error("No retry token available")}recordSuccess($){this.capacity=Math.max(INITIAL_RETRY_TOKENS,this.capacity+($.getRetryCost()??NO_RETRY_INCREMENT))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch{return console.warn(`Max attempts provider could not resolve. Using default of ${DEFAULT_MAX_ATTEMPTS}`),DEFAULT_MAX_ATTEMPTS}}shouldRetry($,_,tt){return $.getRetryCount()+1<tt&&this.capacity>=this.getCapacityCost(_.errorType)&&this.isRetryableError(_.errorType)}getCapacityCost($){return $==="TRANSIENT"?TIMEOUT_RETRY_COST:RETRY_COST}isRetryableError($){return $==="THROTTLING"||$==="TRANSIENT"}}class AdaptiveRetryStrategy{constructor($,_){Pt(this,"maxAttemptsProvider");Pt(this,"rateLimiter");Pt(this,"standardRetryStrategy");Pt(this,"mode",RETRY_MODES.ADAPTIVE);this.maxAttemptsProvider=$;const{rateLimiter:tt}=_??{};this.rateLimiter=tt??new DefaultRateLimiter,this.standardRetryStrategy=new StandardRetryStrategy($)}async acquireInitialRetryToken($){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken($)}async refreshRetryTokenForRetry($,_){return this.rateLimiter.updateClientSendingRate(_),this.standardRetryStrategy.refreshRetryTokenForRetry($,_)}recordSuccess($){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess($)}}const asSdkError=et=>et instanceof Error?et:et instanceof Object?Object.assign(new Error,et):typeof et=="string"?new Error(et):new Error(`AWS SDK error wrapper for ${et}`),resolveRetryConfig=et=>{const{retryStrategy:$,retryMode:_,maxAttempts:tt}=et,nt=normalizeProvider$1(tt??DEFAULT_MAX_ATTEMPTS);return Object.assign(et,{maxAttempts:nt,retryStrategy:async()=>$||(await normalizeProvider$1(_)()===RETRY_MODES.ADAPTIVE?new AdaptiveRetryStrategy(nt):new StandardRetryStrategy(nt))})},isStreamingPayload=et=>(et==null?void 0:et.body)instanceof ReadableStream,retryMiddleware=et=>($,_)=>async tt=>{var rt;let nt=await et.retryStrategy();const it=await et.maxAttempts();if(isRetryStrategyV2(nt)){nt=nt;let ot=await nt.acquireInitialRetryToken(_.partition_id),lt=new Error,st=0,at=0;const{request:ct}=tt,dt=HttpRequest.isInstance(ct);for(dt&&(ct.headers[INVOCATION_ID_HEADER]=v4());;)try{dt&&(ct.headers[REQUEST_HEADER]=`attempt=${st+1}; max=${it}`);const{response:ut,output:ft}=await $(tt);return nt.recordSuccess(ot),ft.$metadata.attempts=st+1,ft.$metadata.totalRetryDelay=at,{response:ut,output:ft}}catch(ut){const ft=getRetryErrorInfo(ut);if(lt=asSdkError(ut),dt&&isStreamingPayload(ct))throw(rt=_.logger instanceof NoOpLogger$2?console:_.logger)==null||rt.warn("An error was encountered in a non-retryable streaming request."),lt;try{ot=await nt.refreshRetryTokenForRetry(ot,ft)}catch{throw lt.$metadata||(lt.$metadata={}),lt.$metadata.attempts=st+1,lt.$metadata.totalRetryDelay=at,lt}st=ot.getRetryCount();const pt=ot.getRetryDelay();at+=pt,await new Promise(St=>setTimeout(St,pt))}}else return nt=nt,nt!=null&&nt.mode&&(_.userAgent=[..._.userAgent||[],["cfg/retry-mode",nt.mode]]),nt.retry($,tt)},isRetryStrategyV2=et=>typeof et.acquireInitialRetryToken<"u"&&typeof et.refreshRetryTokenForRetry<"u"&&typeof et.recordSuccess<"u",getRetryErrorInfo=et=>{const $={error:et,errorType:getRetryErrorType(et)},_=getRetryAfterHint(et.$response);return _&&($.retryAfterHint=_),$},getRetryErrorType=et=>isThrottlingError(et)?"THROTTLING":isTransientError(et)?"TRANSIENT":isServerError(et)?"SERVER_ERROR":"CLIENT_ERROR",retryMiddlewareOptions={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},getRetryPlugin=et=>({applyToStack:$=>{$.add(retryMiddleware(et),retryMiddlewareOptions)}}),getRetryAfterHint=et=>{if(!HttpResponse.isInstance(et))return;const $=Object.keys(et.headers).find(it=>it.toLowerCase()==="retry-after");if(!$)return;const _=et.headers[$],tt=Number(_);return Number.isNaN(tt)?new Date(_):new Date(tt*1e3)},defaultChimeSDKMessagingHttpAuthSchemeParametersProvider=async(et,$,_)=>({operation:getSmithyContext($).operation,region:await normalizeProvider$1(et.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});function createAwsAuthSigv4HttpAuthOption(et){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"chime",region:et.region},propertiesExtractor:($,_)=>({signingProperties:{config:$,context:_}})}}const defaultChimeSDKMessagingHttpAuthSchemeProvider=et=>{const $=[];switch(et.operation){default:$.push(createAwsAuthSigv4HttpAuthOption(et))}return $},resolveHttpAuthSchemeConfig=et=>{const $=resolveAwsSdkSigV4Config(et);return Object.assign($,{authSchemePreference:normalizeProvider$1(et.authSchemePreference??[])})},resolveClientEndpointParameters=et=>Object.assign(et,{useDualstackEndpoint:et.useDualstackEndpoint??!1,useFipsEndpoint:et.useFipsEndpoint??!1,defaultSigningName:"chime"}),commonParams={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}},name="@aws-sdk/client-chime-sdk-messaging",description="AWS SDK for JavaScript Chime Sdk Messaging Client for Node.js, Browser and React Native",version="3.962.0",scripts={build:"concurrently 'yarn:build:types' 'yarn:build:es' && yarn build:cjs","build:cjs":"node ../../scripts/compilation/inline client-chime-sdk-messaging","build:es":"tsc -p tsconfig.es.json","build:include:deps":'yarn g:turbo run build -F="$npm_package_name"',"build:types":"tsc -p tsconfig.types.json","build:types:downlevel":"downlevel-dts dist-types dist-types/ts3.4",clean:"rimraf ./dist-* && rimraf *.tsbuildinfo","extract:docs":"api-extractor run --local","generate:client":"node ../../scripts/generate-clients/single-service --solo chime-sdk-messaging","test:index":"tsc --noEmit ./test/index-types.ts && node ./test/index-objects.spec.mjs"},main="./dist-cjs/index.js",types$1="./dist-types/index.d.ts",module="./dist-es/index.js",sideEffects=!1,dependencies={"@aws-crypto/sha256-browser":"5.2.0","@aws-crypto/sha256-js":"5.2.0","@aws-sdk/core":"3.957.0","@aws-sdk/credential-provider-node":"3.962.0","@aws-sdk/middleware-host-header":"3.957.0","@aws-sdk/middleware-logger":"3.957.0","@aws-sdk/middleware-recursion-detection":"3.957.0","@aws-sdk/middleware-user-agent":"3.957.0","@aws-sdk/region-config-resolver":"3.957.0","@aws-sdk/types":"3.957.0","@aws-sdk/util-endpoints":"3.957.0","@aws-sdk/util-user-agent-browser":"3.957.0","@aws-sdk/util-user-agent-node":"3.957.0","@smithy/config-resolver":"^4.4.5","@smithy/core":"^3.20.0","@smithy/fetch-http-handler":"^5.3.8","@smithy/hash-node":"^4.2.7","@smithy/invalid-dependency":"^4.2.7","@smithy/middleware-content-length":"^4.2.7","@smithy/middleware-endpoint":"^4.4.1","@smithy/middleware-retry":"^4.4.17","@smithy/middleware-serde":"^4.2.8","@smithy/middleware-stack":"^4.2.7","@smithy/node-config-provider":"^4.3.7","@smithy/node-http-handler":"^4.4.7","@smithy/protocol-http":"^5.3.7","@smithy/smithy-client":"^4.10.2","@smithy/types":"^4.11.0","@smithy/url-parser":"^4.2.7","@smithy/util-base64":"^4.3.0","@smithy/util-body-length-browser":"^4.2.0","@smithy/util-body-length-node":"^4.2.1","@smithy/util-defaults-mode-browser":"^4.3.16","@smithy/util-defaults-mode-node":"^4.2.19","@smithy/util-endpoints":"^3.2.7","@smithy/util-middleware":"^4.2.7","@smithy/util-retry":"^4.2.7","@smithy/util-utf8":"^4.2.0",tslib:"^2.6.2"},devDependencies={"@tsconfig/node18":"18.2.4","@types/node":"^18.19.69",concurrently:"7.0.0","downlevel-dts":"0.10.1",rimraf:"3.0.2",typescript:"~5.8.3"},engines={node:">=18.0.0"},typesVersions={"<4.0":{"dist-types/*":["dist-types/ts3.4/*"]}},files=["dist-*/**"],author={name:"AWS SDK for JavaScript Team",url:"https://aws.amazon.com/javascript/"},license="Apache-2.0",browser={"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.browser"},homepage="https://github.com/aws/aws-sdk-js-v3/tree/main/clients/client-chime-sdk-messaging",repository={type:"git",url:"https://github.com/aws/aws-sdk-js-v3.git",directory:"clients/client-chime-sdk-messaging"},packageInfo={name,description,version,scripts,main,types:types$1,module,sideEffects,dependencies,devDependencies,engines,typesVersions,files,author,license,browser,"react-native":{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.native"},homepage,repository},fromUtf8$1=et=>new TextEncoder().encode(et);var fromUtf8=typeof Buffer<"u"&&Buffer.from?function(et){return Buffer.from(et,"utf8")}:fromUtf8$1;function convertToBuffer$1(et){return et instanceof Uint8Array?et:typeof et=="string"?fromUtf8(et):ArrayBuffer.isView(et)?new Uint8Array(et.buffer,et.byteOffset,et.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(et)}function isEmptyData$1(et){return typeof et=="string"?et.length===0:et.byteLength===0}var SHA_256_HASH={name:"SHA-256"},SHA_256_HMAC_ALGO={name:"HMAC",hash:SHA_256_HASH},EMPTY_DATA_SHA_256=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85]);const fallbackWindow={};function locateWindow(){return typeof window<"u"?window:typeof self<"u"?self:fallbackWindow}var Sha256$2=function(){function et($){this.toHash=new Uint8Array(0),this.secret=$,this.reset()}return et.prototype.update=function($){if(!isEmptyData$1($)){var _=convertToBuffer$1($),tt=new Uint8Array(this.toHash.byteLength+_.byteLength);tt.set(this.toHash,0),tt.set(_,this.toHash.byteLength),this.toHash=tt}},et.prototype.digest=function(){var $=this;return this.key?this.key.then(function(_){return locateWindow().crypto.subtle.sign(SHA_256_HMAC_ALGO,_,$.toHash).then(function(tt){return new Uint8Array(tt)})}):isEmptyData$1(this.toHash)?Promise.resolve(EMPTY_DATA_SHA_256):Promise.resolve().then(function(){return locateWindow().crypto.subtle.digest(SHA_256_HASH,$.toHash)}).then(function(_){return Promise.resolve(new Uint8Array(_))})},et.prototype.reset=function(){var $=this;this.toHash=new Uint8Array(0),this.secret&&this.secret!==void 0&&(this.key=new Promise(function(_,tt){locateWindow().crypto.subtle.importKey("raw",convertToBuffer$1($.secret),SHA_256_HMAC_ALGO,!1,["sign"]).then(_,tt)}),this.key.catch(function(){}))},et}();function __awaiter$e(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})}function __generator(et,$){var _={label:0,sent:function(){if(it[0]&1)throw it[1];return it[1]},trys:[],ops:[]},tt,nt,it,rt=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return rt.next=ot(0),rt.throw=ot(1),rt.return=ot(2),typeof Symbol=="function"&&(rt[Symbol.iterator]=function(){return this}),rt;function ot(st){return function(at){return lt([st,at])}}function lt(st){if(tt)throw new TypeError("Generator is already executing.");for(;rt&&(rt=0,st[0]&&(_=0)),_;)try{if(tt=1,nt&&(it=st[0]&2?nt.return:st[0]?nt.throw||((it=nt.return)&&it.call(nt),0):nt.next)&&!(it=it.call(nt,st[1])).done)return it;switch(nt=0,it&&(st=[st[0]&2,it.value]),st[0]){case 0:case 1:it=st;break;case 4:return _.label++,{value:st[1],done:!1};case 5:_.label++,nt=st[1],st=[0];continue;case 7:st=_.ops.pop(),_.trys.pop();continue;default:if(it=_.trys,!(it=it.length>0&&it[it.length-1])&&(st[0]===6||st[0]===2)){_=0;continue}if(st[0]===3&&(!it||st[1]>it[0]&&st[1]<it[3])){_.label=st[1];break}if(st[0]===6&&_.label<it[1]){_.label=it[1],it=st;break}if(it&&_.label<it[2]){_.label=it[2],_.ops.push(st);break}it[2]&&_.ops.pop(),_.trys.pop();continue}st=$.call(et,_)}catch(at){st=[6,at],nt=0}finally{tt=it=0}if(st[0]&5)throw st[1];return{value:st[0]?st[1]:void 0,done:!0}}}typeof SuppressedError=="function"&&SuppressedError;var BLOCK_SIZE=64,DIGEST_LENGTH=32,KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],MAX_HASHABLE_LENGTH=Math.pow(2,53)-1,RawSha256$1=function(){function et(){this.state=Int32Array.from(INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return et.prototype.update=function($){if(this.finished)throw new Error("Attempted to update an already finished hash.");var _=0,tt=$.byteLength;if(this.bytesHashed+=tt,this.bytesHashed*8>MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;tt>0;)this.buffer[this.bufferLength++]=$[_++],tt--,this.bufferLength===BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},et.prototype.digest=function(){if(!this.finished){var $=this.bytesHashed*8,_=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),tt=this.bufferLength;if(_.setUint8(this.bufferLength++,128),tt%BLOCK_SIZE>=BLOCK_SIZE-8){for(var nt=this.bufferLength;nt<BLOCK_SIZE;nt++)_.setUint8(nt,0);this.hashBuffer(),this.bufferLength=0}for(var nt=this.bufferLength;nt<BLOCK_SIZE-8;nt++)_.setUint8(nt,0);_.setUint32(BLOCK_SIZE-8,Math.floor($/4294967296),!0),_.setUint32(BLOCK_SIZE-4,$),this.hashBuffer(),this.finished=!0}for(var it=new Uint8Array(DIGEST_LENGTH),nt=0;nt<8;nt++)it[nt*4]=this.state[nt]>>>24&255,it[nt*4+1]=this.state[nt]>>>16&255,it[nt*4+2]=this.state[nt]>>>8&255,it[nt*4+3]=this.state[nt]>>>0&255;return it},et.prototype.hashBuffer=function(){for(var $=this,_=$.buffer,tt=$.state,nt=tt[0],it=tt[1],rt=tt[2],ot=tt[3],lt=tt[4],st=tt[5],at=tt[6],ct=tt[7],dt=0;dt<BLOCK_SIZE;dt++){if(dt<16)this.temp[dt]=(_[dt*4]&255)<<24|(_[dt*4+1]&255)<<16|(_[dt*4+2]&255)<<8|_[dt*4+3]&255;else{var ut=this.temp[dt-2],ft=(ut>>>17|ut<<15)^(ut>>>19|ut<<13)^ut>>>10;ut=this.temp[dt-15];var pt=(ut>>>7|ut<<25)^(ut>>>18|ut<<14)^ut>>>3;this.temp[dt]=(ft+this.temp[dt-7]|0)+(pt+this.temp[dt-16]|0)}var St=(((lt>>>6|lt<<26)^(lt>>>11|lt<<21)^(lt>>>25|lt<<7))+(lt&st^~lt&at)|0)+(ct+(KEY[dt]+this.temp[dt]|0)|0)|0,gt=((nt>>>2|nt<<30)^(nt>>>13|nt<<19)^(nt>>>22|nt<<10))+(nt&it^nt&rt^it&rt)|0;ct=at,at=st,st=lt,lt=ot+St|0,ot=rt,rt=it,it=nt,nt=St+gt|0}tt[0]+=nt,tt[1]+=it,tt[2]+=rt,tt[3]+=ot,tt[4]+=lt,tt[5]+=st,tt[6]+=at,tt[7]+=ct},et}(),Sha256$1=function(){function et($){this.secret=$,this.hash=new RawSha256$1,this.reset()}return et.prototype.update=function($){if(!(isEmptyData$1($)||this.error))try{this.hash.update(convertToBuffer$1($))}catch(_){this.error=_}},et.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},et.prototype.digest=function(){return __awaiter$e(this,void 0,void 0,function(){return __generator(this,function($){return[2,this.digestSync()]})})},et.prototype.reset=function(){if(this.hash=new RawSha256$1,this.secret){this.outer=new RawSha256$1;var $=bufferFromSecret(this.secret),_=new Uint8Array(BLOCK_SIZE);_.set($);for(var tt=0;tt<BLOCK_SIZE;tt++)$[tt]^=54,_[tt]^=92;this.hash.update($),this.outer.update(_);for(var tt=0;tt<$.byteLength;tt++)$[tt]=0}},et}();function bufferFromSecret(et){var $=convertToBuffer$1(et);if($.byteLength>BLOCK_SIZE){var _=new RawSha256$1;_.update($),$=_.digest()}var tt=new Uint8Array(BLOCK_SIZE);return tt.set($),tt}var subtleCryptoMethods=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function supportsWebCrypto(et){if(supportsSecureRandom(et)&&typeof et.crypto.subtle=="object"){var $=et.crypto.subtle;return supportsSubtleCrypto($)}return!1}function supportsSecureRandom(et){if(typeof et=="object"&&typeof et.crypto=="object"){var $=et.crypto.getRandomValues;return typeof $=="function"}return!1}function supportsSubtleCrypto(et){return et&&subtleCryptoMethods.every(function($){return typeof et[$]=="function"})}var Sha256=function(){function et($){supportsWebCrypto(locateWindow())?this.hash=new Sha256$2($):this.hash=new Sha256$1($)}return et.prototype.update=function($,_){this.hash.update(convertToBuffer$1($))},et.prototype.digest=function(){return this.hash.digest()},et.prototype.reset=function(){this.hash.reset()},et}();const createDefaultUserAgentProvider=({serviceId:et,clientVersion:$})=>async _=>{var ut,ft,pt;const tt=typeof window<"u"?window.navigator:void 0,nt=(tt==null?void 0:tt.userAgent)??"",it=((ut=tt==null?void 0:tt.userAgentData)==null?void 0:ut.platform)??fallback.os(nt)??"other",rt=void 0,ot=((ft=tt==null?void 0:tt.userAgentData)==null?void 0:ft.brands)??[],lt=ot[ot.length-1],st=(lt==null?void 0:lt.brand)??fallback.browser(nt)??"unknown",at=(lt==null?void 0:lt.version)??"unknown",ct=[["aws-sdk-js",$],["ua","2.1"],[`os/${it}`,rt],["lang/js"],["md/browser",`${st}_${at}`]];et&&ct.push([`api/${et}`,$]);const dt=await((pt=_==null?void 0:_.userAgentAppId)==null?void 0:pt.call(_));return dt&&ct.push([`app/${dt}`]),ct},fallback={os(et){if(/iPhone|iPad|iPod/.test(et))return"iOS";if(/Macintosh|Mac OS X/.test(et))return"macOS";if(/Windows NT/.test(et))return"Windows";if(/Android/.test(et))return"Android";if(/Linux/.test(et))return"Linux"},browser(et){if(/EdgiOS|EdgA|Edg\//.test(et))return"Microsoft Edge";if(/Firefox\//.test(et))return"Firefox";if(/Chrome\//.test(et))return"Chrome";if(/Safari\//.test(et))return"Safari"}},invalidProvider=et=>()=>Promise.reject(et),DEFAULTS_MODE_OPTIONS=["in-region","cross-region","mobile","standard","legacy"],resolveDefaultsModeConfig=({defaultsMode:et}={})=>memoize(async()=>{const $=typeof et=="function"?await et():et;switch($==null?void 0:$.toLowerCase()){case"auto":return Promise.resolve(useMobileConfiguration()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve($==null?void 0:$.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${DEFAULTS_MODE_OPTIONS.join(", ")}, got ${$}`)}}),useMobileConfiguration=()=>{var $;const et=window==null?void 0:window.navigator;if(et!=null&&et.connection){const{effectiveType:_,rtt:tt,downlink:nt}=et==null?void 0:et.connection;if(typeof _=="string"&&_!=="4g"||Number(tt)>100||Number(nt)<10)return!0}return(($=et==null?void 0:et.userAgentData)==null?void 0:$.mobile)||typeof(et==null?void 0:et.maxTouchPoints)=="number"&&(et==null?void 0:et.maxTouchPoints)>1},s="required",t="fn",u="argv",v="ref",a=!0,b="isSet",c="booleanEquals",d="error",e="endpoint",f="tree",g="PartitionResult",h={[s]:!1,type:"string"},i={[s]:!0,default:!1,type:"boolean"},j={[v]:"Endpoint"},k={[t]:c,[u]:[{[v]:"UseFIPS"},!0]},l={[t]:c,[u]:[{[v]:"UseDualStack"},!0]},m={},n={[t]:"getAttr",[u]:[{[v]:g},"supportsFIPS"]},o={[t]:c,[u]:[!0,{[t]:"getAttr",[u]:[{[v]:g},"supportsDualStack"]}]},p=[k],q=[l],r=[{[v]:"Region"}],_data={version:"1.0",parameters:{Region:h,UseDualStack:i,UseFIPS:i,Endpoint:h},rules:[{conditions:[{[t]:b,[u]:[j]}],rules:[{conditions:p,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:d},{conditions:q,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:d},{endpoint:{url:j,properties:m,headers:m},type:e}],type:f},{conditions:[{[t]:b,[u]:r}],rules:[{conditions:[{[t]:"aws.partition",[u]:r,assign:g}],rules:[{conditions:[k,l],rules:[{conditions:[{[t]:c,[u]:[a,n]},o],rules:[{endpoint:{url:"https://messaging-chime-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:m,headers:m},type:e}],type:f},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:d}],type:f},{conditions:p,rules:[{conditions:[{[t]:c,[u]:[n,a]}],rules:[{endpoint:{url:"https://messaging-chime-fips.{Region}.{PartitionResult#dnsSuffix}",properties:m,headers:m},type:e}],type:f},{error:"FIPS is enabled but this partition does not support FIPS",type:d}],type:f},{conditions:q,rules:[{conditions:[o],rules:[{endpoint:{url:"https://messaging-chime.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:m,headers:m},type:e}],type:f},{error:"DualStack is enabled but this partition does not support DualStack",type:d}],type:f},{endpoint:{url:"https://messaging-chime.{Region}.{PartitionResult#dnsSuffix}",properties:m,headers:m},type:e}],type:f}],type:f},{error:"Invalid Configuration: Missing Region",type:d}]},ruleSet=_data,cache=new EndpointCache({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),defaultEndpointResolver=(et,$={})=>cache.get(et,()=>resolveEndpoint(ruleSet,{endpointParams:et,logger:$.logger}));customEndpointFunctions.aws=awsEndpointFunctions;const getRuntimeConfig$1=et=>({apiVersion:"2021-05-15",base64Decoder:(et==null?void 0:et.base64Decoder)??fromBase64,base64Encoder:(et==null?void 0:et.base64Encoder)??toBase64,disableHostPrefix:(et==null?void 0:et.disableHostPrefix)??!1,endpointProvider:(et==null?void 0:et.endpointProvider)??defaultEndpointResolver,extensions:(et==null?void 0:et.extensions)??[],httpAuthSchemeProvider:(et==null?void 0:et.httpAuthSchemeProvider)??defaultChimeSDKMessagingHttpAuthSchemeProvider,httpAuthSchemes:(et==null?void 0:et.httpAuthSchemes)??[{schemeId:"aws.auth#sigv4",identityProvider:$=>$.getIdentityProvider("aws.auth#sigv4"),signer:new AwsSdkSigV4Signer}],logger:(et==null?void 0:et.logger)??new NoOpLogger$2,protocol:(et==null?void 0:et.protocol)??AwsRestJsonProtocol,protocolSettings:(et==null?void 0:et.protocolSettings)??{defaultNamespace:"com.amazonaws.chimesdkmessaging",version:"2021-05-15",serviceTarget:"ChimeMessagingService"},serviceId:(et==null?void 0:et.serviceId)??"Chime SDK Messaging",urlParser:(et==null?void 0:et.urlParser)??parseUrl,utf8Decoder:(et==null?void 0:et.utf8Decoder)??fromUtf8$2,utf8Encoder:(et==null?void 0:et.utf8Encoder)??toUtf8}),getRuntimeConfig=et=>{const $=resolveDefaultsModeConfig(et),_=()=>$().then(loadConfigsForDefaultMode),tt=getRuntimeConfig$1(et);return{...tt,...et,runtime:"browser",defaultsMode:$,bodyLengthChecker:(et==null?void 0:et.bodyLengthChecker)??calculateBodyLength,credentialDefaultProvider:(et==null?void 0:et.credentialDefaultProvider)??(nt=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:(et==null?void 0:et.defaultUserAgentProvider)??createDefaultUserAgentProvider({serviceId:tt.serviceId,clientVersion:packageInfo.version}),maxAttempts:(et==null?void 0:et.maxAttempts)??DEFAULT_MAX_ATTEMPTS,region:(et==null?void 0:et.region)??invalidProvider("Region is missing"),requestHandler:FetchHttpHandler.create((et==null?void 0:et.requestHandler)??_),retryMode:(et==null?void 0:et.retryMode)??(async()=>(await _()).retryMode||DEFAULT_RETRY_MODE),sha256:(et==null?void 0:et.sha256)??Sha256,streamCollector:(et==null?void 0:et.streamCollector)??streamCollector,useDualstackEndpoint:(et==null?void 0:et.useDualstackEndpoint)??(()=>Promise.resolve(DEFAULT_USE_DUALSTACK_ENDPOINT)),useFipsEndpoint:(et==null?void 0:et.useFipsEndpoint)??(()=>Promise.resolve(DEFAULT_USE_FIPS_ENDPOINT))}},getAwsRegionExtensionConfiguration=et=>({setRegion($){et.region=$},region(){return et.region}}),resolveAwsRegionExtensionConfiguration=et=>({region:et.region()}),getHttpAuthExtensionConfiguration=et=>{const $=et.httpAuthSchemes;let _=et.httpAuthSchemeProvider,tt=et.credentials;return{setHttpAuthScheme(nt){const it=$.findIndex(rt=>rt.schemeId===nt.schemeId);it===-1?$.push(nt):$.splice(it,1,nt)},httpAuthSchemes(){return $},setHttpAuthSchemeProvider(nt){_=nt},httpAuthSchemeProvider(){return _},setCredentials(nt){tt=nt},credentials(){return tt}}},resolveHttpAuthRuntimeConfig=et=>({httpAuthSchemes:et.httpAuthSchemes(),httpAuthSchemeProvider:et.httpAuthSchemeProvider(),credentials:et.credentials()}),resolveRuntimeExtensions=(et,$)=>{const _=Object.assign(getAwsRegionExtensionConfiguration(et),getDefaultExtensionConfiguration(et),getHttpHandlerExtensionConfiguration(et),getHttpAuthExtensionConfiguration(et));return $.forEach(tt=>tt.configure(_)),Object.assign(et,resolveAwsRegionExtensionConfiguration(_),resolveDefaultRuntimeConfig(_),resolveHttpHandlerRuntimeConfig(_),resolveHttpAuthRuntimeConfig(_))};class ChimeSDKMessagingClient extends Client{constructor(...[_]){const tt=getRuntimeConfig(_||{});super(tt);Pt(this,"config");this.initConfig=tt;const nt=resolveClientEndpointParameters(tt),it=resolveUserAgentConfig(nt),rt=resolveRetryConfig(it),ot=resolveRegionConfig(rt),lt=ot,st=resolveEndpointConfig(lt),at=resolveHttpAuthSchemeConfig(st),ct=resolveRuntimeExtensions(at,(_==null?void 0:_.extensions)||[]);this.config=ct,this.middlewareStack.use(getSchemaSerdePlugin(this.config)),this.middlewareStack.use(getUserAgentPlugin(this.config)),this.middlewareStack.use(getRetryPlugin(this.config)),this.middlewareStack.use(getContentLengthPlugin(this.config)),this.middlewareStack.use(getHostHeaderPlugin(this.config)),this.middlewareStack.use(getLoggerPlugin(this.config)),this.middlewareStack.use(getRecursionDetectionPlugin(this.config)),this.middlewareStack.use(getHttpAuthSchemeEndpointRuleSetPlugin(this.config,{httpAuthSchemeParametersProvider:defaultChimeSDKMessagingHttpAuthSchemeParametersProvider,identityProviderConfigProvider:async dt=>new DefaultIdentityProviderConfig({"aws.auth#sigv4":dt.credentials})})),this.middlewareStack.use(getHttpSigningPlugin(this.config))}destroy(){super.destroy()}}class ChimeSDKMessagingServiceException extends ServiceException{constructor($){super($),Object.setPrototypeOf(this,ChimeSDKMessagingServiceException.prototype)}}class BadRequestException extends ChimeSDKMessagingServiceException{constructor(_){super({name:"BadRequestException",$fault:"client",..._});Pt(this,"name","BadRequestException");Pt(this,"$fault","client");Pt(this,"Code");Pt(this,"Message");Object.setPrototypeOf(this,BadRequestException.prototype),this.Code=_.Code,this.Message=_.Message}}class ConflictException extends ChimeSDKMessagingServiceException{constructor(_){super({name:"ConflictException",$fault:"client",..._});Pt(this,"name","ConflictException");Pt(this,"$fault","client");Pt(this,"Code");Pt(this,"Message");Object.setPrototypeOf(this,ConflictException.prototype),this.Code=_.Code,this.Message=_.Message}}class ForbiddenException extends ChimeSDKMessagingServiceException{constructor(_){super({name:"ForbiddenException",$fault:"client",..._});Pt(this,"name","ForbiddenException");Pt(this,"$fault","client");Pt(this,"Code");Pt(this,"Message");Object.setPrototypeOf(this,ForbiddenException.prototype),this.Code=_.Code,this.Message=_.Message}}class NotFoundException extends ChimeSDKMessagingServiceException{constructor(_){super({name:"NotFoundException",$fault:"client",..._});Pt(this,"name","NotFoundException");Pt(this,"$fault","client");Pt(this,"Code");Pt(this,"Message");Object.setPrototypeOf(this,NotFoundException.prototype),this.Code=_.Code,this.Message=_.Message}}class ServiceFailureException extends ChimeSDKMessagingServiceException{constructor(_){super({name:"ServiceFailureException",$fault:"server",..._});Pt(this,"name","ServiceFailureException");Pt(this,"$fault","server");Pt(this,"Code");Pt(this,"Message");Object.setPrototypeOf(this,ServiceFailureException.prototype),this.Code=_.Code,this.Message=_.Message}}class ServiceUnavailableException extends ChimeSDKMessagingServiceException{constructor(_){super({name:"ServiceUnavailableException",$fault:"server",..._});Pt(this,"name","ServiceUnavailableException");Pt(this,"$fault","server");Pt(this,"Code");Pt(this,"Message");Object.setPrototypeOf(this,ServiceUnavailableException.prototype),this.Code=_.Code,this.Message=_.Message}}class ThrottledClientException extends ChimeSDKMessagingServiceException{constructor(_){super({name:"ThrottledClientException",$fault:"client",..._});Pt(this,"name","ThrottledClientException");Pt(this,"$fault","client");Pt(this,"Code");Pt(this,"Message");Object.setPrototypeOf(this,ThrottledClientException.prototype),this.Code=_.Code,this.Message=_.Message}}class UnauthorizedClientException extends ChimeSDKMessagingServiceException{constructor(_){super({name:"UnauthorizedClientException",$fault:"client",..._});Pt(this,"name","UnauthorizedClientException");Pt(this,"$fault","client");Pt(this,"Code");Pt(this,"Message");Object.setPrototypeOf(this,UnauthorizedClientException.prototype),this.Code=_.Code,this.Message=_.Message}}class ResourceLimitExceededException extends ChimeSDKMessagingServiceException{constructor(_){super({name:"ResourceLimitExceededException",$fault:"client",..._});Pt(this,"name","ResourceLimitExceededException");Pt(this,"$fault","client");Pt(this,"Code");Pt(this,"Message");Object.setPrototypeOf(this,ResourceLimitExceededException.prototype),this.Code=_.Code,this.Message=_.Message}}const _A="Arn",_ACF="AssociateChannelFlow",_ACFR="AssociateChannelFlowRequest",_AIA="AppInstanceArn",_AIUA="AppInstanceUserArn",_AIUMS="AppInstanceUserMembershipSummary",_AN="AllowNotifications",_B="Body",_BCCM="BatchCreateChannelMembership",_BCCME="BatchCreateChannelMembershipError",_BCCMEa="BatchCreateChannelMembershipErrors",_BCCMR="BatchCreateChannelMembershipRequest",_BCCMRa="BatchCreateChannelMembershipResponse",_BCM="BatchChannelMemberships",_BRE="BadRequestException",_C="Content",_CA="ChannelArn",_CAWFS="ChannelAssociatedWithFlowSummary",_CAWFSL="ChannelAssociatedWithFlowSummaryList",_CB="ChimeBearer",_CBS="ChannelBanSummary",_CBSL="ChannelBanSummaryList",_CBh="ChannelBan",_CBha="ChannelBans",_CBr="CreatedBy",_CC="CreateChannel",_CCB="CreateChannelBan",_CCBR="CreateChannelBanRequest",_CCBRr="CreateChannelBanResponse",_CCF="CreateChannelFlow",_CCFR="CreateChannelFlowRequest",_CCFRr="CreateChannelFlowResponse",_CCM="CreateChannelMembership",_CCMR="CreateChannelMembershipRequest",_CCMRr="CreateChannelMembershipResponse",_CCMRre="CreateChannelModeratorRequest",_CCMRrea="CreateChannelModeratorResponse",_CCMr="CreateChannelModerator",_CCR="CreateChannelRequest",_CCRr="CreateChannelResponse",_CE="ConflictException",_CF="ChannelFlow",_CFA="ChannelFlowArn",_CFC="ChannelFlowCallback",_CFCR="ChannelFlowCallbackRequest",_CFCRh="ChannelFlowCallbackResponse",_CFS="ChannelFlowSummary",_CFSL="ChannelFlowSummaryList",_CFh="ChannelFlows",_CI="ChannelId",_CIa="CallbackId",_CM="ChannelMessage",_CMA="ChannelModeratorArn",_CMBAIUS="ChannelModeratedByAppInstanceUserSummary",_CMBAIUSL="ChannelModeratedByAppInstanceUserSummaryList",_CMC="ChannelMessageCallback",_CMFAIUS="ChannelMembershipForAppInstanceUserSummary",_CMFAIUSL="ChannelMembershipForAppInstanceUserSummaryList",_CMP="ChannelMembershipPreferences",_CMS="ChannelMembershipSummary",_CMSL="ChannelMembershipSummaryList",_CMSLh="ChannelMessageSummaryList",_CMSLha="ChannelModeratorSummaryList",_CMSS="ChannelMessageStatusStructure",_CMSh="ChannelMessageSummary",_CMSha="ChannelModeratorSummary",_CMh="ChannelMembership",_CMha="ChannelModerator",_CMhan="ChannelMemberships",_CMhann="ChannelMessages",_CMhanne="ChannelModerators",_CRT="ClientRequestToken",_CS="ChannelSummary",_CSL="ChannelSummaryList",_CT="ContentType",_CTr="CreatedTimestamp",_Ch="Channel",_Cha="Channels",_Co="Code",_Con="Configuration",_D="Detail",_DC="DeleteChannel",_DCB="DeleteChannelBan",_DCBR="DeleteChannelBanRequest",_DCBRe="DescribeChannelBanRequest",_DCBRes="DescribeChannelBanResponse",_DCBe="DescribeChannelBan",_DCF="DeleteChannelFlow",_DCFR="DeleteChannelFlowRequest",_DCFRe="DescribeChannelFlowRequest",_DCFRes="DescribeChannelFlowResponse",_DCFRi="DisassociateChannelFlowRequest",_DCFe="DescribeChannelFlow",_DCFi="DisassociateChannelFlow",_DCM="DeleteChannelMembership",_DCMBAIU="DescribeChannelModeratedByAppInstanceUser",_DCMBAIUR="DescribeChannelModeratedByAppInstanceUserRequest",_DCMBAIURe="DescribeChannelModeratedByAppInstanceUserResponse",_DCMFAIU="DescribeChannelMembershipForAppInstanceUser",_DCMFAIUR="DescribeChannelMembershipForAppInstanceUserRequest",_DCMFAIURe="DescribeChannelMembershipForAppInstanceUserResponse",_DCMR="DeleteChannelMembershipRequest",_DCMRe="DeleteChannelMessageRequest",_DCMRel="DeleteChannelModeratorRequest",_DCMRes="DescribeChannelMembershipRequest",_DCMResc="DescribeChannelMembershipResponse",_DCMRescr="DescribeChannelModeratorRequest",_DCMRescri="DescribeChannelModeratorResponse",_DCMe="DeleteChannelMessage",_DCMel="DeleteChannelModerator",_DCMes="DescribeChannelMembership",_DCMesc="DescribeChannelModerator",_DCR="DeleteChannelRequest",_DCRe="DescribeChannelRequest",_DCRes="DescribeChannelResponse",_DCe="DescribeChannel",_DMSC="DeleteMessagingStreamingConfigurations",_DMSCR="DeleteMessagingStreamingConfigurationsRequest",_DR="DeleteResource",_DT="DataType",_E="Errors",_EC="ErrorCode",_ECC="ElasticChannelConfiguration",_ECx="ExpirationCriterion",_ED="ExpirationDays",_EM="ErrorMessage",_EO="ExecutionOrder",_ES="ExpirationSettings",_En="Endpoint",_F="Fields",_FA="FallbackAction",_FE="ForbiddenException",_FR="FilterRule",_GCM="GetChannelMessage",_GCMP="GetChannelMembershipPreferences",_GCMPR="GetChannelMembershipPreferencesRequest",_GCMPRe="GetChannelMembershipPreferencesResponse",_GCMR="GetChannelMessageRequest",_GCMRe="GetChannelMessageResponse",_GCMS="GetChannelMessageStatus",_GCMSR="GetChannelMessageStatusRequest",_GCMSRe="GetChannelMessageStatusResponse",_GMSC="GetMessagingStreamingConfigurations",_GMSCR="GetMessagingStreamingConfigurationsRequest",_GMSCRe="GetMessagingStreamingConfigurationsResponse",_GMSE="GetMessagingSessionEndpoint",_GMSER="GetMessagingSessionEndpointRequest",_GMSERe="GetMessagingSessionEndpointResponse",_I="Identity",_IB="InvitedBy",_IT="InvocationType",_K="Key",_L="Lambda",_LC="LambdaConfiguration",_LCAWCF="ListChannelsAssociatedWithChannelFlow",_LCAWCFR="ListChannelsAssociatedWithChannelFlowRequest",_LCAWCFRi="ListChannelsAssociatedWithChannelFlowResponse",_LCB="ListChannelBans",_LCBR="ListChannelBansRequest",_LCBRi="ListChannelBansResponse",_LCF="ListChannelFlows",_LCFR="ListChannelFlowsRequest",_LCFRi="ListChannelFlowsResponse",_LCM="ListChannelMemberships",_LCMBAIU="ListChannelsModeratedByAppInstanceUser",_LCMBAIUR="ListChannelsModeratedByAppInstanceUserRequest",_LCMBAIURi="ListChannelsModeratedByAppInstanceUserResponse",_LCMFAIU="ListChannelMembershipsForAppInstanceUser",_LCMFAIUR="ListChannelMembershipsForAppInstanceUserRequest",_LCMFAIURi="ListChannelMembershipsForAppInstanceUserResponse",_LCMR="ListChannelMembershipsRequest",_LCMRi="ListChannelMembershipsResponse",_LCMRis="ListChannelMessagesRequest",_LCMRist="ListChannelMessagesResponse",_LCMRisth="ListChannelModeratorsRequest",_LCMRistha="ListChannelModeratorsResponse",_LCMi="ListChannelMessages",_LCMis="ListChannelModerators",_LCR="ListChannelsRequest",_LCRi="ListChannelsResponse",_LCi="ListChannels",_LET="LastEditedTimestamp",_LMT="LastMessageTimestamp",_LSC="ListSubChannels",_LSCR="ListSubChannelsRequest",_LSCRi="ListSubChannelsResponse",_LTFR="ListTagsForResource",_LTFRR="ListTagsForResourceRequest",_LTFRRi="ListTagsForResourceResponse",_LUT="LastUpdatedTimestamp",_M="Metadata",_MA="MemberArn",_MAM="MessageAttributeMap",_MAN="MessageAttributeName",_MASV="MessageAttributeStringValue",_MASVe="MessageAttributeStringValues",_MAV="MessageAttributeValue",_MAe="MemberArns",_MAes="MessageAttributes",_MAo="ModeratorArns",_MC="MembershipCount",_MI="MessageId",_MMP="MinimumMembershipPercentage",_MR="MaxResults",_MSC="MaximumSubChannels",_MSE="MessagingSessionEndpoint",_Me="Message",_Mem="Members",_Memb="Member",_Mo="Mode",_Mod="Moderator",_N="Name",_NA="NotAfter",_NB="NotBefore",_NEC="NonEmptyContent",_NERN="NonEmptyResourceName",_NFE="NotFoundException",_NT="NextToken",_NTe="NetworkType",_O="Operator",_P="Privacy",_PC="ProcessorConfiguration",_PCES="PutChannelExpirationSettings",_PCESR="PutChannelExpirationSettingsRequest",_PCESRu="PutChannelExpirationSettingsResponse",_PCMP="PutChannelMembershipPreferences",_PCMPR="PutChannelMembershipPreferencesRequest",_PCMPRu="PutChannelMembershipPreferencesResponse",_PL="ProcessorList",_PMSC="PutMessagingStreamingConfigurations",_PMSCR="PutMessagingStreamingConfigurationsRequest",_PMSCRu="PutMessagingStreamingConfigurationsResponse",_PN="PushNotifications",_PNB="PushNotificationBody",_PNC="PushNotificationConfiguration",_PNP="PushNotificationPreferences",_PNT="PushNotificationTitle",_PNu="PushNotification",_Pe="Persistence",_Pr="Processors",_Pre="Preferences",_Pro="Processor",_R="Redacted",_RA="ResourceArn",_RARN="ResourceARN",_RCM="RedactChannelMessage",_RCMR="RedactChannelMessageRequest",_RCMRe="RedactChannelMessageResponse",_RLEE="ResourceLimitExceededException",_RMT="ReadMarkerTimestamp",_RN="ResourceName",_S="Sender",_SC="StreamingConfigurations",_SCI="SubChannelId",_SCL="StreamingConfigurationList",_SCM="SendChannelMessage",_SCMR="SendChannelMessageRequest",_SCMRe="SendChannelMessageResponse",_SCR="SearchChannelsRequest",_SCRe="SearchChannelsResponse",_SCS="SubChannelSummary",_SCSL="SubChannelSummaryList",_SCe="SearchChannels",_SCt="StreamingConfiguration",_SCu="SubChannels",_SF="SearchField",_SFE="ServiceFailureException",_SFe="SearchFields",_SO="SortOrder",_SUE="ServiceUnavailableException",_SV="StringValues",_St="Status",_T="Type",_TCE="ThrottledClientException",_TK="TagKey",_TKL="TagKeyList",_TKa="TagKeys",_TL="TagList",_TLa="TargetList",_TMPSC="TargetMembershipsPerSubChannel",_TR="TagResource",_TRR="TagResourceRequest",_TV="TagValue",_Ta="Target",_Tag="Tags",_Tag_="Tag",_Ti="Title",_U="Url",_UC="UpdateChannel",_UCE="UnauthorizedClientException",_UCF="UpdateChannelFlow",_UCFR="UpdateChannelFlowRequest",_UCFRp="UpdateChannelFlowResponse",_UCM="UpdateChannelMessage",_UCMR="UpdateChannelMessageRequest",_UCMRp="UpdateChannelMessageResponse",_UCR="UpdateChannelRequest",_UCRM="UpdateChannelReadMarker",_UCRMR="UpdateChannelReadMarkerRequest",_UCRMRp="UpdateChannelReadMarkerResponse",_UCRp="UpdateChannelResponse",_UR="UntagResource",_URR="UntagResourceRequest",_V="Value",_Va="Values",_a="arn",_aia="app-instance-arn",_aiua="app-instance-user-arn",_c="client",_cfa="channel-flow-arn",_e="error",_h="http",_hE="httpError",_hH="httpHeader",_hQ="httpQuery",_mr="max-results",_na="not-after",_nb="not-before",_nt="network-type",_nt_="next-token",_p="privacy",_s="server",_sci="sub-channel-id",_sm="smithy.ts.sdk.synthetic.com.amazonaws.chimesdkmessaging",_so="sort-order",_t="type",_xacb="x-amz-chime-bearer",n0="com.amazonaws.chimesdkmessaging";var ChannelId=[0,n0,_CI,8,0],ClientRequestToken=[0,n0,_CRT,8,0],Content=[0,n0,_C,8,0],ContentType=[0,n0,_CT,8,0],FilterRule=[0,n0,_FR,8,0],MessageAttributeName=[0,n0,_MAN,8,0],MessageAttributeStringValue=[0,n0,_MASV,8,0],Metadata=[0,n0,_M,8,0],NextToken=[0,n0,_NT,8,0],NonEmptyContent=[0,n0,_NEC,8,0],NonEmptyResourceName=[0,n0,_NERN,8,0],PushNotificationBody=[0,n0,_PNB,8,0],PushNotificationTitle=[0,n0,_PNT,8,0],ResourceName=[0,n0,_RN,8,0],TagKey=[0,n0,_TK,8,0],TagValue=[0,n0,_TV,8,0],AppInstanceUserMembershipSummary$=[3,n0,_AIUMS,0,[_T,_RMT,_SCI],[0,4,0]],AssociateChannelFlowRequest$=[3,n0,_ACFR,0,[_CA,_CFA,_CB],[[0,1],0,[0,{[_hH]:_xacb}]]],BadRequestException$=[-3,n0,_BRE,{[_e]:_c,[_hE]:400},[_Co,_Me],[0,0]];TypeRegistry.for(n0).registerError(BadRequestException$,BadRequestException);var BatchChannelMemberships$=[3,n0,_BCM,0,[_IB,_T,_Mem,_CA,_SCI],[[()=>Identity$,0],0,[()=>Members,0],0,0]],BatchCreateChannelMembershipError$=[3,n0,_BCCME,0,[_MA,_EC,_EM],[0,0,0]],BatchCreateChannelMembershipRequest$=[3,n0,_BCCMR,0,[_CA,_T,_MAe,_CB,_SCI],[[0,1],0,64,[0,{[_hH]:_xacb}],0]],BatchCreateChannelMembershipResponse$=[3,n0,_BCCMRa,0,[_BCM,_E],[[()=>BatchChannelMemberships$,0],()=>BatchCreateChannelMembershipErrors]],Channel$=[3,n0,_Ch,0,[_N,_CA,_Mo,_P,_M,_CBr,_CTr,_LMT,_LUT,_CFA,_ECC,_ES],[[()=>NonEmptyResourceName,0],0,0,0,[()=>Metadata,0],[()=>Identity$,0],4,4,4,0,()=>ElasticChannelConfiguration$,()=>ExpirationSettings$]],ChannelAssociatedWithFlowSummary$=[3,n0,_CAWFS,0,[_N,_CA,_Mo,_P,_M],[[()=>NonEmptyResourceName,0],0,0,0,[()=>Metadata,0]]],ChannelBan$=[3,n0,_CBh,0,[_Memb,_CA,_CTr,_CBr],[[()=>Identity$,0],0,4,[()=>Identity$,0]]],ChannelBanSummary$=[3,n0,_CBS,0,[_Memb],[[()=>Identity$,0]]],ChannelFlow$=[3,n0,_CF,0,[_CFA,_Pr,_N,_CTr,_LUT],[0,[()=>ProcessorList,0],[()=>NonEmptyResourceName,0],4,4]],ChannelFlowCallbackRequest$=[3,n0,_CFCR,0,[_CIa,_CA,_DR,_CM],[[0,4],[0,1],2,[()=>ChannelMessageCallback$,0]]],ChannelFlowCallbackResponse$=[3,n0,_CFCRh,0,[_CA,_CIa],[0,0]],ChannelFlowSummary$=[3,n0,_CFS,0,[_CFA,_N,_Pr],[0,[()=>NonEmptyResourceName,0],[()=>ProcessorList,0]]],ChannelMembership$=[3,n0,_CMh,0,[_IB,_T,_Memb,_CA,_CTr,_LUT,_SCI],[[()=>Identity$,0],0,[()=>Identity$,0],0,4,4,0]],ChannelMembershipForAppInstanceUserSummary$=[3,n0,_CMFAIUS,0,[_CS,_AIUMS],[[()=>ChannelSummary$,0],()=>AppInstanceUserMembershipSummary$]],ChannelMembershipPreferences$=[3,n0,_CMP,0,[_PN],[[()=>PushNotificationPreferences$,0]]],ChannelMembershipSummary$=[3,n0,_CMS,0,[_Memb],[[()=>Identity$,0]]],ChannelMessage$=[3,n0,_CM,0,[_CA,_MI,_C,_M,_T,_CTr,_LET,_LUT,_S,_R,_Pe,_St,_MAes,_SCI,_CT,_Ta],[0,0,[()=>Content,0],[()=>Metadata,0],0,4,4,4,[()=>Identity$,0],2,0,()=>ChannelMessageStatusStructure$,[()=>MessageAttributeMap,0],0,[()=>ContentType,0],()=>TargetList]],ChannelMessageCallback$=[3,n0,_CMC,0,[_MI,_C,_M,_PNu,_MAes,_SCI,_CT],[0,[()=>NonEmptyContent,0],[()=>Metadata,0],[()=>PushNotificationConfiguration$,0],[()=>MessageAttributeMap,0],0,[()=>ContentType,0]]],ChannelMessageStatusStructure$=[3,n0,_CMSS,0,[_V,_D],[0,0]],ChannelMessageSummary$=[3,n0,_CMSh,0,[_MI,_C,_M,_T,_CTr,_LUT,_LET,_S,_R,_St,_MAes,_CT,_Ta],[0,[()=>Content,0],[()=>Metadata,0],0,4,4,4,[()=>Identity$,0],2,()=>ChannelMessageStatusStructure$,[()=>MessageAttributeMap,0],[()=>ContentType,0],()=>TargetList]],ChannelModeratedByAppInstanceUserSummary$=[3,n0,_CMBAIUS,0,[_CS],[[()=>ChannelSummary$,0]]],ChannelModerator$=[3,n0,_CMha,0,[_Mod,_CA,_CTr,_CBr],[[()=>Identity$,0],0,4,[()=>Identity$,0]]],ChannelModeratorSummary$=[3,n0,_CMSha,0,[_Mod],[[()=>Identity$,0]]],ChannelSummary$=[3,n0,_CS,0,[_N,_CA,_Mo,_P,_M,_LMT],[[()=>NonEmptyResourceName,0],0,0,0,[()=>Metadata,0],4]],ConflictException$=[-3,n0,_CE,{[_e]:_c,[_hE]:409},[_Co,_Me],[0,0]];TypeRegistry.for(n0).registerError(ConflictException$,ConflictException);var CreateChannelBanRequest$=[3,n0,_CCBR,0,[_CA,_MA,_CB],[[0,1],0,[0,{[_hH]:_xacb}]]],CreateChannelBanResponse$=[3,n0,_CCBRr,0,[_CA,_Memb],[0,[()=>Identity$,0]]],CreateChannelFlowRequest$=[3,n0,_CCFR,0,[_AIA,_Pr,_N,_Tag,_CRT],[0,[()=>ProcessorList,0],[()=>NonEmptyResourceName,0],[()=>TagList,0],[()=>ClientRequestToken,4]]],CreateChannelFlowResponse$=[3,n0,_CCFRr,0,[_CFA],[0]],CreateChannelMembershipRequest$=[3,n0,_CCMR,0,[_CA,_MA,_T,_CB,_SCI],[[0,1],0,0,[0,{[_hH]:_xacb}],0]],CreateChannelMembershipResponse$=[3,n0,_CCMRr,0,[_CA,_Memb,_SCI],[0,[()=>Identity$,0],0]],CreateChannelModeratorRequest$=[3,n0,_CCMRre,0,[_CA,_CMA,_CB],[[0,1],0,[0,{[_hH]:_xacb}]]],CreateChannelModeratorResponse$=[3,n0,_CCMRrea,0,[_CA,_CMha],[0,[()=>Identity$,0]]],CreateChannelRequest$=[3,n0,_CCR,0,[_AIA,_N,_Mo,_P,_M,_CRT,_Tag,_CB,_CI,_MAe,_MAo,_ECC,_ES],[0,[()=>NonEmptyResourceName,0],0,0,[()=>Metadata,0],[()=>ClientRequestToken,4],[()=>TagList,0],[0,{[_hH]:_xacb}],[()=>ChannelId,0],64,64,()=>ElasticChannelConfiguration$,()=>ExpirationSettings$]],CreateChannelResponse$=[3,n0,_CCRr,0,[_CA],[0]],DeleteChannelBanRequest$=[3,n0,_DCBR,0,[_CA,_MA,_CB],[[0,1],[0,1],[0,{[_hH]:_xacb}]]],DeleteChannelFlowRequest$=[3,n0,_DCFR,0,[_CFA],[[0,1]]],DeleteChannelMembershipRequest$=[3,n0,_DCMR,0,[_CA,_MA,_CB,_SCI],[[0,1],[0,1],[0,{[_hH]:_xacb}],[0,{[_hQ]:_sci}]]],DeleteChannelMessageRequest$=[3,n0,_DCMRe,0,[_CA,_MI,_CB,_SCI],[[0,1],[0,1],[0,{[_hH]:_xacb}],[0,{[_hQ]:_sci}]]],DeleteChannelModeratorRequest$=[3,n0,_DCMRel,0,[_CA,_CMA,_CB],[[0,1],[0,1],[0,{[_hH]:_xacb}]]],DeleteChannelRequest$=[3,n0,_DCR,0,[_CA,_CB],[[0,1],[0,{[_hH]:_xacb}]]],DeleteMessagingStreamingConfigurationsRequest$=[3,n0,_DMSCR,0,[_AIA],[[0,1]]],DescribeChannelBanRequest$=[3,n0,_DCBRe,0,[_CA,_MA,_CB],[[0,1],[0,1],[0,{[_hH]:_xacb}]]],DescribeChannelBanResponse$=[3,n0,_DCBRes,0,[_CBh],[[()=>ChannelBan$,0]]],DescribeChannelFlowRequest$=[3,n0,_DCFRe,0,[_CFA],[[0,1]]],DescribeChannelFlowResponse$=[3,n0,_DCFRes,0,[_CF],[[()=>ChannelFlow$,0]]],DescribeChannelMembershipForAppInstanceUserRequest$=[3,n0,_DCMFAIUR,0,[_CA,_AIUA,_CB],[[0,1],[0,{[_hQ]:_aiua}],[0,{[_hH]:_xacb}]]],DescribeChannelMembershipForAppInstanceUserResponse$=[3,n0,_DCMFAIURe,0,[_CMh],[[()=>ChannelMembershipForAppInstanceUserSummary$,0]]],DescribeChannelMembershipRequest$=[3,n0,_DCMRes,0,[_CA,_MA,_CB,_SCI],[[0,1],[0,1],[0,{[_hH]:_xacb}],[0,{[_hQ]:_sci}]]],DescribeChannelMembershipResponse$=[3,n0,_DCMResc,0,[_CMh],[[()=>ChannelMembership$,0]]],DescribeChannelModeratedByAppInstanceUserRequest$=[3,n0,_DCMBAIUR,0,[_CA,_AIUA,_CB],[[0,1],[0,{[_hQ]:_aiua}],[0,{[_hH]:_xacb}]]],DescribeChannelModeratedByAppInstanceUserResponse$=[3,n0,_DCMBAIURe,0,[_Ch],[[()=>ChannelModeratedByAppInstanceUserSummary$,0]]],DescribeChannelModeratorRequest$=[3,n0,_DCMRescr,0,[_CA,_CMA,_CB],[[0,1],[0,1],[0,{[_hH]:_xacb}]]],DescribeChannelModeratorResponse$=[3,n0,_DCMRescri,0,[_CMha],[[()=>ChannelModerator$,0]]],DescribeChannelRequest$=[3,n0,_DCRe,0,[_CA,_CB],[[0,1],[0,{[_hH]:_xacb}]]],DescribeChannelResponse$=[3,n0,_DCRes,0,[_Ch],[[()=>Channel$,0]]],DisassociateChannelFlowRequest$=[3,n0,_DCFRi,0,[_CA,_CFA,_CB],[[0,1],[0,1],[0,{[_hH]:_xacb}]]],ElasticChannelConfiguration$=[3,n0,_ECC,0,[_MSC,_TMPSC,_MMP],[1,1,1]],ExpirationSettings$=[3,n0,_ES,0,[_ED,_ECx],[1,0]],ForbiddenException$=[-3,n0,_FE,{[_e]:_c,[_hE]:403},[_Co,_Me],[0,0]];TypeRegistry.for(n0).registerError(ForbiddenException$,ForbiddenException);var GetChannelMembershipPreferencesRequest$=[3,n0,_GCMPR,0,[_CA,_MA,_CB],[[0,1],[0,1],[0,{[_hH]:_xacb}]]],GetChannelMembershipPreferencesResponse$=[3,n0,_GCMPRe,0,[_CA,_Memb,_Pre],[0,[()=>Identity$,0],[()=>ChannelMembershipPreferences$,0]]],GetChannelMessageRequest$=[3,n0,_GCMR,0,[_CA,_MI,_CB,_SCI],[[0,1],[0,1],[0,{[_hH]:_xacb}],[0,{[_hQ]:_sci}]]],GetChannelMessageResponse$=[3,n0,_GCMRe,0,[_CM],[[()=>ChannelMessage$,0]]],GetChannelMessageStatusRequest$=[3,n0,_GCMSR,0,[_CA,_MI,_CB,_SCI],[[0,1],[0,1],[0,{[_hH]:_xacb}],[0,{[_hQ]:_sci}]]],GetChannelMessageStatusResponse$=[3,n0,_GCMSRe,0,[_St],[()=>ChannelMessageStatusStructure$]],GetMessagingSessionEndpointRequest$=[3,n0,_GMSER,0,[_NTe],[[0,{[_hQ]:_nt}]]],GetMessagingSessionEndpointResponse$=[3,n0,_GMSERe,0,[_En],[()=>MessagingSessionEndpoint$]],GetMessagingStreamingConfigurationsRequest$=[3,n0,_GMSCR,0,[_AIA],[[0,1]]],GetMessagingStreamingConfigurationsResponse$=[3,n0,_GMSCRe,0,[_SC],[()=>StreamingConfigurationList]],Identity$=[3,n0,_I,0,[_A,_N],[0,[()=>ResourceName,0]]],LambdaConfiguration$=[3,n0,_LC,0,[_RA,_IT],[0,0]],ListChannelBansRequest$=[3,n0,_LCBR,0,[_CA,_MR,_NT,_CB],[[0,1],[1,{[_hQ]:_mr}],[()=>NextToken,{[_hQ]:_nt_}],[0,{[_hH]:_xacb}]]],ListChannelBansResponse$=[3,n0,_LCBRi,0,[_CA,_NT,_CBha],[0,[()=>NextToken,0],[()=>ChannelBanSummaryList,0]]],ListChannelFlowsRequest$=[3,n0,_LCFR,0,[_AIA,_MR,_NT],[[0,{[_hQ]:_aia}],[1,{[_hQ]:_mr}],[()=>NextToken,{[_hQ]:_nt_}]]],ListChannelFlowsResponse$=[3,n0,_LCFRi,0,[_CFh,_NT],[[()=>ChannelFlowSummaryList,0],[()=>NextToken,0]]],ListChannelMembershipsForAppInstanceUserRequest$=[3,n0,_LCMFAIUR,0,[_AIUA,_MR,_NT,_CB],[[0,{[_hQ]:_aiua}],[1,{[_hQ]:_mr}],[()=>NextToken,{[_hQ]:_nt_}],[0,{[_hH]:_xacb}]]],ListChannelMembershipsForAppInstanceUserResponse$=[3,n0,_LCMFAIURi,0,[_CMhan,_NT],[[()=>ChannelMembershipForAppInstanceUserSummaryList,0],[()=>NextToken,0]]],ListChannelMembershipsRequest$=[3,n0,_LCMR,0,[_CA,_T,_MR,_NT,_CB,_SCI],[[0,1],[0,{[_hQ]:_t}],[1,{[_hQ]:_mr}],[()=>NextToken,{[_hQ]:_nt_}],[0,{[_hH]:_xacb}],[0,{[_hQ]:_sci}]]],ListChannelMembershipsResponse$=[3,n0,_LCMRi,0,[_CA,_CMhan,_NT],[0,[()=>ChannelMembershipSummaryList,0],[()=>NextToken,0]]],ListChannelMessagesRequest$=[3,n0,_LCMRis,0,[_CA,_SO,_NB,_NA,_MR,_NT,_CB,_SCI],[[0,1],[0,{[_hQ]:_so}],[4,{[_hQ]:_nb}],[4,{[_hQ]:_na}],[1,{[_hQ]:_mr}],[()=>NextToken,{[_hQ]:_nt_}],[0,{[_hH]:_xacb}],[0,{[_hQ]:_sci}]]],ListChannelMessagesResponse$=[3,n0,_LCMRist,0,[_CA,_NT,_CMhann,_SCI],[0,[()=>NextToken,0],[()=>ChannelMessageSummaryList,0],0]],ListChannelModeratorsRequest$=[3,n0,_LCMRisth,0,[_CA,_MR,_NT,_CB],[[0,1],[1,{[_hQ]:_mr}],[()=>NextToken,{[_hQ]:_nt_}],[0,{[_hH]:_xacb}]]],ListChannelModeratorsResponse$=[3,n0,_LCMRistha,0,[_CA,_NT,_CMhanne],[0,[()=>NextToken,0],[()=>ChannelModeratorSummaryList,0]]],ListChannelsAssociatedWithChannelFlowRequest$=[3,n0,_LCAWCFR,0,[_CFA,_MR,_NT],[[0,{[_hQ]:_cfa}],[1,{[_hQ]:_mr}],[()=>NextToken,{[_hQ]:_nt_}]]],ListChannelsAssociatedWithChannelFlowResponse$=[3,n0,_LCAWCFRi,0,[_Cha,_NT],[[()=>ChannelAssociatedWithFlowSummaryList,0],[()=>NextToken,0]]],ListChannelsModeratedByAppInstanceUserRequest$=[3,n0,_LCMBAIUR,0,[_AIUA,_MR,_NT,_CB],[[0,{[_hQ]:_aiua}],[1,{[_hQ]:_mr}],[()=>NextToken,{[_hQ]:_nt_}],[0,{[_hH]:_xacb}]]],ListChannelsModeratedByAppInstanceUserResponse$=[3,n0,_LCMBAIURi,0,[_Cha,_NT],[[()=>ChannelModeratedByAppInstanceUserSummaryList,0],[()=>NextToken,0]]],ListChannelsRequest$=[3,n0,_LCR,0,[_AIA,_P,_MR,_NT,_CB],[[0,{[_hQ]:_aia}],[0,{[_hQ]:_p}],[1,{[_hQ]:_mr}],[()=>NextToken,{[_hQ]:_nt_}],[0,{[_hH]:_xacb}]]],ListChannelsResponse$=[3,n0,_LCRi,0,[_Cha,_NT],[[()=>ChannelSummaryList,0],[()=>NextToken,0]]],ListSubChannelsRequest$=[3,n0,_LSCR,0,[_CA,_CB,_MR,_NT],[[0,1],[0,{[_hH]:_xacb}],[1,{[_hQ]:_mr}],[()=>NextToken,{[_hQ]:_nt_}]]],ListSubChannelsResponse$=[3,n0,_LSCRi,0,[_CA,_SCu,_NT],[0,()=>SubChannelSummaryList,[()=>NextToken,0]]],ListTagsForResourceRequest$=[3,n0,_LTFRR,0,[_RARN],[[0,{[_hQ]:_a}]]],ListTagsForResourceResponse$=[3,n0,_LTFRRi,0,[_Tag],[[()=>TagList,0]]],MessageAttributeValue$=[3,n0,_MAV,0,[_SV],[[()=>MessageAttributeStringValues,0]]],MessagingSessionEndpoint$=[3,n0,_MSE,0,[_U],[0]],NotFoundException$=[-3,n0,_NFE,{[_e]:_c,[_hE]:404},[_Co,_Me],[0,0]];TypeRegistry.for(n0).registerError(NotFoundException$,NotFoundException);var Processor$=[3,n0,_Pro,0,[_N,_Con,_EO,_FA],[[()=>NonEmptyResourceName,0],()=>ProcessorConfiguration$,1,0]],ProcessorConfiguration$=[3,n0,_PC,0,[_L],[()=>LambdaConfiguration$]],PushNotificationConfiguration$=[3,n0,_PNC,0,[_Ti,_B,_T],[[()=>PushNotificationTitle,0],[()=>PushNotificationBody,0],0]],PushNotificationPreferences$=[3,n0,_PNP,0,[_AN,_FR],[0,[()=>FilterRule,0]]],PutChannelExpirationSettingsRequest$=[3,n0,_PCESR,0,[_CA,_CB,_ES],[[0,1],[0,{[_hH]:_xacb}],()=>ExpirationSettings$]],PutChannelExpirationSettingsResponse$=[3,n0,_PCESRu,0,[_CA,_ES],[0,()=>ExpirationSettings$]],PutChannelMembershipPreferencesRequest$=[3,n0,_PCMPR,0,[_CA,_MA,_CB,_Pre],[[0,1],[0,1],[0,{[_hH]:_xacb}],[()=>ChannelMembershipPreferences$,0]]],PutChannelMembershipPreferencesResponse$=[3,n0,_PCMPRu,0,[_CA,_Memb,_Pre],[0,[()=>Identity$,0],[()=>ChannelMembershipPreferences$,0]]],PutMessagingStreamingConfigurationsRequest$=[3,n0,_PMSCR,0,[_AIA,_SC],[[0,1],()=>StreamingConfigurationList]],PutMessagingStreamingConfigurationsResponse$=[3,n0,_PMSCRu,0,[_SC],[()=>StreamingConfigurationList]],RedactChannelMessageRequest$=[3,n0,_RCMR,0,[_CA,_MI,_CB,_SCI],[[0,1],[0,1],[0,{[_hH]:_xacb}],0]],RedactChannelMessageResponse$=[3,n0,_RCMRe,0,[_CA,_MI,_SCI],[0,0,0]],ResourceLimitExceededException$=[-3,n0,_RLEE,{[_e]:_c,[_hE]:400},[_Co,_Me],[0,0]];TypeRegistry.for(n0).registerError(ResourceLimitExceededException$,ResourceLimitExceededException);var SearchChannelsRequest$=[3,n0,_SCR,0,[_CB,_F,_MR,_NT],[[0,{[_hH]:_xacb}],()=>SearchFields,[1,{[_hQ]:_mr}],[()=>NextToken,{[_hQ]:_nt_}]]],SearchChannelsResponse$=[3,n0,_SCRe,0,[_Cha,_NT],[[()=>ChannelSummaryList,0],[()=>NextToken,0]]],SearchField$=[3,n0,_SF,0,[_K,_Va,_O],[0,64,0]],SendChannelMessageRequest$=[3,n0,_SCMR,0,[_CA,_C,_T,_Pe,_M,_CRT,_CB,_PNu,_MAes,_SCI,_CT,_Ta],[[0,1],[()=>NonEmptyContent,0],0,0,[()=>Metadata,0],[()=>ClientRequestToken,4],[0,{[_hH]:_xacb}],[()=>PushNotificationConfiguration$,0],[()=>MessageAttributeMap,0],0,[()=>ContentType,0],()=>TargetList]],SendChannelMessageResponse$=[3,n0,_SCMRe,0,[_CA,_MI,_St,_SCI],[0,0,()=>ChannelMessageStatusStructure$,0]],ServiceFailureException$=[-3,n0,_SFE,{[_e]:_s,[_hE]:500},[_Co,_Me],[0,0]];TypeRegistry.for(n0).registerError(ServiceFailureException$,ServiceFailureException);var ServiceUnavailableException$=[-3,n0,_SUE,{[_e]:_s,[_hE]:503},[_Co,_Me],[0,0]];TypeRegistry.for(n0).registerError(ServiceUnavailableException$,ServiceUnavailableException);var StreamingConfiguration$=[3,n0,_SCt,0,[_DT,_RA],[0,0]],SubChannelSummary$=[3,n0,_SCS,0,[_SCI,_MC],[0,1]],Tag$=[3,n0,_Tag_,0,[_K,_V],[[()=>TagKey,0],[()=>TagValue,0]]],TagResourceRequest$=[3,n0,_TRR,0,[_RARN,_Tag],[0,[()=>TagList,0]]],Target$=[3,n0,_Ta,0,[_MA],[0]],ThrottledClientException$=[-3,n0,_TCE,{[_e]:_c,[_hE]:429},[_Co,_Me],[0,0]];TypeRegistry.for(n0).registerError(ThrottledClientException$,ThrottledClientException);var UnauthorizedClientException$=[-3,n0,_UCE,{[_e]:_c,[_hE]:401},[_Co,_Me],[0,0]];TypeRegistry.for(n0).registerError(UnauthorizedClientException$,UnauthorizedClientException);var UntagResourceRequest$=[3,n0,_URR,0,[_RARN,_TKa],[0,[()=>TagKeyList,0]]],UpdateChannelFlowRequest$=[3,n0,_UCFR,0,[_CFA,_Pr,_N],[[0,1],[()=>ProcessorList,0],[()=>NonEmptyResourceName,0]]],UpdateChannelFlowResponse$=[3,n0,_UCFRp,0,[_CFA],[0]],UpdateChannelMessageRequest$=[3,n0,_UCMR,0,[_CA,_MI,_C,_M,_CB,_SCI,_CT],[[0,1],[0,1],[()=>NonEmptyContent,0],[()=>Metadata,0],[0,{[_hH]:_xacb}],0,[()=>ContentType,0]]],UpdateChannelMessageResponse$=[3,n0,_UCMRp,0,[_CA,_MI,_St,_SCI],[0,0,()=>ChannelMessageStatusStructure$,0]],UpdateChannelReadMarkerRequest$=[3,n0,_UCRMR,0,[_CA,_CB],[[0,1],[0,{[_hH]:_xacb}]]],UpdateChannelReadMarkerResponse$=[3,n0,_UCRMRp,0,[_CA],[0]],UpdateChannelRequest$=[3,n0,_UCR,0,[_CA,_N,_Mo,_M,_CB],[[0,1],[()=>NonEmptyResourceName,0],0,[()=>Metadata,0],[0,{[_hH]:_xacb}]]],UpdateChannelResponse$=[3,n0,_UCRp,0,[_CA],[0]],__Unit="unit",ChimeSDKMessagingServiceException$=[-3,_sm,"ChimeSDKMessagingServiceException",0,[],[]];TypeRegistry.for(_sm).registerError(ChimeSDKMessagingServiceException$,ChimeSDKMessagingServiceException);var BatchCreateChannelMembershipErrors=[1,n0,_BCCMEa,0,()=>BatchCreateChannelMembershipError$],ChannelAssociatedWithFlowSummaryList=[1,n0,_CAWFSL,0,[()=>ChannelAssociatedWithFlowSummary$,0]],ChannelBanSummaryList=[1,n0,_CBSL,0,[()=>ChannelBanSummary$,0]],ChannelFlowSummaryList=[1,n0,_CFSL,0,[()=>ChannelFlowSummary$,0]],ChannelMembershipForAppInstanceUserSummaryList=[1,n0,_CMFAIUSL,0,[()=>ChannelMembershipForAppInstanceUserSummary$,0]],ChannelMembershipSummaryList=[1,n0,_CMSL,0,[()=>ChannelMembershipSummary$,0]],ChannelMessageSummaryList=[1,n0,_CMSLh,0,[()=>ChannelMessageSummary$,0]],ChannelModeratedByAppInstanceUserSummaryList=[1,n0,_CMBAIUSL,0,[()=>ChannelModeratedByAppInstanceUserSummary$,0]],ChannelModeratorSummaryList=[1,n0,_CMSLha,0,[()=>ChannelModeratorSummary$,0]],ChannelSummaryList=[1,n0,_CSL,0,[()=>ChannelSummary$,0]],Members=[1,n0,_Mem,0,[()=>Identity$,0]],MessageAttributeStringValues=[1,n0,_MASVe,0,[()=>MessageAttributeStringValue,0]],ProcessorList=[1,n0,_PL,0,[()=>Processor$,0]],SearchFields=[1,n0,_SFe,0,()=>SearchField$],StreamingConfigurationList=[1,n0,_SCL,0,()=>StreamingConfiguration$],SubChannelSummaryList=[1,n0,_SCSL,0,()=>SubChannelSummary$],TagKeyList=[1,n0,_TKL,0,[()=>TagKey,0]],TagList=[1,n0,_TL,0,[()=>Tag$,0]],TargetList=[1,n0,_TLa,0,()=>Target$],MessageAttributeMap=[2,n0,_MAM,0,[()=>MessageAttributeName,0],[()=>MessageAttributeValue$,0]],AssociateChannelFlow$=[9,n0,_ACF,{[_h]:["PUT","/channels/{ChannelArn}/channel-flow",200]},()=>AssociateChannelFlowRequest$,()=>__Unit],BatchCreateChannelMembership$=[9,n0,_BCCM,{[_h]:["POST","/channels/{ChannelArn}/memberships?operation=batch-create",200]},()=>BatchCreateChannelMembershipRequest$,()=>BatchCreateChannelMembershipResponse$],ChannelFlowCallback$=[9,n0,_CFC,{[_h]:["POST","/channels/{ChannelArn}?operation=channel-flow-callback",200]},()=>ChannelFlowCallbackRequest$,()=>ChannelFlowCallbackResponse$],CreateChannel$=[9,n0,_CC,{[_h]:["POST","/channels",201]},()=>CreateChannelRequest$,()=>CreateChannelResponse$],CreateChannelBan$=[9,n0,_CCB,{[_h]:["POST","/channels/{ChannelArn}/bans",201]},()=>CreateChannelBanRequest$,()=>CreateChannelBanResponse$],CreateChannelFlow$=[9,n0,_CCF,{[_h]:["POST","/channel-flows",201]},()=>CreateChannelFlowRequest$,()=>CreateChannelFlowResponse$],CreateChannelMembership$=[9,n0,_CCM,{[_h]:["POST","/channels/{ChannelArn}/memberships",201]},()=>CreateChannelMembershipRequest$,()=>CreateChannelMembershipResponse$],CreateChannelModerator$=[9,n0,_CCMr,{[_h]:["POST","/channels/{ChannelArn}/moderators",201]},()=>CreateChannelModeratorRequest$,()=>CreateChannelModeratorResponse$],DeleteChannel$=[9,n0,_DC,{[_h]:["DELETE","/channels/{ChannelArn}",204]},()=>DeleteChannelRequest$,()=>__Unit],DeleteChannelBan$=[9,n0,_DCB,{[_h]:["DELETE","/channels/{ChannelArn}/bans/{MemberArn}",204]},()=>DeleteChannelBanRequest$,()=>__Unit],DeleteChannelFlow$=[9,n0,_DCF,{[_h]:["DELETE","/channel-flows/{ChannelFlowArn}",204]},()=>DeleteChannelFlowRequest$,()=>__Unit],DeleteChannelMembership$=[9,n0,_DCM,{[_h]:["DELETE","/channels/{ChannelArn}/memberships/{MemberArn}",204]},()=>DeleteChannelMembershipRequest$,()=>__Unit],DeleteChannelMessage$=[9,n0,_DCMe,{[_h]:["DELETE","/channels/{ChannelArn}/messages/{MessageId}",204]},()=>DeleteChannelMessageRequest$,()=>__Unit],DeleteChannelModerator$=[9,n0,_DCMel,{[_h]:["DELETE","/channels/{ChannelArn}/moderators/{ChannelModeratorArn}",204]},()=>DeleteChannelModeratorRequest$,()=>__Unit],DeleteMessagingStreamingConfigurations$=[9,n0,_DMSC,{[_h]:["DELETE","/app-instances/{AppInstanceArn}/streaming-configurations",204]},()=>DeleteMessagingStreamingConfigurationsRequest$,()=>__Unit],DescribeChannel$=[9,n0,_DCe,{[_h]:["GET","/channels/{ChannelArn}",200]},()=>DescribeChannelRequest$,()=>DescribeChannelResponse$],DescribeChannelBan$=[9,n0,_DCBe,{[_h]:["GET","/channels/{ChannelArn}/bans/{MemberArn}",200]},()=>DescribeChannelBanRequest$,()=>DescribeChannelBanResponse$],DescribeChannelFlow$=[9,n0,_DCFe,{[_h]:["GET","/channel-flows/{ChannelFlowArn}",200]},()=>DescribeChannelFlowRequest$,()=>DescribeChannelFlowResponse$],DescribeChannelMembership$=[9,n0,_DCMes,{[_h]:["GET","/channels/{ChannelArn}/memberships/{MemberArn}",200]},()=>DescribeChannelMembershipRequest$,()=>DescribeChannelMembershipResponse$],DescribeChannelMembershipForAppInstanceUser$=[9,n0,_DCMFAIU,{[_h]:["GET","/channels/{ChannelArn}?scope=app-instance-user-membership",200]},()=>DescribeChannelMembershipForAppInstanceUserRequest$,()=>DescribeChannelMembershipForAppInstanceUserResponse$],DescribeChannelModeratedByAppInstanceUser$=[9,n0,_DCMBAIU,{[_h]:["GET","/channels/{ChannelArn}?scope=app-instance-user-moderated-channel",200]},()=>DescribeChannelModeratedByAppInstanceUserRequest$,()=>DescribeChannelModeratedByAppInstanceUserResponse$],DescribeChannelModerator$=[9,n0,_DCMesc,{[_h]:["GET","/channels/{ChannelArn}/moderators/{ChannelModeratorArn}",200]},()=>DescribeChannelModeratorRequest$,()=>DescribeChannelModeratorResponse$],DisassociateChannelFlow$=[9,n0,_DCFi,{[_h]:["DELETE","/channels/{ChannelArn}/channel-flow/{ChannelFlowArn}",204]},()=>DisassociateChannelFlowRequest$,()=>__Unit],GetChannelMembershipPreferences$=[9,n0,_GCMP,{[_h]:["GET","/channels/{ChannelArn}/memberships/{MemberArn}/preferences",200]},()=>GetChannelMembershipPreferencesRequest$,()=>GetChannelMembershipPreferencesResponse$],GetChannelMessage$=[9,n0,_GCM,{[_h]:["GET","/channels/{ChannelArn}/messages/{MessageId}",200]},()=>GetChannelMessageRequest$,()=>GetChannelMessageResponse$],GetChannelMessageStatus$=[9,n0,_GCMS,{[_h]:["GET","/channels/{ChannelArn}/messages/{MessageId}?scope=message-status",200]},()=>GetChannelMessageStatusRequest$,()=>GetChannelMessageStatusResponse$],GetMessagingSessionEndpoint$=[9,n0,_GMSE,{[_h]:["GET","/endpoints/messaging-session",200]},()=>GetMessagingSessionEndpointRequest$,()=>GetMessagingSessionEndpointResponse$],GetMessagingStreamingConfigurations$=[9,n0,_GMSC,{[_h]:["GET","/app-instances/{AppInstanceArn}/streaming-configurations",200]},()=>GetMessagingStreamingConfigurationsRequest$,()=>GetMessagingStreamingConfigurationsResponse$],ListChannelBans$=[9,n0,_LCB,{[_h]:["GET","/channels/{ChannelArn}/bans",200]},()=>ListChannelBansRequest$,()=>ListChannelBansResponse$],ListChannelFlows$=[9,n0,_LCF,{[_h]:["GET","/channel-flows",200]},()=>ListChannelFlowsRequest$,()=>ListChannelFlowsResponse$],ListChannelMemberships$=[9,n0,_LCM,{[_h]:["GET","/channels/{ChannelArn}/memberships",200]},()=>ListChannelMembershipsRequest$,()=>ListChannelMembershipsResponse$],ListChannelMembershipsForAppInstanceUser$=[9,n0,_LCMFAIU,{[_h]:["GET","/channels?scope=app-instance-user-memberships",200]},()=>ListChannelMembershipsForAppInstanceUserRequest$,()=>ListChannelMembershipsForAppInstanceUserResponse$],ListChannelMessages$=[9,n0,_LCMi,{[_h]:["GET","/channels/{ChannelArn}/messages",200]},()=>ListChannelMessagesRequest$,()=>ListChannelMessagesResponse$],ListChannelModerators$=[9,n0,_LCMis,{[_h]:["GET","/channels/{ChannelArn}/moderators",200]},()=>ListChannelModeratorsRequest$,()=>ListChannelModeratorsResponse$],ListChannels$=[9,n0,_LCi,{[_h]:["GET","/channels",200]},()=>ListChannelsRequest$,()=>ListChannelsResponse$],ListChannelsAssociatedWithChannelFlow$=[9,n0,_LCAWCF,{[_h]:["GET","/channels?scope=channel-flow-associations",200]},()=>ListChannelsAssociatedWithChannelFlowRequest$,()=>ListChannelsAssociatedWithChannelFlowResponse$],ListChannelsModeratedByAppInstanceUser$=[9,n0,_LCMBAIU,{[_h]:["GET","/channels?scope=app-instance-user-moderated-channels",200]},()=>ListChannelsModeratedByAppInstanceUserRequest$,()=>ListChannelsModeratedByAppInstanceUserResponse$],ListSubChannels$=[9,n0,_LSC,{[_h]:["GET","/channels/{ChannelArn}/subchannels",200]},()=>ListSubChannelsRequest$,()=>ListSubChannelsResponse$],ListTagsForResource$=[9,n0,_LTFR,{[_h]:["GET","/tags",200]},()=>ListTagsForResourceRequest$,()=>ListTagsForResourceResponse$],PutChannelExpirationSettings$=[9,n0,_PCES,{[_h]:["PUT","/channels/{ChannelArn}/expiration-settings",200]},()=>PutChannelExpirationSettingsRequest$,()=>PutChannelExpirationSettingsResponse$],PutChannelMembershipPreferences$=[9,n0,_PCMP,{[_h]:["PUT","/channels/{ChannelArn}/memberships/{MemberArn}/preferences",200]},()=>PutChannelMembershipPreferencesRequest$,()=>PutChannelMembershipPreferencesResponse$],PutMessagingStreamingConfigurations$=[9,n0,_PMSC,{[_h]:["PUT","/app-instances/{AppInstanceArn}/streaming-configurations",200]},()=>PutMessagingStreamingConfigurationsRequest$,()=>PutMessagingStreamingConfigurationsResponse$],RedactChannelMessage$=[9,n0,_RCM,{[_h]:["POST","/channels/{ChannelArn}/messages/{MessageId}?operation=redact",200]},()=>RedactChannelMessageRequest$,()=>RedactChannelMessageResponse$],SearchChannels$=[9,n0,_SCe,{[_h]:["POST","/channels?operation=search",200]},()=>SearchChannelsRequest$,()=>SearchChannelsResponse$],SendChannelMessage$=[9,n0,_SCM,{[_h]:["POST","/channels/{ChannelArn}/messages",201]},()=>SendChannelMessageRequest$,()=>SendChannelMessageResponse$],TagResource$=[9,n0,_TR,{[_h]:["POST","/tags?operation=tag-resource",204]},()=>TagResourceRequest$,()=>__Unit],UntagResource$=[9,n0,_UR,{[_h]:["POST","/tags?operation=untag-resource",204]},()=>UntagResourceRequest$,()=>__Unit],UpdateChannel$=[9,n0,_UC,{[_h]:["PUT","/channels/{ChannelArn}",200]},()=>UpdateChannelRequest$,()=>UpdateChannelResponse$],UpdateChannelFlow$=[9,n0,_UCF,{[_h]:["PUT","/channel-flows/{ChannelFlowArn}",200]},()=>UpdateChannelFlowRequest$,()=>UpdateChannelFlowResponse$],UpdateChannelMessage$=[9,n0,_UCM,{[_h]:["PUT","/channels/{ChannelArn}/messages/{MessageId}",200]},()=>UpdateChannelMessageRequest$,()=>UpdateChannelMessageResponse$],UpdateChannelReadMarker$=[9,n0,_UCRM,{[_h]:["PUT","/channels/{ChannelArn}/readMarker",200]},()=>UpdateChannelReadMarkerRequest$,()=>UpdateChannelReadMarkerResponse$];class AssociateChannelFlowCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","AssociateChannelFlow",{}).n("ChimeSDKMessagingClient","AssociateChannelFlowCommand").sc(AssociateChannelFlow$).build(){}class BatchCreateChannelMembershipCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","BatchCreateChannelMembership",{}).n("ChimeSDKMessagingClient","BatchCreateChannelMembershipCommand").sc(BatchCreateChannelMembership$).build(){}class ChannelFlowCallbackCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ChannelFlowCallback",{}).n("ChimeSDKMessagingClient","ChannelFlowCallbackCommand").sc(ChannelFlowCallback$).build(){}class CreateChannelBanCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","CreateChannelBan",{}).n("ChimeSDKMessagingClient","CreateChannelBanCommand").sc(CreateChannelBan$).build(){}class CreateChannelCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","CreateChannel",{}).n("ChimeSDKMessagingClient","CreateChannelCommand").sc(CreateChannel$).build(){}class CreateChannelFlowCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","CreateChannelFlow",{}).n("ChimeSDKMessagingClient","CreateChannelFlowCommand").sc(CreateChannelFlow$).build(){}class CreateChannelMembershipCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","CreateChannelMembership",{}).n("ChimeSDKMessagingClient","CreateChannelMembershipCommand").sc(CreateChannelMembership$).build(){}class CreateChannelModeratorCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","CreateChannelModerator",{}).n("ChimeSDKMessagingClient","CreateChannelModeratorCommand").sc(CreateChannelModerator$).build(){}class DeleteChannelBanCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteChannelBan",{}).n("ChimeSDKMessagingClient","DeleteChannelBanCommand").sc(DeleteChannelBan$).build(){}class DeleteChannelCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteChannel",{}).n("ChimeSDKMessagingClient","DeleteChannelCommand").sc(DeleteChannel$).build(){}class DeleteChannelFlowCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteChannelFlow",{}).n("ChimeSDKMessagingClient","DeleteChannelFlowCommand").sc(DeleteChannelFlow$).build(){}class DeleteChannelMembershipCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteChannelMembership",{}).n("ChimeSDKMessagingClient","DeleteChannelMembershipCommand").sc(DeleteChannelMembership$).build(){}class DeleteChannelMessageCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteChannelMessage",{}).n("ChimeSDKMessagingClient","DeleteChannelMessageCommand").sc(DeleteChannelMessage$).build(){}class DeleteChannelModeratorCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteChannelModerator",{}).n("ChimeSDKMessagingClient","DeleteChannelModeratorCommand").sc(DeleteChannelModerator$).build(){}class DeleteMessagingStreamingConfigurationsCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteMessagingStreamingConfigurations",{}).n("ChimeSDKMessagingClient","DeleteMessagingStreamingConfigurationsCommand").sc(DeleteMessagingStreamingConfigurations$).build(){}class DescribeChannelBanCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannelBan",{}).n("ChimeSDKMessagingClient","DescribeChannelBanCommand").sc(DescribeChannelBan$).build(){}class DescribeChannelCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannel",{}).n("ChimeSDKMessagingClient","DescribeChannelCommand").sc(DescribeChannel$).build(){}class DescribeChannelFlowCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannelFlow",{}).n("ChimeSDKMessagingClient","DescribeChannelFlowCommand").sc(DescribeChannelFlow$).build(){}class DescribeChannelMembershipCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannelMembership",{}).n("ChimeSDKMessagingClient","DescribeChannelMembershipCommand").sc(DescribeChannelMembership$).build(){}class DescribeChannelMembershipForAppInstanceUserCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannelMembershipForAppInstanceUser",{}).n("ChimeSDKMessagingClient","DescribeChannelMembershipForAppInstanceUserCommand").sc(DescribeChannelMembershipForAppInstanceUser$).build(){}class DescribeChannelModeratedByAppInstanceUserCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannelModeratedByAppInstanceUser",{}).n("ChimeSDKMessagingClient","DescribeChannelModeratedByAppInstanceUserCommand").sc(DescribeChannelModeratedByAppInstanceUser$).build(){}class DescribeChannelModeratorCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannelModerator",{}).n("ChimeSDKMessagingClient","DescribeChannelModeratorCommand").sc(DescribeChannelModerator$).build(){}class DisassociateChannelFlowCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DisassociateChannelFlow",{}).n("ChimeSDKMessagingClient","DisassociateChannelFlowCommand").sc(DisassociateChannelFlow$).build(){}class GetChannelMembershipPreferencesCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","GetChannelMembershipPreferences",{}).n("ChimeSDKMessagingClient","GetChannelMembershipPreferencesCommand").sc(GetChannelMembershipPreferences$).build(){}class GetChannelMessageCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","GetChannelMessage",{}).n("ChimeSDKMessagingClient","GetChannelMessageCommand").sc(GetChannelMessage$).build(){}class GetChannelMessageStatusCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","GetChannelMessageStatus",{}).n("ChimeSDKMessagingClient","GetChannelMessageStatusCommand").sc(GetChannelMessageStatus$).build(){}class GetMessagingSessionEndpointCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","GetMessagingSessionEndpoint",{}).n("ChimeSDKMessagingClient","GetMessagingSessionEndpointCommand").sc(GetMessagingSessionEndpoint$).build(){}class GetMessagingStreamingConfigurationsCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","GetMessagingStreamingConfigurations",{}).n("ChimeSDKMessagingClient","GetMessagingStreamingConfigurationsCommand").sc(GetMessagingStreamingConfigurations$).build(){}class ListChannelBansCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelBans",{}).n("ChimeSDKMessagingClient","ListChannelBansCommand").sc(ListChannelBans$).build(){}class ListChannelFlowsCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelFlows",{}).n("ChimeSDKMessagingClient","ListChannelFlowsCommand").sc(ListChannelFlows$).build(){}class ListChannelMembershipsCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelMemberships",{}).n("ChimeSDKMessagingClient","ListChannelMembershipsCommand").sc(ListChannelMemberships$).build(){}class ListChannelMembershipsForAppInstanceUserCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelMembershipsForAppInstanceUser",{}).n("ChimeSDKMessagingClient","ListChannelMembershipsForAppInstanceUserCommand").sc(ListChannelMembershipsForAppInstanceUser$).build(){}class ListChannelMessagesCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelMessages",{}).n("ChimeSDKMessagingClient","ListChannelMessagesCommand").sc(ListChannelMessages$).build(){}class ListChannelModeratorsCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelModerators",{}).n("ChimeSDKMessagingClient","ListChannelModeratorsCommand").sc(ListChannelModerators$).build(){}class ListChannelsAssociatedWithChannelFlowCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelsAssociatedWithChannelFlow",{}).n("ChimeSDKMessagingClient","ListChannelsAssociatedWithChannelFlowCommand").sc(ListChannelsAssociatedWithChannelFlow$).build(){}class ListChannelsCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannels",{}).n("ChimeSDKMessagingClient","ListChannelsCommand").sc(ListChannels$).build(){}class ListChannelsModeratedByAppInstanceUserCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelsModeratedByAppInstanceUser",{}).n("ChimeSDKMessagingClient","ListChannelsModeratedByAppInstanceUserCommand").sc(ListChannelsModeratedByAppInstanceUser$).build(){}class ListSubChannelsCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListSubChannels",{}).n("ChimeSDKMessagingClient","ListSubChannelsCommand").sc(ListSubChannels$).build(){}class ListTagsForResourceCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListTagsForResource",{}).n("ChimeSDKMessagingClient","ListTagsForResourceCommand").sc(ListTagsForResource$).build(){}class PutChannelExpirationSettingsCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","PutChannelExpirationSettings",{}).n("ChimeSDKMessagingClient","PutChannelExpirationSettingsCommand").sc(PutChannelExpirationSettings$).build(){}class PutChannelMembershipPreferencesCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","PutChannelMembershipPreferences",{}).n("ChimeSDKMessagingClient","PutChannelMembershipPreferencesCommand").sc(PutChannelMembershipPreferences$).build(){}class PutMessagingStreamingConfigurationsCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","PutMessagingStreamingConfigurations",{}).n("ChimeSDKMessagingClient","PutMessagingStreamingConfigurationsCommand").sc(PutMessagingStreamingConfigurations$).build(){}class RedactChannelMessageCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","RedactChannelMessage",{}).n("ChimeSDKMessagingClient","RedactChannelMessageCommand").sc(RedactChannelMessage$).build(){}class SearchChannelsCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","SearchChannels",{}).n("ChimeSDKMessagingClient","SearchChannelsCommand").sc(SearchChannels$).build(){}class SendChannelMessageCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","SendChannelMessage",{}).n("ChimeSDKMessagingClient","SendChannelMessageCommand").sc(SendChannelMessage$).build(){}class TagResourceCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","TagResource",{}).n("ChimeSDKMessagingClient","TagResourceCommand").sc(TagResource$).build(){}class UntagResourceCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","UntagResource",{}).n("ChimeSDKMessagingClient","UntagResourceCommand").sc(UntagResource$).build(){}class UpdateChannelCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","UpdateChannel",{}).n("ChimeSDKMessagingClient","UpdateChannelCommand").sc(UpdateChannel$).build(){}class UpdateChannelFlowCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","UpdateChannelFlow",{}).n("ChimeSDKMessagingClient","UpdateChannelFlowCommand").sc(UpdateChannelFlow$).build(){}class UpdateChannelMessageCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","UpdateChannelMessage",{}).n("ChimeSDKMessagingClient","UpdateChannelMessageCommand").sc(UpdateChannelMessage$).build(){}class UpdateChannelReadMarkerCommand extends Command.classBuilder().ep(commonParams).m(function($,_,tt,nt){return[getEndpointPlugin(tt,$.getEndpointParameterInstructions())]}).s("ChimeMessagingService","UpdateChannelReadMarker",{}).n("ChimeSDKMessagingClient","UpdateChannelReadMarkerCommand").sc(UpdateChannelReadMarker$).build(){}const commands={AssociateChannelFlowCommand,BatchCreateChannelMembershipCommand,ChannelFlowCallbackCommand,CreateChannelCommand,CreateChannelBanCommand,CreateChannelFlowCommand,CreateChannelMembershipCommand,CreateChannelModeratorCommand,DeleteChannelCommand,DeleteChannelBanCommand,DeleteChannelFlowCommand,DeleteChannelMembershipCommand,DeleteChannelMessageCommand,DeleteChannelModeratorCommand,DeleteMessagingStreamingConfigurationsCommand,DescribeChannelCommand,DescribeChannelBanCommand,DescribeChannelFlowCommand,DescribeChannelMembershipCommand,DescribeChannelMembershipForAppInstanceUserCommand,DescribeChannelModeratedByAppInstanceUserCommand,DescribeChannelModeratorCommand,DisassociateChannelFlowCommand,GetChannelMembershipPreferencesCommand,GetChannelMessageCommand,GetChannelMessageStatusCommand,GetMessagingSessionEndpointCommand,GetMessagingStreamingConfigurationsCommand,ListChannelBansCommand,ListChannelFlowsCommand,ListChannelMembershipsCommand,ListChannelMembershipsForAppInstanceUserCommand,ListChannelMessagesCommand,ListChannelModeratorsCommand,ListChannelsCommand,ListChannelsAssociatedWithChannelFlowCommand,ListChannelsModeratedByAppInstanceUserCommand,ListSubChannelsCommand,ListTagsForResourceCommand,PutChannelExpirationSettingsCommand,PutChannelMembershipPreferencesCommand,PutMessagingStreamingConfigurationsCommand,RedactChannelMessageCommand,SearchChannelsCommand,SendChannelMessageCommand,TagResourceCommand,UntagResourceCommand,UpdateChannelCommand,UpdateChannelFlowCommand,UpdateChannelMessageCommand,UpdateChannelReadMarkerCommand};class ChimeSDKMessaging extends ChimeSDKMessagingClient{}createAggregatedClient(commands,ChimeSDKMessaging);const paginateListChannelBans=createPaginator(ChimeSDKMessagingClient,ListChannelBansCommand,"NextToken","NextToken","MaxResults"),paginateListChannelFlows=createPaginator(ChimeSDKMessagingClient,ListChannelFlowsCommand,"NextToken","NextToken","MaxResults"),paginateListChannelMemberships=createPaginator(ChimeSDKMessagingClient,ListChannelMembershipsCommand,"NextToken","NextToken","MaxResults"),paginateListChannelMembershipsForAppInstanceUser=createPaginator(ChimeSDKMessagingClient,ListChannelMembershipsForAppInstanceUserCommand,"NextToken","NextToken","MaxResults"),paginateListChannelMessages=createPaginator(ChimeSDKMessagingClient,ListChannelMessagesCommand,"NextToken","NextToken","MaxResults"),paginateListChannelModerators=createPaginator(ChimeSDKMessagingClient,ListChannelModeratorsCommand,"NextToken","NextToken","MaxResults"),paginateListChannels=createPaginator(ChimeSDKMessagingClient,ListChannelsCommand,"NextToken","NextToken","MaxResults"),paginateListChannelsAssociatedWithChannelFlow=createPaginator(ChimeSDKMessagingClient,ListChannelsAssociatedWithChannelFlowCommand,"NextToken","NextToken","MaxResults"),paginateListChannelsModeratedByAppInstanceUser=createPaginator(ChimeSDKMessagingClient,ListChannelsModeratedByAppInstanceUserCommand,"NextToken","NextToken","MaxResults"),paginateListSubChannels=createPaginator(ChimeSDKMessagingClient,ListSubChannelsCommand,"NextToken","NextToken","MaxResults"),paginateSearchChannels=createPaginator(ChimeSDKMessagingClient,SearchChannelsCommand,"NextToken","NextToken","MaxResults"),AllowNotifications={ALL:"ALL",FILTERED:"FILTERED",NONE:"NONE"},ChannelMembershipType={DEFAULT:"DEFAULT",HIDDEN:"HIDDEN"},ErrorCode={AccessDenied:"AccessDenied",BadRequest:"BadRequest",Conflict:"Conflict",Forbidden:"Forbidden",NotFound:"NotFound",PhoneNumberAssociationsExist:"PhoneNumberAssociationsExist",PreconditionFailed:"PreconditionFailed",ResourceLimitExceeded:"ResourceLimitExceeded",ServiceFailure:"ServiceFailure",ServiceUnavailable:"ServiceUnavailable",Throttled:"Throttled",Throttling:"Throttling",Unauthorized:"Unauthorized",Unprocessable:"Unprocessable",VoiceConnectorGroupAssociationsExist:"VoiceConnectorGroupAssociationsExist"},ExpirationCriterion={CREATED_TIMESTAMP:"CREATED_TIMESTAMP",LAST_MESSAGE_TIMESTAMP:"LAST_MESSAGE_TIMESTAMP"},ChannelMode={RESTRICTED:"RESTRICTED",UNRESTRICTED:"UNRESTRICTED"},ChannelPrivacy={PRIVATE:"PRIVATE",PUBLIC:"PUBLIC"},InvocationType={ASYNC:"ASYNC"},FallbackAction={ABORT:"ABORT",CONTINUE:"CONTINUE"},PushNotificationType={DEFAULT:"DEFAULT",VOIP:"VOIP"},ChannelMessagePersistenceType={NON_PERSISTENT:"NON_PERSISTENT",PERSISTENT:"PERSISTENT"},ChannelMessageStatus={DENIED:"DENIED",FAILED:"FAILED",PENDING:"PENDING",SENT:"SENT"},ChannelMessageType={CONTROL:"CONTROL",STANDARD:"STANDARD"},NetworkType={DUAL_STACK:"DUAL_STACK",IPV4_ONLY:"IPV4_ONLY"},MessagingDataType={Channel:"Channel",ChannelMessage:"ChannelMessage"},SortOrder={ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},SearchFieldKey={MEMBERS:"MEMBERS"},SearchFieldOperator={EQUALS:"EQUALS",INCLUDES:"INCLUDES"},distEs$1=Object.freeze(Object.defineProperty({__proto__:null,$Command:Command,AllowNotifications,AppInstanceUserMembershipSummary$,AssociateChannelFlow$,AssociateChannelFlowCommand,AssociateChannelFlowRequest$,BadRequestException,BadRequestException$,BatchChannelMemberships$,BatchCreateChannelMembership$,BatchCreateChannelMembershipCommand,BatchCreateChannelMembershipError$,BatchCreateChannelMembershipRequest$,BatchCreateChannelMembershipResponse$,Channel$,ChannelAssociatedWithFlowSummary$,ChannelBan$,ChannelBanSummary$,ChannelFlow$,ChannelFlowCallback$,ChannelFlowCallbackCommand,ChannelFlowCallbackRequest$,ChannelFlowCallbackResponse$,ChannelFlowSummary$,ChannelMembership$,ChannelMembershipForAppInstanceUserSummary$,ChannelMembershipPreferences$,ChannelMembershipSummary$,ChannelMembershipType,ChannelMessage$,ChannelMessageCallback$,ChannelMessagePersistenceType,ChannelMessageStatus,ChannelMessageStatusStructure$,ChannelMessageSummary$,ChannelMessageType,ChannelMode,ChannelModeratedByAppInstanceUserSummary$,ChannelModerator$,ChannelModeratorSummary$,ChannelPrivacy,ChannelSummary$,ChimeSDKMessaging,ChimeSDKMessagingClient,ChimeSDKMessagingServiceException,ChimeSDKMessagingServiceException$,ConflictException,ConflictException$,CreateChannel$,CreateChannelBan$,CreateChannelBanCommand,CreateChannelBanRequest$,CreateChannelBanResponse$,CreateChannelCommand,CreateChannelFlow$,CreateChannelFlowCommand,CreateChannelFlowRequest$,CreateChannelFlowResponse$,CreateChannelMembership$,CreateChannelMembershipCommand,CreateChannelMembershipRequest$,CreateChannelMembershipResponse$,CreateChannelModerator$,CreateChannelModeratorCommand,CreateChannelModeratorRequest$,CreateChannelModeratorResponse$,CreateChannelRequest$,CreateChannelResponse$,DeleteChannel$,DeleteChannelBan$,DeleteChannelBanCommand,DeleteChannelBanRequest$,DeleteChannelCommand,DeleteChannelFlow$,DeleteChannelFlowCommand,DeleteChannelFlowRequest$,DeleteChannelMembership$,DeleteChannelMembershipCommand,DeleteChannelMembershipRequest$,DeleteChannelMessage$,DeleteChannelMessageCommand,DeleteChannelMessageRequest$,DeleteChannelModerator$,DeleteChannelModeratorCommand,DeleteChannelModeratorRequest$,DeleteChannelRequest$,DeleteMessagingStreamingConfigurations$,DeleteMessagingStreamingConfigurationsCommand,DeleteMessagingStreamingConfigurationsRequest$,DescribeChannel$,DescribeChannelBan$,DescribeChannelBanCommand,DescribeChannelBanRequest$,DescribeChannelBanResponse$,DescribeChannelCommand,DescribeChannelFlow$,DescribeChannelFlowCommand,DescribeChannelFlowRequest$,DescribeChannelFlowResponse$,DescribeChannelMembership$,DescribeChannelMembershipCommand,DescribeChannelMembershipForAppInstanceUser$,DescribeChannelMembershipForAppInstanceUserCommand,DescribeChannelMembershipForAppInstanceUserRequest$,DescribeChannelMembershipForAppInstanceUserResponse$,DescribeChannelMembershipRequest$,DescribeChannelMembershipResponse$,DescribeChannelModeratedByAppInstanceUser$,DescribeChannelModeratedByAppInstanceUserCommand,DescribeChannelModeratedByAppInstanceUserRequest$,DescribeChannelModeratedByAppInstanceUserResponse$,DescribeChannelModerator$,DescribeChannelModeratorCommand,DescribeChannelModeratorRequest$,DescribeChannelModeratorResponse$,DescribeChannelRequest$,DescribeChannelResponse$,DisassociateChannelFlow$,DisassociateChannelFlowCommand,DisassociateChannelFlowRequest$,ElasticChannelConfiguration$,ErrorCode,ExpirationCriterion,ExpirationSettings$,FallbackAction,ForbiddenException,ForbiddenException$,GetChannelMembershipPreferences$,GetChannelMembershipPreferencesCommand,GetChannelMembershipPreferencesRequest$,GetChannelMembershipPreferencesResponse$,GetChannelMessage$,GetChannelMessageCommand,GetChannelMessageRequest$,GetChannelMessageResponse$,GetChannelMessageStatus$,GetChannelMessageStatusCommand,GetChannelMessageStatusRequest$,GetChannelMessageStatusResponse$,GetMessagingSessionEndpoint$,GetMessagingSessionEndpointCommand,GetMessagingSessionEndpointRequest$,GetMessagingSessionEndpointResponse$,GetMessagingStreamingConfigurations$,GetMessagingStreamingConfigurationsCommand,GetMessagingStreamingConfigurationsRequest$,GetMessagingStreamingConfigurationsResponse$,Identity$,InvocationType,LambdaConfiguration$,ListChannelBans$,ListChannelBansCommand,ListChannelBansRequest$,ListChannelBansResponse$,ListChannelFlows$,ListChannelFlowsCommand,ListChannelFlowsRequest$,ListChannelFlowsResponse$,ListChannelMemberships$,ListChannelMembershipsCommand,ListChannelMembershipsForAppInstanceUser$,ListChannelMembershipsForAppInstanceUserCommand,ListChannelMembershipsForAppInstanceUserRequest$,ListChannelMembershipsForAppInstanceUserResponse$,ListChannelMembershipsRequest$,ListChannelMembershipsResponse$,ListChannelMessages$,ListChannelMessagesCommand,ListChannelMessagesRequest$,ListChannelMessagesResponse$,ListChannelModerators$,ListChannelModeratorsCommand,ListChannelModeratorsRequest$,ListChannelModeratorsResponse$,ListChannels$,ListChannelsAssociatedWithChannelFlow$,ListChannelsAssociatedWithChannelFlowCommand,ListChannelsAssociatedWithChannelFlowRequest$,ListChannelsAssociatedWithChannelFlowResponse$,ListChannelsCommand,ListChannelsModeratedByAppInstanceUser$,ListChannelsModeratedByAppInstanceUserCommand,ListChannelsModeratedByAppInstanceUserRequest$,ListChannelsModeratedByAppInstanceUserResponse$,ListChannelsRequest$,ListChannelsResponse$,ListSubChannels$,ListSubChannelsCommand,ListSubChannelsRequest$,ListSubChannelsResponse$,ListTagsForResource$,ListTagsForResourceCommand,ListTagsForResourceRequest$,ListTagsForResourceResponse$,MessageAttributeValue$,MessagingDataType,MessagingSessionEndpoint$,NetworkType,NotFoundException,NotFoundException$,Processor$,ProcessorConfiguration$,PushNotificationConfiguration$,PushNotificationPreferences$,PushNotificationType,PutChannelExpirationSettings$,PutChannelExpirationSettingsCommand,PutChannelExpirationSettingsRequest$,PutChannelExpirationSettingsResponse$,PutChannelMembershipPreferences$,PutChannelMembershipPreferencesCommand,PutChannelMembershipPreferencesRequest$,PutChannelMembershipPreferencesResponse$,PutMessagingStreamingConfigurations$,PutMessagingStreamingConfigurationsCommand,PutMessagingStreamingConfigurationsRequest$,PutMessagingStreamingConfigurationsResponse$,RedactChannelMessage$,RedactChannelMessageCommand,RedactChannelMessageRequest$,RedactChannelMessageResponse$,ResourceLimitExceededException,ResourceLimitExceededException$,SearchChannels$,SearchChannelsCommand,SearchChannelsRequest$,SearchChannelsResponse$,SearchField$,SearchFieldKey,SearchFieldOperator,SendChannelMessage$,SendChannelMessageCommand,SendChannelMessageRequest$,SendChannelMessageResponse$,ServiceFailureException,ServiceFailureException$,ServiceUnavailableException,ServiceUnavailableException$,SortOrder,StreamingConfiguration$,SubChannelSummary$,Tag$,TagResource$,TagResourceCommand,TagResourceRequest$,Target$,ThrottledClientException,ThrottledClientException$,UnauthorizedClientException,UnauthorizedClientException$,UntagResource$,UntagResourceCommand,UntagResourceRequest$,UpdateChannel$,UpdateChannelCommand,UpdateChannelFlow$,UpdateChannelFlowCommand,UpdateChannelFlowRequest$,UpdateChannelFlowResponse$,UpdateChannelMessage$,UpdateChannelMessageCommand,UpdateChannelMessageRequest$,UpdateChannelMessageResponse$,UpdateChannelReadMarker$,UpdateChannelReadMarkerCommand,UpdateChannelReadMarkerRequest$,UpdateChannelReadMarkerResponse$,UpdateChannelRequest$,UpdateChannelResponse$,__Client:Client,paginateListChannelBans,paginateListChannelFlows,paginateListChannelMemberships,paginateListChannelMembershipsForAppInstanceUser,paginateListChannelMessages,paginateListChannelModerators,paginateListChannels,paginateListChannelsAssociatedWithChannelFlow,paginateListChannelsModeratedByAppInstanceUser,paginateListSubChannels,paginateSearchChannels},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(distEs$1);var Message$1={};Object.defineProperty(Message$1,"__esModule",{value:!0});class Message{constructor($,_,tt){this.type=$,this.headers=_,this.payload=tt}}Message$1.default=Message;var DefaultSigV4$1={},build$1={},jsSha256={},constants={},hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,Object.defineProperty(constants,"__esModule",{value:!0}),constants.MAX_HASHABLE_LENGTH=constants.INIT=constants.KEY=constants.DIGEST_LENGTH=constants.BLOCK_SIZE=void 0,constants.BLOCK_SIZE=64,constants.DIGEST_LENGTH=32,constants.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),constants.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],constants.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1),constants}var RawSha256={},hasRequiredRawSha256;function requireRawSha256(){if(hasRequiredRawSha256)return RawSha256;hasRequiredRawSha256=1,Object.defineProperty(RawSha256,"__esModule",{value:!0}),RawSha256.RawSha256=void 0;var et=requireConstants(),$=function(){function _(){this.state=Int32Array.from(et.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return _.prototype.update=function(tt){if(this.finished)throw new Error("Attempted to update an already finished hash.");var nt=0,it=tt.byteLength;if(this.bytesHashed+=it,this.bytesHashed*8>et.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;it>0;)this.buffer[this.bufferLength++]=tt[nt++],it--,this.bufferLength===et.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},_.prototype.digest=function(){if(!this.finished){var tt=this.bytesHashed*8,nt=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),it=this.bufferLength;if(nt.setUint8(this.bufferLength++,128),it%et.BLOCK_SIZE>=et.BLOCK_SIZE-8){for(var rt=this.bufferLength;rt<et.BLOCK_SIZE;rt++)nt.setUint8(rt,0);this.hashBuffer(),this.bufferLength=0}for(var rt=this.bufferLength;rt<et.BLOCK_SIZE-8;rt++)nt.setUint8(rt,0);nt.setUint32(et.BLOCK_SIZE-8,Math.floor(tt/4294967296),!0),nt.setUint32(et.BLOCK_SIZE-4,tt),this.hashBuffer(),this.finished=!0}for(var ot=new Uint8Array(et.DIGEST_LENGTH),rt=0;rt<8;rt++)ot[rt*4]=this.state[rt]>>>24&255,ot[rt*4+1]=this.state[rt]>>>16&255,ot[rt*4+2]=this.state[rt]>>>8&255,ot[rt*4+3]=this.state[rt]>>>0&255;return ot},_.prototype.hashBuffer=function(){for(var tt=this,nt=tt.buffer,it=tt.state,rt=it[0],ot=it[1],lt=it[2],st=it[3],at=it[4],ct=it[5],dt=it[6],ut=it[7],ft=0;ft<et.BLOCK_SIZE;ft++){if(ft<16)this.temp[ft]=(nt[ft*4]&255)<<24|(nt[ft*4+1]&255)<<16|(nt[ft*4+2]&255)<<8|nt[ft*4+3]&255;else{var pt=this.temp[ft-2],St=(pt>>>17|pt<<15)^(pt>>>19|pt<<13)^pt>>>10;pt=this.temp[ft-15];var gt=(pt>>>7|pt<<25)^(pt>>>18|pt<<14)^pt>>>3;this.temp[ft]=(St+this.temp[ft-7]|0)+(gt+this.temp[ft-16]|0)}var yt=(((at>>>6|at<<26)^(at>>>11|at<<21)^(at>>>25|at<<7))+(at&ct^~at&dt)|0)+(ut+(et.KEY[ft]+this.temp[ft]|0)|0)|0,vt=((rt>>>2|rt<<30)^(rt>>>13|rt<<19)^(rt>>>22|rt<<10))+(rt&ot^rt&lt^ot&lt)|0;ut=dt,dt=ct,ct=at,at=st+yt|0,st=lt,lt=ot,ot=rt,rt=yt+vt|0}it[0]+=rt,it[1]+=ot,it[2]+=lt,it[3]+=st,it[4]+=at,it[5]+=ct,it[6]+=dt,it[7]+=ut},_}();return RawSha256.RawSha256=$,RawSha256}var build={},convertToBuffer={},hasRequiredConvertToBuffer;function requireConvertToBuffer(){if(hasRequiredConvertToBuffer)return convertToBuffer;hasRequiredConvertToBuffer=1,Object.defineProperty(convertToBuffer,"__esModule",{value:!0}),convertToBuffer.convertToBuffer=void 0;var et=require$$0$3,$=typeof Buffer<"u"&&Buffer.from?function(tt){return Buffer.from(tt,"utf8")}:et.fromUtf8;function _(tt){return tt instanceof Uint8Array?tt:typeof tt=="string"?$(tt):ArrayBuffer.isView(tt)?new Uint8Array(tt.buffer,tt.byteOffset,tt.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(tt)}return convertToBuffer.convertToBuffer=_,convertToBuffer}var isEmptyData={},hasRequiredIsEmptyData;function requireIsEmptyData(){if(hasRequiredIsEmptyData)return isEmptyData;hasRequiredIsEmptyData=1,Object.defineProperty(isEmptyData,"__esModule",{value:!0}),isEmptyData.isEmptyData=void 0;function et($){return typeof $=="string"?$.length===0:$.byteLength===0}return isEmptyData.isEmptyData=et,isEmptyData}var numToUint8={},hasRequiredNumToUint8;function requireNumToUint8(){if(hasRequiredNumToUint8)return numToUint8;hasRequiredNumToUint8=1,Object.defineProperty(numToUint8,"__esModule",{value:!0}),numToUint8.numToUint8=void 0;function et($){return new Uint8Array([($&4278190080)>>24,($&16711680)>>16,($&65280)>>8,$&255])}return numToUint8.numToUint8=et,numToUint8}var uint32ArrayFrom={},hasRequiredUint32ArrayFrom;function requireUint32ArrayFrom(){if(hasRequiredUint32ArrayFrom)return uint32ArrayFrom;hasRequiredUint32ArrayFrom=1,Object.defineProperty(uint32ArrayFrom,"__esModule",{value:!0}),uint32ArrayFrom.uint32ArrayFrom=void 0;function et($){if(!Uint32Array.from){for(var _=new Uint32Array($.length),tt=0;tt<$.length;)_[tt]=$[tt],tt+=1;return _}return Uint32Array.from($)}return uint32ArrayFrom.uint32ArrayFrom=et,uint32ArrayFrom}var hasRequiredBuild$1;function requireBuild$1(){return hasRequiredBuild$1||(hasRequiredBuild$1=1,function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.uint32ArrayFrom=et.numToUint8=et.isEmptyData=et.convertToBuffer=void 0;var $=requireConvertToBuffer();Object.defineProperty(et,"convertToBuffer",{enumerable:!0,get:function(){return $.convertToBuffer}});var _=requireIsEmptyData();Object.defineProperty(et,"isEmptyData",{enumerable:!0,get:function(){return _.isEmptyData}});var tt=requireNumToUint8();Object.defineProperty(et,"numToUint8",{enumerable:!0,get:function(){return tt.numToUint8}});var nt=requireUint32ArrayFrom();Object.defineProperty(et,"uint32ArrayFrom",{enumerable:!0,get:function(){return nt.uint32ArrayFrom}})}(build)),build}var hasRequiredJsSha256;function requireJsSha256(){if(hasRequiredJsSha256)return jsSha256;hasRequiredJsSha256=1,Object.defineProperty(jsSha256,"__esModule",{value:!0}),jsSha256.Sha256=void 0;var et=require$$0$4,$=requireConstants(),_=requireRawSha256(),tt=requireBuild$1(),nt=function(){function rt(ot){if(this.hash=new _.RawSha256,ot){this.outer=new _.RawSha256;var lt=it(ot),st=new Uint8Array($.BLOCK_SIZE);st.set(lt);for(var at=0;at<$.BLOCK_SIZE;at++)lt[at]^=54,st[at]^=92;this.hash.update(lt),this.outer.update(st);for(var at=0;at<lt.byteLength;at++)lt[at]=0}}return rt.prototype.update=function(ot){if(!((0,tt.isEmptyData)(ot)||this.error))try{this.hash.update((0,tt.convertToBuffer)(ot))}catch(lt){this.error=lt}},rt.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},rt.prototype.digest=function(){return et.__awaiter(this,void 0,void 0,function(){return et.__generator(this,function(ot){return[2,this.digestSync()]})})},rt}();jsSha256.Sha256=nt;function it(rt){var ot=(0,tt.convertToBuffer)(rt);if(ot.byteLength>$.BLOCK_SIZE){var lt=new _.RawSha256;lt.update(ot),ot=lt.digest()}var st=new Uint8Array($.BLOCK_SIZE);return st.set(ot),st}return jsSha256}(function(et){Object.defineProperty(et,"__esModule",{value:!0});var $=require$$0$4;$.__exportStar(requireJsSha256(),et)})(build$1);const SHORT_TO_HEX={},HEX_TO_SHORT={};for(let et=0;et<256;et++){let $=et.toString(16).toLowerCase();$.length===1&&($=`0${$}`),SHORT_TO_HEX[et]=$,HEX_TO_SHORT[$]=et}function fromHex(et){if(et.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const $=new Uint8Array(et.length/2);for(let _=0;_<et.length;_+=2){const tt=et.slice(_,_+2).toLowerCase();if(tt in HEX_TO_SHORT)$[_/2]=HEX_TO_SHORT[tt];else throw new Error(`Cannot decode unrecognized sequence ${tt} as hexadecimal`)}return $}function toHex(et){let $="";for(let _=0;_<et.byteLength;_++)$+=SHORT_TO_HEX[et[_]];return $}const distEs=Object.freeze(Object.defineProperty({__proto__:null,fromHex,toHex},Symbol.toStringTag,{value:"Module"})),require$$1=getAugmentedNamespace(distEs);var __awaiter$d=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$d=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultSigV4$1,"__esModule",{value:!0});const sha256_js_1=build$1,util_hex_encoding_1=require$$1,Versioning_1$2=__importDefault$d(Versioning$1);class DefaultSigV4{constructor($){this.chimeClient=$}makeTwoDigits($){return $>9?$.toString():"0"+$.toString()}hmac($,_){const tt=new sha256_js_1.Sha256(_);return tt.update($),tt.digest()}getDateTimeString(){const $=new Date;return $.getUTCFullYear()+this.makeTwoDigits($.getUTCMonth()+1)+this.makeTwoDigits($.getUTCDate())+"T"+this.makeTwoDigits($.getUTCHours())+this.makeTwoDigits($.getUTCMinutes())+this.makeTwoDigits($.getUTCSeconds())+"Z"}getDateString($){return $.substring(0,$.indexOf("T"))}getSignatureKey($,_,tt,nt){return __awaiter$d(this,void 0,void 0,function*(){const it=yield this.hmac(_,"AWS4"+$),rt=yield this.hmac(tt,it),ot=yield this.hmac(nt,rt);return yield this.hmac("aws4_request",ot)})}signURL($,_,tt,nt,it,rt,ot){return __awaiter$d(this,void 0,void 0,function*(){const lt=this.getDateTimeString(),st=this.getDateString(lt),at="AWS4-HMAC-SHA256";let ct="";this.chimeClient.config.region instanceof Function?ct=yield this.chimeClient.config.region():ct=this.chimeClient.config.region;const dt="host",ut="host:"+nt.toLowerCase()+`
`,ft=st+"/"+ct+"/"+tt+"/aws4_request";let pt;this.chimeClient.config.credentials instanceof Function?pt=yield this.chimeClient.config.credentials():pt=this.chimeClient.config.credentials;let St=new Map;St.set("X-Amz-Algorithm",[at]),St.set("X-Amz-Credential",[encodeURIComponent(pt.accessKeyId+"/"+ft)]),St.set("X-Amz-Date",[lt]),St.set("X-Amz-Expires",["10"]),St.set("X-Amz-SignedHeaders",["host"]),pt.sessionToken&&St.set("X-Amz-Security-Token",[encodeURIComponent(pt.sessionToken)]),St.set(Versioning_1$2.default.X_AMZN_VERSION,[encodeURIComponent(Versioning_1$2.default.sdkVersion)]),St.set(Versioning_1$2.default.X_AMZN_USER_AGENT,[encodeURIComponent(Versioning_1$2.default.sdkUserAgentLowResolution)]),ot==null||ot.forEach((At,Dt)=>{const It=encodeURIComponent(Dt);At.sort().forEach(Vt=>{St.has(It)||St.set(It,[]),St.get(It).push(encodeURIComponent(Vt))})});let gt="";St=new Map([...St.entries()].sort()),St.forEach((At,Dt)=>{At.forEach(It=>{gt.length&&(gt+="&"),gt+=Dt+"="+It})});const yt=$+`
`+it+`
`+gt+`
`+ut+`
`+dt+`
`+util_hex_encoding_1.toHex(yield this.hmac(rt)),vt=util_hex_encoding_1.toHex(yield this.hmac(yt)),Ct=`AWS4-HMAC-SHA256
`+lt+`
`+st+"/"+ct+"/"+tt+`/aws4_request
`+vt,Et=yield this.getSignatureKey(pt.secretAccessKey,st,ct,tt),Mt=util_hex_encoding_1.toHex(yield this.hmac(Ct,Et)),Rt=gt+"&X-Amz-Signature="+Mt;return _+"://"+nt+it+"?"+Rt})}}DefaultSigV4$1.default=DefaultSigV4;var PrefetchOn$1={};Object.defineProperty(PrefetchOn$1,"__esModule",{value:!0});var PrefetchOn;(function(et){et.Connect="connect"})(PrefetchOn||(PrefetchOn={}));PrefetchOn$1.default=PrefetchOn;var __awaiter$c=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$c=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(DefaultMessagingSession$1,"__esModule",{value:!0});const client_chime_sdk_messaging_1=require$$0,FullJitterBackoff_1$2=__importDefault$c(FullJitterBackoff$1),CSPMonitor_1=__importDefault$c(CSPMonitor$1),Message_1=__importDefault$c(Message$1),DefaultReconnectController_1=__importDefault$c(DefaultReconnectController$1),AsyncScheduler_1=__importDefault$c(AsyncScheduler$1),DefaultSigV4_1=__importDefault$c(DefaultSigV4$1),DefaultWebSocketAdapter_1=__importDefault$c(DefaultWebSocketAdapter$1),WebSocketReadyState_1=__importDefault$c(WebSocketReadyState),PrefetchOn_1=__importDefault$c(PrefetchOn$1);class DefaultMessagingSession{constructor($,_,tt,nt,it){this.configuration=$,this.logger=_,this.webSocket=tt,this.reconnectController=nt,this.sigV4=it,this.observerQueue=new Set,this.webSocket||(this.webSocket=new DefaultWebSocketAdapter_1.default(this.logger)),this.reconnectController||(this.reconnectController=new DefaultReconnectController_1.default($.reconnectTimeoutMs,new FullJitterBackoff_1$2.default($.reconnectFixedWaitMs,$.reconnectShortBackoffMs,$.reconnectLongBackoffMs))),this.sigV4||(this.sigV4=new DefaultSigV4_1.default(this.configuration.chimeClient)),CSPMonitor_1.default.addLogger(this.logger),CSPMonitor_1.default.register(),this.preBootstrapMessages=[]}addObserver($){this.logger.info("adding messaging observer"),this.observerQueue.add($)}removeObserver($){this.logger.info("removing messaging observer"),this.observerQueue.delete($)}start(){return __awaiter$c(this,void 0,void 0,function*(){this.isClosed()?yield this.startConnecting(!1):this.logger.info("messaging session already started")})}stop(){this.isClosed()?this.logger.info("no existing messaging session needs closing"):(this.isClosing=!0,this.webSocket.close(),CSPMonitor_1.default.removeLogger(this.logger))}forEachObserver($){for(const _ of this.observerQueue)AsyncScheduler_1.default.nextTick(()=>{this.observerQueue.has(_)&&$(_)})}setUpEventListeners(){this.webSocket.addEventListener("open",()=>{this.openEventHandler()}),this.webSocket.addEventListener("message",$=>{this.receiveMessageHandler($.data)}),this.webSocket.addEventListener("close",$=>{this.closeEventHandler($)}),this.webSocket.addEventListener("error",()=>{this.logger.error("WebSocket error")})}startConnecting($){return __awaiter$c(this,void 0,void 0,function*(){return yield this.startConnectingInternal($),yield new Promise((_,tt)=>{this.bootstrapResolved=_,this.bootstrapRejected=tt})})}startConnectingInternal($){var _;return __awaiter$c(this,void 0,void 0,function*(){let tt=this.configuration.endpointUrl;if($||this.reconnectController.reset(),this.reconnectController.hasStartedConnectionAttempt()?this.reconnectController.startedConnectionAttempt(!1):this.reconnectController.startedConnectionAttempt(!0),$||tt===void 0)try{if(this.configuration.chimeClient.getMessagingSessionEndpoint instanceof Function){const it=yield this.configuration.chimeClient.getMessagingSessionEndpoint();!((_=it.Endpoint)===null||_===void 0)&&_.Url?tt=it.Endpoint.Url:tt=(yield this.configuration.chimeClient.getMessagingSessionEndpoint().promise()).Endpoint.Url}else tt=(yield this.configuration.chimeClient.send(new client_chime_sdk_messaging_1.GetMessagingSessionEndpointCommand({}))).Endpoint.Url;this.logger.debug(`Messaging endpoint resolved to: ${tt}`)}catch(it){this.logger.error(`Messaging Session failed to resolve endpoint: ${it}`);const rt=new CloseEvent("close",{wasClean:!1,code:4999,reason:"Failed to get messaging session endpoint URL",bubbles:!1});this.closeEventHandler(rt);return}const nt=yield this.prepareWebSocketUrl(tt);this.logger.info(`opening connection to ${nt}`),$||this.reconnectController.reset(),this.reconnectController.hasStartedConnectionAttempt()?this.reconnectController.startedConnectionAttempt(!1):this.reconnectController.startedConnectionAttempt(!0),this.webSocket.create(nt,[],!0),this.forEachObserver(it=>{it.messagingSessionDidStartConnecting&&it.messagingSessionDidStartConnecting($)}),this.setUpEventListeners()})}prepareWebSocketUrl($){return __awaiter$c(this,void 0,void 0,function*(){const _=new Map;return _.set("userArn",[this.configuration.userArn]),_.set("sessionId",[this.configuration.messagingSessionId]),this.configuration.prefetchOn===PrefetchOn_1.default.Connect&&_.set("prefetch-on",[PrefetchOn_1.default.Connect]),this.configuration.prefetchSortBy&&_.set("prefetch-sort-by",[this.configuration.prefetchSortBy]),yield this.sigV4.signURL("GET","wss","chime",$,"/connect","",_)})}isClosed(){return this.webSocket.readyState()===WebSocketReadyState_1.default.None||this.webSocket.readyState()===WebSocketReadyState_1.default.Closed}openEventHandler(){this.reconnectController.reset(),this.isSessionEstablished=!1}receiveMessageHandler($){try{const _=JSON.parse($),tt=_.Headers["x-amz-chime-event-type"],nt=new Message_1.default(tt,_.Headers,_.Payload||null);if(!this.isSessionEstablished&&tt==="SESSION_ESTABLISHED"){this.forEachObserver(rt=>{rt.messagingSessionDidStart&&rt.messagingSessionDidStart()}),this.bootstrapResolved(),this.isSessionEstablished=!0;const it=this.preBootstrapMessages.length;for(let rt=0;rt<it;rt++){const ot=this.preBootstrapMessages.shift();this.forEachObserver(lt=>{this.sendMessageToObserver(lt,ot)})}}else if(!this.isSessionEstablished){this.preBootstrapMessages.push(nt);return}this.forEachObserver(it=>{this.sendMessageToObserver(it,nt)})}catch(_){this.logger.error(`Messaging parsing failed: ${_}`)}}sendMessageToObserver($,_){$.messagingSessionDidReceiveMessage&&$.messagingSessionDidReceiveMessage(_)}retryConnection(){return this.reconnectController.retryWithBackoff(()=>__awaiter$c(this,void 0,void 0,function*(){yield this.startConnecting(!0)}),null)}closeEventHandler($){this.logger.info(`WebSocket close: ${$.code} ${$.reason}`),$.code!==4999&&this.webSocket.destroy(),!(!this.isClosing&&this.canReconnect($.code)&&this.retryConnection())&&(this.isClosing=!1,this.isSessionEstablished?this.forEachObserver(_=>{_.messagingSessionDidStop&&_.messagingSessionDidStop($)}):this.bootstrapRejected($))}canReconnect($){return $===1001||$===1006||$>=1011&&$<=1014||$>4e3&&$!==4002&&$!==4003&&$!==4401}}DefaultMessagingSession$1.default=DefaultMessagingSession;var FullJitterBackoffFactory$1={},FullJitterLimitedBackoff$1={},__importDefault$b=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(FullJitterLimitedBackoff$1,"__esModule",{value:!0});const FullJitterBackoff_1$1=__importDefault$b(FullJitterBackoff$1);class FullJitterLimitedBackoff extends FullJitterBackoff_1$1.default{constructor($,_,tt,nt){super($,_,tt),this.limit=nt,this.attempts=0}nextBackoffAmountMs(){if(this.attempts++,this.attempts>this.limit)throw new Error("retry limit exceeded");return super.nextBackoffAmountMs()}}FullJitterLimitedBackoff$1.default=FullJitterLimitedBackoff;var __importDefault$a=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(FullJitterBackoffFactory$1,"__esModule",{value:!0});const FullJitterBackoff_1=__importDefault$a(FullJitterBackoff$1),FullJitterLimitedBackoff_1=__importDefault$a(FullJitterLimitedBackoff$1);class FullJitterBackoffFactory{constructor($,_,tt){this.fixedWaitMs=$,this.shortBackoffMs=_,this.longBackoffMs=tt}create(){return new FullJitterBackoff_1.default(this.fixedWaitMs,this.shortBackoffMs,this.longBackoffMs)}createWithLimit($){return new FullJitterLimitedBackoff_1.default(this.fixedWaitMs,this.shortBackoffMs,this.longBackoffMs,$)}}FullJitterBackoffFactory$1.default=FullJitterBackoffFactory;var Log$1={};Object.defineProperty(Log$1,"__esModule",{value:!0});class Log{constructor($,_,tt,nt){this.sequenceNumber=$,this.message=_,this.timestampMs=tt,this.logLevel=nt}}Log$1.default=Log;var MessagingSessionConfiguration$1={};Object.defineProperty(MessagingSessionConfiguration$1,"__esModule",{value:!0});const Utils_1$2=Utils;class MessagingSessionConfiguration{constructor($,_,tt,nt){this.userArn=$,this.messagingSessionId=_,this.endpointUrl=tt,this.chimeClient=nt,this.reconnectTimeoutMs=10*1e3,this.reconnectFixedWaitMs=0,this.reconnectShortBackoffMs=1*1e3,this.reconnectLongBackoffMs=5*1e3,this.prefetchOn=void 0,this.prefetchSortBy=void 0,this.messagingSessionId||(this.messagingSessionId=this.generateSessionId())}generateSessionId(){const $=new Uint32Array(1);return Utils_1$2.getRandomValues($),$[0].toString()}}MessagingSessionConfiguration$1.default=MessagingSessionConfiguration;var MultiLogger$1={},__importDefault$9=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(MultiLogger$1,"__esModule",{value:!0});const LogLevel_1$3=__importDefault$9(LogLevel);class MultiLogger{constructor(...$){this._loggers=$}info($){for(const _ of this._loggers)_.info($)}warn($){for(const _ of this._loggers)_.warn($)}error($){for(const _ of this._loggers)_.error($)}debug($){let _,tt;typeof $=="string"?tt=$:$?tt=()=>(_||(_=$()),_):tt=""+$;for(const nt of this._loggers)nt.debug(tt)}setLogLevel($){for(const _ of this._loggers)_.setLogLevel($)}getLogLevel(){for(const $ of this._loggers)return $.getLogLevel();return LogLevel_1$3.default.OFF}}MultiLogger$1.default=MultiLogger;var NoOpAudioVideoController={},NoOpDebugLogger$1={},NoOpLogger$1={},__importDefault$8=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(NoOpLogger$1,"__esModule",{value:!0});const LogLevel_1$2=__importDefault$8(LogLevel);class NoOpLogger{constructor($=LogLevel_1$2.default.OFF){this.level=$}info($){}warn($){}error($){}debug($){LogLevel_1$2.default.DEBUG<this.level||typeof $!="string"&&$()}setLogLevel($){this.level=$}getLogLevel(){return this.level}}NoOpLogger$1.default=NoOpLogger;var __importDefault$7=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(NoOpDebugLogger$1,"__esModule",{value:!0});const LogLevel_1$1=__importDefault$7(LogLevel),NoOpLogger_1$1=__importDefault$7(NoOpLogger$1);class NoOpDebugLogger extends NoOpLogger_1$1.default{constructor(){super(LogLevel_1$1.default.DEBUG)}}NoOpDebugLogger$1.default=NoOpDebugLogger;var NoOpMediaStreamBroker$1={};Object.defineProperty(NoOpMediaStreamBroker$1,"__esModule",{value:!0});class NoOpMediaStreamBroker{acquireAudioInputStream(){return Promise.reject()}acquireVideoInputStream(){return Promise.reject()}acquireDisplayInputStream($){return Promise.reject()}muteLocalAudioInputStream(){}unmuteLocalAudioInputStream(){}addMediaStreamBrokerObserver($){}removeMediaStreamBrokerObserver($){}}NoOpMediaStreamBroker$1.default=NoOpMediaStreamBroker;var hasRequiredNoOpAudioVideoController;function requireNoOpAudioVideoController(){if(hasRequiredNoOpAudioVideoController)return NoOpAudioVideoController;hasRequiredNoOpAudioVideoController=1;var et=commonjsGlobal&&commonjsGlobal.__importDefault||function(ft){return ft&&ft.__esModule?ft:{default:ft}};Object.defineProperty(NoOpAudioVideoController,"__esModule",{value:!0});const $=et(FullJitterBackoff$1),_=et(DefaultEventController$1),tt=et(NoOpDebugLogger$1),nt=et(NoOpMediaStreamBroker$1),it=et(MeetingSessionConfiguration$1),rt=et(MeetingSessionCredentials$1),ot=et(MeetingSessionStatus$1),lt=et(MeetingSessionStatusCode),st=et(MeetingSessionURLs$1),at=et(DefaultReconnectController$1),ct=et(DefaultWebSocketAdapter$1),dt=et(requireDefaultAudioVideoController());let ut=class extends dt.default{constructor(pt){const St=new it.default;St.meetingId="",St.externalMeetingId="",St.credentials=new rt.default,St.credentials.attendeeId="",St.credentials.joinToken="",St.urls=new st.default,St.urls.turnControlURL="",St.urls.audioHostURL="",St.urls.signalingURL="wss://localhost/";const gt=new tt.default;super(pt||St,gt,new ct.default(new tt.default),new nt.default,new at.default(0,new $.default(0,0,0)),new _.default(pt||St,gt))}setAudioProfile(pt){}start(){}stop(){}promoteToPrimaryMeeting(pt){return Promise.resolve(new ot.default(lt.default.OK))}demoteFromPrimaryMeeting(){}};return NoOpAudioVideoController.default=ut,NoOpAudioVideoController}var NoOpDeviceController$1={},__awaiter$b=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$6=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(NoOpDeviceController$1,"__esModule",{value:!0});NoOpDeviceController$1.NoOpDeviceControllerWithEventController=void 0;const NoOpMediaStreamBroker_1=__importDefault$6(NoOpMediaStreamBroker$1),VideoQualitySettings_1=__importDefault$6(VideoQualitySettings$1);class NoOpDeviceController extends NoOpMediaStreamBroker_1.default{constructor($){super(),this.destroyed=!1}destroy(){return __awaiter$b(this,void 0,void 0,function*(){this.destroyed=!0})}listAudioInputDevices(){return Promise.resolve([])}listVideoInputDevices(){return Promise.resolve([])}listAudioOutputDevices(){return Promise.resolve([])}startAudioInput($){return Promise.reject()}stopAudioInput(){return Promise.resolve()}startVideoInput($){return Promise.reject()}stopVideoInput(){return Promise.resolve()}chooseAudioOutput($){return Promise.reject()}addDeviceChangeObserver($){}removeDeviceChangeObserver($){}createAnalyserNodeForAudioInput(){return null}startVideoPreviewForVideoInput($){}stopVideoPreviewForVideoInput($){}setDeviceLabelTrigger($){}mixIntoAudioInput($){return null}chooseVideoInputQuality($,_,tt){}getVideoInputQualitySettings(){return VideoQualitySettings_1.default.VideoDisabled}}NoOpDeviceController$1.default=NoOpDeviceController;class NoOpDeviceControllerWithEventController extends NoOpDeviceController{constructor($){super(),this.eventController=$}}NoOpDeviceController$1.NoOpDeviceControllerWithEventController=NoOpDeviceControllerWithEventController;var NoOpEventReporter$1={};Object.defineProperty(NoOpEventReporter$1,"__esModule",{value:!0});class NoOpEventReporter{constructor(){}reportEvent($,_,tt){}start(){}stop(){}}NoOpEventReporter$1.default=NoOpEventReporter;var NoOpTask$1={};Object.defineProperty(NoOpTask$1,"__esModule",{value:!0});class NoOpTask{cancel(){}name(){return"NoOpTask"}run(){return Promise.resolve()}setParent($){}}NoOpTask$1.default=NoOpTask;var NoOpVideoElementFactory$1={};Object.defineProperty(NoOpVideoElementFactory$1,"__esModule",{value:!0});class NoOpVideoElementFactory{create(){const $={clientWidth:400,clientHeight:300,width:400,height:300,videoWidth:400,videoHeight:300,style:{transform:""},hasAttribute:()=>!1,removeAttribute:()=>{},setAttribute:()=>{},srcObject:!1,paused:!0,pause:()=>{$.paused=!0},play:()=>($.paused=!1,Promise.resolve())};return $}}NoOpVideoElementFactory$1.default=NoOpVideoElementFactory;var NoVideoUplinkBandwidthPolicy$1={},__importDefault$5=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(NoVideoUplinkBandwidthPolicy$1,"__esModule",{value:!0});const DefaultVideoCaptureAndEncodeParameter_1=__importDefault$5(DefaultVideoCaptureAndEncodeParameter$1);class NoVideoUplinkBandwidthPolicy{constructor(){}updateConnectionMetric($){}chooseMediaTrackConstraints(){return{}}chooseEncodingParameters(){return new Map}updateIndex($){}wantsResubscribe(){return!1}chooseCaptureAndEncodeParameters(){return new DefaultVideoCaptureAndEncodeParameter_1.default(0,0,0,0,!1)}maxBandwidthKbps(){return 0}setIdealMaxBandwidthKbps($){}setHasBandwidthPriority($){}setHighResolutionFeatureEnabled($){}wantsVideoDependencyDescriptorRtpHeaderExtension(){return!1}}NoVideoUplinkBandwidthPolicy$1.default=NoVideoUplinkBandwidthPolicy;var POSTLogger$1={},__awaiter$a=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$4=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(POSTLogger$1,"__esModule",{value:!0});const IntervalScheduler_1=__importDefault$4(IntervalScheduler$1),Log_1=__importDefault$4(Log$1),LogLevel_1=__importDefault$4(LogLevel);class POSTLogger{constructor($){this.logCapture=[],this.lock=!1,this.sequenceNumber=0;const{url:_,batchSize:tt=POSTLogger.BATCH_SIZE,intervalMs:nt=POSTLogger.INTERVAL_MS,logLevel:it=LogLevel_1.default.WARN,metadata:rt,headers:ot}=$;this.url=_,this.batchSize=tt,this.intervalMs=nt,this.logLevel=it,this.metadata=rt,this.headers=ot,this.start(),this.eventListener=()=>{this.stop()},this.addEventListener()}addEventListener(){!this.eventListener||!("window"in window)||!window.addEventListener||window.addEventListener("unload",this.eventListener)}removeEventListener(){!this.eventListener||!("window"in window)||!window.removeEventListener||window.removeEventListener("unload",this.eventListener)}debug($){LogLevel_1.default.DEBUG<this.logLevel||(typeof $=="string"?this.log(LogLevel_1.default.DEBUG,$):$?this.log(LogLevel_1.default.DEBUG,$()):this.log(LogLevel_1.default.DEBUG,""+$))}info($){this.log(LogLevel_1.default.INFO,$)}warn($){this.log(LogLevel_1.default.WARN,$)}error($){this.log(LogLevel_1.default.ERROR,$)}setLogLevel($){this.logLevel=$}getLogLevel(){return this.logLevel}getLogCaptureSize(){return this.logCapture.length}start(){this.addEventListener(),this.intervalScheduler=new IntervalScheduler_1.default(this.intervalMs),this.intervalScheduler.start(()=>__awaiter$a(this,void 0,void 0,function*(){if(this.lock===!0||this.getLogCaptureSize()===0)return;this.lock=!0;const $=this.logCapture.slice(0,this.batchSize),_=this.makeRequestBody($);try{(yield fetch(this.url,Object.assign({method:"POST",body:_},this.headers?{headers:this.headers}:{}))).status===200&&(this.logCapture=this.logCapture.slice($.length))}catch(tt){console.warn("[POSTLogger] "+tt.message)}finally{this.lock=!1}}))}stop(){var $;($=this.intervalScheduler)===null||$===void 0||$.stop(),this.intervalScheduler=void 0,this.removeEventListener();const _=this.makeRequestBody(this.logCapture);navigator.sendBeacon(this.url,_)}destroy(){return __awaiter$a(this,void 0,void 0,function*(){this.stop(),this.metadata=void 0,this.headers=void 0,this.logCapture=[],this.sequenceNumber=0,this.lock=!1,this.batchSize=0,this.intervalMs=0,this.url=void 0})}makeRequestBody($){return JSON.stringify(Object.assign(Object.assign({},this.metadata),{logs:$}))}log($,_){if($<this.logLevel)return;const tt=Date.now();this.logCapture.push(new Log_1.default(this.sequenceNumber,_,tt,LogLevel_1.default[$])),this.sequenceNumber+=1}}POSTLogger$1.default=POSTLogger;POSTLogger.BATCH_SIZE=85;POSTLogger.INTERVAL_MS=2e3;var PrefetchSortBy$1={};Object.defineProperty(PrefetchSortBy$1,"__esModule",{value:!0});var PrefetchSortBy;(function(et){et.Unread="unread",et.LastMessageTimestamp="last-message-timestamp"})(PrefetchSortBy||(PrefetchSortBy={}));PrefetchSortBy$1.default=PrefetchSortBy;var RealtimeAttendeePositionInFrame$1={};Object.defineProperty(RealtimeAttendeePositionInFrame$1,"__esModule",{value:!0});class RealtimeAttendeePositionInFrame{constructor(){this.attendeeIndex=null,this.attendeesInFrame=null}}RealtimeAttendeePositionInFrame$1.default=RealtimeAttendeePositionInFrame;var RunnableTask$1={},__importDefault$3=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(RunnableTask$1,"__esModule",{value:!0});const BaseTask_1=__importDefault$3(BaseTask$1);class RunnableTask extends BaseTask_1.default{constructor($,_,tt="RunnableTask"){super($),this.fn=_,this.taskName=tt}run(){return this.fn().then(()=>{})}}RunnableTask$1.default=RunnableTask;var SingleNodeAudioTransformDevice$1={},__awaiter$9=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(SingleNodeAudioTransformDevice$1,"__esModule",{value:!0});class SingleNodeAudioTransformDevice{constructor($){this.inner=$}mute($){return __awaiter$9(this,void 0,void 0,function*(){})}stop(){var $;return __awaiter$9(this,void 0,void 0,function*(){($=this.node)===null||$===void 0||$.disconnect()})}intrinsicDevice(){return __awaiter$9(this,void 0,void 0,function*(){return this.inner})}createAudioNode($){var _;return __awaiter$9(this,void 0,void 0,function*(){return(_=this.node)===null||_===void 0||_.disconnect(),this.node=yield this.createSingleAudioNode($),{start:this.node,end:this.node}})}}SingleNodeAudioTransformDevice$1.default=SingleNodeAudioTransformDevice;var TranscriptAlternative$1={};Object.defineProperty(TranscriptAlternative$1,"__esModule",{value:!0});class TranscriptAlternative{}TranscriptAlternative$1.default=TranscriptAlternative;var TranscriptEntity$1={};Object.defineProperty(TranscriptEntity$1,"__esModule",{value:!0});class TranscriptEntity{}TranscriptEntity$1.default=TranscriptEntity;var TranscriptItem$1={};Object.defineProperty(TranscriptItem$1,"__esModule",{value:!0});class TranscriptItem{}TranscriptItem$1.default=TranscriptItem;var TranscriptLanguageWithScore$1={};Object.defineProperty(TranscriptLanguageWithScore$1,"__esModule",{value:!0});class TranscriptLanguageWithScore{}TranscriptLanguageWithScore$1.default=TranscriptLanguageWithScore;var TranscriptResult$1={};Object.defineProperty(TranscriptResult$1,"__esModule",{value:!0});class TranscriptResult{}TranscriptResult$1.default=TranscriptResult;var VideoFxProcessor$1={},DeferredPromise$1={};Object.defineProperty(DeferredPromise$1,"__esModule",{value:!0});DeferredPromise$1.DeferredPromise=void 0;class DeferredPromise{constructor(){this.promise=new Promise(($,_)=>{this.resolve=$,this.reject=_})}getPromise(){return this.promise}resolvePromise($){this.resolve($)}resolveAndReplacePromise($){this.resolve($),this.promise=new Promise((_,tt)=>{this.resolve=_,this.reject=tt})}rejectPromise($){this.reject($)}rejectAndReplacePromise($){this.reject($),this.promise=new Promise((_,tt)=>{this.resolve=_,this.reject=tt})}}DeferredPromise$1.DeferredPromise=DeferredPromise;var VideoFxCanvasOpsManager$1={},VideoFxConstants={};(function(et){Object.defineProperty(et,"__esModule",{value:!0}),et.DEFAULT_VIDEO_FX_SPEC=et.FXLIB_PATH=et.WORKER_PATH=et.CDN_BASE_PATH=et.RESOURCE_CONSTRAINTS=et.SEGMENTATION_MODEL=et.DEFAULT_STREAM_PARAMETERS=et.WORKER_MSG=void 0,et.WORKER_MSG={BUILD_ENGINE_REQUEST:"BuildEngineRequest",BUILD_ENGINE_RESPONSE:"BuildEngineResponse",PERFORM_SEGMENTATION_REQUEST:"PerformSegmentationRequest",PERFORM_SEGMENTATION_RESPONSE:"PerformSegmentationResponse",PERFORM_SEGMENTATION_SAB_REQUEST:"PerformSegmentationSABRequest",PERFORM_SEGMENTATION_SAB_RESPONSE:"PerformSegmentationSABResponse",DESTROY_ASSETS_REQUEST:"DestroyAssetsRequest",DESTROY_ASSETS_RESPONSE:"DestroyAssetsResponse",CLOSE_WORKER_REQUEST:"CloseWorkerRequest"},et.DEFAULT_STREAM_PARAMETERS={FRAMES_PER_SECOND:15,WIDTH_IN_PIXEL:960,HEIGHT_IN_PIXEL:540,CHANNEL_COUNT:4},et.SEGMENTATION_MODEL={LOAD_SUCCESS:2,WIDTH_IN_PIXELS:176,HEIGHT_IN_PIXELS:160},et.RESOURCE_CONSTRAINTS={DEFAULT_PROCESSING_BUDGET_PER_FRAME:50,SEGMENTATION_DEFAULT_FRAMES_PER_SEGMENTATION:1,SEGMENTATION_SAMPLING_PERIOD_FRAME_COUNT:500,BLUR_DEFAULT_CYCLE_PERCENTAGE:10,BLUR_SAMPLING_PERIOD_FRAME_COUNT:1e3,MIN_PROCESSING_BUDGET:0,MAX_PROCESSING_BUDGET:100},et.CDN_BASE_PATH="https://static.sdkassets.chime.aws";const $="/ml_media_fx/otherassets";et.WORKER_PATH=`${$}/worker.js`,et.FXLIB_PATH=`${$}/fxlib.js`,et.DEFAULT_VIDEO_FX_SPEC={paths:{cdnBasePath:et.CDN_BASE_PATH,workerPath:et.WORKER_PATH,fxLibPath:et.FXLIB_PATH}}})(VideoFxConstants);var __awaiter$8=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(VideoFxCanvasOpsManager$1,"__esModule",{value:!0});VideoFxCanvasOpsManager$1.VideoFxCanvasOpsManager=void 0;const VideoFxConstants_1$2=VideoFxConstants;class VideoFxCanvasOpsManager{constructor($,_){this.streamParameters=$,this.outputCanvas=_,this.configureCanvasPipeline()}getInferenceInputData($){return this.inferenceCtx.save(),this.inferenceCtx.scale(this.horizontalResizeScalar,this.verticalResizeScalar),this.inferenceCtx.drawImage($,0,0),this.inferenceCtx.restore(),this.inferenceCtx.getImageData(0,0,VideoFxConstants_1$2.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,VideoFxConstants_1$2.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS)}configureForStreamParameters($){return __awaiter$8(this,void 0,void 0,function*(){if(this.streamParameters=$,this.outputCanvas.width=this.streamParameters.width,this.outputCanvas.height=this.streamParameters.height,this.backgroundReplacementCanvas){const _=document.createElement("canvas");_.width=this.streamParameters.width,_.height=this.streamParameters.height,_.getContext("2d").drawImage(this.backgroundReplacementCanvas,0,0,this.streamParameters.width,this.streamParameters.height),this.backgroundReplacementCanvas=_}this.configureCanvasPipeline()})}configureCanvasPipeline(){this.inferenceCanvas=document.createElement("canvas"),this.inferenceCtx=this.inferenceCanvas.getContext("2d",{willReadFrequently:!0}),this.inferenceCanvas.width=VideoFxConstants_1$2.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,this.inferenceCanvas.height=VideoFxConstants_1$2.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS,this.horizontalResizeScalar=VideoFxConstants_1$2.SEGMENTATION_MODEL.WIDTH_IN_PIXELS/this.streamParameters.width,this.verticalResizeScalar=VideoFxConstants_1$2.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS/this.streamParameters.height}getBackgroundReplacementCanvas(){return this.backgroundReplacementCanvas}loadReplacementBackground($){return __awaiter$8(this,void 0,void 0,function*(){const _=$.backgroundReplacement.backgroundImageURL,tt=$.backgroundReplacement.defaultColor;if(_)try{const nt=yield this.loadImage(_);this.backgroundReplacementImage=nt,this.resizeAndSetReplacementImage(this.backgroundReplacementImage)}catch(nt){throw this.logger.error(nt),new Error("Failed to set the replacement image.")}else this.resizeAndSetReplacementColor(tt)})}resizeAndSetReplacementImage($){const _=document.createElement("canvas"),tt=_.getContext("2d");_.width=this.streamParameters.width,_.height=this.streamParameters.height,tt.drawImage($,0,0,this.streamParameters.width,this.streamParameters.height),this.backgroundReplacementCanvas=_}resizeAndSetReplacementColor($){const _=document.createElement("canvas"),tt=_.getContext("2d");_.width=this.streamParameters.width,_.height=this.streamParameters.height,tt.fillStyle=$,tt.fillRect(0,0,this.streamParameters.width,this.streamParameters.height),this.backgroundReplacementCanvas=_}loadImage($){return __awaiter$8(this,void 0,void 0,function*(){const tt=yield(yield fetch($).catch(it=>{throw this.logger.error(it.toString()),new Error("Failed to fetch image.")})).blob(),nt=new Image;return nt.src=URL.createObjectURL(tt),new Promise((it,rt)=>{nt.onload=()=>{it(nt)},nt.onerror=ot=>{rt(ot)}})})}}VideoFxCanvasOpsManager$1.VideoFxCanvasOpsManager=VideoFxCanvasOpsManager;var VideoFxSegmentationRateManager$1={};Object.defineProperty(VideoFxSegmentationRateManager$1,"__esModule",{value:!0});VideoFxSegmentationRateManager$1.VideoFxSegmentationRateManager=void 0;const VideoFxConstants_1$1=VideoFxConstants;class VideoFxSegmentationRateManager{constructor($,_){this.logger=$,this.targetSegmentationCyclePercentage=_/100,this.frameCountOverSamplingPeriod=0,this.totalSegmentationDurationOverSamplingPeriod=0,this.samplingPeriodStartTime=performance.now(),this.framesPerSegmentation=VideoFxConstants_1$1.RESOURCE_CONSTRAINTS.SEGMENTATION_DEFAULT_FRAMES_PER_SEGMENTATION}submitFrame(){this.frameCountOverSamplingPeriod++}shouldApplySegmentation(){return this.frameCountOverSamplingPeriod%this.framesPerSegmentation===0}startSegmentation(){this.frameSegmentationStartTime=performance.now()}completeSegmentation(){this.totalSegmentationDurationOverSamplingPeriod+=performance.now()-this.frameSegmentationStartTime,this.frameCountOverSamplingPeriod>=VideoFxConstants_1$1.RESOURCE_CONSTRAINTS.SEGMENTATION_SAMPLING_PERIOD_FRAME_COUNT&&this.adjustFramesPerSegmentation(this.totalSegmentationDurationOverSamplingPeriod/(performance.now()-this.samplingPeriodStartTime))}adjustFramesPerSegmentation($){$>this.targetSegmentationCyclePercentage?(this.framesPerSegmentation++,this.logger.info(`Segmentation cycle percentage above the configured maximal value. Decreasing segmentation rate to 1 segmentation per ${this.framesPerSegmentation} frames`)):this.framesPerSegmentation>1&&$<this.targetSegmentationCyclePercentage&&(this.framesPerSegmentation--,this.logger.info(`Segmentation cycle percentage below the configured maximal value. Increasing segmentation rate to 1 segmentation per ${this.framesPerSegmentation} frames`)),this.totalSegmentationDurationOverSamplingPeriod=0,this.frameCountOverSamplingPeriod=0,this.samplingPeriodStartTime=performance.now()}}VideoFxSegmentationRateManager$1.VideoFxSegmentationRateManager=VideoFxSegmentationRateManager;var __awaiter$7=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$2=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(VideoFxProcessor$1,"__esModule",{value:!0});const fetch_1=fetch$1,loader_1=loader,support_1=support,DefaultBrowserBehavior_1$1=__importDefault$2(DefaultBrowserBehavior$1),NoOpLogger_1=__importDefault$2(NoOpLogger$1),Utils_1$1=Utils,Versioning_1$1=__importDefault$2(Versioning$1),CanvasVideoFrameBuffer_1=__importDefault$2(CanvasVideoFrameBuffer$1),DeferredPromise_1=DeferredPromise$1,VideoFxCanvasOpsManager_1=VideoFxCanvasOpsManager$1,VideoFxConstants_1=VideoFxConstants,VideoFxSegmentationRateManager_1=VideoFxSegmentationRateManager$1;class VideoFxProcessor{constructor($,_=VideoFxConstants_1.RESOURCE_CONSTRAINTS.DEFAULT_PROCESSING_BUDGET_PER_FRAME,tt){this.logger=$,this.outputCanvas=document.createElement("canvas"),this.canvasVideoFrameBuffer=new CanvasVideoFrameBuffer_1.default(this.outputCanvas),this.videoFxSpec=VideoFxConstants_1.DEFAULT_VIDEO_FX_SPEC;try{this.validateProcessingBudgetPerFrame(_)}catch(nt){throw this.logger.error(nt),new Error(`Cannot instantiate VideoFxProcessor due to invalid processingBudgetPerFrame of ${_}`)}tt&&(this.eventController=tt),this.effectConfig={backgroundBlur:{isEnabled:!1,strength:"low"},backgroundReplacement:{isEnabled:!1,backgroundImageURL:null,defaultColor:"black"}},this.segmentationRequestPromise=new DeferredPromise_1.DeferredPromise,this.segmentationRateManager=new VideoFxSegmentationRateManager_1.VideoFxSegmentationRateManager(this.logger,_),this.streamParameters={framerate:VideoFxConstants_1.DEFAULT_STREAM_PARAMETERS.FRAMES_PER_SECOND,width:VideoFxConstants_1.DEFAULT_STREAM_PARAMETERS.WIDTH_IN_PIXEL,height:VideoFxConstants_1.DEFAULT_STREAM_PARAMETERS.HEIGHT_IN_PIXEL,channels:VideoFxConstants_1.DEFAULT_STREAM_PARAMETERS.CHANNEL_COUNT},VideoFxProcessor.isSharedArrayBufferSupported&&(this.sharedImageBuffer=new SharedArrayBuffer(VideoFxConstants_1.SEGMENTATION_MODEL.WIDTH_IN_PIXELS*VideoFxConstants_1.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS*this.streamParameters.channels),this.sharedImageData=new Uint8ClampedArray(this.sharedImageBuffer)),this.logger.info(`VideoFx supports Shared Array Buffer: ${VideoFxProcessor.isSharedArrayBufferSupported}`),this.canvasOpsManager=new VideoFxCanvasOpsManager_1.VideoFxCanvasOpsManager(this.streamParameters,this.outputCanvas),this.outputCanvas.width=this.streamParameters.width,this.outputCanvas.height=this.streamParameters.height,this.segmentationMask=new ImageData(this.streamParameters.width,this.streamParameters.height),this.logger.info(`VideoFxProcessor instantiated with a processingBudgetPerFrame of ${_}`)}process($){return __awaiter$7(this,void 0,void 0,function*(){return $})}fxProcess($){return __awaiter$7(this,void 0,void 0,function*(){const _=$[0].asCanvasElement();this.didStreamParametersChange(_)&&(yield this.adjustProcessorForNewStreamParameters(_));try{yield this.manageSegmentationMask(_)}catch(tt){throw this.logger.error(tt),new Error("Video stream could not be processed")}return yield this.renderer.render(_,this.segmentationMask),$[0]=this.canvasVideoFrameBuffer,$})}noOpProcess($){return __awaiter$7(this,void 0,void 0,function*(){return $})}didStreamParametersChange($){return $.width!==this.streamParameters.width||$.height!==this.streamParameters.height}adjustProcessorForNewStreamParameters($){return __awaiter$7(this,void 0,void 0,function*(){this.streamParameters.width=$.width,this.streamParameters.height=$.height,yield this.canvasOpsManager.configureForStreamParameters(this.streamParameters),yield this.renderer.configure(this.streamParameters.width,this.streamParameters.height,this.effectConfig)})}destroy(){return __awaiter$7(this,void 0,void 0,function*(){this.canvasVideoFrameBuffer.destroy(),this.fxLibScript&&this.fxLibScript.parentNode&&this.fxLibScript.parentNode.removeChild(this.fxLibScript),this.engineWorker&&(this.destroyedAssetsPromise=new DeferredPromise_1.DeferredPromise,this.engineWorker.postMessage({msg:VideoFxConstants_1.WORKER_MSG.DESTROY_ASSETS_REQUEST}),yield this.destroyedAssetsPromise.getPromise(),this.engineWorker.postMessage({msg:VideoFxConstants_1.WORKER_MSG.CLOSE_WORKER_REQUEST})),this.logger.info("VideoFxProcessor destroyed.")})}manageSegmentationMask($){return __awaiter$7(this,void 0,void 0,function*(){try{if(this.segmentationRateManager.submitFrame(),this.segmentationRateManager.shouldApplySegmentation()){this.segmentationRateManager.startSegmentation();const _=this.canvasOpsManager.getInferenceInputData($);this.segmentationMask=yield this.generateSegmentationMask(_),this.segmentationRateManager.completeSegmentation()}}catch(_){throw this.logger.error(_.toString()),new Error("Can not properly manage the returned segmentation mask")}})}generateSegmentationMask($){return __awaiter$7(this,void 0,void 0,function*(){VideoFxProcessor.isSharedArrayBufferSupported?(this.sharedImageData.set($.data),this.engineWorker.postMessage({msg:VideoFxConstants_1.WORKER_MSG.PERFORM_SEGMENTATION_SAB_REQUEST,payload:this.sharedImageBuffer})):this.engineWorker.postMessage({msg:VideoFxConstants_1.WORKER_MSG.PERFORM_SEGMENTATION_REQUEST,payload:$},[$.data.buffer]);try{return yield this.segmentationRequestPromise.getPromise()}catch(_){throw this.logger.error(_.toString()),new Error("Segmentation mask could not be generated")}})}cloneConfigFrom($){return{backgroundBlur:{isEnabled:$.backgroundBlur.isEnabled,strength:$.backgroundBlur.strength},backgroundReplacement:{isEnabled:$.backgroundReplacement.isEnabled,backgroundImageURL:$.backgroundReplacement.backgroundImageURL,defaultColor:$.backgroundReplacement.defaultColor}}}setVideoFxSpec($){$.paths&&(this.videoFxSpec.paths=$.paths)}setEffectConfig($){return __awaiter$7(this,void 0,void 0,function*(){if(this.sameVideoFxConfig($,this.effectConfig))return;const _=this.cloneConfigFrom($);try{yield this.validateEffectConfig(_)}catch(tt){throw this.logger.error(tt.toString()),new Error("Provided effect config is invalid, not updating VideoFxProcessor")}_.backgroundReplacement.isEnabled&&(yield this.canvasOpsManager.loadReplacementBackground(_),yield this.renderer.setBackgroundReplacementCanvas(this.canvasOpsManager.getBackgroundReplacementCanvas())),yield this.renderer.configure(this.streamParameters.width,this.streamParameters.height,_),this.effectConfig=_,!this.effectConfig.backgroundBlur.isEnabled&&!this.effectConfig.backgroundReplacement.isEnabled?this.process=this.noOpProcess:this.process=this.fxProcess,this.logger.info(`VideoFxProcessor effect configuration updated to: ${JSON.stringify(this.effectConfig)}`),this.eventController&&this.publishVideoFxConfigEvent()})}validateEffectConfig($){return __awaiter$7(this,void 0,void 0,function*(){if($.backgroundBlur.isEnabled&&$.backgroundReplacement.isEnabled)throw new Error("Invalid VideoFx configuration: Background Blur and Background Replacement can not both be enabled");$.backgroundReplacement.isEnabled&&(yield this.validateReplacementConfig($))})}validateReplacementConfig($){return __awaiter$7(this,void 0,void 0,function*(){if($.backgroundReplacement.backgroundImageURL&&$.backgroundReplacement.defaultColor)throw new Error("Invalid VideoFx configuration: Background Replacement can not have both an image URL and default color");if(!$.backgroundReplacement.backgroundImageURL&&!$.backgroundReplacement.defaultColor)throw new Error("Invalid VideoFx configuration: Background Replacement image URL and default can not both be null/undefined");try{$.backgroundReplacement.backgroundImageURL&&(yield this.canvasOpsManager.loadImage($.backgroundReplacement.backgroundImageURL))}catch(tt){throw this.logger.error(tt.toString()),new Error("Invalid VideoFx configuration: backgroundImageURL failed to load")}const _=$.backgroundReplacement.defaultColor;if(_&&_!=="black"&&_!=="#000000"&&_!=="#000"){if(_.includes("#")&&!new RegExp(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/).test(_))throw new Error(`Invalid hexadecimal color code for default replacement background: ${_}`);const nt=document.createElement("canvas").getContext("2d"),it=nt.fillStyle;if(nt.fillStyle=_,nt.fillStyle===it)throw new Error(`Invalid color for default replacement background: ${_}`)}})}validateProcessingBudgetPerFrame($){if($<VideoFxConstants_1.RESOURCE_CONSTRAINTS.MIN_PROCESSING_BUDGET||$>VideoFxConstants_1.RESOURCE_CONSTRAINTS.MAX_PROCESSING_BUDGET)throw new Error(`Invalid resource constraint: cycle percentage must be within range of ${VideoFxConstants_1.RESOURCE_CONSTRAINTS.MIN_PROCESSING_BUDGET} and ${VideoFxConstants_1.RESOURCE_CONSTRAINTS.MAX_PROCESSING_BUDGET}`)}loadAssets(){return __awaiter$7(this,void 0,void 0,function*(){this.logger.info("Loading required assets for the VideoFxProcessor");try{const $=this.getVideoFxAssetParams();yield this.loadEngineWorker($),yield this.buildEngine($),yield this.loadFxLib($),this.renderer=constructRenderer(VideoFxConstants_1.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,VideoFxConstants_1.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS,this.effectConfig,this.outputCanvas)}catch($){throw this.logger.error($.toString()),new Error("Failed to load necessary assets for the VideoFxProcessor")}this.logger.info("Finished loading of essential VideoFxProcessor assets.")})}getVideoFxAssetParams(){const $=Utils_1$1.getDefaultAssetSpec();return{assetGroup:$.assetGroup,revisionID:$.revisionID,sdk:encodeURIComponent(Versioning_1$1.default.sdkVersion),ua:encodeURIComponent(Versioning_1$1.default.sdkUserAgentLowResolution)}}getPathFromVideoFxAssetParams($,_){const tt=new URL($);for(const[nt,it]of Object.entries(_))if(it!==void 0){const rt=encodeURIComponent(nt),ot=encodeURIComponent(it);tt.searchParams.set(rt,ot)}return tt.toString()}loadEngineWorker($){return __awaiter$7(this,void 0,void 0,function*(){try{const _=this.getPathFromVideoFxAssetParams(this.videoFxSpec.paths.cdnBasePath+this.videoFxSpec.paths.workerPath,$);this.engineWorker=yield loader_1.loadWorker(_,"VideoFxEngineWorker",{},null),this.logger.info("Successfully loaded the VideoFxProcessor's engine worker"),this.engineWorker.addEventListener("message",tt=>this.engineWorkerReceiver(tt))}catch(_){throw this.logger.error(_.toString()),new Error("Failed to load the VideoFxProcessor's engine worker")}})}buildEngine($){return __awaiter$7(this,void 0,void 0,function*(){this.buildEnginePromise=new DeferredPromise_1.DeferredPromise,this.engineWorker.postMessage({msg:VideoFxConstants_1.WORKER_MSG.BUILD_ENGINE_REQUEST,payload:{cdnBasePath:this.videoFxSpec.paths.cdnBasePath,sdkVersioningParams:$}});try{yield this.buildEnginePromise.getPromise()}catch(_){throw this.logger.error(_.toString()),new Error("Failed to instantiate the VideoFxEngine")}})}loadFxLib($){return __awaiter$7(this,void 0,void 0,function*(){const _=this.getPathFromVideoFxAssetParams(this.videoFxSpec.paths.cdnBasePath+this.videoFxSpec.paths.fxLibPath,$),tt={method:"GET",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"no-referrer"};try{const nt=yield fetch_1.fetchWithBehavior(_,tt,{});if(!nt.ok)throw new Error("Fetch failed.");const it=window.URL.createObjectURL(yield nt.blob());yield new Promise((rt,ot)=>{this.fxLibScript=document.createElement("script"),this.fxLibScript.setAttribute("src",it),this.fxLibScript.setAttribute("type","module"),this.fxLibScript.setAttribute("async","false"),this.fxLibScript.addEventListener("load",rt),this.fxLibScript.addEventListener("error",ot),document.body.appendChild(this.fxLibScript)})}catch(nt){throw this.logger.error(nt.toString()),new Error("Failed to load the fxlib")}})}getEffectConfig(){return this.cloneConfigFrom(this.effectConfig)}engineWorkerReceiver($){const _=$.data;switch(_.msg){case VideoFxConstants_1.WORKER_MSG.BUILD_ENGINE_RESPONSE:this.settleEngineBuildPromise(_.payload);break;case VideoFxConstants_1.WORKER_MSG.PERFORM_SEGMENTATION_RESPONSE:this.settleSegmentationPromise(_.payload.output);break;case VideoFxConstants_1.WORKER_MSG.PERFORM_SEGMENTATION_SAB_RESPONSE:this.settleSegmentationPromiseSAB();break;case VideoFxConstants_1.WORKER_MSG.DESTROY_ASSETS_RESPONSE:this.destroyedAssetsPromise.resolvePromise();break;default:this.logger.info(`VideoFx worker received unknown event msg: ${JSON.stringify(_)}`);break}}settleEngineBuildPromise($){$!==VideoFxConstants_1.SEGMENTATION_MODEL.LOAD_SUCCESS?this.buildEnginePromise.rejectPromise(new Error("Failed to build VideoFxProcessor's engine")):(this.logger.info("Successfully built the VideoFxEngine"),this.buildEnginePromise.resolvePromise())}settleSegmentationPromise($){$?this.segmentationRequestPromise.resolveAndReplacePromise($):this.segmentationRequestPromise.rejectAndReplacePromise(new Error("Failed to perform a segmentation on the input image"))}settleSegmentationPromiseSAB(){try{const $=new ImageData(new Uint8ClampedArray(this.sharedImageData),VideoFxConstants_1.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,VideoFxConstants_1.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS);this.segmentationRequestPromise.resolveAndReplacePromise($)}catch{this.segmentationRequestPromise.rejectAndReplacePromise(new Error("Failed to perform a segmentation with a shared array buffer on the input image"))}}setToNoOpProcess(){this.process=this.noOpProcess}static isSupported($=new NoOpLogger_1.default,_=!0){return __awaiter$7(this,void 0,void 0,function*(){let tt=!0;const nt=(ot,lt)=>{ot&&($.info(lt),tt=!1)};nt(typeof globalThis>"u","Browser does not have globalThis."),nt(!support_1.supportsWorker(globalThis,$),"Browser does not support web workers."),nt(!support_1.supportsWASM(globalThis,$),"Browser does not support wasm."),nt(!document.createElement("canvas").getContext("webgl2"),"Browser does not support webgl.");const it=new DefaultBrowserBehavior_1$1.default;nt(!it.isVideoFxSupportedBrowser(),"Browser is unsupported for VideoFxProcessor");const rt=()=>__awaiter$7(this,void 0,void 0,function*(){if(_)try{const ot=new VideoFxProcessor($);yield ot.loadAssets(),yield ot.destroy()}catch{return $.info("Browser environment is unable to access the required external assets."),Promise.resolve(!1)}return Promise.resolve(!0)});return Promise.resolve(tt?yield rt():!1)})}static create($,_,tt=VideoFxConstants_1.RESOURCE_CONSTRAINTS.DEFAULT_PROCESSING_BUDGET_PER_FRAME,nt){return __awaiter$7(this,void 0,void 0,function*(){const it=new VideoFxProcessor($,tt);nt&&it.setVideoFxSpec(nt);try{return yield it.loadAssets(),yield it.setEffectConfig(_),it}catch(rt){throw $.error(rt.toString()),it.setToNoOpProcess(),new Error("VideoFxProcessor built with support for only NoOp processing")}})}setEventController($){this.eventController?this.eventController=$:(this.eventController=$,this.publishVideoFxConfigEvent())}publishVideoFxConfigEvent(){const $={backgroundBlurEnabled:this.effectConfig.backgroundBlur.isEnabled.toString(),backgroundBlurStrength:this.effectConfig.backgroundBlur.strength,backgroundReplacementEnabled:this.effectConfig.backgroundReplacement.isEnabled.toString(),backgroundFilterVersion:2};this.eventController.publishEvent("backgroundFilterConfigSelected",$)}sameVideoFxConfig($,_){return $.backgroundBlur.isEnabled===_.backgroundBlur.isEnabled&&$.backgroundBlur.strength===_.backgroundBlur.strength&&$.backgroundReplacement.backgroundImageURL===_.backgroundReplacement.backgroundImageURL&&$.backgroundReplacement.defaultColor===_.backgroundReplacement.defaultColor&&$.backgroundReplacement.isEnabled===_.backgroundReplacement.isEnabled}}VideoFxProcessor$1.default=VideoFxProcessor;VideoFxProcessor.isSharedArrayBufferSupported=typeof SharedArrayBuffer<"u";var VoiceFocusDeviceTransformer$1={},voicefocus={},decider={},__awaiter$6=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(decider,"__esModule",{value:!0});decider.decideModel=decider.measureAndDecideExecutionApproach=void 0;const loader_js_1$1=loader,support_js_1$4=support,DEFAULT_EXECUTION_QUANTA=3,SIMD_SCORE_FIXED_POINT=2.5,WASM_SCORE_FIXED_POINT=2.63,SINGLE_INLINE_SCORE_MULTIPLIER=.6,QUALITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER=.65,INTERACTIVITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER=.5,WORKER_SCORE_MULTIPLIER=.7,PERFORMANCE_THRESHOLDS={wasm:{noSupport:.07,inline:{c100:1,c50:.36,c20:.16,c10:.07},worker:{c100:.5,c50:.18,c20:.08,c10:.06}},simd:{noSupport:.1,inline:{c100:1,c50:.43,c20:.3,c10:.2},worker:{c100:.5,c50:.21,c20:.15,c10:.1}}};class Estimator{constructor($,_){this.fetchConfig=$,this.logger=_;const tt=`${$.paths.workers}estimator-v1.js`;this.fetchBehavior={headers:$.headers,escapedQueryString:$.escapedQueryString},this.worker=(0,loader_js_1$1.loadWorker)(tt,"VoiceFocusEstimator",this.fetchBehavior,_)}roundtrip($,_,tt){return new Promise((nt,it)=>{this.worker.then(rt=>{let ot;ot=lt=>{const{message:st,key:at}=lt.data;st===_&&at===tt&&(rt.removeEventListener("message",ot),nt(lt.data))},rt.addEventListener("message",ot),rt.postMessage($)}).catch(rt=>{var ot;(ot=this.logger)===null||ot===void 0||ot.error("Failed to load worker.",rt),it(rt)})})}supportsSIMD($){const _="simd",tt=$||`${this.fetchConfig.paths.wasm}simd-v1.wasm`,nt={message:"supports-simd",fetchBehavior:this.fetchBehavior,path:tt,key:_};return this.roundtrip(nt,"simd-support",_).then(it=>it.supports)}measure($,_){const tt=`${this.fetchConfig.paths.wasm}bench-v1.wasm`,nt=`${this.fetchConfig.paths.wasm}bench-v1_simd.wasm`,it=$?nt:tt,rt=`bench:${$}`,ot={message:"measure",fetchBehavior:this.fetchBehavior,budget:_,path:it,key:rt};return this.roundtrip(ot,"measurement",rt).then(lt=>{if(lt.measurement)return lt.measurement;throw new Error("Failed to measure.")})}stop(){this.worker.then($=>{var _;(_=this.logger)===null||_===void 0||_.debug("Stopping estimator worker."),$.terminate()}).catch($=>{})}}const inlineScoreMultiplier=(et,$)=>et===1?SINGLE_INLINE_SCORE_MULTIPLIER:$==="quality"?QUALITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER*et:INTERACTIVITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER*et,decideExecutionApproach=({supportsSIMD:et,supportsSAB:$,duration:_,executionPreference:tt="auto",simdPreference:nt,variantPreference:it="auto",namePreference:rt="default",usagePreference:ot,executionQuantaPreference:lt=DEFAULT_EXECUTION_QUANTA},st=PERFORMANCE_THRESHOLDS,at)=>{const dt=nt==="force"||nt!=="disable"&&et,ut=_!==-1,ft=ut?(dt?SIMD_SCORE_FIXED_POINT:WASM_SCORE_FIXED_POINT)/_:0,pt=dt?st.simd:st.wasm,St=ut?inlineScoreMultiplier(lt,ot)*ft:0,gt=ut?WORKER_SCORE_MULTIPLIER*ft:0,yt=rt,vt=Rt=>({supported:!1,reason:Rt});if(ut){if(ft<pt.noSupport)return vt(`Performance score ${ft} worse than threshold ${pt.noSupport}.`)}else if(tt==="auto"||it==="auto")return vt(`Missing explicit execution (${tt}) or variant (${it}) preference, but no scoring performed.`);at==null||at.debug(`Bench duration ${_} yields inline score ${St} and worker score ${gt}.`);const Ct=(Rt,At,Dt)=>({supported:!0,useSIMD:dt,processor:Rt,executionApproach:At,variant:Dt,executionQuanta:At==="inline"?lt:void 0,name:yt}),Et=(Rt,At,Dt)=>At!=="auto"?!ut||Rt>Dt[At]?At:"failed":Rt>Dt.c100?"c100":Rt>Dt.c50?"c50":Rt>Dt.c20?"c20":Rt>Dt.c10?"c10":"failed",Mt=Rt=>{switch(Rt||"auto"){case"auto":{let At=Mt("inline"),Dt=Mt("worker");return at==null||at.debug(`Reducing auto preference: ${JSON.stringify(At)} vs ${JSON.stringify(Dt)}`),At.supported===!1||Dt.supported===!1?Dt:At.variant===Dt.variant||At.variant==="c50"?At:Dt}case"worker":return(0,support_js_1$4.supportsSharedArrayBuffer)(globalThis,window,at)?Mt("worker-sab"):Mt("worker-postMessage");case"inline":{const At=Et(St,it,pt.inline);return At==="failed"?vt(`Performance score ${St} not sufficient for inline use with variant preference ${it}.`):Ct("voicefocus-inline-processor","inline",At)}case"worker-sab":{if(!$){const Dt="Requested worker-sab but no SharedArrayBuffer support.";return at==null||at.warn(Dt),{supported:!1,reason:Dt}}const At=Et(gt,it,pt.worker);return At==="failed"?vt(`Performance score ${gt} not sufficient for worker use with variant preference ${it}.`):Ct("voicefocus-worker-sab-processor","worker-sab",At)}case"worker-postMessage":{const At=Et(gt,it,pt.worker);if(At==="failed")return vt(`Performance score ${gt} not sufficient for worker use.`);if(yt==="ns_es"){const Dt="Requested echo suppression but postMessage executor does not support it.";return at==null||at.warn(Dt),{supported:!1,reason:Dt}}return Ct("voicefocus-worker-postMessage-processor","worker-postMessage",At)}}};return Mt(tt)},featureCheck=(et,$,_,tt)=>__awaiter$6(void 0,void 0,void 0,function*(){const nt={supportsSIMD:et,supportsSAB:(0,support_js_1$4.supportsSharedArrayBuffer)(globalThis,window,_),duration:-1};if(et)return _==null||_.info("Supports SIMD: true (force)"),nt;const it=!tt,rt=tt||new Estimator($,_);try{const ot=!(0,support_js_1$4.isOldChrome)(window,_)&&(yield rt.supportsSIMD());return _==null||_.info(`Supports SIMD: ${ot} (force: ${et})`),nt.supportsSIMD=ot,nt}finally{it&&rt.stop()}}),estimateAndFeatureCheck=(et,$,_,tt)=>__awaiter$6(void 0,void 0,void 0,function*(){const nt=new Estimator($,tt);try{const it=yield featureCheck(et,$,tt,nt);if(it.supportsSIMD)try{return it.duration=yield nt.measure(!0,_),tt==null||tt.info("SIMD timing:",it.duration),it}catch{tt==null||tt.warn("Failed SIMD estimation; falling back to non-SIMD."),it.supportsSIMD=!1}return it.duration=yield nt.measure(!1,_),tt==null||tt.info("No-SIMD timing:",it.duration),it}catch(it){throw tt==null||tt.error("Could not feature check.",it),it}finally{nt.stop()}}),measureAndDecideExecutionApproach=(et,$,_,tt=PERFORMANCE_THRESHOLDS)=>__awaiter$6(void 0,void 0,void 0,function*(){let nt=et.executionPreference;const{usagePreference:it,variantPreference:rt,namePreference:ot,simdPreference:lt,estimatorBudget:st,executionQuantaPreference:at}=et;it==="interactivity"&&nt!=="inline"&&(_==null||_.debug(`Overriding execution preference ${nt} to reflect interactivity preference.`),nt="inline");const ct=lt==="force",dt=rt!=="auto",ut=nt!=="auto";let ft;try{dt&&ut?ft=yield featureCheck(ct,$,_):ft=yield estimateAndFeatureCheck(ct,$,st,_)}catch(pt){throw _==null||_.error("Could not load estimator.",pt),new Error("Could not load Voice Focus estimator.")}return decideExecutionApproach(Object.assign(Object.assign({},ft),{simdPreference:lt,executionPreference:nt,variantPreference:rt,namePreference:ot,usagePreference:it,executionQuantaPreference:at}),tt,_)});decider.measureAndDecideExecutionApproach=measureAndDecideExecutionApproach;const decideModel=({category:et,name:$,variant:_,simd:tt,url:nt})=>`${et}-${$}-${_}-v1${tt?"_simd":""}`;decider.decideModel=decideModel;var workletInlineNode={},types={};Object.defineProperty(types,"__esModule",{value:!0});types.VoiceFocusAudioWorkletNode=void 0;class VoiceFocusAudioWorkletNode extends(typeof globalThis<"u"&&globalThis.AudioWorkletNode||class{}){}types.VoiceFocusAudioWorkletNode=VoiceFocusAudioWorkletNode;var __awaiter$5=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(workletInlineNode,"__esModule",{value:!0});const support_js_1$3=support,types_js_1$2=types,CPU_WARNING_MAX_INTERVAL_MS=5*1e3,METRICS_MAX_INTERVAL_MS=5*1e3;class VoiceFocusInlineNode extends types_js_1$2.VoiceFocusAudioWorkletNode{constructor($,_){super($,_.processor,_),this.cpuWarningCount=0,this.metrics={latencyMillisAverage:0,snr:{average:0,averageActive:0,variance:0,varianceActive:0},drr:{average:0,variance:0,averageActive:0,varianceActive:0},vad:{average:0},cpu:{lateInvoke:0,longInvoke:0}},this.channelCountMode="explicit",this.channelCount=1;const{modelURL:tt,worker:nt,fetchBehavior:it,logger:rt,delegate:ot}=_;this.logger=rt,this.port.onmessage=this.onProcessorMessage.bind(this),this.delegate=ot,rt&&rt.debug("VoiceFocusInlineNode:",tt),this.worker=nt,this.worker.onmessage=this.onWorkerMessage.bind(this);const lt=(0,support_js_1$3.supportsWASMPostMessage)(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:lt,key:"model",fetchBehavior:it,path:tt})}onModuleBufferLoaded($,_){this.port.postMessage({message:"module-buffer",buffer:$,key:_})}onModuleLoaded($,_){this.port.postMessage({message:"module",module:$,key:_})}enable(){return __awaiter$5(this,void 0,void 0,function*(){this.port.postMessage({message:"enable"})})}disable(){return __awaiter$5(this,void 0,void 0,function*(){this.port.postMessage({message:"disable"})})}setMode($){return __awaiter$5(this,void 0,void 0,function*(){this.port.postMessage({message:"set-mode",mode:$})})}stop(){var $;return __awaiter$5(this,void 0,void 0,function*(){this.port.postMessage({message:"stop"});try{($=this.worker)===null||$===void 0||$.terminate()}catch(_){console.error("failed to terminate worker:",_)}this.disconnect()})}onProcessorMessage($){var _,tt,nt,it,rt,ot;const{data:lt}=$,{message:st}=lt;switch(st){case"cpu":const{reason:at,count:ct}=lt;at&&ct&&(this.metrics.cpu=Object.assign(Object.assign({},this.metrics.cpu),{[at]:ct+this.metrics.cpu[at]})),this.cpuWarningCount++;const dt=Date.now(),ut=this.cpuWarningLastTriggered||dt,ft=Math.abs(dt-ut);(!this.cpuWarningLastTriggered||ft>CPU_WARNING_MAX_INTERVAL_MS)&&((_=this.logger)===null||_===void 0||_.warn(`CPU warning (count: ${this.cpuWarningCount}):`,st),this.cpuWarningCount=0,this.cpuWarningLastTriggered=dt),(tt=this.delegate)===null||tt===void 0||tt.onCPUWarning();break;case"metrics":const{metrics:pt}=lt;if(!pt){(nt=this.logger)===null||nt===void 0||nt.warn("Got metrics message but no metrics payload");break}if(this.metrics=Object.assign(Object.assign({},this.metrics),pt),this.logger){const St=Date.now();St-((it=this.metricsLastRecorded)!==null&&it!==void 0?it:0)>METRICS_MAX_INTERVAL_MS&&((rt=this.logger)===null||rt===void 0||rt.debug("Contact metrics:",this.metrics),this.metricsLastRecorded=St)}break;default:(ot=this.logger)===null||ot===void 0||ot.debug("Ignoring processor message.")}}getModelMetrics(){return this.metrics}onWorkerMessage($){const _=$.data;switch(_.message){case"module-buffer":if(!_.buffer||!_.key)return;this.onModuleBufferLoaded(_.buffer,_.key);break;case"module":if(!_.module||!_.key)return;this.onModuleLoaded(_.module,_.key);break;case"stopped":this.worker&&this.worker.terminate();break;default:return}}}workletInlineNode.default=VoiceFocusInlineNode;var workletWorkerSabNode={},__awaiter$4=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(workletWorkerSabNode,"__esModule",{value:!0});const support_js_1$2=support,types_js_1$1=types,INDICES={ready:0,enabled:1},STATES={disabled:0,enabled:1,stopped:2};class VoiceFocusWorkerBufferNode extends types_js_1$1.VoiceFocusAudioWorkletNode{constructor($,_){super($,_.processor,_),this.channelCountMode="explicit",this.channelCount=1;const{modelURL:tt,resamplerURL:nt,worker:it,fetchBehavior:rt,delegate:ot}=_;this.delegate=ot,this.worker=it,this.worker.onmessage=this.onWorkerMessage.bind(this),this.port.onmessage=this.onProcessorMessage.bind(this);const{enabled:lt,supportFarendStream:st}=_.processorOptions;this.worker.postMessage({message:"init",approach:"sab",frames:$.sampleRate===16e3?160:480,enabled:lt,model:tt,supportFarendStream:st});const at=(0,support_js_1$2.supportsWASMPostMessage)(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:at,key:"resampler",fetchBehavior:rt,path:nt})}enable(){return __awaiter$4(this,void 0,void 0,function*(){this.state?(Atomics.store(this.state,INDICES.enabled,STATES.enabled),Atomics.notify(this.state,INDICES.ready,1)):this.worker.postMessage({message:"enable"})})}disable(){return __awaiter$4(this,void 0,void 0,function*(){this.state?(Atomics.store(this.state,INDICES.enabled,STATES.disabled),Atomics.notify(this.state,INDICES.ready,1)):this.worker.postMessage({message:"disable"})})}setMode($){return __awaiter$4(this,void 0,void 0,function*(){this.port.postMessage({message:"set-mode",mode:$})})}stop(){return __awaiter$4(this,void 0,void 0,function*(){if(this.state)Atomics.store(this.state,INDICES.enabled,STATES.stopped),Atomics.notify(this.state,INDICES.ready,1);else try{this.worker.postMessage({message:"stop"})}catch{}this.disconnect()})}getModelMetrics(){}onWorkerMessage($){var _;const tt=$.data;switch(tt.message){case"ready":if(!tt.shared)throw new Error("No shared state.");this.state=new Int32Array(tt.shared.state),this.port.postMessage(tt);break;case"stopped":this.worker.terminate();break;case"module-buffer":case"module":this.port.postMessage(tt);break;case"cpu":(_=this.delegate)===null||_===void 0||_.onCPUWarning();break;case"processing":this.port.postMessage(tt);break;default:return}}onProcessorMessage($){var _;const tt=$.data;switch(tt.message){case"cpu":(_=this.delegate)===null||_===void 0||_.onCPUWarning();break;case"prepare-for-frames":this.worker.postMessage(tt);break}}}workletWorkerSabNode.default=VoiceFocusWorkerBufferNode;var workletWorkerPostMessageNode={},__awaiter$3=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(workletWorkerPostMessageNode,"__esModule",{value:!0});const support_js_1$1=support,types_js_1=types;class VoiceFocusWorkerPostMessageNode extends types_js_1.VoiceFocusAudioWorkletNode{constructor($,_){super($,_.processor,_),this.channelCountMode="explicit",this.channelCount=1;const{modelURL:tt,audioBufferURL:nt,worker:it,fetchBehavior:rt,delegate:ot}=_;this.delegate=ot,this.worker=it,this.worker.onmessage=this.onWorkerMessage.bind(this),this.port.onmessage=this.onProcessorMessage.bind(this);const{enabled:lt,agc:st,supportFarendStream:at}=_.processorOptions;this.worker.postMessage({message:"init",approach:"postMessage",frames:$.sampleRate===16e3?160:480,enabled:lt,agc:st,fetchBehavior:rt,model:tt,supportFarendStream:at});const ct=(0,support_js_1$1.supportsWASMPostMessage)(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:ct,key:"buffer",fetchBehavior:rt,path:nt})}enable(){return __awaiter$3(this,void 0,void 0,function*(){this.worker.postMessage({message:"enable"})})}disable(){return __awaiter$3(this,void 0,void 0,function*(){this.worker.postMessage({message:"disable"})})}setMode($){return __awaiter$3(this,void 0,void 0,function*(){this.port.postMessage({message:"set-mode",mode:$})})}stop(){return __awaiter$3(this,void 0,void 0,function*(){try{this.worker.postMessage({message:"stop"})}catch{}this.disconnect()})}getModelMetrics(){}onWorkerMessage($){var _;const tt=$.data;switch(tt.message){case"ready":this.port.postMessage({message:"ready",shared:tt.shared},tt.shared?Object.values(tt.shared):[]);break;case"data":if(!tt.buffer)return;this.port.postMessage({message:"data",buffer:tt.buffer},[tt.buffer]);break;case"stopped":this.worker.terminate();break;case"module-buffer":case"module":this.port.postMessage(tt);break;case"cpu":(_=this.delegate)===null||_===void 0||_.onCPUWarning();break;case"processing":this.port.postMessage(tt);break;default:return}}onProcessorMessage($){var _;const tt=$.data;switch(tt.message){case"data":if(!tt.buffer)return;this.worker.postMessage({message:"data",buffer:tt.buffer},[tt.buffer]);break;case"cpu":(_=this.delegate)===null||_===void 0||_.onCPUWarning();break;case"prepare-for-frames":this.worker.postMessage(tt);break;default:return}}}workletWorkerPostMessageNode.default=VoiceFocusWorkerPostMessageNode;var __awaiter$2=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})};Object.defineProperty(voicefocus,"__esModule",{value:!0});voicefocus.getAudioInput=voicefocus.createAudioContext=voicefocus.VoiceFocus=void 0;const decider_js_1=decider,fetch_js_1=fetch$1,loader_js_1=loader,support_js_1=support,worklet_inline_node_js_1=workletInlineNode,worklet_worker_sab_node_js_1=workletWorkerSabNode,worklet_worker_postMessage_node_js_1=workletWorkerPostMessageNode,DEFAULT_AGC_DISABLED_SETTING={useVoiceFocusAGC:!1,useBuiltInAGC:!0},DEFAULT_AGC_SETTING=DEFAULT_AGC_DISABLED_SETTING,DEFAULT_ASSET_GROUP="stable-v1",DEFAULT_CDN="https://static.sdkassets.chime.aws",DEFAULT_PATHS={processors:`${DEFAULT_CDN}/processors/`,workers:`${DEFAULT_CDN}/workers/`,wasm:`${DEFAULT_CDN}/wasm/`,models:`${DEFAULT_CDN}/wasm/`},DEFAULT_CONTEXT_HINT={latencyHint:0},BASE_AUDIO_CONSTRAINTS={channelCount:1,echoCancellation:!0,googEchoCancellation:!0,noiseSuppression:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googTypingNoiseDetection:!1},DEFAULT_AUDIO_CONSTRAINTS_WITH_BUILTIN_AGC=Object.assign(Object.assign({},BASE_AUDIO_CONSTRAINTS),{autoGainControl:!0,googAutoGainControl:!0,googAutoGainControl2:!0}),DEFAULT_AUDIO_CONSTRAINTS_WITHOUT_BUILTIN_AGC=Object.assign(Object.assign({},BASE_AUDIO_CONSTRAINTS),{autoGainControl:!1,googAutoGainControl:!1,googAutoGainControl2:!1}),PROCESSORS={"voicefocus-worker-sab-processor":{file:"worklet-worker-sab-processor-v1.js",node:worklet_worker_sab_node_js_1.default},"voicefocus-worker-postMessage-processor":{file:"worklet-worker-postMessage-processor-v1.js",node:worklet_worker_postMessage_node_js_1.default},"voicefocus-inline-processor":{file:"worklet-inline-processor-v1.js",node:worklet_inline_node_js_1.default}},validateAssetSpec=(et,$)=>{if(et!==void 0&&!(0,fetch_js_1.isValidAssetGroup)(et))throw new Error(`Invalid asset group ${et}`);if($!==void 0&&!(0,fetch_js_1.isValidRevisionID)($))throw new Error(`Invalid revision ID ${$}`)},mungeConstraints=(et,$)=>{let _;if($.useBuiltInAGC?_=DEFAULT_AUDIO_CONSTRAINTS_WITH_BUILTIN_AGC:_=DEFAULT_AUDIO_CONSTRAINTS_WITHOUT_BUILTIN_AGC,!et)return{audio:_};if(!et.audio)return et;if(et.video)throw new Error("Not adding Voice Focus to multi-device getUserMedia call.");return Object.assign(Object.assign({},et),{audio:et.audio===!0?_:Object.assign(Object.assign({},et.audio),_)})},urlForModel=(et,$)=>`${$.models}${(0,decider_js_1.decideModel)(et)}.wasm`;class VoiceFocus{constructor($,_,tt,nt,it,rt){this.processorURL=_,this.nodeConstructor=tt,this.nodeOptions=nt,this.executionQuanta=it,this.logger=rt,this.internal={worker:$,isDestroyed:!1}}getModelMetrics(){var $;return($=this.internal.voiceFocusNode)===null||$===void 0?void 0:$.getModelMetrics()}enable(){var $;($=this.internal.voiceFocusNode)===null||$===void 0||$.enable()}disable(){var $;($=this.internal.voiceFocusNode)===null||$===void 0||$.disable()}setMode($){var _;(_=this.internal.voiceFocusNode)===null||_===void 0||_.setMode($)}destroy(){var $,_,tt,nt,it;return __awaiter$2(this,void 0,void 0,function*(){const{worker:rt,isDestroyed:ot,voiceFocusNode:lt,destinationNode:st,sourceNode:at,audioContext:ct}=this.internal;if(ot){($=this.logger)===null||$===void 0||$.debug("Voice Focus is already destroyed");return}try{rt==null||rt.terminate(),at==null||at.disconnect(),st==null||st.disconnect(),yield Promise.all([(_=ct==null?void 0:ct.close().catch(dt=>dt))!==null&&_!==void 0?_:yield Promise.resolve(),(tt=lt==null?void 0:lt.stop().catch(dt=>dt))!==null&&tt!==void 0?tt:yield Promise.resolve()]),this.internal.audioContext=void 0,this.internal.voiceFocusNode=void 0,this.internal.sourceNode=void 0,this.internal.destinationNode=void 0,(nt=this.logger)===null||nt===void 0||nt.debug("Voice Focus destroyed successfully")}catch(dt){throw(it=this.logger)===null||it===void 0||it.error("Error while destroying the Voice Focus instance: ",dt),dt}finally{this.internal.isDestroyed=!0}})}static isSupported($,_){const{fetchBehavior:tt,logger:nt}=_||{};if(typeof globalThis>"u")return nt==null||nt.debug("Browser does not have globalThis."),Promise.resolve(!1);if(!(0,support_js_1.supportsAudioWorklet)(globalThis,nt))return nt==null||nt.debug("Browser does not support Audio Worklet."),Promise.resolve(!1);if(!(0,support_js_1.supportsWASM)(globalThis,nt))return nt==null||nt.debug("Browser does not support WASM."),Promise.resolve(!1);(0,support_js_1.supportsWASMStreaming)(globalThis,nt)||nt==null||nt.debug("Browser does not support streaming WASM compilation.");const{assetGroup:it=DEFAULT_ASSET_GROUP,revisionID:rt,paths:ot=DEFAULT_PATHS}=$||{};validateAssetSpec(it,rt);const lt=rt?{revisionID:rt}:{assetGroup:it},st=(0,fetch_js_1.addQueryParams)(tt,lt),at=Object.assign(Object.assign({},st),{paths:ot});return(0,support_js_1.supportsVoiceFocusWorker)(globalThis,at,nt)}static mungeExecutionPreference($,_){const tt=$===void 0||$==="auto";if((0,support_js_1.isSafari)(globalThis)){if(tt||$==="inline")return"inline";if(!tt)throw new Error(`Unsupported execution preference ${$}`)}if($==="worker-sab"&&!(0,support_js_1.supportsSharedArrayBuffer)(globalThis,globalThis,_))throw new Error(`Unsupported execution preference ${$}`);return $||"auto"}static configure($,_){return __awaiter$2(this,void 0,void 0,function*(){const{fetchBehavior:tt,preResolve:nt,logger:it}=_||{},{category:rt="voicefocus",name:ot="default",variant:lt="auto",assetGroup:st=DEFAULT_ASSET_GROUP,revisionID:at,simd:ct="detect",mode:dt="ns",executionPreference:ut="auto",executionQuantaPreference:ft,usagePreference:pt="interactivity",estimatorBudget:St=100,paths:gt=DEFAULT_PATHS,thresholds:yt}=$||{};if(it==null||it.debug("Configuring Voice Focus with spec",$),rt!==void 0&&rt!=="voicefocus")throw new Error(`Unrecognized category ${rt}`);if(ot!==void 0&&ot!=="default"&&ot!=="ns_es")throw new Error(`Unrecognized feature name ${ot}`);if(lt!==void 0&&!["auto","c100","c50","c20","c10"].includes(lt))throw new Error(`Unrecognized feature variant ${lt}`);if(ft!==void 0&&![1,2,3].includes(ft))throw new Error(`Unrecognized execution quanta preference ${ft}`);if(validateAssetSpec(st,at),ct!==void 0&&!["detect","force","disable"].includes(ct))throw new Error(`Unrecognized SIMD option ${ct}`);if(ut!==void 0&&!["auto","inline","worker","worker-sab","worker-postMessage"].includes(ut))throw new Error(`Unrecognized execution preference ${ut}`);if(pt!==void 0&&!["quality","interactivity"].includes(pt))throw new Error(`Unrecognized usage preference ${pt}`);const vt={executionPreference:this.mungeExecutionPreference(ut,it),usagePreference:pt,executionQuantaPreference:ft,variantPreference:lt,namePreference:ot,simdPreference:ct,estimatorBudget:St},Ct=at?{revisionID:at}:{assetGroup:st},Et=(0,fetch_js_1.addQueryParams)(tt,Ct),Mt=Object.assign({paths:gt},Et),Rt=yield(0,decider_js_1.measureAndDecideExecutionApproach)(vt,Mt,it,yt);if(Rt.supported===!1)return{supported:!1,reason:Rt.reason};it==null||it.info("Decided execution approach",Rt);const{useSIMD:At,processor:Dt,variant:It,executionQuanta:Vt}=Rt,jt={category:rt||"voicefocus",name:ot||"default",mode:dt,variant:It,simd:At};if(nt){const qt=urlForModel(jt,gt);jt.url=yield(0,fetch_js_1.resolveURL)(qt,Et)}return{fetchConfig:Mt,model:jt,processor:Dt,executionQuanta:Vt,supported:!0}})}static init($,{delegate:_,preload:tt=!0,logger:nt}){return __awaiter$2(this,void 0,void 0,function*(){if($.supported===!1)throw new Error("Voice Focus not supported. Reason: "+$.reason);const{model:it,processor:rt,fetchConfig:ot,executionQuanta:lt}=$,{simd:st,name:at,mode:ct}=it,{paths:dt}=ot;if(rt!=="voicefocus-inline-processor"&&rt!=="voicefocus-worker-postMessage-processor"&&rt!=="voicefocus-worker-sab-processor")throw new Error(`Unknown processor ${rt}`);const ut=it.url||urlForModel(it,dt);nt==null||nt.debug(`Using model URL ${ut}.`);const ft=`${dt.wasm}audio_buffer-v1${st?"_simd":""}.wasm`,pt=`${dt.wasm}resampler-v1${st?"_simd":""}.wasm`,St=`${dt.workers}worker-v1.js`,{file:gt,node:yt}=PROCESSORS[rt],vt=`${dt.processors}${gt}`,Ct=yield(0,loader_js_1.loadWorker)(St,"VoiceFocusWorker",ot,nt);if(tt){nt==null||nt.debug("Preloading",ut);let At=(0,support_js_1.supportsWASMPostMessage)(globalThis)?"get-module":"get-module-buffer";Ct.postMessage({message:At,preload:!0,key:"model",fetchBehavior:ot,path:ut})}const Mt={processor:rt,worker:Ct,audioBufferURL:ft,resamplerURL:pt,fetchBehavior:ot,modelURL:ut,delegate:_,logger:nt,numberOfInputs:at==="ns_es"?2:1,mode:ct},Rt=new VoiceFocus(Ct,vt,yt,Mt,lt,nt);return Promise.resolve(Rt)})}createNode($,_){var tt;if(this.internal.isDestroyed)throw new Error("Unable to create node because VoiceFocus worker has been destroyed.");const{voiceFocusSampleRate:nt=$.sampleRate===16e3?16e3:48e3,enabled:it=!0,agc:rt=DEFAULT_AGC_SETTING}=_||{},ot=_==null?void 0:_.es,lt={voiceFocusSampleRate:nt,enabled:it,sendBufferCount:10,prefill:6,agc:rt,executionQuanta:this.executionQuanta,supportFarendStream:ot,mode:this.nodeOptions.mode},st=(0,fetch_js_1.withQueryString)(this.processorURL,(tt=this.nodeOptions)===null||tt===void 0?void 0:tt.fetchBehavior);return $.audioWorklet.addModule(st).then(()=>new this.nodeConstructor($,Object.assign(Object.assign({},this.nodeOptions),{processorOptions:lt})))}applyToStream($,_,tt){return __awaiter$2(this,void 0,void 0,function*(){if(this.internal.isDestroyed)throw new Error("Unable to apply stream because VoiceFocus worker has been destroyed");const nt=_.createMediaStreamSource($),it=yield this.applyToSourceNode(nt,_,tt),rt=_.createMediaStreamDestination();return it.connect(rt),this.internal=Object.assign(Object.assign({},this.internal),{voiceFocusNode:it,sourceNode:nt,destinationNode:rt,audioContext:_}),{node:it,source:nt,destination:rt,stream:rt.stream}})}applyToSourceNode($,_,tt){return __awaiter$2(this,void 0,void 0,function*(){const nt=yield this.createNode(_,tt);return $.connect(nt),nt})}}voicefocus.VoiceFocus=VoiceFocus;const createAudioContext=(et=DEFAULT_CONTEXT_HINT)=>new(window.AudioContext||window.webkitAudioContext)(et);voicefocus.createAudioContext=createAudioContext;const getAudioInput=(et,$,_)=>__awaiter$2(void 0,void 0,void 0,function*(){var tt,nt;const{constraints:it,spec:rt,delegate:ot,preload:lt=!0,options:st}=$,{logger:at}=_,ct=yield VoiceFocus.configure(rt,_);if(!ct.supported)return(tt=_.logger)===null||tt===void 0||tt.warn("Voice Focus not supported; returning standard stream."),window.navigator.mediaDevices.getUserMedia(it);const dt=yield VoiceFocus.init(ct,{delegate:ot,preload:lt,logger:at}),ut=((nt=$.options)===null||nt===void 0?void 0:nt.agc)||DEFAULT_AGC_SETTING,ft=yield window.navigator.mediaDevices.getUserMedia(mungeConstraints(it,ut));return dt.applyToStream(ft,et,st).then(pt=>pt.stream)});voicefocus.getAudioInput=getAudioInput;var LoggerAdapter$1={};Object.defineProperty(LoggerAdapter$1,"__esModule",{value:!0});function stringify(et){return et.map($=>typeof $=="object"?JSON.stringify($):`${$}`).join(" ")}class LoggerAdapter{constructor($){this.base=$}debug(...$){this.base.debug(stringify($))}info(...$){this.base.info(stringify($))}warn(...$){this.base.warn(stringify($))}error(...$){this.base.error(stringify($))}}LoggerAdapter$1.default=LoggerAdapter;var VoiceFocusTransformDevice$1={},__awaiter$1=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(VoiceFocusTransformDevice$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1=__importDefault$1(DefaultBrowserBehavior$1);class VoiceFocusTransformDevice{constructor($,_,tt,nt,it=!1,rt=void 0,ot=new DefaultBrowserBehavior_1.default,lt=new Map,st=void 0,at=void 0){this.device=$,this.voiceFocus=_,this.delegate=tt,this.nodeOptions=nt,this.failed=it,this.node=rt,this.browserBehavior=ot,this.farEndStreamToAudioSourceNode=lt,this.mixDestNode=st,this.mixSourceNode=at}getInnerDevice(){return this.device}mute($){return __awaiter$1(this,void 0,void 0,function*(){this.node&&($?yield this.node.disable():yield this.node.enable())})}stop(){return __awaiter$1(this,void 0,void 0,function*(){this.node&&(this.node.disconnect(),yield this.node.stop())})}chooseNewInnerDevice($){return __awaiter$1(this,void 0,void 0,function*(){return this.device===$&&!isDefaultDevice($)?this:new VoiceFocusTransformDevice($,this.voiceFocus,this.delegate,this.nodeOptions,this.failed,this.node,this.browserBehavior,this.farEndStreamToAudioSourceNode,this.mixDestNode,this.mixSourceNode)})}intrinsicDevice(){return __awaiter$1(this,void 0,void 0,function*(){if(this.failed)return this.device;const $=this.nodeOptions.es,_={echoCancellation:!$,googEchoCancellation:!$,googEchoCancellation2:!$,noiseSuppression:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googNoiseSuppression2:!1};let tt;return this.nodeOptions&&this.nodeOptions.agc!==void 0?tt=this.nodeOptions.agc.useBuiltInAGC:tt=!0,_.autoGainControl=tt,_.googAutoGainControl=tt,_.googAutoGainControl2=tt,this.device?typeof this.device=="string"?(this.browserBehavior.requiresNoExactMediaStreamConstraints()?_.deviceId=this.device:_.deviceId={exact:this.device},_):this.device.id?this.device:Object.assign(Object.assign({},this.device),_):_})}createAudioNode($){var _,tt;return __awaiter$1(this,void 0,void 0,function*(){if(((_=this.node)===null||_===void 0?void 0:_.context)===$)return{start:this.node,end:this.node};const it=Object.assign({enabled:!0,agc:{useVoiceFocusAGC:!1}},this.nodeOptions);try{if((tt=this.node)===null||tt===void 0||tt.disconnect(),this.node=yield this.voiceFocus.createNode($,it),this.nodeOptions.es){this.mixDestNode=new MediaStreamAudioDestinationNode($,{channelCount:1,channelCountMode:"explicit"});for(const lt of this.farEndStreamToAudioSourceNode.keys())this.assignFarEndStreamToAudioSourceNode(lt);this.createMixSourceNode()}const rt=this.node,ot=this.node;return{start:rt,end:ot}}catch(rt){throw this.failed=!0,this.delegate.onFallback(this,rt),rt}})}observeMeetingAudio($){return __awaiter$1(this,void 0,void 0,function*(){if(!this.nodeOptions.es)return;$.addAudioMixObserver(this);const _=yield $.getCurrentMeetingAudioStream();_&&this.addFarEndStream(_)})}unObserveMeetingAudio($){return __awaiter$1(this,void 0,void 0,function*(){if(!this.nodeOptions.es)return;$.removeAudioMixObserver(this);const _=yield $.getCurrentMeetingAudioStream();_&&this.removeFarendStream(_)})}addObserver($){this.delegate.addObserver($)}removeObserver($){this.delegate.removeObserver($)}addFarEndStream($){return __awaiter$1(this,void 0,void 0,function*(){!this.nodeOptions.es||!$||this.farEndStreamToAudioSourceNode.has($)||(this.node?this.assignFarEndStreamToAudioSourceNode($):this.farEndStreamToAudioSourceNode.set($,null))})}removeFarendStream($){var _;return __awaiter$1(this,void 0,void 0,function*(){(_=this.farEndStreamToAudioSourceNode.get($))===null||_===void 0||_.disconnect(),this.farEndStreamToAudioSourceNode.delete($)})}meetingAudioStreamBecameActive($){return __awaiter$1(this,void 0,void 0,function*(){this.addFarEndStream($)})}meetingAudioStreamBecameInactive($){return __awaiter$1(this,void 0,void 0,function*(){this.removeFarendStream($)})}assignFarEndStreamToAudioSourceNode($){const _=this.node.context.createMediaStreamSource($);_.channelCount=1,_.channelCountMode="explicit",this.farEndStreamToAudioSourceNode.set($,_),_.connect(this.mixDestNode,0)}createMixSourceNode(){this.mixSourceNode=this.node.context.createMediaStreamSource(this.mixDestNode.stream),this.mixSourceNode.channelCount=1,this.mixSourceNode.channelCountMode="explicit",this.mixSourceNode.connect(this.node,0,1)}}function isDefaultDevice(et){return et==="default"?!0:!et||typeof et!="object"?!1:"deviceId"in et&&et.deviceId==="default"||"id"in et&&et.id==="default"}VoiceFocusTransformDevice$1.default=VoiceFocusTransformDevice;var VoiceFocusTransformDeviceDelegate$1={};Object.defineProperty(VoiceFocusTransformDeviceDelegate$1,"__esModule",{value:!0});class VoiceFocusTransformDeviceDelegate{constructor(){this.observers=new Set}addObserver($){this.observers.add($)}removeObserver($){this.observers.delete($)}onFallback($,_){var tt;for(const nt of this.observers)(tt=nt.voiceFocusFellBackToInnerStream)===null||tt===void 0||tt.call(nt,$,_)}onCPUWarning(){var $;for(const _ of this.observers)($=_.voiceFocusInsufficientResources)===null||$===void 0||$.call(_)}}VoiceFocusTransformDeviceDelegate$1.default=VoiceFocusTransformDeviceDelegate;var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(et,$,_,tt){function nt(it){return it instanceof _?it:new _(function(rt){rt(it)})}return new(_||(_=Promise))(function(it,rt){function ot(at){try{st(tt.next(at))}catch(ct){rt(ct)}}function lt(at){try{st(tt.throw(at))}catch(ct){rt(ct)}}function st(at){at.done?it(at.value):nt(at.value).then(ot,lt)}st((tt=tt.apply(et,$||[])).next())})},__importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(VoiceFocusDeviceTransformer$1,"__esModule",{value:!0});VoiceFocusDeviceTransformer$1.VoiceFocusDeviceTransformer=void 0;const voicefocus_1=voicefocus,Utils_1=Utils,Versioning_1=__importDefault(Versioning$1),LoggerAdapter_1=__importDefault(LoggerAdapter$1),VoiceFocusTransformDevice_1=__importDefault(VoiceFocusTransformDevice$1),VoiceFocusTransformDeviceDelegate_1=__importDefault(VoiceFocusTransformDeviceDelegate$1);class VoiceFocusDeviceTransformer{constructor($,{preload:_=!0,logger:tt,fetchBehavior:nt=VoiceFocusDeviceTransformer.defaultFetchBehavior()},it){this.spec=$,this.supported=!0,this.logger=tt,this.vfLogger=tt?new LoggerAdapter_1.default(tt):void 0,this.preload=_,this.fetchBehavior=nt,this.spec=VoiceFocusDeviceTransformer.augmentSpec(this.spec),it&&(this.configuration=Promise.resolve(it))}static isSupported($,_){var tt,nt;const it=VoiceFocusDeviceTransformer.defaultFetchBehavior(),rt=_!=null&&_.logger?new LoggerAdapter_1.default(_.logger):void 0,ot={fetchBehavior:it,logger:rt};if(Utils_1.isIFramed()){if((_==null?void 0:_.allowIFrame)===!1)return(tt=_==null?void 0:_.logger)===null||tt===void 0||tt.error("Amazon Voice Focus support check inside iframe: not supported."),Promise.resolve(!1);(nt=_==null?void 0:_.logger)===null||nt===void 0||nt.warn("Amazon Voice Focus support check inside iframe: not recommended.")}return voicefocus_1.VoiceFocus.isSupported(VoiceFocusDeviceTransformer.augmentSpec($),ot)}static create($={},_={},tt,nt,it){var rt,ot,lt;return __awaiter(this,void 0,void 0,function*(){nt&&nt.Meeting.Meeting&&(nt=nt.Meeting);const st=((lt=(ot=(rt=nt==null?void 0:nt.Meeting)===null||rt===void 0?void 0:rt.MeetingFeatures)===null||ot===void 0?void 0:ot.Audio)===null||lt===void 0?void 0:lt.EchoReduction)==="AVAILABLE",at=tt&&tt.supported===!0&&tt.model.name==="ns_es"&&!st,ct=$.name==="ns_es"&&!st;if(at||ct)throw new Error("Echo Reduction requested but not enabled.");const dt=new VoiceFocusDeviceTransformer($,_,tt);return yield dt.init(),dt})}static configure($={},_={}){return __awaiter(this,void 0,void 0,function*(){return new VoiceFocusDeviceTransformer($,_,void 0).configure(!0)})}getConfiguration(){return this.configuration}isSupported(){return this.supported}createTransformDevice($,_){return __awaiter(this,void 0,void 0,function*(){if(this.supported)try{const[nt,it]=yield this.allocateVoiceFocus(!0),rt=Object.assign(Object.assign({},_),{es:this.spec.name==="ns_es"});return new VoiceFocusTransformDevice_1.default($,nt,it,rt)}catch{return}})}static destroyVoiceFocus($){var _;return __awaiter(this,void 0,void 0,function*(){(_=$==null?void 0:$.vf)===null||_===void 0||_.destroy()})}static augmentSpec($){return!$||!$.assetGroup&&!$.revisionID?Object.assign(Object.assign({},$),{assetGroup:VoiceFocusDeviceTransformer.currentSDKAssetGroup()}):$}configure($=!1){return __awaiter(this,void 0,void 0,function*(){const _={fetchBehavior:this.fetchBehavior,preResolve:$,logger:this.vfLogger};return voicefocus_1.VoiceFocus.configure(this.spec,_)})}init(){var $;return __awaiter(this,void 0,void 0,function*(){this.configuration||(this.configuration=this.configure());const _=yield this.configuration;if(!_.supported){this.supported=!1;return}this.pendingVoiceFocus=this.createVoiceFocus(_,this.preload);try{yield this.pendingVoiceFocus}catch(tt){($=this.logger)===null||$===void 0||$.error(`Unable to initialize Amazon Voice Focus: ${tt}`),this.supported=!1}})}createVoiceFocus($,_){return __awaiter(this,void 0,void 0,function*(){const tt=new VoiceFocusTransformDeviceDelegate_1.default;return this.vf=yield voicefocus_1.VoiceFocus.init($,{delegate:tt,preload:_,logger:this.vfLogger}),[this.vf,tt]})}allocateVoiceFocus($){return __awaiter(this,void 0,void 0,function*(){if(!this.supported)throw new Error("Not supported.");if(this.pendingVoiceFocus){const _=this.pendingVoiceFocus;return this.pendingVoiceFocus=void 0,_}return this.createVoiceFocus(yield this.configuration,$)})}static majorVersion(){return Versioning_1.default.sdkVersion.match(/^[1-9][0-9]*\.(?:0|[1-9][0-9]*)/)[0]}static majorMinorVersion(){return Versioning_1.default.sdkVersion.match(/^[1-9][0-9]*\.(?:0|(?:[1-9][0-9]*))\.(?:0|[1-9][0-9]*)/)[0]}static currentSDKAssetGroup(){const $=this.majorVersion();return $?`sdk-${$}`:"stable-v1"}static defaultFetchBehavior(){const $=VoiceFocusDeviceTransformer.majorMinorVersion()||"unknown",_=Versioning_1.default.sdkUserAgentLowResolution;return{escapedQueryString:`sdk=${encodeURIComponent($)}&ua=${encodeURIComponent(_)}`}}}VoiceFocusDeviceTransformer$1.VoiceFocusDeviceTransformer=VoiceFocusDeviceTransformer;VoiceFocusDeviceTransformer$1.default=VoiceFocusDeviceTransformer;var hasRequiredBuild;function requireBuild(){return hasRequiredBuild||(hasRequiredBuild=1,function(et){var $=commonjsGlobal&&commonjsGlobal.__importDefault||function(zn){return zn&&zn.__esModule?zn:{default:zn}};Object.defineProperty(et,"__esModule",{value:!0}),et.DefaultEventController=et.DefaultDevicePixelRatioMonitor=et.DefaultDeviceController=et.DefaultContentShareController=et.DefaultBrowserBehavior=et.DefaultAudioVideoFacade=et.DefaultAudioVideoController=et.DefaultAudioMixController=et.DefaultActiveSpeakerPolicy=et.DefaultActiveSpeakerDetector=et.DataMessage=et.CreateSDPTask=et.CreatePeerConnectionTask=et.ContentShareMediaStreamBroker=et.ContentShareConstants=et.ConsoleLogger=et.ConnectionHealthPolicyConfiguration=et.ConnectionHealthData=et.ClientVideoStreamReceivingReport=et.ClientMetricReportMediaType=et.ClientMetricReportDirection=et.ClientMetricReport=et.CleanStoppedSessionTask=et.CleanRestartedSessionTask=et.CheckVideoInputFeedback=et.CheckVideoConnectivityFeedback=et.CheckNetworkUDPConnectivityFeedback=et.CheckNetworkTCPConnectivityFeedback=et.CheckContentShareConnectivityFeedback=et.CheckCameraResolutionFeedback=et.CheckAudioOutputFeedback=et.CheckAudioInputFeedback=et.CheckAudioConnectivityFeedback=et.CanvasVideoFrameBuffer=et.CSPMonitor=et.BitrateParameters=et.BaseTask=et.BaseConnectionHealthPolicy=et.BackgroundReplacementVideoFrameProcessor=et.BackgroundFilterVideoFrameProcessor=et.BackgroundBlurVideoFrameProcessor=et.BackgroundBlurStrength=et.AudioVideoControllerState=et.AudioProfile=et.AudioLogEvent=et.Attendee=et.AttachMediaInputTask=et.AsyncScheduler=et.ApplicationMetadata=et.AllHighestVideoBandwidthPolicy=void 0,et.MeetingFeatures=et.MeetingEventsClientConfiguration=et.MediaDeviceProxyHandler=et.Maybe=et.LogLevel=et.Log=et.ListenForVolumeIndicatorsTask=et.LeaveAndReceiveLeaveAckTask=et.JoinAndReceiveIndexTask=et.IntervalScheduler=et.InMemoryJSONEventBuffer=et.GlobalMetricReport=et.GetUserMediaError=et.FullJitterLimitedBackoff=et.FullJitterBackoffFactory=et.FullJitterBackoff=et.FinishGatheringICECandidatesTask=et.EventIngestionConfiguration=et.EventBufferConfiguration=et.DeviceSelection=et.DevicePixelRatioWindowSource=et.DefaultWebSocketAdapter=et.DefaultVolumeIndicatorAdapter=et.DefaultVideoTransformDevice=et.DefaultVideoTileFactory=et.DefaultVideoTileController=et.DefaultVideoTile=et.DefaultVideoStreamIndex=et.DefaultVideoStreamIdSet=et.DefaultVideoFrameProcessorTimer=et.DefaultVideoFrameProcessorPipeline=et.DefaultVideoElementResolutionMonitor=et.DefaultVideoCaptureAndEncodeParameter=et.DefaultUserAgentParser=et.DefaultTranscriptionController=et.DefaultTransceiverController=et.DefaultSimulcastUplinkPolicyForContentShare=et.DefaultSimulcastUplinkPolicy=et.DefaultSignalingClient=et.DefaultSigV4=et.DefaultSessionStateController=et.DefaultReconnectController=et.DefaultRealtimeController=et.DefaultPingPong=et.DefaultModality=et.DefaultMessagingSession=et.DefaultMeetingSession=et.DefaultMeetingReadinessChecker=et.DefaultMeetingEventReporter=et.DefaultMediaDeviceFactory=void 0,et.RedundantAudioEncoder=et.ReconnectionHealthPolicy=et.ReceiveVideoStreamIndexTask=et.ReceiveVideoInputTask=et.ReceiveRemoteVideoPauseResumeTask=et.ReceiveAudioInputTask=et.RealtimeVolumeIndicator=et.RealtimeState=et.RealtimeAttendeePositionInFrame=et.PromoteToPrimaryMeetingTask=et.PromiseQueue=et.PrefetchSortBy=et.PrefetchOn=et.PermissionDeniedError=et.ParallelGroupTask=et.POSTLogger=et.OverconstrainedError=et.OpenSignalingConnectionTask=et.OnceTask=et.NotReadableError=et.NotFoundError=et.None=et.NoVideoUplinkBandwidthPolicy=et.NoVideoDownlinkBandwidthPolicy=et.NoOpVideoFrameProcessor=et.NoOpVideoElementFactory=et.NoOpTask=et.NoOpMediaStreamBroker=et.NoOpLogger=et.NoOpEventReporter=et.NoOpDeviceController=et.NoOpDebugLogger=et.NoOpAudioVideoController=et.NScaleVideoUplinkBandwidthPolicy=et.MutableVideoPreferences=et.MultiLogger=et.MonitorTask=et.ModelSpecBuilder=et.MessagingSessionConfiguration=et.Message=et.MeetingSessionVideoAvailability=et.MeetingSessionURLs=et.MeetingSessionTURNCredentials=et.MeetingSessionStatusCode=et.MeetingSessionStatus=et.MeetingSessionLifecycleEventCondition=et.MeetingSessionLifecycleEvent=et.MeetingSessionCredentials=et.MeetingSessionConfiguration=et.MeetingReadinessCheckerConfiguration=void 0,et.VideoEncodingConcurrentSendersHealthPolicy=et.VideoCodecCapability=et.VideoAdaptiveProbePolicy=et.Versioning=et.UnusableAudioWarningConnectionHealthPolicy=et.TypeError=et.TranscriptionStatusType=et.TranscriptionStatus=et.TranscriptResult=et.TranscriptLanguageWithScore=et.TranscriptItemType=et.TranscriptItem=et.TranscriptEntity=et.TranscriptAlternative=et.Transcript=et.TimeoutTask=et.TimeoutScheduler=et.TaskStatus=et.TargetDisplaySize=et.SubscribeAndReceiveSubscribeAckTask=et.StreamMetricReport=et.Some=et.SingleNodeAudioTransformDevice=et.SimulcastVideoStreamIndex=et.SimulcastTransceiverController=et.SimulcastLayers=et.SimulcastContentShareTransceiverController=et.SignalingClientVideoSubscriptionConfiguration=et.SignalingClientSubscribe=et.SignalingClientJoin=et.SignalingClientEventType=et.SignalingClientEvent=et.SignalingClientConnectionRequest=et.SignalingAndMetricsConnectionMonitor=et.SetRemoteDescriptionTask=et.SetLocalDescriptionTask=et.SessionStateControllerTransitionResult=et.SessionStateControllerState=et.SessionStateControllerDeferPriority=et.SessionStateControllerAction=et.ServerSideNetworkAdaption=et.SerialGroupTask=et.SendingAudioFailureConnectionHealthPolicy=et.SendAndReceiveDataMessagesTask=et.SDPMediaSection=et.SDPCandidateType=et.SDP=et.RunnableTask=et.RedundantAudioRecoveryMetricReport=et.RedundantAudioEncoderWorkerCode=void 0,et.isVideoTransformDevice=et.isDestroyable=et.isAudioTransformDevice=et.ZLIBTextCompressor=et.WebSocketReadyState=et.WaitForAttendeePresenceTask=et.VoiceFocusTransformDevice=et.VoiceFocusDeviceTransformer=et.VideoTileState=et.VideoStreamDescription=et.VideoSource=et.VideoQualitySettings=et.VideoQualityAdaptationPreference=et.VideoPriorityBasedPolicyConfig=et.VideoPriorityBasedPolicy=et.VideoPreferences=et.VideoPreference=et.VideoOnlyTransceiverController=et.VideoLogEvent=et.VideoFxProcessor=et.VideoEncodingFramerateConnectionHealthPolicy=et.VideoEncodingCpuConnectionHealthPolicy=et.VideoEncodingConnectionHealthPolicyName=void 0;const _=$(AllHighestVideoBandwidthPolicy$1);et.AllHighestVideoBandwidthPolicy=_.default;const tt=$(ApplicationMetadata$1);et.ApplicationMetadata=tt.default;const nt=$(AsyncScheduler$1);et.AsyncScheduler=nt.default;const it=$(AttachMediaInputTask$1);et.AttachMediaInputTask=it.default;const rt=$(Attendee$1);et.Attendee=rt.default;const ot=$(AudioLogEvent);et.AudioLogEvent=ot.default;const lt=$(AudioProfile$1);et.AudioProfile=lt.default;const st=$(AudioVideoControllerState);et.AudioVideoControllerState=st.default;const at=$(BackgroundBlurStrength);et.BackgroundBlurStrength=at.default;const ct=$(BackgroundBlurVideoFrameProcessor$1);et.BackgroundBlurVideoFrameProcessor=ct.default;const dt=$(BackgroundFilterVideoFrameProcessor$1);et.BackgroundFilterVideoFrameProcessor=dt.default;const ut=$(BackgroundReplacementVideoFrameProcessor$1);et.BackgroundReplacementVideoFrameProcessor=ut.default;const ft=$(BaseConnectionHealthPolicy$1);et.BaseConnectionHealthPolicy=ft.default;const pt=$(BaseTask$1);et.BaseTask=pt.default;const St=$(BitrateParameters$1);et.BitrateParameters=St.default;const gt=$(CSPMonitor$1);et.CSPMonitor=gt.default;const yt=$(CanvasVideoFrameBuffer$1);et.CanvasVideoFrameBuffer=yt.default;const vt=$(CheckAudioConnectivityFeedback);et.CheckAudioConnectivityFeedback=vt.default;const Ct=$(CheckAudioInputFeedback);et.CheckAudioInputFeedback=Ct.default;const Et=$(CheckAudioOutputFeedback);et.CheckAudioOutputFeedback=Et.default;const Mt=$(CheckCameraResolutionFeedback);et.CheckCameraResolutionFeedback=Mt.default;const Rt=$(CheckContentShareConnectivityFeedback);et.CheckContentShareConnectivityFeedback=Rt.default;const At=$(CheckNetworkTCPConnectivityFeedback);et.CheckNetworkTCPConnectivityFeedback=At.default;const Dt=$(CheckNetworkUDPConnectivityFeedback);et.CheckNetworkUDPConnectivityFeedback=Dt.default;const It=$(CheckVideoConnectivityFeedback);et.CheckVideoConnectivityFeedback=It.default;const Vt=$(CheckVideoInputFeedback);et.CheckVideoInputFeedback=Vt.default;const jt=$(CleanRestartedSessionTask$1);et.CleanRestartedSessionTask=jt.default;const qt=$(CleanStoppedSessionTask$1);et.CleanStoppedSessionTask=qt.default;const cn=$(ClientMetricReport$1);et.ClientMetricReport=cn.default;const dn=$(ClientMetricReportDirection);et.ClientMetricReportDirection=dn.default;const an=$(ClientMetricReportMediaType);et.ClientMetricReportMediaType=an.default;const bn=$(ClientVideoStreamReceivingReport$1);et.ClientVideoStreamReceivingReport=bn.default;const Ut=$(ConnectionHealthData$1);et.ConnectionHealthData=Ut.default;const Kt=$(ConnectionHealthPolicyConfiguration$1);et.ConnectionHealthPolicyConfiguration=Kt.default;const Gt=$(ConsoleLogger$1);et.ConsoleLogger=Gt.default;const Wt=$(ContentShareConstants$1);et.ContentShareConstants=Wt.default;const Jt=$(ContentShareMediaStreamBroker$1);et.ContentShareMediaStreamBroker=Jt.default;const _n=$(CreatePeerConnectionTask$1);et.CreatePeerConnectionTask=_n.default;const mn=$(CreateSDPTask$1);et.CreateSDPTask=mn.default;const hn=$(DataMessage$1);et.DataMessage=hn.default;const gn=$(DefaultActiveSpeakerDetector$1);et.DefaultActiveSpeakerDetector=gn.default;const yn=$(DefaultActiveSpeakerPolicy$1);et.DefaultActiveSpeakerPolicy=yn.default;const En=$(DefaultAudioMixController$1);et.DefaultAudioMixController=En.default;const Mn=$(requireDefaultAudioVideoController());et.DefaultAudioVideoController=Mn.default;const Rn=$(DefaultAudioVideoFacade$1);et.DefaultAudioVideoFacade=Rn.default;const Pn=$(DefaultBrowserBehavior$1);et.DefaultBrowserBehavior=Pn.default;const Sn=$(DefaultContentShareController$1);et.DefaultContentShareController=Sn.default;const Dn=$(DefaultDeviceController$1);et.DefaultDeviceController=Dn.default;const An=$(DefaultDevicePixelRatioMonitor$1);et.DefaultDevicePixelRatioMonitor=An.default;const In=$(DefaultEventController$1);et.DefaultEventController=In.default;const Cn=$(DefaultMediaDeviceFactory$1);et.DefaultMediaDeviceFactory=Cn.default;const Fn=$(DefaultMeetingEventReporter$1);et.DefaultMeetingEventReporter=Fn.default;const wt=$(DefaultMeetingReadinessChecker$1);et.DefaultMeetingReadinessChecker=wt.default;const mt=$(requireDefaultMeetingSession());et.DefaultMeetingSession=mt.default;const ht=$(DefaultMessagingSession$1);et.DefaultMessagingSession=ht.default;const bt=$(DefaultModality$1);et.DefaultModality=bt.default;const kt=$(DefaultPingPong$1);et.DefaultPingPong=kt.default;const Ot=$(DefaultRealtimeController$1);et.DefaultRealtimeController=Ot.default;const Nt=$(DefaultReconnectController$1);et.DefaultReconnectController=Nt.default;const en=$(DefaultSessionStateController$1);et.DefaultSessionStateController=en.default;const rn=$(DefaultSigV4$1);et.DefaultSigV4=rn.default;const ln=$(DefaultSignalingClient$1);et.DefaultSignalingClient=ln.default;const Zt=$(DefaultSimulcastUplinkPolicy$1);et.DefaultSimulcastUplinkPolicy=Zt.default;const on=$(DefaultSimulcastUplinkPolicyForContentShare$1);et.DefaultSimulcastUplinkPolicyForContentShare=on.default;const kn=$(DefaultTransceiverController$1);et.DefaultTransceiverController=kn.default;const Yt=$(DefaultTranscriptionController);et.DefaultTranscriptionController=Yt.default;const tn=$(DefaultUserAgentParser$1);et.DefaultUserAgentParser=tn.default;const Qt=$(DefaultVideoCaptureAndEncodeParameter$1);et.DefaultVideoCaptureAndEncodeParameter=Qt.default;const $t=$(DefaultVideoElementResolutionMonitor$1);et.DefaultVideoElementResolutionMonitor=$t.default;const Bt=$(DefaultVideoFrameProcessorPipeline$1);et.DefaultVideoFrameProcessorPipeline=Bt.default;const sn=$(DefaultVideoFrameProcessorTimer$1);et.DefaultVideoFrameProcessorTimer=sn.default;const Ft=$(DefaultVideoStreamIdSet$1);et.DefaultVideoStreamIdSet=Ft.default;const Tt=$(DefaultVideoStreamIndex$1);et.DefaultVideoStreamIndex=Tt.default;const xt=$(DefaultVideoTile$1);et.DefaultVideoTile=xt.default;const Lt=$(DefaultVideoTileController$1);et.DefaultVideoTileController=Lt.default;const Xt=$(DefaultVideoTileFactory$1);et.DefaultVideoTileFactory=Xt.default;const Ht=$(DefaultVideoTransformDevice$1);et.DefaultVideoTransformDevice=Ht.default;const zt=$(DefaultVolumeIndicatorAdapter$1);et.DefaultVolumeIndicatorAdapter=zt.default;const nn=$(DefaultWebSocketAdapter$1);et.DefaultWebSocketAdapter=nn.default;const vn=$(DevicePixelRatioWindowSource$1);et.DevicePixelRatioWindowSource=vn.default;const pn=$(DeviceSelection$1);et.DeviceSelection=pn.default;const un=$(EventBufferConfiguration$1);et.EventBufferConfiguration=un.default;const On=$(EventIngestionConfiguration$1);et.EventIngestionConfiguration=On.default;const fn=$(FinishGatheringICECandidatesTask$1);et.FinishGatheringICECandidatesTask=fn.default;const $n=$(FullJitterBackoff$1);et.FullJitterBackoff=$n.default;const xn=$(FullJitterBackoffFactory$1);et.FullJitterBackoffFactory=xn.default;const Nn=$(FullJitterLimitedBackoff$1);et.FullJitterLimitedBackoff=Nn.default;const Bn=$(GetUserMediaError$1);et.GetUserMediaError=Bn.default;const wn=$(GlobalMetricReport$1);et.GlobalMetricReport=wn.default;const Tn=$(InMemoryJSONEventBuffer$1);et.InMemoryJSONEventBuffer=Tn.default;const Ln=$(IntervalScheduler$1);et.IntervalScheduler=Ln.default;const Jn=$(JoinAndReceiveIndexTask$1);et.JoinAndReceiveIndexTask=Jn.default;const Qn=$(LeaveAndReceiveLeaveAckTask$1);et.LeaveAndReceiveLeaveAckTask=Qn.default;const Gn=$(ListenForVolumeIndicatorsTask$1);et.ListenForVolumeIndicatorsTask=Gn.default;const jn=$(Log$1);et.Log=jn.default;const Hn=$(LogLevel);et.LogLevel=Hn.default;const Zn=$(MediaDeviceProxyHandler$1);et.MediaDeviceProxyHandler=Zn.default;const Xn=$(MeetingEventsClientConfiguration$1);et.MeetingEventsClientConfiguration=Xn.default;const Yn=$(MeetingFeatures$1);et.MeetingFeatures=Yn.default;const _i=$(MeetingReadinessCheckerConfiguration$1);et.MeetingReadinessCheckerConfiguration=_i.default;const er=$(MeetingSessionConfiguration$1);et.MeetingSessionConfiguration=er.default;const tr=$(MeetingSessionCredentials$1);et.MeetingSessionCredentials=tr.default;const nr=$(MeetingSessionLifecycleEvent);et.MeetingSessionLifecycleEvent=nr.default;const ir=$(MeetingSessionLifecycleEventCondition);et.MeetingSessionLifecycleEventCondition=ir.default;const or=$(MeetingSessionStatus$1);et.MeetingSessionStatus=or.default;const sr=$(MeetingSessionStatusCode);et.MeetingSessionStatusCode=sr.default;const ar=$(MeetingSessionTURNCredentials$1);et.MeetingSessionTURNCredentials=ar.default;const lr=$(MeetingSessionURLs$1);et.MeetingSessionURLs=lr.default;const cr=$(MeetingSessionVideoAvailability$1);et.MeetingSessionVideoAvailability=cr.default;const dr=$(Message$1);et.Message=dr.default;const ur=$(MessagingSessionConfiguration$1);et.MessagingSessionConfiguration=ur.default;const fr=$(ModelSpecBuilder$1);et.ModelSpecBuilder=fr.default;const hr=$(MonitorTask$1);et.MonitorTask=hr.default;const pr=$(MultiLogger$1);et.MultiLogger=pr.default;const mr=$(NScaleVideoUplinkBandwidthPolicy$1);et.NScaleVideoUplinkBandwidthPolicy=mr.default;const gr=$(requireNoOpAudioVideoController());et.NoOpAudioVideoController=gr.default;const Sr=$(NoOpDebugLogger$1);et.NoOpDebugLogger=Sr.default;const vr=$(NoOpDeviceController$1);et.NoOpDeviceController=vr.default;const _r=$(NoOpEventReporter$1);et.NoOpEventReporter=_r.default;const yr=$(NoOpLogger$1);et.NoOpLogger=yr.default;const Cr=$(NoOpMediaStreamBroker$1);et.NoOpMediaStreamBroker=Cr.default;const br=$(NoOpTask$1);et.NoOpTask=br.default;const wr=$(NoOpVideoElementFactory$1);et.NoOpVideoElementFactory=wr.default;const Tr=$(NoOpVideoFrameProcessor$1);et.NoOpVideoFrameProcessor=Tr.default;const Er=$(NoVideoDownlinkBandwidthPolicy$1);et.NoVideoDownlinkBandwidthPolicy=Er.default;const Rr=$(NoVideoUplinkBandwidthPolicy$1);et.NoVideoUplinkBandwidthPolicy=Rr.default;const kr=$(NotFoundError$1);et.NotFoundError=kr.default;const Mr=$(NotReadableError$1);et.NotReadableError=Mr.default;const Ar=$(OnceTask$1);et.OnceTask=Ar.default;const Ir=$(OpenSignalingConnectionTask$1);et.OpenSignalingConnectionTask=Ir.default;const Pr=$(OverconstrainedError$1);et.OverconstrainedError=Pr.default;const $r=$(POSTLogger$1);et.POSTLogger=$r.default;const xr=$(ParallelGroupTask$1);et.ParallelGroupTask=xr.default;const Dr=$(PermissionDeniedError$1);et.PermissionDeniedError=Dr.default;const Or=$(PrefetchOn$1);et.PrefetchOn=Or.default;const Nr=$(PrefetchSortBy$1);et.PrefetchSortBy=Nr.default;const Fr=$(PromiseQueue$1);et.PromiseQueue=Fr.default;const Br=$(requirePromoteToPrimaryMeetingTask());et.PromoteToPrimaryMeetingTask=Br.default;const Lr=$(RealtimeAttendeePositionInFrame$1);et.RealtimeAttendeePositionInFrame=Lr.default;const Vr=$(RealtimeState$1);et.RealtimeState=Vr.default;const Ur=$(RealtimeVolumeIndicator$1);et.RealtimeVolumeIndicator=Ur.default;const jr=$(ReceiveAudioInputTask$1);et.ReceiveAudioInputTask=jr.default;const Hr=$(ReceiveRemoteVideoPauseResumeTask);et.ReceiveRemoteVideoPauseResumeTask=Hr.default;const Gr=$(ReceiveVideoInputTask$1);et.ReceiveVideoInputTask=Gr.default;const zr=$(ReceiveVideoStreamIndexTask$1);et.ReceiveVideoStreamIndexTask=zr.default;const Wr=$(ReconnectionHealthPolicy$1);et.ReconnectionHealthPolicy=Wr.default;const Kr=$(RedundantAudioEncoder$1);et.RedundantAudioEncoder=Kr.default;const qr=$(RedundantAudioEncoderWorkerCode$1);et.RedundantAudioEncoderWorkerCode=qr.default;const Jr=$(RedundantAudioRecoveryMetricReport$1);et.RedundantAudioRecoveryMetricReport=Jr.default;const Qr=$(RunnableTask$1);et.RunnableTask=Qr.default;const Zr=$(SDP$1);et.SDP=Zr.default;const Xr=$(SDPCandidateType);et.SDPCandidateType=Xr.default;const Yr=$(SDPMediaSection$1);et.SDPMediaSection=Yr.default;const eo=$(SendAndReceiveDataMessagesTask$1);et.SendAndReceiveDataMessagesTask=eo.default;const to=$(SendingAudioFailureConnectionHealthPolicy$1);et.SendingAudioFailureConnectionHealthPolicy=to.default;const no=$(SerialGroupTask$1);et.SerialGroupTask=no.default;const io=$(ServerSideNetworkAdaption);et.ServerSideNetworkAdaption=io.default;const ro=$(SessionStateControllerAction);et.SessionStateControllerAction=ro.default;const oo=$(SessionStateControllerDeferPriority);et.SessionStateControllerDeferPriority=oo.default;const so=$(SessionStateControllerState);et.SessionStateControllerState=so.default;const ao=$(SessionStateControllerTransitionResult);et.SessionStateControllerTransitionResult=ao.default;const lo=$(SetLocalDescriptionTask$1);et.SetLocalDescriptionTask=lo.default;const co=$(SetRemoteDescriptionTask$1);et.SetRemoteDescriptionTask=co.default;const uo=$(SignalingAndMetricsConnectionMonitor$1);et.SignalingAndMetricsConnectionMonitor=uo.default;const fo=$(SignalingClientConnectionRequest$1);et.SignalingClientConnectionRequest=fo.default;const ho=$(SignalingClientEvent$1);et.SignalingClientEvent=ho.default;const po=$(SignalingClientEventType);et.SignalingClientEventType=po.default;const mo=$(SignalingClientJoin$1);et.SignalingClientJoin=mo.default;const go=$(SignalingClientSubscribe$1);et.SignalingClientSubscribe=go.default;const So=$(SignalingClientVideoSubscriptionConfiguration$1);et.SignalingClientVideoSubscriptionConfiguration=So.default;const vo=$(SimulcastContentShareTransceiverController$1);et.SimulcastContentShareTransceiverController=vo.default;const _o=$(SimulcastLayers);et.SimulcastLayers=_o.default;const yo=$(SimulcastTransceiverController$1);et.SimulcastTransceiverController=yo.default;const Co=$(SimulcastVideoStreamIndex$1);et.SimulcastVideoStreamIndex=Co.default;const bo=$(SingleNodeAudioTransformDevice$1);et.SingleNodeAudioTransformDevice=bo.default;const wo=$(StreamMetricReport$1);et.StreamMetricReport=wo.default;const To=$(SubscribeAndReceiveSubscribeAckTask$1);et.SubscribeAndReceiveSubscribeAckTask=To.default;const Eo=$(TargetDisplaySize);et.TargetDisplaySize=Eo.default;const Ro=$(TaskStatus$1);et.TaskStatus=Ro.default;const ko=$(TimeoutScheduler$1);et.TimeoutScheduler=ko.default;const Mo=$(TimeoutTask$1);et.TimeoutTask=Mo.default;const Ao=$(Transcript$1);et.Transcript=Ao.default;const Io=$(TranscriptAlternative$1);et.TranscriptAlternative=Io.default;const Po=$(TranscriptEntity$1);et.TranscriptEntity=Po.default;const $o=$(TranscriptItem$1);et.TranscriptItem=$o.default;const xo=$(TranscriptItemType$1);et.TranscriptItemType=xo.default;const Do=$(TranscriptLanguageWithScore$1);et.TranscriptLanguageWithScore=Do.default;const Oo=$(TranscriptResult$1);et.TranscriptResult=Oo.default;const No=$(TranscriptionStatus$1);et.TranscriptionStatus=No.default;const Fo=$(TranscriptionStatusType$1);et.TranscriptionStatusType=Fo.default;const Bo=$(_TypeError);et.TypeError=Bo.default;const Lo=$(UnusableAudioWarningConnectionHealthPolicy$1);et.UnusableAudioWarningConnectionHealthPolicy=Lo.default;const Vo=$(Versioning$1);et.Versioning=Vo.default;const Uo=$(VideoAdaptiveProbePolicy$1);et.VideoAdaptiveProbePolicy=Uo.default;const jo=$(VideoCodecCapability$1);et.VideoCodecCapability=jo.default;const Ho=$(VideoEncodingConcurrentSendersHealthPolicy$1);et.VideoEncodingConcurrentSendersHealthPolicy=Ho.default;const Go=$(VideoEncodingConnectionHealthPolicyName);et.VideoEncodingConnectionHealthPolicyName=Go.default;const zo=$(VideoEncodingCpuConnectionHealthPolicy$1);et.VideoEncodingCpuConnectionHealthPolicy=zo.default;const Wo=$(VideoEncodingFramerateConnectionHealthPolicy$1);et.VideoEncodingFramerateConnectionHealthPolicy=Wo.default;const Ko=$(VideoFxProcessor$1);et.VideoFxProcessor=Ko.default;const qo=$(VideoLogEvent);et.VideoLogEvent=qo.default;const Jo=$(VideoOnlyTransceiverController$1);et.VideoOnlyTransceiverController=Jo.default;const Qo=$(VideoPreference$1);et.VideoPreference=Qo.default;const Zo=$(VideoPreferences$1);et.VideoPreferences=Zo.default;const Xo=$(VideoPriorityBasedPolicy$1);et.VideoPriorityBasedPolicy=Xo.default;const Yo=$(VideoPriorityBasedPolicyConfig$1);et.VideoPriorityBasedPolicyConfig=Yo.default;const ts=$(VideoQualityAdaptationPreference);et.VideoQualityAdaptationPreference=ts.default;const ns=$(VideoQualitySettings$1);et.VideoQualitySettings=ns.default;const is=$(VideoSource$1);et.VideoSource=is.default;const rs=$(VideoStreamDescription$1);et.VideoStreamDescription=rs.default;const os=$(VideoTileState$1);et.VideoTileState=os.default;const ss=$(VoiceFocusDeviceTransformer$1);et.VoiceFocusDeviceTransformer=ss.default;const as=$(VoiceFocusTransformDevice$1);et.VoiceFocusTransformDevice=as.default;const ls=$(WaitForAttendeePresenceTask$1);et.WaitForAttendeePresenceTask=ls.default;const cs=$(WebSocketReadyState);et.WebSocketReadyState=cs.default;const ds=$(ZLIBTextCompressor$1);et.ZLIBTextCompressor=ds.default;const us=VideoPreferences$1;Object.defineProperty(et,"MutableVideoPreferences",{enumerable:!0,get:function(){return us.MutableVideoPreferences}});const qn=Types;Object.defineProperty(et,"Some",{enumerable:!0,get:function(){return qn.Some}}),Object.defineProperty(et,"None",{enumerable:!0,get:function(){return qn.None}}),Object.defineProperty(et,"Maybe",{enumerable:!0,get:function(){return qn.Maybe}});const fs=AudioTransformDevice;Object.defineProperty(et,"isAudioTransformDevice",{enumerable:!0,get:function(){return fs.isAudioTransformDevice}});const hs=Destroyable;Object.defineProperty(et,"isDestroyable",{enumerable:!0,get:function(){return hs.isDestroyable}});const ps=VideoTransformDevice;Object.defineProperty(et,"isVideoTransformDevice",{enumerable:!0,get:function(){return ps.isVideoTransformDevice}})}(build$2)),build$2}var buildExports=requireBuild();const CHAT_TOPIC$1="exam-chat-v1",MAX_CHAT_LEN$1=500;function safeJsonParse$1(et){try{return JSON.parse(et)}catch{return null}}function nowIso$1(){return new Date().toISOString()}function makeMessageId$1(){try{return crypto.randomUUID()}catch{return`${Date.now()}-${Math.random().toString(16).slice(2)}`}}function ProctorDashboard({currentUsername:et,meetingId:$,onSetMeetingId:_,onGoSchedule:tt,onBack:nt,makeExternalUserIdWithFallback:it,extractDisplayName:rt}){var tn,Qt;const[ot,lt]=reactExports.useState(null),[st,at]=reactExports.useState("Idle"),[ct,dt]=reactExports.useState(!1),[ut,ft]=reactExports.useState(!1),[pt,St]=reactExports.useState(!1),[gt,yt]=reactExports.useState(null),[vt,Ct]=reactExports.useState(!1),[Et,Mt]=reactExports.useState(!0),[Rt,At]=reactExports.useState(!0),[Dt,It]=reactExports.useState(null),[Vt,jt]=reactExports.useState(!0),[qt,cn]=reactExports.useState(!1),[dn,an]=reactExports.useState({}),[bn,Ut]=reactExports.useState([]),[Kt,Gt]=reactExports.useState(""),[Wt,Jt]=reactExports.useState("all"),_n=reactExports.useRef(new Set),mn=reactExports.useRef(null),hn=reactExports.useRef(null),gn=reactExports.useRef(null),yn=reactExports.useRef(null),En=reactExports.useRef({}),Mn=reactExports.useRef(null),Rn=reactExports.useRef(null),Pn=reactExports.useRef(new Map),Sn=$t=>{const Bt=String($t||"").split("#")[0],sn=Bt.split(":");return sn.length>=4&&sn[0]==="student"?`${sn[0]}:${sn[1]}:${sn[2]}`:Bt},Dn=Object.values(dn).filter($t=>$t&&$t.attendeeId).map($t=>({attendeeId:$t.attendeeId,externalUserId:$t.externalUserId,displayName:rt($t.externalUserId)})).sort(($t,Bt)=>$t.displayName.localeCompare(Bt.displayName,"ja")),An=((Qt=(tn=ot==null?void 0:ot.configuration)==null?void 0:tn.credentials)==null?void 0:Qt.attendeeId)||"",In=$t=>{if(!$t)return"";for(const Bt of Object.values(dn))if((Bt==null?void 0:Bt.attendeeId)===$t)return rt(Bt.externalUserId);return String($t)};reactExports.useEffect(()=>{var $t,Bt;(Bt=($t=mn.current)==null?void 0:$t.scrollIntoView)==null||Bt.call($t,{behavior:"smooth",block:"end"})},[bn.length]),reactExports.useEffect(()=>{if(!(ot!=null&&ot.audioVideo))return;const $t=Bt=>{var Xt;const sn=(Xt=Bt==null?void 0:Bt.text)==null?void 0:Xt.call(Bt),Ft=safeJsonParse$1(sn);if(!Ft||typeof Ft.text!="string")return;const Tt=(Bt==null?void 0:Bt.senderAttendeeId)||Ft.fromAttendeeId||"",xt=String(Ft.id||"");!xt||!(Ft.fromRole==="examinee"&&Ft.toRole==="proctor"&&Ft.type==="direct"||Ft.fromRole==="proctor"&&(Ft.type==="broadcast"||Ft.type==="direct"))||Ft.fromRole==="examinee"&&Tt&&!Object.values(dn).some(zt=>(zt==null?void 0:zt.attendeeId)===Tt)||_n.current.has(xt)||(_n.current.add(xt),Ut(Ht=>[...Ht,{id:xt,ts:Ft.ts||nowIso$1(),type:Ft.type,fromRole:Ft.fromRole,fromAttendeeId:Tt,toRole:Ft.toRole,toAttendeeId:Ft.toAttendeeId||"",text:Ft.text}]))};try{ot.audioVideo.realtimeSubscribeToReceiveDataMessage(CHAT_TOPIC$1,$t)}catch{}return()=>{try{ot.audioVideo.realtimeUnsubscribeFromReceiveDataMessage(CHAT_TOPIC$1,$t)}catch{}}},[ot,dn]);const Cn=async()=>{const $t=String($||"").trim();if($t)try{const Bt=await getScheduledMeetingRecording($t);yt(Bt)}catch(Bt){console.warn("Failed to fetch recording status",Bt)}};reactExports.useEffect(()=>{if(!ot)return;let $t=!1;const Bt=async()=>{$t||await Cn()};Bt();const sn=setInterval(Bt,5e3);return()=>{$t=!0,clearInterval(sn)}},[ot,$]);const Fn=(gt==null?void 0:gt.recording_status)==="Initializing"||(gt==null?void 0:gt.recording_status)==="InProgress"||(gt==null?void 0:gt.recording_status)==="Stopping",wt=async()=>{const $t=String($||"").trim();if(!$t){alert("");return}if(!ot){alert("");return}Ct(!0);try{const Bt=Fn?await stopScheduledMeetingRecording($t):await startScheduledMeetingRecording($t);yt(Bt)}catch(Bt){console.error(Bt),alert(`: ${Bt.message||Bt}`)}finally{Ct(!1)}},mt=()=>{const $t=String(Kt||"").trim();if(!$t)return;if($t.length>MAX_CHAT_LEN$1){alert(`${MAX_CHAT_LEN$1}`);return}if(!(ot!=null&&ot.audioVideo))return;const Bt=makeMessageId$1(),sn=nowIso$1(),Ft=Wt==="all"?{id:Bt,ts:sn,type:"broadcast",fromRole:"proctor",fromAttendeeId:An,toRole:"all",text:$t}:{id:Bt,ts:sn,type:"direct",fromRole:"proctor",fromAttendeeId:An,toRole:"examinee",toAttendeeId:Wt,text:$t};_n.current.add(Bt),Ut(Tt=>[...Tt,{id:Bt,ts:sn,type:Ft.type,fromRole:Ft.fromRole,fromAttendeeId:Ft.fromAttendeeId,toRole:Ft.toRole,toAttendeeId:Ft.toAttendeeId||"",text:Ft.text}]);try{ot.audioVideo.realtimeSendDataMessage(CHAT_TOPIC$1,JSON.stringify(Ft),3e5)}catch(Tt){console.error("Failed to send chat message",Tt),alert("")}Gt("")},ht=$t=>{if(!$t)return;const Bt=Pn.current;if(!(!Bt||Bt.size===0)&&typeof $t.audioVideo.realtimeUnsubscribeFromVolumeIndicator=="function"){for(const[sn,Ft]of Bt.entries())try{$t.audioVideo.realtimeUnsubscribeFromVolumeIndicator(sn,Ft)}catch{}Bt.clear()}},bt=()=>{try{const $t=yn.current;if($t)for(const Bt of $t.getTracks())Bt.stop()}catch{}yn.current=null;try{hn.current&&hn.current.srcObject&&(hn.current.srcObject=null)}catch{}},kt=async()=>{if(!ot){if(!Et){bt();return}if(!yn.current)try{const $t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});if(yn.current=$t,hn.current){hn.current.srcObject=$t;try{await hn.current.play()}catch{}}}catch($t){console.warn("Failed to start pre-join camera preview",$t),bt()}}},Ot=async()=>{const $t=ot;if(!$t){nt();return}try{try{$t.audioVideo.stopLocalVideoTile()}catch{}try{$t.audioVideo.stopVideoInput()}catch{}try{Mn.current&&$t.audioVideo.removeObserver(Mn.current)}catch{}try{Rn.current&&typeof $t.audioVideo.realtimeUnsubscribeToAttendeeIdPresence=="function"&&$t.audioVideo.realtimeUnsubscribeToAttendeeIdPresence(Rn.current)}catch{}try{ht($t)}catch{}try{$t.audioVideo.stop()}catch{}}finally{lt(null),an({}),dt(!1),ft(!1),at("Idle"),nt()}},Nt=async()=>{try{if(!$)return;await navigator.clipboard.writeText($),cn(!0),setTimeout(()=>cn(!1),1500)}catch{}},en=()=>{if(ot)if(ct)(async()=>{try{if(!pt){const $t=await ot.audioVideo.listAudioInputDevices();if(!$t||$t.length===0){alert("");return}await ot.audioVideo.startAudioInput($t[0].deviceId),St(!0)}ot.audioVideo.realtimeUnmuteLocalAudio(),dt(!1)}catch($t){console.error("Failed to start/unmute mic",$t),alert("")}})();else{ot.audioVideo.realtimeMuteLocalAudio(),dt(!0);try{ot.audioVideo.stopAudioInput(),St(!1)}catch{}}},rn=async()=>{const $t=ot;if($t){if(ut){try{$t.audioVideo.stopLocalVideoTile()}catch{}try{$t.audioVideo.stopVideoInput()}catch{}ft(!1);return}try{const Bt=await $t.audioVideo.listVideoInputDevices();if(!Bt||Bt.length===0){alert("");return}await $t.audioVideo.startVideoInput(Bt[0].deviceId),$t.audioVideo.startLocalVideoTile(),ft(!0)}catch(Bt){console.error("Failed to start camera",Bt),alert("")}}};reactExports.useEffect(()=>{let $t=!1;return fetchProfile().then(Bt=>{$t||It(Bt)}).catch(Bt=>{console.error(Bt)}).finally(()=>{$t||jt(!1)}),()=>{$t=!0}},[]),reactExports.useEffect(()=>ot?()=>{}:(kt(),()=>{bt()}),[ot,Et]);const ln=async $t=>{try{const Bt=String($t||$||"").trim();if(!$){at("Error: Please create/select a scheduled meeting first.");return}at("Connecting...");const sn=it("proctor",Dt,et),Ft=await createMeeting(Bt),Tt=await createAttendee(Ft.Meeting.MeetingId,sn),xt=new buildExports.ConsoleLogger("ChimeProctorLogger",buildExports.LogLevel.INFO),Lt=new buildExports.DefaultDeviceController(xt),Xt=new buildExports.MeetingSessionConfiguration(Ft.Meeting,Tt.Attendee),Ht=new buildExports.DefaultMeetingSession(Xt,xt,Lt),zt=await Ht.audioVideo.listAudioInputDevices(),nn=await Ht.audioVideo.listVideoInputDevices(),vn=await Ht.audioVideo.listAudioOutputDevices();let pn=!1,un=!1;try{Rt&&zt.length>0&&(await Ht.audioVideo.startAudioInput(zt[0].deviceId),un=!0)}catch(fn){console.warn("Proctor mic unavailable",fn)}try{if(Et){const fn=yn.current;if(fn){await Ht.audioVideo.startVideoInput(fn),pn=!0,yn.current=null;try{hn.current&&hn.current.srcObject&&(hn.current.srcObject=null)}catch{}}else nn.length>0&&(await Ht.audioVideo.startVideoInput(nn[0].deviceId),pn=!0)}}catch(fn){console.warn("Proctor camera unavailable",fn)}vn.length>0;const On={audioVideoDidStart:()=>{if(gn.current&&Ht.audioVideo.bindAudioElement(gn.current),typeof Ht.audioVideo.realtimeSubscribeToAttendeeIdPresence=="function"){const fn=($n,xn,Nn)=>{if(!Nn)return;const Bn=String(Nn).split("#")[0];if(!Bn.startsWith("student:")&&!Bn.startsWith("student-"))return;const wn=Sn(Bn);if(!xn){try{const Tn=Pn.current,Ln=Tn.get($n);Ln&&typeof Ht.audioVideo.realtimeUnsubscribeFromVolumeIndicator=="function"&&Ht.audioVideo.realtimeUnsubscribeFromVolumeIndicator($n,Ln),Tn.delete($n)}catch{}an(Tn=>{if(!Tn[wn])return Tn;const Ln={...Tn};return delete Ln[wn],Ln});return}an(Tn=>Tn[wn]?{...Tn,[wn]:{...Tn[wn],externalUserId:Bn,attendeeId:$n}}:{...Tn,[wn]:{externalUserId:Bn,attendeeId:$n,cameraTileId:null,screenTileId:null,isMuted:!1}})};Rn.current=fn;try{Ht.audioVideo.realtimeSubscribeToAttendeeIdPresence(fn)}catch{}}},videoTileDidUpdate:fn=>{if(fn.localTile&&!fn.isContent){Ht.audioVideo.bindVideoElement(fn.tileId,hn.current);return}if(!fn.boundAttendeeId||fn.localTile)return;const $n=fn.boundExternalUserId,xn=fn.isContent,Nn=String($n||"").split("#")[0],Bn=Sn(Nn);try{const wn=fn.boundAttendeeId,Tn=Pn.current;if(wn&&!Tn.has(wn)&&typeof Ht.audioVideo.realtimeSubscribeToVolumeIndicator=="function"){const Ln=(Jn,Qn,Gn)=>{an(jn=>{const Hn=jn[Bn];return!Hn||Hn.isMuted===Gn&&Hn.attendeeId===wn?jn:{...jn,[Bn]:{...Hn,attendeeId:wn,isMuted:!!Gn}}})};Tn.set(wn,Ln),Ht.audioVideo.realtimeSubscribeToVolumeIndicator(wn,Ln)}}catch{}an(wn=>{const Tn=wn[Bn]||{externalUserId:Nn};return{...wn,[Bn]:{...Tn,externalUserId:Nn,attendeeId:fn.boundAttendeeId||Tn.attendeeId||null,cameraTileId:xn?Tn.cameraTileId:fn.tileId,screenTileId:xn?fn.tileId:Tn.screenTileId}}}),setTimeout(()=>{const wn=En.current[fn.tileId];wn&&Ht.audioVideo.bindVideoElement(fn.tileId,wn)},100)},videoTileWasRemoved:fn=>{an($n=>{const xn={...$n};for(const Nn in xn)xn[Nn].cameraTileId===fn&&(xn[Nn].cameraTileId=null),xn[Nn].screenTileId===fn&&(xn[Nn].screenTileId=null);return xn})}};if(Ht.audioVideo.addObserver(On),Mn.current=On,Ht.audioVideo.start(),pn?(Ht.audioVideo.startLocalVideoTile(),ft(!0)):ft(!1),St(un),un||dt(!0),un&&!Rt)try{Ht.audioVideo.realtimeMuteLocalAudio(),dt(!0),Ht.audioVideo.stopAudioInput(),St(!1)}catch{}un&&Rt&&dt(!1),lt(Ht),at("Monitoring Active")}catch(Bt){console.error(Bt),at("Error: "+Bt.message)}},Zt=ot?ut:Et,on=ot?ct:!Rt,kn=Object.keys(dn).length,Yt=ot?1+kn:0;return Vt?jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:"Monitoring Dashboard"}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-sm text-slate-600",children:"Loading profile..."})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:"Monitoring Dashboard"}),jsxRuntimeExports.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[!ot&&jsxRuntimeExports.jsx("button",{onClick:nt,className:"rounded-md border border-slate-300 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:" "}),ot&&jsxRuntimeExports.jsx("button",{onClick:Ot,className:"rounded-md border border-slate-300 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:""})]})]}),jsxRuntimeExports.jsx("div",{className:"rounded-xl border border-slate-200 bg-white p-6 max-w-3xl",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-slate-800",children:"ID"}),jsxRuntimeExports.jsx("input",{value:$,readOnly:!0,placeholder:"",className:"w-full sm:w-auto sm:min-w-[260px] rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 placeholder-slate-400"}),jsxRuntimeExports.jsx("button",{onClick:Nt,disabled:!$,className:"rounded-md border border-slate-300 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed",children:""}),qt&&jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-emerald-400",children:""})]})}),jsxRuntimeExports.jsx("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"text-sm text-slate-700",children:["Status: ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-slate-900",children:st})]}),ot&&jsxRuntimeExports.jsxs("div",{className:"text-sm text-slate-700",children:[": ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-slate-900",children:Yt}),""]}),!ot&&jsxRuntimeExports.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Mt($t=>!$t),className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:Et?": ON":": OFF"}),jsxRuntimeExports.jsx("button",{onClick:()=>At($t=>!$t),className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:Rt?": ON":": OFF"}),jsxRuntimeExports.jsx("button",{onClick:()=>ln(),className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500",children:""})]}),ot&&jsxRuntimeExports.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"rounded-md bg-emerald-600/20 px-3 py-2 text-sm font-semibold text-emerald-300",children:"Live"}),(gt==null?void 0:gt.recording_status)&&jsxRuntimeExports.jsxs("span",{className:"rounded-md bg-slate-950/10 px-3 py-2 text-sm font-semibold text-slate-700",children:[": ",jsxRuntimeExports.jsx("span",{className:"text-slate-900",children:gt.recording_status})]}),jsxRuntimeExports.jsx("button",{onClick:wt,disabled:vt,className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed",children:Fn?"":""}),jsxRuntimeExports.jsx("button",{onClick:rn,className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:ut?"OFF":"ON"}),jsxRuntimeExports.jsx("button",{onClick:en,className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:ct?": OFF":": ON"})]})]})}),jsxRuntimeExports.jsx("audio",{ref:gn,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row",children:[jsxRuntimeExports.jsx("div",{className:"w-full lg:w-[220px]",children:jsxRuntimeExports.jsxs("div",{className:"relative overflow-hidden rounded-lg border border-indigo-500/50 bg-slate-50",children:[jsxRuntimeExports.jsxs("div",{className:"aspect-[4/3]",children:[jsxRuntimeExports.jsx("video",{ref:hn,autoPlay:!0,playsInline:!0,muted:!0,className:"h-full w-full object-cover"}),on&&jsxRuntimeExports.jsxs("div",{className:"absolute right-2 top-2 flex items-center gap-1 rounded bg-slate-950/70 px-2 py-1 text-[10px] font-semibold text-white",children:[jsxRuntimeExports.jsx("span",{className:"relative inline-block h-3 w-3 rounded-full border border-white/80",children:jsxRuntimeExports.jsx("span",{className:"absolute left-[-2px] top-1/2 h-[2px] w-[calc(100%+4px)] -translate-y-1/2 rotate-45 bg-white/80"})}),jsxRuntimeExports.jsx("span",{children:"OFF"})]}),!Zt&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-950/60 text-sm font-semibold text-white",children:"Camera Off"})]}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-slate-950/70 px-2 py-1 text-center text-xs font-medium text-slate-100",children:"Proctor Self View"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("div",{className:"grid gap-4 [grid-template-columns:repeat(auto-fill,minmax(300px,1fr))]",children:Object.values(dn).map($t=>{const Bt=rt($t.externalUserId),sn=$t.isMuted===!0;return jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:Bt}),sn&&jsxRuntimeExports.jsxs("span",{className:"inline-flex items-center gap-1 rounded bg-slate-950/70 px-2 py-0.5 text-[10px] font-semibold text-white",children:[jsxRuntimeExports.jsx("span",{className:"relative inline-block h-3 w-3 rounded-full border border-white/80",children:jsxRuntimeExports.jsx("span",{className:"absolute left-[-2px] top-1/2 h-[2px] w-[calc(100%+4px)] -translate-y-1/2 rotate-45 bg-white/80"})}),jsxRuntimeExports.jsx("span",{children:""})]})]}),jsxRuntimeExports.jsxs("div",{className:"mt-3 flex gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"relative flex-1 overflow-hidden rounded-lg bg-black",children:[jsxRuntimeExports.jsx("div",{className:"h-[120px]",children:$t.cameraTileId?jsxRuntimeExports.jsx("video",{ref:Ft=>{Ft&&(En.current[$t.cameraTileId]=Ft),Ft&&ot&&ot.audioVideo.bindVideoElement($t.cameraTileId,Ft)},className:"h-full w-full object-cover"}):jsxRuntimeExports.jsx("div",{className:"flex h-full items-center justify-center text-xs text-slate-700",children:"No Camera"})}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 bg-slate-950/70 px-2 py-1 text-[10px] font-medium text-white",children:"Camera"})]}),jsxRuntimeExports.jsxs("div",{className:"relative flex-1 overflow-hidden rounded-lg bg-slate-900",children:[jsxRuntimeExports.jsx("div",{className:"h-[120px]",children:$t.screenTileId?jsxRuntimeExports.jsx("video",{ref:Ft=>{Ft&&(En.current[$t.screenTileId]=Ft),Ft&&ot&&ot.audioVideo.bindVideoElement($t.screenTileId,Ft)},className:"h-full w-full object-contain"}):jsxRuntimeExports.jsx("div",{className:"flex h-full items-center justify-center text-xs text-slate-700",children:"No Screen"})}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 bg-slate-950/70 px-2 py-1 text-[10px] font-medium text-white",children:"Screen"})]})]})]},$t.externalUserId)})}),Object.keys(dn).length===0&&ot&&jsxRuntimeExports.jsx("p",{className:"mt-4 text-sm text-slate-600",children:"Waiting for students to join..."})]})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:""}),jsxRuntimeExports.jsxs("select",{value:Wt,onChange:$t=>Jt($t.target.value),disabled:!ot,className:"ml-auto rounded-md border border-slate-300 bg-white px-2 py-1 text-xs text-slate-900 disabled:opacity-50",children:[jsxRuntimeExports.jsx("option",{value:"all",children:""}),Dn.map($t=>jsxRuntimeExports.jsx("option",{value:$t.attendeeId,children:$t.displayName},$t.attendeeId))]})]}),jsxRuntimeExports.jsx("div",{className:"mt-3 max-h-[260px] overflow-auto rounded-lg border border-slate-200 bg-slate-50 p-3",children:bn.length===0?jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-600",children:""}):jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[bn.map($t=>{const Bt=$t.fromRole==="proctor"?"":`: ${In($t.fromAttendeeId)}`,sn=$t.type==="broadcast"?"":$t.toRole==="proctor"?"":`: ${In($t.toAttendeeId)}`;return jsxRuntimeExports.jsxs("div",{className:"rounded-md border border-slate-200 bg-white p-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-600",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-slate-800",children:Bt}),jsxRuntimeExports.jsx("span",{children:""}),jsxRuntimeExports.jsx("span",{className:"font-semibold text-slate-800",children:sn}),jsxRuntimeExports.jsx("span",{className:"ml-auto",children:new Date($t.ts).toLocaleTimeString()})]}),jsxRuntimeExports.jsx("div",{className:"mt-1 whitespace-pre-wrap break-words text-sm text-slate-900",children:$t.text})]},$t.id)}),jsxRuntimeExports.jsx("div",{ref:mn})]})}),jsxRuntimeExports.jsxs("div",{className:"mt-3 flex gap-2",children:[jsxRuntimeExports.jsx("input",{value:Kt,onChange:$t=>Gt($t.target.value),onKeyDown:$t=>{$t.key==="Enter"&&($t.preventDefault(),mt())},disabled:!ot,placeholder:ot?"":"",className:"min-w-0 flex-1 rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 placeholder-slate-400 disabled:opacity-50"}),jsxRuntimeExports.jsx("button",{onClick:mt,disabled:!ot||!String(Kt||"").trim(),className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:cursor-not-allowed disabled:opacity-50",children:""})]}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-[11px] text-slate-500",children:""})]})]})}const CHAT_TOPIC="exam-chat-v1",MAX_CHAT_LEN=500;function safeJsonParse(et){try{return JSON.parse(et)}catch{return null}}function nowIso(){return new Date().toISOString()}function makeMessageId(){try{return crypto.randomUUID()}catch{return`${Date.now()}-${Math.random().toString(16).slice(2)}`}}function ExamineeView({currentUsername:et,onBack:$,makeExternalUserIdWithFallback:_,extractDisplayName:tt}){var wt,mt;const[nt,it]=reactExports.useState(null),[rt,ot]=reactExports.useState("Idle"),[lt,st]=reactExports.useState(!1),[at,ct]=reactExports.useState(!1),[dt,ut]=reactExports.useState(!1),[ft,pt]=reactExports.useState(!1),[St,gt]=reactExports.useState(!0),[yt,vt]=reactExports.useState(!0),[Ct,Et]=reactExports.useState(null),[Mt,Rt]=reactExports.useState(!0),[At,Dt]=reactExports.useState(""),[It,Vt]=reactExports.useState(""),[jt,qt]=reactExports.useState(""),[cn,dn]=reactExports.useState([]),[an,bn]=reactExports.useState(""),Ut=reactExports.useRef(new Set),Kt=reactExports.useRef(null),Gt=reactExports.useRef(null),Wt=reactExports.useRef(null),Jt=reactExports.useRef(null),_n=reactExports.useRef(null),mn=reactExports.useRef(null),hn=reactExports.useRef(null),gn=reactExports.useRef(null),yn=((mt=(wt=nt==null?void 0:nt.configuration)==null?void 0:wt.credentials)==null?void 0:mt.attendeeId)||"",En=nt?at:!yt;reactExports.useEffect(()=>{var ht,bt;(bt=(ht=Kt.current)==null?void 0:ht.scrollIntoView)==null||bt.call(ht,{behavior:"smooth",block:"end"})},[cn.length]),reactExports.useEffect(()=>{if(!(nt!=null&&nt.audioVideo))return;const ht=bt=>{var Zt;const kt=(Zt=bt==null?void 0:bt.text)==null?void 0:Zt.call(bt),Ot=safeJsonParse(kt);if(!Ot||typeof Ot.text!="string")return;const Nt=String(Ot.id||"");if(!Nt||!(Ot.fromRole==="proctor"))return;const rn=(bt==null?void 0:bt.senderAttendeeId)||Ot.fromAttendeeId||"";It&&rn&&rn!==It||!(Ot.type==="broadcast"||Ot.type==="direct"&&Ot.toRole==="examinee"&&Ot.toAttendeeId===yn)||Ut.current.has(Nt)||(Ut.current.add(Nt),dn(on=>[...on,{id:Nt,ts:Ot.ts||nowIso(),fromRole:Ot.fromRole,type:Ot.type,text:Ot.text}]))};try{nt.audioVideo.realtimeSubscribeToReceiveDataMessage(CHAT_TOPIC,ht)}catch{}return()=>{try{nt.audioVideo.realtimeUnsubscribeFromReceiveDataMessage(CHAT_TOPIC,ht)}catch{}}},[nt,yn,It]);const Mn=()=>{const ht=String(an||"").trim();if(!ht)return;if(ht.length>MAX_CHAT_LEN){alert(`${MAX_CHAT_LEN}`);return}if(!(nt!=null&&nt.audioVideo))return;const bt=makeMessageId(),kt=nowIso(),Ot={id:bt,ts:kt,type:"direct",fromRole:"examinee",fromAttendeeId:yn,toRole:"proctor",text:ht};Ut.current.add(bt),dn(Nt=>[...Nt,{id:bt,ts:kt,fromRole:"examinee",type:"direct",text:ht}]);try{nt.audioVideo.realtimeSendDataMessage(CHAT_TOPIC,JSON.stringify(Ot),3e5)}catch(Nt){console.error("Failed to send chat message",Nt),alert("")}bn("")},Rn=()=>{try{const ht=Wt.current;if(ht)for(const bt of ht.getTracks())bt.stop()}catch{}Wt.current=null;try{Gt.current&&Gt.current.srcObject&&(Gt.current.srcObject=null)}catch{}},Pn=async()=>{if(!nt){if(!St){Rn();return}if(!Wt.current)try{const ht=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});if(Wt.current=ht,Gt.current){Gt.current.srcObject=ht;try{await Gt.current.play()}catch{}}}catch(ht){console.warn("Failed to start pre-join camera preview",ht),Rn()}}},Sn=async()=>{const ht=nt;if(ht)try{try{ht.audioVideo.stopContentShare()}catch{}try{ht.audioVideo.stopLocalVideoTile()}catch{}try{ht.audioVideo.stopVideoInput()}catch{}try{gn.current&&ht.audioVideo.removeObserver(gn.current)}catch{}try{ht.audioVideo.stop()}catch{}}finally{try{const bt=_n.current;if(bt)for(const kt of bt.getTracks())kt.stop()}catch{}_n.current=null,Jt.current&&(Jt.current.srcObject=null),st(!1),ct(!1),ut(!1),Dt(""),it(null),ot("Idle")}},Dn=()=>{if(nt)if(at)(async()=>{try{if(!ft){const ht=await nt.audioVideo.listAudioInputDevices();if(!ht||ht.length===0){alert("");return}await nt.audioVideo.startAudioInput(ht[0].deviceId),pt(!0)}nt.audioVideo.realtimeUnmuteLocalAudio(),ct(!1)}catch(ht){console.error("Failed to start/unmute mic",ht),alert("")}})();else{nt.audioVideo.realtimeMuteLocalAudio(),ct(!0);try{nt.audioVideo.stopAudioInput(),pt(!1)}catch{}}},An=async()=>{const ht=nt;if(ht){if(dt){try{ht.audioVideo.stopLocalVideoTile()}catch{}try{ht.audioVideo.stopVideoInput()}catch{}ut(!1);return}try{const bt=await ht.audioVideo.listVideoInputDevices();if(!bt||bt.length===0){alert("");return}await ht.audioVideo.startVideoInput(bt[0].deviceId),ht.audioVideo.startLocalVideoTile(),ut(!0)}catch(bt){console.error("Failed to start camera",bt),alert("")}}};reactExports.useEffect(()=>{let ht=!1;return fetchProfile().then(bt=>{ht||Et(bt)}).catch(bt=>{console.error(bt)}).finally(()=>{ht||Rt(!1)}),()=>{ht=!0}},[]),reactExports.useEffect(()=>nt?()=>{}:(Pn(),()=>{Rn()}),[nt,St]);const In=async()=>{try{const ht=String(jt||"").trim();if(!ht){ot("Error: Please enter the Meeting ID.");return}ot("Initializing...");const bt=ht,kt=_("examinee",Ct,et),Ot=await createMeeting(bt),Nt=await createAttendee(Ot.Meeting.MeetingId,kt),en=new buildExports.ConsoleLogger("ChimeLogger",buildExports.LogLevel.INFO),rn=new buildExports.DefaultDeviceController(en),ln=new buildExports.MeetingSessionConfiguration(Ot.Meeting,Nt.Attendee),Zt=new buildExports.DefaultMeetingSession(ln,en,rn),on=await Zt.audioVideo.listAudioInputDevices(),kn=await Zt.audioVideo.listVideoInputDevices();let Yt=!1,tn=!1;if(yt&&on.length>0&&(await Zt.audioVideo.startAudioInput(on[0].deviceId),Yt=!0),St&&kn.length>0){const $t=Wt.current;if($t){await Zt.audioVideo.startVideoInput($t),tn=!0,Wt.current=null;try{Gt.current&&Gt.current.srcObject&&(Gt.current.srcObject=null)}catch{}}else await Zt.audioVideo.startVideoInput(kn[0].deviceId),tn=!0}const Qt={audioVideoDidStart:()=>{hn.current&&Zt.audioVideo.bindAudioElement(hn.current)},videoTileDidUpdate:$t=>{if($t.localTile&&!$t.isContent){Zt.audioVideo.bindVideoElement($t.tileId,Gt.current);return}if(!$t.localTile&&$t.boundExternalUserId){const Bt=$t.boundExternalUserId;(String(Bt).startsWith("proctor:")||String(Bt).startsWith("proctor-"))&&(Dt(String(Bt)),$t.boundAttendeeId&&Vt($t.boundAttendeeId),mn.current&&Zt.audioVideo.bindVideoElement($t.tileId,mn.current))}},contentShareDidStart:()=>{st(!0),console.log("Screen share started")},contentShareDidStop:()=>{st(!1),console.log("Screen share stopped"),Jt.current&&(Jt.current.srcObject=null),_n.current=null}};Zt.audioVideo.addObserver(Qt),gn.current=Qt,Zt.audioVideo.start(),tn?(Zt.audioVideo.startLocalVideoTile(),ut(!0)):ut(!1),pt(Yt),Yt||ct(!0),it(Zt),ot("Connected")}catch(ht){console.error(ht),ot("Error: "+ht.message)}},Cn=nt?dt:St,Fn=async()=>{if(nt)try{const ht=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});if(_n.current=ht,st(!0),Jt.current){Jt.current.srcObject=ht;try{await Jt.current.play()}catch{}}await nt.audioVideo.startContentShare(ht);const[bt]=ht.getVideoTracks();bt&&bt.addEventListener("ended",()=>{try{nt.audioVideo.stopContentShare()}catch{}st(!1),Jt.current&&(Jt.current.srcObject=null),_n.current=null})}catch(ht){console.error("Failed to start screen share",ht),alert("Failed to start screen share. Please try again.")}};return Mt?jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:"Exam Session"}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-sm text-slate-600",children:"Loading profile..."})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:"Exam Session"}),jsxRuntimeExports.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[!nt&&jsxRuntimeExports.jsx("button",{onClick:$,className:"rounded-md border border-slate-300 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:" "}),nt&&jsxRuntimeExports.jsx("button",{onClick:async()=>{await Sn(),$()},className:"rounded-md border border-slate-300 px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:""})]})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6 max-w-4xl",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-slate-700",children:["Status: ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-slate-900",children:rt})]}),jsxRuntimeExports.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Please ensure your camera is on and you are sharing your screen."}),!nt&&jsxRuntimeExports.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-2",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-semibold text-slate-800",children:"ID"}),jsxRuntimeExports.jsx("input",{value:jt,onChange:ht=>qt(ht.target.value),placeholder:"ID",className:"w-full sm:w-auto sm:min-w-[280px] rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),jsxRuntimeExports.jsx("audio",{ref:hn,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"mt-6 flex flex-col gap-4 lg:flex-row lg:items-start",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-row gap-4 lg:flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"relative w-[200px] overflow-hidden rounded-lg bg-black",children:[jsxRuntimeExports.jsx("div",{className:"h-[150px]",children:jsxRuntimeExports.jsx("video",{ref:Gt,autoPlay:!0,playsInline:!0,muted:!0,className:"h-full w-full object-cover"})}),En&&jsxRuntimeExports.jsxs("div",{className:"absolute right-2 top-2 flex items-center gap-1 rounded bg-slate-950/70 px-2 py-1 text-[10px] font-semibold text-white",children:[jsxRuntimeExports.jsx("span",{className:"relative inline-block h-3 w-3 rounded-full border border-white/80",children:jsxRuntimeExports.jsx("span",{className:"absolute left-[-2px] top-1/2 h-[2px] w-[calc(100%+4px)] -translate-y-1/2 rotate-45 bg-white/80"})}),jsxRuntimeExports.jsx("span",{children:"OFF"})]}),!Cn&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-950/60 text-sm font-semibold text-white",children:"Camera Off"}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-2 left-2 rounded bg-slate-950/70 px-2 py-1 text-xs font-medium text-white",children:"My Camera"})]}),jsxRuntimeExports.jsxs("div",{className:"relative w-[200px] overflow-hidden rounded-lg bg-slate-900",children:[jsxRuntimeExports.jsxs("div",{className:"h-[150px] flex items-center justify-center",children:[jsxRuntimeExports.jsx("video",{ref:Jt,autoPlay:!0,playsInline:!0,muted:!0,className:"h-full w-full object-contain"}),!lt&&jsxRuntimeExports.jsx("div",{className:"absolute text-xs text-slate-700",children:"Not Sharing"})]}),En&&jsxRuntimeExports.jsxs("div",{className:"absolute right-2 top-2 flex items-center gap-1 rounded bg-slate-950/70 px-2 py-1 text-[10px] font-semibold text-white",children:[jsxRuntimeExports.jsx("span",{className:"relative inline-block h-3 w-3 rounded-full border border-white/80",children:jsxRuntimeExports.jsx("span",{className:"absolute left-[-2px] top-1/2 h-[2px] w-[calc(100%+4px)] -translate-y-1/2 rotate-45 bg-white/80"})}),jsxRuntimeExports.jsx("span",{children:"OFF"})]}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-2 left-2 rounded bg-slate-950/70 px-2 py-1 text-xs font-medium text-white",children:"My Screen"})]})]}),jsxRuntimeExports.jsxs("div",{className:"relative flex-1 overflow-hidden rounded-xl border border-red-500/40 bg-white",children:[jsxRuntimeExports.jsxs("div",{className:"h-[310px] flex items-center justify-center",children:[jsxRuntimeExports.jsx("video",{ref:mn,className:"h-full w-full object-contain"}),!nt&&jsxRuntimeExports.jsx("div",{className:"absolute text-sm text-slate-600",children:"Proctor video will appear here"})]}),jsxRuntimeExports.jsxs("div",{className:"absolute left-3 top-3 rounded bg-red-600/70 px-3 py-2 text-xs font-bold text-white",children:["PROCTOR (Supervisor)",At?`: ${tt(At)}`:""]})]})]}),jsxRuntimeExports.jsxs("div",{className:"mt-6 flex flex-wrap items-center gap-2",children:[!nt&&jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>gt(ht=>!ht),className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:St?": ON":": OFF"}),jsxRuntimeExports.jsx("button",{onClick:()=>vt(ht=>!ht),className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:yt?": ON":": OFF"}),jsxRuntimeExports.jsx("button",{onClick:In,disabled:rt==="Initializing...",className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"1. "})]}),nt&&!lt&&jsxRuntimeExports.jsx("button",{onClick:Fn,className:"rounded-md bg-amber-500 px-4 py-2 text-sm font-semibold text-white hover:bg-amber-400",children:"2. Share Screen"}),lt&&jsxRuntimeExports.jsx("span",{className:"rounded-md bg-emerald-600/20 px-4 py-2 text-sm font-semibold text-emerald-300",children:"Screen Sharing Active"}),nt&&jsxRuntimeExports.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:An,className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:dt?"OFF":"ON"}),jsxRuntimeExports.jsx("button",{onClick:Dn,className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:at?": OFF":": ON"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6 max-w-4xl",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:""}),jsxRuntimeExports.jsx("div",{className:"ml-auto text-xs text-slate-600",children:": "})]}),jsxRuntimeExports.jsx("div",{className:"mt-3 max-h-[260px] overflow-auto rounded-lg border border-slate-200 bg-slate-50 p-3",children:cn.length===0?jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-600",children:""}):jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[cn.map(ht=>jsxRuntimeExports.jsxs("div",{className:"rounded-md border border-slate-200 bg-white p-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-600",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-slate-800",children:ht.fromRole==="proctor"?"":""}),jsxRuntimeExports.jsx("span",{className:"ml-auto",children:new Date(ht.ts).toLocaleTimeString()})]}),jsxRuntimeExports.jsx("div",{className:"mt-1 whitespace-pre-wrap break-words text-sm text-slate-900",children:ht.text})]},ht.id)),jsxRuntimeExports.jsx("div",{ref:Kt})]})}),jsxRuntimeExports.jsxs("div",{className:"mt-3 flex gap-2",children:[jsxRuntimeExports.jsx("input",{value:an,onChange:ht=>bn(ht.target.value),onKeyDown:ht=>{ht.key==="Enter"&&(ht.preventDefault(),Mn())},disabled:!nt,placeholder:nt?"":"",className:"min-w-0 flex-1 rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 placeholder-slate-400 disabled:opacity-50"}),jsxRuntimeExports.jsx("button",{onClick:Mn,disabled:!nt||!String(an||"").trim(),className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:cursor-not-allowed disabled:opacity-50",children:""})]}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-[11px] text-slate-500",children:""})]})]})}function sanitizeTokenPart(et){return String(et||"").trim().replace(/\s+/g," ").slice(0,32)}function toBase64Url(et){const $=new TextEncoder().encode(String(et||""));let _="";for(const nt of $)_+=String.fromCharCode(nt);return btoa(_).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function fromBase64Url(et){const $=String(et||"").replace(/-/g,"+").replace(/_/g,"/"),_=(4-$.length%4)%4,tt=$+"=".repeat(_),nt=atob(tt),it=new Uint8Array(nt.length);for(let rt=0;rt<nt.length;rt++)it[rt]=nt.charCodeAt(rt);return new TextDecoder().decode(it)}function encodeExternalUserToken(et,$=24){const _=sanitizeTokenPart(et),nt=new TextEncoder().encode(_).slice(0,Math.max(0,$));let it="";for(const lt of nt)it+=String.fromCharCode(lt);return btoa(it).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")||toBase64Url("User")}function makeExternalUserIdWithFallback(et,$,_){const tt=encodeExternalUserToken(_||"User",24),nt=encodeExternalUserToken("class",18),it=encodeExternalUserToken($==null?void 0:$.display_name,24)||tt,rt=encodeExternalUserToken($==null?void 0:$.class_name,18)||nt,ot=Math.floor(Math.random()*1e6);return et==="proctor"?`proctor:${it}:${ot}`:`student:${it}:${rt}:${ot}`}function extractDisplayName(et){const $=String(et||"").split("#")[0],_=$.split(":");if(_.length>=2&&(_[0]==="student"||_[0]==="proctor")){const tt=_[1]||"";if(!tt)return $;try{return fromBase64Url(tt)||tt}catch{return tt}}return $.startsWith("student-")||$.startsWith("proctor-"),$}function App(){const[et,$]=reactExports.useState(!1),[_,tt]=reactExports.useState(null),[nt,it]=reactExports.useState(null),[rt,ot]=reactExports.useState("dashboard"),[lt,st]=reactExports.useState(""),[at,ct]=reactExports.useState(""),[dt,ut]=reactExports.useState(""),[ft,pt]=reactExports.useState(""),[St,gt]=reactExports.useState("");reactExports.useEffect(()=>{getCurrentUserSession().then(jt=>{const qt=jt.getIdToken().getJwtToken();qt&&(setAuthToken(qt),$(!0),ct(jt.getIdToken().payload["cognito:username"]||"User"))}).catch(jt=>{console.log("No active session found")})},[]),reactExports.useEffect(()=>{et&&fetchMe().then(jt=>{it(jt.role),_==="proctor"&&jt.role!=="proctor"&&tt(null)}).catch(jt=>{console.error(jt),gt(jt.message||"Failed to load profile")})},[et,_]),reactExports.useEffect(()=>{if(!et)return;let jt=!1;return fetchProfile().then(qt=>{if(jt)return;const cn=String((qt==null?void 0:qt.display_name)||"").trim();ut(cn)}).catch(()=>{jt||ut("")}),()=>{jt=!0}},[et,rt]);const[yt,vt]=reactExports.useState(!1),[Ct,Et]=reactExports.useState(""),[Mt,Rt]=reactExports.useState(null),[At,Dt]=reactExports.useState(null),It=async jt=>{jt.preventDefault(),gt("");try{try{if(at.startsWith("dev")){console.warn("Using DEV bypass login"),setAuthToken("dev-token-bypass"),$(!0);return}const qt=await signIn(at,ft);if(qt.type==="new_password_required"){vt(!0),Rt(qt.user),Dt(qt.userAttributes);return}setAuthToken(qt.token),$(!0)}catch(qt){throw qt}}catch(qt){gt(qt.message||"Login failed")}},Vt=async jt=>{jt.preventDefault(),gt("");try{const qt=await completeNewPassword(Mt,Ct,At);qt.type==="success"&&(setAuthToken(qt.token),vt(!1),$(!0))}catch(qt){gt(qt.message||"Failed to set new password")}};return yt?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900 flex items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold",children:""}),jsxRuntimeExports.jsx("p",{className:"mt-1 text-sm text-slate-600",children:""}),jsxRuntimeExports.jsxs("form",{onSubmit:Vt,className:"mt-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-800",children:"New Password"}),jsxRuntimeExports.jsx("input",{type:"password",value:Ct,onChange:jt=>Et(jt.target.value),required:!0,className:"mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),St&&jsxRuntimeExports.jsx("p",{className:"text-sm text-red-400",children:St}),jsxRuntimeExports.jsx("button",{type:"submit",className:"w-full rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500",children:"Update Password"})]})]})}):et?_?jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900",children:jsxRuntimeExports.jsxs("div",{className:"mx-auto w-full max-w-6xl px-4 py-6",children:[jsxRuntimeExports.jsxs("header",{className:"mb-6 flex items-center justify-between border-b border-slate-200 pb-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold",children:"Exam Surveillance"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-600",children:_==="proctor"?"Proctor Dashboard":"Examinee View"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"text-right leading-tight",children:[dt&&jsxRuntimeExports.jsx("div",{className:"text-xs font-semibold text-slate-900",children:dt}),jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-700",children:at})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{tt(null),ot("dashboard")},className:"rounded-md border border-slate-300 px-3 py-2 text-sm text-slate-700 hover:bg-slate-100",children:"Switch Role"}),jsxRuntimeExports.jsx("button",{onClick:()=>{$(!1),tt(null),signOut(),clearAuthToken()},className:"rounded-md bg-slate-900 px-3 py-2 text-sm font-semibold text-white hover:bg-slate-800",children:"Sign Out"})]})]}),rt==="dashboard"&&_==="proctor"&&jsxRuntimeExports.jsx(ProctorDashboardHome,{onGoMeeting:jt=>ot(jt==="schedule"?"schedule":"meeting"),onGoProfile:()=>ot("profile"),onGoUsers:()=>ot("users"),selectedJoinCode:lt,onSelectJoinCode:jt=>st(jt)}),rt==="dashboard"&&_==="examinee"&&jsxRuntimeExports.jsx(ExamineeDashboardHome,{onGoMeeting:()=>ot("meeting"),onGoProfile:()=>ot("profile")}),rt==="profile"&&jsxRuntimeExports.jsx(ProfileEditPage,{role:_,onDone:()=>ot("dashboard")}),rt==="schedule"&&_==="proctor"&&jsxRuntimeExports.jsx(ProctorSchedulePage,{selectedJoinCode:lt,onSelectJoinCode:jt=>st(jt),onGoMeeting:()=>ot("meeting"),onDone:()=>ot("dashboard"),currentUsername:at}),rt==="users"&&_==="proctor"&&jsxRuntimeExports.jsx(ProctorUsersPage,{onDone:()=>ot("dashboard")}),rt==="meeting"&&_==="proctor"&&jsxRuntimeExports.jsx(ProctorDashboard,{currentUsername:at,meetingId:lt,onSetMeetingId:jt=>st(jt),onGoSchedule:()=>ot("schedule"),onBack:()=>ot("dashboard"),makeExternalUserIdWithFallback,extractDisplayName}),rt==="meeting"&&_==="examinee"&&jsxRuntimeExports.jsx(ExamineeView,{currentUsername:at,onBack:()=>ot("dashboard"),makeExternalUserIdWithFallback,extractDisplayName})]})}):jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900",children:jsxRuntimeExports.jsxs("div",{className:"mx-auto w-full max-w-4xl px-4 py-8",children:[jsxRuntimeExports.jsxs("header",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold",children:"Exam Surveillance App"}),jsxRuntimeExports.jsx("button",{onClick:()=>{$(!1),tt(null),signOut(),clearAuthToken()},className:"rounded-md border border-slate-300 px-3 py-2 text-sm text-slate-700 hover:bg-slate-100",children:"Sign Out"})]}),jsxRuntimeExports.jsxs("div",{className:"mt-6 rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-600",children:"Logged in as"}),jsxRuntimeExports.jsx("div",{className:"mt-1 text-lg font-semibold",children:at}),jsxRuntimeExports.jsx("div",{className:"mt-6 text-sm font-medium text-slate-800",children:"Select your role"}),jsxRuntimeExports.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{if(nt!=="proctor"){gt("You are not allowed to access Proctor Dashboard.");return}tt("proctor"),ot("dashboard")},disabled:nt!=="proctor",className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Proctor (Supervisor)"}),jsxRuntimeExports.jsx("button",{onClick:()=>{tt("examinee"),ot("dashboard")},className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100",children:"Examinee (Student)"})]}),nt&&jsxRuntimeExports.jsxs("p",{className:"mt-4 text-xs text-slate-600",children:["Your role: ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-slate-800",children:nt})]}),St&&jsxRuntimeExports.jsx("p",{className:"mt-3 text-sm text-red-400",children:St})]})]})}):jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900 flex items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md rounded-xl border border-slate-200 bg-white p-6",children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold",children:""}),jsxRuntimeExports.jsxs("form",{onSubmit:It,className:"mt-6 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-800",children:"Username"}),jsxRuntimeExports.jsx("input",{type:"text",value:at,onChange:jt=>ct(jt.target.value),required:!0,className:"mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-slate-800",children:"Password"}),jsxRuntimeExports.jsx("input",{type:"password",value:ft,onChange:jt=>pt(jt.target.value),required:!0,className:"mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),St&&jsxRuntimeExports.jsx("p",{className:"text-sm text-red-400",children:St}),jsxRuntimeExports.jsxs("div",{className:"rounded-md border border-slate-200 bg-slate-50 p-3 text-xs text-slate-600",children:[jsxRuntimeExports.jsx("div",{children:"Tip: Update frontend/src/config.js with your User Pool ID."}),jsxRuntimeExports.jsx("div",{children:'Dev Bypass: Use username starting with "dev" (e.g. "dev-admin")'})]}),jsxRuntimeExports.jsx("button",{type:"submit",className:"w-full rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500",children:"Sign In"})]})]})})}const index="";client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));export{fromUtf8$2 as f,toUtf8 as t};
